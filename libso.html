<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Iframe Looper with Zoom & Pan</title>
    <style>
        /* --- General Setup --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #111;
            overflow: hidden;
        }

        /* --- Viewport Container (Fixed Size) --- */
        #zoom-wrapper {
            /* This defines the visible area (800x800) */
            width: 95%;
            height: 95%;
            overflow: hidden; /* **CRUCIAL: Hides the zoomed content edges** */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            background-color: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #111;
            overflow: hidden;
        }

        /* --- Zoomable Container (The element that moves and scales) --- */
        #iframe-container {
            width: 102.5%;
            height: 102.5%;
            position: relative; 
            
            /* **CRUCIAL: Smooth Transition** */
            /* Apply a transition to the 'transform' property over 20 seconds for slow movement */
            transition: transform 20s ease-in-out; 
            
            /* Initial transformation: Zoomed in (1.1) and moved to an 'end' position */
            transform: scale(1) translate(-1.25%, -1.25%); 
        }

        /* --- Iframe Styles (Same as before) --- */
        #animationFrame1,
        #animationFrame2 {
            position: absolute;
            top: 0;
            left: 0;
            width: 102.5%;
            height: 102.5%;
            border: none;
            opacity: 0;
            /* Transition for the crossfade */
            transition: opacity 1.0s ease-in-out;
            will-change: opacity;
            z-index: 1;
        }

        .active {
            opacity: 1 !important;
            z-index: 2 !important;
        }

        .inactive {
            opacity: 0 !important;
            z-index: 1 !important;
        }

    </style>
</head>
<body>

<div id="zoom-wrapper">
    <div id="iframe-container">
        <iframe id="animationFrame1" src="about:blank" frameborder="0" class="active"></iframe>
        <iframe id="animationFrame2" src="about:blank" frameborder="0" class="inactive"></iframe>
    </div>
</div>

<script>
    const container = document.getElementById('iframe-container');
    
    // Define the two extreme states for the animation
    const STATE_A = 'scale(1.1) translate(0%, 0%)'; // Zoom 10%, slight pan from top-left
    const STATE_B = 'scale(1.1) translate(-10%, -10%)'; // Zoom 10%, slight pan to bottom-right
    
    let currentState = 'A';

    /**
     * Toggles the transform state of the container.
     */
    function animateZoomAndPan() {
        if (currentState === 'A') {
            // Move to STATE_B
            container.style.transform = STATE_B;
            currentState = 'B';
        } else {
            // Move to STATE_A
            container.style.transform = STATE_A;
            currentState = 'A';
        }
        
        // The movement will automatically happen smoothly over the 20s defined in the CSS transition.
    }

    // Run the animation function once initially
    animateZoomAndPan(); 

    // Then, run it again every 20,000 milliseconds (20 seconds) to loop the movement
    // NOTE: This interval should match the CSS transition duration.
    setInterval(animateZoomAndPan, 20000); 

    // --- Optional: Your Iframe Looper Logic (Example Placeholder) ---
    // This is where you would put the code to swap the 'active' and 'inactive' classes 
    // on animationFrame1 and animationFrame2 for the crossfade effect.
    // ...
</script>



<script>

var ifrs="DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDx0aXRsZT5QaXhlbCBGbG93IEFuaW1hdGlvbiBCeSBSaWRvdWFuIEJlbiBNYXNzb3VkPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIGJvZHl7d2lkdGg6MTAwJTsgaGVpZ2h0OjEwMCU7IGp1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO2JhY2tncm91bmQtY29sb3I6IzExMTttYXJnaW46MDtvdmVyZmxvdzpoaWRkZW59DQogICAgICAgIGNhbnZhc3tib3JkZXI6MCBzb2xpZCAjMzMzOw0KfQ0KICAgICAgICAjY29udHJvbHN7bWFyZ2luLXRvcDoyMHB4O2NvbG9yOndoaXRlO2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWY7Zm9udC1zaXplOjE0cHg7ZGlzcGxheTpub25lfQ0KICAgICAgICBpbnB1dFt0eXBlPSJmaWxlIl17bWFyZ2luLWxlZnQ6MTBweH0NCg0KICAgICAgICAvKiBEZSAnY2FudmFzJyBkaXYgKG51IGZ1bGwgc2NyZWVuKSAqLw0KICAgICAgICAjY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQoNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgIA0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAJIGhlaWdodDoxMDAlOw0KIAkgd2lkdGg6MTAwJTsNCg0KICAgICAgICAgICAgLyogRGUgY2FudmFzIHdvcmR0IGhpZXJiaW5uZW4gZ2VwbGFhdHN0IGVuIGdlc2NoYWFsZCBkb29yIENTUyAqLw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBTdHlsaW5nIHZvb3IgZGUgY2FudmFzIGRpZSBkb29yIGRlIEpTIGNvZGUgd29yZHQgYWFuZ2VtYWFrdCAqLw0KICAgICAgICAjYW5pbWF0aW9uQ2FudmFzT0cgew0KICAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERlICdjYW52YXMnIGRpdiAqLw0KICAgICAgICAjX18zY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogU3R5bGluZyB2b29yIGRlIGNhbnZhcyBkaWUgZG9vciBkZSBKUyBjb2RlIHdvcmR0IGFhbmdlbWFha3QgKi8NCiAgICAgICAgI19fM2FuaW1hdGlvbkNhbnZhc09HIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBUaGUgJ2NhbnZhcycgZGl2IChUaGUgRGV0b25hdGlvbiBGaWVsZCkgKi8NCiAgICAgICAgI2ZpZWxkQ29udGFpbmVyIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyANCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IA0KICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBUaGUgQ2FudmFzICovDQogICAgICAgICNyZW5kZXJTdXJmYWNlIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDsgDQoNCiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4wNXMgZWFzZS1vdXQ7IA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAjcHJvdG9jb2wtc3RhdHVzIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogMjBweDsNCiAgICAgICAgICAgIGxlZnQ6IDUwJTsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgIHotaW5kZXg6IDEwOw0KICAgICAgICAgICAgZm9udC1zaXplOiAxLjVlbTsNCiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgDQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KICAgIDxjYW52YXMgd2lkdGg9NjQwIGhlaWdodD0zNjAgaWQ9InBpeGVsQ2FudmFzIiBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJScgPjwvY2FudmFzPg0KICAgIDxkaXYgaWQ9ImNvbnRyb2xzIiBzdHlsZT0nZGlzcGxheTpub25lJz4NCiAgICAgICAgTG9hZCBJbWFnZTogPGlucHV0IHR5cGU9ImZpbGUiIGlkPSJpbWFnZUxvYWRlciI+DQogICAgICAgIDxwPkRlZmF1bHQgaW1hZ2UgaXMgdXNlZCB1bnRpbCBhIGZpbGUgaXMgbG9hZGVkLjwvcD4NCiAgICA8L2Rpdj4NCiAgICA8ZGl2IGlkPSJzdGF0dXMiPldhaXRpbmcgZm9yIGltYWdlIHRvIGxvYWQuLi48L2Rpdj4NCg0KICAgIDxzY3JpcHQ+DQogICAgICAgIC8vIC0tLSBDb25maWd1cmF0aW9uIGFuZCBTZXR1cCAtLS0NCiAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BpeGVsQ2FudmFzJyk7DQogICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICBjb25zdCBpbWFnZUxvYWRlciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpbWFnZUxvYWRlcicpOw0KICAgICAgICBjb25zdCBzdGF0dXNFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cycpOw0KDQogICAgICAgIGNvbnN0IElNQUdFX1VSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgLy8gRGVmYXVsdCBpbWFnZQ0KICAgICAgICBjb25zdCBQQVJUSUNMRV9ERU5TSVRZID0gMzsgLy8gVXNlIGV2ZXJ5IDJuZCBwaXhlbA0KDQogICAgICAgIGxldCBwYXJ0aWNsZXMgPSBbXTsNCiAgICAgICAgbGV0IGFuaW1hdGlvbkZyYW1lSWQ7DQoNCiAgICAgICAgLy8gTmV3IHN0YXRlIHZhcmlhYmxlcyBmb3IgdGhlIGFuaW1hdGlvbiBsb2dpYw0KICAgICAgICBsZXQgY29uY2VudHJhdGlvbkNlbnRlcnMgPSB7DQogICAgICAgICAgICByOiB7IHg6IDAsIHk6IDAgfSwNCiAgICAgICAgICAgIGc6IHsgeDogMCwgeTogMCB9LA0KICAgICAgICAgICAgYjogeyB4OiAwLCB5OiAwIH0NCiAgICAgICAgfTsNCiAgICAgICAgbGV0IGlzQW5pbWF0aW5nID0gZmFsc2U7DQogICAgICAgIGNvbnN0IFRJTUVfRkFDVE9SID0gMzAwOyAvLyBDb25zdGFudCB0byBjb250cm9sIG92ZXJhbGwgYW5pbWF0aW9uIHNwZWVkDQoNCiAgICAgICAgLy8gLS0tIFBhcnRpY2xlIENsYXNzIC0tLQ0KICAgICAgICBjbGFzcyBQYXJ0aWNsZSB7DQogICAgICAgICAgICBjb25zdHJ1Y3Rvcih4LCB5LCBjb2xvciwgciwgZywgYiwgdGFyZ2V0Q2VudGVyKSB7DQogICAgICAgICAgICAgICAgdGhpcy5zdGFydFggPSB4Ow0KICAgICAgICAgICAgICAgIHRoaXMuc3RhcnRZID0geTsNCiAgICAgICAgICAgICAgICB0aGlzLnggPSB4Ow0KICAgICAgICAgICAgICAgIHRoaXMueSA9IHk7DQogICAgICAgICAgICAgICAgdGhpcy5jb2xvciA9IGNvbG9yOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIERldGVybWluZSB0aGUgbWF4aW11bSBjb2xvciB2YWx1ZSBhbmQgYXNzaWduIHNwZWVkDQogICAgICAgICAgICAgICAgY29uc3QgbWF4VmFsID0gTWF0aC5tYXgociwgZywgYik7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgLy8gU3BlZWQgZmFjdG9yOiBwcm9wb3J0aW9uYWwgdG8gdGhlIG1heGltdW0gY29sb3IgdmFsdWUgKDAtMjU1KS4NCiAgICAgICAgICAgICAgICAvLyBMb3dlciBtYXhWYWwgbWVhbnMgc2xvd2VyIGFycml2YWwgdGltZS4gTm9ybWFsaXplZCBmcm9tIDAuMDEgdG8gMS4wLg0KICAgICAgICAgICAgICAgIHRoaXMuc3BlZWRGYWN0b3IgPSAobWF4VmFsIC8gMjU1KSAqIDAuOSArIDAuMTsgLy8gRW5zdXJlIGEgbWluaW11bSBzcGVlZCBvZiAwLjENCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICB0aGlzLnZlbG9jaXR5ID0geyB4OiAwLCB5OiAwIH07DQogICAgICAgICAgICAgICAgdGhpcy50YXJnZXRDZW50ZXIgPSB0YXJnZXRDZW50ZXI7IC8vICdyJywgJ2cnLCBvciAnYicNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSB2ZWxvY2l0eSAoZGlyZWN0aW9uIGFuZCBzcGVlZCkgdG93YXJkcyB0aGUgdGFyZ2V0DQogICAgICAgICAgICBjYWxjdWxhdGVWZWxvY2l0eSh0YXJnZXRYLCB0YXJnZXRZKSB7DQogICAgICAgICAgICAgICAgY29uc3QgZHggPSB0YXJnZXRYIC0gdGhpcy54Ow0KICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0gdGFyZ2V0WSAtIHRoaXMueTsNCg0KICAgICAgICAgICAgICAgIC8vIERpc3RhbmNlIGZyb20gY3VycmVudCBwb3NpdGlvbiB0byB0YXJnZXQNCiAgICAgICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7DQoNCiAgICAgICAgICAgICAgICAvLyBUaGUgdGltZSB0aGUgcGFydGljbGUgc2hvdWxkIHRha2UgdG8gcmVhY2ggdGhlIHRhcmdldC4NCiAgICAgICAgICAgICAgICAvLyBTbG93ZXIgcGFydGljbGVzIChsb3dlciBzcGVlZEZhY3RvcikgdGFrZSBhIGxvbmdlciB0aW1lLg0KICAgICAgICAgICAgICAgIGNvbnN0IHRpbWVUb0Fycml2ZSA9IFRJTUVfRkFDVE9SIC8gdGhpcy5zcGVlZEZhY3RvcjsNCg0KICAgICAgICAgICAgICAgIC8vIFZlbG9jaXR5ID0gRGlzdGFuY2UgLyBUaW1lDQogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS54ID0gZHggLyB0aW1lVG9BcnJpdmU7DQogICAgICAgICAgICAgICAgdGhpcy52ZWxvY2l0eS55ID0gZHkgLyB0aW1lVG9BcnJpdmU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHVwZGF0ZSgpIHsNCiAgICAgICAgICAgICAgICAvLyBNb3ZlIHRoZSBwYXJ0aWNsZSBvbmUgc3RlcCBjbG9zZXIgdG8gdGhlIHRhcmdldA0KICAgICAgICAgICAgICAgIHRoaXMueCArPSB0aGlzLnZlbG9jaXR5Lng7DQogICAgICAgICAgICAgICAgdGhpcy55ICs9IHRoaXMudmVsb2NpdHkueTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgZHJhdygpIHsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gdGhpcy5jb2xvcjsNCiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QodGhpcy54LCB0aGlzLnksIDEsIDEpOyAvLyBEcmF3IGFzIGEgMXgxIHBpeGVsDQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0gQ29yZSBMb2dpYyBGdW5jdGlvbnMgLS0tDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIHdlaWdodGVkIGF2ZXJhZ2UgKGNlbnRlciBvZiBtYXNzKSBmb3IgYSBzcGVjaWZpYyBjb2xvciBjaGFubmVsLg0KICAgICAgICAgKiBUaGUgY29vcmRpbmF0ZSBvZiBhIHBpeGVsIGlzIHdlaWdodGVkIGJ5IGl0cyBjb2xvciBjb21wb25lbnQncyB2YWx1ZS4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUNvbmNlbnRyYXRpb25DZW50ZXIoZGF0YSwgd2lkdGgsIGhlaWdodCwgY2hhbm5lbEluZGV4LCBkZW5zaXR5KSB7DQogICAgICAgICAgICBsZXQgdG90YWxXZWlnaHQgPSAwOw0KICAgICAgICAgICAgbGV0IHN1bVggPSAwOw0KICAgICAgICAgICAgbGV0IHN1bVkgPSAwOw0KDQogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSArPSBkZW5zaXR5KSB7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCArPSBkZW5zaXR5KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIHdpZHRoICsgeCkgKiA0Ow0KICAgICAgICAgICAgICAgICAgICBjb25zdCB3ZWlnaHQgPSBkYXRhW2kgKyBjaGFubmVsSW5kZXhdOyAvLyBSPTAsIEc9MSwgQj0yDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHdlaWdodCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1bVggKz0geCAqIHdlaWdodDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1bVkgKz0geSAqIHdlaWdodDsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsV2VpZ2h0ICs9IHdlaWdodDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHRvdGFsV2VpZ2h0ID4gMCkgew0KICAgICAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgICAgIHg6IE1hdGgucm91bmQoc3VtWCAvIHRvdGFsV2VpZ2h0KSwNCiAgICAgICAgICAgICAgICAgICAgeTogTWF0aC5yb3VuZChzdW1ZIC8gdG90YWxXZWlnaHQpDQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8vIEZhbGxiYWNrOiBJZiBubyBjb2xvciBpcyBmb3VuZCAoZS5nLiwgYWxsIGJsYWNrKSwgdXNlIHRoZSBjZW50ZXIgb2YgdGhlIGNhbnZhcw0KICAgICAgICAgICAgcmV0dXJuIHsgeDogTWF0aC5yb3VuZCh3aWR0aCAvIDIpLCB5OiBNYXRoLnJvdW5kKGhlaWdodCAvIDIpIH07DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogRGV0ZXJtaW5lcyB0aGUgZG9taW5hbnQgY29sb3IgY29tcG9uZW50IGZvciBhIHBpeGVsLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZ2V0RG9taW5hbnRDb2xvcihyLCBnLCBiKSB7DQogICAgICAgICAgICBpZiAociA+PSBnICYmIHIgPj0gYikgcmV0dXJuICdyJzsNCiAgICAgICAgICAgIGlmIChnID49IHIgJiYgZyA+PSBiKSByZXR1cm4gJ2cnOw0KICAgICAgICAgICAgcmV0dXJuICdiJzsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWFkcyB0aGUgaW1hZ2UgZGF0YSwgZmluZHMgdGhlIE1heCBSLCBHLCBCIGNvbmNlbnRyYXRpb24gY2VudGVycywgYW5kIGNyZWF0ZXMgcGFydGljbGVzLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0ltYWdlKGltZykgew0KICAgICAgICAgICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9ICJQcm9jZXNzaW5nIGltYWdlIGFuZCBjYWxjdWxhdGluZyBjZW50ZXJzLi4uIjsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gMS4gU2V0IGNhbnZhcyBzaXplIHRvIGltYWdlIHNpemUNCiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IDY0MDsNCiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSAzNjA7DQoNCiAgICAgICAgICAgIC8vIDIuIERyYXcgdGhlIGltYWdlIG9udG8gdGhlIGNhbnZhcyB0ZW1wb3JhcmlseQ0KICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOw0KICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7DQoNCiAgICAgICAgICAgIC8vIDMuIEdldCBwaXhlbCBkYXRhDQogICAgICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7DQoNCiAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBDb25jZW50cmF0aW9uIENlbnRlcnMgKENlbnRlciBvZiBNYXNzKQ0KICAgICAgICAgICAgY29uY2VudHJhdGlvbkNlbnRlcnMuciA9IGNhbGN1bGF0ZUNvbmNlbnRyYXRpb25DZW50ZXIoZGF0YSwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0LCAwLCBQQVJUSUNMRV9ERU5TSVRZKTsNCiAgICAgICAgICAgIGNvbmNlbnRyYXRpb25DZW50ZXJzLmcgPSBjYWxjdWxhdGVDb25jZW50cmF0aW9uQ2VudGVyKGRhdGEsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCwgMSwgUEFSVElDTEVfREVOU0lUWSk7DQogICAgICAgICAgICBjb25jZW50cmF0aW9uQ2VudGVycy5iID0gY2FsY3VsYXRlQ29uY2VudHJhdGlvbkNlbnRlcihkYXRhLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQsIDIsIFBBUlRJQ0xFX0RFTlNJVFkpOw0KDQogICAgICAgICAgICBjb25zb2xlLmxvZygiQ29uY2VudHJhdGlvbiBDZW50ZXJzOiIsIGNvbmNlbnRyYXRpb25DZW50ZXJzKTsNCg0KICAgICAgICAgICAgLy8gNS4gQ3JlYXRlIHBhcnRpY2xlcyBhbmQgYXNzaWduIHRoZWlyIHRhcmdldA0KICAgICAgICAgICAgcGFydGljbGVzID0gW107DQogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGNhbnZhcy5oZWlnaHQ7IHkgKz0gUEFSVElDTEVfREVOU0lUWSkgew0KICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY2FudmFzLndpZHRoOyB4ICs9IFBBUlRJQ0xFX0RFTlNJVFkpIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogY2FudmFzLndpZHRoICsgeCkgKiA0Ow0KDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBkYXRhW2ldOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gZGF0YVtpICsgMV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBkYXRhW2kgKyAyXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYSA9IGRhdGFbaSArIDNdOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIFNraXAgdHJhbnNwYXJlbnQgcGl4ZWxzDQogICAgICAgICAgICAgICAgICAgIGlmIChhID09PSAwKSBjb250aW51ZTsNCg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkb21pbmFudENvbG9yID0gZ2V0RG9taW5hbnRDb2xvcihyLCBnLCBiKTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBgcmdiKCR7cn0sJHtnfSwke2J9KWA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBwYXJ0aWNsZXMucHVzaChuZXcgUGFydGljbGUoeCwgeSwgY29sb3IsIHIsIGcsIGIsIGRvbWluYW50Q29sb3IpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIDYuIEluaXRpYWxpemUgcGFydGljbGUgdmVsb2NpdGllcyB0b3dhcmRzIHRoZWlyIGFzc2lnbmVkIGNlbnRlcg0KICAgICAgICAgICAgc3RhcnRBbmltYXRpb24oKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZXRzIHRoZSB2ZWxvY2l0eSBmb3IgYWxsIHBhcnRpY2xlcyB0b3dhcmRzIHRoZWlyIGFzc2lnbmVkIGNvbG9yIGNlbnRlci4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHN0YXJ0QW5pbWF0aW9uKCkgew0KICAgICAgICAgICAgc3RhdHVzRWxlbWVudC50ZXh0Q29udGVudCA9IGBUb3RhbCBwYXJ0aWNsZXM6ICR7cGFydGljbGVzLmxlbmd0aH0uIEFuaW1hdGluZy4uLmA7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHBhcnRpY2xlcy5mb3JFYWNoKHAgPT4gew0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFBvaW50ID0gY29uY2VudHJhdGlvbkNlbnRlcnNbcC50YXJnZXRDZW50ZXJdOw0KICAgICAgICAgICAgICAgIHAuY2FsY3VsYXRlVmVsb2NpdHkodGFyZ2V0UG9pbnQueCwgdGFyZ2V0UG9pbnQueSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgaWYgKGFuaW1hdGlvbkZyYW1lSWQpIHsNCiAgICAgICAgICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZShhbmltYXRpb25GcmFtZUlkKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlzQW5pbWF0aW5nID0gdHJ1ZTsNCiAgICAgICAgICAgIGFuaW1hdGUoKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBNYWluIGFuaW1hdGlvbiBsb29wDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgew0KICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIGNhbnZhcyBmb3IgdGhlIG5leHQgZnJhbWUNCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgbGV0IGFsbEFycml2ZWQgPSB0cnVlOw0KICAgICAgICAgICAgY29uc3QgdG9sZXJhbmNlU3EgPSA1ICogNTsgLy8gVG9sZXJhbmNlIGZvciBhcnJpdmFsDQoNCiAgICAgICAgICAgIHBhcnRpY2xlcy5mb3JFYWNoKHAgPT4gew0KICAgICAgICAgICAgICAgIC8vIERldGVybWluZSB0aGUgcGFydGljbGUncyBzcGVjaWZpYyB0YXJnZXQNCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRQb2ludCA9IGNvbmNlbnRyYXRpb25DZW50ZXJzW3AudGFyZ2V0Q2VudGVyXTsNCg0KICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RUb1RhcmdldFNxID0gKHRhcmdldFBvaW50LnggLSBwLngpKioyICsgKHRhcmdldFBvaW50LnkgLSBwLnkpKioyOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChkaXN0VG9UYXJnZXRTcSA+IHRvbGVyYW5jZVNxKSB7DQogICAgICAgICAgICAgICAgICAgIHAudXBkYXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGFsbEFycml2ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAvLyBTbmFwIHRvIHRoZSBmaW5hbCBwb3NpdGlvbiBmb3IgYSBjbGVhbiBmaW5pc2gNCiAgICAgICAgICAgICAgICAgICAgcC54ID0gdGFyZ2V0UG9pbnQueDsNCiAgICAgICAgICAgICAgICAgICAgcC55ID0gdGFyZ2V0UG9pbnQueTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcC5kcmF3KCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgaWYgKGlzQW5pbWF0aW5nICYmICFhbGxBcnJpdmVkKSB7DQogICAgICAgICAgICAgICAgYW5pbWF0aW9uRnJhbWVJZCA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBbmltYXRpbmcpIHsNCiAgICAgICAgICAgICAgICBpc0FuaW1hdGluZyA9IGZhbHNlOw0KICAgICAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSAiQW5pbWF0aW9uIGNvbXBsZXRlLiBBbGwgcGFydGljbGVzIHJlYWNoZWQgdGhlaXIgY29sb3IgY2VudGVyLiI7DQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FuaW1hdGlvbiBjb21wbGV0ZSEnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBMb2FkcyBhbiBpbWFnZSBmcm9tIGEgVVJMIG9yIGZpbGUuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBsb2FkSW1hZ2Uoc291cmNlKSB7DQogICAgICAgICAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gIkxvYWRpbmcgaW1hZ2UuLi4iOw0KICAgICAgICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7DQogICAgICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsgLy8gUmVxdWlyZWQgZm9yIGZldGNoaW5nIGV4dGVybmFsIGltYWdlcw0KICAgICAgICAgICAgDQogICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIHByb2Nlc3NJbWFnZShpbWcpOw0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRmFpbGVkIHRvIGxvYWQgaW1hZ2UgZnJvbSBzb3VyY2U6Iiwgc291cmNlKTsNCiAgICAgICAgICAgICAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gIkZhaWxlZCB0byBsb2FkIGltYWdlLiI7DQogICAgICAgICAgICAgICAgYWxlcnQoIkNvdWxkIG5vdCBsb2FkIHRoZSBpbWFnZS4gQ2hlY2sgdGhlIGJyb3dzZXIgY29uc29sZSBmb3IgZGV0YWlscy4iKTsNCiAgICAgICAgICAgIH07DQoNCiAgICAgICAgICAgIGltZy5zcmMgPSBzb3VyY2U7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0gRXZlbnQgTGlzdGVuZXJzIGFuZCBJbml0aWFsaXphdGlvbiAtLS0NCg0KICAgICAgICAvLyBMb2FkIGltYWdlIGZyb20gZmlsZSBpbnB1dA0KICAgICAgICBpbWFnZUxvYWRlci5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gew0KICAgICAgICAgICAgY29uc3QgZmlsZSA9IGUudGFyZ2V0LmZpbGVzWzBdOw0KICAgICAgICAgICAgaWYgKGZpbGUpIHsNCiAgICAgICAgICAgICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOw0KICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZXZlbnQpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgbG9hZEltYWdlKGV2ZW50LnRhcmdldC5yZXN1bHQpOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIExvYWQgdGhlIGRlZmF1bHQgaW1hZ2Ugb24gc3RhcnR1cA0KICAgICAgICBmdW5jdGlvbiBnYW1hYSgpew0KDQogICAgICAgICAgICBpZiAoYW5pbWF0aW9uRnJhbWVJZCkgew0KICAgICAgICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKGFuaW1hdGlvbkZyYW1lSWQpOw0KICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgIA0KIElNQUdFX1VSID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOw0KICAgICAgDQoNCiAgICAgICAgIHBhcnRpY2xlcyA9IFtdOw0KICAgICAgICAgYW5pbWF0aW9uRnJhbWVJZD1udWxsOw0KDQogICAgICAgIC8vIE5ldyBzdGF0ZSB2YXJpYWJsZXMgZm9yIHRoZSBhbmltYXRpb24gbG9naWMNCiAgICAgICAgIGNvbmNlbnRyYXRpb25DZW50ZXJzID0gew0KICAgICAgICAgICAgcjogeyB4OiAwLCB5OiAwIH0sDQogICAgICAgICAgICBnOiB7IHg6IDAsIHk6IDAgfSwNCiAgICAgICAgICAgIGI6IHsgeDogMCwgeTogMCB9DQogICAgICAgIH07DQogICAgICAgICBpc0FuaW1hdGluZyA9IGZhbHNlOw0KDQogICBsb2FkSW1hZ2UoSU1BR0VfVVIpOw0KDQoNCnNldFRpbWVvdXQoImdhbWFhKCkiLCAyNTAwMCk7DQogICAgICAgIA0KDQoJfQ0KZ2FtYWEoKTsNCg0KICAgIDwvc2NyaXB0Pg==<br>DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDx0aXRsZT5QaXhlbCBGbG93IEFuaW1hdGlvbiBCeSBSaWRvdWFuIEJlbiBNYXNzb3VkPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIGJvZHl7IHdpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7IGRpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjttaW4taGVpZ2h0OjEwMHZoO2JhY2tncm91bmQtY29sb3I6IzExMTttYXJnaW46MDtmbGV4LWRpcmVjdGlvbjpjb2x1bW47b3ZlcmZsb3c6aGlkZGVufQ0KICAgICAgICBjYW52YXN7Ym9yZGVyOjAgc29saWQgIzMzMzsNCn0NCiAgICAgICAgI2NvbnRyb2xze21hcmdpbi10b3A6MjBweDtjb2xvcjp3aGl0ZTtmb250LWZhbWlseTpBcmlhbCxzYW5zLXNlcmlmO2ZvbnQtc2l6ZToxNHB4O2Rpc3BsYXk6bm9uZX0NCiAgICAgICAgaW5wdXRbdHlwZT0iZmlsZSJde21hcmdpbi1sZWZ0OjEwcHh9DQoNCiAgICAgICAgLyogRGUgJ2NhbnZhcycgZGl2IChudSBmdWxsIHNjcmVlbikgKi8NCiAgICAgICAgI2NhbnZhc1hTIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KDQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICANCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogCSBoZWlnaHQ6MTAwJTsNCiAJIHdpZHRoOjEwMCU7DQoNCiAgICAgICAgICAgIC8qIERlIGNhbnZhcyB3b3JkdCBoaWVyYmlubmVuIGdlcGxhYXRzdCBlbiBnZXNjaGFhbGQgZG9vciBDU1MgKi8NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyogU3R5bGluZyB2b29yIGRlIGNhbnZhcyBkaWUgZG9vciBkZSBKUyBjb2RlIHdvcmR0IGFhbmdlbWFha3QgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhc09HIHsNCiAgICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBEZSAnY2FudmFzJyBkaXYgKi8NCiAgICAgICAgI19fM2NhbnZhc1hTIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIFN0eWxpbmcgdm9vciBkZSBjYW52YXMgZGllIGRvb3IgZGUgSlMgY29kZSB3b3JkdCBhYW5nZW1hYWt0ICovDQogICAgICAgICNfXzNhbmltYXRpb25DYW52YXNPRyB7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogVGhlICdjYW52YXMnIGRpdiAoVGhlIERldG9uYXRpb24gRmllbGQpICovDQogICAgICAgICNmaWVsZENvbnRhaW5lciB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsgDQogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOyANCiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyogVGhlIENhbnZhcyAqLw0KICAgICAgICAjcmVuZGVyU3VyZmFjZSB7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgaW1hZ2UtcmVuZGVyaW5nOiBwaXhlbGF0ZWQ7IA0KDQogICAgICAgICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IDAuMDVzIGVhc2Utb3V0OyANCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgI3Byb3RvY29sLXN0YXR1cyB7DQogICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgICAgICAgICB0b3A6IDIwcHg7DQogICAgICAgICAgICBsZWZ0OiA1MCU7DQogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7DQogICAgICAgICAgICB6LWluZGV4OiAxMDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS41ZW07DQogICAgICAgICAgICBkaXNwbGF5OiBub25lOw0KICAgICAgICB9DQoNCg0KDQogICAgICAgIA0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCg0KICA8Y2FudmFzIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIGlkPSJhbmltYXRpb25DYW52YXMiIHN0eWxlPSJ3aWR0aDoxMDAlO2hlaWdodDogMTAwJTtpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDsiPjwvY2FudmFzPg0KICAgIDxidXR0b24gaWQ9InBsYXlCdXR0b24iIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlO3otaW5kZXg6MTAwMDAwMDA7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtwb3NpdGlvbjpmaXhlZDtsZWZ0OjA7dG9wOjAnPiA8L2J1dHRvbj4NCiAgICA8ZGl2IGlkPSJpbmZvIiBzdHlsZT0nZGlzcGxheTpub25lJz4gPC9kaXY+DQoNCiAgPHNjcmlwdD4NCiAgIGNvbnN0IENXID0gMzAwOw0KY29uc3QgQ0ggPSAzMDA7DQpjb25zdCBnaVAgPSAoKSA9PiAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KY29uc3QgQUQgPTEwMDsNCmNvbnN0IFBJUyA9IDEwMDsNCmxldCBDLCBjbjsNCmxldCBzUCA9IFtdLCB0UCA9IFtdLCBhUCA9IFtdOw0KbGV0IGFGSTsNCmxldCBmQyA9IDA7DQpjb25zdCByRyA9ICgoKSA9PiB7DQogIGxldCBzZCA9IDEwMDsNCiAgcmV0dXJuICgpID0+IHsNCiAgICBzZCA9ICgxNjY0NTI1ICogc2QgKyAxMDEzOTA0MjIzKSAlIE1hdGgucG93KDIsIDMyKTsNCiAgICByZXR1cm4gc2QgLyBNYXRoLnBvdygyLCAzMik7DQogIH07DQp9KSgpOw0KZnVuY3Rpb24gZUlRKHQpIHsNCiAgcmV0dXJuIHQgPCAwLjUgPyAyICogdCAqIHQgOiAxIC0gTWF0aC5wb3coLTIgKiB0ICsgMiwgMikgLyAyOw0KfQ0KZnVuY3Rpb24gbFIoYSwgYiwgdCkgew0KICByZXR1cm4gYSArIChiIC0gYSkgKiB0Ow0KfQ0KZnVuY3Rpb24gcUIocDAsIHAxLCBwMiwgdCkgew0KICBjb25zdCB0aSA9IDEgLSB0Ow0KICByZXR1cm4gdGkgKiB0aSAqIHAwICsgMiAqIHRpICogdCAqIHAxICsgdCAqIHQgKiBwMjsNCn0NCmZ1bmN0aW9uIHJUSChyLCBnLCBiKSB7DQogIHIgLz0gMjU1OyBnIC89IDI1NTsgYiAvPSAyNTU7DQogIGNvbnN0IG14ID0gTWF0aC5tYXgociwgZywgYik7DQogIGNvbnN0IG1uID0gTWF0aC5taW4ociwgZywgYik7DQogIGxldCBoLCBzLCBsID0gKG14ICsgbW4pIC8gMjsNCiAgaWYgKG14ICE9PSBtbikgew0KICAgIGNvbnN0IGQgPSBteCAtIG1uOw0KICAgIHMgPSBsID4gMC41ID8gZCAvICgyIC0gbXggLSBtbikgOiBkIC8gKG14ICsgbW4pOw0KICAgIHN3aXRjaCAobXgpIHsNCiAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhazsNCiAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7DQogICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrOw0KICAgIH0NCiAgICBoIC89IDY7DQogIH0gZWxzZSB7IGggPSBzID0gMDsgfQ0KICByZXR1cm4geyBoOiBoICogMzYwLCBzLCBsIH07DQp9DQpmdW5jdGlvbiBzQygpIHsNCiAgY24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7DQogIEMgPSBjbi5nZXRDb250ZXh0KCcyZCcpOw0KICBjbi53aWR0aCA9IENXOw0KICBjbi5oZWlnaHQgPSBDSDsNCiAgQy5jbGVhclJlY3QoMCwgMCwgQ1csIENIKTsNCn0NCmZ1bmN0aW9uIGxJUChwdCkgew0KICByZXR1cm4gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7DQogICAgY29uc3QgaUcgPSBuZXcgSW1hZ2UoKTsNCiAgICBpRy5jcm9zc09yaWdpbiA9ICdhbm9ueW1vdXMnOw0KICAgIGlHLm9ubG9hZCA9ICgpID0+IHsNCiAgICAgIGNvbnN0IHRDID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICBjb25zdCB0WCA9IHRDLmdldENvbnRleHQoJzJkJyk7DQogICAgICB0Qy53aWR0aCA9IENXOw0KICAgICAgdEMuaGVpZ2h0ID0gQ0g7DQogICAgICB0WC5kcmF3SW1hZ2UoaUcsIDAsIDAsIENXLCBDSCk7DQogICAgICBjb25zdCBkQSA9IHRYLmdldEltYWdlRGF0YSgwLCAwLCBDVywgQ0gpLmRhdGE7DQogICAgICBjb25zdCBwWCA9IFtdOw0KICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBDSDsgeSsrKSB7DQogICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgQ1c7IHgrKykgew0KICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIENXICsgeCkgKiA0Ow0KICAgICAgICAgIHBYLnB1c2goeyB4LCB5LCByOiBkQVtpXSwgZzogZEFbaSsxXSwgYjogZEFbaSsyXSB9KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmVzKHBYKTsNCiAgICB9Ow0KICAgIGlHLm9uZXJyb3IgPSAoKSA9PiByZWooYEZhaWxlZCB0byBsb2FkIGltYWdlIGF0OiAke3B0fWApOw0KICAgIGlHLnNyYyA9IHB0Ow0KICB9KTsNCn0NCmZ1bmN0aW9uIHBOQShuVCkgew0KICBzUCA9IHRQOw0KICB0UCA9IG5UOw0KICBjb25zdCBzVCA9IFsuLi50UF07DQogIGZvciAobGV0IGkgPSBzVC5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7DQogICAgY29uc3QgaiA9IE1hdGguZmxvb3IockcoKSAqIChpICsgMSkpOw0KICAgIFtzVFtpXSwgc1Rbal1dID0gW3NUW2pdLCBzVFtpXV07DQogIH0NCiAgYVAgPSBzUC5tYXAoKHNSLCBpKSA9PiB7DQogICAgY29uc3QgdEcgPSBzVFtpXTsNCiAgICBjb25zdCBtWCA9IChzUi54ICsgdEcueCkgLyAyOw0KICAgIGNvbnN0IG1ZID0gKHNSLnkgKyB0Ry55KSAvIDI7DQogICAgY29uc3QgaEwgPSByVEgoc1Iuciwgc1IuZywgc1IuYik7DQogICAgY29uc3QgaEkgPSAoaEwuaCAvIDM2MCAtIDAuNSkgKiAyOw0KICAgIGNvbnN0IGxJID0gKGhMLmwgLSAwLjUpICogMjsNCiAgICBjb25zdCBjWG8gPSAoaEkgKiBQSVMpICsgKHJHKCkgLSAwLjUpICogKFBJUyAvIDQpOw0KICAgIGNvbnN0IGNZbyA9IChsSSAqIFBJUykgKyAockcoKSAtIDAuNSkgKiAoUElTIC8gNCk7DQogICAgY29uc3QgY1ggPSBtWCArIGNYbzsNCiAgICBjb25zdCBjWSA9IG1ZICsgY1lvOw0KICAgIHJldHVybiB7DQogICAgICB4OiBzUi54LCB5OiBzUi55LCByOiBzUi5yLCBnOiBzUi5nLCBiOiBzUi5iLA0KICAgICAgc3RhcnRfeDogc1IueCwgc3RhcnRfeTogc1IueSwNCiAgICAgIHN0YXJ0X3I6IHNSLnIsIHN0YXJ0X2c6IHNSLmcsIHN0YXJ0X2I6IHNSLmIsDQogICAgICBjdHJsX3g6IGNYLCBjdHJsX3k6IGNZLA0KICAgICAgdGFyZ2V0X3g6IHRHLngsIHRhcmdldF95OiB0Ry55LA0KICAgICAgdGFyZ2V0X3I6IHRHLnIsIHRhcmdldF9nOiB0Ry5nLCB0YXJnZXRfYjogdEcuYiwNCiAgICB9Ow0KICB9KTsNCn0NCmZ1bmN0aW9uIGFGKCkgew0KICBDLmZpbGxTdHlsZSA9ICdyZ2JhKDAsIDAsIDAsIDAuMSknOw0KICBDLmZpbGxSZWN0KDAsIDAsIENXLCBDSCk7DQogIGxldCB0TCA9IE1hdGgubWluKDEsIGZDIC8gQUQpOw0KICBjb25zdCB0RSA9IGVJUSh0TCk7DQogIGNvbnN0IHAwID0gJ3N0YXJ0Xyc7DQogIGNvbnN0IHAyID0gJ3RhcmdldF8nOw0KICBhUC5mb3JFYWNoKFAgPT4gew0KICAgIFAueCA9IHFCKFBbYCR7cDB9eGBdLCBQLmN0cmxfeCwgUFtgJHtwMn14YF0sIHRFKTsNCiAgICBQLnkgPSBxQihQW2Ake3AwfXlgXSwgUC5jdHJsX3ksIFBbYCR7cDJ9eWBdLCB0RSk7DQogICAgUC5yID0gbFIoUFtgJHtwMH1yYF0sIFBbYCR7cDJ9cmBdLCB0RSk7DQogICAgUC5nID0gbFIoUFtgJHtwMH1nYF0sIFBbYCR7cDJ9Z2BdLCB0RSk7DQogICAgUC5iID0gbFIoUFtgJHtwMH1iYF0sIFBbYCR7cDJ9YmBdLCB0RSk7DQogICAgQy5maWxsU3R5bGUgPSBgcmdiKCR7TWF0aC5yb3VuZChQLnIpfSwke01hdGgucm91bmQoUC5nKX0sJHtNYXRoLnJvdW5kKFAuYil9KWA7DQogICAgQy5maWxsUmVjdChNYXRoLnJvdW5kKFAueCksIE1hdGgucm91bmQoUC55KSwgMSwgMSk7DQogIH0pOw0KICBpZih0cnVlKXsNCiAgICBpZiAodEwgPCAxKSB7DQogICAgICBmQyArPSAxOw0KICAgICAgYUZJID0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFGKTsNCiAgICB9IGVsc2Ugew0KICAgICAgY2FuY2VsQW5pbWF0aW9uRnJhbWUoYUZJKTsNCiAgICAgIGZDID0gMDsNCiAgICAgIGRGSSh0UCk7DQogICAgICBsTlIoKTsNCiAgICB9DQogIH0NCn0NCmZ1bmN0aW9uIGRGSShwWCkgew0KICBDLmNsZWFyUmVjdCgwLCAwLCBDVywgQ0gpOw0KICBwWC5mb3JFYWNoKFAgPT4gew0KICAgIEMuZmlsbFN0eWxlID0gYHJnYigke1Aucn0sJHtQLmd9LCR7UC5ifSlgOw0KICAgIEMuZmlsbFJlY3QoUC54LCBQLnksIDEsIDEpOw0KICB9KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIGxOUigpIHsNCiAgY29uc3QgcEIgPSBnaVAoKTsNCiAgdHJ5IHsNCiAgICBjb25zdCBuVCA9IGF3YWl0IGxJUChwQik7DQogICAgcE5BKG5UKTsNCiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYUYpOw0KICB9IGNhdGNoIChlUikgew0KICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgbmV3IHRhcmdldCBpbWFnZToiLCBlUik7DQogICAgQy5maWxsU3R5bGUgPSAncmVkJzsNCiAgICBDLmZvbnQgPSAnOHB4IEFyaWFsJzsNCiAgICBDLmZpbGxUZXh0KCdJbWFnZSBMb2FkIEZhaWxlZC4nLCA1LCBDSCAvIDIpOw0KICB9DQp9DQphc3luYyBmdW5jdGlvbiBzdEEoKSB7DQogIHNDKCk7DQogIGNvbnN0IHBBID0gZ2lQKCk7DQogIGNvbnN0IHBCID0gZ2lQKCk7DQogIHRyeSB7DQogICAgY29uc3QgW3BYMSwgcFgyXSA9IGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgIGxJUChwQSksDQogICAgICBsSVAocEIpDQogICAgXSk7DQogICAgc1AgPSBwWDE7DQogICAgdFAgPSBwWDI7DQogICAgcE5BKHRQKTsNCiAgICBkRkkoc1ApOw0KICAgIHNldFRpbWVvdXQoKCkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFGKSwgMTUwMCk7DQogIH0gY2F0Y2ggKGVSKSB7DQogICAgY29uc29sZS5lcnJvcigiRXJyb3IgZHVyaW5nIGluaXRpYWwgaW1hZ2UgbG9hZGluZzoiLCBlUik7DQogIH0NCn0NCnN0QSgpOw0KDQoNCg0KDQogIDwvc2NyaXB0Pg0KDQo=<br>PGh0bWwgbGFuZz0iZW4iPg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPg0KICAgIDx0aXRsZT5VbnJlYWwgRHluYW1pY3MgSW1hZ2UgVHJhbnNpdGlvbjwvdGl0bGU+DQogICAgPHN0eWxlPg0KICAgICAgICAvKiBCYXNlIHN0eWxlcyAqLw0KDQoNCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICANCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgIA0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzExMTsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgDQogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdTZWdvZSBVSScsIFRhaG9tYSwgR2VuZXZhLCBWZXJkYW5hLCBzYW5zLXNlcmlmOw0KICAgICAgICAgICAgY29sb3I6ICNlZWU7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMvYmFja2dyb3VuZCBpbWFnZSAqLw0KICAgICAgICBjYW52YXMgew0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgYm9yZGVyOiAwcHggc29saWQgIzMzMzsNCiAgICAgICAgIA0KICAgICAgICB9DQogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovDQogICAgICAgICNhbmltYXRpb25DYW52YXMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7IC8qIEFjdHVhbCByZW5kZXJlZCBzaXplLCBtYXRjaGVzIEpTIGJyZWVkMzYwICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7IC8qIEFjdHVhbCByZW5kZXJlZCBzaXplLCBtYXRjaGVzIEpTIGhvb2cxODAgKi8NCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibGFjazsgLyogRW5zdXJlIGluaXRpYWwgYmxhY2sgY2FudmFzICovDQogICAgICAgIH0NCiAgICAgICAgaDEgew0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCiAgICAgICAgICAgIGNvbG9yOiAjMDBmZmZmOw0KICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggIzAwZmZmZiwgMCAwIDEwcHggIzAwZmZmZjsNCiAgICAgICAgfQ0KDQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KPGRpdiBpZD0nY2FudmFzJz4NCiAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48L2NhbnZhcz4NCjwvZGl2Pg0KPHNjcmlwdD4NCiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0NCiAgICAvLyBNYWtlIGltYWdlIGRpbWVuc2lvbnMgY29uc2lzdGVudCB3aXRoIGNhbnZhcyBkaXNwbGF5IGRpbWVuc2lvbnMNCiAgICBjb25zdCBJTUFHRV9ESVNQTEFZX1dJRFRIID0gODAwOw0KICAgIGNvbnN0IElNQUdFX0RJU1BMQVlfSEVJR0hUID0gNDUwOw0KDQogICAgdmFyIGN1cnJlbnRVUkwgPSBgaHR0cHM6Ly9waWNzdW0ucGhvdG9zLyR7SU1BR0VfRElTUExBWV9XSURUSH0vJHtJTUFHRV9ESVNQTEFZX0hFSUdIVH0/cmFuZG9tPWAgKyBNYXRoLnJvdW5kKDEwMDAwICogTWF0aC5yYW5kb20oKSk7DQogICAgdmFyIG5leHRVUkwgPSBgaHR0cHM6Ly9waWNzdW0ucGhvdG9zLyR7SU1BR0VfRElTUExBWV9XSURUSH0vJHtJTUFHRV9ESVNQTEFZX0hFSUdIVH0/cmFuZG9tPWAgKyBNYXRoLnJvdW5kKDEwMDAwICogTWF0aC5yYW5kb20oKSk7DQoNCiAgICAvLyBWYXJpYWJsZXMgdG8gaG9sZCB0aGUgKkFjdHVhbCBJbWFnZSBPYmplY3RzKiBmb3IgdGhlIGFuaW1hdGlvbg0KICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOyAvLyBJbWFnZSBBIChUaGUgU3RhcnQpDQogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpDQoNCiAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tDQogICAgdmFyIGNhbnZhc2JiaTsNCiAgICB2YXIgY3R4Ymk7DQogICAgdmFyIGltYWdlc2JpID0ge307ICAgICAgICAvLyBTdG9yZXMgQUxMIGxvYWRlZCBJbWFnZSBvYmplY3RzIChrZXllZCBieSBVUkwpDQoNCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDkwOyAgICAgICAgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3IgYSBzbW9vdGhlciwgbG9uZ2VyIHRyYW5zaXRpb24gKGUuZy4sIDMgc2Vjb25kcyBhdCAzMGZwcykNCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOw0KDQogICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIGNhbnZhcyBlbGVtZW50ICh1c2luZyBvcmlnaW5hbCBmcmFtZXdvcmsgdmFyaWFibGUgbmFtZXMpDQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgSU1BR0VfRElTUExBWV9XSURUSDsNCiAgICB2YXIgaG9vZzE4MCA9IElNQUdFX0RJU1BMQVlfSEVJR0hUOw0KDQogICAgLy8gTmV3IHZhcmlhYmxlcyBmb3IgdGhlIGJsb2NrLWJhc2VkIGFuaW1hdGlvbg0KICAgIHZhciBibG9ja1NpemUgPSAyMDsgLy8gU2l6ZSBvZiBlYWNoIHNxdWFyZSBibG9jayBmb3IgdGhlICJrdW5nIGZ1IiBlZmZlY3QNCiAgICB2YXIgbnVtQ29sczsNCiAgICB2YXIgbnVtUm93czsNCiAgICB2YXIgYmxvY2tzID0gW107IC8vIEFycmF5IHRvIHN0b3JlIGJsb2NrIGRhdGEgYW5kIHRoZWlyIGFuaW1hdGlvbiBwcm9wZXJ0aWVzDQoNCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0NCiAgICAvKioNCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuDQogICAgICovDQogICAgdmFyIGxvYWRJbWFnZWJiID0gKHNyYywgY2FsbGJhY2spID0+IHsNCiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOw0KICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgaW1hZ2VzYmlbc3JjXSA9IGltZzsNCiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7DQogICAgICAgIH07DQogICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOw0KICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcuc3JjID0gc3JjOw0KICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsgLy8gRXNzZW50aWFsIGZvciBsb2FkaW5nIGltYWdlcyBmcm9tIG90aGVyIGRvbWFpbnMgb250byBjYW52YXMNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgaW4gdGhlIHNlcXVlbmNlIGFuZCBzdGFydHMgdGhlIHRyYW5zaXRpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gbG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkgew0KICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOw0KDQogICAgICAgIC8vIElmIHRoZSBpbWFnZSBpcyBhbHJlYWR5IGNhY2hlZCwgdXNlIGl0IGltbWVkaWF0ZWx5DQogICAgICAgIGlmIChpbWFnZXNiaVtuZXdJbWFnZVVSTF0pIHsNCiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7IC8vIFN0YXJ0IHRyYW5zaXRpb24gb25jZSBuZXcgaW1hZ2UgaXMgbG9hZGVkDQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOw0KICAgICAgICAgICAgICAgICAgICAvLyBSZXRyeSBsb2FkaW5nIHRoZSBuZXh0IGltYWdlIGFmdGVyIGEgZGVsYXkgaWYgaXQgZmFpbGVkDQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGNhbnZhcyBhbmQgbG9hZHMgdGhlIGluaXRpYWwgdHdvIGltYWdlcyAoQSBhbmQgQikuDQogICAgICovDQogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsNCiAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOw0KICAgICAgICBjYW52YXNiYmkud2lkdGggPSBicmVlZDM2MDsNCiAgICAgICAgY2FudmFzYmJpLmhlaWdodCA9IGhvb2cxODA7DQogICAgICAgIGN0eGJpID0gY2FudmFzYmJpLmdldENvbnRleHQoJzJkJyk7DQoNCiAgICAgICAgLy8gQ2FsY3VsYXRlIG51bWJlciBvZiBibG9ja3MgYmFzZWQgb24gY2FudmFzIGRpbWVuc2lvbnMgYW5kIGJsb2NrIHNpemUNCiAgICAgICAgbnVtQ29scyA9IE1hdGguY2VpbChjYW52YXNiYmkud2lkdGggLyBibG9ja1NpemUpOw0KICAgICAgICBudW1Sb3dzID0gTWF0aC5jZWlsKGNhbnZhc2JiaS5oZWlnaHQgLyBibG9ja1NpemUpOw0KDQogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7DQogICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlOw0KDQogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yKSB7DQogICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbG9hZGVkQ291bnQrKzsNCiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA9PT0gaW1hZ2VzVG9Mb2FkLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzYmlbY3VycmVudFVSTF07DQogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25leHRVUkxdOw0KICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgdmVyeSBmaXJzdCBhbmltYXRpb24gKEEgLT4gQikNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlYmIoc3JjLCBvbkltYWdlTG9hZGVkKSk7DQogICAgfQ0KDQogICAgLy8gLS0tIEVhc2luZyBVdGlsaXRpZXMgLS0tDQogICAgLy8gVGhlIHBhcnNlUkdCQSBhbmQgaW50ZXJwb2xhdGVDb2xvciBmdW5jdGlvbnMgYXJlIG5vdCBzdHJpY3RseSB1c2VkIGluIHRoaXMgYmxvY2stZHJhd2luZyBhcHByb2FjaCwNCiAgICAvLyBidXQga2VwdCBhcyB0aGV5IHdlcmUgcGFydCBvZiB0aGUgb3JpZ2luYWwgZnJhbWV3b3JrLg0KICAgIHZhciBwYXJzZVJHQkEgPSAocmdiYVN0cmluZykgPT4gew0KICAgICAgICB2YXIgcGFydHMgPSByZ2JhU3RyaW5nLm1hdGNoKC9cZCsoXC5cZCspPy9nKS5tYXAoTnVtYmVyKTsNCiAgICAgICAgcmV0dXJuIHsgcjogcGFydHNbMF0sIGc6IHBhcnRzWzFdLCBiOiBwYXJ0c1syXSwgYTogcGFydHNbM10gfHwgMSB9Ow0KICAgIH07DQogICAgdmFyIGludGVycG9sYXRlQ29sb3IgPSAoY29sb3IxLCBjb2xvcjIsIHByb2dyZXNzKSA9PiB7DQogICAgICAgIHZhciBjMSA9IHBhcnNlUkdCQShjb2xvcjEpOw0KICAgICAgICB2YXIgYzIgPSBwYXJzZVJHQkEoY29sb3IyKTsNCiAgICAgICAgdmFyIHIgPSBNYXRoLnJvdW5kKGMxLnIgKyAoYzIuciAtIGMxLnIpICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgZyA9IE1hdGgucm91bmQoYzEuZyArIChjMi5nIC0gYzEuZykgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBiID0gTWF0aC5yb3VuZChjMS5iICsgKGMyLmIgLSBjMS5iKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGEgPSBjMS5hICsgKGMyLmEgLSBjMS5hKSAqIHByb2dyZXNzOw0KICAgICAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthfSlgOw0KICAgIH07DQogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0Ow0KDQogICAgLyoqDQogICAgICogU2V0cyB1cCB0aGUgaW5pdGlhbCBzdGF0ZSBmb3IgdGhlIGJsb2NrIGFuaW1hdGlvbi4NCiAgICAgKiBUaGlzIHByZXBhcmVzIGJsb2NrcyB3aXRoIHN0YXJ0L2VuZCBkYXRhIGZvciB0aGUgInVucmVhbCBkeW5hbWljcyIgdHJhbnNpdGlvbi4NCiAgICAgKi8NCiAgICB2YXIgc2V0dXBJbml0aWFsQ2FudmFzID0gKCkgPT4gew0KICAgICAgICAvLyBDbGVhciBjYW52YXMgYmVmb3JlIGRyYXdpbmcgYW55dGhpbmcgbmV3IHRvIHByZXZlbnQgaW5pdGlhbCBmbGlja2VyDQogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICBibG9ja3MgPSBbXTsgLy8gQ2xlYXIgcHJldmlvdXMgYmxvY2tzIGRhdGENCg0KICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IG51bVJvd3M7IHkrKykgew0KICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBudW1Db2xzOyB4KyspIHsNCiAgICAgICAgICAgICAgICBsZXQgYmxvY2tYID0geCAqIGJsb2NrU2l6ZTsNCiAgICAgICAgICAgICAgICBsZXQgYmxvY2tZID0geSAqIGJsb2NrU2l6ZTsNCiAgICAgICAgICAgICAgICBsZXQgd2lkdGggPSBNYXRoLm1pbihibG9ja1NpemUsIGNhbnZhc2JiaS53aWR0aCAtIGJsb2NrWCk7DQogICAgICAgICAgICAgICAgbGV0IGhlaWdodCA9IE1hdGgubWluKGJsb2NrU2l6ZSwgY2FudmFzYmJpLmhlaWdodCAtIGJsb2NrWSk7DQoNCiAgICAgICAgICAgICAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgY29udGludWU7IC8vIFNraXAgaWYgYmxvY2sgaXMgb3V0c2lkZSBjYW52YXMNCg0KICAgICAgICAgICAgICAgIC8vICJVbnJlYWwgZHluYW1pY3MiOiBibG9ja3Mgc3RhcnQgaGlnaGx5IGRpc3BsYWNlZCBhbmQgcm90YXRlZA0KICAgICAgICAgICAgICAgIGxldCBpbml0aWFsWE9mZnNldCA9IDA7DQogICAgICAgICAgICAgICAgbGV0IGluaXRpYWxZT2Zmc2V0ID0gMDsNCiAgICAgICAgICAgICAgICBsZXQgaW5pdGlhbFJvdGF0aW9uID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTWF0aC5QSSAqIDI7IC8vIFJhbmRvbSByb3RhdGlvbiBmcm9tIC0xODAgdG8gMTgwIGRlZ3JlZXMNCg0KICAgICAgICAgICAgICAgIC8vIFJhbmRvbWl6ZSBlbnRyeSBkaXJlY3Rpb24gKCJrdW5nIGZ1IGVmZmVjdCB0aGFpIGluIGRvZW4iKQ0KICAgICAgICAgICAgICAgIGxldCBkaXJlY3Rpb24gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0KTsgLy8gMD1sZWZ0LCAxPXJpZ2h0LCAyPXVwLCAzPWRvd24NCiAgICAgICAgICAgICAgICBjb25zdCBtYXhPZmZzZXQgPSBNYXRoLm1heChjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpICogMS41OyAvLyBTdGFydCBmYXIgb2ZmLXNjcmVlbg0KDQogICAgICAgICAgICAgICAgc3dpdGNoKGRpcmVjdGlvbikgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDA6IGluaXRpYWxYT2Zmc2V0ID0gLW1heE9mZnNldDsgYnJlYWs7IC8vIENvbWUgZnJvbSBmYXIgbGVmdA0KICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IGluaXRpYWxYT2Zmc2V0ID0gbWF4T2Zmc2V0OyBicmVhazsgIC8vIENvbWUgZnJvbSBmYXIgcmlnaHQNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAyOiBpbml0aWFsWU9mZnNldCA9IC1tYXhPZmZzZXQ7IGJyZWFrOyAvLyBDb21lIGZyb20gZmFyIHRvcA0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IGluaXRpYWxZT2Zmc2V0ID0gbWF4T2Zmc2V0OyBicmVhazsgIC8vIENvbWUgZnJvbSBmYXIgYm90dG9tDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gIlN1IFRhIGNoaSB0c2kgdHN1IFRoYSI6IFN0YWdnZXJlZCBlbnRyeSB3aXRoIHJhbmRvbWl6ZWQgZGVsYXkNCiAgICAgICAgICAgICAgICBsZXQgZGVsYXlGcmFtZXMgPSBNYXRoLnJhbmRvbSgpICogKHRvdGFsRnJhbWVzYmIgKiAwLjQpOyAvLyBTdGFnZ2VyIGJsb2NrcyBvdmVyIGZpcnN0IDQwJSBvZiBhbmltYXRpb24NCg0KICAgICAgICAgICAgICAgIGJsb2Nrcy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgLy8gU291cmNlIHJlY3RhbmdsZSBmcm9tIGBuZXh0SW1hZ2VgICh3aGF0IHBhcnQgb2YgdGhlIG5ldyBpbWFnZSB0byBkcmF3KQ0KICAgICAgICAgICAgICAgICAgICBzeDogYmxvY2tYLA0KICAgICAgICAgICAgICAgICAgICBzeTogYmxvY2tZLA0KICAgICAgICAgICAgICAgICAgICBzV2lkdGg6IHdpZHRoLA0KICAgICAgICAgICAgICAgICAgICBzSGVpZ2h0OiBoZWlnaHQsDQoNCiAgICAgICAgICAgICAgICAgICAgLy8gRGVzdGluYXRpb24gcmVjdGFuZ2xlIG9uIGNhbnZhcyAoZmluYWwgcG9zaXRpb24pDQogICAgICAgICAgICAgICAgICAgIGR4OiBibG9ja1gsDQogICAgICAgICAgICAgICAgICAgIGR5OiBibG9ja1ksDQogICAgICAgICAgICAgICAgICAgIGRXaWR0aDogd2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGRIZWlnaHQ6IGhlaWdodCwNCg0KICAgICAgICAgICAgICAgICAgICAvLyBBbmltYXRpb24gc3RhcnQgcHJvcGVydGllcyBmb3IgInVucmVhbCBkeW5hbWljcyINCiAgICAgICAgICAgICAgICAgICAgc3RhcnREWDogYmxvY2tYICsgaW5pdGlhbFhPZmZzZXQgKyAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBibG9ja1NpemUgKiAyLCAvLyBBZGQgc2xpZ2h0IHJhbmRvbSBqaXR0ZXINCiAgICAgICAgICAgICAgICAgICAgc3RhcnREWTogYmxvY2tZICsgaW5pdGlhbFlPZmZzZXQgKyAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBibG9ja1NpemUgKiAyLA0KICAgICAgICAgICAgICAgICAgICBzdGFydFJvdGF0aW9uOiBpbml0aWFsUm90YXRpb24sDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QWxwaGE6IDAsIC8vIEJsb2NrcyBvZiBuZXcgaW1hZ2Ugc3RhcnQgaW52aXNpYmxlDQoNCiAgICAgICAgICAgICAgICAgICAgLy8gQW5pbWF0aW9uIGVuZCBwcm9wZXJ0aWVzDQogICAgICAgICAgICAgICAgICAgIGVuZERYOiBibG9ja1gsDQogICAgICAgICAgICAgICAgICAgIGVuZERZOiBibG9ja1ksDQogICAgICAgICAgICAgICAgICAgIGVuZFJvdGF0aW9uOiAwLCAvLyBGaW5hbCByb3RhdGlvbiBpcyBzdHJhaWdodA0KICAgICAgICAgICAgICAgICAgICBlbmRBbHBoYTogMSwgICAgLy8gRmluYWwgYWxwaGEgaXMgb3BhcXVlDQoNCiAgICAgICAgICAgICAgICAgICAgZGVsYXk6IGRlbGF5RnJhbWVzLA0KICAgICAgICAgICAgICAgICAgICBhbmltYXRpb25EdXJhdGlvbjogdG90YWxGcmFtZXNiYiAtIGRlbGF5RnJhbWVzIC8vIEVhY2ggYmxvY2sgYW5pbWF0ZXMgZm9yIHRoZSByZW1haW5pbmcgdGltZSBhZnRlciBpdHMgZGVsYXkNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIERyYXcgdGhlIGN1cnJlbnQgaW1hZ2UgZnVsbHkgYXQgdGhlIHN0YXJ0IHRvIHByZXZlbnQgYSBibGFuayBmcmFtZQ0KICAgICAgICBjdHhiaS5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUaGUgbWFpbiBhbmltYXRpb24gbG9vcC4NCiAgICAgKiBJdCBoYW5kbGVzIHRoZSBmYWRpbmcgb3V0IG9mIHRoZSBjdXJyZW50IGltYWdlIGFuZCB0aGUgYW5pbWF0ZWQgZW50cnkgb2YgdGhlIG5ldyBpbWFnZSdzIGJsb2Nrcy4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgLy8gLS0tIFBoYXNlIDE6IEN1cnJlbnQgaW1hZ2UgKCJJIHNtb2tlIFRpbGwgSSBTbGlwIikgLS0tDQogICAgICAgIC8vIEN1cnJlbnQgaW1hZ2UgZmFkZXMgb3V0IGFuZCBnZXRzIGEgc3VidGxlIGJsdXIvZGlzdG9ydGlvbg0KICAgICAgICBsZXQgZmFkZU91dFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQoY3VycmVudEZyYW1lYmIgLyAodG90YWxGcmFtZXNiYiAqIDAuNikpOyAvLyBGYWRlIG91dCBvdmVyIGZpcnN0IDYwJSBvZiBhbmltYXRpb24NCiAgICAgICAgaWYgKGZhZGVPdXRQcm9ncmVzcyA8IDEpIHsgLy8gT25seSBkcmF3IGlmIG5vdCBmdWxseSBmYWRlZA0KICAgICAgICAgICAgY3R4Ymkuc2F2ZSgpOw0KICAgICAgICAgICAgY3R4YmkuZ2xvYmFsQWxwaGEgPSBNYXRoLm1heCgwLCAxIC0gZmFkZU91dFByb2dyZXNzKTsgLy8gQWxwaGEgZGVjcmVhc2VzDQogICAgICAgICAgICBjdHhiaS5maWx0ZXIgPSBgYmx1cigke2ZhZGVPdXRQcm9ncmVzcyAqIDV9cHgpIGh1ZS1yb3RhdGUoJHtmYWRlT3V0UHJvZ3Jlc3MgKiAzMH1kZWcpYDsgLy8gQXBwbHkgYmx1ciBhbmQgY29sb3Igc2hpZnQNCiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICBjdHhiaS5yZXN0b3JlKCk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyAtLS0gUGhhc2UgMjogTmV4dCBpbWFnZSBibG9ja3MgKCJSYWhtYW4gS3VuZnUgZWZmZWN0IHRoYWkgaW4gZG9lbiIpIC0tLQ0KICAgICAgICAvLyBCbG9ja3Mgb2YgdGhlIG5leHQgaW1hZ2UgbW92ZSwgcm90YXRlLCBhbmQgZmFkZSBpbiB3aXRoIHN0YWdnZXJlZCB0aW1pbmcNCiAgICAgICAgYmxvY2tzLmZvckVhY2goYmxvY2sgPT4gew0KICAgICAgICAgICAgbGV0IGJsb2NrQ3VycmVudEZyYW1lID0gY3VycmVudEZyYW1lYmIgLSBibG9jay5kZWxheTsNCiAgICAgICAgICAgIGlmIChibG9ja0N1cnJlbnRGcmFtZSA8IDApIHJldHVybjsgLy8gQmxvY2sgbm90IHlldCBzdGFydGVkIGFuaW1hdGluZw0KDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgcHJvZ3Jlc3MgZm9yIHRoaXMgaW5kaXZpZHVhbCBibG9jaw0KICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gTWF0aC5taW4oMSwgYmxvY2tDdXJyZW50RnJhbWUgLyBibG9jay5hbmltYXRpb25EdXJhdGlvbik7DQogICAgICAgICAgICBsZXQgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsNCg0KICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgcHJvcGVydGllcyBiYXNlZCBvbiBlYXNlZCBwcm9ncmVzcw0KICAgICAgICAgICAgbGV0IGR4ID0gYmxvY2suc3RhcnREWCArIChibG9jay5lbmREWCAtIGJsb2NrLnN0YXJ0RFgpICogZWFzZWRQcm9ncmVzczsNCiAgICAgICAgICAgIGxldCBkeSA9IGJsb2NrLnN0YXJ0RFkgKyAoYmxvY2suZW5kRFkgLSBibG9jay5zdGFydERZKSAqIGVhc2VkUHJvZ3Jlc3M7DQogICAgICAgICAgICBsZXQgcm90YXRpb24gPSBibG9jay5zdGFydFJvdGF0aW9uICsgKGJsb2NrLmVuZFJvdGF0aW9uIC0gYmxvY2suc3RhcnRSb3RhdGlvbikgKiBlYXNlZFByb2dyZXNzOw0KICAgICAgICAgICAgbGV0IGFscGhhID0gYmxvY2suc3RhcnRBbHBoYSArIChibG9jay5lbmRBbHBoYSAtIGJsb2NrLnN0YXJ0QWxwaGEpICogZWFzZWRQcm9ncmVzczsNCg0KICAgICAgICAgICAgY3R4Ymkuc2F2ZSgpOw0KICAgICAgICAgICAgY3R4YmkuZ2xvYmFsQWxwaGEgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBhbHBoYSkpOyAvLyBDbGFtcCBhbHBoYSBiZXR3ZWVuIDAgYW5kIDENCg0KICAgICAgICAgICAgLy8gQXBwbHkgdHJhbnNmb3JtYXRpb25zOiB0cmFuc2xhdGUgdG8gYmxvY2sgY2VudGVyLCByb3RhdGUsIHRoZW4gdHJhbnNsYXRlIGJhY2sNCiAgICAgICAgICAgIGN0eGJpLnRyYW5zbGF0ZShkeCArIGJsb2NrLmRXaWR0aCAvIDIsIGR5ICsgYmxvY2suZEhlaWdodCAvIDIpOw0KICAgICAgICAgICAgY3R4Ymkucm90YXRlKHJvdGF0aW9uKTsNCiAgICAgICAgICAgIGN0eGJpLnRyYW5zbGF0ZSgtKGR4ICsgYmxvY2suZFdpZHRoIC8gMiksIC0oZHkgKyBibG9jay5kSGVpZ2h0IC8gMikpOw0KDQogICAgICAgICAgICAvLyBEcmF3IHRoZSBzZWdtZW50IG9mIHRoZSBuZXh0IGltYWdlIG9udG8gdGhlIGNhbnZhcw0KICAgICAgICAgICAgY3R4YmkuZHJhd0ltYWdlKG5leHRJbWFnZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jay5zeCwgYmxvY2suc3ksIGJsb2NrLnNXaWR0aCwgYmxvY2suc0hlaWdodCwgLy8gU291cmNlIHJlY3RhbmdsZSAoZnJvbSBuZXh0SW1hZ2UpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZHgsIGR5LCBibG9jay5kV2lkdGgsIGJsb2NrLmRIZWlnaHQpOyAgICAgICAgICAgLy8gRGVzdGluYXRpb24gcmVjdGFuZ2xlIChvbiBjYW52YXMpDQogICAgICAgICAgICBjdHhiaS5yZXN0b3JlKCk7DQogICAgICAgIH0pOw0KDQoNCiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgew0KICAgICAgICAgICAgY3VycmVudEZyYW1lYmIrKzsNCiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShBTklNQVRFKTsgLy8gQ29udGludWUgYW5pbWF0aW9uIGxvb3ANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4gUHJlcGFyZSB0aGUgbmV4dCByb3VuZCAoQiAtPiBDKS4NCg0KICAgICAgICAgICAgLy8gMS4gRW5zdXJlIHRoZSBmaW5hbCBpbWFnZSAoQikgaXMgZHJhd24gcGVyZmVjdGx5IGF0IHRoZSBlbmQgb2YgdGhlIHRyYW5zaXRpb24uDQogICAgICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgICAgIC8vIDIuIFNXQVAgT0JKRUNUUzogVGhlIG9sZCB0YXJnZXQgaW1hZ2Ugb2JqZWN0IChCKSBpcyB0aGUgbmV3IHN0YXJ0IGltYWdlIG9iamVjdCAoQSkuDQogICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7DQoNCiAgICAgICAgICAgIC8vIDMuIFNXQVAgVVJMUzogVGhlIG9sZCB0YXJnZXQgVVJMIChCKSBpcyB0aGUgbmV3IHN0YXJ0IFVSTCAoQSkuDQogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsNCg0KICAgICAgICAgICAgLy8gNC4gR0VORVJBVEUgTkVXIFRBUkdFVCBVUkwgKEMpIHdpdGggYSBuZXcgcmFuZG9tIHBhcmFtZXRlciB0byBlbnN1cmUgZnJlc2ggaW1hZ2VzDQogICAgICAgICAgICBuZXh0VVJMID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy8ke0lNQUdFX0RJU1BMQVlfV0lEVEh9LyR7SU1BR0VfRElTUExBWV9IRUlHSFR9P3JhbmRvbT1gICsgTWF0aC5yb3VuZCgxMDAwMCAqIE1hdGgucmFuZG9tKCkpOw0KDQogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuIE5vIGRlbGF5IG5lZWRlZCBoZXJlLg0KICAgICAgICAgICAgc2V0VGltZW91dCgibG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkiLCAxNTAwKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhbmltYXRpb24gdmFyaWFibGVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOyAvLyBSZXNldCBmcmFtZSBjb3VudGVyIGZvciBuZXcgYW5pbWF0aW9uDQogICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOyAvLyBQcmVwYXJlIGJsb2NrcyBmb3IgdGhlIG5ldyB0cmFuc2l0aW9uDQogICAgICAgIEFOSU1BVEUoKTsgLy8gU3RhcnQgdGhlIGFuaW1hdGlvbiBsb29wDQogICAgfTsNCg0KICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tDQogICAgLy8gVGhpcyBmdW5jdGlvbiBydW5zIG9uY2UgdGhlIGVudGlyZSBwYWdlIGlzIGxvYWRlZA0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOw0KICAgIH07DQo8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=<br>PGh0bWwgbGFuZz0iZW4iPjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+VW5yZWFsIExlZGVubWFhdHNwcmluZ2VyIFRyYW5zaXRpb248L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgIH0NCg0KICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMvYmFja2dyb3VuZCBpbWFnZSAqLw0KICAgICAgICAjY2FudmFzIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyAvKiBBbGlnbmVkIHdpdGggSlMgYnJlZWQzNjAgKi8NCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsgLyogQWxpZ25lZCB3aXRoIEpTIGhvb2cxODAgKi8NCiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOw0KICAgICAgICAgICAgLyogT3B0aW9uYWw6IEFkZCBhIHN1YnRsZSBib3JkZXIgb3Igc2hhZG93IHRvIHRoZSBjb250YWluZXIgKi8NCiAgICAgIA0KICAgICAgICB9DQogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovDQogICAgICAgICNhbmltYXRpb25DYW52YXMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7IC8qIEVuc3VyZSBpdCBzdGFydHMgYmxhY2sgYmVmb3JlIGZpcnN0IGltYWdlIGxvYWRzICovDQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KPC9oZWFkPg0KPGJvZHk+DQo8ZGl2IGlkPSJjYW52YXMiPg0KICAgIDxjYW52YXMgaWQ9ImFuaW1hdGlvbkNhbnZhcyIgd2lkdGg9IjY0MCIgaGVpZ2h0PSI2NDAiPjwvY2FudmFzPg0KPC9kaXY+DQo8c2NyaXB0Pg0KICAgIC8vIC0tLSBJbWFnZSBTb3VyY2UgYW5kIE9iamVjdCBTdG9yYWdlIC0tLQ0KICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqVVJMKiBvZiB0aGUgY3VycmVudGx5IGxvYWRlZCBpbWFnZSBzZXQNCiAgICAvLyBVcGRhdGVkIHBpY3N1bS5waG90b3MgVVJMcyB0byBtYXRjaCB0aGUgY29udGFpbmVyIGRpbWVuc2lvbnMNCiAgICB2YXIgY3VycmVudFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQogICAgdmFyIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpBY3R1YWwgSW1hZ2UgT2JqZWN0cyogZm9yIHRoZSBhbmltYXRpb24NCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KQ0KICAgIHZhciBuZXh0SW1hZ2UgPSBudWxsOyAgICAvLyBJbWFnZSBCIChUaGUgVGFyZ2V0KQ0KDQogICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQ0KICAgIHZhciBjYW52YXNiYmk7DQogICAgdmFyIGN0eGJpOw0KICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQ0KDQogICAgLy8gQXJyYXkgdG8gc3RvcmUgb3VyIHBpeGVsIGJsb2NrcyBmb3IgdGhlICdzaGF0dGVyIGFuZCByZWZvcm0nIGVmZmVjdA0KICAgIHZhciBwaXhlbEJsb2NrcyA9IFtdOw0KDQogICAgdmFyIHRvdGFsRnJhbWVzYmIgPSA4MDsgICAgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3IgYSBzbW9vdGhlciwgbW9yZSBjb21wbGV4IHRyYW5zaXRpb24NCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOw0KDQogICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIGNhbnZhcyBlbGVtZW50IC0gQUxJR05FRCBXSVRIIEhUTUwgQ09OVEFJTkVSDQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8NCiAgICB2YXIgaG9vZzE4MCA9IDQ1MDsgLy8NCg0KICAgIC8vIC0tLSBQaXhlbCBCbG9jayBBbmltYXRpb24gU2V0dGluZ3MgLS0tDQogICAgdmFyIGJsb2NrU2l6ZSA9IDIwOyAvLyBTaXplIG9mIGVhY2ggc3F1YXJlICdwaXhlbCBibG9jaycgZm9yIHRoZSBlZmZlY3QuIEFkanVzdCBmb3IgcGVyZm9ybWFuY2UgdnMgZGV0YWlsLg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gU21hbGxlciA9IG1vcmUgZGV0YWlsLCBwb3RlbnRpYWxseSBzbG93ZXIuIExhcmdlciA9IGZhc3RlciwgbW9yZSBhYnN0cmFjdC4NCg0KICAgIC8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQ0KICAgIC8qKg0KICAgICAqIExvYWRzIGEgc2luZ2xlIGltYWdlIGludG8gdGhlIGltYWdlc2JpIG1hcC4NCiAgICAgKi8NCiAgICB2YXIgbG9hZEltYWdlYmIgPSAoc3JjLCBjYWxsYmFjaykgPT4gew0KICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7DQogICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICBpbWFnZXNiaVtzcmNdID0gaW1nOw0KICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgaW1nKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCk7DQogICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKSk7DQogICAgICAgIH07DQogICAgICAgIGltZy5zcmMgPSBzcmM7DQogICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBMb2FkcyB0aGUgbmV4dCBpbWFnZSBpbiB0aGUgc2VxdWVuY2UgYW5kIHN0YXJ0cyB0aGUgdHJhbnNpdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7DQogICAgICAgIGxldCBuZXdJbWFnZVVSTCA9IG5leHRVUkw7DQogICAgICAgIGlmIChpbWFnZXNiaVtuZXdJbWFnZVVSTF0pIHsNCiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7DQogICAgICAgIC8vIEluaXRpYWxpemUgY2FudmFzIE9OTFkgT05DRQ0KICAgICAgICBjYW52YXNiYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7DQogICAgICAgIGNhbnZhc2JiaS53aWR0aCA9IGJyZWVkMzYwOw0KICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgY3R4YmkgPSBjYW52YXNiYmkuZ2V0Q29udGV4dCgnMmQnKTsNCg0KICAgICAgICBsZXQgaW1hZ2VzVG9Mb2FkID0gW2N1cnJlbnRVUkwsIG5leHRVUkxdOw0KICAgICAgICBsZXQgbG9hZGVkQ291bnQgPSAwOw0KICAgICAgICBsZXQgaGFzRXJyb3IgPSBmYWxzZTsNCg0KICAgICAgICBjb25zdCBvbkltYWdlTG9hZGVkID0gKGVycm9yLCBpbWcpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7DQogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc2JpW2N1cnJlbnRVUkxdOw0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXh0VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgICAgICAvLyBPcHRpb25hbGx5LCBkaXNwbGF5IGEgcGxhY2Vob2xkZXIgb3IgcmV0cnkgbG9hZGluZw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgIH0NCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICB2YXIgcGFyc2VSR0JBID0gKHJnYmFTdHJpbmcpID0+IHsNCiAgICAgICAgLy8gSGFuZGxlIGNhc2VzIGxpa2UgInJnYihyLGcsYikiIGFzIHdlbGwsIGFzc3VtaW5nIGFscGhhIG9mIDENCiAgICAgICAgdmFyIHBhcnRzID0gcmdiYVN0cmluZy5tYXRjaCgvXGQrKFwuXGQrKT8vZykubWFwKE51bWJlcik7DQogICAgICAgIHJldHVybiB7IHI6IHBhcnRzWzBdLCBnOiBwYXJ0c1sxXSwgYjogcGFydHNbMl0sIGE6IHBhcnRzWzNdICE9PSB1bmRlZmluZWQgPyBwYXJ0c1szXSA6IDEgfTsNCiAgICB9Ow0KDQogICAgdmFyIGludGVycG9sYXRlQ29sb3IgPSAoY29sb3IxLCBjb2xvcjIsIHByb2dyZXNzKSA9PiB7DQogICAgICAgIHZhciBjMSA9IHBhcnNlUkdCQShjb2xvcjEpOw0KICAgICAgICB2YXIgYzIgPSBwYXJzZVJHQkEoY29sb3IyKTsNCiAgICAgICAgdmFyIHIgPSBNYXRoLnJvdW5kKGMxLnIgKyAoYzIuciAtIGMxLnIpICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgZyA9IE1hdGgucm91bmQoYzEuZyArIChjMi5nIC0gYzEuZykgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBiID0gTWF0aC5yb3VuZChjMS5iICsgKGMyLmIgLSBjMS5iKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGEgPSBjMS5hICsgKGMyLmEgLSBjMS5hKSAqIHByb2dyZXNzOyAvLyBBbHBoYSBpbnRlcnBvbGF0aW9uDQogICAgICAgIHJldHVybiBgcmdiYSgke3J9LCAke2d9LCAke2J9LCAke2F9KWA7DQogICAgfTsNCg0KICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsNCg0KICAgIC8qKg0KICAgICAqIEhlbHBlciB0byBnZXQgdGhlIGF2ZXJhZ2UgY29sb3Igb2YgYSBibG9jayBmcm9tIGltYWdlIGRhdGEuDQogICAgICogVXNlZCBpbiBzZXR1cEluaXRpYWxDYW52YXMgdG8gZGV0ZXJtaW5lIGJsb2NrJ3Mgc3RhcnQvdGFyZ2V0IGNvbG9ycy4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRBdmVyYWdlQ29sb3IoaW1hZ2VEYXRhLCBibG9ja1gsIGJsb2NrWSwgaW1nV2lkdGgsIGltZ0hlaWdodCwgY3VycmVudEJsb2NrV2lkdGgsIGN1cnJlbnRCbG9ja0hlaWdodCkgew0KICAgICAgICBsZXQgciA9IDAsIGcgPSAwLCBiID0gMCwgYSA9IDAsIGNvdW50ID0gMDsNCiAgICAgICAgZm9yIChsZXQgeSA9IGJsb2NrWTsgeSA8IGJsb2NrWSArIGN1cnJlbnRCbG9ja0hlaWdodCAmJiB5IDwgaW1nSGVpZ2h0OyB5KyspIHsNCiAgICAgICAgICAgIGZvciAobGV0IHggPSBibG9ja1g7IHggPCBibG9ja1ggKyBjdXJyZW50QmxvY2tXaWR0aCAmJiB4IDwgaW1nV2lkdGg7IHgrKykgew0KICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gKHkgKiBpbWdXaWR0aCArIHgpICogNDsNCiAgICAgICAgICAgICAgICByICs9IGltYWdlRGF0YVtpbmRleF07DQogICAgICAgICAgICAgICAgZyArPSBpbWFnZURhdGFbaW5kZXggKyAxXTsNCiAgICAgICAgICAgICAgICBiICs9IGltYWdlRGF0YVtpbmRleCArIDJdOw0KICAgICAgICAgICAgICAgIGEgKz0gaW1hZ2VEYXRhW2luZGV4ICsgM107DQogICAgICAgICAgICAgICAgY291bnQrKzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoY291bnQgPT09IDApIHJldHVybiAncmdiYSgwLDAsMCwwKSc7IC8vIFJldHVybiB0cmFuc3BhcmVudCBibGFjayBpZiBubyBwaXhlbHMNCiAgICAgICAgcmV0dXJuIGByZ2JhKCR7TWF0aC5yb3VuZChyIC8gY291bnQpfSwgJHtNYXRoLnJvdW5kKGcgLyBjb3VudCl9LCAke01hdGgucm91bmQoYiAvIGNvdW50KX0sICR7YSAvIGNvdW50IC8gMjU1fSlgOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIHRoZSBwaXhlbEJsb2NrcyBhcnJheSB3aXRoIHN0YXJ0L3RhcmdldCBjb2xvcnMgYW5kIHJhbmRvbSB0cmFuc2l0aW9uIHByb3BlcnRpZXMuDQogICAgICovDQogICAgdmFyIHNldHVwSW5pdGlhbENhbnZhcyA9ICgpID0+IHsNCiAgICAgICAgdmFyIGltZzEgPSBjdXJyZW50SW1hZ2U7IC8vIFRoZSBzdGFydCBpbWFnZQ0KICAgICAgICB2YXIgaW1nMiA9IG5leHRJbWFnZTsgICAgLy8gVGhlIHRhcmdldCBpbWFnZQ0KDQogICAgICAgIHBpeGVsQmxvY2tzID0gW107IC8vIENsZWFyIHByZXZpb3VzIGJsb2NrcyBmb3IgYSBuZXcgdHJhbnNpdGlvbg0KDQogICAgICAgIC8vIENyZWF0ZSB0ZW1wb3JhcnkgY2FudmFzZXMgdG8gZXh0cmFjdCBwaXhlbCBkYXRhIGZyb20gYm90aCBpbWFnZXMNCiAgICAgICAgdmFyIHRlbXBDYW52YXMxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4MSA9IHRlbXBDYW52YXMxLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgIHRlbXBDYW52YXMxLndpZHRoID0gY2FudmFzYmJpLndpZHRoOw0KICAgICAgICB0ZW1wQ2FudmFzMS5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0Ow0KICAgICAgICB0ZW1wQ3R4MS5kcmF3SW1hZ2UoaW1nMSwgMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgdmFyIGRhdGExID0gdGVtcEN0eDEuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsNCg0KICAgICAgICB2YXIgdGVtcENhbnZhczIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgdmFyIHRlbXBDdHgyID0gdGVtcENhbnZhczIuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgdGVtcENhbnZhczIud2lkdGggPSBjYW52YXNiYmkud2lkdGg7DQogICAgICAgIHRlbXBDYW52YXMyLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7DQogICAgICAgIHRlbXBDdHgyLmRyYXdJbWFnZShpbWcyLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICB2YXIgZGF0YTIgPSB0ZW1wQ3R4Mi5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOw0KDQogICAgICAgIC8vIFBvcHVsYXRlIHBpeGVsQmxvY2tzIHdpdGggZGF0YSBmb3IgZWFjaCBibG9jaw0KICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGNhbnZhc2JiaS5oZWlnaHQ7IHkgKz0gYmxvY2tTaXplKSB7DQogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGNhbnZhc2JiaS53aWR0aDsgeCArPSBibG9ja1NpemUpIHsNCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmxvY2tXaWR0aCA9IE1hdGgubWluKGJsb2NrU2l6ZSwgY2FudmFzYmJpLndpZHRoIC0geCk7DQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEJsb2NrSGVpZ2h0ID0gTWF0aC5taW4oYmxvY2tTaXplLCBjYW52YXNiYmkuaGVpZ2h0IC0geSk7DQoNCiAgICAgICAgICAgICAgICBjb25zdCBzdGFydENvbG9yID0gZ2V0QXZlcmFnZUNvbG9yKGRhdGExLCB4LCB5LCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQsIGN1cnJlbnRCbG9ja1dpZHRoLCBjdXJyZW50QmxvY2tIZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldENvbG9yID0gZ2V0QXZlcmFnZUNvbG9yKGRhdGEyLCB4LCB5LCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQsIGN1cnJlbnRCbG9ja1dpZHRoLCBjdXJyZW50QmxvY2tIZWlnaHQpOw0KDQogICAgICAgICAgICAgICAgLy8gUmFuZG9tIGluaXRpYWwgb2Zmc2V0OiBCbG9ja3MgZmx5IG91dCBmcm9tIHRoZWlyIG9yaWdpbmFsIHBvc2l0aW9uDQogICAgICAgICAgICAgICAgLy8gVGhlIHZhbHVlcyAoZS5nLiwgKiBjYW52YXNiYmkud2lkdGggKiAwLjUpIGRldGVybWluZSB0aGUgbWF4IHNjYXR0ZXIgZGlzdGFuY2UNCiAgICAgICAgICAgICAgICBjb25zdCBpbml0aWFsT2Zmc2V0WCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGNhbnZhc2JiaS53aWR0aCAqIDAuODsNCiAgICAgICAgICAgICAgICBjb25zdCBpbml0aWFsT2Zmc2V0WSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGNhbnZhc2JiaS5oZWlnaHQgKiAwLjg7DQoNCiAgICAgICAgICAgICAgICAvLyBSYW5kb20gZGVsYXkgYmVmb3JlIGEgYmxvY2sgc3RhcnRzIGFuaW1hdGluZyAoMCB0byA1MCUgb2Ygb3ZlcmFsbCBhbmltYXRpb24pDQogICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tRGVsYXkgPSBNYXRoLnJhbmRvbSgpICogMC41Ow0KICAgICAgICAgICAgICAgIC8vIFJhbmRvbSBmYWN0b3IgYWZmZWN0aW5nIGhvdyBxdWlja2x5IGEgYmxvY2sgY29tcGxldGVzIGl0cyBhbmltYXRpb24gb25jZSBzdGFydGVkICgwLjUgdG8gMS4wKQ0KICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRvbUR1cmF0aW9uRmFjdG9yID0gMC41ICsgTWF0aC5yYW5kb20oKSAqIDAuNTsNCg0KICAgICAgICAgICAgICAgIC8vIFJhbmRvbSByb3RhdGlvbiBhbmQgc2NhbGUgZm9yIGEgbW9yZSAidW5yZWFsIiBhbmQgY2hhb3RpYyBlZmZlY3QNCiAgICAgICAgICAgICAgICBjb25zdCByb3RhdGlvblN0YXJ0ID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyOyAvLyBGdWxsIGNpcmNsZSBpbml0aWFsIHJvdGF0aW9uDQogICAgICAgICAgICAgICAgY29uc3Qgcm90YXRpb25FbmQgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDQ7ICAgLy8gVHdvIGZ1bGwgY2lyY2xlcyBkdXJpbmcgdHJhbnNpdGlvbg0KICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlU3RhcnQgPSAwLjIgKyBNYXRoLnJhbmRvbSgpICogMC44OyAgICAgIC8vIEJsb2NrcyBjYW4gc3RhcnQgc21hbGxlciBvciBhbG1vc3QgZnVsbCBzaXplDQogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVFbmQgPSAxLjA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBbHdheXMgZW5kIGF0IGZ1bGwgc2NhbGUNCg0KICAgICAgICAgICAgICAgIHBpeGVsQmxvY2tzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICB4OiB4LA0KICAgICAgICAgICAgICAgICAgICB5OiB5LA0KICAgICAgICAgICAgICAgICAgICB3aWR0aDogY3VycmVudEJsb2NrV2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodDogY3VycmVudEJsb2NrSGVpZ2h0LA0KICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yOiBzdGFydENvbG9yLA0KICAgICAgICAgICAgICAgICAgICB0YXJnZXRDb2xvcjogdGFyZ2V0Q29sb3IsDQogICAgICAgICAgICAgICAgICAgIGluaXRpYWxPZmZzZXRYOiBpbml0aWFsT2Zmc2V0WCwNCiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbE9mZnNldFk6IGluaXRpYWxPZmZzZXRZLA0KICAgICAgICAgICAgICAgICAgICByYW5kb21EZWxheTogcmFuZG9tRGVsYXksDQogICAgICAgICAgICAgICAgICAgIHJhbmRvbUR1cmF0aW9uRmFjdG9yOiByYW5kb21EdXJhdGlvbkZhY3RvciwNCiAgICAgICAgICAgICAgICAgICAgcm90YXRpb25TdGFydDogcm90YXRpb25TdGFydCwNCiAgICAgICAgICAgICAgICAgICAgcm90YXRpb25FbmQ6IHJvdGF0aW9uRW5kLA0KICAgICAgICAgICAgICAgICAgICBzY2FsZVN0YXJ0OiBzY2FsZVN0YXJ0LA0KICAgICAgICAgICAgICAgICAgICBzY2FsZUVuZDogc2NhbGVFbmQsDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AsIGRyYXdpbmcgZWFjaCBwaXhlbCBibG9jayBmcmFtZSBieSBmcmFtZS4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7IC8vIENsZWFyIHRoZSBlbnRpcmUgY2FudmFzIGVhY2ggZnJhbWUNCg0KICAgICAgICAvLyBDYWxjdWxhdGUgb3ZlcmFsbCBhbmltYXRpb24gcHJvZ3Jlc3MsIGVhc2VkIGZvciBzbW9vdGggc3RhcnQvZW5kDQogICAgICAgIGNvbnN0IG92ZXJhbGxQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KGN1cnJlbnRGcmFtZWJiIC8gdG90YWxGcmFtZXNiYik7DQoNCiAgICAgICAgcGl4ZWxCbG9ja3MuZm9yRWFjaChibG9jayA9PiB7DQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgaW5kaXZpZHVhbCBwcm9ncmVzcyBmb3IgdGhpcyBibG9jaywgY29uc2lkZXJpbmcgaXRzIGRlbGF5IGFuZCBkdXJhdGlvbiBmYWN0b3INCiAgICAgICAgICAgIGxldCBpbmRpdmlkdWFsUHJvZ3Jlc3MgPSAob3ZlcmFsbFByb2dyZXNzIC0gYmxvY2sucmFuZG9tRGVsYXkpIC8gYmxvY2sucmFuZG9tRHVyYXRpb25GYWN0b3I7DQogICAgICAgICAgICAvLyBDbGFtcCBwcm9ncmVzcyBiZXR3ZWVuIDAgYW5kIDEgdG8gZW5zdXJlIGl0IGRvZXNuJ3QgZ28gbmVnYXRpdmUgb3IgYWJvdmUgMQ0KICAgICAgICAgICAgaW5kaXZpZHVhbFByb2dyZXNzID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgaW5kaXZpZHVhbFByb2dyZXNzKSk7DQoNCiAgICAgICAgICAgIC8vIElmIHRoZSBibG9jaydzIGluZGl2aWR1YWwgYW5pbWF0aW9uIGhhc24ndCBzdGFydGVkIHlldCwgZHJhdyBpdCBpbiBpdHMgc3RhdGljIGluaXRpYWwgc3RhdGUNCiAgICAgICAgICAgIC8vIFRoaXMgZW5zdXJlcyB0aGUgY3VycmVudEltYWdlIGlzIGZ1bGx5IHZpc2libGUgYmVmb3JlIGNodW5rcyBzdGFydCBtb3ZpbmcuDQogICAgICAgICAgICBpZiAoaW5kaXZpZHVhbFByb2dyZXNzIDw9IDApIHsNCiAgICAgICAgICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBibG9jay5zdGFydENvbG9yOw0KICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KGJsb2NrLngsIGJsb2NrLnksIGJsb2NrLndpZHRoLCBibG9jay5oZWlnaHQpOw0KICAgICAgICAgICAgICAgIHJldHVybjsgLy8gTW92ZSB0byB0aGUgbmV4dCBibG9jaw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBjb2xvciBiYXNlZCBvbiBpbmRpdmlkdWFsIHByb2dyZXNzDQogICAgICAgICAgICBjb25zdCBjdXJyZW50Q29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKGJsb2NrLnN0YXJ0Q29sb3IsIGJsb2NrLnRhcmdldENvbG9yLCBpbmRpdmlkdWFsUHJvZ3Jlc3MpOw0KDQogICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBwb3NpdGlvbjogZnJvbSBpbml0aWFsIG9mZnNldCAoc2NhdHRlcmVkKSBiYWNrIHRvIG9yaWdpbmFsIHgseSAocmVhc3NlbWJsZWQpDQogICAgICAgICAgICAvLyBBdCBpbmRpdmlkdWFsUHJvZ3Jlc3M9MCwgY3VycmVudFggPSBibG9jay54ICsgYmxvY2suaW5pdGlhbE9mZnNldFggKHNjYXR0ZXJlZCkNCiAgICAgICAgICAgIC8vIEF0IGluZGl2aWR1YWxQcm9ncmVzcz0xLCBjdXJyZW50WCA9IGJsb2NrLnggKHJlYXNzZW1ibGVkKQ0KICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBibG9jay54ICsgYmxvY2suaW5pdGlhbE9mZnNldFggKiAoMSAtIGluZGl2aWR1YWxQcm9ncmVzcyk7DQogICAgICAgICAgICBjb25zdCBjdXJyZW50WSA9IGJsb2NrLnkgKyBibG9jay5pbml0aWFsT2Zmc2V0WSAqICgxIC0gaW5kaXZpZHVhbFByb2dyZXNzKTsNCg0KICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgcm90YXRpb24gYW5kIHNjYWxlIGZvciBkeW5hbWljIG1vdmVtZW50DQogICAgICAgICAgICBjb25zdCBjdXJyZW50Um90YXRpb24gPSBibG9jay5yb3RhdGlvblN0YXJ0ICsgKGJsb2NrLnJvdGF0aW9uRW5kIC0gYmxvY2sucm90YXRpb25TdGFydCkgKiBpbmRpdmlkdWFsUHJvZ3Jlc3M7DQogICAgICAgICAgICBjb25zdCBjdXJyZW50U2NhbGUgPSBibG9jay5zY2FsZVN0YXJ0ICsgKGJsb2NrLnNjYWxlRW5kIC0gYmxvY2suc2NhbGVTdGFydCkgKiBpbmRpdmlkdWFsUHJvZ3Jlc3M7DQoNCiAgICAgICAgICAgIC8vIERyYXcgdGhlIGJsb2NrIHdpdGggaXRzIGNhbGN1bGF0ZWQgdHJhbnNmb3JtYXRpb25zDQogICAgICAgICAgICBjdHhiaS5zYXZlKCk7IC8vIFNhdmUgdGhlIGN1cnJlbnQgY2FudmFzIHN0YXRlIGJlZm9yZSBhcHBseWluZyB0cmFuc2Zvcm1hdGlvbnMNCiAgICAgICAgICAgIC8vIE1vdmUgb3JpZ2luIHRvIHRoZSBjZW50ZXIgb2YgdGhlIGJsb2NrIGZvciByb3RhdGlvbi9zY2FsaW5nDQogICAgICAgICAgICBjdHhiaS50cmFuc2xhdGUoY3VycmVudFggKyBibG9jay53aWR0aCAvIDIsIGN1cnJlbnRZICsgYmxvY2suaGVpZ2h0IC8gMik7DQogICAgICAgICAgICBjdHhiaS5yb3RhdGUoY3VycmVudFJvdGF0aW9uKTsgICAgLy8gQXBwbHkgcm90YXRpb24NCiAgICAgICAgICAgIGN0eGJpLnNjYWxlKGN1cnJlbnRTY2FsZSwgY3VycmVudFNjYWxlKTsgLy8gQXBwbHkgc2NhbGUNCiAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9IGN1cnJlbnRDb2xvcjsNCiAgICAgICAgICAgIC8vIERyYXcgdGhlIHJlY3RhbmdsZSBjZW50ZXJlZCBhcm91bmQgdGhlIG5ldyBvcmlnaW4NCiAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KC1ibG9jay53aWR0aCAvIDIsIC1ibG9jay5oZWlnaHQgLyAyLCBibG9jay53aWR0aCwgYmxvY2suaGVpZ2h0KTsNCiAgICAgICAgICAgIGN0eGJpLnJlc3RvcmUoKTsgLy8gUmVzdG9yZSBjYW52YXMgc3RhdGUgdG8gYXZvaWQgYWZmZWN0aW5nIHN1YnNlcXVlbnQgZHJhd2luZ3MNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7DQogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOw0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLg0KDQogICAgICAgICAgICAvLyAxLiBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgdG8gdGhlIGNhbnZhcyB0byBjb21wbGV0ZWx5IGNvdmVyIHRoZSB0cmFuc2l0aW9uIHBpeGVscy4NCiAgICAgICAgICAgIC8vIFRoaXMgZW5zdXJlcyBhIGNsZWFuIHNsYXRlIGJlZm9yZSB0aGUgbmV4dCB0cmFuc2l0aW9uIHNldHVwLg0KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgICAgICAvLyAyLiBTV0FQIE9CSkVDVFM6IFRoZSBvbGQgdGFyZ2V0IGltYWdlIG9iamVjdCAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSBvYmplY3QgKEEpLg0KICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOw0KDQogICAgICAgICAgICAvLyAzLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLg0KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7DQoNCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKQ0KICAgICAgICAgICAgLy8gRW5zdXJlIG5ldyBpbWFnZSBkaW1lbnNpb25zIG1hdGNoIHRoZSBjYW52YXMNCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuIE5vIGRlbGF5IG5lZWRlZCBoZXJlLg0KICAgICAgICAgICAgc2V0VGltZW91dCgibG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkiLCAxNTAwKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhbmQgc3RhcnRzIHRoZSBhbmltYXRpb24gc2VxdWVuY2UuDQogICAgICovDQogICAgdmFyIHN0YXJ0QW5pbWF0aW9uZnQgPSAoKSA9PiB7DQogICAgICAgIGN1cnJlbnRGcmFtZWJiID0gMDsgLy8gUmVzZXQgZnJhbWUgY291bnRlciBmb3IgdGhlIG5ldyBhbmltYXRpb24NCiAgICAgICAgc2V0dXBJbml0aWFsQ2FudmFzKCk7IC8vIFByZXBhcmUgdGhlIHBpeGVsIGJsb2NrcyBmb3IgdGhlIGN1cnJlbnQgQSAtPiBCIHRyYW5zaXRpb24NCiAgICAgICAgQU5JTUFURSgpOyAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSBhbmltYXRpb24gbG9vcA0KICAgIH07DQoNCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQ0KICAgIC8vIFN0YXJ0IHRoZSB3aG9sZSBwcm9jZXNzIG9uY2UgdGhlIHdpbmRvdyBoYXMgZnVsbHkgbG9hZGVkDQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpbml0Q2FudmFzQW5kSW1hZ2VzKCk7DQogICAgfTsNCjwvc2NyaXB0Pg0KPC9ib2R5PjwvaHRtbD4=<br>DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDx0aXRsZT5QaXhlbCBGbG93IEFuaW1hdGlvbiBCeSBSaWRvdWFuIEJlbiBNYXNzb3VkPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIGJvZHl7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO21pbi1oZWlnaHQ6MTAwdmg7YmFja2dyb3VuZC1jb2xvcjojMTExO21hcmdpbjowO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtvdmVyZmxvdzpoaWRkZW59DQogICAgICAgIGNhbnZhc3tib3JkZXI6MCBzb2xpZCAjMzMzOw0KfQ0KICAgICAgICAjY29udHJvbHN7bWFyZ2luLXRvcDoyMHB4O2NvbG9yOndoaXRlO2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWY7Zm9udC1zaXplOjE0cHg7ZGlzcGxheTpub25lfQ0KICAgICAgICBpbnB1dFt0eXBlPSJmaWxlIl17bWFyZ2luLWxlZnQ6MTBweH0NCg0KICAgICAgICAvKiBEZSAnY2FudmFzJyBkaXYgKG51IGZ1bGwgc2NyZWVuKSAqLw0KICAgICAgICAjY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQoNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgIA0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAJIGhlaWdodDoxMDAlOw0KIAkgd2lkdGg6MTAwJTsNCg0KICAgICAgICAgICAgLyogRGUgY2FudmFzIHdvcmR0IGhpZXJiaW5uZW4gZ2VwbGFhdHN0IGVuIGdlc2NoYWFsZCBkb29yIENTUyAqLw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBTdHlsaW5nIHZvb3IgZGUgY2FudmFzIGRpZSBkb29yIGRlIEpTIGNvZGUgd29yZHQgYWFuZ2VtYWFrdCAqLw0KICAgICAgICAjYW5pbWF0aW9uQ2FudmFzT0cgew0KICAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERlICdjYW52YXMnIGRpdiAqLw0KICAgICAgICAjX18zY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogU3R5bGluZyB2b29yIGRlIGNhbnZhcyBkaWUgZG9vciBkZSBKUyBjb2RlIHdvcmR0IGFhbmdlbWFha3QgKi8NCiAgICAgICAgI19fM2FuaW1hdGlvbkNhbnZhc09HIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBUaGUgJ2NhbnZhcycgZGl2IChUaGUgRGV0b25hdGlvbiBGaWVsZCkgKi8NCiAgICAgICAgI2ZpZWxkQ29udGFpbmVyIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyANCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IA0KICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBUaGUgQ2FudmFzICovDQogICAgICAgICNyZW5kZXJTdXJmYWNlIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDsgDQoNCiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4wNXMgZWFzZS1vdXQ7IA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAjcHJvdG9jb2wtc3RhdHVzIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogMjBweDsNCiAgICAgICAgICAgIGxlZnQ6IDUwJTsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgIHotaW5kZXg6IDEwOw0KICAgICAgICAgICAgZm9udC1zaXplOiAxLjVlbTsNCiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgDQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KDQogICAgPCEtLSBEZSB0d2VlIGFmYmVlbGRpbmdzZWxlbWVudGVuIHppam4gdmVyYm9yZ2VuLCB6ZSBkaWVuZW4gYWxsZWVuIGFscyBkYXRhLWJyb25uZW4gLS0+DQogICAgPGltZyBpZD0iaW1nQSIgYWx0PSJBZmJlZWxkaW5nIEEgKEJyb24pIiBjbGFzcz0iaGlkZGVuLWltZyIgc3R5bGU9J2Rpc3BsYXk6IG5vbmU7JyAvPg0KICAgIDxpbWcgaWQ9ImltZ0IiIGFsdD0iQWZiZWVsZGluZyBCIChBbmFseXNlKSIgY2xhc3M9ImhpZGRlbi1pbWciICBzdHlsZT0nZGlzcGxheTogbm9uZTsnLz4NCg0KICAgIDwhLS0gRGUgY2FudmFzIGNvbnRhaW5lciwgZGllIGRlIHZvbGxlZGlnZSB3ZWVyZ2F2ZSBpbiBiZXNsYWcgbmVlbXQgLS0+DQogICAgPGRpdiBpZD0iY2FudmFzWFMiIHN0eWxlPSdkZGlzcGxheTpub25lJz4NCiAgICAgICAgPCEtLSBDYW52YXMgd29yZHQgaGllciBkeW5hbWlzY2ggZ2VwbGFhdHN0IC0tPg0KICAgIDwvZGl2Pg0KDQogICAgPCEtLSBGaXJlYmFzZSBTREsncyAoQmVob3VkZW4sIG1hYXIgYnVpdGVuIGRlIG5vcm1hbGUgZmxvdykgLS0+DQoNCg0KICAgIDwhLS0gQ29yZSBJbWFnZSBQcm9jZXNzaW5nIFNjcmlwdCAtLT4NCiAgICA8c2NyaXB0Pg0KICAgICAgICAvLyAtLS0gR2xvYmFsZSB2YXJpYWJlbGVuIGdlZGVmaW5pZWVyZCB2b29yIGdlYnJ1aWsgaW4gZGUgYW5pbWF0aWUgY29kZSAtLS0NCiAgICAgICAgLy8gRGV6ZSB6aWpuIHB1dXIgdm9vciBkZSBtYW5pcHVsYXRpZSwgZGUgd2VlcmdhdmUgaXMgZnVsbCBzY3JlZW4gKHppZSBDU1MpDQogICAgICAgIGNvbnN0IElNQUdFX1dJRFRIID0gMzAwOyANCiAgICAgICAgY29uc3QgSU1BR0VfSEVJR0hUID0gMzAwOw0KICAgICAgICANCiAgICAgICAgLy8gRWVyc3RlIHdpbGxla2V1cmlnZSBzZWVkcw0KICAgICAgICBjb25zdCByYW5kb21TZWVkQSA9IE1hdGgucm91bmQoMTAwMDAgKiBNYXRoLnJhbmRvbSgpKTsNCiAgICAgICAgY29uc3QgcmFuZG9tU2VlZEIgPSBNYXRoLnJvdW5kKDEwMDAwICogTWF0aC5yYW5kb20oKSk7DQogICAgICAgIA0KICAgICAgICAvLyBHbG9iYWxlIFVSTCdzDQogICAgICAgIGNvbnN0IGFpbWcgPSAnaHR0cDovLzEyNy4wLjAuMS9nZXRSYW5kSW1hZ2UucGhwP3JhbmRvbT0nICsgcmFuZG9tU2VlZEE7DQogICAgICAgIGNvbnN0IGJpbWcgPSAnaHR0cDovLzEyNy4wLjAuMS9nZXRSYW5kSW1hZ2UucGhwP3JhbmRvbT0nICsgcmFuZG9tU2VlZEI7DQogICAgICAgIGNvbnN0IHNwZWVkID0gNjA7IC8vIFNuZWxoZWlkIHZvb3IgZGUgc2V0VGltZW91dCAobXMpDQogICAgICAgIA0KICAgICAgICAvLyBET00gZWxlbWVudGVuDQogICAgICAgIGNvbnN0IGltZ0FFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltZ0EnKTsNCiAgICAgICAgY29uc3QgaW1nQkVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW1nQicpOw0KDQogICAgICAgIC8vIEluaXRpYWwgc2V0IHZhbiBkZSBpbWFnZSBzb3VyY2VzIGVuIGNyb3NzT3JpZ2luDQogICAgICAgIGltZ0FFbGVtZW50LnNyYyA9IGFpbWc7DQogICAgICAgIGltZ0JFbGVtZW50LnNyYyA9IGJpbWc7DQogICAgICAgIGltZ0FFbGVtZW50LmNyb3NzT3JpZ2luID0gJ0Fub255bW91cyc7DQogICAgICAgIGltZ0JFbGVtZW50LmNyb3NzT3JpZ2luID0gJ0Fub255bW91cyc7DQogICAgICAgIA0KICAgICAgICAvLyBHbG9iYWxlIHZhcmlhYmVsZW4gdm9vciBkZSBhbmltYXRpZSBsb2dpY2ENCiAgICAgICAgdmFyIHJfX2NhbnZhczsgDQogICAgICAgIHZhciByX19jdHg7IA0KICAgICAgICB2YXIgcl9faW1nMDsgLy8gSW1hZ2UgZGF0YSBzb3VyY2UgMSAoY29tcHJpbWVlcnQpDQogICAgICAgIHZhciByX19pbWcxOyAvLyBJbWFnZSBkYXRhIHNvdXJjZSAyIChkZWNvbXByZXNzZWVydCkNCiAgICAgICAgDQogICAgICAgIC8vIENlbnRyYWFsIHB1bnQgdm9vciBkZSBjaXJjdWxhaXJlIGJld2VnaW5nDQogICAgICAgIHZhciByX19jZW50ZXJYOyANCiAgICAgICAgdmFyIHJfX2NlbnRlclk7DQoNCiAgICAgICAgdmFyIHJfX3RvdGFsU3RlcHMgPSA1MDsNCiAgICAgICAgdmFyIHJfX2N1cnJlbnRTdGVwID0gMDsNCiAgICAgICAgdmFyIHJfX2FuaW1hdGlvbkZyYW1lcyA9IFtdOyAvLyBUbyBzdG9yZSBwcmUtcmVjb3JkZWQgZnJhbWVzDQoNCiAgICAgICAgdmFyIHJfX2ltYWdlRGF0YTAsIHJfX2ltYWdlRGF0YTE7IC8vIFRvIGhvbGQgb3JpZ2luYWwgcGl4ZWwgZGF0YQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IEltYWdlRGF0YSBmcm9tIGFuIEhUTUxJbWFnZUVsZW1lbnQuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiByX19nZXRQaXhlbERhdGEocl9faW1hZ2UpIHsNCiAgICAgICAgICAgIGNvbnN0IHJfX3RlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgICAgIGNvbnN0IHJfX3RlbXBDdHggPSByX190ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICByX190ZW1wQ2FudmFzLndpZHRoID0gcl9faW1hZ2Uud2lkdGg7DQogICAgICAgICAgICByX190ZW1wQ2FudmFzLmhlaWdodCA9IHJfX2ltYWdlLmhlaWdodDsNCiAgICAgICAgICAgIHJfX3RlbXBDdHguZHJhd0ltYWdlKHJfX2ltYWdlLCAwLCAwLCByX190ZW1wQ2FudmFzLndpZHRoLCByX190ZW1wQ2FudmFzLmhlaWdodCk7DQogICAgICAgICAgICByZXR1cm4gcl9fdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgcl9fdGVtcENhbnZhcy53aWR0aCwgcl9fdGVtcENhbnZhcy5oZWlnaHQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENhbGN1bGF0ZXMgYSBzaW5nbGUgZnJhbWUgb2YgdGhlIGNvbXByZXNzaW9uIGFuaW1hdGlvbiBiYXNlZCBvbiB0aGUgc291cmNlIGltYWdlIGRhdGEuDQogICAgICAgICAqIFBpeGVscyBtb3ZlIHJhZGlhbGx5IHRvd2FyZHMgdGhlIGZpeGVkIGNlbnRlciBwb2ludC4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHJfX2NhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShyX19vcmlnaW5hbEltYWdlRGF0YSwgcl9fc3RlcCwgcl9fdG90YWxQaGFzZVN0ZXBzKSB7DQogICAgICAgICAgICBjb25zdCByX193aWR0aCA9IHJfX29yaWdpbmFsSW1hZ2VEYXRhLndpZHRoOw0KICAgICAgICAgICAgY29uc3Qgcl9faGVpZ2h0ID0gcl9fb3JpZ2luYWxJbWFnZURhdGEuaGVpZ2h0Ow0KICAgICAgICAgICAgY29uc3Qgcl9fb3JpZ2luYWxQaXhlbHMgPSByX19vcmlnaW5hbEltYWdlRGF0YS5kYXRhOw0KICAgICAgICAgICAgY29uc3Qgcl9fbmV3UGl4ZWxzQnVmZmVyID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHJfX3dpZHRoICogcl9faGVpZ2h0ICogNCk7IA0KDQogICAgICAgICAgICAvLyBJbml0aWFsaXplIGJ1ZmZlciB3aXRoIHRyYW5zcGFyZW50IHBpeGVscw0KICAgICAgICAgICAgZm9yIChsZXQgcl9faSA9IDA7IHJfX2kgPCByX19uZXdQaXhlbHNCdWZmZXIubGVuZ3RoOyByX19pICs9IDQpIHsNCiAgICAgICAgICAgICAgICByX19uZXdQaXhlbHNCdWZmZXJbcl9faSArIDNdID0gMDsgDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IHJfX21heENvbXByZXNzaW9uRGlzdGFuY2UgPSByX193aWR0aCAvIDIuNTsgDQogICAgICAgICAgICBjb25zdCByX19jb21wcmVzc2lvblByb2dyZXNzID0gTWF0aC5taW4oMSwgcl9fc3RlcCAvIChyX190b3RhbFBoYXNlU3RlcHMgLSAxKSk7DQoNCiAgICAgICAgICAgIGZvciAobGV0IHJfX3kgPSAwOyByX195IDwgcl9faGVpZ2h0OyByX195KyspIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCByX194ID0gMDsgcl9feCA8IHJfX3dpZHRoOyByX194KyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcl9faSA9IChyX195ICogcl9fd2lkdGggKyByX194KSAqIDQ7IA0KICAgICAgICAgICAgICAgICAgICBjb25zdCByX19yID0gcl9fb3JpZ2luYWxQaXhlbHNbcl9faV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX2cgPSByX19vcmlnaW5hbFBpeGVsc1tyX19pICsgMV07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX2IgPSByX19vcmlnaW5hbFBpeGVsc1tyX19pICsgMl07DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX2EgPSByX19vcmlnaW5hbFBpeGVsc1tyX19pICsgM107IA0KDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX2F2Z0NvbG9yID0gKHJfX3IgKyByX19nICsgcl9fYikgLyAzOyANCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcl9fbm9ybWFsaXplZEF2Z0NvbG9yID0gcl9fYXZnQ29sb3IgLyAyNTU7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gVmVjdG9yIHZhbiBkZSBwaXhlbCBuYWFyIGhldCBjZW50cnVtDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX2R4ID0gcl9fY2VudGVyWCAtIHJfX3g7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX2R5ID0gcl9fY2VudGVyWSAtIHJfX3k7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQWZzdGFuZA0KICAgICAgICAgICAgICAgICAgICBjb25zdCByX19kaXN0YW5jZSA9IE1hdGguc3FydChyX19keCAqIHJfX2R4ICsgcl9fZHkgKiByX19keSk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gMy4gTm9ybWFsaXNlZXIgZGUgdmVjdG9yIChyaWNodGluZykNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJfX2RpclggPSAwOw0KICAgICAgICAgICAgICAgICAgICBsZXQgcl9fZGlyWSA9IDA7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKHJfX2Rpc3RhbmNlID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcl9fZGlyWCA9IHJfX2R4IC8gcl9fZGlzdGFuY2U7IA0KICAgICAgICAgICAgICAgICAgICAgICAgcl9fZGlyWSA9IHJfX2R5IC8gcl9fZGlzdGFuY2U7IA0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gNC4gQmVyZWtlbiBkZSBiZXdlZ2luZ3NtYWduaXR1ZGUgKGhlbGRlcmUgcGl4ZWxzIGJld2VnZW4gbWVlcikNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJfX21vdmVtZW50TWFnbml0dWRlID0gcl9fbm9ybWFsaXplZEF2Z0NvbG9yICogcl9fbWF4Q29tcHJlc3Npb25EaXN0YW5jZSAqIHJfX2NvbXByZXNzaW9uUHJvZ3Jlc3M7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gNS4gUGFzIGRlIGJld2VnaW5nIHRvZSAocmljaHRpbmcgaGV0IGNlbnRydW0pDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJfX21vdmVYID0gcl9fZGlyWCAqIHJfX21vdmVtZW50TWFnbml0dWRlOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCByX19tb3ZlWSA9IHJfX2RpclkgKiByX19tb3ZlbWVudE1hZ25pdHVkZTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBOaWV1d2UgcG9zaXRpZQ0KICAgICAgICAgICAgICAgICAgICBsZXQgcl9fbmV3WCA9IHJfX3ggKyByX19tb3ZlWDsNCiAgICAgICAgICAgICAgICAgICAgbGV0IHJfX25ld1kgPSByX195ICsgcl9fbW92ZVk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gS2xlbSBlbiByb25kIGFmDQogICAgICAgICAgICAgICAgICAgIHJfX25ld1ggPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIE1hdGgubWluKHJfX3dpZHRoIC0gMSwgcl9fbmV3WCkpKTsNCiAgICAgICAgICAgICAgICAgICAgcl9fbmV3WSA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgTWF0aC5taW4ocl9faGVpZ2h0IC0gMSwgcl9fbmV3WSkpKTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBCZXJla2VuIGRlIGJlc3RlbW1pbmdzaW5kZXgNCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcl9fZGVzdEluZGV4ID0gKHJfX25ld1kgKiByX193aWR0aCArIHJfX25ld1gpICogNDsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBLb3BpZWVyIGRlIHBpeGVsa2xldXIgbmFhciBkZSBuaWV1d2UgcG9zaXRpZQ0KICAgICAgICAgICAgICAgICAgICByX19uZXdQaXhlbHNCdWZmZXJbcl9fZGVzdEluZGV4XSA9IHJfX3I7DQogICAgICAgICAgICAgICAgICAgIHJfX25ld1BpeGVsc0J1ZmZlcltyX19kZXN0SW5kZXggKyAxXSA9IHJfX2c7DQogICAgICAgICAgICAgICAgICAgIHJfX25ld1BpeGVsc0J1ZmZlcltyX19kZXN0SW5kZXggKyAyXSA9IHJfX2I7DQogICAgICAgICAgICAgICAgICAgIHJfX25ld1BpeGVsc0J1ZmZlcltyX19kZXN0SW5kZXggKyAzXSA9IHJfX2E7IA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgY29uc3QgdGVtcEN0eEZvckNyZWF0aW9uID0gcl9fY3R4IHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhc1hTJykuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIGNvbnN0IHJfX25ld0ltYWdlRGF0YSA9IHRlbXBDdHhGb3JDcmVhdGlvbi5jcmVhdGVJbWFnZURhdGEocl9fd2lkdGgsIHJfX2hlaWdodCk7DQogICAgICAgICAgICByX19uZXdJbWFnZURhdGEuZGF0YS5zZXQocl9fbmV3UGl4ZWxzQnVmZmVyKTsNCiAgICAgICAgICAgIHJldHVybiByX19uZXdJbWFnZURhdGE7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdGhlIGFuaW1hdGlvbjogbG9hZHMgaW1hZ2VzLCBzZXRzIHVwIGNhbnZhcywgYW5kIHByZS1yZWNvcmRzIGFsbCBmcmFtZXMuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiByX19pbml0QW5pbWF0aW9uKCkgew0KDQogICAgICAgICAgICAvLyBWZXJ2YW5nIGRlIGNvbnRlbnQgdmFuIGRlIGNhbnZhcyBkaXYgZG9vciBkZSBkYWFkd2Vya2VsaWprZSBjYW52YXMNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYW52YXNYUycpLmlubmVySFRNTD0nIDxjYW52YXMgd2lkdGg9MzYwIGhlaWdodD02NDAgaWQ9ImFuaW1hdGlvbkNhbnZhc09HIiBzdHlsZT0id2lkdGg6MTAwJTtoZWlnaHQ6MTAwJSI+PC9jYW52YXM+JzsNCg0KICAgICAgICAgICAgcl9fY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhc09HJyk7DQogICAgICAgICAgICByX19jdHggPSByX19jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcl9faW1nMCA9IGltZ0JFbGVtZW50OyAvLyBJbWFnZSAwIChjb21wcmltZWVydCBlZXJzdCkNCiAgICAgICAgICAgIHJfX2ltZzEgPSBpbWdBRWxlbWVudDsgLy8gSW1hZ2UgMSAoZGVjb21wcmVzc2VlcnQpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHJfX3RvdGFsU3RlcHMgPSA1MDsNCiAgICAgICAgICAgIHJfX2N1cnJlbnRTdGVwID0gMDsNCiAgICAgICAgICAgIHJfX2FuaW1hdGlvbkZyYW1lcyA9IFtdOyANCg0KICAgICAgICAgICAgLy8gU2V0IGNhbnZhcyBwaXhlbCBkaW1lbnNpZXMgZ2ViYXNlZXJkIG9wIGRlIGdlbGFkZW4gYWZiZWVsZGluZ2VuIChiaWp2LiAzMDB4MzAwKQ0KICAgICAgICAgICAgcl9fY2FudmFzLndpZHRoID0gcl9faW1nMC5uYXR1cmFsV2lkdGggfHwgSU1BR0VfV0lEVEg7DQogICAgICAgICAgICByX19jYW52YXMuaGVpZ2h0ID0gcl9faW1nMC5uYXR1cmFsSGVpZ2h0IHx8IElNQUdFX0hFSUdIVDsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gQmVwYWFsIGhldCB3aWxsZWtldXJpZ2UgY2VudHJhbGUgcHVudCB2b29yIGRlIGFuaW1hdGllY3ljbHVzDQogICAgICAgICAgICBjb25zdCBjZW50ZXJPZmZzZXRYID0gcl9fY2FudmFzLndpZHRoICogMC41OyANCiAgICAgICAgICAgIGNvbnN0IGNlbnRlck9mZnNldFkgPSByX19jYW52YXMuaGVpZ2h0ICogMC41Ow0KICAgICAgICAgICAgLy8gV2lsbGVrZXVyaWdlIG9mZnNldCB2YW4gKy8tIDIwJSB2YW4gZGUgYnJlZWR0ZS9ob29ndGUgdmFuYWYgaGV0IG1pZGRlbg0KICAgICAgICAgICAgY29uc3QgcmFuZG9tT2Zmc2V0WCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHJfX2NhbnZhcy53aWR0aCAqIDAuNDsgDQogICAgICAgICAgICBjb25zdCByYW5kb21PZmZzZXRZID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogcl9fY2FudmFzLmhlaWdodCAqIDAuNDsgDQoNCiAgICAgICAgICAgIHJfX2NlbnRlclggPSBNYXRoLnJvdW5kKGNlbnRlck9mZnNldFggKyByYW5kb21PZmZzZXRYKTsNCiAgICAgICAgICAgIHJfX2NlbnRlclkgPSBNYXRoLnJvdW5kKGNlbnRlck9mZnNldFkgKyByYW5kb21PZmZzZXRZKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc29sZS5sb2coYE5pZXV3IGNlbnRyYWFsIHB1bnQ6ICgke3JfX2NlbnRlclh9LCAke3JfX2NlbnRlcll9KWApOw0KDQogICAgICAgICAgICAvLyBHZXQgaW5pdGlhbCBJbWFnZURhdGEgZm9yIGJvdGggc291cmNlIGltYWdlcw0KICAgICAgICAgICAgcl9faW1hZ2VEYXRhMCA9IHJfX2dldFBpeGVsRGF0YShyX19pbWcwKTsgLy8gRGF0YSB2b29yIGNvbXByZXNzaWUgKFIxKQ0KICAgICAgICAgICAgcl9faW1hZ2VEYXRhMSA9IHJfX2dldFBpeGVsRGF0YShyX19pbWcxKTsgLy8gRGF0YSB2b29yIGRlY29tcHJlc3NpZSAoUjIpDQoNCiAgICAgICAgICAgIGNvbnN0IHJfX2hhbGZTdGVwcyA9IHJfX3RvdGFsU3RlcHMgLyAyOyAvLyBFbGtlIGZhc2UgaXMgMjUgc3RhcHBlbg0KDQogICAgICAgICAgICAvLyBGYXNlIDE6IENvbXByZXNzaWUgKFIxIC0+IE1heCBDb21wcmVzc2VkKQ0KICAgICAgICAgICAgZm9yIChsZXQgcl9fc3RlcCA9IDA7IHJfX3N0ZXAgPCByX19oYWxmU3RlcHM7IHJfX3N0ZXArKykgew0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2ZyYW1lRGF0YSA9IHJfX2NhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShyX19pbWFnZURhdGEwLCByX19zdGVwLCByX19oYWxmU3RlcHMpOw0KICAgICAgICAgICAgICAgIHJfX2FuaW1hdGlvbkZyYW1lcy5wdXNoKHJfX2ZyYW1lRGF0YSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEZhc2UgMjogRGVjb21wcmVzc2llIChNYXggQ29tcHJlc3NlZCBSMiAtPiBSMiBPcmlnaW5hbCkNCiAgICAgICAgICAgIGNvbnN0IHJfX2ltYWdlMUNvbXByZXNzZWRTdGF0ZXMgPSBbXTsNCiAgICAgICAgICAgIGZvciAobGV0IHJfX3N0ZXAgPSAwOyByX19zdGVwIDwgcl9faGFsZlN0ZXBzOyByX19zdGVwKyspIHsNCiAgICAgICAgICAgICAgICAvLyBCZXJla2VuIGRlIHN0YXBwZW4gdmFuIFIyIGdlY29tcHJpbWVlcmQgKHZhbiAwIG5hYXIgbWF4KQ0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2ZyYW1lRGF0YSA9IHJfX2NhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShyX19pbWFnZURhdGExLCByX19zdGVwLCByX19oYWxmU3RlcHMpOw0KICAgICAgICAgICAgICAgIHJfX2ltYWdlMUNvbXByZXNzZWRTdGF0ZXMucHVzaChyX19mcmFtZURhdGEpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBWb2VnIGRlIG9tZ2VrZWVyZGUgc2VxdWVudGllIHZhbiBkZSBnZWNvbXByaW1lZXJkZSBSMi1zdGF0ZW4gdG9lLg0KICAgICAgICAgICAgLy8gRGl0IHpvcmd0IHZvb3IgZGUgImRlY29tcHJlc3NpZSIgdmFuIE1heCBDb21wcmVzc2VkIFIyIG5hYXIgUjIgT3JpZ2luYWwuDQogICAgICAgICAgICBmb3IgKGxldCByX19pID0gcl9faW1hZ2UxQ29tcHJlc3NlZFN0YXRlcy5sZW5ndGggLSAxOyByX19pID49IDA7IHJfX2ktLSkgew0KICAgICAgICAgICAgICAgIHJfX2FuaW1hdGlvbkZyYW1lcy5wdXNoKHJfX2ltYWdlMUNvbXByZXNzZWRTdGF0ZXNbcl9faV0pOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTdGFydCBkZSBhbmltYXRpZWx1cw0KICAgICAgICAgICAgc2V0VGltZW91dCgncl9fYW5pbWF0ZSgpJywgKHNwZWVkLzMpKTsNCiAgICAgICAgfQ0KDQoNCg0KZnVuY3Rpb24ga2xvcHRlbigpew0KDQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkFuaW1hdGlvbiBmaW5pc2hlZC4gUHJlcGFyaW5nIGZsdWlkIHRyYW5zaXRpb24gZm9yIG5leHQgY3ljbGUuIik7DQoNCiAgICAgICAgICAgICAgICAvLyAtLS0gVkxPRUlFTkRFIFJFU0VUIExPR0lDQSAtLS0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyAxLiBIYWFsIGRlIGxhYXRzdGUsIHZvbGxlZGlnIGdlZGVjb21wcmltZWVyZGUgZnJhbWUgb3AgKHN0YXAgNDkgdmFuIGZhc2UgMikuDQogICAgICAgICAgICAgICAgLy8gRGl0IGlzIGRlIG5pZXV3ZSBicm9uYWZiZWVsZGluZyAoQSdzIHJlc3VsdGFhdCkgdm9vciBkZSB2b2xnZW5kZSBjb21wcmVzc2llLg0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2ZpbmFsRnJhbWUgPSByX19hbmltYXRpb25GcmFtZXNbcl9fdG90YWxTdGVwcyAtIDFdOyANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyAyLiBDb252ZXJ0ZWVyIGRlIGxhYXRzdGUgZnJhbWUgKEltYWdlRGF0YSkgbmFhciBlZW4gRGF0YSBVUkwuDQogICAgICAgICAgICAgICAgY29uc3Qgcl9fdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgICAgICAgICAgICAgIHJfX3RlbXBDYW52YXMud2lkdGggPSByX19jYW52YXMud2lkdGg7DQogICAgICAgICAgICAgICAgcl9fdGVtcENhbnZhcy5oZWlnaHQgPSByX19jYW52YXMuaGVpZ2h0Ow0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX3RlbXBDdHggPSByX190ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICAgICAgcl9fdGVtcEN0eC5wdXRJbWFnZURhdGEocl9fZmluYWxGcmFtZSwgMCwgMCk7IA0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2RhdGFVUkwgPSByX190ZW1wQ2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7DQoNCiAgICAgICAgICAgICAgICAvLyAzLiBTd2FwIHJvbGxlbjogDQogICAgICAgICAgICAgICAgLy8gYSkgSGV0IGRlY29tcHJlc3NlZXJkZSByZXN1bHRhYXQgdmFuIGRlIHZvcmlnZSBjeWNsdXMgKFIyKSB3b3JkdCBkZSBOSUVVV0UgDQogICAgICAgICAgICAgICAgLy8gICAgYWZiZWVsZGluZyB2b29yIGRlIGNvbXByZXNzaWVmYXNlIChyX19pbWcwID0gaW1nQkVsZW1lbnQpLg0KICAgICAgICAgICAgICAgIGltZ0JFbGVtZW50LnNyYyA9IHJfX2RhdGFVUkw7IA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIGIpIExhYWQgZWVuIE5JRVVXRSB3aWxsZWtldXJpZ2UgYWZiZWVsZGluZyAoUjMpIHZvb3IgZGUgZGVjb21wcmVzc2VlcmZhc2UgDQogICAgICAgICAgICAgICAgLy8gICAgKHJfX2ltZzEgPSBpbWdBRWxlbWVudCkuDQogICAgICAgICAgICAgICAgY29uc3QgbmV3UmFuZG9tU2VlZEEgPSBNYXRoLnJvdW5kKDEwMDAwICogTWF0aC5yYW5kb20oKSk7DQogICAgICAgICAgICAgICAgaW1nQUVsZW1lbnQuc3JjID0gJ2h0dHA6Ly8xMjcuMC4wLjEvZ2V0UmFuZEltYWdlLnBocD9yYW5kb209JyArIG5ld1JhbmRvbVNlZWRBOw0KDQogICAgICAgICAgICAgICAgLy8gUmVzZXQgc3RhcHBlbiBlbiBmcmFtZXMuIERlIGltYWdlTG9hZEhhbmRsZXIgemFsIHJfX2luaXRBbmltYXRpb24oKSBzdGFydGVuDQogICAgICAgICAgICAgICAgLy8gem9kcmEgQkVJREUgbmlldXdlIGJyb25uZW4gZ2VsYWRlbiB6aWpuICh3YXQgem9yZ3Qgdm9vciBkZSBjb250aW51w690ZWl0KS4NCiAgICAgICAgICAgICAgICByX19jdXJyZW50U3RlcCA9IDA7DQogICAgICAgICAgICAgICAgcl9fYW5pbWF0aW9uRnJhbWVzID0gW107IA0KfQ0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AuIERyYXdzIHRoZSBwcmUtcmVjb3JkZWQgZnJhbWUgYW5kIGhhbmRsZXMgdGhlIGZsdWlkIHJlc2V0Lg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gcl9fYW5pbWF0ZSgpIHsNCiAgICAgICAgICAgIGlmIChyX19jdXJyZW50U3RlcCA8IHJfX3RvdGFsU3RlcHMgJiYgcl9fYW5pbWF0aW9uRnJhbWVzW3JfX2N1cnJlbnRTdGVwXSkgew0KICAgICAgICAgICAgICAgIHJfX2N0eC5wdXRJbWFnZURhdGEocl9fYW5pbWF0aW9uRnJhbWVzW3JfX2N1cnJlbnRTdGVwXSwgMCwgMCk7IA0KICAgICAgICAgICAgICAgIHJfX2N1cnJlbnRTdGVwKys7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc2V0VGltZW91dCgncl9fYW5pbWF0ZSgpJywgKHNwZWVkLzMpKTsgDQogICAgICAgICAgICB9IGVsc2UgaWYgKHJfX2N1cnJlbnRTdGVwID09PSByX190b3RhbFN0ZXBzKSB7DQoNCgkJc2V0VGltZW91dCgna2xvcHRlbigpJywgMjAwMCk7DQoNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gLS0tIEltYWdlIExvYWRpbmcgU2V0dXAgLS0tDQogICAgICAgIGxldCBpbWFnZXNMb2FkZWQgPSAwOw0KICAgICAgICBjb25zdCB0b3RhbEltYWdlcyA9IDI7DQoNCiAgICAgICAgY29uc3QgaW1hZ2VMb2FkSGFuZGxlciA9ICgpID0+IHsNCiAgICAgICAgICAgIGltYWdlc0xvYWRlZCsrOw0KICAgICAgICAgICAgaWYgKGltYWdlc0xvYWRlZCA9PT0gdG90YWxJbWFnZXMpIHsNCiAgICAgICAgICAgICAgICBpbWFnZXNMb2FkZWQgPSAwOyAvLyBSZXNldCB2b29yIGRlIHZvbGdlbmRlIGFuaW1hdGllbHVzDQogICAgICAgICAgICAgICAgcl9faW5pdEFuaW1hdGlvbigpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8vIFpvcmcgZXJ2b29yIGRhdCBkZSBoYW5kbGVyIHdvcmR0IGFhbmdlcm9lcGVuIHdhbm5lZXIgZGUgYWZiZWVsZGluZ2VuIGdlbGFkZW4gemlqbiAob29rIG5hIGhlcmxhZGVuKQ0KICAgICAgICBpbWdBRWxlbWVudC5vbmxvYWQgPSBpbWFnZUxvYWRIYW5kbGVyOw0KICAgICAgICBpbWdCRWxlbWVudC5vbmxvYWQgPSBpbWFnZUxvYWRIYW5kbGVyOw0KDQogICAgICAgIC8vIEZhbGxiYWNrIHZvb3IgaW1hZ2UgbG9hZGluZyBlcnJvcnMNCiAgICAgICAgaW1nQUVsZW1lbnQub25lcnJvciA9ICgpID0+IHsgY29uc29sZS5lcnJvcigiRm91dCBiaWogaGV0IGxhZGVuIHZhbiBBZmJlZWxkaW5nIEEuIik7IH07DQogICAgICAgIGltZ0JFbGVtZW50Lm9uZXJyb3IgPSAoKSA9PiB7IGNvbnNvbGUuZXJyb3IoIkZvdXQgYmlqIGhldCBsYWRlbiB2YW4gQWZiZWVsZGluZyBCLiIpOyB9Ow0KDQogICAgPC9zY3JpcHQ+<br>PGh0bWwgbGFuZz0iZW4iPg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPg0KICAgIDx0aXRsZT5Vbml2ZXJzZSBNZW1vcnkgQW5pbWF0aW9uPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIC8qIEJhc2Ugc3R5bGVzICovDQogICAgICAgIGJvZHkgeyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgIA0KICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOw0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzExMTsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOw0KICAgICAgICAgICAgZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOw0KICAgICAgICAgICAgY29sb3I6ICNlZWU7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMvYmFja2dyb3VuZCBpbWFnZSAqLw0KICAgICAgICAjY2FudmFzIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyAvKiBBZGp1c3RlZCB0byBtYXRjaCBpbWFnZSBzb3VyY2UgKi8NCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsgLyogQWRqdXN0ZWQgdG8gbWF0Y2ggaW1hZ2Ugc291cmNlICovDQogICAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDBweDsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IC8qIEVuc3VyZSBwYXJ0aWNsZXMgZG9uJ3QgZHJhdyBvdXRzaWRlICovDQogICAgICAgIH0NCiAgICAgICAgLyogVGhlIGNhbnZhcyBpdHNlbGYgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuMSk7IC8qIFNsaWdodCBkYXJrIGJhY2tncm91bmQgdG8gZW1waGFzaXplIGZhZGluZyAqLw0KICAgICAgICB9DQoNCiAgICAgICAgaDEgew0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCiAgICAgICAgICAgIGNvbG9yOiAjMDBmZmZmOw0KICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4ICMwMGZmZmYsIDAgMCAyMHB4ICMwMGZmZmY7DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBmb250LXNpemU6IDEuNWVtOw0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KPGRpdiBpZD0nY2FudmFzJyBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTsnPg0KICAgIDxjYW52YXMgaWQ9J2FuaW1hdGlvbkNhbnZhcycgd2lkdGg9ODAwIGhlaWdodD00NTAgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCUnPjwvY2FudmFzPg0KPC9kaXY+DQo8c2NyaXB0Pg0KICAgIC8vIC0tLSBJbWFnZSBTb3VyY2UgYW5kIE9iamVjdCBTdG9yYWdlIC0tLQ0KICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqVVJMKiBvZiB0aGUgY3VycmVudGx5IGxvYWRlZCBpbWFnZSBzZXQNCiAgICB2YXIgY3VycmVudFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQogICAgdmFyIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpBY3R1YWwgSW1hZ2UgT2JqZWN0cyogZm9yIHRoZSBhbmltYXRpb24NCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KQ0KICAgIHZhciBuZXh0SW1hZ2UgPSBudWxsOyAgICAvLyBJbWFnZSBCIChUaGUgVGFyZ2V0KQ0KDQogICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQ0KICAgIHZhciBjYW52YXNiYmk7DQogICAgdmFyIGN0eGJpOw0KICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQ0KICAgIHZhciBwaXhiaXhlbHMgPSBbXTsNCg0KICAgIHZhciB0b3RhbEZyYW1lc2JiID0gODA7ICAgICAgICAvLyBJbmNyZWFzZWQgZnJhbWVzIGZvciBzbW9vdGhlciwgc2xvd2VyIHRyYW5zaXRpb24NCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOw0KDQogICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIGNhbnZhcyBlbGVtZW50IChBZGp1c3RlZCB0byBtYXRjaCBpbWFnZSBzb3VyY2UpDQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8NCiAgICB2YXIgaG9vZzE4MCA9IDQ1MDsgLy8NCg0KICAgIC8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQ0KICAgIC8qKg0KICAgICAqIExvYWRzIGEgc2luZ2xlIGltYWdlIGludG8gdGhlIGltYWdlc2JpIG1hcC4NCiAgICAgKi8NCiAgICB2YXIgbG9hZEltYWdlYmIgPSAoc3JjLCBjYWxsYmFjaykgPT4gew0KICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7DQogICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICBpbWFnZXNiaVtzcmNdID0gaW1nOw0KICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgaW1nKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7DQogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCk7DQogICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKSk7DQogICAgICAgIH07DQogICAgICAgIGltZy5zcmMgPSBzcmM7DQogICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBMb2FkcyB0aGUgbmV4dCBpbWFnZSBpbiB0aGUgc2VxdWVuY2UgYW5kIHN0YXJ0cyB0aGUgdHJhbnNpdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7DQogICAgICAgIGxldCBuZXdJbWFnZVVSTCA9IG5leHRVUkw7DQogICAgICAgIGlmIChpbWFnZXNiaVtuZXdJbWFnZVVSTF0pIHsNCiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7DQogICAgICAgIGNhbnZhc2JiaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25DYW52YXMnKTsNCiAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7DQogICAgICAgIGNhbnZhc2JiaS5oZWlnaHQgPSBob29nMTgwOw0KICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOw0KDQogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7DQogICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlOw0KDQogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yKSB7DQogICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbG9hZGVkQ291bnQrKzsNCiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA9PT0gaW1hZ2VzVG9Mb2FkLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzYmlbY3VycmVudFVSTF07DQogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25leHRVUkxdOw0KICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW5pdGlhbCBpbWFnZSBsb2FkaW5nIGZhaWxlZC4gQ2Fubm90IHN0YXJ0IGFuaW1hdGlvbi4nKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIGltYWdlc1RvTG9hZC5mb3JFYWNoKHNyYyA9PiBsb2FkSW1hZ2ViYihzcmMsIG9uSW1hZ2VMb2FkZWQpKTsNCiAgICB9DQoNCiAgICAvLyAtLS0gUGl4ZWwgYW5kIEVhc2luZyBVdGlsaXRpZXMgLS0tDQogICAgdmFyIHBhcnNlUkdCQSA9IChyZ2JhU3RyaW5nKSA9PiB7DQogICAgICAgIHZhciBwYXJ0cyA9IHJnYmFTdHJpbmcubWF0Y2goL1xkKyhcLlxkKyk/L2cpLm1hcChOdW1iZXIpOw0KICAgICAgICByZXR1cm4geyByOiBwYXJ0c1swXSwgZzogcGFydHNbMV0sIGI6IHBhcnRzWzJdLCBhOiBwYXJ0c1szXSB8fCAxIH07DQogICAgfTsNCg0KICAgIHZhciBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gew0KICAgICAgICB2YXIgYzEgPSBwYXJzZVJHQkEoY29sb3IxKTsNCiAgICAgICAgdmFyIGMyID0gcGFyc2VSR0JBKGNvbG9yMik7DQogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjMS5yICsgKGMyLnIgLSBjMS5yKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKGMxLmcgKyAoYzIuZyAtIGMxLmcpICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgYiA9IE1hdGgucm91bmQoYzEuYiArIChjMi5iIC0gYzEuYikgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBhID0gYzEuYSArIChjMi5hIC0gYzEuYSkgKiBwcm9ncmVzczsNCiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7YX0pYDsNCiAgICB9Ow0KDQogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0Ow0KDQogICAgLyoqDQogICAgICogUHJlcGFyZXMgdGhlIGBwaXhiaXhlbHNgIGFycmF5IGJ5IGV4dHJhY3RpbmcgcGl4ZWwgZGF0YSBmcm9tIHRoZSBjdXJyZW50IGFuZCBuZXh0IGltYWdlcy4NCiAgICAgKiBFYWNoIHBpeGJpeGVsIHdpbGwgc3RvcmUgc3RhcnQvdGFyZ2V0IGNvbG9ycyBhbmQgcG9zaXRpb25zLCBwbHVzIHJhbmRvbSBkcmlmdCBmb3IgdGhlIGVmZmVjdC4NCiAgICAgKi8NCiAgICB2YXIgc2V0dXBJbml0aWFsQ2FudmFzID0gKCkgPT4gew0KICAgICAgICB2YXIgaW1nMSA9IGN1cnJlbnRJbWFnZTsgLy8gVGhlIHN0YXJ0IGltYWdlDQogICAgICAgIHZhciBpbWcyID0gbmV4dEltYWdlOyAgICAvLyBUaGUgdGFyZ2V0IGltYWdlDQogICAgICAgIHBpeGJpeGVscyA9IFtdOw0KDQogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICBjdHhiaS5kcmF3SW1hZ2UoaW1nMSwgMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgdmFyIGRhdGExID0gY3R4YmkuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsNCg0KICAgICAgICB2YXIgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgICAgICB2YXIgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IGNhbnZhc2JiaS53aWR0aDsNCiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0Ow0KICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWcyLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICB2YXIgZGF0YTIgPSB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpLmRhdGE7DQoNCiAgICAgICAgLy8gU2FtcGxlIHBpeGVscyB0byBtYW5hZ2UgcGVyZm9ybWFuY2UuIEhpZ2hlciBzYW1wbGUgcmF0ZSA9IGZld2VyIHBhcnRpY2xlcywgYmV0dGVyIHBlcmZvcm1hbmNlLg0KICAgICAgICBjb25zdCBwaXhlbFNhbXBsZVJhdGUgPSAzOyAvLyBTYW1wbGUgZXZlcnkgM3JkIHBpeGVsIGluIHggYW5kIHkNCiAgICAgICAgY29uc3QgbWF4RHJpZnREaXN0YW5jZSA9IDgwOyAvLyBNYXggZGlzdGFuY2UgcGFydGljbGVzIHdpbGwgZHJpZnQgZnJvbSBzb3VyY2UvdGFyZ2V0IGZvciAnZGVjYXknDQoNCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBjYW52YXNiYmkuaGVpZ2h0OyB5ICs9IHBpeGVsU2FtcGxlUmF0ZSkgew0KICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjYW52YXNiYmkud2lkdGg7IHggKz0gcGl4ZWxTYW1wbGVSYXRlKSB7DQogICAgICAgICAgICAgICAgbGV0IGlkeCA9ICh5ICogY2FudmFzYmJpLndpZHRoICsgeCkgKiA0Ow0KDQogICAgICAgICAgICAgICAgbGV0IHIxID0gZGF0YTFbaWR4XSwgZzEgPSBkYXRhMVtpZHgrMV0sIGIxID0gZGF0YTFbaWR4KzJdLCBhMSA9IGRhdGExW2lkeCszXTsNCiAgICAgICAgICAgICAgICBsZXQgcjIgPSBkYXRhMltpZHhdLCBnMiA9IGRhdGEyW2lkeCsxXSwgYjIgPSBkYXRhMltpZHgrMl0sIGEyID0gZGF0YTJbaWR4KzNdOw0KDQogICAgICAgICAgICAgICAgLy8gRGVmaW5lIHJhbmRvbSBkcmlmdCBmb3IgdGhlICJkZWNheSIgcGhhc2UgKGF3YXkgZnJvbSBzdGFydCBwb3NpdGlvbikNCiAgICAgICAgICAgICAgICBsZXQgZHJpZnRYX2RlY2F5ID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogbWF4RHJpZnREaXN0YW5jZTsNCiAgICAgICAgICAgICAgICBsZXQgZHJpZnRZX2RlY2F5ID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogbWF4RHJpZnREaXN0YW5jZTsNCg0KICAgICAgICAgICAgICAgIC8vIERlZmluZSByYW5kb20gc3RhcnRpbmcgcG9pbnQgZm9yIHRoZSAiY29hbGVzY2luZyIgcGhhc2UgKHRvd2FyZHMgdGFyZ2V0IHBvc2l0aW9uKQ0KICAgICAgICAgICAgICAgIC8vIFBhcnRpY2xlcyBmb3IgdGhlIG5leHQgaW1hZ2Ugd2lsbCBhcHBlYXIgZnJvbSBhIHNsaWdodGx5IHJhbmRvbWl6ZWQgZnJhZ21lbnRlZCBwb3NpdGlvbg0KICAgICAgICAgICAgICAgIGxldCBzdGFydFhfY29hbGVzY2UgPSB4ICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogbWF4RHJpZnREaXN0YW5jZTsNCiAgICAgICAgICAgICAgICBsZXQgc3RhcnRZX2NvYWxlc2NlID0geSArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIG1heERyaWZ0RGlzdGFuY2U7DQoNCiAgICAgICAgICAgICAgICBwaXhiaXhlbHMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogeCwNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRZOiB5LA0KICAgICAgICAgICAgICAgICAgICB0YXJnZXRYOiB4LCAvLyBQYXJ0aWNsZXMgc2V0dGxlIGJhY2sgdG8gdGhlaXIgb3JpZ2luYWwgZ3JpZCBwb3NpdGlvbiBmb3IgdGhlIG5leHQgaW1hZ2UNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WTogeSwNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvcjogYHJnYmEoJHtyMX0sJHtnMX0sJHtiMX0sJHthMS8yNTV9KWAsDQogICAgICAgICAgICAgICAgICAgIHRhcmdldENvbG9yOiBgcmdiYSgke3IyfSwke2cyfSwke2IyfSwke2EyLzI1NX0pYCwNCiAgICAgICAgICAgICAgICAgICAgZHJpZnRYX2RlY2F5OiBkcmlmdFhfZGVjYXksDQogICAgICAgICAgICAgICAgICAgIGRyaWZ0WV9kZWNheTogZHJpZnRZX2RlY2F5LA0KICAgICAgICAgICAgICAgICAgICBzdGFydFhfY29hbGVzY2U6IHN0YXJ0WF9jb2FsZXNjZSwNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRZX2NvYWxlc2NlOiBzdGFydFlfY29hbGVzY2UsDQogICAgICAgICAgICAgICAgICAgIHNpemU6IHBpeGVsU2FtcGxlUmF0ZSAvLyBFYWNoIHBhcnRpY2xlIHJlcHJlc2VudHMgdGhlIHNhbXBsZWQgYXJlYQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiBEcmF3cyBwYXJ0aWNsZXMgYmFzZWQgb24gY3VycmVudCBhbmltYXRpb24gZnJhbWUuDQogICAgICovDQogICAgdmFyIEFOSU1BVEUgPSAoKSA9PiB7DQogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgIGxldCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZWJiIC8gdG90YWxGcmFtZXNiYjsNCiAgICAgICAgbGV0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7DQoNCiAgICAgICAgcGl4Yml4ZWxzLmZvckVhY2gocCA9PiB7DQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgY3VycmVudCBjb2xvciBiYXNlZCBvbiBlYXNlZCBwcm9ncmVzcw0KICAgICAgICAgICAgbGV0IGN1cnJlbnRDb2xvciA9IGludGVycG9sYXRlQ29sb3IocC5zdGFydENvbG9yLCBwLnRhcmdldENvbG9yLCBlYXNlZFByb2dyZXNzKTsNCiAgICAgICAgICAgIGxldCBwYXJ0cyA9IHBhcnNlUkdCQShjdXJyZW50Q29sb3IpOw0KDQogICAgICAgICAgICBsZXQgY3VycmVudFgsIGN1cnJlbnRZOw0KICAgICAgICAgICAgbGV0IHBhcnRpY2xlQWxwaGFNdWx0aXBsaWVyID0gMTsgLy8gQ29udHJvbHMgb3ZlcmFsbCBvcGFjaXR5IGZvciBtZW1vcnkgZWZmZWN0DQoNCiAgICAgICAgICAgIGlmIChlYXNlZFByb2dyZXNzIDwgMC41KSB7DQogICAgICAgICAgICAgICAgLy8gUGhhc2UgMTogQ3VycmVudCBpbWFnZSBkZWNheXMgYW5kIGZyYWdtZW50cyAoVW5pdmVyc2UgRW5kZWQpDQogICAgICAgICAgICAgICAgLy8gUGFydGljbGVzIGRyaWZ0IGF3YXkgcmFuZG9tbHkgYW5kIGJlY29tZSBtb3JlIHRyYW5zcGFyZW50Lg0KICAgICAgICAgICAgICAgIGxldCBsb2NhbFByb2dyZXNzID0gZWFzZWRQcm9ncmVzcyAqIDI7IC8vIFNjYWxlcyAwIHRvIDEgb3ZlciB0aGUgZmlyc3QgaGFsZg0KICAgICAgICAgICAgICAgIGN1cnJlbnRYID0gcC5zdGFydFggKyBwLmRyaWZ0WF9kZWNheSAqIGxvY2FsUHJvZ3Jlc3M7DQogICAgICAgICAgICAgICAgY3VycmVudFkgPSBwLnN0YXJ0WSArIHAuZHJpZnRZX2RlY2F5ICogbG9jYWxQcm9ncmVzczsNCiAgICAgICAgICAgICAgICBwYXJ0aWNsZUFscGhhTXVsdGlwbGllciA9IDEgLSBsb2NhbFByb2dyZXNzOyAvLyBGYWRlcyBvdXQNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gUGhhc2UgMjogTmV4dCBpbWFnZSBjb2FsZXNjZXMgZnJvbSBmcmFnbWVudHMgKE1lbW9yeSBSZWNyZWF0aW9uKQ0KICAgICAgICAgICAgICAgIC8vIFBhcnRpY2xlcyBhcHBlYXIgZnJvbSBhIGZyYWdtZW50ZWQgcG9zaXRpb24gYW5kIG1vdmUgdG8gdGhlaXIgdGFyZ2V0LCBmYWRpbmcgaW4uDQogICAgICAgICAgICAgICAgbGV0IGxvY2FsUHJvZ3Jlc3MgPSAoZWFzZWRQcm9ncmVzcyAtIDAuNSkgKiAyOyAvLyBTY2FsZXMgMCB0byAxIG92ZXIgdGhlIHNlY29uZCBoYWxmDQogICAgICAgICAgICAgICAgY3VycmVudFggPSBwLnN0YXJ0WF9jb2FsZXNjZSArIChwLnRhcmdldFggLSBwLnN0YXJ0WF9jb2FsZXNjZSkgKiBsb2NhbFByb2dyZXNzOw0KICAgICAgICAgICAgICAgIGN1cnJlbnRZID0gcC5zdGFydFlfY29hbGVzY2UgKyAocC50YXJnZXRZIC0gcC5zdGFydFlfY29hbGVzY2UpICogbG9jYWxQcm9ncmVzczsNCiAgICAgICAgICAgICAgICBwYXJ0aWNsZUFscGhhTXVsdGlwbGllciA9IGxvY2FsUHJvZ3Jlc3M7IC8vIEZhZGVzIGluDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEFwcGx5IGEgc2xpZ2h0ICJtZW1vcnkgZmxpY2tlciIgb3IgIm5vaXNlIiBlZmZlY3QgdG8gYWxwaGENCiAgICAgICAgICAgIC8vIFRoaXMgbWFrZXMgdGhlIHRyYW5zaXRpb24gZmVlbCBsZXNzIHBlcmZlY3QsIGxpa2UgYSByZWNhbGxlZCBtZW1vcnkuDQogICAgICAgICAgICBsZXQgZmxpY2tlckZhY3RvciA9IDE7DQogICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IDAuMSkgeyAvLyAxMCUgY2hhbmNlIGZvciBhIHBhcnRpY2xlIHRvIGZsaWNrZXINCiAgICAgICAgICAgICAgICBmbGlja2VyRmFjdG9yID0gMC42ICsgTWF0aC5yYW5kb20oKSAqIDAuNDsgLy8gUmFuZG9tIG9wYWNpdHkgZnJvbSA2MCUgdG8gMTAwJQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBgcmdiYSgke3BhcnRzLnJ9LCAke3BhcnRzLmd9LCAke3BhcnRzLmJ9LCAke3BhcnRzLmEgKiBwYXJ0aWNsZUFscGhhTXVsdGlwbGllciAqIGZsaWNrZXJGYWN0b3J9KWA7DQogICAgICAgICAgICBjdHhiaS5maWxsUmVjdChjdXJyZW50WCwgY3VycmVudFksIHAuc2l6ZSwgcC5zaXplKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgew0KICAgICAgICAgICAgY3VycmVudEZyYW1lYmIrKzsNCiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShBTklNQVRFKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4gUHJlcGFyZSB0aGUgbmV4dCByb3VuZCAoQiAtPiBDKS4NCg0KICAgICAgICAgICAgLy8gMS4gRHJhdyB0aGUgZmluYWwgaW1hZ2UgKEIpIHRvIHRoZSBjYW52YXMgdG8gY29tcGxldGVseSBjb3ZlciB0aGUgdHJhbnNpdGlvbiBwaXhlbHMuDQogICAgICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgICAgIC8vIDIuIFNXQVAgT0JKRUNUUzogVGhlIG9sZCB0YXJnZXQgaW1hZ2Ugb2JqZWN0IChCKSBpcyB0aGUgbmV3IHN0YXJ0IGltYWdlIG9iamVjdCAoQSkuDQogICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7DQoNCiAgICAgICAgICAgIC8vIDMuIFNXQVAgVVJMUzogVGhlIG9sZCB0YXJnZXQgVVJMIChCKSBpcyB0aGUgbmV3IHN0YXJ0IFVSTCAoQSkuDQogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsNCg0KICAgICAgICAgICAgLy8gNC4gR0VORVJBVEUgTkVXIFRBUkdFVCBVUkwgKEMpDQogICAgICAgICAgICBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCg0KICAgICAgICAgICAgLy8gNS4gU3RhcnQgdGhlIGxvYWQgcHJvY2VzcyBmb3IgdGhlIG5leHQgaW1hZ2UgKEMpLiBObyBkZWxheSBuZWVkZWQgaGVyZS4NCiAgICAgICAgICAgIHNldFRpbWVvdXQoImxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIiwgMTUwMCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYW5kIHN0YXJ0cyB0aGUgYW5pbWF0aW9uIHNlcXVlbmNlLg0KICAgICAqLw0KICAgIHZhciBzdGFydEFuaW1hdGlvbmZ0ID0gKCkgPT4gew0KICAgICAgICBjdXJyZW50RnJhbWViYiA9IDA7DQogICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOw0KICAgICAgICBBTklNQVRFKCk7DQogICAgfTsNCg0KICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tDQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpbml0Q2FudmFzQW5kSW1hZ2VzKCk7DQogICAgfTsNCjwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg==<br>PGh0bWwgbGFuZz0iZW4iPg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPg0KICAgIDx0aXRsZT5NZW1vcnkgR2xpdGNoIFRyYW5zaXRpb248L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgDQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgDQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgIA0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCBUYWhvbWEsIEdlbmV2YSwgVmVyZGFuYSwgc2Fucy1zZXJpZjsNCiAgICAgICAgICAgIGNvbG9yOiAjY2NjOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogQ29udGFpbmVyIGZvciB0aGUgY2FudmFzL2JhY2tncm91bmQgaW1hZ2UgKi8NCiAgICAgICAgY2FudmFzIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyAgLyogTWF0Y2ggY2FudmFzIHdpZHRoICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7ICAvKiBNYXRjaCBjYW52YXMgaGVpZ2h0ICovDQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOyAvKiBCbGFjayBiYWNrZ3JvdW5kIGZvciBnbGl0Y2hlcyAqLw0KDQogICAgICAgICAgICBib3JkZXI6IDBweCBzb2xpZCAjMGZmOyAvKiBTdWJ0bGUgZ2xvdyBib3JkZXIgKi8NCiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IC8qIEVuc3VyZSBibG9ja3MgZG9uJ3QgZ28gb3V0c2lkZSAqLw0KICAgICAgICB9DQoNCiAgICAgICAgLyogVGhlIGNhbnZhcyBpdHNlbGYgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgIH0NCg0KICAgICAgICAjdGl0bGUgew0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS41ZW07DQogICAgICAgICAgICBjb2xvcjogIzBmZjsNCgkJZGlzcGxheTpub25lOw0KICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCAxMHB4IHJnYmEoMCwgMjU1LCAyNTUsIDAuOCk7DQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KPC9oZWFkPg0KPGJvZHk+DQo8ZGl2IGlkPSJ0aXRsZSI+V2hhdCBJZiBUaGUgVW5pdmVyc2UgQWxyZWFkeSBFbmRlZCBhbmQgRXZlcnl0aGluZyBJcyBKdXN0IE1lbW9yeT88L2Rpdj4NCjxkaXYgaWQ9J2NhbnZhcyc+DQogICAgPGNhbnZhcyBpZD0nYW5pbWF0aW9uQ2FudmFzJyB3aWR0aD04MDAgaGVpZ2h0PTQ1MCBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJSc+PC9jYW52YXM+DQo8L2Rpdj4NCjxzY3JpcHQ+DQogICAgLy8gLS0tIEltYWdlIFNvdXJjZSBhbmQgT2JqZWN0IFN0b3JhZ2UgLS0tDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpVUkwqIG9mIHRoZSBjdXJyZW50bHkgbG9hZGVkIGltYWdlIHNldA0KICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCiAgICB2YXIgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAvLyBWYXJpYWJsZXMgdG8gaG9sZCB0aGUgKkFjdHVhbCBJbWFnZSBPYmplY3RzKiBmb3IgdGhlIGFuaW1hdGlvbg0KICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOyAvLyBJbWFnZSBBIChUaGUgU3RhcnQpDQogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpDQoNCiAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tDQogICAgdmFyIGNhbnZhc2JiaTsNCiAgICB2YXIgY3R4Ymk7DQogICAgdmFyIGltYWdlc2JpID0ge307ICAgICAgICAvLyBTdG9yZXMgQUxMIGxvYWRlZCBJbWFnZSBvYmplY3RzIChrZXllZCBieSBVUkwpDQogICAgdmFyIHBpeGJpeGVscyA9IFtdOyAgICAgICAvLyBTdG9yZXMgYW5pbWF0aW9uIGJsb2NrIGRhdGENCg0KICAgIHZhciB0b3RhbEZyYW1lc2JiID0gNzU7ICAvLyBJbmNyZWFzZWQgZnJhbWVzIGZvciBhIHNtb290aGVyLCBtb3JlIGRlbGliZXJhdGUgdHJhbnNpdGlvbg0KICAgIHZhciBjdXJyZW50RnJhbWViYiA9IDA7DQoNCiAgICAvLyBEaW1lbnNpb25zIGZvciB0aGUgY2FudmFzIGVsZW1lbnQgKE1BVENISU5HIFBJQ1NVTS5QSE9UT1MgUkVTT0xVVElPTikNCiAgICB2YXIgYnJlZWQzNjAgPSA4MDA7ICAvLyAgICAgIC8vIENhbnZhcyB3aWR0aA0KICAgIHZhciBob29nMTgwID0gNDUwOyAvLyAgICAgLy8gQ2FudmFzIGhlaWdodA0KDQogICAgLy8gQW5pbWF0aW9uIHNwZWNpZmljIHNldHRpbmdzDQogICAgdmFyIHBpeGVsQmxvY2tTaXplID0gMTA7IC8vIFNpemUgb2YgZWFjaCAibWVtb3J5IGJsb2NrIiAoZS5nLiwgMTB4MTAgcGl4ZWxzKQ0KICAgIHZhciBtYXhTY2F0dGVyT2Zmc2V0ID0gNDA7IC8vIE1heCBwaXhlbHMgYSBibG9jayBjYW4gc2NhdHRlcg0KICAgIHZhciBkZXNhdHVyYXRpb25TdHJlbmd0aCA9IDAuODsgLy8gSG93IG11Y2ggYSBibG9jayBkZXNhdHVyYXRlcyBkdXJpbmcgdHJhbnNpdGlvbiAoMC0xKQ0KDQogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tDQogICAgLyoqDQogICAgICogTG9hZHMgYSBzaW5nbGUgaW1hZ2UgaW50byB0aGUgaW1hZ2VzYmkgbWFwLg0KICAgICAqLw0KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7DQogICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsNCiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7DQogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsNCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLnNyYyA9IHNyYzsNCiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIExvYWRzIHRoZSBuZXh0IGltYWdlIGluIHRoZSBzZXF1ZW5jZSBhbmQgc3RhcnRzIHRoZSB0cmFuc2l0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsNCiAgICAgICAgbGV0IG5ld0ltYWdlVVJMID0gbmV4dFVSTDsNCiAgICAgICAgaWYgKGltYWdlc2JpW25ld0ltYWdlVVJMXSkgew0KICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdOw0KICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbG9hZEltYWdlYmIobmV3SW1hZ2VVUkwsIChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWc7DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGNhbnZhcyBhbmQgbG9hZHMgdGhlIGluaXRpYWwgdHdvIGltYWdlcyAoQSBhbmQgQikuDQogICAgICovDQogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsNCiAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOw0KICAgICAgICBjYW52YXNiYmkud2lkdGggPSBicmVlZDM2MDsNCiAgICAgICAgY2FudmFzYmJpLmhlaWdodCA9IGhvb2cxODA7DQogICAgICAgIGN0eGJpID0gY2FudmFzYmJpLmdldENvbnRleHQoJzJkJyk7DQoNCiAgICAgICAgbGV0IGltYWdlc1RvTG9hZCA9IFtjdXJyZW50VVJMLCBuZXh0VVJMXTsNCiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsNCiAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7DQoNCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICBpZiAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBoYXNFcnJvciA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2FkZWRDb3VudCsrOw0KICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgaWYgKCFoYXNFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBpbWFnZXNiaVtjdXJyZW50VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV4dFVSTF07DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgIH0NCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICAvLyAocGFyc2VSR0JBIGFuZCBpbnRlcnBvbGF0ZUNvbG9yIGFyZSBub3QgdXNlZCBpbiB0aGUgbmV3IGFuaW1hdGlvbiBsb2dpYywgYnV0IGtlcHQgZm9yIGZyYW1ld29yayBjb25zaXN0ZW5jeSkNCiAgICB2YXIgcGFyc2VSR0JBID0gKHJnYmFTdHJpbmcpID0+IHsNCiAgICAgICAgdmFyIHBhcnRzID0gcmdiYVN0cmluZy5tYXRjaCgvXGQrKFwuXGQrKT8vZykubWFwKE51bWJlcik7DQogICAgICAgIHJldHVybiB7IHI6IHBhcnRzWzBdLCBnOiBwYXJ0c1sxXSwgYjogcGFydHNbMl0sIGE6IHBhcnRzWzNdIHx8IDEgfTsNCiAgICB9Ow0KICAgIHZhciBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gew0KICAgICAgICB2YXIgYzEgPSBwYXJzZVJHQkEoY29sb3IxKTsNCiAgICAgICAgdmFyIGMyID0gcGFyc2VSR0JBKGNvbG9yMik7DQogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjMS5yICsgKGMyLnIgLSBjMS5yKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKGMxLmcgKyAoYzIuZyAtIGMxLmcpICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgYiA9IE1hdGgucm91bmQoYzEuYiArIChjMi5iIC0gYzEuYikgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBhID0gYzEuYSArIChjMi5hIC0gYzEuYSkgKiBwcm9ncmVzczsNCiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7YX0pYDsNCiAgICB9Ow0KICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsNCg0KICAgIC8qKg0KICAgICAqIEhlbHBlciB0byBnZXQgYXZlcmFnZSBjb2xvciBmb3IgYSBibG9jayBmcm9tIEltYWdlRGF0YS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRBdmVyYWdlQ29sb3JGb3JCbG9jayhkYXRhLCBzdGFydFgsIHN0YXJ0WSwgYmxvY2tTaXplLCBpbWdXaWR0aCwgaW1nSGVpZ2h0KSB7DQogICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBjb3VudCA9IDA7DQogICAgICAgIGZvciAobGV0IHkgPSBzdGFydFk7IHkgPCBNYXRoLm1pbihzdGFydFkgKyBibG9ja1NpemUsIGltZ0hlaWdodCk7IHkrKykgew0KICAgICAgICAgICAgZm9yIChsZXQgeCA9IHN0YXJ0WDsgeCA8IE1hdGgubWluKHN0YXJ0WCArIGJsb2NrU2l6ZSwgaW1nV2lkdGgpOyB4KyspIHsNCiAgICAgICAgICAgICAgICBsZXQgaSA9ICh5ICogaW1nV2lkdGggKyB4KSAqIDQ7DQogICAgICAgICAgICAgICAgciArPSBkYXRhW2ldOw0KICAgICAgICAgICAgICAgIGcgKz0gZGF0YVtpICsgMV07DQogICAgICAgICAgICAgICAgYiArPSBkYXRhW2kgKyAyXTsNCiAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjb3VudCA+IDAgPyB7IHI6IE1hdGgucm91bmQociAvIGNvdW50KSwgZzogTWF0aC5yb3VuZChnIC8gY291bnQpLCBiOiBNYXRoLnJvdW5kKGIgLyBjb3VudCksIGE6IDEgfSA6IHsgcjogMCwgZzogMCwgYjogMCwgYTogMSB9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFByZXBhcmVzIHBpeGVsIGJsb2NrIGRhdGEgZm9yIHRoZSBhbmltYXRpb24uDQogICAgICovDQogICAgdmFyIHNldHVwSW5pdGlhbENhbnZhcyA9ICgpID0+IHsNCiAgICAgICAgdmFyIGltZzEgPSBjdXJyZW50SW1hZ2U7IC8vIFRoZSBzdGFydCBpbWFnZQ0KICAgICAgICB2YXIgaW1nMiA9IG5leHRJbWFnZTsgICAgLy8gVGhlIHRhcmdldCBpbWFnZQ0KICAgICAgICBwaXhiaXhlbHMgPSBbXTsgICAgICAgICAgLy8gUmVzZXQgcGl4ZWwgZGF0YSBmb3IgdGhlIG5ldyB0cmFuc2l0aW9uDQoNCiAgICAgICAgLy8gRHJhdyBjdXJyZW50IGltYWdlIHRvIGdldCBpdHMgcGl4ZWwgZGF0YQ0KICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGltZzEsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICAgICAgdmFyIGltYWdlRGF0YTEgPSBjdHhiaS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgdmFyIGRhdGExID0gaW1hZ2VEYXRhMS5kYXRhOw0KDQogICAgICAgIC8vIERyYXcgbmV4dCBpbWFnZSB0byBhIHRlbXBvcmFyeSBjYW52YXMgdG8gZ2V0IGl0cyBwaXhlbCBkYXRhDQogICAgICAgIHZhciB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gY2FudmFzYmJpLndpZHRoOw0KICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7DQogICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKGltZzIsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICAgICAgdmFyIGltYWdlRGF0YTIgPSB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICB2YXIgZGF0YTIgPSBpbWFnZURhdGEyLmRhdGE7DQoNCiAgICAgICAgLy8gUG9wdWxhdGUgcGl4Yml4ZWxzIHdpdGggYmxvY2sgZGF0YQ0KICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IGNhbnZhc2JiaS5oZWlnaHQ7IHkgKz0gcGl4ZWxCbG9ja1NpemUpIHsNCiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgY2FudmFzYmJpLndpZHRoOyB4ICs9IHBpeGVsQmxvY2tTaXplKSB7DQogICAgICAgICAgICAgICAgdmFyIGJsb2NrV2lkdGggPSBNYXRoLm1pbihwaXhlbEJsb2NrU2l6ZSwgY2FudmFzYmJpLndpZHRoIC0geCk7DQogICAgICAgICAgICAgICAgdmFyIGJsb2NrSGVpZ2h0ID0gTWF0aC5taW4ocGl4ZWxCbG9ja1NpemUsIGNhbnZhc2JiaS5oZWlnaHQgLSB5KTsNCg0KICAgICAgICAgICAgICAgIHZhciBhdmdDb2xvcjEgPSBnZXRBdmVyYWdlQ29sb3JGb3JCbG9jayhkYXRhMSwgeCwgeSwgcGl4ZWxCbG9ja1NpemUsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICAgICAgdmFyIGF2Z0NvbG9yMiA9IGdldEF2ZXJhZ2VDb2xvckZvckJsb2NrKGRhdGEyLCB4LCB5LCBwaXhlbEJsb2NrU2l6ZSwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgeDogeCwNCiAgICAgICAgICAgICAgICAgICAgeTogeSwNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGJsb2NrV2lkdGgsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodDogYmxvY2tIZWlnaHQsDQogICAgICAgICAgICAgICAgICAgIGNvbG9yMTogYXZnQ29sb3IxLA0KICAgICAgICAgICAgICAgICAgICBjb2xvcjI6IGF2Z0NvbG9yMiwNCiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbE9mZnNldFg6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIG1heFNjYXR0ZXJPZmZzZXQsIC8vIFJhbmRvbSBzY2F0dGVyIGRpc3RhbmNlDQogICAgICAgICAgICAgICAgICAgIGluaXRpYWxPZmZzZXRZOiAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBtYXhTY2F0dGVyT2Zmc2V0LA0KICAgICAgICAgICAgICAgICAgICAvLyBTdGFnZ2VyIHN0YXJ0IGZvciBibG9ja3MgdG8gY3JlYXRlIGEgZnJhZ21lbnRlZCBhcHBlYXJhbmNlDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0RnJhbWVPZmZzZXQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHRvdGFsRnJhbWVzYmIgKiAwLjQpDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogTWFpbiBhbmltYXRpb24gbG9vcC4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwaXhiaXhlbHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBwaXhlbEJsb2NrID0gcGl4Yml4ZWxzW2ldOw0KICAgICAgICAgICAgdmFyIGVmZmVjdGl2ZUZyYW1lID0gY3VycmVudEZyYW1lYmIgLSBwaXhlbEJsb2NrLnN0YXJ0RnJhbWVPZmZzZXQ7DQoNCiAgICAgICAgICAgIC8vIElmIHRoaXMgYmxvY2sgaGFzbid0IHN0YXJ0ZWQgdHJhbnNpdGlvbmluZywgZHJhdyBpdCBhcyBwYXJ0IG9mIHRoZSBjdXJyZW50IGltYWdlDQogICAgICAgICAgICBpZiAoZWZmZWN0aXZlRnJhbWUgPCAwKSB7DQogICAgICAgICAgICAgICAgY3R4YmkuZmlsbFN0eWxlID0gYHJnYmEoJHtwaXhlbEJsb2NrLmNvbG9yMS5yfSwgJHtwaXhlbEJsb2NrLmNvbG9yMS5nfSwgJHtwaXhlbEJsb2NrLmNvbG9yMS5ifSwgMSlgOw0KICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KHBpeGVsQmxvY2sueCwgcGl4ZWxCbG9jay55LCBwaXhlbEJsb2NrLndpZHRoLCBwaXhlbEJsb2NrLmhlaWdodCk7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBwcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KGVmZmVjdGl2ZUZyYW1lIC8gKHRvdGFsRnJhbWVzYmIgLSBwaXhlbEJsb2NrLnN0YXJ0RnJhbWVPZmZzZXQpKTsNCiAgICAgICAgICAgIGlmIChwcm9ncmVzcyA+IDEpIHByb2dyZXNzID0gMTsgLy8gQ2FwIHByb2dyZXNzIGF0IDENCg0KICAgICAgICAgICAgdmFyIGN1cnJlbnRBbHBoYTsNCiAgICAgICAgICAgIHZhciBjdXJyZW50T2Zmc2V0WCwgY3VycmVudE9mZnNldFk7DQogICAgICAgICAgICB2YXIgZHJhd0NvbG9yOw0KDQogICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPCAwLjUpIHsgLy8gUGhhc2UgMTogRGlzc29sdmluZyBPbGQgTWVtb3J5IChJbWFnZSAxIGZhZGVzIG91dCwgc2NhdHRlcnMpDQogICAgICAgICAgICAgICAgY3VycmVudEFscGhhID0gMSAtIChwcm9ncmVzcyAqIDIpOw0KICAgICAgICAgICAgICAgIGN1cnJlbnRPZmZzZXRYID0gcGl4ZWxCbG9jay5pbml0aWFsT2Zmc2V0WCAqIHByb2dyZXNzICogMjsNCiAgICAgICAgICAgICAgICBjdXJyZW50T2Zmc2V0WSA9IHBpeGVsQmxvY2suaW5pdGlhbE9mZnNldFkgKiBwcm9ncmVzcyAqIDI7DQogICAgICAgICAgICAgICAgZHJhd0NvbG9yID0geyAuLi5waXhlbEJsb2NrLmNvbG9yMSB9OyAvLyBDbG9uZSBjb2xvciB0byBtb2RpZnkNCiAgICAgICAgICAgIH0gZWxzZSB7IC8vIFBoYXNlIDI6IFJlY29uc3RydWN0aW5nIE5ldyBNZW1vcnkgKEltYWdlIDIgZmFkZXMgaW4sIHJlYXNzZW1ibGVzKQ0KICAgICAgICAgICAgICAgIGN1cnJlbnRBbHBoYSA9IChwcm9ncmVzcyAtIDAuNSkgKiAyOw0KICAgICAgICAgICAgICAgIC8vIE1vdmUgYmFjayB0byBvcmlnaW5hbCBwb3NpdGlvbg0KICAgICAgICAgICAgICAgIGN1cnJlbnRPZmZzZXRYID0gcGl4ZWxCbG9jay5pbml0aWFsT2Zmc2V0WCAqICgxIC0gKHByb2dyZXNzIC0gMC41KSAqIDIpOw0KICAgICAgICAgICAgICAgIGN1cnJlbnRPZmZzZXRZID0gcGl4ZWxCbG9jay5pbml0aWFsT2Zmc2V0WSAqICgxIC0gKHByb2dyZXNzIC0gMC41KSAqIDIpOw0KICAgICAgICAgICAgICAgIGRyYXdDb2xvciA9IHsgLi4ucGl4ZWxCbG9jay5jb2xvcjIgfTsgLy8gQ2xvbmUgY29sb3INCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gQXBwbHkgYSBzdWJ0bGUgZGVzYXR1cmF0aW9uL3RpbnQgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdHJhbnNpdGlvbiB0byBlbXBoYXNpemUgbWVtb3J5IGZhZGUNCiAgICAgICAgICAgIGlmIChwcm9ncmVzcyA+IDAuMiAmJiBwcm9ncmVzcyA8IDAuOCkgew0KICAgICAgICAgICAgICAgIGxldCBkZXNhdHVyYXRpb25Qcm9ncmVzcyA9IE1hdGguc2luKE1hdGguUEkgKiAocHJvZ3Jlc3MgLSAwLjIpIC8gMC42KTsgLy8gUGVha3MgYXJvdW5kIDAuNQ0KICAgICAgICAgICAgICAgIGRlc2F0dXJhdGlvblByb2dyZXNzICo9IGRlc2F0dXJhdGlvblN0cmVuZ3RoOyAvLyBTY2FsZSBieSBzdHJlbmd0aA0KDQogICAgICAgICAgICAgICAgbGV0IGdyYXkgPSAwLjI5OSAqIGRyYXdDb2xvci5yICsgMC41ODcgKiBkcmF3Q29sb3IuZyArIDAuMTE0ICogZHJhd0NvbG9yLmI7DQogICAgICAgICAgICAgICAgZHJhd0NvbG9yLnIgPSBNYXRoLnJvdW5kKGRyYXdDb2xvci5yICogKDEgLSBkZXNhdHVyYXRpb25Qcm9ncmVzcykgKyBncmF5ICogZGVzYXR1cmF0aW9uUHJvZ3Jlc3MpOw0KICAgICAgICAgICAgICAgIGRyYXdDb2xvci5nID0gTWF0aC5yb3VuZChkcmF3Q29sb3IuZyAqICgxIC0gZGVzYXR1cmF0aW9uUHJvZ3Jlc3MpICsgZ3JheSAqIGRlc2F0dXJhdGlvblByb2dyZXNzKTsNCiAgICAgICAgICAgICAgICBkcmF3Q29sb3IuYiA9IE1hdGgucm91bmQoZHJhd0NvbG9yLmIgKiAoMSAtIGRlc2F0dXJhdGlvblByb2dyZXNzKSArIGdyYXkgKiBkZXNhdHVyYXRpb25Qcm9ncmVzcyk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9IGByZ2JhKCR7ZHJhd0NvbG9yLnJ9LCAke2RyYXdDb2xvci5nfSwgJHtkcmF3Q29sb3IuYn0sICR7Y3VycmVudEFscGhhfSlgOw0KICAgICAgICAgICAgY3R4YmkuZmlsbFJlY3QocGl4ZWxCbG9jay54ICsgY3VycmVudE9mZnNldFgsIHBpeGVsQmxvY2sueSArIGN1cnJlbnRPZmZzZXRZLCBwaXhlbEJsb2NrLndpZHRoLCBwaXhlbEJsb2NrLmhlaWdodCk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7DQogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOw0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLg0KDQogICAgICAgICAgICAvLyAxLiBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgdG8gdGhlIGNhbnZhcyB0byBjb21wbGV0ZWx5IGNvdmVyIHRoZSB0cmFuc2l0aW9uIHBpeGVscy4NCiAgICAgICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICAgICAgY3R4YmkuZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgLy8gMi4gU1dBUCBPQkpFQ1RTOiBUaGUgb2xkIHRhcmdldCBpbWFnZSBvYmplY3QgKEIpIGlzIHRoZSBuZXcgc3RhcnQgaW1hZ2Ugb2JqZWN0IChBKS4NCiAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IG5leHRJbWFnZTsNCg0KICAgICAgICAgICAgLy8gMy4gU1dBUCBVUkxTOiBUaGUgb2xkIHRhcmdldCBVUkwgKEIpIGlzIHRoZSBuZXcgc3RhcnQgVVJMIChBKS4NCiAgICAgICAgICAgIGN1cnJlbnRVUkwgPSBuZXh0VVJMOw0KDQogICAgICAgICAgICAvLyA0LiBHRU5FUkFURSBORVcgVEFSR0VUIFVSTCAoQykNCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuDQogICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOw0KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsNCiAgICAgICAgQU5JTUFURSgpOw0KICAgIH07DQoNCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQ0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOw0KICAgIH07DQo8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=<br>PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPHRpdGxlPkNvbnRpbnVvdXMgSW1hZ2UgVHJhbnNpdGlvbiBGaXg8L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgIH0NCg0KICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMvYmFja2dyb3VuZCBpbWFnZSAqLw0KICAgICAgICAjY2FudmFzIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOiAxMDAlIDEwMCU7DQogICAgICAgICAgICAvKiBBZGRlZCBhIGJvcmRlciB0byBlYXNpbHkgc2VlIHRoZSBjYW52YXMgYXJlYSAqLw0KICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzU1NTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovDQogICAgICAgICNhbmltYXRpb25DYW52YXMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KICAgIDxkaXYgaWQ9J2NhbnZhcycgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Jz4NCiAgICAgICAgPGNhbnZhcyBpZD0nYW5pbWF0aW9uQ2FudmFzJyB3aWR0aD04MDAgaGVpZ2h0PTQ1MCBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJSc+PC9jYW52YXM+DQogICAgPC9kaXY+DQogICAgPHNjcmlwdD4NCiAgICAgICAgLy8gLS0tIEltYWdlIFNvdXJjZSBhbmQgT2JqZWN0IFN0b3JhZ2UgLS0tDQogICAgICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqVVJMKiBvZiB0aGUgY3VycmVudGx5IGxvYWRlZCBpbWFnZSBzZXQNCiAgICAgICAgdmFyIGN1cnJlbnRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KICAgICAgICB2YXIgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAgICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpBY3R1YWwgSW1hZ2UgT2JqZWN0cyogZm9yIHRoZSBhbmltYXRpb24NCiAgICAgICAgdmFyIGN1cnJlbnRJbWFnZSA9IG51bGw7IC8vIEltYWdlIEEgKFRoZSBTdGFydCkNCiAgICAgICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpDQoNCiAgICAgICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQ0KICAgICAgICB2YXIgY2FudmFzYmJpOw0KICAgICAgICB2YXIgY3R4Ymk7DQogICAgICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQ0KICAgICAgICB2YXIgcGl4Yml4ZWxzID0gW107ICAgIC8vIEFycmF5IHRvIHN0b3JlIHBpeGVsIGRhdGEgb2JqZWN0cyBmb3IgdGhlIHRyYW5zaXRpb24NCg0KICAgICAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDYwOyAvLyBJbmNyZWFzZWQgZnJhbWVzIGZvciBhIHNtb290aGVyLCBzbG93ZXIgdHJhbnNpdGlvbg0KICAgICAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOw0KDQogICAgICAgIC8vIERpbWVuc2lvbnMgZm9yIHRoZSBjYW52YXMgZWxlbWVudCAoZnJvbSBvcmlnaW5hbCBmcmFtZXdvcmspDQogICAgICAgIHZhciBicmVlZDM2MCA9IDgwMDsgIC8vMzUwOw0KICAgICAgICB2YXIgaG9vZzE4MCA9IDQ1MDsgLy8NCiAgICAgICAgdmFyIGNlbnRlclggPSBicmVlZDM2MCAvIDI7DQogICAgICAgIHZhciBjZW50ZXJZID0gaG9vZzE4MCAvIDI7DQogICAgICAgIC8vIE1heGltdW0gZGlzdGFuY2UgZnJvbSBjZW50ZXIgKGh5cG90ZW51c2Ugb2YgaGFsZi13aWR0aCBhbmQgaGFsZi1oZWlnaHQpDQogICAgICAgIHZhciBtYXhEaXN0YW5jZSA9IE1hdGguc3FydChjZW50ZXJYICogY2VudGVyWCArIGNlbnRlclkgKiBjZW50ZXJZKTsNCg0KICAgICAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0NCiAgICAgICAgLyoqDQogICAgICAgICAqIExvYWRzIGEgc2luZ2xlIGltYWdlIGludG8gdGhlIGltYWdlc2JpIG1hcC4NCiAgICAgICAgICovDQogICAgICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7DQogICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7DQogICAgICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7DQogICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgaW1nKTsNCiAgICAgICAgICAgIH07DQogICAgICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCk7DQogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIGltZy5zcmMgPSBzcmM7DQogICAgICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgaW4gdGhlIHNlcXVlbmNlIGFuZCBzdGFydHMgdGhlIHRyYW5zaXRpb24uDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7DQogICAgICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOw0KICAgICAgICAgICAgaWYgKGltYWdlc2JpW25ld0ltYWdlVVJMXSkgew0KICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWc7DQogICAgICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsNCiAgICAgICAgICAgIC8vIEluaXRpYWxpemUgY2FudmFzIE9OTFkgT05DRQ0KICAgICAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOw0KICAgICAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7DQogICAgICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgICAgIGN0eGJpID0gY2FudmFzYmJpLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgICAgICBsZXQgbG9hZGVkQ291bnQgPSAwOw0KICAgICAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBoYXNFcnJvciA9IHRydWU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGxvYWRlZENvdW50Kys7DQogICAgICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc2JpW2N1cnJlbnRVUkxdOw0KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV4dFVSTF07DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgdmVyeSBmaXJzdCBhbmltYXRpb24gKEEgLT4gQikNCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gLS0tIFBpeGVsIGFuZCBFYXNpbmcgVXRpbGl0aWVzIC0tLQ0KICAgICAgICAvKiogQ29udmVydHMgUkdCQSBkYXRhIGFycmF5ICgwLTI1NSkgdG8gYSBjb2xvciBvYmplY3QuICovDQogICAgICAgIHZhciBnZXREYXRhQ29sb3IgPSAoZGF0YSwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICByZXR1cm4geyByOiBkYXRhW2luZGV4XSwgZzogZGF0YVtpbmRleCArIDFdLCBiOiBkYXRhW2luZGV4ICsgMl0sIGE6IGRhdGFbaW5kZXggKyAzXSAvIDI1NSB9Ow0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKiBJbnRlcnBvbGF0ZXMgYmV0d2VlbiB0d28gY29sb3Igb2JqZWN0cy4gKi8NCiAgICAgICAgdmFyIGludGVycG9sYXRlQ29sb3IgPSAoYzEsIGMyLCBwcm9ncmVzcykgPT4gew0KICAgICAgICAgICAgdmFyIHIgPSBNYXRoLnJvdW5kKGMxLnIgKyAoYzIuciAtIGMxLnIpICogcHJvZ3Jlc3MpOw0KICAgICAgICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKGMxLmcgKyAoYzIuZyAtIGMxLmcpICogcHJvZ3Jlc3MpOw0KICAgICAgICAgICAgdmFyIGIgPSBNYXRoLnJvdW5kKGMxLmIgKyAoYzIuYiAtIGMxLmIpICogcHJvZ3Jlc3MpOw0KICAgICAgICAgICAgdmFyIGEgPSBjMS5hICsgKGMyLmEgLSBjMS5hKSAqIHByb2dyZXNzOyAvLyBBbHBoYSBpcyB1c3VhbGx5IGEgZmxvYXQgKDAtMSkNCiAgICAgICAgICAgIHJldHVybiBgcmdiYSgke3J9LCAke2d9LCAke2J9LCAke2F9KWA7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBFeHRyYWN0cyBpbWFnZSBkYXRhIGZvciBib3RoIGltYWdlcyBhbmQgcHJlcGFyZXMgdGhlIHBpeGJpeGVscyBhcnJheS4NCiAgICAgICAgICogVGhlIGNvcmUgb2YgdGhlIHJpbmctbW9ycGggbG9naWMgaXMgaGVyZS4NCiAgICAgICAgICovDQogICAgICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7DQogICAgICAgICAgICB2YXIgaW1nMSA9IGN1cnJlbnRJbWFnZTsgLy8gVGhlIHN0YXJ0IGltYWdlIChBKQ0KICAgICAgICAgICAgdmFyIGltZzIgPSBuZXh0SW1hZ2U7ICAgIC8vIFRoZSB0YXJnZXQgaW1hZ2UgKEIpDQogICAgICAgICAgICBwaXhiaXhlbHMgPSBbXTsNCg0KICAgICAgICAgICAgLy8gVXNlIHRlbXBvcmFyeSBjYW52YXNlcyB0byBnZXQgcGl4ZWwgZGF0YSBmcm9tIGJvdGggaW1hZ2VzDQogICAgICAgICAgICB2YXIgdGVtcENhbnZhczEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgICAgIHZhciB0ZW1wQ3R4MSA9IHRlbXBDYW52YXMxLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICB0ZW1wQ2FudmFzMS53aWR0aCA9IGJyZWVkMzYwOw0KICAgICAgICAgICAgdGVtcENhbnZhczEuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgICAgIHRlbXBDdHgxLmRyYXdJbWFnZShpbWcxLCAwLCAwICwgYnJlZWQzNjAsIGhvb2cxODApOw0KICAgICAgICAgICAgdmFyIGRhdGExID0gdGVtcEN0eDEuZ2V0SW1hZ2VEYXRhKDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKS5kYXRhOw0KDQogICAgICAgICAgICB2YXIgdGVtcENhbnZhczIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgICAgIHZhciB0ZW1wQ3R4MiA9IHRlbXBDYW52YXMyLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICB0ZW1wQ2FudmFzMi53aWR0aCA9IGJyZWVkMzYwOw0KICAgICAgICAgICAgdGVtcENhbnZhczIuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgICAgIHRlbXBDdHgyLmRyYXdJbWFnZShpbWcyLCAwLCAwLCBicmVlZDM2MCwgaG9vZzE4MCk7DQogICAgICAgICAgICB2YXIgZGF0YTIgPSB0ZW1wQ3R4Mi5nZXRJbWFnZURhdGEoMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApLmRhdGE7DQoNCiAgICAgICAgICAgIC8vIEltbWVkaWF0ZWx5IGRyYXcgdGhlIHN0YXJ0IGltYWdlIChBKSB0byB0aGUgbWFpbiBjYW52YXMNCiAgICAgICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGltZzEsIDAsIDAgLCBicmVlZDM2MCwgaG9vZzE4MCk7DQoNCiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBwaXhiaXhlbHMgYXJyYXkgd2l0aCBtb3JwaGluZyBkYXRhDQogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhvb2cxODA7IHkrKykgew0KICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgYnJlZWQzNjA7IHgrKykgew0KICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSAoeSAqIGJyZWVkMzYwICsgeCkgKiA0Ow0KDQogICAgICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBkaXN0YW5jZSBmcm9tIGNlbnRlcg0KICAgICAgICAgICAgICAgICAgICBsZXQgZHggPSB4IC0gY2VudGVyWDsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGR5ID0geSAtIGNlbnRlclk7DQogICAgICAgICAgICAgICAgICAgIGxldCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5vcm1hbGl6ZWREaXN0YW5jZSA9IGRpc3QgLyBtYXhEaXN0YW5jZTsgLy8gMCAoY2VudGVyKSB0byAxIChjb3JuZXIpDQoNCiAgICAgICAgICAgICAgICAgICAgLy8gR2V0IHN0YXJ0IGFuZCBlbmQgY29sb3JzDQogICAgICAgICAgICAgICAgICAgIGxldCBjb2xvckEgPSBnZXREYXRhQ29sb3IoZGF0YTEsIGluZGV4KTsNCiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbG9yQiA9IGdldERhdGFDb2xvcihkYXRhMiwgaW5kZXgpOw0KDQogICAgICAgICAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbmFsIHBvc2l0aW9uIChmaXhlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsDQogICAgICAgICAgICAgICAgICAgICAgICB5OiB5LA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29sb3JzDQogICAgICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yOiBjb2xvckEsIC8vIENvbG9yIGZyb20gSW1hZ2UgQQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3I6IGNvbG9yQiwgICAvLyBDb2xvciBmcm9tIEltYWdlIEINCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciB0aGUgbW9ycGggZWZmZWN0OiBhIG5vcm1hbGl6ZWQgcmluZyBwb3NpdGlvbg0KICAgICAgICAgICAgICAgICAgICAgICAgcmluZ1Bvc2l0aW9uOiBub3JtYWxpemVkRGlzdGFuY2UNCiAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgbWFpbiBhbmltYXRpb24gbG9vcC4NCiAgICAgICAgICovDQogICAgICAgIHZhciBBTklNQVRFID0gKCkgPT4gew0KICAgICAgICAgICAgLy8gQXBwbHkgZWFzaW5nIHRvIHRoZSBmcmFtZSBwcm9ncmVzcw0KICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQoY3VycmVudEZyYW1lYmIgLyB0b3RhbEZyYW1lc2JiKTsNCg0KICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIGNhbnZhcyBmb3IgdGhlIG5ldyBmcmFtZQ0KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgICAgIC8vIERyYXcgdGhlIGJhY2tncm91bmQgY29sb3IgaWYgbmVlZGVkICh0aG91Z2ggIzExMSBib2R5IHNob3VsZCBzdWZmaWNlKQ0KICAgICAgICAgICAgLy8gY3R4YmkuZmlsbFN0eWxlID0gJyMxMTEnOw0KICAgICAgICAgICAgLy8gY3R4YmkuZmlsbFJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaXhiaXhlbHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBsZXQgcCA9IHBpeGJpeGVsc1tpXTsNCiAgICAgICAgICAgICAgICBsZXQgY29sb3I7DQogICAgICAgICAgICAgICAgbGV0IGRyYXdYID0gcC54Ow0KICAgICAgICAgICAgICAgIGxldCBkcmF3WSA9IHAueTsNCg0KICAgICAgICAgICAgICAgIC8vIFRoZSByaW5nIG1vcnBoIGxvZ2ljOg0KICAgICAgICAgICAgICAgIC8vIFdlIHVzZSB0aGUgbm9ybWFsaXplZCBkaXN0YW5jZSAocmluZ1Bvc2l0aW9uKSB0byBkZXRlcm1pbmUgKndoZW4qIGEgcGl4ZWwNCiAgICAgICAgICAgICAgICAvLyBzdGFydHMgYW5kIGZpbmlzaGVzIGl0cyB0cmFuc2l0aW9uLiBPdXRlciByaW5ncyBzdGFydCBmaXJzdC4NCg0KICAgICAgICAgICAgICAgIC8vIFRoZSB0cmFuc2l0aW9uIHN0YXJ0cyB3aGVuIHRoZSBvdmVyYWxsIHByb2dyZXNzICgwLTEpIGlzIGdyZWF0ZXIgdGhhbg0KICAgICAgICAgICAgICAgIC8vIGEgbW9kaWZpZWQgdmVyc2lvbiBvZiB0aGUgcGl4ZWwncyByaW5nUG9zaXRpb24uDQogICAgICAgICAgICAgICAgLy8gVGhlIHRyYW5zaXRpb24gZW5kcyB3aGVuIHRoZSBvdmVyYWxsIHByb2dyZXNzIGlzIGdyZWF0ZXIgdGhhbiAocmluZ1Bvc2l0aW9uICsgMC41KQ0KICAgICAgICAgICAgICAgIC8vIFRoaXMgY3JlYXRlcyBhIGhhbGYtdG90YWxGcmFtZXNiYi1sb25nIHRyYW5zaXRpb24gZm9yIGVhY2ggcmluZy4NCg0KICAgICAgICAgICAgICAgIC8vIFRoZSB0cmFuc2l0aW9uIHdpbmRvdyBzaXplIGlzIHNldCB0byBjb3ZlciBoYWxmIHRoZSB0b3RhbCBkaXN0YW5jZSAoMC41KSwNCiAgICAgICAgICAgICAgICAvLyBzbyB0aGUgdHJhbnNpdGlvbiBmb3IgYW55IHNpbmdsZSBwaXhlbCB0YWtlcyBoYWxmIHRoZSB0b3RhbCBhbmltYXRpb24gdGltZS4NCiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2l0aW9uV2luZG93ID0gMC41Ow0KDQogICAgICAgICAgICAgICAgLy8gTW9kaWZpZWQgc3RhcnQgcG9pbnQ6IG91dGVyIHJpbmdzIChyaW5nUG9zaXRpb24gbmVhciAxKSBzdGFydCBuZWFyIHByb2dyZXNzIDAuDQogICAgICAgICAgICAgICAgLy8gSW5uZXIgcmluZ3MgKHJpbmdQb3NpdGlvbiBuZWFyIDApIHN0YXJ0IG5lYXIgcHJvZ3Jlc3MgMC41Lg0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UHJvZ3Jlc3MgPSBwLnJpbmdQb3NpdGlvbiAqIHRyYW5zaXRpb25XaW5kb3c7DQoNCiAgICAgICAgICAgICAgICAvLyBUaGUgcGl4ZWwncyBvd24gaW5kaXZpZHVhbCBwcm9ncmVzcyAoMCB0byAxKSB3aXRoaW4gaXRzIHRyYW5zaXRpb24gd2luZG93DQogICAgICAgICAgICAgICAgbGV0IHBpeGVsUHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCAocHJvZ3Jlc3MgLSBzdGFydFByb2dyZXNzKSAvIHRyYW5zaXRpb25XaW5kb3cpKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBDb2xvciBNb3JwaDogTGluZWFyIHRyYW5zaXRpb24gZnJvbSBBIHRvIEINCiAgICAgICAgICAgICAgICBjb2xvciA9IGludGVycG9sYXRlQ29sb3IocC5zdGFydENvbG9yLCBwLmVuZENvbG9yLCBwaXhlbFByb2dyZXNzKTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBEcmF3aW5nOiBEcmF3IGEgc2luZ2xlIDF4MSBwaXhlbCBibG9jaw0KICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9IGNvbG9yOw0KICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KGRyYXdYLCBkcmF3WSwgMSwgMSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsNCiAgICAgICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOw0KICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShBTklNQVRFKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLg0KDQogICAgICAgICAgICAgICAgLy8gMS4gRHJhdyB0aGUgZmluYWwgaW1hZ2UgKEIpIHRvIHRoZSBjYW52YXMgdG8gY29tcGxldGVseSBjb3ZlciB0aGUgdHJhbnNpdGlvbi4NCiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIGltcG9ydGFudCBhcyB0aGUgcGl4ZWwtZHJhd2luZyBsb29wIG1pZ2h0IG5vdCBwZXJmZWN0bHkgYW50aS1hbGlhcy4NCiAgICAgICAgICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgICAgICAgICAgLy8gMi4gU1dBUCBPQkpFQ1RTOiBUaGUgb2xkIHRhcmdldCBpbWFnZSBvYmplY3QgKEIpIGlzIHRoZSBuZXcgc3RhcnQgaW1hZ2Ugb2JqZWN0IChBKS4NCiAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7DQoNCiAgICAgICAgICAgICAgICAvLyAzLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLg0KICAgICAgICAgICAgICAgIGN1cnJlbnRVUkwgPSBuZXh0VVJMOw0KDQogICAgICAgICAgICAgICAgLy8gNC4gR0VORVJBVEUgTkVXIFRBUkdFVCBVUkwgKEMpDQogICAgICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAgICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuIE5vIGRlbGF5IG5lZWRlZCBoZXJlLg0KICAgICAgICAgICAgICAgIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyBhbmQgc3RhcnRzIHRoZSBhbmltYXRpb24gc2VxdWVuY2UuDQogICAgICAgICAqLw0KICAgICAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiID0gMDsNCiAgICAgICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOw0KICAgICAgICAgICAgQU5JTUFURSgpOw0KICAgICAgICB9Ow0KDQogICAgICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tDQogICAgICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIGluaXRDYW52YXNBbmRJbWFnZXMoKTsNCiAgICAgICAgfTsNCiAgICA8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=<br>PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+TWFudWZhY3R1cmluZyBJZ25vcmFuY2U6IFJJUFBJTkcgQVBBUlQ8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIC8qIEJhc2Ugc3R5bGVzICovCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgCiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBtaW4taGVpZ2h0OiAxMDB2aDsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzFhMWExYTsgLyogRGFya2VyLCBtb3JlIG9taW5vdXMgYmFja2dyb3VuZCAqLwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnUHJlc3MgU3RhcnQgMlAnLCBjdXJzaXZlOwogICAgICAgICAgICBjb2xvcjogI2ZmZjsKICAgICAgICB9CgogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovCiAgICAgICAgI2NhbnZhcyB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICAgICAgICBib3JkZXI6IDBweCBzb2xpZCAjZmYzM2JiOyAvKiBTdHJvbmdlciwgbW9yZSBhZ2dyZXNzaXZlIGJvcmRlciBjb2xvciAqLwogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7CiAgICAgICAgfQoKICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiAqLwogICAgICAgICNhbmltYXRpb25DYW52YXMgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgfQoKICAgICAgICAjdGl0bGUgewogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICBjb2xvcjogIzAwZmZjYzsgLyogQ29tcGxlbWVudGFyeSBjb2xvciAqLwogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggIzAwZmZjYywgMCAwIDIwcHggIzAwZmZjYywgMCAwIDMwcHggIzAwZmZjYzsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjZlbTsKICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgICAgICBsaW5lLWhlaWdodDogMS4yOwogICAgICAgICAgICB0ZXh0LXRyYW5zZm9ybTogdXBwZXJjYXNlOwogICAgICAgIH0KICAgICAgICAgQGltcG9ydCB1cmwoJ2h0dHBzOi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzMj9mYW1pbHk9UHJlc3MrU3RhcnQrMlAmZGlzcGxheT1zd2FwJyk7CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgoKICAgIDxkaXYgaWQ9J2NhbnZhcycgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Jz4KICAgICAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48L2NhbnZhcz4KICAgIDwvZGl2Pgo8c2NyaXB0PgogICAgLy8gLS0tIEltYWdlIFNvdXJjZSBhbmQgT2JqZWN0IFN0b3JhZ2UgLS0tCiAgICB2YXIgY3VycmVudFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgCiAgICB2YXIgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgCgogICAgdmFyIGN1cnJlbnRJbWFnZSA9IG51bGw7IAogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIAoKICAgIC8vIC0tLSBHbG9iYWwgQW5pbWF0aW9uIFZhcmlhYmxlcyAtLS0KICAgIHZhciBjYW52YXNiYmk7CiAgICB2YXIgY3R4Ymk7CiAgICB2YXIgaW1hZ2VzYmkgPSB7fTsgCiAgICAKICAgIHZhciBmcmFnbWVudHMgPSBbXTsgLy8gQ2hhbmdlZCBmcm9tIHBpeGJpeGVscyB0byBmcmFnbWVudHMKICAgIHZhciB0b3RhbEZyYW1lc2JiID0gMTUwOyAvLyBNb3JlIGZyYW1lcyBmb3Igc21vb3RoZXIsIG1vcmUgZWxhYm9yYXRlIHJpcHBpbmcKICAgIHZhciBjdXJyZW50RnJhbWViYiA9IDA7CgogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8gCiAgICB2YXIgaG9vZzE4MCA9IDQ1MDsgLy8gCiAgICAKICAgIC8vIFNpemUgb2YgdGhlIGZyYWdtZW50cyAoZS5nLiwgMngyIG9yIDN4MyBwaXhlbHMpCiAgICB2YXIgZnJhZ21lbnRTaXplID0gNDsgLy8gTWFraW5nIGZyYWdtZW50cyBsYXJnZXIgdG8gYmUgbW9yZSB2aXNpYmxlCiAgICB2YXIgbWF4U2NhdHRlckRpc3RhbmNlID0gMTUwOyAvLyBIb3cgZmFyIGZyYWdtZW50cyBjYW4gc2NhdHRlcgoKICAgIC8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQogICAgdmFyIGxvYWRJbWFnZWJiID0gKHNyYywgY2FsbGJhY2spID0+IHsKICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7CiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgaW1hZ2VzYmlbc3JjXSA9IGltZzsKICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgaW1nKTsKICAgICAgICB9OwogICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gewogICAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCk7CiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsKICAgICAgICB9OwogICAgICAgIGltZy5zcmMgPSBzcmM7CiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7CiAgICB9OwoKICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsKICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOwoKICAgICAgICBpZiAoaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdKSB7CiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsKICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gewogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgewogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltZzsKICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05ldyBpbWFnZSBmYWlsZWQgdG8gbG9hZC4gUmV0cnlpbmcuLi4nKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAgICBmdW5jdGlvbiBpbml0Q2FudmFzQW5kSW1hZ2VzKCkgewogICAgICAgIGNhbnZhc2JiaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25DYW52YXMnKTsKICAgICAgICBjYW52YXNiYmkud2lkdGggPSBicmVlZDM2MDsKICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsKICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIAogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07CiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsKICAgICAgICBsZXQgaGFzRXJyb3IgPSBmYWxzZTsKCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7CiAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7CiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA9PT0gaW1hZ2VzVG9Mb2FkLmxlbmd0aCkgewogICAgICAgICAgICAgICAgaWYgKCFoYXNFcnJvcikgewogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc2JpW2N1cnJlbnRVUkxdOwogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25leHRVUkxdOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW5pdGlhbCBpbWFnZSBsb2FkaW5nIGZhaWxlZC4gQ2Fubm90IHN0YXJ0IGFuaW1hdGlvbi4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGltYWdlc1RvTG9hZC5mb3JFYWNoKHNyYyA9PiBsb2FkSW1hZ2ViYihzcmMsIG9uSW1hZ2VMb2FkZWQpKTsKICAgIH0KCiAgICAvLyAtLS0gUGl4ZWwgYW5kIEVhc2luZyBVdGlsaXRpZXMgLS0tCiAgICAvLyBNb3JlIHByb25vdW5jZWQgZWFzaW5nIGZvciBzaGFycGVyIGRpc2ludGVncmF0aW9uIGFuZCByZS1hc3NlbWJseQogICAgdmFyIGVhc2VJbk91dEN1YmljID0gKHQpID0+IHQgPCAwLjUgPyA0ICogdCAqIHQgKiB0IDogMSAtIE1hdGgucG93KC0yICogdCArIDIsIDMpIC8gMjsKICAgIAogICAgdmFyIHNldHVwSW5pdGlhbENhbnZhcyA9ICgpID0+IHsKICAgICAgICB2YXIgaW1nMSA9IGN1cnJlbnRJbWFnZTsgCiAgICAgICAgdmFyIGltZzIgPSBuZXh0SW1hZ2U7ICAgIAogICAgICAgIGZyYWdtZW50cyA9IFtdOyAvLyBDbGVhciBwcmV2aW91cyBmcmFnbWVudHMKCiAgICAgICAgLy8gRHJhdyBpbml0aWFsIGltYWdlIHRvIGdldCBkYXRhCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGltZzEsIDAsIDAgLCBicmVlZDM2MCwgaG9vZzE4MCk7CiAgICAgICAgdmFyIGltYWdlRGF0YTEgPSBjdHhiaS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsKICAgICAgICB2YXIgZGF0YTEgPSBpbWFnZURhdGExLmRhdGE7CgogICAgICAgIC8vIERyYXcgdGFyZ2V0IGltYWdlIHRvIGEgdGVtcCBjYW52YXMgdG8gZ2V0IGRhdGEKICAgICAgICB2YXIgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIHZhciB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIHRlbXBDYW52YXMud2lkdGggPSBjYW52YXNiYmkud2lkdGg7CiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0OwogICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKGltZzIsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsKICAgICAgICB2YXIgaW1hZ2VEYXRhMiA9IHRlbXBDdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgdmFyIGRhdGEyID0gaW1hZ2VEYXRhMi5kYXRhOwoKICAgICAgICAvLyBDcmVhdGUgZnJhZ21lbnRzIChzbWFsbCBibG9ja3Mgb2YgcGl4ZWxzKQogICAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgaG9vZzE4MDsgeSArPSBmcmFnbWVudFNpemUpIHsKICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBicmVlZDM2MDsgeCArPSBmcmFnbWVudFNpemUpIHsKICAgICAgICAgICAgICAgIHZhciBpID0gKHkgKiBicmVlZDM2MCArIHgpICogNDsKICAgICAgICAgICAgICAgIGZyYWdtZW50cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogeCwKICAgICAgICAgICAgICAgICAgICBzdGFydFk6IHksCiAgICAgICAgICAgICAgICAgICAgLy8gRW5kIHBvc2l0aW9uIChzYW1lIGFzIHN0YXJ0IGZvciBub3csIHdpbGwgY2FsY3VsYXRlIHNjYXR0ZXIpCiAgICAgICAgICAgICAgICAgICAgZW5kWDogeCwgCiAgICAgICAgICAgICAgICAgICAgZW5kWTogeSwKICAgICAgICAgICAgICAgICAgICAvLyBDb2xvcnMKICAgICAgICAgICAgICAgICAgICByMTogZGF0YTFbaV0sIAogICAgICAgICAgICAgICAgICAgIGcxOiBkYXRhMVtpICsgMV0sIAogICAgICAgICAgICAgICAgICAgIGIxOiBkYXRhMVtpICsgMl0sIAogICAgICAgICAgICAgICAgICAgIHIyOiBkYXRhMltpXSwKICAgICAgICAgICAgICAgICAgICBnMjogZGF0YTJbaSArIDFdLAogICAgICAgICAgICAgICAgICAgIGIyOiBkYXRhMltpICsgMl0sCiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9tIHNjYXR0ZXIgdmVjdG9yCiAgICAgICAgICAgICAgICAgICAgc2NhdHRlclg6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIgKiBtYXhTY2F0dGVyRGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgc2NhdHRlclk6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIgKiBtYXhTY2F0dGVyRGlzdGFuY2UsCiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9tIGRlbGF5L29mZnNldCBmb3Igc2NhdHRlcmluZyB0byBtYWtlIGl0IGxlc3MgdW5pZm9ybQogICAgICAgICAgICAgICAgICAgIHNjYXR0ZXJEZWxheTogTWF0aC5yYW5kb20oKSAqIDAuNSAvLyBkZWxheSBmb3IgdXAgdG8gaGFsZiB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogVGhlIGNvcmUgYW5pbWF0aW9uIGxvb3Agd2l0aCByaXBwaW5nIGFwYXJ0IGVmZmVjdHMuCiAgICAgKi8KICAgIHZhciBBTklNQVRFID0gKCkgPT4gewogICAgICAgIHZhciBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZWJiIC8gdG90YWxGcmFtZXNiYjsKICAgICAgICB2YXIgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dEN1YmljKHByb2dyZXNzKTsKCiAgICAgICAgLy8gQ2xlYXIgY2FudmFzIHdpdGggYSBzbGlnaHRseSBub2lzeS9kYXJrIGJhY2tncm91bmQgZHVyaW5nIGRpc3J1cHRpb24KICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBgcmdiYSgyMCwyMCwyMCwgMSlgOwogICAgICAgIGN0eGJpLmZpbGxSZWN0KDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsKCiAgICAgICAgLy8gT3B0aW9uYWw6IGFkZCBzb21lIHN0YXRpYyBkdXJpbmcgcGVhayBkaXNydXB0aW9uCiAgICAgICAgaWYgKHByb2dyZXNzID4gMC4zICYmIHByb2dyZXNzIDwgMC43ICYmIE1hdGgucmFuZG9tKCkgPCAwLjEpIHsKICAgICAgICAgICAgIGZvcihsZXQgaT0wOyBpIDwgNTA7IGkrKykgeyAvLyBGZXdlciBzdGF0aWMgZG90cyBmb3Igc3VidGxldHkKICAgICAgICAgICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBgcmdiYSgxMDAsMTAwLDEwMCwgJHtNYXRoLnJhbmRvbSgpICogMC41fSlgOwogICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KE1hdGgucmFuZG9tKCkqYnJlZWQzNjAsIE1hdGgucmFuZG9tKCkqaG9vZzE4MCwgMSwgMSk7CiAgICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZnJhZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBmcmFnbWVudCA9IGZyYWdtZW50c1tpXTsKCiAgICAgICAgICAgIC8vIERldGVybWluZSBjdXJyZW50IHByb2dyZXNzIGZvciB0aGlzIGZyYWdtZW50J3Mgc2NhdHRlcmluZwogICAgICAgICAgICAvLyBFYWNoIGZyYWdtZW50IHN0YXJ0cyBzY2F0dGVyaW5nIGF0IGEgc2xpZ2h0bHkgZGlmZmVyZW50IHRpbWUKICAgICAgICAgICAgbGV0IGZyYWdtZW50UHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCAocHJvZ3Jlc3MgLSBmcmFnbWVudC5zY2F0dGVyRGVsYXkpIC8gKDEgLSBmcmFnbWVudC5zY2F0dGVyRGVsYXkpKSk7CiAgICAgICAgICAgIGxldCBlYXNlZEZyYWdtZW50UHJvZ3Jlc3MgPSBlYXNlSW5PdXRDdWJpYyhmcmFnbWVudFByb2dyZXNzKTsKCiAgICAgICAgICAgIC8vIEludGVycG9sYXRlIGNvbG9yIChmcm9tIEEgdG8gQikKICAgICAgICAgICAgbGV0IHJfY3VycmVudCA9IGZyYWdtZW50LnIxICsgKGZyYWdtZW50LnIyIC0gZnJhZ21lbnQucjEpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgbGV0IGdfY3VycmVudCA9IGZyYWdtZW50LmcxICsgKGZyYWdtZW50LmcyIC0gZnJhZ21lbnQuZzEpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgbGV0IGJfY3VycmVudCA9IGZyYWdtZW50LmIxICsgKGZyYWdtZW50LmIyIC0gZnJhZ21lbnQuYjEpICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBjdXJyZW50IHBvc2l0aW9uOiBmcm9tIHN0YXJ0WC9ZLCBzY2F0dGVyLCB0aGVuIGNvbnZlcmdlIHRvIGVuZFgvWQogICAgICAgICAgICBsZXQgY3VycmVudFgsIGN1cnJlbnRZOwoKICAgICAgICAgICAgaWYgKHByb2dyZXNzIDwgMC41KSB7IC8vIFBoYXNlIDE6IFJpcCBhcGFydCBmcm9tIEEKICAgICAgICAgICAgICAgIGxldCBzY2F0dGVyU3RyZW5ndGggPSBlYXNlZFByb2dyZXNzOyAvLyBMaW5lYXIgc2NhdHRlciwgcGVha2luZyBhdCAwLjUKICAgICAgICAgICAgICAgIGN1cnJlbnRYID0gZnJhZ21lbnQuc3RhcnRYICsgZnJhZ21lbnQuc2NhdHRlclggKiBzY2F0dGVyU3RyZW5ndGg7CiAgICAgICAgICAgICAgICBjdXJyZW50WSA9IGZyYWdtZW50LnN0YXJ0WSArIGZyYWdtZW50LnNjYXR0ZXJZICogc2NhdHRlclN0cmVuZ3RoOwogICAgICAgICAgICB9IGVsc2UgeyAvLyBQaGFzZSAyOiBSZWFzc2VtYmxlIGludG8gQgogICAgICAgICAgICAgICAgbGV0IHJlYXNzZW1ibGVTdHJlbmd0aCA9IChlYXNlZFByb2dyZXNzIC0gMC41KSAqIDI7IC8vIFJhbXBzIGZyb20gMCB0byAxIGluIHNlY29uZCBoYWxmCiAgICAgICAgICAgICAgICBjdXJyZW50WCA9IChmcmFnbWVudC5zdGFydFggKyBmcmFnbWVudC5zY2F0dGVyWCkgKiAoMSAtIHJlYXNzZW1ibGVTdHJlbmd0aCkgKyBmcmFnbWVudC5lbmRYICogcmVhc3NlbWJsZVN0cmVuZ3RoOwogICAgICAgICAgICAgICAgY3VycmVudFkgPSAoZnJhZ21lbnQuc3RhcnRZICsgZnJhZ21lbnQuc2NhdHRlclkpICogKDEgLSByZWFzc2VtYmxlU3RyZW5ndGgpICsgZnJhZ21lbnQuZW5kWSAqIHJlYXNzZW1ibGVTdHJlbmd0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRyYW5zcGFyZW5jeSAoZmFkZSBvdXQgd2hlbiBzY2F0dGVyaW5nLCBmYWRlIGluIHdoZW4gcmVhc3NlbWJsaW5nKQogICAgICAgICAgICBsZXQgYWxwaGEgPSAxOwogICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPCAwLjIpIHsgLy8gRmFkZSBpbiBpbml0aWFsIGltYWdlCiAgICAgICAgICAgICAgICBhbHBoYSA9IHByb2dyZXNzIC8gMC4yOwogICAgICAgICAgICB9IGVsc2UgaWYgKHByb2dyZXNzID4gMC44KSB7IC8vIEZhZGUgaW4gZmluYWwgaW1hZ2UKICAgICAgICAgICAgICAgIGFscGhhID0gKDEgLSBwcm9ncmVzcykgLyAwLjI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYWxwaGEgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBhbHBoYSkpOyAvLyBDbGFtcCBhbHBoYQoKICAgICAgICAgICAgLy8gRHVyaW5nIHBlYWsgZGlzcnVwdGlvbiwgbWFrZSBmcmFnbWVudHMgbW9yZSB0cmFuc3BhcmVudAogICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPiAwLjMgJiYgcHJvZ3Jlc3MgPCAwLjcpIHsKICAgICAgICAgICAgICAgIGFscGhhICo9ICgxIC0gTWF0aC5hYnMocHJvZ3Jlc3MgLSAwLjUpICogMik7IC8vIEZhZGVzIG91dCBtb3JlIGF0IHZlcnkgcGVhawogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmF3IHRoZSBmcmFnbWVudAogICAgICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBgcmdiYSgke01hdGgucm91bmQocl9jdXJyZW50KX0sICR7TWF0aC5yb3VuZChnX2N1cnJlbnQpfSwgJHtNYXRoLnJvdW5kKGJfY3VycmVudCl9LCAke2FscGhhfSlgOwogICAgICAgICAgICBjdHhiaS5maWxsUmVjdChjdXJyZW50WCwgY3VycmVudFksIGZyYWdtZW50U2l6ZSwgZnJhZ21lbnRTaXplKTsKICAgICAgICB9CgogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBpcyBjb21wbGV0ZS4gRHJhdyB0aGUgZmluYWwgaW1hZ2UgY2xlYXJseS4KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTd2FwIGltYWdlcyBhbmQgcHJlcGFyZSBuZXh0IGxvb3AKICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOwogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsKICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgCiAgICAgICAgICAgIAogICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOwogICAgICAgIH0KICAgIH07CgogICAgdmFyIHN0YXJ0QW5pbWF0aW9uZnQgPSAoKSA9PiB7CiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOwogICAgICAgIEFOSU1BVEUoKTsKICAgIH07CgogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGluaXRDYW52YXNBbmRJbWFnZXMoKTsKICAgIH07Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=<br>PGh0bWwgbGFuZz0iZW4iPjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPHRpdGxlPlZvcnRleCBQaXhlbCBUcmFuc2l0aW9uPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAvKiBCYXNlIHN0eWxlcyAqLwogICAgICAgIGJvZHkgeyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgIAogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICB9CgogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovCiAgICAgICAgI2NhbnZhcyB7CiAgICAgICAgICAgIC8qIFRoZSBjYW52YXMgd2lsbCBub3cgYmUgcGxhY2VkIGluc2lkZSB0aGlzIGRpdiBvbmx5IG9uY2UgKi8KICAgICAgICAgICAgd2lkdGg6IDEwMCU7IC8qIEJhc2Ugd2lkdGggZm9yIHRoZSBvdXRlciBkaXYsIGFkanVzdGVkIGxhdGVyIGJ5IEpTICovCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsgLyogQmFzZSBoZWlnaHQgZm9yIHRoZSBvdXRlciBkaXYsIGFkanVzdGVkIGxhdGVyIGJ5IEpTICovCiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICAgICAgICBib3JkZXI6IDBweCBzb2xpZCAjMzMzOyAvKiBPcHRpb25hbDogZm9yIHZpc2liaWxpdHkgKi8KICAgICAgICAgICAgZGlzcGxheTogZmxleDsgLyogVG8gY2VudGVyIHRoZSBjYW52YXMgaW5zaWRlIGl0ICovCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOyAvKiBJbXBvcnRhbnQgZm9yIHRoZSBib3gtc2hhZG93ICovCiAgICAgICAgfQogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgLyogSXRzIGRpbWVuc2lvbnMgd2lsbCBiZSBzZXQgYnkgSlMgKGJyZWVkMzYwLCBob29nMTgwKSAqLwogICAgICAgICAgICAvKiBFbnN1cmUgaXQgc2NhbGVzIG5pY2VseSB3aXRoaW4gaXRzIHBhcmVudCBpZiBwYXJlbnQgaXMgbGFyZ2VyICovCiAgICAgICAgICAgIG1heC13aWR0aDogMTAwJTsKICAgICAgICAgICAgbWF4LWhlaWdodDogMTAwJTsKICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogYmxhY2s7IC8qIFRvIGVuc3VyZSBmdWxsIGNvdmVyYWdlIGJlZm9yZSBpbWFnZXMgbG9hZCAqLwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgaWQ9ImNhbnZhcyIgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7Ij4KICAgIDxjYW52YXMgaWQ9ImFuaW1hdGlvbkNhbnZhcyIgd2lkdGg9IjgwMCIgaGVpZ2h0PSI0NTAiIHN0eWxlPSdwb3NpdGlvbjpmaXhlZDtsZWZ0OjA7dG9wOjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJScgPjwvY2FudmFzPgo8L2Rpdj4KPHNjcmlwdD4KICAgIC8vIC0tLSBJbWFnZSBTb3VyY2UgYW5kIE9iamVjdCBTdG9yYWdlIC0tLQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpVUkwqIG9mIHRoZSBjdXJyZW50bHkgbG9hZGVkIGltYWdlIHNldAogICAgdmFyIGN1cnJlbnRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IAogICAgdmFyIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IAoKICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqQWN0dWFsIEltYWdlIE9iamVjdHMqIGZvciB0aGUgYW5pbWF0aW9uCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KQogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpCgogICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQogICAgdmFyIGNhbnZhc2JiaTsKICAgIHZhciBjdHhiaTsKICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQogICAgdmFyIHBpeGJpeGVscyA9IFtdOyAgICAgICAvLyBTdG9yZXMgZGF0YSBmb3IgZWFjaCBhbmltYXRpbmcgcGl4ZWwgYmxvY2sKCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDE4MDsgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3Igc21vb3RoZXIsIGxvbmdlciB0cmFuc2l0aW9uIChlLmcuLCAzIHNlY29uZHMgYXQgNjBmcHMpCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOwoKICAgIC8vIERpbWVuc2lvbnMgZm9yIHRoZSBjYW52YXMgZWxlbWVudCAoQWRqdXN0ZWQgdG8gb3JpZ2luYWwgaW1hZ2Ugc2l6ZSBmb3IgYmV0dGVyIHF1YWxpdHkpCiAgICB2YXIgYnJlZWQzNjAgPSA4MDA7ICAvLyAgICAgIC8vIFVzaW5nIHRoZSBhY3R1YWwgd2lkdGggZnJvbSBwaWNzdW0ucGhvdG9zLzY0MC82NDAKICAgIHZhciBob29nMTgwID0gNDUwOyAvLyAgICAgICAvLyBVc2luZyB0aGUgYWN0dWFsIGhlaWdodCBmcm9tIHBpY3N1bS5waG90b3MvNjQwLzY0MAoKICAgIC8vIEZvciBiZXR0ZXIgcGVyZm9ybWFuY2UgYW5kIGEgYmxvY2t5IHBpeGVsIGFydC1saWtlIGVmZmVjdCwgd2UnbGwgZHJhdyBibG9ja3Mgb2YgcGl4ZWxzCiAgICBjb25zdCBwaXhlbEJsb2NrU2l6ZSA9IDQ7IC8vIEVhY2ggInBpeGVsIiBpbiBvdXIgYW5pbWF0aW9uIHdpbGwgYmUgYSA0eDQgYmxvY2sKCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0KICAgIC8qKgogICAgICogTG9hZHMgYSBzaW5nbGUgaW1hZ2UgaW50byB0aGUgaW1hZ2VzYmkgbWFwLgogICAgICovCiAgICB2YXIgbG9hZEltYWdlYmIgPSAoc3JjLCBjYWxsYmFjaykgPT4gewogICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gewogICAgICAgICAgICBpbWFnZXNiaVtzcmNdID0gaW1nOwogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOwogICAgICAgIH07CiAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsKICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOwogICAgICAgIH07CiAgICAgICAgaW1nLnNyYyA9IHNyYzsKICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsKICAgIH07CgogICAgLyoqCiAgICAgKiBMb2FkcyB0aGUgbmV4dCBpbWFnZSBpbiB0aGUgc2VxdWVuY2UgYW5kIHN0YXJ0cyB0aGUgdHJhbnNpdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gbG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkgewogICAgICAgIGxldCBuZXdJbWFnZVVSTCA9IG5leHRVUkw7CiAgICAgICAgaWYgKGltYWdlc2JpW25ld0ltYWdlVVJMXSkgewogICAgICAgICAgICAvLyBJZiBhbHJlYWR5IGNhY2hlZCAoc2hvdWxkbid0IGhhcHBlbiB3aXRoIHVuaXF1ZSA/cmFuZG9tPSksIHVzZSBpdCBpbW1lZGlhdGVseQogICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXdJbWFnZVVSTF07CiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2FkSW1hZ2ViYihuZXdJbWFnZVVSTCwgKGVycm9yLCBpbWcpID0+IHsKICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWc7CiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHRyYW5zaXRpb24gZnJvbSBCIHRvIEMgb25jZSBDIGlzIGxvYWRlZAogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOwogICAgICAgICAgICAgICAgICAgIC8vIFJldHJ5IGxvYWRpbmcgdGhlIG5leHQgaW1hZ2UgYWZ0ZXIgYSBkZWxheQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgY2FudmFzIGFuZCBsb2FkcyB0aGUgaW5pdGlhbCB0d28gaW1hZ2VzIChBIGFuZCBCKS4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsKICAgICAgICBjYW52YXNiYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7CiAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7CiAgICAgICAgY2FudmFzYmJpLmhlaWdodCA9IGhvb2cxODA7CiAgICAgICAgY3R4YmkgPSBjYW52YXNiYmkuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgICAgLy8gU2V0IHRoZSBvdXRlciBkaXYncyBzaXplIHRvIG1hdGNoIHRoZSBjYW52YXMgZm9yIGNvbnNpc3RlbmN5CiAgICAgICAgY29uc3QgY2FudmFzQ29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpOwogICAgCgogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07CiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsKICAgICAgICBsZXQgaGFzRXJyb3IgPSBmYWxzZTsKICAgICAgICBjb25zdCBvbkltYWdlTG9hZGVkID0gKGVycm9yLCBpbWcpID0+IHsKICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgICBoYXNFcnJvciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9hZGVkQ291bnQrKzsKICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzYmlbY3VycmVudFVSTF07CiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV4dFVSTF07CiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOwogICAgICAgICAgICAgICAgICAgIC8vIFBvdGVudGlhbGx5IHJldHJ5IG9yIGRpc3BsYXkgYSBmYWxsYmFjawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlYmIoc3JjLCBvbkltYWdlTG9hZGVkKSk7CiAgICB9CgogICAgLy8gLS0tIFBpeGVsIGFuZCBFYXNpbmcgVXRpbGl0aWVzIC0tLQogICAgdmFyIHBhcnNlUkdCQSA9IChyZ2JhU3RyaW5nKSA9PiB7CiAgICAgICAgdmFyIHBhcnRzID0gcmdiYVN0cmluZy5tYXRjaCgvXGQrKFwuXGQrKT8vZykubWFwKE51bWJlcik7CiAgICAgICAgcmV0dXJuIHsgcjogcGFydHNbMF0sIGc6IHBhcnRzWzFdLCBiOiBwYXJ0c1syXSwgYTogcGFydHNbM10gfHwgMSB9OwogICAgfTsKCiAgICB2YXIgaW50ZXJwb2xhdGVDb2xvciA9IChjb2xvcjEsIGNvbG9yMiwgcHJvZ3Jlc3MpID0+IHsKICAgICAgICB2YXIgYzEgPSBwYXJzZVJHQkEoY29sb3IxKTsKICAgICAgICB2YXIgYzIgPSBwYXJzZVJHQkEoY29sb3IyKTsKICAgICAgICB2YXIgciA9IE1hdGgucm91bmQoYzEuciArIChjMi5yIC0gYzEucikgKiBwcm9ncmVzcyk7CiAgICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKGMxLmcgKyAoYzIuZyAtIGMxLmcpICogcHJvZ3Jlc3MpOwogICAgICAgIHZhciBiID0gTWF0aC5yb3VuZChjMS5iICsgKGMyLmIgLSBjMS5iKSAqIHByb2dyZXNzKTsKICAgICAgICB2YXIgYSA9IGMxLmEgKyAoYzIuYSAtIGMxLmEpICogcHJvZ3Jlc3M7CiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7YX0pYDsKICAgIH07CgogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0OwoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgdGhlIHBpeGJpeGVscyBhcnJheSB3aXRoIGRhdGEgZnJvbSBjdXJyZW50SW1hZ2UgYW5kIG5leHRJbWFnZS4KICAgICAqIFRoaXMgZnVuY3Rpb24gbm93IGRlZmluZXMgdGhlIHN0YXJ0aW5nIGFuZCBlbmRpbmcgc3RhdGUgZm9yIGVhY2ggYW5pbWF0aW5nICJwaXhlbCIgKHdoaWNoIHdpbGwgYmUgYSBibG9jaykuCiAgICAgKi8KICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7CiAgICAgICAgdmFyIGltZzEgPSBjdXJyZW50SW1hZ2U7IC8vIFRoZSBzdGFydCBpbWFnZQogICAgICAgIHZhciBpbWcyID0gbmV4dEltYWdlOyAgICAvLyBUaGUgdGFyZ2V0IGltYWdlCgogICAgICAgIC8vIERyYXcgYm90aCBpbWFnZXMgb2ZmLXNjcmVlbiB0byBnZXQgcGl4ZWwgZGF0YSB3aXRob3V0IGFmZmVjdGluZyB0aGUgY3VycmVudCBkaXNwbGF5CiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGltZzEsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsKICAgICAgICB2YXIgZGF0YTEgPSBjdHhiaS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOwoKICAgICAgICB2YXIgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIHZhciB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIHRlbXBDYW52YXMud2lkdGggPSBjYW52YXNiYmkud2lkdGg7CiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0OwogICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKGltZzIsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsKICAgICAgICB2YXIgZGF0YTIgPSB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpLmRhdGE7CgogICAgICAgIHBpeGJpeGVscyA9IFtdOwoKICAgICAgICAvLyBSYW5kb21seSBjaG9vc2UgYSB2b3J0ZXggY2VudGVyIGZvciB0aGlzIHRyYW5zaXRpb24uCiAgICAgICAgLy8gTWFrZSBpdCBzbGlnaHRseSBvZmYtY2VudGVyIGZvciBhIG1vcmUgZHluYW1pYyBhbmQgbGVzcyBzeW1tZXRyaWNhbCBlZmZlY3QuCiAgICAgICAgY29uc3Qgdm9ydGV4Q2VudGVyWCA9IGJyZWVkMzYwIC8gMiArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGJyZWVkMzYwICogMC40OyAvLyBDZW50ZXIgKy8tIDIwJSB3aWR0aAogICAgICAgIGNvbnN0IHZvcnRleENlbnRlclkgPSBob29nMTgwIC8gMiArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGhvb2cxODAgKiAwLjQ7IC8vIENlbnRlciArLy0gMjAlIGhlaWdodAoKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhvb2cxODA7IHkgKz0gcGl4ZWxCbG9ja1NpemUpIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBicmVlZDM2MDsgeCArPSBwaXhlbEJsb2NrU2l6ZSkgewogICAgICAgICAgICAgICAgLy8gR2V0IHRoZSBhdmVyYWdlIGNvbG9yIGZvciB0aGUgYmxvY2sgZnJvbSBkYXRhMSBhbmQgZGF0YTIKICAgICAgICAgICAgICAgIGxldCByMSA9IDAsIGcxID0gMCwgYjEgPSAwLCBhMSA9IDA7CiAgICAgICAgICAgICAgICBsZXQgcjIgPSAwLCBnMiA9IDAsIGIyID0gMCwgYTIgPSAwOwogICAgICAgICAgICAgICAgbGV0IGNvdW50ID0gMDsKCiAgICAgICAgICAgICAgICAvLyBBdmVyYWdlIHBpeGVsIGRhdGEgZm9yIHRoZSBibG9jawogICAgICAgICAgICAgICAgZm9yIChsZXQgc3kgPSAwOyBzeSA8IHBpeGVsQmxvY2tTaXplICYmICh5ICsgc3kpIDwgaG9vZzE4MDsgc3krKykgewogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHN4ID0gMDsgc3ggPCBwaXhlbEJsb2NrU2l6ZSAmJiAoeCArIHN4KSA8IGJyZWVkMzYwOyBzeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gKCh5ICsgc3kpICogYnJlZWQzNjAgKyAoeCArIHN4KSkgKiA0OwogICAgICAgICAgICAgICAgICAgICAgICAvLyBCYXNpYyBib3VuZHMgY2hlY2sgdG8gcHJldmVudCBlcnJvcnMgYXQgdGhlIGVkZ2VzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCArIDMgPCBkYXRhMS5sZW5ndGggJiYgaW5kZXggKyAzIDwgZGF0YTIubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByMSArPSBkYXRhMVtpbmRleF07IGcxICs9IGRhdGExW2luZGV4ICsgMV07IGIxICs9IGRhdGExW2luZGV4ICsgMl07IGExICs9IGRhdGExW2luZGV4ICsgM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByMiArPSBkYXRhMltpbmRleF07IGcyICs9IGRhdGEyW2luZGV4ICsgMV07IGIyICs9IGRhdGEyW2luZGV4ICsgMl07IGEyICs9IGRhdGEyW2luZGV4ICsgM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvdW50ID09PSAwKSBjb250aW51ZTsgLy8gU2tpcCBpZiBubyBwaXhlbHMgd2VyZSBzYW1wbGVkIGluIHRoZSBibG9jawoKICAgICAgICAgICAgICAgIHIxIC89IGNvdW50OyBnMSAvPSBjb3VudDsgYjEgLz0gY291bnQ7IGExIC89IGNvdW50OwogICAgICAgICAgICAgICAgcjIgLz0gY291bnQ7IGcyIC89IGNvdW50OyBiMiAvPSBjb3VudDsgYTIgLz0gY291bnQ7CgogICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbFJnYmEgPSBgcmdiYSgke01hdGgucm91bmQocjEpfSwgJHtNYXRoLnJvdW5kKGcxKX0sICR7TWF0aC5yb3VuZChiMSl9LCAke2ExIC8gMjU1fSlgOwogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0UmdiYSA9IGByZ2JhKCR7TWF0aC5yb3VuZChyMil9LCAke01hdGgucm91bmQoZzIpfSwgJHtNYXRoLnJvdW5kKGIyKX0sICR7YTIgLyAyNTV9KWA7CgogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFuZ2xlIGFuZCBkaXN0YW5jZSByZWxhdGl2ZSB0byB0aGUgdm9ydGV4IGNlbnRlciBmb3IgZWFjaCBibG9jawogICAgICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gdm9ydGV4Q2VudGVyWDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIHZvcnRleENlbnRlclk7CiAgICAgICAgICAgICAgICBjb25zdCBhbmdsZUZyb21Wb3J0ZXggPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0RnJvbVZvcnRleCA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CgogICAgICAgICAgICAgICAgcGl4Yml4ZWxzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgICAgICAgICBpbml0aWFsUmdiYTogaW5pdGlhbFJnYmEsCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UmdiYTogdGFyZ2V0UmdiYSwKICAgICAgICAgICAgICAgICAgICB2b3J0ZXhYOiB2b3J0ZXhDZW50ZXJYLAogICAgICAgICAgICAgICAgICAgIHZvcnRleFk6IHZvcnRleENlbnRlclksCiAgICAgICAgICAgICAgICAgICAgYW5nbGVGcm9tVm9ydGV4OiBhbmdsZUZyb21Wb3J0ZXgsCiAgICAgICAgICAgICAgICAgICAgZGlzdEZyb21Wb3J0ZXg6IGRpc3RGcm9tVm9ydGV4LAogICAgICAgICAgICAgICAgICAgIC8vIFN0YWdnZXJlZCBzdGFydC9lbmQgZm9yIGluZGl2aWR1YWwgcGl4ZWwgYmxvY2tzICgwIHRvIDAuNiBvZiB0b3RhbCBwcm9ncmVzcykuCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBjcmVhdGVzIHRoZSBjaGFvdGljLCBmbG93aW5nIGxvb2suCiAgICAgICAgICAgICAgICAgICAgZGVsYXlPZmZzZXQ6IE1hdGgucmFuZG9tKCkgKiAwLjYKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLgogICAgICogRHJhd3MgZWFjaCBmcmFtZSBvZiB0aGUgdHJhbnNpdGlvbiwgb3JjaGVzdHJhdGluZyB0aGUgdm9ydGV4IGVmZmVjdC4KICAgICAqLwogICAgdmFyIEFOSU1BVEUgPSAoKSA9PiB7CiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CgogICAgICAgIGNvbnN0IHByb2dyZXNzUmF3ID0gY3VycmVudEZyYW1lYmIgLyB0b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkR2xvYmFsUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzc1Jhdyk7IC8vIE92ZXJhbGwgYW5pbWF0aW9uIHByb2dyZXNzIGVhc2VkCgogICAgICAgIHBpeGJpeGVscy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAvLyBDYWxjdWxhdGUgaW5kaXZpZHVhbCBwcm9ncmVzcyBmb3IgdGhpcyBwaXhlbCBibG9jaywgZGVsYXllZCBhbmQgc3BlZCB1cAogICAgICAgICAgICAvLyBUaGlzIGNyZWF0ZXMgdGhlIHN0YWdnZXJlZCBlbnRyeS9leGl0IGZyb20gdGhlIHZvcnRleAogICAgICAgICAgICBsZXQgaW5kaXZpZHVhbFByb2dyZXNzID0gKGVhc2VkR2xvYmFsUHJvZ3Jlc3MgLSBwLmRlbGF5T2Zmc2V0KSAvICgxIC0gcC5kZWxheU9mZnNldCk7CiAgICAgICAgICAgIGluZGl2aWR1YWxQcm9ncmVzcyA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIGluZGl2aWR1YWxQcm9ncmVzcykpOyAvLyBDbGFtcCAwLTEKCiAgICAgICAgICAgIGxldCBkcmF3WCwgZHJhd1ksIGFscGhhOyAvLyBDdXJyZW50IGRyYXdpbmcgcG9zaXRpb24gYW5kIG9wYWNpdHkKCiAgICAgICAgICAgIC8vIEludGVycG9sYXRlIGNvbG9yIHRocm91Z2hvdXQgdGhlIGVudGlyZSBwcm9jZXNzLCByZWdhcmRsZXNzIG9mIHBoYXNlCiAgICAgICAgICAgIGNvbnN0IGludGVycG9sYXRlZENvbG9yID0gaW50ZXJwb2xhdGVDb2xvcihwLmluaXRpYWxSZ2JhLCBwLnRhcmdldFJnYmEsIGluZGl2aWR1YWxQcm9ncmVzcyk7CiAgICAgICAgICAgIGNvbnN0IHBhcnNlZENvbG9yID0gcGFyc2VSR0JBKGludGVycG9sYXRlZENvbG9yKTsKCiAgICAgICAgICAgIGlmIChpbmRpdmlkdWFsUHJvZ3Jlc3MgPD0gMC41KSB7IC8vIFBoYXNlIDE6IFBpeGVscyBmcm9tIGN1cnJlbnRJbWFnZSBtb3ZlIHRvd2FyZHMgdm9ydGV4CiAgICAgICAgICAgICAgICAvLyBQcm9ncmVzcyB3aXRoaW4gdGhpcyBwaGFzZSAoMCB0byAxKQogICAgICAgICAgICAgICAgY29uc3QgcGhhc2VQcm9ncmVzcyA9IGluZGl2aWR1YWxQcm9ncmVzcyAqIDI7CgogICAgICAgICAgICAgICAgLy8gTW92ZSBmcm9tIG9yaWdpbmFsIHBvc2l0aW9uIHRvd2FyZHMgdm9ydGV4IGNlbnRlciBhbmQgc3BpcmFsIGlud2FyZHMKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnREaXN0ID0gcC5kaXN0RnJvbVZvcnRleCAqICgxIC0gcGhhc2VQcm9ncmVzcyk7IC8vIERpc3RhbmNlIHNocmlua3MgdG8gMAogICAgICAgICAgICAgICAgLy8gQWRkIG1vcmUgcm90YXRpb25zIGZvciBhIG1vcmUgaW50ZW5zZSBzd2lybAogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEFuZ2xlID0gcC5hbmdsZUZyb21Wb3J0ZXggKyBwaGFzZVByb2dyZXNzICogTWF0aC5QSSAqIDY7IC8vIFN3aXJscyA2IGZ1bGwgcm90YXRpb25zCgogICAgICAgICAgICAgICAgZHJhd1ggPSBwLnZvcnRleFggKyBNYXRoLmNvcyhjdXJyZW50QW5nbGUpICogY3VycmVudERpc3Q7CiAgICAgICAgICAgICAgICBkcmF3WSA9IHAudm9ydGV4WSArIE1hdGguc2luKGN1cnJlbnRBbmdsZSkgKiBjdXJyZW50RGlzdDsKCiAgICAgICAgICAgICAgICBhbHBoYSA9IDEgLSBwaGFzZVByb2dyZXNzOyAvLyBGYWRlcyBvdXQKICAgICAgICAgICAgfSBlbHNlIHsgLy8gUGhhc2UgMjogUGl4ZWxzIGZyb20gbmV4dEltYWdlIGVtZXJnZSBmcm9tIHZvcnRleAogICAgICAgICAgICAgICAgLy8gUHJvZ3Jlc3Mgd2l0aGluIHRoaXMgcGhhc2UgKDAgdG8gMSkKICAgICAgICAgICAgICAgIGNvbnN0IHBoYXNlUHJvZ3Jlc3MgPSAoaW5kaXZpZHVhbFByb2dyZXNzIC0gMC41KSAqIDI7CgogICAgICAgICAgICAgICAgLy8gRW1lcmdlIGZyb20gdm9ydGV4IGNlbnRlciB0byBmaW5hbCBwb3NpdGlvbiBhbmQgc3BpcmFsIG91dHdhcmRzCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RGlzdCA9IHAuZGlzdEZyb21Wb3J0ZXggKiBwaGFzZVByb2dyZXNzOyAvLyBEaXN0YW5jZSBncm93cyBmcm9tIDAgdG8gZnVsbAogICAgICAgICAgICAgICAgLy8gU3dpcmwgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiBmb3IgYSBtb3JlIGR5bmFtaWMgInVud2luZGluZyIgZWZmZWN0CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5nbGUgPSBwLmFuZ2xlRnJvbVZvcnRleCAtIHBoYXNlUHJvZ3Jlc3MgKiBNYXRoLlBJICogNjsgLy8gU3dpcmxzIDYgZnVsbCByb3RhdGlvbnMKCiAgICAgICAgICAgICAgICBkcmF3WCA9IHAudm9ydGV4WCArIE1hdGguY29zKGN1cnJlbnRBbmdsZSkgKiBjdXJyZW50RGlzdDsKICAgICAgICAgICAgICAgIGRyYXdZID0gcC52b3J0ZXhZICsgTWF0aC5zaW4oY3VycmVudEFuZ2xlKSAqIGN1cnJlbnREaXN0OwoKICAgICAgICAgICAgICAgIGFscGhhID0gcGhhc2VQcm9ncmVzczsgLy8gRmFkZXMgaW4KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQXBwbHkgdGhlIGNhbGN1bGF0ZWQgYWxwaGEgKGZhZGUtaW4vb3V0KSB0byB0aGUgaW50ZXJwb2xhdGVkIGNvbG9yCiAgICAgICAgICAgIHBhcnNlZENvbG9yLmEgKj0gYWxwaGE7CiAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9IGByZ2JhKCR7cGFyc2VkQ29sb3Iucn0sICR7cGFyc2VkQ29sb3IuZ30sICR7cGFyc2VkQ29sb3IuYn0sICR7cGFyc2VkQ29sb3IuYX0pYDsKCiAgICAgICAgICAgIC8vIERyYXcgdGhlIHBpeGVsIGJsb2NrIGF0IGl0cyBjYWxjdWxhdGVkIHBvc2l0aW9uIGFuZCBjb2xvcgogICAgICAgICAgICBjdHhiaS5maWxsUmVjdChkcmF3WCwgZHJhd1ksIHBpeGVsQmxvY2tTaXplLCBwaXhlbEJsb2NrU2l6ZSk7CiAgICAgICAgfSk7CiAgICAgICAgY3R4YmkuZ2xvYmFsQWxwaGEgPSAxOyAvLyBSZXNldCBnbG9iYWwgYWxwaGEgdG8gZGVmYXVsdCBmb3IgYW55IG90aGVyIGRyYXdpbmcKCiAgICAgICAgLy8gLS0tIEFuaW1hdGlvbiBMb29wIENvbnRyb2wgLS0tCiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgewogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLgoKICAgICAgICAgICAgLy8gMS4gRHJhdyB0aGUgZmluYWwgaW1hZ2UgKEIpIHRvIHRoZSBjYW52YXMgdG8gY29tcGxldGVseSBjb3ZlciB0aGUgdHJhbnNpdGlvbiBwaXhlbHMuCiAgICAgICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwoKICAgICAgICAgICAgLy8gMi4gU1dBUCBPQkpFQ1RTOiBUaGUgb2xkIHRhcmdldCBpbWFnZSBvYmplY3QgKEIpIGlzIHRoZSBuZXcgc3RhcnQgaW1hZ2Ugb2JqZWN0IChBKS4KICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOwoKICAgICAgICAgICAgLy8gMy4gU1dBUCBVUkxTOiBUaGUgb2xkIHRhcmdldCBVUkwgKEIpIGlzIHRoZSBuZXcgc3RhcnQgVVJMIChBKS4KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7CgogICAgICAgICAgICAvLyA0LiBHRU5FUkFURSBORVcgVEFSR0VUIFVSTCAoQykgZm9yIHRoZSBuZXh0IHRyYW5zaXRpb24KICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgCgogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuIE5vIGRlbGF5IG5lZWRlZCBoZXJlLgogICAgICAgICAgICBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKTsKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgYW5kIHN0YXJ0cyB0aGUgYW5pbWF0aW9uIHNlcXVlbmNlLgogICAgICovCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsKICAgICAgICBjdXJyZW50RnJhbWViYiA9IDA7ICAgICAgICAgLy8gUmVzZXQgZnJhbWUgY291bnRlciBmb3IgdGhlIG5ldyBhbmltYXRpb24KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsgICAgICAgLy8gUHJlcGFyZSBwaXhlbCBkYXRhIGZvciB0aGUgbmV3IHRyYW5zaXRpb24KICAgICAgICBBTklNQVRFKCk7ICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIGFuaW1hdGlvbiBsb29wCiAgICB9OwoKICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tCiAgICB3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOwogICAgfTsKPC9zY3JpcHQ+CgoKPC9ib2R5PjwvaHRtbD4=<br>PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPHRpdGxlPkNvbnRpbnVvdXMgSW1hZ2UgVHJhbnNpdGlvbiBGaXg8L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBmb250LWZhbWlseTogc2Fucy1zZXJpZjsNCiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyogQ29udGFpbmVyIGZvciB0aGUgY2FudmFzL2JhY2tncm91bmQgaW1hZ2UgKi8NCiAgICAgICAgY2FudmFzIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyAvKiBBZGp1c3RlZCB0byBmaXQgMzUwcHggY2FudmFzICsgcGFkZGluZy9tYXJnaW4gaWYgbmVlZGVkICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovDQogICAgICAgICNhbmltYXRpb25DYW52YXMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzMzMzsgLyogQWRkZWQgYm9yZGVyIGZvciB2aXNpYmlsaXR5ICovDQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgIH0NCg0KICAgICAgICAjZWZmZWN0LW5hbWUgew0KICAgICAgICAgICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4yZW07DQogICAgICAgICAgICBjb2xvcjogI2NjYzsNCmRpc3BsYXk6bm9uZTsNCiAgICAgICAgfQ0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCg0KPGRpdiBpZD0nY2FudmFzJyBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTsnPg0KICAgIDxjYW52YXMgaWQ9J2FuaW1hdGlvbkNhbnZhcycgd2lkdGg9ODAwIGhlaWdodD00NTAgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCUnPjwvY2FudmFzPg0KPC9kaXY+DQo8ZGl2IGlkPSdlZmZlY3QtbmFtZSc+Q3VycmVudCBFZmZlY3Q6IERJRkZFUkVOQ0UgQmxlbmQ8L2Rpdj4NCg0KPHNjcmlwdD4NCiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0NCiAgICAvLyBVc2luZyAzNTB4NjAwIGZvciBiZXR0ZXIgYXNwZWN0IHJhdGlvIGJhc2VkIG9uIHlvdXIgYnJlZWQzNjAvaG9vZzE4MCB2YWx1ZXMNCiAgICB2YXIgY3VycmVudFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQogICAgdmFyIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KICAgIA0KICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqQWN0dWFsIEltYWdlIE9iamVjdHMqIGZvciB0aGUgYW5pbWF0aW9uDQogICAgdmFyIGN1cnJlbnRJbWFnZSA9IG51bGw7IC8vIEltYWdlIEEgKFRoZSBTdGFydCkNCiAgICB2YXIgbmV4dEltYWdlID0gbnVsbDsgICAgLy8gSW1hZ2UgQiAoVGhlIFRhcmdldCkNCg0KICAgIC8vIC0tLSBHbG9iYWwgQW5pbWF0aW9uIFZhcmlhYmxlcyAtLS0NCiAgICB2YXIgY2FudmFzYmJpOw0KICAgIHZhciBjdHhiaTsNCiAgICB2YXIgaW1hZ2VzYmkgPSB7fTsgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQ0KICAgIHZhciBwaXhiaXhlbHMgPSBbXTsgICAgICAvLyBTdG9yZXMgdGhlIHBpeGVsIGRhdGENCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDYwOyAgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3Igc21vb3RoZXIgdHJhbnNpdGlvbg0KICAgIHZhciBjdXJyZW50RnJhbWViYiA9IDA7DQogICAgDQogICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIGNhbnZhcyBlbGVtZW50IChBZGp1c3RlZCB0byBhIGNvbW1vbiB2ZXJ0aWNhbCByYXRpbykNCiAgICB2YXIgYnJlZWQzNjAgPSA4MDA7ICAvLyANCiAgICB2YXIgaG9vZzE4MCA9IDQ1MDsgLy8NCg0KICAgIC8vIC0tLSBOZXcgRWZmZWN0IE1hbmFnZW1lbnQgLS0tDQogICAgY29uc3QgZWZmZWN0cyA9IFsnRElGRkVSRU5DRScsICdNSU5JTVVNJywgJ01BWElNVU0nXTsNCiAgICBsZXQgY3VycmVudEVmZmVjdEluZGV4ID0gMDsNCg0KICAgIC8qKg0KICAgICAqIERldGVybWluZXMgdGhlIGJsZW5kZWQgY29sb3IgYmFzZWQgb24gdGhlIGVmZmVjdCBhbmQgaW50ZXJwb2xhdGlvbi4NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gYzEgLSBDaGFubmVsIHZhbHVlIChSLCBHLCBvciBCKSBmcm9tIEltYWdlIEEgKGN1cnJlbnQpLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBjMiAtIENoYW5uZWwgdmFsdWUgKFIsIEcsIG9yIEIpIGZyb20gSW1hZ2UgQiAobmV4dCkuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IHByb2dyZXNzIC0gRWFzZWQgcHJvZ3Jlc3MgKDAgdG8gMSkgZm9yIHRoZSBpbnRlcnBvbGF0aW9uLg0KICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBibGVuZGVkIGNoYW5uZWwgdmFsdWUuDQogICAgICovDQogICAgY29uc3QgYmxlbmRQaXhlbCA9IChjMSwgYzIsIHByb2dyZXNzLCBlZmZlY3ROYW1lKSA9PiB7DQogICAgICAgIGxldCBpbml0aWFsQmxlbmQ7DQoNCiAgICAgICAgc3dpdGNoIChlZmZlY3ROYW1lKSB7DQogICAgICAgICAgICBjYXNlICdESUZGRVJFTkNFJzoNCiAgICAgICAgICAgICAgICAvLyBJbml0aWFsIHN0YXRlOiBBYnNvbHV0ZSBkaWZmZXJlbmNlIChwdXJlIGJsZW5kIG1vZGUpDQogICAgICAgICAgICAgICAgLy8gYzEgKiAoMS1wcm9ncmVzcykgKyBNYXRoLmFicyhjMSAtIGMyKSAqICgxLXByb2dyZXNzKSArIGMyICogcHJvZ3Jlc3MgaXMgdG9vIGNvbXBsZXgNCiAgICAgICAgICAgICAgICAvLyBTaW1wbGUgaWRlYTogc3RhcnQgYXQgZnVsbCBkaWZmZXJlbmNlLCBtb3ZlIHRvIEMyLg0KICAgICAgICAgICAgICAgIGluaXRpYWxCbGVuZCA9IE1hdGguYWJzKGMxIC0gYzIpOyANCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ01JTklNVU0nOg0KICAgICAgICAgICAgICAgIC8vIEluaXRpYWwgc3RhdGU6IFRoZSBtaW5pbXVtIG9mIHRoZSB0d28gKGRhcmtlc3QpDQogICAgICAgICAgICAgICAgaW5pdGlhbEJsZW5kID0gTWF0aC5taW4oYzEsIGMyKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgJ01BWElNVU0nOg0KICAgICAgICAgICAgICAgIC8vIEluaXRpYWwgc3RhdGU6IFRoZSBtYXhpbXVtIG9mIHRoZSB0d28gKGxpZ2h0ZXN0KQ0KICAgICAgICAgICAgICAgIGluaXRpYWxCbGVuZCA9IE1hdGgubWF4KGMxLCBjMik7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgICAgIGluaXRpYWxCbGVuZCA9IGMxOyAvLyBGYWxsYmFjaw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gVGhlICdkYW1hZ2UnIHN0YXRlIGlzIGluaXRpYWxCbGVuZC4gVGhlICdpbXByb3ZlZCcgc3RhdGUgaXMgYzIuDQogICAgICAgIC8vIFdlIGludGVycG9sYXRlIGZyb20gaW5pdGlhbEJsZW5kIHRvIGMyIGJhc2VkIG9uIHRoZSBwcm9ncmVzcy4NCiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoaW5pdGlhbEJsZW5kICogKDEgLSBwcm9ncmVzcykgKyBjMiAqIHByb2dyZXNzKTsNCiAgICB9Ow0KDQogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tDQoNCiAgICAvKioNCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuDQogICAgICovDQogICAgdmFyIGxvYWRJbWFnZWJiID0gKHNyYywgY2FsbGJhY2spID0+IHsNCiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOw0KICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgaW1hZ2VzYmlbc3JjXSA9IGltZzsgDQogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsNCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLnNyYyA9IHNyYzsNCiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7IA0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBMb2FkcyB0aGUgbmV4dCBpbWFnZSBpbiB0aGUgc2VxdWVuY2UgYW5kIHN0YXJ0cyB0aGUgdHJhbnNpdGlvbi4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7DQogICAgICAgIGxldCBuZXdJbWFnZVVSTCA9IG5leHRVUkw7DQogICAgICAgIA0KICAgICAgICBpZiAoaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdKSB7DQogICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXdJbWFnZVVSTF07DQogICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBsb2FkSW1hZ2ViYihuZXdJbWFnZVVSTCwgKGVycm9yLCBpbWcpID0+IHsNCiAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltZzsNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05ldyBpbWFnZSBmYWlsZWQgdG8gbG9hZC4gUmV0cnlpbmcuLi4nKTsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChsb2FkTmV4dEltYWdlQW5kU3RhcnQsIDIwMDApOyANCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGNhbnZhcyBhbmQgbG9hZHMgdGhlIGluaXRpYWwgdHdvIGltYWdlcyAoQSBhbmQgQikuDQogICAgICovDQogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsNCiAgICAgICAgLy8gSW5pdGlhbGl6ZSBjYW52YXMgT05MWSBPTkNFDQogICAgICAgIGNhbnZhc2JiaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25DYW52YXMnKTsNCiAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7IA0KICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgY3R4YmkgPSBjYW52YXNiYmkuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgIC8vICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FudmFzJykuc3R5bGUud2lkdGggPSBicmVlZDM2MCArICdweCc7DQogICAgICAgIC8vZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpLnN0eWxlLmhlaWdodCA9IGhvb2cxODAgKyAncHgnOw0KDQoNCiAgICAgICAgbGV0IGltYWdlc1RvTG9hZCA9IFtjdXJyZW50VVJMLCBuZXh0VVJMXTsNCiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsNCiAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7DQoNCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICBpZiAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBoYXNFcnJvciA9IHRydWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7DQoNCiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA9PT0gaW1hZ2VzVG9Mb2FkLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzYmlbY3VycmVudFVSTF07DQogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25leHRVUkxdOw0KICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgdmVyeSBmaXJzdCBhbmltYXRpb24gKEEgLT4gQikNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIGltYWdlc1RvTG9hZC5mb3JFYWNoKHNyYyA9PiBsb2FkSW1hZ2ViYihzcmMsIG9uSW1hZ2VMb2FkZWQpKTsNCiAgICB9DQoNCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICAvLyBSZW1vdmVkIHBhcnNlUkdCQSBhbmQgaW50ZXJwb2xhdGVDb2xvciBhcyB0aGV5IGFyZSBub3QgbmVlZGVkIGZvciBwaXhlbCBtYW5pcHVsYXRpb24NCg0KICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsNCg0KICAgIC8qKg0KICAgICAqIEV4dHJhY3RzIHBpeGVsIGRhdGEgYW5kIHByZS1jYWxjdWxhdGVzIHRoZSBzdGFydGluZyBibGVuZGVkIHN0YXRlLg0KICAgICAqLw0KICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7DQogICAgICAgIHZhciBpbWcxID0gY3VycmVudEltYWdlOyAvLyBJbWFnZSBBIChTdGFydCkNCiAgICAgICAgdmFyIGltZzIgPSBuZXh0SW1hZ2U7ICAgIC8vIEltYWdlIEIgKFRhcmdldCkNCg0KICAgICAgICBwaXhiaXhlbHMgPSBbXTsNCiAgICAgICAgDQogICAgICAgIC8vIDEuIERyYXcgSW1hZ2UgQSAoU3RhcnQpIHRvIHRoZSBjYW52YXMNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgIGN0eGJpLmRyYXdJbWFnZShpbWcxLCAwLCAwICwgYnJlZWQzNjAsIGhvb2cxODApOw0KICAgICAgICB2YXIgZGF0YTEgPSBjdHhiaS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOw0KICAgICAgICANCiAgICAgICAgLy8gMi4gRHJhdyBJbWFnZSBCIChUYXJnZXQpIHRvIGEgdGVtcG9yYXJ5IGNhbnZhcw0KICAgICAgICB2YXIgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgICAgICB2YXIgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IGNhbnZhc2JiaS53aWR0aDsNCiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0Ow0KICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWcyLCAwLCAwLCBicmVlZDM2MCwgaG9vZzE4MCk7DQogICAgICAgIHZhciBkYXRhMiA9IHRlbXBDdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsNCiAgICAgICAgDQogICAgICAgIC8vIDMuIFN0b3JlIGJvdGggc2V0cyBvZiBwaXhlbCBkYXRhDQogICAgICAgIGNvbnN0IGxlbmd0aCA9IGRhdGExLmxlbmd0aDsNCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gNCkgew0KICAgICAgICAgICAgcGl4Yml4ZWxzLnB1c2goew0KICAgICAgICAgICAgICAgIHIxOiBkYXRhMVtpXSwgZzE6IGRhdGExW2krMV0sIGIxOiBkYXRhMVtpKzJdLA0KICAgICAgICAgICAgICAgIHIyOiBkYXRhMltpXSwgZzI6IGRhdGEyW2krMV0sIGIyOiBkYXRhMltpKzJdLA0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIERyYXcgSW1hZ2UgQSBhZ2FpbiB0byBlbnN1cmUgdGhlIGZyYW1lIHN0YXJ0cyB3aXRoIGEgY2xlYW4gaW1hZ2UgYmVmb3JlIHRoZSBhbmltYXRpb24gYmVnaW5zDQogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICBjdHhiaS5kcmF3SW1hZ2UoaW1nMSwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZW5kZXJzIHRoZSBjdXJyZW50IGFuaW1hdGlvbiBmcmFtZS4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChjdXJyZW50RnJhbWViYiAvIHRvdGFsRnJhbWVzYmIpOw0KICAgICAgICBjb25zdCBlZmZlY3ROYW1lID0gZWZmZWN0c1tjdXJyZW50RWZmZWN0SW5kZXhdOw0KDQogICAgICAgIC8vIDEuIENyZWF0ZSBuZXcgaW1hZ2UgZGF0YSBvYmplY3QNCiAgICAgICAgdmFyIGltYWdlRGF0YSA9IGN0eGJpLmNyZWF0ZUltYWdlRGF0YShjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICB2YXIgZGF0YSA9IGltYWdlRGF0YS5kYXRhOw0KDQogICAgICAgIC8vIDIuIExvb3AgdGhyb3VnaCBwaXhlbHMgYW5kIGFwcGx5IGJsZW5kDQogICAgICAgIGNvbnN0IGxlbmd0aCA9IHBpeGJpeGVscy5sZW5ndGg7DQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGNvbnN0IHBpeGVsID0gcGl4Yml4ZWxzW2ldOw0KICAgICAgICAgICAgY29uc3QgZGF0YUluZGV4ID0gaSAqIDQ7DQoNCiAgICAgICAgICAgIC8vIFJlZCBjaGFubmVsIGJsZW5kOiBmcm9tIGluaXRpYWwgYmxlbmRlZCBzdGF0ZSB0byBmaW5hbCBJbWFnZSBCIChjMikNCiAgICAgICAgICAgIGRhdGFbZGF0YUluZGV4XSA9IGJsZW5kUGl4ZWwocGl4ZWwucjEsIHBpeGVsLnIyLCBwcm9ncmVzcywgZWZmZWN0TmFtZSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIEdyZWVuIGNoYW5uZWwgYmxlbmQNCiAgICAgICAgICAgIGRhdGFbZGF0YUluZGV4ICsgMV0gPSBibGVuZFBpeGVsKHBpeGVsLmcxLCBwaXhlbC5nMiwgcHJvZ3Jlc3MsIGVmZmVjdE5hbWUpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBCbHVlIGNoYW5uZWwgYmxlbmQNCiAgICAgICAgICAgIGRhdGFbZGF0YUluZGV4ICsgMl0gPSBibGVuZFBpeGVsKHBpeGVsLmIxLCBwaXhlbC5iMiwgcHJvZ3Jlc3MsIGVmZmVjdE5hbWUpOw0KDQogICAgICAgICAgICAvLyBBbHBoYSBjaGFubmVsIChhbHdheXMgZnVsbHkgb3BhcXVlIGZvciBzaW1wbGljaXR5KQ0KICAgICAgICAgICAgZGF0YVtkYXRhSW5kZXggKyAzXSA9IDI1NTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIDMuIFB1dCB0aGUgbWFuaXB1bGF0ZWQgaW1hZ2UgZGF0YSBiYWNrIG9udG8gdGhlIGNhbnZhcw0KICAgICAgICBjdHhiaS5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsNCg0KICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7DQogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOw0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOyANCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4gUHJlcGFyZSB0aGUgbmV4dCByb3VuZCAoQiAtPiBDKS4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gMS4gRHJhdyB0aGUgZmluYWwgaW1hZ2UgKEIpIHRvIHRoZSBjYW52YXMgdG8gY29tcGxldGVseSBjb3ZlciB0aGUgdHJhbnNpdGlvbiBwaXhlbHMuDQogICAgICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgICAgIC8vIDIuIFNXQVAgT0JKRUNUUzogVGhlIG9sZCB0YXJnZXQgaW1hZ2Ugb2JqZWN0IChCKSBpcyB0aGUgbmV3IHN0YXJ0IGltYWdlIG9iamVjdCAoQSkuDQogICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIDMuIFNXQVAgVVJMUzogVGhlIG9sZCB0YXJnZXQgVVJMIChCKSBpcyB0aGUgbmV3IHN0YXJ0IFVSTCAoQSkuDQogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsgDQoNCiAgICAgICAgICAgIC8vIDQuIFJPVEFURSBFRkZFQ1QNCiAgICAgICAgICAgIGN1cnJlbnRFZmZlY3RJbmRleCA9IChjdXJyZW50RWZmZWN0SW5kZXggKyAxKSAlIGVmZmVjdHMubGVuZ3RoOw0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VmZmVjdC1uYW1lJykuaW5uZXJUZXh0ID0gYEN1cnJlbnQgRWZmZWN0OiAke2VmZmVjdHNbY3VycmVudEVmZmVjdEluZGV4XX0gQmxlbmRgOw0KDQogICAgICAgICAgICAvLyA1LiBHRU5FUkFURSBORVcgVEFSR0VUIFVSTCAoQykNCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7ICANCg0KICAgICAgICAgICAgLy8gNi4gU3RhcnQgdGhlIGxvYWQgcHJvY2VzcyBmb3IgdGhlIG5leHQgaW1hZ2UgKEMpLg0KICAgICAgICAgICAgbG9hZE5leHRJbWFnZUFuZFN0YXJ0KCk7IA0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOw0KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsgDQogICAgICAgIEFOSU1BVEUoKTsgDQogICAgfTsNCg0KICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tDQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpbml0Q2FudmFzQW5kSW1hZ2VzKCk7DQogICAgfTsNCjwvc2NyaXB0Pg0KDQo8L2JvZHk+DQo8L2h0bWw+<br>DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDx0aXRsZT5QaXhlbCBGbG93IEFuaW1hdGlvbiBCeSBSaWRvdWFuIEJlbiBNYXNzb3VkPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIGJvZHl7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO21pbi1oZWlnaHQ6MTAwdmg7YmFja2dyb3VuZC1jb2xvcjojMTExO21hcmdpbjowO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtvdmVyZmxvdzpoaWRkZW59DQogICAgICAgIGNhbnZhc3tib3JkZXI6MCBzb2xpZCAjMzMzOw0KfQ0KICAgICAgICAjY29udHJvbHN7bWFyZ2luLXRvcDoyMHB4O2NvbG9yOndoaXRlO2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWY7Zm9udC1zaXplOjE0cHg7ZGlzcGxheTpub25lfQ0KICAgICAgICBpbnB1dFt0eXBlPSJmaWxlIl17bWFyZ2luLWxlZnQ6MTBweH0NCg0KICAgICAgICAvKiBEZSAnY2FudmFzJyBkaXYgKG51IGZ1bGwgc2NyZWVuKSAqLw0KICAgICAgICAjY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQoNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgIA0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAJIGhlaWdodDoxMDAlOw0KIAkgd2lkdGg6MTAwJTsNCg0KICAgICAgICAgICAgLyogRGUgY2FudmFzIHdvcmR0IGhpZXJiaW5uZW4gZ2VwbGFhdHN0IGVuIGdlc2NoYWFsZCBkb29yIENTUyAqLw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBTdHlsaW5nIHZvb3IgZGUgY2FudmFzIGRpZSBkb29yIGRlIEpTIGNvZGUgd29yZHQgYWFuZ2VtYWFrdCAqLw0KICAgICAgICAjYW5pbWF0aW9uQ2FudmFzT0cgew0KICAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERlICdjYW52YXMnIGRpdiAqLw0KICAgICAgICAjX18zY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogU3R5bGluZyB2b29yIGRlIGNhbnZhcyBkaWUgZG9vciBkZSBKUyBjb2RlIHdvcmR0IGFhbmdlbWFha3QgKi8NCiAgICAgICAgI19fM2FuaW1hdGlvbkNhbnZhc09HIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBUaGUgJ2NhbnZhcycgZGl2IChUaGUgRGV0b25hdGlvbiBGaWVsZCkgKi8NCiAgICAgICAgI2ZpZWxkQ29udGFpbmVyIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyANCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IA0KICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBUaGUgQ2FudmFzICovDQogICAgICAgICNyZW5kZXJTdXJmYWNlIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDsgDQoNCiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4wNXMgZWFzZS1vdXQ7IA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAjcHJvdG9jb2wtc3RhdHVzIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogMjBweDsNCiAgICAgICAgICAgIGxlZnQ6IDUwJTsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgIHotaW5kZXg6IDEwOw0KICAgICAgICAgICAgZm9udC1zaXplOiAxLjVlbTsNCiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgDQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KDQogICANCg0KPGRpdiBpZD0icHJvdG9jb2wtc3RhdHVzIj5SX19JTlZFUlNFX0ZMT1c6IERFVE9OQVRJT05fUkVWRVJTQUw8L2Rpdj4NCg0KICAgIDxpbWcgaWQ9InNvdXJjZUltYWdlQSIgYWx0PSJTb3VyY2UgRGF0YSBBIiBjbGFzcz0iaGlkZGVuLWltZyIgc3R5bGU9J2Rpc3BsYXk6IG5vbmU7JyAvPg0KICAgIDxpbWcgaWQ9InNvdXJjZUltYWdlQiIgYWx0PSJTb3VyY2UgRGF0YSBCIiBjbGFzcz0iaGlkZGVuLWltZyIgc3R5bGU9J2Rpc3BsYXk6IG5vbmU7Jy8+DQoNCiAgICA8ZGl2IGlkPSJmaWVsZENvbnRhaW5lciI+DQogICAgPC9kaXY+DQoNCiAgICA8ZGl2IGlkPSJzdGF0dXMtZGlzcGxheSIgc3R5bGU9ImRpc3BsYXk6bm9uZTttYXJnaW4tdG9wOiAyMHB4OyBmb250LXNpemU6IDEuMmVtOyBjb2xvcjogeWVsbG93OyI+Ul9fUFJPVE9DT0xfQlJFQUNIOiBJbml0aWF0aW5nIEludmVyc2UgUGh5c2ljcy4uLjwvZGl2Pg0KDQogICAgPHNjcmlwdD4NCiAgICAgICAgLy8gLS0tIFN5c3RlbSBDb25zdGFudHMgLS0tDQogICAgICAgIGNvbnN0IElNQUdFX0RJTUVOU0lPTl9YID0gMzAwOyANCiAgICAgICAgY29uc3QgSU1BR0VfRElNRU5TSU9OX1kgPSAzMDA7DQogICAgICAgIA0KICAgICAgICBjb25zdCBzZWVkVmFsdWVBID0gTWF0aC5yb3VuZCgxMDAwMCAqIE1hdGgucmFuZG9tKCkpOw0KICAgICAgICBjb25zdCBzZWVkVmFsdWVCID0gTWF0aC5yb3VuZCgxMDAwMCAqIE1hdGgucmFuZG9tKCkpOw0KICAgICAgICANCiAgICAgICAgY29uc3QgaW1hZ2VVcmxBID0gJ2h0dHA6Ly8xMjcuMC4wLjEvZ2V0UmFuZEltYWdlLnBocD9yYW5kb209JyArIHNlZWRWYWx1ZUE7DQogICAgICAgIGNvbnN0IGltYWdlVXJsQiA9ICdodHRwOi8vMTI3LjAuMC4xL2dldFJhbmRJbWFnZS5waHA/cmFuZG9tPScgKyBzZWVkVmFsdWVCOw0KICAgICAgICBjb25zdCBhbmltYXRpb25TcGVlZE1zID0gNjA7IA0KDQogICAgICAgIGNvbnN0IGVsZW1lbnRTb3VyY2VBID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdXJjZUltYWdlQScpOw0KICAgICAgICBjb25zdCBlbGVtZW50U291cmNlQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzb3VyY2VJbWFnZUInKTsNCiAgICAgICAgY29uc3Qgc3RhdHVzRGlzcGxheSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMtZGlzcGxheScpOw0KDQogICAgICAgIGVsZW1lbnRTb3VyY2VBLnNyYyA9IGltYWdlVXJsQTsNCiAgICAgICAgZWxlbWVudFNvdXJjZUIuc3JjID0gaW1hZ2VVcmxCOw0KICAgICAgICBlbGVtZW50U291cmNlQS5jcm9zc09yaWdpbiA9ICdBbm9ueW1vdXMnOw0KICAgICAgICBlbGVtZW50U291cmNlQi5jcm9zc09yaWdpbiA9ICdBbm9ueW1vdXMnOw0KICAgICAgICANCiAgICAgICAgdmFyIHJlbmRlckNhbnZhczsNCiAgICAgICAgdmFyIGNhbnZhc0NvbnRleHQ7DQogICAgICAgIHZhciBjb3JlQ2VudGVyQ29vcmRYOyANCiAgICAgICAgdmFyIGNvcmVDZW50ZXJDb29yZFk7DQoNCiAgICAgICAgdmFyIG1heEN5Y2xlU3RlcHMgPSA1MDsNCiAgICAgICAgdmFyIGN1cnJlbnRDeWNsZVN0ZXAgPSAwOw0KICAgICAgICB2YXIgcHJlY2FsY3VsYXRlZEZyYW1lcyA9IFtdOyANCiAgICAgICAgdmFyIGluaXRpYWxQaXhlbERhdGEsIHRhcmdldFBpeGVsRGF0YTsgDQoNCiAgICAgICAgLy8gLS0tIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgSW1hZ2VEYXRhIC0tLQ0KICAgICAgICBmdW5jdGlvbiBleHRyYWN0UGl4ZWxEYXRhKGltYWdlRWxlbWVudCkgew0KICAgICAgICAgICAgY29uc3QgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgICAgICAgICAgY29uc3QgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIHRlbXBDYW52YXMud2lkdGggPSBpbWFnZUVsZW1lbnQud2lkdGg7DQogICAgICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGltYWdlRWxlbWVudC5oZWlnaHQ7DQogICAgICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWFnZUVsZW1lbnQsIDAsIDAsIHRlbXBDYW52YXMud2lkdGgsIHRlbXBDYW52YXMuaGVpZ2h0KTsNCiAgICAgICAgICAgIHJldHVybiB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB0ZW1wQ2FudmFzLndpZHRoLCB0ZW1wQ2FudmFzLmhlaWdodCk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogU0FCT1RBR0UgQ09SRTogQ2FsY3VsYXRlcyBhIHNpbmdsZSBmcmFtZSB3aXRoIElOVkVSU0UgTU9WRU1FTlQuDQogICAgICAgICAqICogQHBhcmFtIHtib29sZWFufSBpc0RldG9uYXRpb25QaGFzZSAtIElmIHRydWUsIHBpeGVscyBleHBsb2RlIG91dHdhcmRzIChEZXRvbmF0aW9uKS4gDQogICAgICAgICAqIElmIGZhbHNlLCBwaXhlbHMgcnVzaCBpbndhcmRzIChSZXZlcnNhbC9JbXBsb3Npb24pLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gY2FsY3VsYXRlRGlzdG9ydGlvbkZyYW1lKG9yaWdpbmFsRGF0YSwgc3RlcFZhbHVlLCB0b3RhbFBoYXNlU3RlcHMsIGlzRGV0b25hdGlvblBoYXNlKSB7DQogICAgICAgICAgICBjb25zdCB3aWR0aFZhbHVlID0gb3JpZ2luYWxEYXRhLndpZHRoOw0KICAgICAgICAgICAgY29uc3QgaGVpZ2h0VmFsdWUgPSBvcmlnaW5hbERhdGEuaGVpZ2h0Ow0KICAgICAgICAgICAgY29uc3Qgb3JpZ2luYWxQaXhlbHMgPSBvcmlnaW5hbERhdGEuZGF0YTsNCiAgICAgICAgICAgIGNvbnN0IG5ld1BpeGVsc0J1ZmZlciA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aFZhbHVlICogaGVpZ2h0VmFsdWUgKiA0KTsNCg0KICAgICAgICAgICAgZm9yIChsZXQgcGl4ZWxJbmRleCA9IDA7IHBpeGVsSW5kZXggPCBuZXdQaXhlbHNCdWZmZXIubGVuZ3RoOyBwaXhlbEluZGV4ICs9IDQpIHsNCiAgICAgICAgICAgICAgICBuZXdQaXhlbHNCdWZmZXJbcGl4ZWxJbmRleCArIDNdID0gMDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgY29uc3QgbWF4RGlzcGxhY2VtZW50ID0gd2lkdGhWYWx1ZSAvIDIuNTsNCiAgICAgICAgICAgIGNvbnN0IGN5Y2xlUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCBzdGVwVmFsdWUgLyAodG90YWxQaGFzZVN0ZXBzIC0gMSkpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyAtLS0gR2xpdGNoIFNldHRpbmdzIChTYWJvdGFnZSBQYXJhbWV0ZXJzKSAtLS0NCiAgICAgICAgICAgIGNvbnN0IFFVQU5USVpBVElPTl9MRVZFTCA9IDMyOyANCiAgICAgICAgICAgIGNvbnN0IE1BWF9KSVRURVIgPSA1OyANCg0KICAgICAgICAgICAgZm9yIChsZXQgeUNvb3JkID0gMDsgeUNvb3JkIDwgaGVpZ2h0VmFsdWU7IHlDb29yZCsrKSB7DQogICAgICAgICAgICAgICAgZm9yIChsZXQgeENvb3JkID0gMDsgeENvb3JkIDwgd2lkdGhWYWx1ZTsgeENvb3JkKyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YUluZGV4ID0gKHlDb29yZCAqIHdpZHRoVmFsdWUgKyB4Q29vcmQpICogNDsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFNBQk9UQUdFIDE6IFF1YW50aXphdGlvbiBFcnJvcg0KICAgICAgICAgICAgICAgICAgICBjb25zdCByX3F1YW50ID0gTWF0aC5yb3VuZChvcmlnaW5hbFBpeGVsc1tkYXRhSW5kZXhdIC8gUVVBTlRJWkFUSU9OX0xFVkVMKSAqIFFVQU5USVpBVElPTl9MRVZFTDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ19xdWFudCA9IE1hdGgucm91bmQob3JpZ2luYWxQaXhlbHNbZGF0YUluZGV4ICsgMV0gLyBRVUFOVElaQVRJT05fTEVWRUwpICogUVVBTlRJWkFUSU9OX0xFVkVMOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBiX3F1YW50ID0gTWF0aC5yb3VuZChvcmlnaW5hbFBpeGVsc1tkYXRhSW5kZXggKyAyXSAvIFFVQU5USVpBVElPTl9MRVZFTCkgKiBRVUFOVElaQVRJT05fTEVWRUw7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFfY2hhbm5lbCA9IG9yaWdpbmFsUGl4ZWxzW2RhdGFJbmRleCArIDNdOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGF2Z0NvbG9yID0gKHJfcXVhbnQgKyBnX3F1YW50ICsgYl9xdWFudCkgLyAzOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBub3JtYWxpemVkQXZnQ29sb3IgPSBhdmdDb2xvciAvIDI1NTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyAxLiBWZWN0b3IgY2FsY3VsYXRpb24NCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsdGFYID0gY29yZUNlbnRlckNvb3JkWCAtIHhDb29yZDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsdGFZID0gY29yZUNlbnRlckNvb3JkWSAtIHlDb29yZDsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGl4ZWxEaXN0YW5jZSA9IE1hdGguc3FydChkZWx0YVggKiBkZWx0YVggKyBkZWx0YVkgKiBkZWx0YVkpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgbGV0IGRpcmVjdGlvblggPSBwaXhlbERpc3RhbmNlID4gMCA/IGRlbHRhWCAvIHBpeGVsRGlzdGFuY2UgOiAwOw0KICAgICAgICAgICAgICAgICAgICBsZXQgZGlyZWN0aW9uWSA9IHBpeGVsRGlzdGFuY2UgPiAwID8gZGVsdGFZIC8gcGl4ZWxEaXN0YW5jZSA6IDA7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyAyLiBNb3ZlbWVudCBNYWduaXR1ZGUNCiAgICAgICAgICAgICAgICAgICAgbGV0IGRpc3BsYWNlbWVudE1hZ25pdHVkZSA9IG5vcm1hbGl6ZWRBdmdDb2xvciAqIG1heERpc3BsYWNlbWVudCAqIGN5Y2xlUHJvZ3Jlc3M7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIFNBQk9UQUdFIDI6IElOVkVSVEVEIERJUkVDVElPTiAtLS0NCiAgICAgICAgICAgICAgICAgICAgbGV0IGRpc3BsYWNlbWVudFgsIGRpc3BsYWNlbWVudFk7DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGV0b25hdGlvblBoYXNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBQSEFTRSAxIChEZXRvbmF0aW9uKTogU2hhdHRlciBBV0FZIGZyb20gY2VudGVyDQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGFjZW1lbnRYID0gLWRpcmVjdGlvblggKiBkaXNwbGFjZW1lbnRNYWduaXR1ZGU7DQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGFjZW1lbnRZID0gLWRpcmVjdGlvblkgKiBkaXNwbGFjZW1lbnRNYWduaXR1ZGU7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBQSEFTRSAyIChSZXZlcnNhbCk6IEltcGxvc2lvbiBUT1dBUkRTIGNlbnRlcg0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxhY2VtZW50WCA9IGRpcmVjdGlvblggKiBkaXNwbGFjZW1lbnRNYWduaXR1ZGU7DQogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGFjZW1lbnRZID0gZGlyZWN0aW9uWSAqIGRpc3BsYWNlbWVudE1hZ25pdHVkZTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1ggPSB4Q29vcmQgKyBkaXNwbGFjZW1lbnRYOw0KICAgICAgICAgICAgICAgICAgICBsZXQgbmV3WSA9IHlDb29yZCArIGRpc3BsYWNlbWVudFk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBTQUJPVEFHRSAzOiBKaXR0ZXIvRGlnaXRhbCBOb2lzZQ0KICAgICAgICAgICAgICAgICAgICBjb25zdCBqaXR0ZXJYID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTUFYX0pJVFRFUiAqIGN5Y2xlUHJvZ3Jlc3MgKiAxLjU7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGppdHRlclkgPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBNQVhfSklUVEVSICogY3ljbGVQcm9ncmVzcyAqIDEuNTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIG5ld1ggKz0gaml0dGVyWDsNCiAgICAgICAgICAgICAgICAgICAgbmV3WSArPSBqaXR0ZXJZOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIENsYW1wIGFuZCByb3VuZA0KICAgICAgICAgICAgICAgICAgICBuZXdYID0gTWF0aC5yb3VuZChNYXRoLm1heCgwLCBNYXRoLm1pbih3aWR0aFZhbHVlIC0gMSwgbmV3WCkpKTsNCiAgICAgICAgICAgICAgICAgICAgbmV3WSA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgTWF0aC5taW4oaGVpZ2h0VmFsdWUgLSAxLCBuZXdZKSkpOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RpbmF0aW9uSW5kZXggPSAobmV3WSAqIHdpZHRoVmFsdWUgKyBuZXdYKSAqIDQ7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgY29ycnVwdGVkIHBpeGVsIGNvbG9yDQogICAgICAgICAgICAgICAgICAgIG5ld1BpeGVsc0J1ZmZlcltkZXN0aW5hdGlvbkluZGV4XSA9IHJfcXVhbnQ7DQogICAgICAgICAgICAgICAgICAgIG5ld1BpeGVsc0J1ZmZlcltkZXN0aW5hdGlvbkluZGV4ICsgMV0gPSBnX3F1YW50Ow0KICAgICAgICAgICAgICAgICAgICBuZXdQaXhlbHNCdWZmZXJbZGVzdGluYXRpb25JbmRleCArIDJdID0gYl9xdWFudDsNCiAgICAgICAgICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2Rlc3RpbmF0aW9uSW5kZXggKyAzXSA9IGFfY2hhbm5lbDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IHRlbXBDb250ZXh0Rm9yQ3JlYXRpb24gPSBjYW52YXNDb250ZXh0IHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICBjb25zdCBuZXdGcmFtZURhdGEgPSB0ZW1wQ29udGV4dEZvckNyZWF0aW9uLmNyZWF0ZUltYWdlRGF0YSh3aWR0aFZhbHVlLCBoZWlnaHRWYWx1ZSk7DQogICAgICAgICAgICBuZXdGcmFtZURhdGEuZGF0YS5zZXQobmV3UGl4ZWxzQnVmZmVyKTsNCiAgICAgICAgICAgIHJldHVybiBuZXdGcmFtZURhdGE7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdGhlIGFuaW1hdGlvbiBjeWNsZSBieSBwcmUtY2FsY3VsYXRpbmcgZnJhbWVzLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaW5pdGlhdGVDeWNsZSgpIHsNCiAgICAgICAgICAgIHN0YXR1c0Rpc3BsYXkudGV4dENvbnRlbnQgPSAnUl9fUFJFLUNBTENVTEFUSU5HX0lOVkVSU0VfRlJBTUVTLi4uJzsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpZWxkQ29udGFpbmVyJykuaW5uZXJIVE1MPScgPGNhbnZhcyB3aWR0aD0zNjAgaGVpZ2h0PTY0MCBpZD0icmVuZGVyU3VyZmFjZSI+PC9jYW52YXM+JzsNCg0KICAgICAgICAgICAgcmVuZGVyQ2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbmRlclN1cmZhY2UnKTsNCiAgICAgICAgICAgIGNhbnZhc0NvbnRleHQgPSByZW5kZXJDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gU3dhcCByb2xlczogQiAoY3VycmVudCBzb3VyY2UpIGRldG9uYXRlcywgQSAobmV3IHNvdXJjZSkgaXMgdGhlIHJldmVyc2FsIHRhcmdldC4NCiAgICAgICAgICAgIGNvbnN0IGltYWdlU291cmNlMCA9IGVsZW1lbnRTb3VyY2VCOyANCiAgICAgICAgICAgIGNvbnN0IGltYWdlU291cmNlMSA9IGVsZW1lbnRTb3VyY2VBOyANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmVuZGVyQ2FudmFzLndpZHRoID0gaW1hZ2VTb3VyY2UwLm5hdHVyYWxXaWR0aCB8fCBJTUFHRV9ESU1FTlNJT05fWDsNCiAgICAgICAgICAgIHJlbmRlckNhbnZhcy5oZWlnaHQgPSBpbWFnZVNvdXJjZTAubmF0dXJhbEhlaWdodCB8fCBJTUFHRV9ESU1FTlNJT05fWTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgY29uc3QgY2VudGVyT2Zmc2V0WCA9IHJlbmRlckNhbnZhcy53aWR0aCAqIDAuNTsgDQogICAgICAgICAgICBjb25zdCBjZW50ZXJPZmZzZXRZID0gcmVuZGVyQ2FudmFzLmhlaWdodCAqIDAuNTsNCiAgICAgICAgICAgIGNvbnN0IHJhbmRvbU9mZnNldFggPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiByZW5kZXJDYW52YXMud2lkdGggKiAwLjQ7IA0KICAgICAgICAgICAgY29uc3QgcmFuZG9tT2Zmc2V0WSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHJlbmRlckNhbnZhcy5oZWlnaHQgKiAwLjQ7IA0KDQogICAgICAgICAgICBjb3JlQ2VudGVyQ29vcmRYID0gTWF0aC5yb3VuZChjZW50ZXJPZmZzZXRYICsgcmFuZG9tT2Zmc2V0WCk7DQogICAgICAgICAgICBjb3JlQ2VudGVyQ29vcmRZID0gTWF0aC5yb3VuZChjZW50ZXJPZmZzZXRZICsgcmFuZG9tT2Zmc2V0WSk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIGluaXRpYWxQaXhlbERhdGEgPSBleHRyYWN0UGl4ZWxEYXRhKGltYWdlU291cmNlMCk7IA0KICAgICAgICAgICAgdGFyZ2V0UGl4ZWxEYXRhID0gZXh0cmFjdFBpeGVsRGF0YShpbWFnZVNvdXJjZTEpOw0KDQogICAgICAgICAgICBjb25zdCBoYWxmU3RlcHMgPSBtYXhDeWNsZVN0ZXBzIC8gMjsNCg0KICAgICAgICAgICAgLy8gUGhhc2UgMTogREVUT05BVElPTiAoSW1hZ2UgMCAtPiBNYXggRGlzcGVyc2VkKQ0KICAgICAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBoYWxmU3RlcHM7IHN0ZXArKykgew0KICAgICAgICAgICAgICAgIC8vIFRSVUUgbWVhbnMgRGV0b25hdGlvbiAoT1VUV0FSRCkNCiAgICAgICAgICAgICAgICBjb25zdCBmcmFtZURhdGEgPSBjYWxjdWxhdGVEaXN0b3J0aW9uRnJhbWUoaW5pdGlhbFBpeGVsRGF0YSwgc3RlcCwgaGFsZlN0ZXBzLCB0cnVlKTsgDQogICAgICAgICAgICAgICAgcHJlY2FsY3VsYXRlZEZyYW1lcy5wdXNoKGZyYW1lRGF0YSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFBoYXNlIDI6IFJFVkVSU0FMIChNYXggSW1wbG9zaW9uIC0+IEltYWdlIDEpDQogICAgICAgICAgICBjb25zdCBpbWFnZTFSZXZlcnNhbFN0YXRlcyA9IFtdOw0KICAgICAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBoYWxmU3RlcHM7IHN0ZXArKykgew0KICAgICAgICAgICAgICAgIC8vIEZBTFNFIG1lYW5zIFJldmVyc2FsIChJbXBsb3Npb24gSU5XQVJEKQ0KICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lRGF0YSA9IGNhbGN1bGF0ZURpc3RvcnRpb25GcmFtZSh0YXJnZXRQaXhlbERhdGEsIHN0ZXAsIGhhbGZTdGVwcywgZmFsc2UpOyANCiAgICAgICAgICAgICAgICBpbWFnZTFSZXZlcnNhbFN0YXRlcy5wdXNoKGZyYW1lRGF0YSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEFkZCB0aGUgcmV2ZXJzZSBzZXF1ZW5jZTogSW1wbG9zaW9uIHNuYXBzIGJhY2sgdG8gSW1hZ2UgMQ0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IGltYWdlMVJldmVyc2FsU3RhdGVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7DQogICAgICAgICAgICAgICAgcHJlY2FsY3VsYXRlZEZyYW1lcy5wdXNoKGltYWdlMVJldmVyc2FsU3RhdGVzW2ldKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgc2V0VGltZW91dChydW5BbmltYXRpb24sIDEwMCk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogRXhlY3V0ZXMgdGhlIEZsdWlkIFJlc2V0IHByb3RvY29sLCBzd2FwcGluZyB0aGUgY29ycnVwdGVkIHJlc3VsdCBiYWNrIGFzIGEgbmV3IHNvdXJjZS4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGZsdWlkUmVzZXRQcm90b2NvbCgpew0KICAgICAgICAgICAgc3RhdHVzRGlzcGxheS50ZXh0Q29udGVudCA9ICdSX19GTFVJRF9SRVNFVF9QUk9UT0NPTDogQ29tbWVuY2luZyBDb3JydXB0ZWQgU3dhcC4uLic7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIDEuIEdldCB0aGUgbGFzdCwgKmNvcnJ1cHRlZCogcmVjb25zdGl0dXRlZCBmcmFtZS4NCiAgICAgICAgICAgIGNvbnN0IGZpbmFsRnJhbWUgPSBwcmVjYWxjdWxhdGVkRnJhbWVzW21heEN5Y2xlU3RlcHMgLSAxXTsgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIDIuIENvbnZlcnQgdG8gYSBEYXRhIFVSTC4NCiAgICAgICAgICAgIGNvbnN0IHRlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgICAgIHRlbXBDYW52YXMud2lkdGggPSByZW5kZXJDYW52YXMud2lkdGg7DQogICAgICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IHJlbmRlckNhbnZhcy5oZWlnaHQ7DQogICAgICAgICAgICBjb25zdCB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgdGVtcEN0eC5wdXRJbWFnZURhdGEoZmluYWxGcmFtZSwgMCwgMCk7IA0KICAgICAgICAgICAgY29uc3QgZGF0YVVSTCA9IHRlbXBDYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTsNCg0KICAgICAgICAgICAgLy8gMy4gU3dhcCByb2xlczogVGhlIGNvcnJ1cHRlZCByZXN1bHQgYmVjb21lcyB0aGUgTkVXIHNvdXJjZSBmb3IgdGhlIG5leHQgRGV0b25hdGlvbiAoZWxlbWVudFNvdXJjZUIpLg0KICAgICAgICAgICAgZWxlbWVudFNvdXJjZUIuc3JjID0gZGF0YVVSTDsgDQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIDQuIExvYWQgYSBORVcgcmFuZG9tIGltYWdlIGZvciB0aGUgbmV4dCB0YXJnZXQgUmV2ZXJzYWwgKGVsZW1lbnRTb3VyY2VBKS4NCiAgICAgICAgICAgIGNvbnN0IG5ld1JhbmRvbVNlZWRBID0gTWF0aC5yb3VuZCgxMDAwMCAqIE1hdGgucmFuZG9tKCkpOw0KICAgICAgICAgICAgZWxlbWVudFNvdXJjZUEuc3JjID0gJ2h0dHA6Ly8xMjcuMC4wLjEvZ2V0UmFuZEltYWdlLnBocD9yYW5kb209JyArIG5ld1JhbmRvbVNlZWRBOw0KDQogICAgICAgICAgICAvLyBSZXNldCBzdGF0ZS4gVGhlIGltYWdlTG9hZEhhbmRsZXI0IHdpbGwgY2FsbCBpbml0aWF0ZUN5Y2xlKCkgYWdhaW4uDQogICAgICAgICAgICBjdXJyZW50Q3ljbGVTdGVwID0gMDsNCiAgICAgICAgICAgIHByZWNhbGN1bGF0ZWRGcmFtZXMgPSBbXTsgDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgbWFpbiBhbmltYXRpb24gbG9vcC4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIHJ1bkFuaW1hdGlvbigpIHsNCiAgICAgICAgICAgIGlmIChjdXJyZW50Q3ljbGVTdGVwIDwgbWF4Q3ljbGVTdGVwcyAmJiBwcmVjYWxjdWxhdGVkRnJhbWVzW2N1cnJlbnRDeWNsZVN0ZXBdKSB7DQogICAgICAgICAgICAgICAgY2FudmFzQ29udGV4dC5wdXRJbWFnZURhdGEocHJlY2FsY3VsYXRlZEZyYW1lc1tjdXJyZW50Q3ljbGVTdGVwXSwgMCwgMCk7IA0KICAgICAgICAgICAgICAgIGN1cnJlbnRDeWNsZVN0ZXArKzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBWaXN1YWwgRmxpY2tlciBTYWJvdGFnZQ0KICAgICAgICAgICAgICAgIHJlbmRlckNhbnZhcy5zdHlsZS5vcGFjaXR5ID0gKE1hdGgucmFuZG9tKCkgPiAwLjkpID8gMC45NSA6IDEuMDsgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgc2V0VGltZW91dChydW5BbmltYXRpb24sIGFuaW1hdGlvblNwZWVkTXMpOyANCiAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VycmVudEN5Y2xlU3RlcCA9PT0gbWF4Q3ljbGVTdGVwcykgew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZmx1aWRSZXNldFByb3RvY29sLCAyMDAwKTsgDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIC0tLSBJbWFnZSBMb2FkaW5nIFNldHVwIC0tLQ0KICAgICAgICBsZXQgbG9hZGVkSW1hZ2VDb3VudDQgPSAwOw0KICAgICAgICBjb25zdCB0b3RhbEltYWdlc1RvTG9hZDQgPSAyOw0KDQogICAgICAgIGNvbnN0IGltYWdlTG9hZEhhbmRsZXI0ID0gKCkgPT4gew0KICAgICAgICAgICAgbG9hZGVkSW1hZ2VDb3VudDQrKzsNCiAgICAgICAgICAgIGlmIChsb2FkZWRJbWFnZUNvdW50NCA9PT0gdG90YWxJbWFnZXNUb0xvYWQ0KSB7DQogICAgICAgICAgICAgICAgbG9hZGVkSW1hZ2VDb3VudDQgPSAwOyANCiAgICAgICAgICAgICAgICBpbml0aWF0ZUN5Y2xlKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgZWxlbWVudFNvdXJjZUEub25sb2FkID0gaW1hZ2VMb2FkSGFuZGxlcjQ7DQogICAgICAgIGVsZW1lbnRTb3VyY2VCLm9ubG9hZCA9IGltYWdlTG9hZEhhbmRsZXI0Ow0KDQogICAgICAgIGVsZW1lbnRTb3VyY2VBLm9uZXJyb3IgPSAoKSA9PiB7IHN0YXR1c0Rpc3BsYXkudGV4dENvbnRlbnQgPSAiRXJyb3IgbG9hZGluZyBJbWFnZSBBLiI7IH07DQogICAgICAgIGVsZW1lbnRTb3VyY2VCLm9uZXJyb3IgPSAoKSA9PiB7IHN0YXR1c0Rpc3BsYXkudGV4dENvbnRlbnQgPSAiRXJyb3IgbG9hZGluZyBJbWFnZSBCLiI7IH07DQoNCiAgICA8L3NjcmlwdD4=<br>DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDx0aXRsZT5QaXhlbCBGbG93IEFuaW1hdGlvbiBCeSBSaWRvdWFuIEJlbiBNYXNzb3VkPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIGJvZHl7ZGlzcGxheTpmbGV4O2p1c3RpZnktY29udGVudDpjZW50ZXI7YWxpZ24taXRlbXM6Y2VudGVyO21pbi1oZWlnaHQ6MTAwdmg7YmFja2dyb3VuZC1jb2xvcjojMTExO21hcmdpbjowO2ZsZXgtZGlyZWN0aW9uOmNvbHVtbjtvdmVyZmxvdzpoaWRkZW59DQogICAgICAgIGNhbnZhc3tib3JkZXI6MCBzb2xpZCAjMzMzOw0KfQ0KICAgICAgICAjY29udHJvbHN7bWFyZ2luLXRvcDoyMHB4O2NvbG9yOndoaXRlO2ZvbnQtZmFtaWx5OkFyaWFsLHNhbnMtc2VyaWY7Zm9udC1zaXplOjE0cHg7ZGlzcGxheTpub25lfQ0KICAgICAgICBpbnB1dFt0eXBlPSJmaWxlIl17bWFyZ2luLWxlZnQ6MTBweH0NCg0KICAgICAgICAvKiBEZSAnY2FudmFzJyBkaXYgKG51IGZ1bGwgc2NyZWVuKSAqLw0KICAgICAgICAjY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQoNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgIA0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAJIGhlaWdodDoxMDAlOw0KIAkgd2lkdGg6MTAwJTsNCg0KICAgICAgICAgICAgLyogRGUgY2FudmFzIHdvcmR0IGhpZXJiaW5uZW4gZ2VwbGFhdHN0IGVuIGdlc2NoYWFsZCBkb29yIENTUyAqLw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBTdHlsaW5nIHZvb3IgZGUgY2FudmFzIGRpZSBkb29yIGRlIEpTIGNvZGUgd29yZHQgYWFuZ2VtYWFrdCAqLw0KICAgICAgICAjYW5pbWF0aW9uQ2FudmFzT0cgew0KICAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERlICdjYW52YXMnIGRpdiAqLw0KICAgICAgICAjX18zY2FudmFzWFMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogU3R5bGluZyB2b29yIGRlIGNhbnZhcyBkaWUgZG9vciBkZSBKUyBjb2RlIHdvcmR0IGFhbmdlbWFha3QgKi8NCiAgICAgICAgI19fM2FuaW1hdGlvbkNhbnZhc09HIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBUaGUgJ2NhbnZhcycgZGl2IChUaGUgRGV0b25hdGlvbiBGaWVsZCkgKi8NCiAgICAgICAgI2ZpZWxkQ29udGFpbmVyIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyANCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47IA0KICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKiBUaGUgQ2FudmFzICovDQogICAgICAgICNyZW5kZXJTdXJmYWNlIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDsgDQoNCiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMC4wNXMgZWFzZS1vdXQ7IA0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAjcHJvdG9jb2wtc3RhdHVzIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogMjBweDsNCiAgICAgICAgICAgIGxlZnQ6IDUwJTsNCiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTsNCiAgICAgICAgICAgIHotaW5kZXg6IDEwOw0KICAgICAgICAgICAgZm9udC1zaXplOiAxLjVlbTsNCiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmU7DQogICAgICAgIH0NCg0KDQoNCiAgICAgICAgDQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KDQogICANCg0KDQoNCiAgPGltZyBpZD0iX18zaW1nQSIgYWx0PSJBZmJlZWxkaW5nIEEgKEJyb24pIiBjbGFzcz0iaGlkZGVuLWltZyIgc3R5bGU9J2Rpc3BsYXk6IG5vbmU7JyAvPg0KICAgIDxpbWcgaWQ9Il9fM2ltZ0IiIGFsdD0iQWZiZWVsZGluZyBCIChBbmFseXNlKSIgY2xhc3M9ImhpZGRlbi1pbWciIHN0eWxlPSdkaXNwbGF5OiBub25lOycgLz4NCg0KICAgIDxkaXYgaWQ9Il9fM2NhbnZhc1hTIiBzdHlsZT0nZGRpc3BsYXk6bm9uZSc+DQogICAgICAgIDwvZGl2Pg0KDQogICAgPHNjcmlwdD4NCiAgICAgICAgLy8gLS0tIEdsb2JhbGUgdmFyaWFiZWxlbiBnZWRlZmluaWVlcmQgdm9vciBnZWJydWlrIGluIGRlIGFuaW1hdGllIGNvZGUgLS0tDQogICAgICAgIGNvbnN0IF9fM0lNQUdFX1dJRFRIID0gMzAwOw0KICAgICAgICBjb25zdCBfXzNJTUFHRV9IRUlHSFQgPSAzMDA7DQoNCiAgICAgICAgLy8gTmlldXdlIENvbnN0YW50OiBNYXhpbWFsZSBzbmVsaGVpZHNmYWN0b3INCiAgICAgICAgY29uc3QgX18zTUFYX1NQRUVEX0ZBQ1RPUiA9IDUuMDsgDQogICAgICAgIC8vIE5pZXV3ZSBDb25zdGFudDogQ29uc3RhbnQgdm9vciBkZSBCbHVlIENoYW5uZWwgYmVyZWtlbmluZw0KICAgICAgICBjb25zdCBfXzNCTFVFX0NIQU5ORUxfQ09OU1RBTlQgPSAzLjA7IC8vIENob3NlbiB2YWx1ZSBmb3IgdGhlIGZvcm11bGE6IChSK0crQikvQ09OU1RBTlQNCg0KICAgICAgICAvLyBFZXJzdGUgd2lsbGVrZXVyaWdlIHNlZWRzDQogICAgICAgIGNvbnN0IF9fM3JhbmRvbVNlZWRBID0gTWF0aC5yb3VuZCgxMDAwMCAqIE1hdGgucmFuZG9tKCkpOw0KICAgICAgICBjb25zdCBfXzNyYW5kb21TZWVkQiA9IE1hdGgucm91bmQoMTAwMDAgKiBNYXRoLnJhbmRvbSgpKTsNCg0KICAgICAgICAvLyBHbG9iYWxlIFVSTCdzDQogICAgICAgIGNvbnN0IF9fM2FpbWcgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KICAgICAgICBjb25zdCBfXzNiaW1nID0gJ2h0dHA6Ly8xMjcuMC4wLjEvZ2V0UmFuZEltYWdlLnBocD9yYW5kb209JyArIF9fM3JhbmRvbVNlZWRCOw0KICAgICAgICBjb25zdCBfXzNzcGVlZCA9IDYwOyAvLyBTbmVsaGVpZCB2b29yIGRlIHNldFRpbWVvdXQgKG1zKQ0KDQogICAgICAgIC8vIERPTSBlbGVtZW50ZW4NCiAgICAgICAgY29uc3QgX18zaW1nQUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnX18zaW1nQScpOw0KICAgICAgICBjb25zdCBfXzNpbWdCRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdfXzNpbWdCJyk7DQogICAgICAgIA0KICAgICAgICAvLyBJbml0aWFsIHNldCB2YW4gZGUgaW1hZ2Ugc291cmNlcyBlbiBjcm9zc09yaWdpbg0KICAgICAgICBfXzNpbWdBRWxlbWVudC5zcmMgPSBfXzNhaW1nOw0KICAgICAgICBfXzNpbWdCRWxlbWVudC5zcmMgPSBfXzNiaW1nOw0KICAgICAgICBfXzNpbWdBRWxlbWVudC5jcm9zc09yaWdpbiA9ICdBbm9ueW1vdXMnOw0KICAgICAgICBfXzNpbWdCRWxlbWVudC5jcm9zc09yaWdpbiA9ICdBbm9ueW1vdXMnOw0KDQogICAgICAgIC8vIEdsb2JhbGUgdmFyaWFiZWxlbiB2b29yIGRlIGFuaW1hdGllIGxvZ2ljYQ0KICAgICAgICB2YXIgX18zY2FudmFzOw0KICAgICAgICB2YXIgX18zY3R4Ow0KICAgICAgICB2YXIgX18zaW1nMDsgDQogICAgICAgIHZhciBfXzNpbWcxOyANCg0KICAgICAgICAvLyBDZW50cmFhbCBwdW50IHZvb3IgZGUgYmV3ZWdpbmcNCiAgICAgICAgdmFyIF9fM2NlbnRlclg7DQogICAgICAgIHZhciBfXzNjZW50ZXJZOw0KDQogICAgICAgIHZhciBfXzN0b3RhbFN0ZXBzID0gNTA7DQogICAgICAgIHZhciBfXzNjdXJyZW50U3RlcCA9IDA7DQogICAgICAgIHZhciBfXzNhbmltYXRpb25GcmFtZXMgPSBbXTsgDQoNCiAgICAgICAgdmFyIF9fM2ltYWdlRGF0YTAsIF9fM2ltYWdlRGF0YTE7IA0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IEltYWdlRGF0YSBmcm9tIGFuIEhUTUxJbWFnZUVsZW1lbnQuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBfXzNnZXRQaXhlbERhdGEoX18zaW1hZ2UpIHsNCiAgICAgICAgICAgIGNvbnN0IF9fM3RlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgICAgIGNvbnN0IF9fM3RlbXBDdHggPSBfXzN0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgICAgICBfXzN0ZW1wQ2FudmFzLndpZHRoID0gX18zaW1hZ2Uud2lkdGg7DQogICAgICAgICAgICBfXzN0ZW1wQ2FudmFzLmhlaWdodCA9IF9fM2ltYWdlLmhlaWdodDsNCiAgICAgICAgICAgIF9fM3RlbXBDdHguZHJhd0ltYWdlKF9fM2ltYWdlLCAwLCAwLCBfXzN0ZW1wQ2FudmFzLndpZHRoLCBfXzN0ZW1wQ2FudmFzLmhlaWdodCk7DQogICAgICAgICAgICByZXR1cm4gX18zdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgX18zdGVtcENhbnZhcy53aWR0aCwgX18zdGVtcENhbnZhcy5oZWlnaHQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENhbGN1bGF0ZXMgYSBzaW5nbGUgZnJhbWUgYmFzZWQgb24gdGhlIG5ldyBjb2xvciBjaGFubmVsIGxvZ2ljLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gX18zY2FsY3VsYXRlQ29tcHJlc3NlZEZyYW1lKF9fM29yaWdpbmFsSW1hZ2VEYXRhLCBfXzNzdGVwLCBfXzN0b3RhbFBoYXNlU3RlcHMpIHsNCiAgICAgICAgICAgIGNvbnN0IF9fM3dpZHRoID0gX18zb3JpZ2luYWxJbWFnZURhdGEud2lkdGg7DQogICAgICAgICAgICBjb25zdCBfXzNoZWlnaHQgPSBfXzNvcmlnaW5hbEltYWdlRGF0YS5oZWlnaHQ7DQogICAgICAgICAgICBjb25zdCBfXzNvcmlnaW5hbFBpeGVscyA9IF9fM29yaWdpbmFsSW1hZ2VEYXRhLmRhdGE7DQogICAgICAgICAgICBjb25zdCBfXzNuZXdQaXhlbHNCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoX18zd2lkdGggKiBfXzNoZWlnaHQgKiA0KTsNCg0KICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBidWZmZXIgd2l0aCB0cmFuc3BhcmVudCBwaXhlbHMNCiAgICAgICAgICAgIGZvciAobGV0IF9fM2kgPSAwOyBfXzNpIDwgX18zbmV3UGl4ZWxzQnVmZmVyLmxlbmd0aDsgX18zaSArPSA0KSB7DQogICAgICAgICAgICAgICAgX18zbmV3UGl4ZWxzQnVmZmVyW19fM2kgKyAzXSA9IDA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIFRoZSAnY29tcHJlc3Npb24gZGlzdGFuY2UnIGZvciB0aGUgY3VycmVudCBzdGVwDQogICAgICAgICAgICBjb25zdCBfXzNjb21wcmVzc2lvblByb2dyZXNzID0gTWF0aC5taW4oMSwgX18zc3RlcCAvIChfXzN0b3RhbFBoYXNlU3RlcHMgLSAxKSk7DQogICAgICAgICAgICAvLyBNYXggZGlzdGFuY2UgKGUuZy4sIGhhbGYgdGhlIHdpZHRoL2hlaWdodCkgc2NhbGVkIGJ5IHRoZSBwcm9ncmVzcy4NCiAgICAgICAgICAgIC8vIFRoaXMgbm93IHJlcHJlc2VudHMgdGhlIE1BWCBwaXhlbCBkaXNwbGFjZW1lbnQgZm9yIHRoZSBjdXJyZW50IGZyYW1lLg0KICAgICAgICAgICAgY29uc3QgX18zbWF4RGlzcGxhY2VtZW50ID0gX18zd2lkdGggLyAyLjAgKiBfXzNjb21wcmVzc2lvblByb2dyZXNzOw0KDQoNCiAgICAgICAgICAgIGZvciAobGV0IF9fM3kgPSAwOyBfXzN5IDwgX18zaGVpZ2h0OyBfXzN5KyspIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCBfXzN4ID0gMDsgX18zeCA8IF9fM3dpZHRoOyBfXzN4KyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgX18zaSA9IChfXzN5ICogX18zd2lkdGggKyBfXzN4KSAqIDQ7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IF9fM3IgPSBfXzNvcmlnaW5hbFBpeGVsc1tfXzNpXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgX18zZyA9IF9fM29yaWdpbmFsUGl4ZWxzW19fM2kgKyAxXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgX18zYiA9IF9fM29yaWdpbmFsUGl4ZWxzW19fM2kgKyAyXTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgX18zYSA9IF9fM29yaWdpbmFsUGl4ZWxzW19fM2kgKyAzXTsNCg0KICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMS4gQ2FsY3VsYXRlIFRhcmdldCBQb3NpdGlvbnMgJiBEaXNwbGFjZW1lbnQgVmVjdG9ycyAtLS0NCg0KICAgICAgICAgICAgICAgICAgICAvLyBSZWQgQ2hhbm5lbCAoWS1heGlzIG1vdmVtZW50KQ0KICAgICAgICAgICAgICAgICAgICBsZXQgX18zdGFyZ2V0WTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKF9fM3IgPiAxMjcpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgdG93YXJkcyB5LWF4aXMgPSBoZWlnaHQgKGJvdHRvbSkNCiAgICAgICAgICAgICAgICAgICAgICAgIF9fM3RhcmdldFkgPSBfXzNoZWlnaHQgLSAxOyANCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1vdmUgdG93YXJkcyB5LWF4aXMgPSAwICh0b3ApDQogICAgICAgICAgICAgICAgICAgICAgICBfXzN0YXJnZXRZID0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGRpc3RhbmNlIHRvIGNvdmVyIGluIHRoZSBZIGRpcmVjdGlvbiAoc2NhbGVkIGJ5IHRoZSBtYXggZGlzcGxhY2VtZW50KQ0KICAgICAgICAgICAgICAgICAgICAvLyBUaGUgJ3NwZWVkJyBpcyByZWxhdGl2ZSB0byBob3cgZmFyIHRoZSBwaXhlbCBpcyBmcm9tIHRoZSB0YXJnZXQsIGNsYW1wZWQgYnkgX18zbWF4RGlzcGxhY2VtZW50Lg0KICAgICAgICAgICAgICAgICAgICBjb25zdCBfXzNkeVRvdGFsID0gX18zdGFyZ2V0WSAtIF9fM3k7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IF9fM21vdmVZID0gX18zZHlUb3RhbCAqIF9fM2NvbXByZXNzaW9uUHJvZ3Jlc3MgKiAoX18zTUFYX1NQRUVEX0ZBQ1RPUiAvIF9fM3RvdGFsUGhhc2VTdGVwcyk7DQogICAgICAgICAgICAgICAgICAgIC8vIENsYW1waW5nIHRoZSBtb3ZlbWVudCB0byBhIG1heCBkaXNwbGFjZW1lbnQgcGVyIHN0ZXAgaXMgY2hhbGxlbmdpbmcgd2l0aCB0aGlzIGxvZ2ljLA0KICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSB1c2UgYSBfXzNNQVhfU1BFRURfRkFDVE9SIG9uIHRoZSBwcm9wb3J0aW9uYWwgc3RlcCBkaXN0YW5jZS4NCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIG1heGltdW0gZGlzdGFuY2UgYSBwaXhlbCBjYW4gbW92ZSBpbiBvbmUgc3RlcCBpcyByb3VnaGx5OiANCiAgICAgICAgICAgICAgICAgICAgLy8gX18zTUFYX1NQRUVEX0ZBQ1RPUiAqIChXaWR0aC9QaGFzZVN0ZXBzKSAqIFByb2dyZXNzLCB3aGljaCBhcHByb3hpbWF0ZXMgdGhlIG1heCBzcGVlZCBvZiA1Lg0KDQogICAgICAgICAgICAgICAgICAgIC8vIEdyZWVuIENoYW5uZWwgKFgtYXhpcyBtb3ZlbWVudCkNCiAgICAgICAgICAgICAgICAgICAgbGV0IF9fM3RhcmdldFg7DQogICAgICAgICAgICAgICAgICAgIGlmIChfXzNnID4gMTI3KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBNb3ZlIHRvd2FyZHMgbWF4IFggKHJpZ2h0IGVkZ2UpDQogICAgICAgICAgICAgICAgICAgICAgICBfXzN0YXJnZXRYID0gX18zd2lkdGggLSAxOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTW92ZSB0b3dhcmRzIG1pbiBYIChsZWZ0IGVkZ2UpDQogICAgICAgICAgICAgICAgICAgICAgICBfXzN0YXJnZXRYID0gMDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGRpc3RhbmNlIHRvIGNvdmVyIGluIHRoZSBYIGRpcmVjdGlvbiAoc2NhbGVkIGJ5IHRoZSBtYXggZGlzcGxhY2VtZW50KQ0KICAgICAgICAgICAgICAgICAgICBjb25zdCBfXzNkeFRvdGFsID0gX18zdGFyZ2V0WCAtIF9fM3g7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IF9fM21vdmVYID0gX18zZHhUb3RhbCAqIF9fM2NvbXByZXNzaW9uUHJvZ3Jlc3MgKiAoX18zTUFYX1NQRUVEX0ZBQ1RPUiAvIF9fM3RvdGFsUGhhc2VTdGVwcyk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDIuIENhbGN1bGF0ZSBOZXcgUG9zaXRpb24gLS0tDQogICAgICAgICAgICAgICAgICAgIGxldCBfXzNuZXdYID0gX18zeCArIF9fM21vdmVYOw0KICAgICAgICAgICAgICAgICAgICBsZXQgX18zbmV3WSA9IF9fM3kgKyBfXzNtb3ZlWTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIENsYW1waW5nIGFuZCByb3VuZGluZw0KICAgICAgICAgICAgICAgICAgICBfXzNuZXdYID0gTWF0aC5yb3VuZChNYXRoLm1heCgwLCBNYXRoLm1pbihfXzN3aWR0aCAtIDEsIF9fM25ld1gpKSk7DQogICAgICAgICAgICAgICAgICAgIF9fM25ld1kgPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIE1hdGgubWluKF9fM2hlaWdodCAtIDEsIF9fM25ld1kpKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDMuIENhbGN1bGF0ZSBOZXcgQmx1ZSBDaGFubmVsIENvbG9yIC0tLQ0KICAgICAgICAgICAgICAgICAgICBjb25zdCBfXzNuZXdCID0gTWF0aC5taW4oMjU1LCBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKChfXzNyICsgX18zZyArIF9fM2IpIC8gX18zQkxVRV9DSEFOTkVMX0NPTlNUQU5UKSkpOw0KDQogICAgICAgICAgICAgICAgICAgIC8vIC0tLSA0LiBQbGFjZSBQaXhlbCBpbiBOZXcgTG9jYXRpb24gLS0tDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IF9fM2Rlc3RJbmRleCA9IChfXzNuZXdZICogX18zd2lkdGggKyBfXzNuZXdYKSAqIDQ7DQoNCiAgICAgICAgICAgICAgICAgICAgLy8gQ29weSBwaXhlbCBjb2xvciB0byB0aGUgbmV3IHBvc2l0aW9uICh1c2luZyB0aGUgbmV3IGJsdWUgdmFsdWUpDQogICAgICAgICAgICAgICAgICAgIF9fM25ld1BpeGVsc0J1ZmZlcltfXzNkZXN0SW5kZXhdID0gX18zcjsNCiAgICAgICAgICAgICAgICAgICAgX18zbmV3UGl4ZWxzQnVmZmVyW19fM2Rlc3RJbmRleCArIDFdID0gX18zZzsNCiAgICAgICAgICAgICAgICAgICAgX18zbmV3UGl4ZWxzQnVmZmVyW19fM2Rlc3RJbmRleCArIDJdID0gX18zbmV3QjsgLy8gVXNlIHRoZSBuZXcgYmx1ZSBjaGFubmVsIHZhbHVlDQogICAgICAgICAgICAgICAgICAgIF9fM25ld1BpeGVsc0J1ZmZlcltfXzNkZXN0SW5kZXggKyAzXSA9IF9fM2E7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBjb25zdCBfXzN0ZW1wQ3R4Rm9yQ3JlYXRpb24gPSBfXzNjdHggfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJykuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIGNvbnN0IF9fM25ld0ltYWdlRGF0YSA9IF9fM3RlbXBDdHhGb3JDcmVhdGlvbi5jcmVhdGVJbWFnZURhdGEoX18zd2lkdGgsIF9fM2hlaWdodCk7DQogICAgICAgICAgICBfXzNuZXdJbWFnZURhdGEuZGF0YS5zZXQoX18zbmV3UGl4ZWxzQnVmZmVyKTsNCiAgICAgICAgICAgIHJldHVybiBfXzNuZXdJbWFnZURhdGE7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdGhlIGFuaW1hdGlvbjogbG9hZHMgaW1hZ2VzLCBzZXRzIHVwIGNhbnZhcywgYW5kIHByZS1yZWNvcmRzIGFsbCBmcmFtZXMuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBfXzNpbml0QW5pbWF0aW9uKCkgew0KDQogICAgICAgICAgICAvLyBWZXJ2YW5nIGRlIGNvbnRlbnQgdmFuIGRlIGNhbnZhcyBkaXYgZG9vciBkZSBkYWFkd2Vya2VsaWprZSBjYW52YXMNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdfXzNjYW52YXNYUycpLmlubmVySFRNTCA9ICcgPGNhbnZhcyB3aWR0aD0zNjAgaGVpZ2h0PTY0MCBpZD0iX18zYW5pbWF0aW9uQ2FudmFzT0ciIHN0eWxlPSJ3aWR0aDoxMDAlO2hlaWdodDoxMDAlIj48L2NhbnZhcz4nOw0KDQogICAgICAgICAgICBfXzNjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnX18zYW5pbWF0aW9uQ2FudmFzT0cnKTsNCiAgICAgICAgICAgIF9fM2N0eCA9IF9fM2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KDQogICAgICAgICAgICBfXzNpbWcwID0gX18zaW1nQkVsZW1lbnQ7IC8vIEltYWdlIDAgKGNvbXByaW1lZXJ0IGVlcnN0KQ0KICAgICAgICAgICAgX18zaW1nMSA9IF9fM2ltZ0FFbGVtZW50OyAvLyBJbWFnZSAxIChkZWNvbXByZXNzZWVydCkNCg0KICAgICAgICAgICAgX18zdG90YWxTdGVwcyA9IDUwOw0KICAgICAgICAgICAgX18zY3VycmVudFN0ZXAgPSAwOw0KICAgICAgICAgICAgX18zYW5pbWF0aW9uRnJhbWVzID0gW107DQoNCiAgICAgICAgICAgIC8vIFNldCBjYW52YXMgcGl4ZWwgZGltZW5zaWVzIGdlYmFzZWVyZCBvcCBkZSBnZWxhZGVuIGFmYmVlbGRpbmdlbiAoYmlqdi4gMzAweDMwMCkNCiAgICAgICAgICAgIF9fM2NhbnZhcy53aWR0aCA9IF9fM2ltZzAubmF0dXJhbFdpZHRoIHx8IF9fM0lNQUdFX1dJRFRIOw0KICAgICAgICAgICAgX18zY2FudmFzLmhlaWdodCA9IF9fM2ltZzAubmF0dXJhbEhlaWdodCB8fCBfXzNJTUFHRV9IRUlHSFQ7DQoNCiAgICAgICAgICAgIC8vIEJlcGFhbCBoZXQgY2VudHJhbGUgcHVudCB2b29yIGRlIGFuaW1hdGllY3ljbHVzIChnZWJydWlrdCB2b29yIFgtYXMgdGFyZ2V0aW5nIGluIGRpdCBzY3JpcHQpDQogICAgICAgICAgICBjb25zdCBfXzNjZW50ZXJPZmZzZXRYID0gX18zY2FudmFzLndpZHRoICogMC41Ow0KICAgICAgICAgICAgY29uc3QgX18zY2VudGVyT2Zmc2V0WSA9IF9fM2NhbnZhcy5oZWlnaHQgKiAwLjU7DQogICAgICAgICAgICBjb25zdCBfXzNyYW5kb21PZmZzZXRYID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogX18zY2FudmFzLndpZHRoICogMC40Ow0KICAgICAgICAgICAgY29uc3QgX18zcmFuZG9tT2Zmc2V0WSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIF9fM2NhbnZhcy5oZWlnaHQgKiAwLjQ7DQoNCiAgICAgICAgICAgIF9fM2NlbnRlclggPSBNYXRoLnJvdW5kKF9fM2NlbnRlck9mZnNldFggKyBfXzNyYW5kb21PZmZzZXRYKTsNCiAgICAgICAgICAgIF9fM2NlbnRlclkgPSBNYXRoLnJvdW5kKF9fM2NlbnRlck9mZnNldFkgKyBfXzNyYW5kb21PZmZzZXRZKTsNCg0KICAgICAgICAgICAgY29uc29sZS5sb2coYE5pZXV3IGNlbnRyYWFsIHB1bnQ6ICgke19fM2NlbnRlclh9LCAke19fM2NlbnRlcll9KWApOw0KDQogICAgICAgICAgICAvLyBHZXQgaW5pdGlhbCBJbWFnZURhdGEgZm9yIGJvdGggc291cmNlIGltYWdlcw0KICAgICAgICAgICAgX18zaW1hZ2VEYXRhMCA9IF9fM2dldFBpeGVsRGF0YShfXzNpbWcwKTsgLy8gRGF0YSB2b29yIGNvbXByZXNzaWUgKFIxKQ0KICAgICAgICAgICAgX18zaW1hZ2VEYXRhMSA9IF9fM2dldFBpeGVsRGF0YShfXzNpbWcxKTsgLy8gRGF0YSB2b29yIGRlY29tcHJlc3NpZSAoUjIpDQoNCiAgICAgICAgICAgIGNvbnN0IF9fM2hhbGZTdGVwcyA9IF9fM3RvdGFsU3RlcHMgLyAyOyAvLyBFbGtlIGZhc2UgaXMgMjUgc3RhcHBlbg0KDQogICAgICAgICAgICAvLyBGYXNlIDE6IENvbXByZXNzaWUgKFIxIC0+IE1heCBDb21wcmVzc2VkKQ0KICAgICAgICAgICAgZm9yIChsZXQgX18zc3RlcCA9IDA7IF9fM3N0ZXAgPCBfXzNoYWxmU3RlcHM7IF9fM3N0ZXArKykgew0KICAgICAgICAgICAgICAgIGNvbnN0IF9fM2ZyYW1lRGF0YSA9IF9fM2NhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShfXzNpbWFnZURhdGEwLCBfXzNzdGVwLCBfXzNoYWxmU3RlcHMpOw0KICAgICAgICAgICAgICAgIF9fM2FuaW1hdGlvbkZyYW1lcy5wdXNoKF9fM2ZyYW1lRGF0YSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEZhc2UgMjogRGVjb21wcmVzc2llIChNYXggQ29tcHJlc3NlZCBSMiAtPiBSMiBPcmlnaW5hbCkNCiAgICAgICAgICAgIGNvbnN0IF9fM2ltYWdlMUNvbXByZXNzZWRTdGF0ZXMgPSBbXTsNCiAgICAgICAgICAgIGZvciAobGV0IF9fM3N0ZXAgPSAwOyBfXzNzdGVwIDwgX18zaGFsZlN0ZXBzOyBfXzNzdGVwKyspIHsNCiAgICAgICAgICAgICAgICAvLyBCZXJla2VuIGRlIHN0YXBwZW4gdmFuIFIyIGdlY29tcHJpbWVlcmQgKHZhbiAwIG5hYXIgbWF4KQ0KICAgICAgICAgICAgICAgIGNvbnN0IF9fM2ZyYW1lRGF0YSA9IF9fM2NhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShfXzNpbWFnZURhdGExLCBfXzNzdGVwLCBfXzNoYWxmU3RlcHMpOw0KICAgICAgICAgICAgICAgIF9fM2ltYWdlMUNvbXByZXNzZWRTdGF0ZXMucHVzaChfXzNmcmFtZURhdGEpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBWb2VnIGRlIG9tZ2VrZWVyZGUgc2VxdWVudGllIHZhbiBkZSBnZWNvbXByaW1lZXJkZSBSMi1zdGF0ZW4gdG9lLg0KICAgICAgICAgICAgZm9yIChsZXQgX18zaSA9IF9fM2ltYWdlMUNvbXByZXNzZWRTdGF0ZXMubGVuZ3RoIC0gMTsgX18zaSA+PSAwOyBfXzNpLS0pIHsNCiAgICAgICAgICAgICAgICBfXzNhbmltYXRpb25GcmFtZXMucHVzaChfXzNpbWFnZTFDb21wcmVzc2VkU3RhdGVzW19fM2ldKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gU3RhcnQgZGUgYW5pbWF0aWVsdXMNCiAgICAgICAgICAgIHNldFRpbWVvdXQoJ19fM2FuaW1hdGUoKScsIChfXzNzcGVlZCAvIDMpKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIF9fM2tsb3B0ZW4oKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiQW5pbWF0aW9uIGZpbmlzaGVkLiBQcmVwYXJpbmcgZmx1aWQgdHJhbnNpdGlvbiBmb3IgbmV4dCBjeWNsZS4iKTsNCg0KICAgICAgICAgICAgLy8gLS0tIFZMT0VJRU5ERSBSRVNFVCBMT0dJQ0EgLS0tDQoNCiAgICAgICAgICAgIC8vIDEuIEhhYWwgZGUgbGFhdHN0ZSwgdm9sbGVkaWcgZ2VkZWNvbXByaW1lZXJkZSBmcmFtZSBvcCAoc3RhcCA0OSB2YW4gZmFzZSAyKS4NCiAgICAgICAgICAgIGNvbnN0IF9fM2ZpbmFsRnJhbWUgPSBfXzNhbmltYXRpb25GcmFtZXNbX18zdG90YWxTdGVwcyAtIDFdOw0KDQogICAgICAgICAgICAvLyAyLiBDb252ZXJ0ZWVyIGRlIGxhYXRzdGUgZnJhbWUgKEltYWdlRGF0YSkgbmFhciBlZW4gRGF0YSBVUkwuDQogICAgICAgICAgICBjb25zdCBfXzN0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgICAgICBfXzN0ZW1wQ2FudmFzLndpZHRoID0gX18zY2FudmFzLndpZHRoOw0KICAgICAgICAgICAgX18zdGVtcENhbnZhcy5oZWlnaHQgPSBfXzNjYW52YXMuaGVpZ2h0Ow0KICAgICAgICAgICAgY29uc3QgX18zdGVtcEN0eCA9IF9fM3RlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgICAgIF9fM3RlbXBDdHgucHV0SW1hZ2VEYXRhKF9fM2ZpbmFsRnJhbWUsIDAsIDApOw0KICAgICAgICAgICAgY29uc3QgX18zZGF0YVVSTCA9IF9fM3RlbXBDYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTsNCg0KICAgICAgICAgICAgLy8gMy4gU3dhcCByb2xsZW46DQogICAgICAgICAgICAvLyBhKSBIZXQgZGVjb21wcmVzc2VlcmRlIHJlc3VsdGFhdCB2YW4gZGUgdm9yaWdlIGN5Y2x1cyAoUjIpIHdvcmR0IGRlIE5JRVVXRQ0KICAgICAgICAgICAgLy8gICAgYWZiZWVsZGluZyB2b29yIGRlIGNvbXByZXNzaWVmYXNlIChfXzNpbWcwID0gX18zaW1nQkVsZW1lbnQpLg0KICAgICAgICAgICAgX18zaW1nQkVsZW1lbnQuc3JjID0gX18zZGF0YVVSTDsNCg0KICAgICAgICAgICAgLy8gYikgTGFhZCBlZW4gTklFVVdFIHdpbGxla2V1cmlnZSBhZmJlZWxkaW5nIChSMykgdm9vciBkZSBkZWNvbXByZXNzZWVyZmFzZQ0KICAgICAgICAgICAgLy8gICAgKF9fM2ltZzEgPSBfXzNpbWdBRWxlbWVudCkuDQogICAgICAgICAgICBjb25zdCBfXzNuZXdSYW5kb21TZWVkQSA9IE1hdGgucm91bmQoMTAwMDAgKiBNYXRoLnJhbmRvbSgpKTsNCiAgICAgICAgICAgIF9fM2ltZ0FFbGVtZW50LnNyYyA9ICdodHRwOi8vMTI3LjAuMC4xL2dldFJhbmRJbWFnZS5waHA/cmFuZG9tPScgKyBfXzNuZXdSYW5kb21TZWVkQTsNCg0KICAgICAgICAgICAgLy8gUmVzZXQgc3RhcHBlbiBlbiBmcmFtZXMuIERlIGltYWdlTG9hZEhhbmRsZXIgemFsIF9fM2luaXRBbmltYXRpb24oKSBzdGFydGVuDQogICAgICAgICAgICBfXzNjdXJyZW50U3RlcCA9IDA7DQogICAgICAgICAgICBfXzNhbmltYXRpb25GcmFtZXMgPSBbXTsNCiAgICAgICAgfQ0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AuIERyYXdzIHRoZSBwcmUtcmVjb3JkZWQgZnJhbWUgYW5kIGhhbmRsZXMgdGhlIGZsdWlkIHJlc2V0Lg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gX18zYW5pbWF0ZSgpIHsNCiAgICAgICAgICAgIGlmIChfXzNjdXJyZW50U3RlcCA8IF9fM3RvdGFsU3RlcHMgJiYgX18zYW5pbWF0aW9uRnJhbWVzW19fM2N1cnJlbnRTdGVwXSkgew0KICAgICAgICAgICAgICAgIF9fM2N0eC5wdXRJbWFnZURhdGEoX18zYW5pbWF0aW9uRnJhbWVzW19fM2N1cnJlbnRTdGVwXSwgMCwgMCk7DQogICAgICAgICAgICAgICAgX18zY3VycmVudFN0ZXArKzsNCg0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoJ19fM2FuaW1hdGUoKScsIChfXzNzcGVlZCAvIDMpKTsNCiAgICAgICAgICAgIH0gZWxzZSBpZiAoX18zY3VycmVudFN0ZXAgPT09IF9fM3RvdGFsU3RlcHMpIHsNCiAgICAgICAgICAgICAgICAvLyBEZWxheSBmb3IgYSBtb21lbnQgYXQgdGhlIGVuZCBvZiB0aGUgdHJhbnNpdGlvbiBiZWZvcmUgc3RhcnRpbmcgdGhlIG5leHQgb25lLg0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoJ19fM2tsb3B0ZW4oKScsIDIwMDApOyANCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLSBJbWFnZSBMb2FkaW5nIFNldHVwIC0tLQ0KICAgICAgICBsZXQgX18zaW1hZ2VzTG9hZGVkID0gMDsNCiAgICAgICAgY29uc3QgX18zdG90YWxJbWFnZXMgPSAyOw0KDQogICAgICAgIGNvbnN0IF9fM2ltYWdlTG9hZEhhbmRsZXIgPSAoKSA9PiB7DQogICAgICAgICAgICBfXzNpbWFnZXNMb2FkZWQrKzsNCiAgICAgICAgICAgIGlmIChfXzNpbWFnZXNMb2FkZWQgPT09IF9fM3RvdGFsSW1hZ2VzKSB7DQogICAgICAgICAgICAgICAgX18zaW1hZ2VzTG9hZGVkID0gMDsgLy8gUmVzZXQgdm9vciBkZSB2b2xnZW5kZSBhbmltYXRpZWx1cw0KICAgICAgICAgICAgICAgIF9fM2luaXRBbmltYXRpb24oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvLyBab3JnIGVydm9vciBkYXQgZGUgaGFuZGxlciB3b3JkdCBhYW5nZXJvZXBlbiB3YW5uZWVyIGRlIGFmYmVlbGRpbmdlbiBnZWxhZGVuIHppam4gKG9vayBuYSBoZXJsYWRlbikNCiAgICAgICAgX18zaW1nQUVsZW1lbnQub25sb2FkID0gX18zaW1hZ2VMb2FkSGFuZGxlcjsNCiAgICAgICAgX18zaW1nQkVsZW1lbnQub25sb2FkID0gX18zaW1hZ2VMb2FkSGFuZGxlcjsNCg0KICAgICAgICAvLyBGYWxsYmFjayB2b29yIGltYWdlIGxvYWRpbmcgZXJyb3JzDQogICAgICAgIF9fM2ltZ0FFbGVtZW50Lm9uZXJyb3IgPSAoKSA9PiB7IGNvbnNvbGUuZXJyb3IoIkZvdXQgYmlqIGhldCBsYWRlbiB2YW4gQWZiZWVsZGluZyBBLiIpOyB9Ow0KICAgICAgICBfXzNpbWdCRWxlbWVudC5vbmVycm9yID0gKCkgPT4geyBjb25zb2xlLmVycm9yKCJGb3V0IGJpaiBoZXQgbGFkZW4gdmFuIEFmYmVlbGRpbmcgQi4iKTsgfTsNCg0KICAgIDwvc2NyaXB0Pg==<br>PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPHRpdGxlPkNvbnRpbnVvdXMgSW1hZ2UgVHJhbnNpdGlvbiBGaXg8L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQoNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiANCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7DQogICAgICAgICAgICBtYXJnaW46IDA7DQoNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovDQogICAgICAgIGNhbnZhcyB7DQogICAgICAgICAgICAvKiBUaGUgY2FudmFzIHdpbGwgbm93IGJlIHBsYWNlZCBpbnNpZGUgdGhpcyBkaXYgb25seSBvbmNlICovDQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOw0KICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiAqLw0KICAgICAgICAjYW5pbWF0aW9uQ2FudmFzIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KDQo8ZGl2IGlkPSdjYW52YXMnIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlOyc+DQogICAgPGNhbnZhcyBpZD0nYW5pbWF0aW9uQ2FudmFzJyB3aWR0aD00MDAgaGVpZ2h0PTIyNSBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtwb3NpdGlvbjpmaXhlZDtsZWZ0OjA7dG9wOjAnPjwvY2FudmFzPg0KPC9kaXY+DQoNCjxzY3JpcHQ+DQogICAgLy8gLS0tIEltYWdlIFNvdXJjZSBhbmQgT2JqZWN0IFN0b3JhZ2UgLS0tDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpVUkwqIG9mIHRoZSBjdXJyZW50bHkgbG9hZGVkIGltYWdlIHNldA0KICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCiAgICB2YXIgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQogICAgDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpBY3R1YWwgSW1hZ2UgT2JqZWN0cyogZm9yIHRoZSBhbmltYXRpb24NCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KQ0KICAgIHZhciBuZXh0SW1hZ2UgPSBudWxsOyAgICAvLyBJbWFnZSBCIChUaGUgVGFyZ2V0KQ0KDQogICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQ0KICAgIHZhciBjYW52YXNiYmk7DQogICAgdmFyIGN0eGJpOw0KICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQ0KICAgIHZhciBwaXhiaXhlbHMgPSBbXTsgICAgICAgIA0KICAgIHZhciB0b3RhbEZyYW1lc2JiID0gNDA7ICAgDQogICAgdmFyIGN1cnJlbnRGcmFtZWJiID0gMDsNCiAgICANCiAgICAvLyBEaW1lbnNpb25zIGZvciB0aGUgY2FudmFzIGVsZW1lbnQNCiAgICB2YXIgYnJlZWQzNjAgPSA0MDA7ICAvLzM1MDsgDQogICAgdmFyIGhvb2cxODAgPSAyMjU7IC8vDQoNCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0NCg0KICAgIC8qKg0KICAgICAqIExvYWRzIGEgc2luZ2xlIGltYWdlIGludG8gdGhlIGltYWdlc2JpIG1hcC4NCiAgICAgKi8NCiAgICB2YXIgbG9hZEltYWdlYmIgPSAoc3JjLCBjYWxsYmFjaykgPT4gew0KICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7DQogICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICBpbWFnZXNiaVtzcmNdID0gaW1nOyANCiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7DQogICAgICAgIH07DQogICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOw0KICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcuc3JjID0gc3JjOw0KICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsgDQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIExvYWRzIHRoZSBuZXh0IGltYWdlIGluIHRoZSBzZXF1ZW5jZSBhbmQgc3RhcnRzIHRoZSB0cmFuc2l0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsNCiAgICAgICAgLy8gVGhlIGN1cnJlbnQgaW1hZ2UgaXMgbm93IGF2YWlsYWJsZSBhcyBjdXJyZW50SW1hZ2UgKHdoaWNoIHdhcyB0aGUgb2xkIG5leHRJbWFnZSkNCiAgICAgICAgLy8gV2Ugb25seSBuZWVkIHRvIGxvYWQgdGhlIGJyYW5kIG5ldyBpbWFnZSAobmV4dFVSTCkuDQogICAgICAgIA0KICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOw0KICAgICAgICANCiAgICAgICAgLy8gMS4gTG9hZCB0aGUgbmV3IGltYWdlIChDKQ0KICAgICAgICBpZiAoaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdKSB7DQogICAgICAgICAgICAgLy8gSWYgYWxyZWFkeSBjYWNoZWQgKHNob3VsZG4ndCBoYXBwZW4gd2l0aCB1bmlxdWUgP3JhbmRvbT0pLCB1c2UgaXQgaW1tZWRpYXRlbHkNCiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICAvLyAyLiBTdGFydCB0aGUgdHJhbnNpdGlvbiBmcm9tIEIgdG8gQyBvbmNlIEMgaXMgbG9hZGVkDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHJ5IGxvYWRpbmcgdGhlIG5leHQgaW1hZ2UgYWZ0ZXIgYSBkZWxheQ0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7IA0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgY2FudmFzIGFuZCBsb2FkcyB0aGUgaW5pdGlhbCB0d28gaW1hZ2VzIChBIGFuZCBCKS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpbml0Q2FudmFzQW5kSW1hZ2VzKCkgew0KICAgICAgICAvLyBJbml0aWFsaXplIGNhbnZhcyBPTkxZIE9OQ0UNCiAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOw0KICAgICAgICBjYW52YXNiYmkud2lkdGggPSBicmVlZDM2MDsgDQogICAgICAgIGNhbnZhc2JiaS5oZWlnaHQgPSBob29nMTgwOw0KICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOw0KDQogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7DQogICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlOw0KDQogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yKSB7DQogICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBsb2FkZWRDb3VudCsrOw0KDQogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc2JpW2N1cnJlbnRVUkxdOw0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXh0VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlYmIoc3JjLCBvbkltYWdlTG9hZGVkKSk7DQogICAgfQ0KDQoNCiAgICAvLyAtLS0gUGl4ZWwgYW5kIEVhc2luZyBVdGlsaXRpZXMgLS0tDQogICAgdmFyIHBhcnNlUkdCQSA9IChyZ2JhU3RyaW5nKSA9PiB7DQogICAgICAgIHZhciBwYXJ0cyA9IHJnYmFTdHJpbmcubWF0Y2goL1xkKyhcLlxkKyk/L2cpLm1hcChOdW1iZXIpOw0KICAgICAgICByZXR1cm4geyByOiBwYXJ0c1swXSwgZzogcGFydHNbMV0sIGI6IHBhcnRzWzJdLCBhOiBwYXJ0c1szXSB8fCAxIH07DQogICAgfTsNCg0KICAgIHZhciBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gew0KICAgICAgICB2YXIgYzEgPSBwYXJzZVJHQkEoY29sb3IxKTsNCiAgICAgICAgdmFyIGMyID0gcGFyc2VSR0JBKGNvbG9yMik7DQogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjMS5yICsgKGMyLnIgLSBjMS5yKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKGMxLmcgKyAoYzIuZyAtIGMxLmcpICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgYiA9IE1hdGgucm91bmQoYzEuYiArIChjMi5iIC0gYzEuYikgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBhID0gYzEuYSArIChjMi5hIC0gYzEuYSkgKiBwcm9ncmVzczsNCiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7YX0pYDsNCiAgICB9Ow0KDQogICAgdmFyIGRyYXdQaXhlbHMgPSAocGl4Yml4ZWxzVG9EcmF3KSA9PiB7DQogICAgICAgIC8vIERyYXdpbmcgcGl4ZWxzIHdpdGhvdXQgY2xlYXJpbmcgdGhlIGNhbnZhcyBmaXJzdCBpcyB3aGF0IHJlbW92ZXMgdGhlIGZsYXNoDQogICAgICAgIC8vIEhvd2V2ZXIsIHdlIG11c3QgY2xlYXIgdGhlIGNhbnZhcyB0byBkcmF3IHRoZSBuZXh0IGZyYW1lIGNvcnJlY3RseS4NCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgIHBpeGJpeGVsc1RvRHJhdy5mb3JFYWNoKHAgPT4gew0KICAgICAgICAgICAgY3R4YmkuZmlsbFN0eWxlID0gcC5jb2xvcjsNCiAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KHAueCwgcC55LCAxLCAxKTsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsNCg0KICAgIC8qKg0KICAgICAqIEV4dHJhY3RzIHBpeGVsIGRhdGEgZnJvbSB0aGUgbG9hZGVkIEltYWdlIE9iamVjdHMgKGN1cnJlbnRJbWFnZSBhbmQgbmV4dEltYWdlKS4NCiAgICAgKi8NCiAgICB2YXIgc2V0dXBJbml0aWFsQ2FudmFzID0gKCkgPT4gew0KICAgICAgICB2YXIgaW1nMSA9IGN1cnJlbnRJbWFnZTsgLy8gVGhlIHN0YXJ0IGltYWdlDQogICAgICAgIHZhciBpbWcyID0gbmV4dEltYWdlOyAgICAvLyBUaGUgdGFyZ2V0IGltYWdlDQoNCiAgICAgICAgcGl4Yml4ZWxzID0gW107DQogICAgICAgIA0KICAgICAgICAvLyAqKkNSVUNJQUwgRklYIEZPUiBDT05USU5VSVRZKio6IEVuc3VyZSB0aGUgY2FudmFzIGRpc3BsYXlzIHRoZSBzdGFydGluZyBpbWFnZSAoaW1nMSkgDQogICAgICAgIC8vIGJlZm9yZSB0aGUgYW5pbWF0aW9uIHN0YXJ0cywgZWxpbWluYXRpbmcgdGhlIGJsYWNrIGZyYW1lLg0KICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGltZzEsIDAsIDAgLCBicmVlZDM2MCwgaG9vZzE4MCk7DQoNCiAgICAgICAgLy8gLS0tIEV4dHJhY3Rpb24gTG9naWMgZm9yIGltZzEgKFN0YXJ0IEltYWdlKSAtLS0NCiAgICAgICAgdmFyIGRhdGExID0gY3R4YmkuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsNCiAgICAgICAgdmFyIHBpeGJpeGVsc0Zyb21JbWFnZTEgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBjYW52YXNiYmkuaGVpZ2h0OyB5KyspIHsNCiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgY2FudmFzYmJpLndpZHRoOyB4KyspIHsNCiAgICAgICAgICAgICAgICB2YXIgaSA9ICh5ICogY2FudmFzYmJpLndpZHRoICsgeCkgKiA0Ow0KICAgICAgICAgICAgICAgIHZhciBhbHBoYSA9IGRhdGExW2kgKyAzXTsNCiAgICAgICAgICAgICAgICBpZiAoYWxwaGEgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHBpeGJpeGVsc0Zyb21JbWFnZTEucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LA0KICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGByZ2JhKCR7ZGF0YTFbaV19LCAke2RhdGExW2krMV19LCAke2RhdGExW2krMl19LCAke2FscGhhIC8gMjU1fSlgDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLSBFeHRyYWN0aW9uIExvZ2ljIGZvciBpbWcyIChUYXJnZXQgSW1hZ2UpIC0tLQ0KICAgICAgICB2YXIgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgICAgICB2YXIgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IGNhbnZhc2JiaS53aWR0aDsNCiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0Ow0KICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWcyLCAwLCAwLCBicmVlZDM2MCwgaG9vZzE4MCk7DQogICAgICAgIHZhciBkYXRhMiA9IHRlbXBDdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsNCiAgICAgICAgdmFyIHBpeGJpeGVsc0Zyb21JbWFnZTIgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBjYW52YXNiYmkuaGVpZ2h0OyB5KyspIHsNCiAgICAgICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgY2FudmFzYmJpLndpZHRoOyB4KyspIHsNCiAgICAgICAgICAgICAgICB2YXIgaSA9ICh5ICogY2FudmFzYmJpLndpZHRoICsgeCkgKiA0Ow0KICAgICAgICAgICAgICAgIHZhciBhbHBoYSA9IGRhdGEyW2kgKyAzXTsNCiAgICAgICAgICAgICAgICBpZiAoYWxwaGEgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIHBpeGJpeGVsc0Zyb21JbWFnZTIucHVzaCh7DQogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LA0KICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGByZ2JhKCR7ZGF0YTJbaV19LCAke2RhdGEyW2krMV19LCAke2RhdGEyW2krMl19LCAke2FscGhhIC8gMjU1fSlgDQogICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8vIC0tLSBTb3J0aW5nIGFuZCBNYXBwaW5nIExvZ2ljIChVbmNoYW5nZWQpIC0tLQ0KICAgICAgICB2YXIgY2VudGVyWCA9IGNhbnZhc2JiaS53aWR0aCAvIDI7DQogICAgICAgIHZhciBjZW50ZXJZID0gY2FudmFzYmJpLmhlaWdodCAvIDI7DQogICAgICAgIHBpeGJpeGVsc0Zyb21JbWFnZTEuc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgICAgdmFyIGRpc3RBID0gTWF0aC5zcXJ0KE1hdGgucG93KGEueCAtIGNlbnRlclgsIDIpICsgTWF0aC5wb3coYS55IC0gY2VudGVyWSwgMikpOw0KICAgICAgICAgICAgdmFyIGRpc3RCID0gTWF0aC5zcXJ0KE1hdGgucG93KGIueCAtIGNlbnRlclgsIDIpICsgTWF0aC5wb3coYi55IC0gY2VudGVyWSwgMikpOw0KICAgICAgICAgICAgcmV0dXJuIGRpc3RBIC0gZGlzdEI7DQogICAgICAgIH0pOw0KDQogICAgICAgIHBpeGJpeGVsc0Zyb21JbWFnZTIuc29ydCgoYSwgYikgPT4gew0KICAgICAgICAgICAgdmFyIGRpc3RBID0gTWF0aC5zcXJ0KE1hdGgucG93KGEueCAtIGNlbnRlclgsIDIpICsgTWF0aC5wb3coYS55IC0gY2VudGVyWSwgMikpOw0KICAgICAgICAgICAgdmFyIGRpc3RCID0gTWF0aC5zcXJ0KE1hdGgucG93KGIueCAtIGNlbnRlclgsIDIpICsgTWF0aC5wb3coYi55IC0gY2VudGVyWSwgMikpOw0KICAgICAgICAgICAgcmV0dXJuIGRpc3RCIC0gZGlzdEE7IA0KICAgICAgICB9KTsNCg0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBpeGJpeGVsc0Zyb21JbWFnZTIubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciB0YXJnZXRQaXhlbCA9IHBpeGJpeGVsc0Zyb21JbWFnZTJbaV07IA0KICAgICAgICAgICAgdmFyIG9yaWdpbmFsUGl4ZWwgPSBwaXhiaXhlbHNGcm9tSW1hZ2UxW2kgJSBwaXhiaXhlbHNGcm9tSW1hZ2UxLmxlbmd0aF07DQoNCiAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsNCiAgICAgICAgICAgICAgICBvcmlnaW5hbFg6IG9yaWdpbmFsUGl4ZWwueCwNCiAgICAgICAgICAgICAgICBvcmlnaW5hbFk6IG9yaWdpbmFsUGl4ZWwueSwNCiAgICAgICAgICAgICAgICBjb2xvcjE6IG9yaWdpbmFsUGl4ZWwuY29sb3IsDQogICAgICAgICAgICAgICAgdGFyZ2V0WDogdGFyZ2V0UGl4ZWwueCwNCiAgICAgICAgICAgICAgICB0YXJnZXRZOiB0YXJnZXRQaXhlbC55LA0KICAgICAgICAgICAgICAgIGNvbG9yMjogdGFyZ2V0UGl4ZWwuY29sb3IsDQogICAgICAgICAgICAgICAgeDogb3JpZ2luYWxQaXhlbC54LA0KICAgICAgICAgICAgICAgIHk6IG9yaWdpbmFsUGl4ZWwueSwNCiAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3I6IG9yaWdpbmFsUGl4ZWwuY29sb3INCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEFuaW1hdGVzIHBpeGJpeGVscyBzcGlyYWxpbmcgaW53YXJkIGFuZCBoYW5kbGVzIHRoZSByb3VuZCBjb25jbHVzaW9uLg0KICAgICAqLw0KICAgIHZhciBhbmltYXRlU3BpcmFsSW53YXJkID0gKCkgPT4gew0KICAgICAgICB2YXIgZHQgPSBjdXJyZW50RnJhbWViYiAvIHRvdGFsRnJhbWVzYmI7DQogICAgICAgIHZhciBlYXNlZER0ID0gZWFzZUluT3V0UXVpbnQoZHQpOw0KDQogICAgICAgIHZhciBjdXJyZW50RnJhbWViYlBpeGVscyA9IFtdOw0KICAgICAgICBwaXhiaXhlbHMuZm9yRWFjaChwID0+IHsNCiAgICAgICAgICAgIHZhciBpbnRlcnBvbGF0ZWRYID0gcC5vcmlnaW5hbFggKyAocC50YXJnZXRYIC0gcC5vcmlnaW5hbFgpICogZWFzZWREdDsNCiAgICAgICAgICAgIHZhciBpbnRlcnBvbGF0ZWRZID0gcC5vcmlnaW5hbFkgKyAocC50YXJnZXRZIC0gcC5vcmlnaW5hbFkpICogZWFzZWREdDsNCiAgICAgICAgICAgIHZhciBpbnRlcnBvbGF0ZWRDb2xvciA9IGludGVycG9sYXRlQ29sb3IocC5jb2xvcjEsIHAuY29sb3IyLCBlYXNlZER0KTsNCg0KICAgICAgICAgICAgY3VycmVudEZyYW1lYmJQaXhlbHMucHVzaCh7DQogICAgICAgICAgICAgICAgeDogaW50ZXJwb2xhdGVkWCwNCiAgICAgICAgICAgICAgICB5OiBpbnRlcnBvbGF0ZWRZLA0KICAgICAgICAgICAgICAgIGNvbG9yOiBpbnRlcnBvbGF0ZWRDb2xvcg0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGRyYXdQaXhlbHMoY3VycmVudEZyYW1lYmJQaXhlbHMpOw0KDQogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsNCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiKys7DQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZVNwaXJhbElud2FyZCk7IA0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLg0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyAxLiBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgdG8gdGhlIGNhbnZhcyB0byBjb21wbGV0ZWx5IGNvdmVyIHRoZSB0cmFuc2l0aW9uIHBpeGVscy4NCiAgICAgICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICAgICAgY3R4YmkuZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgLy8gMi4gU1dBUCBPQkpFQ1RTOiBUaGUgb2xkIHRhcmdldCBpbWFnZSBvYmplY3QgKEIpIGlzIHRoZSBuZXcgc3RhcnQgaW1hZ2Ugb2JqZWN0IChBKS4NCiAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IG5leHRJbWFnZTsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gMy4gU1dBUCBVUkxTOiBUaGUgb2xkIHRhcmdldCBVUkwgKEIpIGlzIHRoZSBuZXcgc3RhcnQgVVJMIChBKS4NCiAgICAgICAgICAgIGN1cnJlbnRVUkwgPSBuZXh0VVJMOyANCg0KICAgICAgICAgICAgLy8gNC4gR0VORVJBVEUgTkVXIFRBUkdFVCBVUkwgKEMpDQogICAgICAgICAgICBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyAgDQoNCiAgICAgICAgICAgIC8vIDUuIFN0YXJ0IHRoZSBsb2FkIHByb2Nlc3MgZm9yIHRoZSBuZXh0IGltYWdlIChDKS4gTm8gZGVsYXkgbmVlZGVkIGhlcmUuDQogICAgICAgICAgICBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKTsgDQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYW5kIHN0YXJ0cyB0aGUgYW5pbWF0aW9uIHNlcXVlbmNlLg0KICAgICAqLw0KICAgIHZhciBzdGFydEFuaW1hdGlvbmZ0ID0gKCkgPT4gew0KICAgICAgICBjdXJyZW50RnJhbWViYiA9IDA7DQoNCiAgICAgICAgLy8gUHJlcGFyZSBwaXhlbCBkYXRhIGZvciB0aGUgdHJhbnNpdGlvbiAoQiAtPiBDKQ0KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsgDQogICAgICAgIA0KICAgICAgICBhbmltYXRlU3BpcmFsSW53YXJkKCk7IA0KICAgIH07DQoNCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQ0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOw0KICAgIH07DQo8L3NjcmlwdD4NCg0KPC9ib2R5Pg0KPC9odG1sPg==<br>PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+DQogICAgPHRpdGxlPkNvbnRpbnVvdXMgSW1hZ2UgQ29tcHJlc3Npb24gVHJhbnNpdGlvbjwvdGl0bGU+DQogICAgPHN0eWxlPg0KICAgICAgICAvKiBCYXNlIHN0eWxlcyAqLw0KICAgICAgICBib2R5IHsgd2lkdGg6MTAwJTsgaGVpZ2h0OjEwMCU7ICANCiAgICAgIA0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgDQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICANCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovDQogICAgICAgIGNhbnZhcyB7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOw0KICAgIA0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiAqLw0KICAgICAgICAjYW5pbWF0aW9uQ2FudmFzIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KCQl3aWR0aDoxMDAlOw0KaGVpZ2h0OjEwMCU7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICAvKiBUaGUgY2FudmFzIHNpemUgd2lsbCBiZSBzZXQgaW4gSmF2YVNjcmlwdCB0byB0aGUgaW1hZ2Ugc2l6ZSAoZS5nLiwgMzYweDY0MCkgKi8NCiAgICAgICANCiAgICAgICAgfQ0KDQogICAgICAgIC8qIFN0eWxlIGZvciB0aGUgaW5mbyBkaXYsIHdoaWNoIGlzIG5vdyBoaWRkZW4gKi8NCiAgICAgICAgLmluZm8gew0KICAgICAgICAgICAgZGlzcGxheTogbm9uZTsNCiAgICAgICAgfQ0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCg0KPGRpdiBpZD0nY2FudmFzJyBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTsnPg0KICAgIDxjYW52YXMgaWQ9J2FuaW1hdGlvbkNhbnZhcycgd2lkdGg9NjQwIGhlaWdodD0zNjAgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7cG9zaXRpb246Zml4ZWQ7bGVmdDowO3RvcDowJz48L2NhbnZhcz4NCiAgICA8ZGl2IGNsYXNzPSJpbmZvIj48L2Rpdj4gDQo8L2Rpdj4NCg0KPHNjcmlwdD4NCiAgICAvLyAtLS0gR2xvYmFsIENvbmZpZ3VyYXRpb24gLS0tDQogICAgY29uc3QgQU5JTUFUSU9OX1NQRUVEX01TID0gMTA7IC8vIEZhc3RlciBhbmltYXRpb24gZnJhbWUgdXBkYXRlICh1c2luZyBzZXRUaW1lb3V0IGZvciBjb250cm9sKQ0KICAgIGNvbnN0IFRPVEFMX1NURVBTID0gNTA7DQogICAgY29uc3QgSU1BR0VfV0lEVEggPSAzNjA7DQogICAgY29uc3QgSU1BR0VfSEVJR0hUID0gNjQwOw0KDQogICAgLy8gLS0tIEltYWdlIFN0YXRlIE1hbmFnZW1lbnQgLS0tDQogICAgLy8gU3RhcnQgd2l0aCB0d28gdW5pcXVlIFVSTHMgKEEgYW5kIEIpDQogICAgdmFyIGN1cnJlbnRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KICAgIHZhciBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCiAgICANCiAgICAvLyBJbWFnZSBPYmplY3RzIChBIGFuZCBCKQ0KICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOyAvLyBJbWFnZSBBIChUaGUgU3RhcnQpDQogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpDQogICAgdmFyIGltYWdlc0NhY2hlID0ge307ICAgIC8vIFN0b3JlcyBBTEwgbG9hZGVkIEltYWdlIG9iamVjdHMgKGtleWVkIGJ5IFVSTCkNCg0KICAgIC8vIC0tLSBDYW52YXMgJiBBbmltYXRpb24gU3RhdGUgLS0tDQogICAgdmFyIHJfX2NhbnZhczsNCiAgICB2YXIgcl9fY3R4Ow0KICAgIHZhciByX190b3RhbFN0ZXBzID0gVE9UQUxfU1RFUFM7DQogICAgdmFyIHJfX2N1cnJlbnRTdGVwID0gMDsNCiAgICB2YXIgcl9fYW5pbWF0aW9uRnJhbWVzID0gW107IC8vIFRvIHN0b3JlIHByZS1yZWNvcmRlZCBmcmFtZXMNCg0KICAgIC8vIC0tLSBDb3JlIFV0aWxpdHkgRnVuY3Rpb25zIChPcHRpbWl6ZWQgYW5kIFJlbmFtZWQpIC0tLQ0KDQogICAgLyoqDQogICAgICogTG9hZHMgYSBzaW5nbGUgaW1hZ2UgYW5kIGNhY2hlcyB0aGUgSW1hZ2Ugb2JqZWN0Lg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxvYWRJbWFnZUFuZENhY2hlKHNyYywgY2FsbGJhY2spIHsNCiAgICAgICAgaWYgKGltYWdlc0NhY2hlW3NyY10pIHsNCiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltYWdlc0NhY2hlW3NyY10pOw0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTsNCiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIGltYWdlc0NhY2hlW3NyY10gPSBpbWc7DQogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsNCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLnNyYyA9IHNyYzsNCiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7IC8vIFJlcXVpcmVkIGZvciBnZXRJbWFnZURhdGENCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gZ2V0IEltYWdlRGF0YSBmcm9tIGFuIEhUTUxJbWFnZUVsZW1lbnQuDQogICAgICovDQogICAgZnVuY3Rpb24gcl9fZ2V0UGl4ZWxEYXRhKGltYWdlKSB7DQogICAgICAgIGNvbnN0IHRlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgY29uc3QgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgLy8gRW5zdXJlIHRlbXBvcmFyeSBjYW52YXMgbWF0Y2hlcyB0aGUgaW1hZ2Ugc2l6ZQ0KICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gaW1hZ2UubmF0dXJhbFdpZHRoOyANCiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBpbWFnZS5uYXR1cmFsSGVpZ2h0Ow0KICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7DQogICAgICAgIHJldHVybiB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB0ZW1wQ2FudmFzLndpZHRoLCB0ZW1wQ2FudmFzLmhlaWdodCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2FsY3VsYXRlcyBhIHNpbmdsZSBmcmFtZSBvZiB0aGUgY29tcHJlc3Npb24gYW5pbWF0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJfX2NhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShvcmlnaW5hbEltYWdlRGF0YSwgc3RlcCwgdG90YWxQaGFzZVN0ZXBzKSB7DQogICAgICAgIGNvbnN0IHJfX3dpZHRoID0gb3JpZ2luYWxJbWFnZURhdGEud2lkdGg7DQogICAgICAgIGNvbnN0IHJfX2hlaWdodCA9IG9yaWdpbmFsSW1hZ2VEYXRhLmhlaWdodDsNCiAgICAgICAgY29uc3Qgcl9fb3JpZ2luYWxQaXhlbHMgPSBvcmlnaW5hbEltYWdlRGF0YS5kYXRhOw0KICAgICAgICBjb25zdCByX19uZXdQaXhlbHNCdWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkocl9fd2lkdGggKiByX19oZWlnaHQgKiA0KTsNCg0KICAgICAgICAvLyBDbGVhciBidWZmZXIgcGl4ZWxzDQogICAgICAgIGZvciAobGV0IHJfX2kgPSAwOyByX19pIDwgcl9fbmV3UGl4ZWxzQnVmZmVyLmxlbmd0aDsgcl9faSArPSA0KSB7DQogICAgICAgICAgICByX19uZXdQaXhlbHNCdWZmZXJbcl9faSArIDNdID0gMDsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IHJfX21heENvbXByZXNzaW9uRGlzdGFuY2UgPSByX193aWR0aCAvIDM7DQogICAgICAgIGNvbnN0IHJfX2NvbXByZXNzaW9uUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCBzdGVwIC8gKHRvdGFsUGhhc2VTdGVwcyAtIDEpKTsNCg0KICAgICAgICBmb3IgKGxldCByX195ID0gMDsgcl9feSA8IHJfX2hlaWdodDsgcl9feSsrKSB7DQogICAgICAgICAgICBmb3IgKGxldCByX194ID0gMDsgcl9feCA8IHJfX3dpZHRoOyByX194KyspIHsNCiAgICAgICAgICAgICAgICBjb25zdCByX19pID0gKHJfX3kgKiByX193aWR0aCArIHJfX3gpICogNDsNCiAgICAgICAgICAgICAgICBjb25zdCByX19yID0gcl9fb3JpZ2luYWxQaXhlbHNbcl9faV07DQogICAgICAgICAgICAgICAgY29uc3Qgcl9fZyA9IHJfX29yaWdpbmFsUGl4ZWxzW3JfX2kgKyAxXTsNCiAgICAgICAgICAgICAgICBjb25zdCByX19iID0gcl9fb3JpZ2luYWxQaXhlbHNbcl9faSArIDJdOw0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2EgPSByX19vcmlnaW5hbFBpeGVsc1tyX19pICsgM107DQoNCiAgICAgICAgICAgICAgICBpZiAocl9fYSA9PT0gMCkgY29udGludWU7IC8vIFNraXAgdHJhbnNwYXJlbnQgcGl4ZWxzDQoNCiAgICAgICAgICAgICAgICBjb25zdCByX19hdmdDb2xvciA9IChyX19yICsgcl9fZyArIHJfX2IpIC8gMzsNCiAgICAgICAgICAgICAgICBjb25zdCByX19ub3JtYWxpemVkQXZnQ29sb3IgPSByX19hdmdDb2xvciAvIDI1NTsNCg0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2Rpc3RhbmNlRnJvbUxlZnQgPSByX194Ow0KICAgICAgICAgICAgICAgIGNvbnN0IHJfX2Rpc3RhbmNlRnJvbVJpZ2h0ID0gcl9fd2lkdGggLSAxIC0gcl9feDsNCiAgICAgICAgICAgICAgICBjb25zdCByX190YXJnZXRFZGdlWCA9IChyX19kaXN0YW5jZUZyb21MZWZ0IDwgcl9fZGlzdGFuY2VGcm9tUmlnaHQpID8gMCA6IHJfX3dpZHRoIC0gMTsNCg0KICAgICAgICAgICAgICAgIGxldCByX19tb3ZlbWVudCA9IHJfX25vcm1hbGl6ZWRBdmdDb2xvciAqIHJfX21heENvbXByZXNzaW9uRGlzdGFuY2UgKiByX19jb21wcmVzc2lvblByb2dyZXNzOw0KDQogICAgICAgICAgICAgICAgbGV0IHJfX25ld1ggPSByX194Ow0KICAgICAgICAgICAgICAgIGlmIChyX190YXJnZXRFZGdlWCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICByX19uZXdYID0gcl9feCAtIHJfX21vdmVtZW50Ow0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJfX25ld1ggPSByX194ICsgcl9fbW92ZW1lbnQ7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcl9fbmV3WCA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgTWF0aC5taW4ocl9fd2lkdGggLSAxLCByX19uZXdYKSkpOw0KDQogICAgICAgICAgICAgICAgY29uc3Qgcl9fZGVzdEluZGV4ID0gKHJfX3kgKiByX193aWR0aCArIHJfX25ld1gpICogNDsNCg0KICAgICAgICAgICAgICAgIC8vIENvcHkgY29sb3IgZGF0YSB0byBpdHMgbmV3IHBvc2l0aW9uDQogICAgICAgICAgICAgICAgcl9fbmV3UGl4ZWxzQnVmZmVyW3JfX2Rlc3RJbmRleF0gPSByX19yOw0KICAgICAgICAgICAgICAgIHJfX25ld1BpeGVsc0J1ZmZlcltyX19kZXN0SW5kZXggKyAxXSA9IHJfX2c7DQogICAgICAgICAgICAgICAgcl9fbmV3UGl4ZWxzQnVmZmVyW3JfX2Rlc3RJbmRleCArIDJdID0gcl9fYjsNCiAgICAgICAgICAgICAgICByX19uZXdQaXhlbHNCdWZmZXJbcl9fZGVzdEluZGV4ICsgM10gPSByX19hOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgY29uc3Qgcl9fbmV3SW1hZ2VEYXRhID0gcl9fY3R4LmNyZWF0ZUltYWdlRGF0YShyX193aWR0aCwgcl9faGVpZ2h0KTsNCiAgICAgICAgcl9fbmV3SW1hZ2VEYXRhLmRhdGEuc2V0KHJfX25ld1BpeGVsc0J1ZmZlcik7DQogICAgICAgIHJldHVybiByX19uZXdJbWFnZURhdGE7DQogICAgfQ0KDQogICAgLy8gLS0tIEFuaW1hdGlvbiBGbG93IENvbnRyb2wgLS0tDQoNCiAgICAvKioNCiAgICAgKiBQcmUtY2FsY3VsYXRlcyBhbGwgYW5pbWF0aW9uIGZyYW1lcyBmb3IgdGhlIHRyYW5zaXRpb24gZnJvbSBpbWcwIHRvIGltZzEuDQogICAgICovDQogICAgZnVuY3Rpb24gcl9fcHJlcmVjb3JkRnJhbWVzKGltZzAsIGltZzEpIHsNCiAgICAgICAgcl9fYW5pbWF0aW9uRnJhbWVzID0gW107DQogICAgICAgIHJfX2N1cnJlbnRTdGVwID0gMDsNCiAgICAgICAgDQogICAgICAgIC8vIEVuc3VyZSBjYW52YXMgbWF0Y2hlcyBpbWFnZSBzaXplIGJlZm9yZSBnZXR0aW5nIHBpeGVsIGRhdGENCiAgICAgICAgcl9fY2FudmFzLndpZHRoID0gaW1nMC5uYXR1cmFsV2lkdGg7DQogICAgICAgIHJfX2NhbnZhcy5oZWlnaHQgPSBpbWcwLm5hdHVyYWxIZWlnaHQ7DQoNCiAgICAgICAgY29uc3Qgcl9faW1hZ2VEYXRhMCA9IHJfX2dldFBpeGVsRGF0YShpbWcwKTsNCiAgICAgICAgY29uc3Qgcl9faW1hZ2VEYXRhMSA9IHJfX2dldFBpeGVsRGF0YShpbWcxKTsNCg0KICAgICAgICBjb25zdCByX19oYWxmU3RlcHMgPSByX190b3RhbFN0ZXBzIC8gMjsNCg0KICAgICAgICAvLyBQaGFzZSAxOiBJbWFnZTAgY29tcHJlc3NlcyAoc3RlcHMgMCB0byAyNCkNCiAgICAgICAgZm9yIChsZXQgcl9fc3RlcCA9IDA7IHJfX3N0ZXAgPCByX19oYWxmU3RlcHM7IHJfX3N0ZXArKykgew0KICAgICAgICAgICAgY29uc3Qgcl9fZnJhbWVEYXRhID0gcl9fY2FsY3VsYXRlQ29tcHJlc3NlZEZyYW1lKHJfX2ltYWdlRGF0YTAsIHJfX3N0ZXAsIHJfX2hhbGZTdGVwcyk7DQogICAgICAgICAgICByX19hbmltYXRpb25GcmFtZXMucHVzaChyX19mcmFtZURhdGEpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gUGhhc2UgMjogSW1hZ2UxIHVuY29tcHJlc3NlcyAoc3RlcHMgMjUgdG8gNDkpDQogICAgICAgIGNvbnN0IHJfX2ltYWdlMUNvbXByZXNzZWRTdGF0ZXMgPSBbXTsNCiAgICAgICAgZm9yIChsZXQgcl9fc3RlcCA9IDA7IHJfX3N0ZXAgPCByX19oYWxmU3RlcHM7IHJfX3N0ZXArKykgew0KICAgICAgICAgICAgY29uc3Qgcl9fZnJhbWVEYXRhID0gcl9fY2FsY3VsYXRlQ29tcHJlc3NlZEZyYW1lKHJfX2ltYWdlRGF0YTEsIHJfX3N0ZXAsIHJfX2hhbGZTdGVwcyk7DQogICAgICAgICAgICByX19pbWFnZTFDb21wcmVzc2VkU3RhdGVzLnB1c2gocl9fZnJhbWVEYXRhKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8vIEFkZCB0aGUgcmV2ZXJzZWQgc2VxdWVuY2Ugb2YgSW1hZ2UxJ3MgY29tcHJlc3NlZCBzdGF0ZXMuDQogICAgICAgIGZvciAobGV0IHJfX2kgPSByX19pbWFnZTFDb21wcmVzc2VkU3RhdGVzLmxlbmd0aCAtIDE7IHJfX2kgPj0gMDsgcl9faS0tKSB7DQogICAgICAgICAgICByX19hbmltYXRpb25GcmFtZXMucHVzaChyX19pbWFnZTFDb21wcmVzc2VkU3RhdGVzW3JfX2ldKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiBEcmF3cyB0aGUgcHJlLXJlY29yZGVkIGZyYW1lIGZvciB0aGUgY3VycmVudCBzdGVwLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIHJfX2FuaW1hdGUoKSB7DQogICAgICAgIGlmIChyX19jdXJyZW50U3RlcCA8IHJfX3RvdGFsU3RlcHMgJiYgcl9fYW5pbWF0aW9uRnJhbWVzW3JfX2N1cnJlbnRTdGVwXSkgew0KICAgICAgICAgICAgcl9fY3R4LnB1dEltYWdlRGF0YShyX19hbmltYXRpb25GcmFtZXNbcl9fY3VycmVudFN0ZXBdLCAwLCAwKTsNCiAgICAgICAgICAgIHJfX2N1cnJlbnRTdGVwKys7DQogICAgICAgICAgICBzZXRUaW1lb3V0KHJfX2FuaW1hdGUsIEFOSU1BVElPTl9TUEVFRF9NUyk7DQogICAgICAgIH0gZWxzZSBpZiAocl9fY3VycmVudFN0ZXAgPT09IHJfX3RvdGFsU3RlcHMpIHsNCiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gMS4gKipDUlVDSUFMKio6IERyYXcgdGhlIGZpbmFsIGltYWdlIChuZXh0SW1hZ2UsIHdoaWNoIGlzIEIpIGZ1bGx5IHRvIHRoZSBjYW52YXMuDQogICAgICAgICAgICAvLyBUaGlzIGVsaW1pbmF0ZXMgYW55IHBpeGVsIGFydGlmYWN0cyBhbmQgZW5zdXJlcyBhIHNtb290aCBlbmQgc3RhdGUuDQogICAgICAgICAgICByX19jdHguY2xlYXJSZWN0KDAsIDAsIHJfX2NhbnZhcy53aWR0aCwgcl9fY2FudmFzLmhlaWdodCk7DQogICAgICAgICAgICByX19jdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgcl9fY2FudmFzLndpZHRoLCByX19jYW52YXMuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgLy8gMi4gU1dBUCBPQkpFQ1RTOiBUaGUgb2xkIHRhcmdldCBpbWFnZSAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSAoQSkuDQogICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIDMuIFNXQVAgVVJMUzogVGhlIG9sZCB0YXJnZXQgVVJMIChCKSBpcyB0aGUgbmV3IHN0YXJ0IFVSTCAoQSkuDQogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsgDQoNCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKQ0KICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgIA0KDQogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuDQogICAgICAgICAgICBzZXRUaW1lb3V0KCdsb2FkTmV4dEltYWdlQW5kU3RhcnQoKScsIDE1MDApOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgKEMpIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiAoQiAtPiBDKS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7DQogICAgICAgIGNvbnN0IG5ld0ltYWdlVVJMID0gbmV4dFVSTDsNCiAgICAgICAgDQogICAgICAgIGxvYWRJbWFnZUFuZENhY2hlKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgaWYgKCFlcnJvcikgew0KICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltZzsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyBOb3cgd2UgaGF2ZSB0aGUgc3RhcnQgaW1hZ2UgKGN1cnJlbnRJbWFnZS9CKSBhbmQgdGhlIHRhcmdldCBpbWFnZSAobmV4dEltYWdlL0MpLg0KICAgICAgICAgICAgICAgIC8vIFByZS1yZWNvcmQgdGhlIGZyYW1lcyBmb3IgdGhlIEIgLT4gQyB0cmFuc2l0aW9uLg0KICAgICAgICAgICAgICAgIHJfX3ByZXJlY29yZEZyYW1lcyhjdXJyZW50SW1hZ2UsIG5leHRJbWFnZSk7IA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSBuZXcgYW5pbWF0aW9uIGxvb3AuDQogICAgICAgICAgICAgICAgcl9fYW5pbWF0ZSgpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgLy8gUmV0cnkgbG9hZGluZyB0aGUgbmV4dCBpbWFnZSBpZiBmYWlsZWQNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7IA0KICAgICAgICAgICAgfQ0KICAgICAgICB9KTsNCiAgICB9DQoNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGNhbnZhcyBhbmQgbG9hZHMgdGhlIGluaXRpYWwgdHdvIGltYWdlcyAoQSBhbmQgQikuDQogICAgICovDQogICAgZnVuY3Rpb24gcl9faW5pdCgpIHsNCiAgICAgICAgcl9fY2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOw0KICAgICAgICByX19jdHggPSByX19jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCg0KICAgICAgICAvLyBTZXQgdGhlIHNpemUgb25jZSBiYXNlZCBvbiBleHBlY3RlZCBpbWFnZSBzaXplDQogICAgICAgIHJfX2NhbnZhcy53aWR0aCA9IElNQUdFX1dJRFRIOw0KICAgICAgICByX19jYW52YXMuaGVpZ2h0ID0gSU1BR0VfSEVJR0hUOw0KDQogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7DQogICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlOw0KDQogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yKSBoYXNFcnJvciA9IHRydWU7DQogICAgICAgICAgICBsb2FkZWRDb3VudCsrOw0KDQogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc0NhY2hlW2N1cnJlbnRVUkxdOw0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNDYWNoZVtuZXh0VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIERpc3BsYXkgdGhlIHN0YXJ0aW5nIGltYWdlIChBKSBpbW1lZGlhdGVseSB0byBhdm9pZCBhIGJsYWNrIHNjcmVlbg0KICAgICAgICAgICAgICAgICAgICByX19jdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgcl9fY2FudmFzLndpZHRoLCByX19jYW52YXMuaGVpZ2h0KTsNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgIC8vIFByZS1yZWNvcmQgdGhlIGZyYW1lcyBmb3IgdGhlIEEgLT4gQiB0cmFuc2l0aW9uLg0KICAgICAgICAgICAgICAgICAgICByX19wcmVyZWNvcmRGcmFtZXMoY3VycmVudEltYWdlLCBuZXh0SW1hZ2UpOw0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpDQogICAgICAgICAgICAgICAgICAgIHJfX2FuaW1hdGUoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlQW5kQ2FjaGUoc3JjLCBvbkltYWdlTG9hZGVkKSk7DQogICAgfQ0KDQogICAgLy8gLS0tIEluaXRpYWwgQ2FsbCAtLS0NCiAgICB3aW5kb3cub25sb2FkID0gcl9faW5pdDsNCjwvc2NyaXB0Pg0KDQo8L2JvZHk+DQo8L2h0bWw+<br>PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+Qml6YXJyZSBIeXBlcmJvbGljIFZvcnRleCBUcmFuc2l0aW9uPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAvKiBCYXNlIHN0eWxlcyAqLwogICAgICAgIGJvZHkgeyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgIAogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovCiAgICAgICAgI2NhbnZhcyB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwoKICAgICAgICB9CgogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7CiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIHBhZGRpbmc6IDA7CiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgICAgICB9CgogICAgICAgIGgxIHsKICAgICAgICAgICAgY29sb3I6ICNGRjAwRkY7IC8qIEJpemFycmUgY29sb3IgKi8KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKIAogICAgICAgICAgICBmb250LXNpemU6IDEuNGVtOwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CgoKCjxkaXYgaWQ9J2NhbnZhcycgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Jz4KICAgIDxjYW52YXMgaWQ9J2FuaW1hdGlvbkNhbnZhcycgd2lkdGg9NjQwIGhlaWdodD0zNjAgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCUnPjwvY2FudmFzPgo8L2Rpdj4KCjxzY3JpcHQ+CiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0KICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyAKICAgIHZhciBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyAKICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOyAKICAgIHZhciBuZXh0SW1hZ2UgPSBudWxsOyAgICAKCiAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tCiAgICB2YXIgY2FudmFzYmJpOwogICAgdmFyIGN0eGJpOwogICAgdmFyIGltYWdlc2JpID0ge307ICAgICAgICAKICAgIHZhciBwaXhiaXhlbHMgPSBbXTsgICAgICAgCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDkwOyAgIC8vIFNsb3dlciwgbW9yZSBkZXRhaWxlZCB0cmFuc2l0aW9uCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOwogICAgCiAgICAvLyBDYW52YXMgRGltZW5zaW9ucwogICAgdmFyIGJyZWVkMzYwID0gNjQwOyAgLy8zNTA7IAogICAgdmFyIGhvb2cxODAgPSAzNjA7IC8vCgogICAgLy8gVm9ydGV4IENlbnRlciAoZm9yIHRoZSBiaXphcnJlIGVmZmVjdCkKICAgIGNvbnN0IGNlbnRlclggPSBicmVlZDM2MCAvIDI7CiAgICBjb25zdCBjZW50ZXJZID0gaG9vZzE4MCAvIDI7CgogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgKGxvYWRJbWFnZWJiLCBsb2FkTmV4dEltYWdlQW5kU3RhcnQsIGluaXRDYW52YXNBbmRJbWFnZXMgYXJlIHVuY2hhbmdlZCkgLS0tCgogICAgLyoqCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuCiAgICAgKi8KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7IAogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOwogICAgICAgIH07CiAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsKICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOwogICAgICAgIH07CiAgICAgICAgaW1nLnNyYyA9IHNyYzsKICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsgCiAgICB9OwoKICAgIC8qKgogICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgaW4gdGhlIHNlcXVlbmNlIGFuZCBzdGFydHMgdGhlIHRyYW5zaXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsKICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOwogICAgICAgIAogICAgICAgIGlmIChpbWFnZXNiaVtuZXdJbWFnZVVSTF0pIHsKICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdOwogICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9hZEltYWdlYmIobmV3SW1hZ2VVUkwsIChlcnJvciwgaW1nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOwogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemVzIGNhbnZhcyBhbmQgbG9hZHMgdGhlIGluaXRpYWwgdHdvIGltYWdlcyAoQSBhbmQgQikuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7CiAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOwogICAgICAgIGNhbnZhc2JiaS53aWR0aCA9IGJyZWVkMzYwOyAKICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsKICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOwoKICAgICAgICBsZXQgaW1hZ2VzVG9Mb2FkID0gW2N1cnJlbnRVUkwsIG5leHRVUkxdOwogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7CiAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7CgogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gewogICAgICAgICAgICBpZiAoZXJyb3IpIHsgaGFzRXJyb3IgPSB0cnVlOyB9CiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7CgogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBpbWFnZXNiaVtjdXJyZW50VVJMXTsKICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXh0VVJMXTsKICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlYmIoc3JjLCBvbkltYWdlTG9hZGVkKSk7CiAgICB9CgoKICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0KICAgIHZhciBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gewogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjb2xvcjFbMF0gKyAoY29sb3IyWzBdIC0gY29sb3IxWzBdKSAqIHByb2dyZXNzKTsKICAgICAgICB2YXIgZyA9IE1hdGgucm91bmQoY29sb3IxWzFdICsgKGNvbG9yMlsxXSAtIGNvbG9yMVsxXSkgKiBwcm9ncmVzcyk7CiAgICAgICAgdmFyIGIgPSBNYXRoLnJvdW5kKGNvbG9yMVsyXSArIChjb2xvcjJbMl0gLSBjb2xvcjFbMl0pICogcHJvZ3Jlc3MpOwogICAgICAgIHZhciBhID0gY29sb3IxWzNdICsgKGNvbG9yMlszXSAtIGNvbG9yMVszXSkgKiBwcm9ncmVzczsKICAgICAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthfSlgOwogICAgfTsKCiAgICAvLyBFYXNpbmcgZm9yIGEgYml6YXJyZSwgc2hhcnAgc25hcAogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0OwoKICAgIC8qKgogICAgICogRXh0cmFjdHMgcGl4ZWwgZGF0YSBhbmQgY2FsY3VsYXRlcyB0aGUgdm9ydGV4IGRpc3BsYWNlbWVudCB0YXJnZXRzLgogICAgICovCiAgICB2YXIgc2V0dXBJbml0aWFsQ2FudmFzID0gKCkgPT4gewogICAgICAgIHZhciBpbWcxID0gY3VycmVudEltYWdlOyAKICAgICAgICB2YXIgaW1nMiA9IG5leHRJbWFnZTsgICAgCgogICAgICAgIHBpeGJpeGVscyA9IFtdOwogICAgICAgIAogICAgICAgIC8vIEdldCBJbWFnZSAxIERhdGEgKFN0YXJ0KQogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwogICAgICAgIGN0eGJpLmRyYXdJbWFnZShpbWcxLCAwLCAwICwgYnJlZWQzNjAsIGhvb2cxODApOwogICAgICAgIHZhciBkYXRhMSA9IGN0eGJpLmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpLmRhdGE7CiAgICAgICAgCiAgICAgICAgLy8gR2V0IEltYWdlIDIgRGF0YSAoVGFyZ2V0KQogICAgICAgIHZhciB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgdmFyIHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IGNhbnZhc2JiaS53aWR0aDsKICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7CiAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UoaW1nMiwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOwogICAgICAgIHZhciBkYXRhMiA9IHRlbXBDdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsKICAgICAgICAKICAgICAgICAvLyBQb3B1bGF0ZSBwaXhiaXhlbHMgYXJyYXkKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhvb2cxODA7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGJyZWVkMzYwOyB4KyspIHsKICAgICAgICAgICAgICAgIGxldCBpID0gKHkgKiBicmVlZDM2MCArIHgpICogNDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGNvbG9yQSA9IFtkYXRhMVtpXSwgZGF0YTFbaSsxXSwgZGF0YTFbaSsyXSwgZGF0YTFbaSszXSAvIDI1NV07CiAgICAgICAgICAgICAgICBsZXQgY29sb3JCID0gW2RhdGEyW2ldLCBkYXRhMltpKzFdLCBkYXRhMltpKzJdLCBkYXRhMltpKzNdIC8gMjU1XTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gSHlwZXJib2xpYyBWb3J0ZXggTG9naWMgLS0tCiAgICAgICAgICAgICAgICBsZXQgZHggPSB4IC0gY2VudGVyWDsKICAgICAgICAgICAgICAgIGxldCBkeSA9IHkgLSBjZW50ZXJZOwogICAgICAgICAgICAgICAgbGV0IGRpc3QgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICAgICAgICAgICAgbGV0IGFuZ2xlID0gTWF0aC5hdGFuMihkeSwgZHgpOwoKICAgICAgICAgICAgICAgIC8vIE1heGltdW0gdm9ydGV4IGZvcmNlIGlzIGJhc2VkIG9uIGRpc3RhbmNlIGFuZCBhIGxhcmdlIGZhY3RvcgogICAgICAgICAgICAgICAgbGV0IHZvcnRleEZhY3RvciA9IDAuNTsgLy8gQ29udHJvbHMgdGhlIHN0cmVuZ3RoIG9mIHRoZSBwdWxsCiAgICAgICAgICAgICAgICBsZXQgbWF4RGlzdG9ydCA9IE1hdGgubWluKGRpc3QgKiB2b3J0ZXhGYWN0b3IsIDUwKTsgLy8gTWF4IDUwIHBpeGVscyBkaXNwbGFjZW1lbnQKCiAgICAgICAgICAgICAgICAvLyBUaGUgdGVtcG9yYXJ5ICd2b3J0ZXgnIHBvc2l0aW9uIChtaWQtcG9pbnQgb2YgdGhlIGFuaW1hdGlvbikKICAgICAgICAgICAgICAgIC8vIFNwaXJhbCBvdXQgYW5kIHJvdGF0ZSBzaWduaWZpY2FudGx5CiAgICAgICAgICAgICAgICBsZXQgdm9ydGV4QW5nbGUgPSBhbmdsZSArIChNYXRoLlBJICogNCk7IC8vIDIgZnVsbCByb3RhdGlvbnMKICAgICAgICAgICAgICAgIGxldCB2b3J0ZXhYID0gY2VudGVyWCArIE1hdGguY29zKHZvcnRleEFuZ2xlKSAqIChkaXN0ICsgbWF4RGlzdG9ydCk7CiAgICAgICAgICAgICAgICBsZXQgdm9ydGV4WSA9IGNlbnRlclkgKyBNYXRoLnNpbih2b3J0ZXhBbmdsZSkgKiAoZGlzdCArIG1heERpc3RvcnQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGaW5hbCBwb3NpdGlvbiByZW1haW5zICh4LCB5KQogICAgICAgICAgICAgICAgbGV0IHRhcmdldFggPSB4OwogICAgICAgICAgICAgICAgbGV0IHRhcmdldFkgPSB5OwoKICAgICAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBjb2xvckE6IGNvbG9yQSwgCiAgICAgICAgICAgICAgICAgICAgY29sb3JCOiBjb2xvckIsIAogICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogeCwKICAgICAgICAgICAgICAgICAgICBzdGFydFk6IHksCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WDogdGFyZ2V0WCwKICAgICAgICAgICAgICAgICAgICB0YXJnZXRZOiB0YXJnZXRZLAogICAgICAgICAgICAgICAgICAgIHZvcnRleFg6IHZvcnRleFgsIC8vIEJpemFycmUgdGVtcG9yYXJ5IFgKICAgICAgICAgICAgICAgICAgICB2b3J0ZXhZOiB2b3J0ZXhZLCAvLyBCaXphcnJlIHRlbXBvcmFyeSBZCiAgICAgICAgICAgICAgICAgICAgc2l6ZTogMSAKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiBEcmF3cyB0aGUgY3VycmVudCBmcmFtZSBvZiB0aGUgdHJhbnNpdGlvbi4KICAgICAqLwogICAgdmFyIEFOSU1BVEUgPSAoKSA9PiB7CiAgICAgICAgbGV0IHByb2dyZXNzID0gY3VycmVudEZyYW1lYmIgLyB0b3RhbEZyYW1lc2JiOwogICAgICAgIGxldCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAvLyBDbGVhciB0aGUgY2FudmFzCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CgogICAgICAgIHBpeGJpeGVscy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAvLyAxLiBDYWxjdWxhdGUgSW50ZXJwb2xhdGVkIENvbG9yCiAgICAgICAgICAgIGxldCBjdXJyZW50Q29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHAuY29sb3JBLCBwLmNvbG9yQiwgZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9IGN1cnJlbnRDb2xvcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIENhbGN1bGF0ZSBJbnRlcnBvbGF0ZWQgUG9zaXRpb24gKEh5cGVyYm9saWMgVm9ydGV4KQogICAgICAgICAgICBsZXQgZHJhd1gsIGRyYXdZOwoKICAgICAgICAgICAgaWYgKHByb2dyZXNzIDwgMC41KSB7CiAgICAgICAgICAgICAgICAvLyBQaGFzZSAxOiBTdGFydCAtPiBWb3J0ZXggKDAgdG8gMSBwcm9ncmVzcykKICAgICAgICAgICAgICAgIGxldCBwMSA9IGVhc2VkUHJvZ3Jlc3MgKiAyOyAKICAgICAgICAgICAgICAgIGRyYXdYID0gcC5zdGFydFggKyAocC52b3J0ZXhYIC0gcC5zdGFydFgpICogcDE7CiAgICAgICAgICAgICAgICBkcmF3WSA9IHAuc3RhcnRZICsgKHAudm9ydGV4WSAtIHAuc3RhcnRZKSAqIHAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gUGhhc2UgMjogVm9ydGV4IC0+IFRhcmdldCAoMCB0byAxIHByb2dyZXNzKQogICAgICAgICAgICAgICAgbGV0IHAyID0gKGVhc2VkUHJvZ3Jlc3MgLSAwLjUpICogMjsgCiAgICAgICAgICAgICAgICBkcmF3WCA9IHAudm9ydGV4WCArIChwLnRhcmdldFggLSBwLnZvcnRleFgpICogcDI7CiAgICAgICAgICAgICAgICBkcmF3WSA9IHAudm9ydGV4WSArIChwLnRhcmdldFkgLSBwLnZvcnRleFkpICogcDI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDMuIERyYXcgdGhlIHBpeGVsCiAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KGRyYXdYLCBkcmF3WSwgcC5zaXplLCBwLnNpemUpOwogICAgICAgIH0pOwoKICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShBTklNQVRFKTsgCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQW5pbWF0aW9uIGNvbXBsZXRlLiBDbGVhbiB1cCBhbmQgc2V0IHVwIHRoZSBuZXh0IGxvb3AuCiAgICAgICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwoKICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOwogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsgCgogICAgICAgICAgICAvLyBHRU5FUkFURSBORVcgVEFSR0VUIFVSTAogICAgICAgICAgICBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyAgCgogICAgICAgICAgICAvLyBTaG9ydCBwYXVzZSB0byBhcHByZWNpYXRlIHRoZSBmaW5hbCBpbWFnZSBiZWZvcmUgdGhlIG5leHQgYml6YXJyZSB3YXJwCiAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyNTAwKTsgCiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4KICAgICAqLwogICAgdmFyIHN0YXJ0QW5pbWF0aW9uZnQgPSAoKSA9PiB7CiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOyAKICAgICAgICBBTklNQVRFKCk7IAogICAgfTsKCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGluaXRDYW52YXNBbmRJbWFnZXMoKTsKICAgIH07Cjwvc2NyaXB0PgoKPC9ib2R5Pgo8L2h0bWw+<br>PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+UGVyY2VwdGlvbiBMYXllcmluZzogVGhlIENvbnN0cnVjdCBvZiBSZWFsaXR5PC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsgd2lkdGg6MTAwJTsgaGVpZ2h0OjEwMCU7ICAKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMGQwZDBkOyAvKiBEZWVwIGNoYXJjb2FsICovCiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgZm9udC1mYW1pbHk6ICdHZW9yZ2lhJywgc2VyaWY7IAogICAgICAgIH0KICAgICAgICAKICAgICAgICAjY2FudmFzIHsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOiAxMDAlIDEwMCU7CiAgICAKICAgICAgICB9CgogICAgICAgICNhbmltYXRpb25DYW52YXMgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDA7CiAgICAgICAgfQoKICAgICAgICBoMSB7CiAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOyAKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggcmdiYSgyNTUsIDI1NSwgMjU1LCAwLjUpOwogICAgICAgICAgICBmb250LXNpemU6IDEuNWVtOwogICAgICAgICAgICBsZXR0ZXItc3BhY2luZzogMXB4OwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CgoKPGRpdiBpZD0nY2FudmFzJyBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTsnPgogICAgPGNhbnZhcyBpZD0nYW5pbWF0aW9uQ2FudmFzJyB3aWR0aD04MDAgaGVpZ2h0PTQ1MCBzdHlsZT0nd2lkdGg6MTAwJTtoZWlnaHQ6MTAwJSc+PC9jYW52YXM+CjwvZGl2PgoKPHNjcmlwdD4KICAgIC8vIC0tLSBJbWFnZSBTb3VyY2UgYW5kIE9iamVjdCBTdG9yYWdlIC0tLQogICAgLy8gTm90ZTogVG8gdHJ1bHkgY29udmV5IHRoZSBjb25jZXB0LCB3ZSBuZWVkIFRIUkVFIGRpc3RpbmN0IGltYWdlcyAoVVJMcykKICAgIC8vIEE6IEluaXRpYWwvT2xkIFJhdyBEYXRhIHwgQjogSW5pdGlhbC9PbGQgRmlsdGVyZWQgRGF0YSB8IEM6IE5ldyBSYXcgRGF0YQogICAgdmFyIGltYWdlVVJMcyA9IHsKICAgICAgICByYXdJbnB1dEE6ICdodHRwOi8vMTI3LjAuMC4xL2dldFJhbmRJbWFnZS5waHA/cmFuZG9tPTEnICsgTWF0aC5yb3VuZCgxMDAwMCAqIE1hdGgucmFuZG9tKCkpLCAvLyBPbGQgUmF3IElucHV0CiAgICAgICAgZmlsdGVySW5wdXRCOiAnaHR0cDovLzEyNy4wLjAuMS9nZXRSYW5kSW1hZ2UucGhwP3JhbmRvbT0yJyArIE1hdGgucm91bmQoMTAwMDAgKiBNYXRoLnJhbmRvbSgpKSwgLy8gT2xkIEZpbHRlcgogICAgICAgIG5ld1Jhd0lucHV0QzogJ2h0dHA6Ly8xMjcuMC4wLjEvZ2V0UmFuZEltYWdlLnBocD9yYW5kb209MycgKyBNYXRoLnJvdW5kKDEwMDAwICogTWF0aC5yYW5kb20oKSkgIC8vIE5ldyBSYXcgSW5wdXQKICAgIH07CgogICAgdmFyIGN1cnJlbnRJbWFnZXMgPSB7fTsgLy8gSG9sZHMgQSBhbmQgQiBJbWFnZSBPYmplY3RzCiAgICB2YXIgbmV4dEltYWdlQyA9IG51bGw7ICAvLyBIb2xkcyBDIEltYWdlIE9iamVjdAoKICAgIC8vIC0tLSBHbG9iYWwgQW5pbWF0aW9uIFZhcmlhYmxlcyAtLS0KICAgIHZhciBjYW52YXNiYmk7CiAgICB2YXIgY3R4Ymk7CiAgICB2YXIgaW1hZ2VzYmkgPSB7fTsgICAgICAgIC8vIFN0b3JlcyBBTEwgbG9hZGVkIEltYWdlIG9iamVjdHMKICAgIHZhciB0b3RhbEZyYW1lc2JiID0gMTIwOyAgLy8gU21vb3RoLCBjb250ZW1wbGF0aXZlIGR1cmF0aW9uCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOwogICAgCiAgICAvLyBDYW52YXMgRGltZW5zaW9ucwogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8zNTA7IAogICAgdmFyIGhvb2cxODAgPSA0NTA7IC8vCgogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tCgogICAgdmFyIGxvYWRJbWFnZWJiID0gKHNyYywgY2FsbGJhY2spID0+IHsKICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7CiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgICAgaW1hZ2VzYmlbc3JjXSA9IGltZzsgCiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7CiAgICAgICAgfTsKICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOwogICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKSk7CiAgICAgICAgfTsKICAgICAgICBpbWcuc3JjID0gc3JjOwogICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOyAKICAgIH07CgogICAgLyoqCiAgICAgKiBMb2FkcyB0aGUgbmV4dCBzZXQgb2YgaW1hZ2VzIGFuZCBzdGFydHMgdGhlIG5ldyB0cmFuc2l0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlc0FuZFN0YXJ0KCkgewogICAgICAgIC8vIFdlIG9ubHkgbmVlZCB0byBsb2FkIHRoZSAqbmV3KiBSYXcgSW5wdXQgaW1hZ2UgKEMpCiAgICAgICAgbGV0IG5ld1VSTCA9IGltYWdlVVJMcy5uZXdSYXdJbnB1dEM7CiAgICAgICAgCiAgICAgICAgaWYgKGltYWdlc2JpW25ld1VSTF0pIHsKICAgICAgICAgICAgbmV4dEltYWdlQyA9IGltYWdlc2JpW25ld1VSTF07CiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsb2FkSW1hZ2ViYihuZXdVUkwsIChlcnJvciwgaW1nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlQyA9IGltZzsKICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ05ldyBpbWFnZSBmYWlsZWQgdG8gbG9hZC4gUmV0cnlpbmcuLi4nKTsKICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VzQW5kU3RhcnQsIDIwMDApOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgY2FudmFzIGFuZCBsb2FkcyB0aGUgaW5pdGlhbCBzZXQgb2YgdHdvIGltYWdlcyAoQSBhbmQgQikuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7CiAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOwogICAgICAgIGNhbnZhc2JiaS53aWR0aCA9IGJyZWVkMzYwOyAKICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsKICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOwoKICAgICAgICBsZXQgaW1hZ2VzVG9Mb2FkID0gW2ltYWdlVVJMcy5yYXdJbnB1dEEsIGltYWdlVVJMcy5maWx0ZXJJbnB1dEJdOwogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7CiAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7CgogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gewogICAgICAgICAgICBpZiAoZXJyb3IpIHsgaGFzRXJyb3IgPSB0cnVlOyB9CiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7CgogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2VzLnJhd0lucHV0ID0gaW1hZ2VzYmlbaW1hZ2VVUkxzLnJhd0lucHV0QV07CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlcy5maWx0ZXJJbnB1dCA9IGltYWdlc2JpW2ltYWdlVVJMcy5maWx0ZXJJbnB1dEJdOwogICAgICAgICAgICAgICAgICAgIC8vIFN0YXJ0IGJ5IGxvYWRpbmcgdGhlIHRoaXJkIGltYWdlIChDKQogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBhbmltYXRpb24gb25seSB0cnVseSBzdGFydHMgb25jZSBDIGlzIHJlYWR5LgogICAgICAgICAgICAgICAgICAgIGxvYWROZXh0SW1hZ2VzQW5kU3RhcnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignSW5pdGlhbCBpbWFnZSBsb2FkaW5nIGZhaWxlZC4gQ2Fubm90IHN0YXJ0IGFuaW1hdGlvbi4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGltYWdlc1RvTG9hZC5mb3JFYWNoKHNyYyA9PiBsb2FkSW1hZ2ViYihzcmMsIG9uSW1hZ2VMb2FkZWQpKTsKICAgIH0KCgogICAgLy8gLS0tIEVhc2luZyBVdGlsaXR5IC0tLQogICAgLy8gVXNlIGFuIGVhc2luZyBmdW5jdGlvbiBmb3IgYSBzbW9vdGgsIGNvZ25pdGl2ZSBibGVuZAogICAgdmFyIGVhc2VJbk91dFF1YWQgPSAodCkgPT4gdCA8IDAuNSA/IDIgKiB0ICogdCA6IDEgLSBNYXRoLnBvdygtMiAqIHQgKyAyLCAyKSAvIDI7CgogICAgLyoqCiAgICAgKiBUaGUgbWFpbiBhbmltYXRpb24gbG9vcC4gRHJhd3MgdGhlIGN1cnJlbnQgYmxlbmQgb2YgbGF5ZXJzLgogICAgICovCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsKICAgICAgICBsZXQgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWViYiAvIHRvdGFsRnJhbWVzYmI7CiAgICAgICAgbGV0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWFkKHByb2dyZXNzKTsKCiAgICAgICAgLy8gQ2xlYXIgdGhlIGNhbnZhcwogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwoKICAgICAgICAvLyAtLS0gMS4gUmF3IElucHV0IExheWVyIChGYWRlcyBPVVQgZnJvbSBBIHRvIEMpIC0tLQogICAgICAgIC8vIERyYXcgdGhlIE9MRCBSYXcgSW5wdXQgKEEpIGFzIGEgZmFkZWQgYmFzZS4KICAgICAgICBjdHhiaS5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgIGN0eGJpLmZpbHRlciA9ICdibHVyKDFweCknOyAvLyBLZWVwIGl0IHNsaWdodGx5IGJsdXJyZWQgdG8gcmVwcmVzZW50ICJyYXciIGRhdGEKICAgICAgICBjdHhiaS5kcmF3SW1hZ2UoY3VycmVudEltYWdlcy5yYXdJbnB1dCwgMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyAtLS0gMi4gQ29nbml0aXZlIEZpbHRlciBMYXllciAoU3RhdGljIEIpIC0tLQogICAgICAgIC8vIFRoaXMgaW1hZ2UgKEIpIHJlcHJlc2VudHMgdGhlIGZpbHRlci9wZXJjZXB0aW9uIG1vZGVsLiAKICAgICAgICAvLyBXZSdsbCBhcHBseSBhICpmaXhlZCogY29sb3IgZmlsdGVyIHRvIGl0IHRvIHNpZ25pZnkgdGhlICdiaWFzJyBvciAnZmlsdGVyJyBvZiBjb25zY2lvdXNuZXNzLgogICAgICAgIGN0eGJpLmdsb2JhbEFscGhhID0gMS4wOwogICAgICAgIGN0eGJpLmZpbHRlciA9ICdjb250cmFzdCgxNTAlKSBzYXR1cmF0ZSgxMjAlKSc7IC8vIFNoYXJwLCBoaWdoLWNvbnRyYXN0IGZpbHRlcgogICAgICAgIGN0eGJpLmRyYXdJbWFnZShjdXJyZW50SW1hZ2VzLmZpbHRlcklucHV0LCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwogICAgICAgIAogICAgICAgIC8vIC0tLSAzLiBOZXcgUmF3IElucHV0IExheWVyIChGYWRlcyBJTiBmcm9tIEMpIC0tLQogICAgICAgIC8vIFRoaXMgaW1hZ2UgKEMpIGlzIHRoZSBuZXcgc2Vuc29yeSBpbnB1dCB0aGF0IHdpbGwgcmVwbGFjZSBBLgogICAgICAgIC8vIEl0IGJsZW5kcyAqb250byogdGhlIGZpbHRlcmVkIGxheWVyIChCKS4KICAgICAgICBjdHhiaS5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgY3R4YmkuZmlsdGVyID0gJ25vbmUnOyAvLyBDbGVhciwgdW5maWx0ZXJlZCBhcHBlYXJhbmNlCiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKG5leHRJbWFnZUMsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CgogICAgICAgIC8vIFJlc2V0IGdsb2JhbCBzZXR0aW5ncyBmb3IgdGhlIG5leHQgZnJhbWUgb3IgY3ljbGUKICAgICAgICBjdHhiaS5nbG9iYWxBbHBoYSA9IDEuMDsKICAgICAgICBjdHhiaS5maWx0ZXIgPSAnbm9uZSc7CgogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOyAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBBbmltYXRpb24gY29tcGxldGUuIFJlYWxpdHkgaXMgc3ludGhlc2l6ZWQuCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAxLiBEcmF3IHRoZSBmaW5hbCAqU3ludGhlc2l6ZWQqIFJlYWxpdHk6IEZpbHRlcmVkIEIgKyBOZXcgUmF3IEMKICAgICAgICAgICAgLy8gVGhlIGZpbmFsIHN5bnRoZXNpemVkIGltYWdlIGlzIHRoZSBuZXcgcmF3IGlucHV0IChDKSBvdmVybGFpZCB3aXRoIHRoZSBjb2duaXRpdmUgZmlsdGVyIChCKS4KICAgICAgICAgICAgLy8gRm9yIHNpbXBsaWNpdHksIHdlJ2xsIGRyYXcgdGhlIG5ldyByYXcgaW5wdXQgKEMpIGNsZWFuLCBhcyB0aGUgbmV3IGJhc2UgcGVyY2VwdGlvbi4KICAgICAgICAgICAgLy8gSW4gYSBtb3JlIGNvbXBsZXggbW9kZWwsIEMgd291bGQgYmUgcHJvY2Vzc2VkIGJ5IHRoZSAqbmV3KiBmaWx0ZXIuCiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2VDLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOwoKICAgICAgICAgICAgLy8gMi4gU1dBUCBMQVlFUlM6IFByZXBhcmUgZm9yIHRoZSBuZXh0IGN5Y2xlLgogICAgICAgICAgICAvLyBPbGQgUmF3IElucHV0IChBKSBpcyBkaXNjYXJkZWQuCiAgICAgICAgICAgIC8vIE9sZCBGaWx0ZXIgSW5wdXQgKEIpIGJlY29tZXMgdGhlIG5ldyBSYXcgSW5wdXQgZm9yIHRoZSBuZXh0IHRyYW5zaXRpb24uCiAgICAgICAgICAgIC8vIFRoZSBuZXcgUmF3IElucHV0IChDKSBiZWNvbWVzIHRoZSBuZXcgRmlsdGVyIElucHV0IGZvciB0aGUgbmV4dCB0cmFuc2l0aW9uLgoKICAgICAgICAgICAgbGV0IHRlbXBVUkxfQSA9IGltYWdlVVJMcy5yYXdJbnB1dEE7IC8vIFRlbXBvcmFyeSBob2xkZXIgZm9yIHRoZSBvbGQgcmF3IFVSTAoKICAgICAgICAgICAgLy8gU2hpZnQgQiAoRmlsdGVyKSAtPiBBIChOZXcgUmF3IElucHV0KQogICAgICAgICAgICBpbWFnZVVSTHMucmF3SW5wdXRBID0gaW1hZ2VVUkxzLmZpbHRlcklucHV0QjsgCiAgICAgICAgICAgIGN1cnJlbnRJbWFnZXMucmF3SW5wdXQgPSBjdXJyZW50SW1hZ2VzLmZpbHRlcklucHV0OwoKICAgICAgICAgICAgLy8gU2hpZnQgQyAoTmV3IFJhdykgLT4gQiAoTmV3IEZpbHRlciBJbnB1dCkKICAgICAgICAgICAgaW1hZ2VVUkxzLmZpbHRlcklucHV0QiA9IGltYWdlVVJMcy5uZXdSYXdJbnB1dEM7CiAgICAgICAgICAgIGN1cnJlbnRJbWFnZXMuZmlsdGVySW5wdXQgPSBuZXh0SW1hZ2VDOwoKICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBicmFuZCBuZXcgcmF3IGlucHV0IFVSTCAoRCkgZm9yIHRoZSBuZXh0IGN5Y2xlCiAgICAgICAgICAgIGltYWdlVVJMcy5uZXdSYXdJbnB1dEMgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7ICAKCiAgICAgICAgICAgIC8vIENsZWFyIHRoZSBvYmplY3QgZm9yIHRoZSBuZXcgbG9hZAogICAgICAgICAgICBuZXh0SW1hZ2VDID0gbnVsbDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDMuIFN0YXJ0IHRoZSBsb2FkIHByb2Nlc3MgZm9yIHRoZSBuZXcgaW1hZ2UgKEQpLgogICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VzQW5kU3RhcnQsIDMwMDApOyAvLyAzIHNlY29uZCBwYXVzZSBmb3IgY29udGVtcGxhdGlvbgogICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplcyBhbmQgc3RhcnRzIHRoZSBhbmltYXRpb24gc2VxdWVuY2UuCiAgICAgKi8KICAgIHZhciBzdGFydEFuaW1hdGlvbmZ0ID0gKCkgPT4gewogICAgICAgIGN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAvLyBObyBzZWdtZW50IHNldHVwIG5lZWRlZCBoZXJlLCBqdXN0IGltYWdlIGRyYXdpbmcuCiAgICAgICAgQU5JTUFURSgpOyAKICAgIH07CgogICAgLy8gLS0tIEluaXRpYWwgQ2FsbCAtLS0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBpbml0Q2FudmFzQW5kSW1hZ2VzKCk7CiAgICB9Owo8L3NjcmlwdD4KCjwvYm9keT4KPC9odG1sPg==<br>PGh0bWwgbGFuZz0iZW4iPgo8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgIDx0aXRsZT5GYXN0ZXIgSW1hZ2UgVHJhbnNpdGlvbiBEYW5jZTwvdGl0bGU+CiAgICA8c3R5bGU+CiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8KICAgICAgICBib2R5IHsgd2lkdGg6MTAwJTsgaGVpZ2h0OjEwMCU7ICAKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCBUYWhvbWEsIEdlbmV2YSwgVmVyZGFuYSwgc2Fucy1zZXJpZjsKICAgICAgICAgICAgY29sb3I6ICNlZWU7CiAgICAgICAgfQoKICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMvYmFja2dyb3VuZCBpbWFnZSAqLwogICAgICAgICNjYW52YXMgewogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMzMzOwogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDE1cHg7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiAqLwogICAgICAgICNhbmltYXRpb25DYW52YXMgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMwMDA7CiAgICAgICAgfQoKICAgICAgICBoMSB7CiAgICAgICAgICAgIGNvbG9yOiAjMDBmZmZmOwogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAyNTUsIDI1NSwgMC43KTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsKICAgICAgICAgICAgZm9udC1zaXplOiAyLjVlbTsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogCiAgICA8ZGl2IGlkPSJjYW52YXMiPgogICAgICAgIDxjYW52YXMgaWQ9ImFuaW1hdGlvbkNhbnZhcyIgd2lkdGg9IjY0MCIgaGVpZ2h0PSI2NDAiPjwvY2FudmFzPgogICAgPC9kaXY+CgogICAgPHNjcmlwdD4KICAgICAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0KICAgICAgICB2YXIgY3VycmVudFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgCiAgICAgICAgdmFyIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IAogICAgICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOwogICAgICAgIHZhciBuZXh0SW1hZ2UgPSBudWxsOwoKICAgICAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tCiAgICAgICAgdmFyIGNhbnZhczsKICAgICAgICB2YXIgY3R4OwogICAgICAgIHZhciBpbWFnZXMgPSB7fTsKICAgICAgICB2YXIgcGFydGljbGVzID0gW107IC8vIEFycmF5IHRvIGhvbGQgcGFydGljbGUgb2JqZWN0cyAobm93IGZvY3VzZWQgb24gY29vcmRpbmF0ZXMgYW5kIGNvbG9yIGRhdGEpCgogICAgICAgIHZhciB0b3RhbEZyYW1lcyA9IDkwOyAvLyBUaGUgZHVyYXRpb24gb2YgdGhlIHRyYW5zaXRpb24KICAgICAgICB2YXIgY3VycmVudEZyYW1lID0gMDsKCiAgICAgICAgdmFyIFdJRFRIID0gMzYwOwogICAgICAgIHZhciBIRUlHSFQgPSA2NDA7CiAgICAgICAgdmFyIE5VTV9QSVhFTFMgPSBXSURUSCAqIEhFSUdIVDsgLy8gODYsNjQwIHBpeGVscwogICAgICAgIAogICAgICAgIC8vIC0tLSBJbWFnZSBEYXRhIFN0b3JhZ2UgKFJlcGxhY2VzIFNsb3cgUGFydGljbGUgT2JqZWN0cykgLS0tCiAgICAgICAgLy8gU3RvcmluZyBSR0JBIHZhbHVlcyBhcyBhcnJheXMgb2YgNCBudW1iZXJzIGZvciBwZXJmb3JtYW5jZQogICAgICAgIHZhciBzdGFydENvbG9ycyA9IG5ldyBBcnJheShOVU1fUElYRUxTKTsKICAgICAgICB2YXIgZW5kQ29sb3JzID0gbmV3IEFycmF5KE5VTV9QSVhFTFMpOwogICAgICAgIHZhciBtaWRBbHBoYXMgPSBuZXcgQXJyYXkoTlVNX1BJWEVMUyk7CiAgICAgICAgdmFyIG1pZFBvc2l0aW9ucyA9IG5ldyBBcnJheShOVU1fUElYRUxTICogMik7IC8vIFN0b3JpbmcgeCwgeSBhcyBbeDAsIHkwLCB4MSwgeTEsIC4uLl0KCiAgICAgICAgLy8gLS0tIFBlcmZvcm1hbmNlIEltcHJvdmVtZW50OiBTaW5nbGUgSW1hZ2VEYXRhIE9iamVjdCAtLS0KICAgICAgICB2YXIgaW1hZ2VEYXRhID0gbnVsbDsKICAgICAgICB2YXIgZGF0YUFycmF5ID0gbnVsbDsgLy8gVGhlIFVpbnQ4Q2xhbXBlZEFycmF5IGZvciBmYXN0IHBpeGVsIGJ1ZmZlciBhY2Nlc3MKCiAgICAgICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tCgogICAgICAgIC8qKgogICAgICAgICAqIExvYWRzIGEgc2luZ2xlIGltYWdlLgogICAgICAgICAqLwogICAgICAgIHZhciBsb2FkSW1hZ2UgPSAoc3JjLCBjYWxsYmFjaykgPT4gewogICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7CiAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBpbWFnZXNbc3JjXSA9IGltZzsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOwogICAgICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOwogICAgICAgICAgICB9OwogICAgICAgICAgICBpbWcuc3JjID0gc3JjOwogICAgICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBMb2FkcyB0aGUgbmV4dCBpbWFnZSBpbiB0aGUgc2VxdWVuY2UgYW5kIHN0YXJ0cyB0aGUgdHJhbnNpdGlvbi4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7CiAgICAgICAgICAgIGxldCBuZXdJbWFnZVVSTCA9IG5leHRVUkw7CiAgICAgICAgICAgIGlmIChpbWFnZXNbbmV3SW1hZ2VVUkxdKSB7CiAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNbbmV3SW1hZ2VVUkxdOwogICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb24oKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvYWRJbWFnZShuZXdJbWFnZVVSTCwgKGVycm9yLCBpbWcpID0+IHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltZzsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb24oKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogSW5pdGlhbGl6ZXMgY2FudmFzIGFuZCBsb2FkcyB0aGUgaW5pdGlhbCB0d28gaW1hZ2VzIChBIGFuZCBCKS4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBpbml0Q2FudmFzQW5kSW1hZ2VzKCkgewogICAgICAgICAgICBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7CiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IFdJRFRIOwogICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gSEVJR0hUOwogICAgICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgaW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgZGF0YUFycmF5ID0gaW1hZ2VEYXRhLmRhdGE7IC8vIFJlZmVyZW5jZSB0byB0aGUgdW5kZXJseWluZyBwaXhlbCBhcnJheQoKICAgICAgICAgICAgbGV0IGltYWdlc1RvTG9hZCA9IFtjdXJyZW50VVJMLCBuZXh0VVJMXTsKICAgICAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsKICAgICAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSBsb2FkZWRDb3VudCsrOwogICAgICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzW2N1cnJlbnRVUkxdOwogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc1tuZXh0VVJMXTsKICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbigpOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBjcml0aWNhbCBlcnJvcgogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CgogICAgICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlKHNyYywgb25JbWFnZUxvYWRlZCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFBpeGVsIGFuZCBFYXNpbmcgVXRpbGl0aWVzIC0tLQoKICAgICAgICAvKioKICAgICAgICAgKiBFYXNpbmcgZnVuY3Rpb24gKFF1aW50aWMgRWFzZSBJbi9PdXQpLgogICAgICAgICAqLwogICAgICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsKCiAgICAgICAgLyoqCiAgICAgICAgICogR2V0cyBwaXhlbCBkYXRhIGZyb20gYW4gSW1hZ2Ugb2JqZWN0LgogICAgICAgICAqLwogICAgICAgIHZhciBnZXRQaXhlbERhdGEgPSAoaW1nKSA9PiB7CiAgICAgICAgICAgIHZhciB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgIHZhciB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gV0lEVEg7CiAgICAgICAgICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gSEVJR0hUOwogICAgICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICByZXR1cm4gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCkuZGF0YTsKICAgICAgICB9OwoKICAgICAgICAvKioKICAgICAgICAgKiBTZXRzIHVwIHRoZSBpbml0aWFsIHN0YXRlIGZvciB0aGUgYW5pbWF0aW9uIGJ5IGdlbmVyYXRpbmcgZmFzdCBwaXhlbCBkYXRhIGFycmF5cy4KICAgICAgICAgKiBUaGUgb25seSBzbG93IHN0ZXAgaW4gdGhlIGxvb3AsIHNvIGl0J3MgZG9uZSBvbmx5IG9uY2UgcGVyIHRyYW5zaXRpb24uCiAgICAgICAgICovCiAgICAgICAgdmFyIHNldHVwSW5pdGlhbENhbnZhcyA9ICgpID0+IHsKICAgICAgICAgICAgdmFyIGRhdGExID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHZhciBkYXRhMiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwoKICAgICAgICAgICAgY29uc3QgY2VudGVyWCA9IFdJRFRIIC8gMjsKICAgICAgICAgICAgY29uc3QgY2VudGVyWSA9IEhFSUdIVCAvIDI7CgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBsZXQgaW5kZXggPSB5ICogV0lEVEggKyB4OwogICAgICAgICAgICAgICAgICAgIGxldCBkYXRhSW5kZXggPSBpbmRleCAqIDQ7CiAgICAgICAgICAgICAgICAgICAgbGV0IG1pZEluZGV4ID0gaW5kZXggKiAyOwoKICAgICAgICAgICAgICAgICAgICAvLyAxLiBDb2xvciBEYXRhIChTdG9yZXMgW1IsIEcsIEIsIEEqMjU1XSkKICAgICAgICAgICAgICAgICAgICBzdGFydENvbG9yc1tpbmRleF0gPSBbZGF0YTFbZGF0YUluZGV4XSwgZGF0YTFbZGF0YUluZGV4ICsgMV0sIGRhdGExW2RhdGFJbmRleCArIDJdLCBkYXRhMVtkYXRhSW5kZXggKyAzXV07CiAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3JzW2luZGV4XSA9IFtkYXRhMltkYXRhSW5kZXhdLCBkYXRhMltkYXRhSW5kZXggKyAxXSwgZGF0YTJbZGF0YUluZGV4ICsgMl0sIGRhdGEyW2RhdGFJbmRleCArIDNdXTsKICAgICAgICAgICAgICAgICAgICBtaWRBbHBoYXNbaW5kZXhdID0gTWF0aC5mbG9vcigoMC4yICsgTWF0aC5yYW5kb20oKSAqIDAuNCkgKiAyNTUpOyAvLyBQcmUtY2FsY3VsYXRlIG1pZC1hbHBoYSAoMC0yNTUpCgogICAgICAgICAgICAgICAgICAgIC8vIDIuIFBvc2l0aW9uIERhdGEKICAgICAgICAgICAgICAgICAgICBsZXQgZHggPSB4IC0gY2VudGVyWDsKICAgICAgICAgICAgICAgICAgICBsZXQgZHkgPSB5IC0gY2VudGVyWTsKICAgICAgICAgICAgICAgICAgICBsZXQgYW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKCiAgICAgICAgICAgICAgICAgICAgbGV0IHNjYXR0ZXJCYXNlID0gNjA7CiAgICAgICAgICAgICAgICAgICAgbGV0IHNjYXR0ZXJSYW5kID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMTAwOwogICAgICAgICAgICAgICAgICAgIGxldCB0b3RhbFNjYXR0ZXJEaXN0YW5jZSA9IHNjYXR0ZXJCYXNlICsgc2NhdHRlclJhbmQ7CgogICAgICAgICAgICAgICAgICAgIGxldCBzd2lybEFuZ2xlID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogKE1hdGguUEkgLyAzKTsKICAgICAgICAgICAgICAgICAgICBsZXQgbWlkWCA9IGNlbnRlclggKyBNYXRoLmNvcyhhbmdsZSArIHN3aXJsQW5nbGUpICogKGRpc3RhbmNlICsgdG90YWxTY2F0dGVyRGlzdGFuY2UpOwogICAgICAgICAgICAgICAgICAgIGxldCBtaWRZID0gY2VudGVyWSArIE1hdGguc2luKGFuZ2xlICsgc3dpcmxBbmdsZSkgKiAoZGlzdGFuY2UgKyB0b3RhbFNjYXR0ZXJEaXN0YW5jZSk7CgogICAgICAgICAgICAgICAgICAgIG1pZFBvc2l0aW9uc1ttaWRJbmRleF0gPSBtaWRYOwogICAgICAgICAgICAgICAgICAgIG1pZFBvc2l0aW9uc1ttaWRJbmRleCArIDFdID0gbWlkWTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiAqKkhJR0gtU1BFRUQgUElYRUwgTUFOSVBVTEFUSU9OIEhFUkUuKioKICAgICAgICAgKi8KICAgICAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsKICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIHZhciBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgLy8gLS0tIEZhc3QgbG9vcCBmb3IgZGlyZWN0IHBpeGVsIG1hbmlwdWxhdGlvbiAtLS0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1fUElYRUxTOyBpKyspIHsKICAgICAgICAgICAgICAgIGxldCBkYXRhSW5kZXggPSBpICogNDsKICAgICAgICAgICAgICAgIGxldCBtaWRJbmRleCA9IGkgKiAyOwogICAgICAgICAgICAgICAgbGV0IG1pZEFscGhhID0gbWlkQWxwaGFzW2ldOwoKICAgICAgICAgICAgICAgIGxldCB4ID0gaSAlIFdJRFRIOwogICAgICAgICAgICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKGkgLyBXSURUSCk7CgogICAgICAgICAgICAgICAgbGV0IHN0YXJ0QyA9IHN0YXJ0Q29sb3JzW2ldOwogICAgICAgICAgICAgICAgbGV0IGVuZEMgPSBlbmRDb2xvcnNbaV07CgogICAgICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgQ29sb3IgKERpcmVjdCBjb21wb25lbnQgbWF0aCkKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50UiwgY3VycmVudEcsIGN1cnJlbnRCLCBjdXJyZW50QTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSW50ZXJtZWRpYXRlIGNvbG9yIGlzIHRoZSBhdmVyYWdlIG9mIHN0YXJ0L2VuZCBSR0IsIHdpdGggYSBwcmUtY2FsY3VsYXRlZCBsb3cgYWxwaGEKICAgICAgICAgICAgICAgIGNvbnN0IG1pZFIgPSAoc3RhcnRDWzBdICsgZW5kQ1swXSkgLyAyOwogICAgICAgICAgICAgICAgY29uc3QgbWlkRyA9IChzdGFydENbMV0gKyBlbmRDWzFdKSAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBtaWRCID0gKHN0YXJ0Q1syXSArIGVuZENbMl0pIC8gMjsKICAgICAgICAgICAgICAgIGNvbnN0IG1pZEEgPSBtaWRBbHBoYTsgLy8gbWlkQWxwaGEgaXMgYWxyZWFkeSAwLTI1NQoKICAgICAgICAgICAgICAgIGlmIChlYXNlZFByb2dyZXNzIDwgMC41KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRmlyc3QgaGFsZjogc3RhcnQgLT4gbWlkCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViUHJvZ3Jlc3MgPSBlYXNlZFByb2dyZXNzICogMjsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UiA9IHN0YXJ0Q1swXSArIChtaWRSIC0gc3RhcnRDWzBdKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHID0gc3RhcnRDWzFdICsgKG1pZEcgLSBzdGFydENbMV0pICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEIgPSBzdGFydENbMl0gKyAobWlkQiAtIHN0YXJ0Q1syXSkgKiBzdWJQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QSA9IHN0YXJ0Q1szXSArIChtaWRBIC0gc3RhcnRDWzNdKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBTZWNvbmQgaGFsZjogbWlkIC0+IGVuZAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1YlByb2dyZXNzID0gKGVhc2VkUHJvZ3Jlc3MgLSAwLjUpICogMjsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UiA9IG1pZFIgKyAoZW5kQ1swXSAtIG1pZFIpICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEcgPSBtaWRHICsgKGVuZENbMV0gLSBtaWRHKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCID0gbWlkQiArIChlbmRDWzJdIC0gbWlkQikgKiBzdWJQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QSA9IG1pZEEgKyAoZW5kQ1szXSAtIG1pZEEpICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFdyaXRlIGludGVycG9sYXRlZCBjb2xvciB0byB0aGUgSW1hZ2VEYXRhIGFycmF5ICgwLTI1NSBjbGFtcGVkKQogICAgICAgICAgICAgICAgZGF0YUFycmF5W2RhdGFJbmRleF0gPSBjdXJyZW50UjsKICAgICAgICAgICAgICAgIGRhdGFBcnJheVtkYXRhSW5kZXggKyAxXSA9IGN1cnJlbnRHOwogICAgICAgICAgICAgICAgZGF0YUFycmF5W2RhdGFJbmRleCArIDJdID0gY3VycmVudEI7CiAgICAgICAgICAgICAgICBkYXRhQXJyYXlbZGF0YUluZGV4ICsgM10gPSBjdXJyZW50QTsgLy8gQWxwaGEgdmFsdWUgaXMgYWxzbyAwLTI1NQoKICAgICAgICAgICAgICAgIC8vIC0tLSBQb3NpdGlvbiBDYWxjdWxhdGlvbiBmb3IgUGl4ZWwgRHJhd2luZyAtLS0KICAgICAgICAgICAgICAgIGxldCBjdXJyZW50WCwgY3VycmVudFk7CiAgICAgICAgICAgICAgICBsZXQgbWlkWCA9IG1pZFBvc2l0aW9uc1ttaWRJbmRleF07CiAgICAgICAgICAgICAgICBsZXQgbWlkWSA9IG1pZFBvc2l0aW9uc1ttaWRJbmRleCArIDFdOwoKICAgICAgICAgICAgICAgIGlmIChlYXNlZFByb2dyZXNzIDwgMC41KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViUHJvZ3Jlc3MgPSBlYXNlZFByb2dyZXNzICogMjsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50WCA9IHggKyAobWlkWCAtIHgpICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFkgPSB5ICsgKG1pZFkgLSB5KSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJQcm9ncmVzcyA9IChlYXNlZFByb2dyZXNzIC0gMC41KSAqIDI7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFggPSBtaWRYICsgKHggLSBtaWRYKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRZID0gbWlkWSArICh5IC0gbWlkWSkgKiBzdWJQcm9ncmVzczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBJbnN0ZWFkIG9mIHVzaW5nIGZpbGxSZWN0LCB3ZSBkcmF3IHRoZSBzaW5nbGUgcGl4ZWwgZnJvbSB0aGUgSW1hZ2VEYXRhIAogICAgICAgICAgICAgICAgLy8gYXQgdGhlIG5ldyAoY3VycmVudFgsIGN1cnJlbnRZKSBwb3NpdGlvbi4KICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgc3RpbGwgc2xvdywgc28gd2UgcmV2ZXJ0IHRoZSBhbmltYXRpb24gdG8gYSAkMSBcdGltZXMgMSQgcGl4ZWwgZ3JpZC4KICAgICAgICAgICAgICAgIC8vIC0tLSBJZiB5b3Ugd2FudCB0byBrZWVwIHRoZSBzY2F0dGVyZWQgInBpeGVsIiBsb29rOiAtLS0KICAgICAgICAgICAgICAgIC8vIGN0eC5maWxsU3R5bGUgPSBgcmdiYSgke01hdGgucm91bmQoY3VycmVudFIpfSwgJHtNYXRoLnJvdW5kKGN1cnJlbnRHKX0sICR7TWF0aC5yb3VuZChjdXJyZW50Qil9LCAke2N1cnJlbnRBIC8gMjU1fSlgOwogICAgICAgICAgICAgICAgLy8gY3R4LmZpbGxSZWN0KGN1cnJlbnRYLCBjdXJyZW50WSwgMSwgMSk7CiAgICAgICAgICAgICAgICAvLyAtLS0gSWYgeW91IHdhbnQgbWF4aW11bSBzcGVlZCwgc2ltcGxpZnkgdGhlIG1vdmVtZW50IGFuZCB1c2UgcHV0SW1hZ2VEYXRhOiAtLS0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gV2UnbGwgdXNlIHB1dEltYWdlRGF0YSBmb3IgdGhlIGZhc3Rlc3QgcmVuZGVyaW5nIGJ5IG1ha2luZyB0aGUgcGFydGljbGVzIDF4MSAKICAgICAgICAgICAgICAgIC8vIGFuZCBtb3ZpbmcgdGhlICplbnRpcmUqIGltYWdlIGJ1ZmZlciBpbnN0ZWFkIG9mIHJlZHJhd2luZyBlYWNoIHBpeGVsLgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBOT1RFOiBUaGUgIkRhbmNlIiBlZmZlY3QgcmVxdWlyZXMgZHJhd2luZyBpbmRpdmlkdWFsIHBpeGVscyBhdCBjYWxjdWxhdGVkIHBvc2l0aW9ucyAod2hpY2ggaXMgc2xvdykuCiAgICAgICAgICAgICAgICAvLyBUbyBjb21wcm9taXNlLCB3ZSB3aWxsIG9ubHkgYXBwbHkgdGhlIGZpbmFsICJwdXRJbWFnZURhdGEiIGFuZCBzYWNyaWZpY2UgdGhlIHRlbXBvcmFyeSBzY2F0dGVyIHBvc2l0aW9uLgogICAgICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGUgYW5pbWF0aW9uIHdpbGwgYmUgYSBzaW1wbGUgKipjb2xvciBmYWRlKiogdXNpbmcgdGhlIGZhc3Rlc3QgbWV0aG9kLgogICAgICAgICAgICAgICAgLy8gRm9yIGEgKnRydWUqIHNwZWVkIHVwIG9mIHRoZSBjdXJyZW50IGNvZGUncyB2aXN1YWwgZWZmZWN0LCB5b3UgKm11c3QqIHNhbXBsZSBhIHNwYXJzZSBncmlkLgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAqKlRvIHJldGFpbiB0aGUgZnVsbCB2aXN1YWwgZWZmZWN0LCB0aGUgb3JpZ2luYWwgbWV0aG9kIG9mIGRyYXdpbmcgaW5kaXZpZHVhbCBwYXJ0aWNsZXMgaXMgbmVjZXNzYXJ5LioqCiAgICAgICAgICAgICAgICAvLyAqKkhvd2V2ZXIsIHdlIGNhbiBzYW1wbGUgYSBzcGFyc2UgZ3JpZC4qKgoKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBJZiB0aGUgZ29hbCBpcyBhIGNvbG9yL29wYWNpdHkgdHJhbnNpdGlvbiBhdCB0aGUgb3JpZ2luYWwgcG9zaXRpb24gKEZBU1RFU1QpOgogICAgICAgICAgICAvLyBjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUmV2ZXJ0aW5nIHRvIHRoZSBpbmRpdmlkdWFsIHBpeGVsIGRyYXcgd2l0aCB0aGUgKmZhc3RlciBjb2xvciBjYWxjdWxhdGlvbiogdG8ga2VlcCB0aGUgImRhbmNlIiBsb29rLgogICAgICAgICAgICAvLyBCdXQgd2Ugd2lsbCB1c2UgYSAqKnNwYXJzZSBncmlkKiogdG8gZHJhbWF0aWNhbGx5IHJlZHVjZSBkcmF3IGNhbGxzLgogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vICoqKioqKioqKioqKiBUSEUgQ09NUFJPTUlTRSBGT1IgU1BFRUQgKioqKioqKioqKioqCiAgICAgICAgICAgIC8vIE9ubHkgaXRlcmF0ZSB0aHJvdWdoIGEgZnJhY3Rpb24gb2YgdGhlIHBpeGVscyAoZS5nLiwgMSBpbiA0ICogMSBpbiA0ID0gMS8xNnRoIG9mIHRoZSBwaXhlbHMpCiAgICAgICAgICAgIC8vIFRoaXMgcmVkdWNlcyBkcmF3IGNhbGxzIGZyb20gODQsMDAwIHRvIH41LDI1MCBwZXIgZnJhbWUuCiAgICAgICAgICAgIGNvbnN0IFNQQVJTRV9GQUNUT1IgPSA0OyAvLyBTYW1wbGUgZXZlcnkgNHRoIHBpeGVsIGhvcml6b250YWxseSBhbmQgdmVydGljYWxseQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gU1BBUlNFX0ZBQ1RPUikgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBTUEFSU0VfRkFDVE9SKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGkgPSB5ICogV0lEVEggKyB4OwogICAgICAgICAgICAgICAgICAgIGxldCBkYXRhSW5kZXggPSBpICogNDsKICAgICAgICAgICAgICAgICAgICBsZXQgbWlkSW5kZXggPSBpICogMjsKICAgICAgICAgICAgICAgICAgICBsZXQgbWlkQWxwaGEgPSBtaWRBbHBoYXNbaV07CgogICAgICAgICAgICAgICAgICAgIGxldCBzdGFydEMgPSBzdGFydENvbG9yc1tpXTsKICAgICAgICAgICAgICAgICAgICBsZXQgZW5kQyA9IGVuZENvbG9yc1tpXTsKCiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgQ29sb3IgKERpcmVjdCBjb21wb25lbnQgbWF0aCkKICAgICAgICAgICAgICAgICAgICBsZXQgY3VycmVudFIsIGN1cnJlbnRHLCBjdXJyZW50QiwgY3VycmVudEE7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlkUiA9IChzdGFydENbMF0gKyBlbmRDWzBdKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlkRyA9IChzdGFydENbMV0gKyBlbmRDWzFdKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlkQiA9IChzdGFydENbMl0gKyBlbmRDWzJdKSAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlkQSA9IG1pZEFscGhhOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZWFzZWRQcm9ncmVzcyA8IDAuNSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWJQcm9ncmVzcyA9IGVhc2VkUHJvZ3Jlc3MgKiAyOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50UiA9IHN0YXJ0Q1swXSArIChtaWRSIC0gc3RhcnRDWzBdKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RyA9IHN0YXJ0Q1sxXSArIChtaWRHIC0gc3RhcnRDWzFdKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QiA9IHN0YXJ0Q1syXSArIChtaWRCIC0gc3RhcnRDWzJdKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50QSA9IHN0YXJ0Q1szXSArIChtaWRBIC0gc3RhcnRDWzNdKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHN1YlByb2dyZXNzID0gKGVhc2VkUHJvZ3Jlc3MgLSAwLjUpICogMjsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFIgPSBtaWRSICsgKGVuZENbMF0gLSBtaWRSKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RyA9IG1pZEcgKyAoZW5kQ1sxXSAtIG1pZEcpICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCID0gbWlkQiArIChlbmRDWzJdIC0gbWlkQikgKiBzdWJQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEEgPSBtaWRBICsgKGVuZENbM10gLSBtaWRBKSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gUG9zaXRpb24gQ2FsY3VsYXRpb24gZm9yIFBpeGVsIERyYXdpbmcgLS0tCiAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRYLCBjdXJyZW50WTsKICAgICAgICAgICAgICAgICAgICBsZXQgbWlkWCA9IG1pZFBvc2l0aW9uc1ttaWRJbmRleF07CiAgICAgICAgICAgICAgICAgICAgbGV0IG1pZFkgPSBtaWRQb3NpdGlvbnNbbWlkSW5kZXggKyAxXTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGVhc2VkUHJvZ3Jlc3MgPCAwLjUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViUHJvZ3Jlc3MgPSBlYXNlZFByb2dyZXNzICogMjsKICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFggPSB4ICsgKG1pZFggLSB4KSAqIHN1YlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50WSA9IHkgKyAobWlkWSAtIHkpICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3ViUHJvZ3Jlc3MgPSAoZWFzZWRQcm9ncmVzcyAtIDAuNSkgKiAyOwogICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50WCA9IG1pZFggKyAoeCAtIG1pZFgpICogc3ViUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRZID0gbWlkWSArICh5IC0gbWlkWSkgKiBzdWJQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyB0aGUgcGFydGljbGUKICAgICAgICAgICAgICAgICAgICAvLyBVc2luZyBhIGZpeGVkIHNpemUgb2YgMiBmb3IgYmV0dGVyIHZpc2liaWxpdHkgb2YgdGhlIHNwYXJzZSBncmlkCiAgICAgICAgICAgICAgICAgICAgY29uc3QgcFNpemUgPSAyOyAKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoJHtNYXRoLnJvdW5kKGN1cnJlbnRSKX0sICR7TWF0aC5yb3VuZChjdXJyZW50Ryl9LCAke01hdGgucm91bmQoY3VycmVudEIpfSwgJHtjdXJyZW50QSAvIDI1NX0pYDsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoY3VycmVudFgsIGN1cnJlbnRZLCBwU2l6ZSwgcFNpemUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBBbmltYXRpb24gaXMgY29tcGxldGUuIERyYXcgZmluYWwgaW1hZ2UgZm9yIHBlcmZlY3Rpb24uCiAgICAgICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgICAgIC8vIFNXQVAKICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IG5leHRJbWFnZTsKICAgICAgICAgICAgICAgIGN1cnJlbnRVUkwgPSBuZXh0VVJMOwogICAgICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgCgogICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIGxvYWQgcHJvY2VzcyBmb3IgdGhlIG5leHQgaW1hZ2UgKEMpIGFuZCBraWNrIG9mZiB0aGUgbmV4dCBhbmltYXRpb24uCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgLyoqCiAgICAgICAgICogSW5pdGlhbGl6ZXMgYW5kIHN0YXJ0cyB0aGUgYW5pbWF0aW9uIHNlcXVlbmNlLgogICAgICAgICAqLwogICAgICAgIHZhciBzdGFydEFuaW1hdGlvbiA9ICgpID0+IHsKICAgICAgICAgICAgY3VycmVudEZyYW1lID0gMDsKICAgICAgICAgICAgc2V0dXBJbml0aWFsQ2FudmFzKCk7IC8vIFByZXBhcmUgdGhlIGZhc3RlciwgYXJyYXktYmFzZWQgZGF0YQogICAgICAgICAgICBBTklNQVRFKCk7IC8vIFN0YXJ0IHRoZSBhbmltYXRpb24gbG9vcAogICAgICAgIH07CgogICAgICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tCiAgICAgICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICBpbml0Q2FudmFzQW5kSW1hZ2VzKCk7CiAgICAgICAgfTsKICAgIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=<br>PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+UXVhbnR1bSBQaXhlbCBEaXNzb2x2ZSBUcmFuc2l0aW9uPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICAvKiBCYXNlIHN0eWxlcyAqLwogICAgICAgIGJvZHkgeyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgIAogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovCiAgICAgICAgI2NhbnZhcyB7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOwogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCAxNXB4IHJnYmEoMCwgMCwgMCwgMC41KTsgLyogQWRkZWQgdmlzdWFsIGZsYWlyICovCiAgICAgICAgfQoKICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiAqLwogICAgICAgICNhbmltYXRpb25DYW52YXMgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgICAgfQoKICAgICAgICBoMSB7CiAgICAgICAgICAgIGNvbG9yOiAjMDBGRkM4OwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAyNTUsIDIwMCwgMC41KTsKICAgICAgICAgICAgZm9udC1zaXplOiAxLjJlbTsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgoKCjxkaXYgaWQ9J2NhbnZhcycgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Jz4KICAgIDxjYW52YXMgaWQ9J2FuaW1hdGlvbkNhbnZhcycgd2lkdGg9ODAwIGhlaWdodD00NTAgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCUnPjwvY2FudmFzPgo8L2Rpdj4KCjxzY3JpcHQ+CiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0KICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqVVJMKiBvZiB0aGUgY3VycmVudGx5IGxvYWRlZCBpbWFnZSBzZXQKICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyAKICAgIHZhciBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyAKICAgIAogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpBY3R1YWwgSW1hZ2UgT2JqZWN0cyogZm9yIHRoZSBhbmltYXRpb24KICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOyAvLyBJbWFnZSBBIChUaGUgU3RhcnQpCiAgICB2YXIgbmV4dEltYWdlID0gbnVsbDsgICAgLy8gSW1hZ2UgQiAoVGhlIFRhcmdldCkKCiAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tCiAgICB2YXIgY2FudmFzYmJpOwogICAgdmFyIGN0eGJpOwogICAgdmFyIGltYWdlc2JpID0ge307ICAgICAgICAvLyBTdG9yZXMgQUxMIGxvYWRlZCBJbWFnZSBvYmplY3RzIChrZXllZCBieSBVUkwpCiAgICB2YXIgcGl4Yml4ZWxzID0gW107ICAgICAgIC8vIEFycmF5IHRvIGhvbGQgdGhlIHBpeGVsIHRyYW5zaXRpb24gZGF0YQogICAgdmFyIHRvdGFsRnJhbWVzYmIgPSA2MDsgICAvLyBJbmNyZWFzZWQgZnJhbWVzIGZvciBzbW9vdGhlciAncXVhbnR1bScgbW92ZW1lbnQKICAgIHZhciBjdXJyZW50RnJhbWViYiA9IDA7CiAgICAKICAgIC8vIERpbWVuc2lvbnMgZm9yIHRoZSBjYW52YXMgZWxlbWVudCAoTWF0Y2ggdGhlIGRpdiBzaXplKQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8zNTA7IAogICAgdmFyIGhvb2cxODAgPSA0NTA7IC8vCgogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tCgogICAgLyoqCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuCiAgICAgKi8KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7IAogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOwogICAgICAgIH07CiAgICAgICAgaW1nLm9uZXJyb3IgPSAoKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsKICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOwogICAgICAgIH07CiAgICAgICAgaW1nLnNyYyA9IHNyYzsKICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsgCiAgICB9OwoKICAgIC8qKgogICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgaW4gdGhlIHNlcXVlbmNlIGFuZCBzdGFydHMgdGhlIHRyYW5zaXRpb24uCiAgICAgKi8KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsKICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOwogICAgICAgIAogICAgICAgIC8vIDEuIExvYWQgdGhlIG5ldyBpbWFnZSAoQykKICAgICAgICBpZiAoaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdKSB7CiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsKICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gewogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgewogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltZzsKICAgICAgICAgICAgICAgICAgICAvLyAyLiBTdGFydCB0aGUgdHJhbnNpdGlvbiBmcm9tIEIgdG8gQyBvbmNlIEMgaXMgbG9hZGVkCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7CiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChsb2FkTmV4dEltYWdlQW5kU3RhcnQsIDIwMDApOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgY2FudmFzIGFuZCBsb2FkcyB0aGUgaW5pdGlhbCB0d28gaW1hZ2VzIChBIGFuZCBCKS4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsKICAgICAgICAvLyBJbml0aWFsaXplIGNhbnZhcyBPTkxZIE9OQ0UKICAgICAgICBjYW52YXNiYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7CiAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7IAogICAgICAgIGNhbnZhc2JiaS5oZWlnaHQgPSBob29nMTgwOwogICAgICAgIGN0eGJpID0gY2FudmFzYmJpLmdldENvbnRleHQoJzJkJyk7CgogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07CiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsKICAgICAgICBsZXQgaGFzRXJyb3IgPSBmYWxzZTsKCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7CiAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsb2FkZWRDb3VudCsrOwoKICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzYmlbY3VycmVudFVSTF07CiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV4dFVSTF07CiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOwogICAgfQoKCiAgICAvLyAtLS0gUGl4ZWwgYW5kIEVhc2luZyBVdGlsaXRpZXMgLS0tCiAgICB2YXIgaW50ZXJwb2xhdGVDb2xvciA9IChjb2xvcjEsIGNvbG9yMiwgcHJvZ3Jlc3MpID0+IHsKICAgICAgICAvLyBjb2xvcjEgYW5kIGNvbG9yMiBhcmUgYXJyYXlzIFtyLCBnLCBiLCBhXQogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjb2xvcjFbMF0gKyAoY29sb3IyWzBdIC0gY29sb3IxWzBdKSAqIHByb2dyZXNzKTsKICAgICAgICB2YXIgZyA9IE1hdGgucm91bmQoY29sb3IxWzFdICsgKGNvbG9yMlsxXSAtIGNvbG9yMVsxXSkgKiBwcm9ncmVzcyk7CiAgICAgICAgdmFyIGIgPSBNYXRoLnJvdW5kKGNvbG9yMVsyXSArIChjb2xvcjJbMl0gLSBjb2xvcjFbMl0pICogcHJvZ3Jlc3MpOwogICAgICAgIHZhciBhID0gY29sb3IxWzNdICsgKGNvbG9yMlszXSAtIGNvbG9yMVszXSkgKiBwcm9ncmVzczsKICAgICAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthfSlgOwogICAgfTsKCiAgICAvLyBFYXNpbmcgZnVuY3Rpb24gZm9yIGEgbW9yZSBkcmFtYXRpYyAnc25hcCcgKFF1aW50aWMgRWFzZSBJbi9PdXQpCiAgICB2YXIgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7CgogICAgLyoqCiAgICAgKiBFeHRyYWN0cyBwaXhlbCBkYXRhIGZyb20gYm90aCBpbWFnZXMgYW5kIHByZS1jYWxjdWxhdGVzIHRoZSBwaXhlbCBvYmplY3RzLgogICAgICovCiAgICB2YXIgc2V0dXBJbml0aWFsQ2FudmFzID0gKCkgPT4gewogICAgICAgIHZhciBpbWcxID0gY3VycmVudEltYWdlOyAvLyBUaGUgc3RhcnQgaW1hZ2UKICAgICAgICB2YXIgaW1nMiA9IG5leHRJbWFnZTsgICAgLy8gVGhlIHRhcmdldCBpbWFnZQoKICAgICAgICBwaXhiaXhlbHMgPSBbXTsKICAgICAgICAKICAgICAgICAvLyAxLiBHZXQgSW1hZ2UgMSBEYXRhIChTdGFydCkKICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsKICAgICAgICBjdHhiaS5kcmF3SW1hZ2UoaW1nMSwgMCwgMCAsIGJyZWVkMzYwLCBob29nMTgwKTsKICAgICAgICB2YXIgZGF0YTEgPSBjdHhiaS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOwogICAgICAgIAogICAgICAgIC8vIDIuIEdldCBJbWFnZSAyIERhdGEgKFRhcmdldCkgdXNpbmcgYSB0ZW1wb3JhcnkgY2FudmFzCiAgICAgICAgdmFyIHRlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICB2YXIgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gY2FudmFzYmJpLndpZHRoOwogICAgICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gY2FudmFzYmJpLmhlaWdodDsKICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWcyLCAwLCAwLCBicmVlZDM2MCwgaG9vZzE4MCk7CiAgICAgICAgdmFyIGRhdGEyID0gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOwogICAgICAgIAogICAgICAgIC8vIDMuIFBvcHVsYXRlIHBpeGJpeGVscyBhcnJheSB3aXRoIGluaXRpYWwgYW5kIHRhcmdldCBzdGF0ZXMKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhvb2cxODA7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGJyZWVkMzYwOyB4KyspIHsKICAgICAgICAgICAgICAgIGxldCBpID0gKHkgKiBicmVlZDM2MCArIHgpICogNDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGNvbG9yQSA9IFtkYXRhMVtpXSwgZGF0YTFbaSsxXSwgZGF0YTFbaSsyXSwgZGF0YTFbaSszXSAvIDI1NV07CiAgICAgICAgICAgICAgICBsZXQgY29sb3JCID0gW2RhdGEyW2ldLCBkYXRhMltpKzFdLCBkYXRhMltpKzJdLCBkYXRhMltpKzNdIC8gMjU1XTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gQm91bmRhcnktQnJlYWtpbmcgUXVhbnR1bSBEaXNzb2x2ZSBMb2dpYyAtLS0KICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHBvc2l0aW9uIGlzIGN1cnJlbnQgcGl4ZWwgKHgsIHkpCiAgICAgICAgICAgICAgICBsZXQgc3RhcnRYID0geDsKICAgICAgICAgICAgICAgIGxldCBzdGFydFkgPSB5OwoKICAgICAgICAgICAgICAgIC8vIFRhcmdldCBwb3NpdGlvbiBpcyB0aGUgc2FtZSBwaXhlbCAoeCwgeSkKICAgICAgICAgICAgICAgIGxldCB0YXJnZXRYID0geDsKICAgICAgICAgICAgICAgIGxldCB0YXJnZXRZID0geTsKCiAgICAgICAgICAgICAgICAvLyBSYW5kb20gU2NhdHRlciBPZmZzZXQgKFNpbXVsYXRpbmcgcXVhbnR1bSB1bmNlcnRhaW50eSkKICAgICAgICAgICAgICAgIGxldCByYW5kT2Zmc2V0ID0gNjQ7IC8vIE1heCByYW5kb20gZGlzdGFuY2UKICAgICAgICAgICAgICAgIGxldCBzY2F0dGVyWCA9IHN0YXJ0WCArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIHJhbmRPZmZzZXQ7CiAgICAgICAgICAgICAgICBsZXQgc2NhdHRlclkgPSBzdGFydFkgKyAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiByYW5kT2Zmc2V0OwoKCiAgICAgICAgICAgICAgICBwaXhiaXhlbHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgY29sb3JBOiBjb2xvckEsIC8vIFN0YXJ0IGNvbG9yCiAgICAgICAgICAgICAgICAgICAgY29sb3JCOiBjb2xvckIsIC8vIFRhcmdldCBjb2xvcgogICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogc3RhcnRYLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0WTogc3RhcnRZLAogICAgICAgICAgICAgICAgICAgIHRhcmdldFg6IHRhcmdldFgsCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WTogdGFyZ2V0WSwKICAgICAgICAgICAgICAgICAgICBzY2F0dGVyWDogc2NhdHRlclgsIC8vIFRlbXBvcmFyeSBjaGFvdGljIFgKICAgICAgICAgICAgICAgICAgICBzY2F0dGVyWTogc2NhdHRlclksIC8vIFRlbXBvcmFyeSBjaGFvdGljIFkKICAgICAgICAgICAgICAgICAgICBzaXplOiA4IC8vIERyYXcgYXMgYSAxeDEgcGl4ZWwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiBEcmF3cyB0aGUgY3VycmVudCBmcmFtZSBvZiB0aGUgdHJhbnNpdGlvbi4KICAgICAqLwogICAgdmFyIEFOSU1BVEUgPSAoKSA9PiB7CiAgICAgICAgbGV0IHByb2dyZXNzID0gY3VycmVudEZyYW1lYmIgLyB0b3RhbEZyYW1lc2JiOwogICAgICAgIGxldCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAvLyBDbGVhciB0aGUgY2FudmFzIGZvciB0aGUgbmV3IGZyYW1lCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CgogICAgICAgIHBpeGJpeGVscy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAvLyAxLiBDYWxjdWxhdGUgSW50ZXJwb2xhdGVkIENvbG9yCiAgICAgICAgICAgIGxldCBjdXJyZW50Q29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHAuY29sb3JBLCBwLmNvbG9yQiwgZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9IGN1cnJlbnRDb2xvcjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDIuIENhbGN1bGF0ZSBJbnRlcnBvbGF0ZWQgUG9zaXRpb24gKFF1YW50dW0gRGlzc29sdmUpCiAgICAgICAgICAgIGxldCBkcmF3WCwgZHJhd1k7CiAgICAgICAgICAgIGxldCBjaGFvc0ZhY3RvciA9IE1hdGguc2luKGVhc2VkUHJvZ3Jlc3MgKiBNYXRoLlBJKTsgLy8gUGVha3MgYXQgMC41IHByb2dyZXNzCgogICAgICAgICAgICAvLyBQb3NpdGlvbiBtb3ZlcyBmcm9tIFN0YXJ0IChBKSAtPiBTY2F0dGVyZWQgQ2hhb3MgKE1pZC1Qb2ludCkgLT4gVGFyZ2V0IChCKQogICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPCAwLjUpIHsKICAgICAgICAgICAgICAgIC8vIFBoYXNlIDE6IEEgLT4gQ2hhb3MKICAgICAgICAgICAgICAgIGxldCBwMSA9IGVhc2VkUHJvZ3Jlc3MgKiAyOyAvLyBQcm9ncmVzcyBmcm9tIDAgdG8gMQogICAgICAgICAgICAgICAgZHJhd1ggPSBwLnN0YXJ0WCArIChwLnNjYXR0ZXJYIC0gcC5zdGFydFgpICogcDE7CiAgICAgICAgICAgICAgICBkcmF3WSA9IHAuc3RhcnRZICsgKHAuc2NhdHRlclkgLSBwLnN0YXJ0WSkgKiBwMTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFBoYXNlIDI6IENoYW9zIC0+IEIKICAgICAgICAgICAgICAgIGxldCBwMiA9IChlYXNlZFByb2dyZXNzIC0gMC41KSAqIDI7IC8vIFByb2dyZXNzIGZyb20gMCB0byAxCiAgICAgICAgICAgICAgICBkcmF3WCA9IHAuc2NhdHRlclggKyAocC50YXJnZXRYIC0gcC5zY2F0dGVyWCkgKiBwMjsKICAgICAgICAgICAgICAgIGRyYXdZID0gcC5zY2F0dGVyWSArIChwLnRhcmdldFkgLSBwLnNjYXR0ZXJZKSAqIHAyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAzLiBEcmF3IHRoZSBwaXhlbAogICAgICAgICAgICBjdHhiaS5maWxsUmVjdChkcmF3WCwgZHJhd1ksIHAuc2l6ZSwgcC5zaXplKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgewogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7IAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4gUHJlcGFyZSB0aGUgbmV4dCByb3VuZCAoQiAtPiBDKS4KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIDEuIERyYXcgdGhlIGZpbmFsIGltYWdlIChCKSB0byB0aGUgY2FudmFzIGZvciBhIGNsZWFuIGZpbmlzaC4KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CgogICAgICAgICAgICAvLyAyLiBTV0FQIE9CSkVDVFMgYW5kIFVSTFMgZm9yIHRoZSBuZXh0IGN5Y2xlCiAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IG5leHRJbWFnZTsKICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7IAoKICAgICAgICAgICAgLy8gMy4gR0VORVJBVEUgTkVXIFRBUkdFVCBVUkwgKEMpCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7ICAKCiAgICAgICAgICAgIC8vIDQuIFN0YXJ0IHRoZSBsb2FkIHByb2Nlc3MgZm9yIHRoZSBuZXh0IGltYWdlIChDKS4KICAgICAgICAgICAgc2V0VGltZW91dChsb2FkTmV4dEltYWdlQW5kU3RhcnQsIDIwMDApOyAvLyAyIHNlY29uZCBwYXVzZSBiZWZvcmUgbmV4dCB0cmFuc2l0aW9uCiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4KICAgICAqLwogICAgdmFyIHN0YXJ0QW5pbWF0aW9uZnQgPSAoKSA9PiB7CiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOwoKICAgICAgICAvLyBFeHRyYWN0IHBpeGVsIGRhdGEgZnJvbSB0aGUgY3VycmVudCBzdGFydC90YXJnZXQgaW1hZ2UgcGFpcgogICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOyAKICAgICAgICAKICAgICAgICAvLyBTdGFydCB0aGUgdHJhbnNpdGlvbgogICAgICAgIEFOSU1BVEUoKTsgCiAgICB9OwoKICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tCiAgICB3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOwogICAgfTsKPC9zY3JpcHQ+Cgo8L2JvZHk+CjwvaHRtbD4=<br>DQoNCjxodG1sIGxhbmc9ImVuIj4NCjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+UXVhbnR1bSBGbHV4IFRyYW5zaXRpb248L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7DQogICAgICAgICAgICBjb2xvcjogI2VlZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovDQogICAgICAgICNjYW52YXMgew0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KDQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjIyOyAvKiBGYWxsYmFjayBmb3IgaW5pdGlhbCBsb2FkICovDQogICAgICAgIH0NCiAgICAgICAgLyogVGhlIGNhbnZhcyBpdHNlbGYgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsgLyogQWN0dWFsIHJlbmRlcmVkIHNpemUsIG1hdGNoZXMgSlMgYnJlZWQzNjAgKi8NCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsgLyogQWN0dWFsIHJlbmRlcmVkIHNpemUsIG1hdGNoZXMgSlMgaG9vZzE4MCAqLw0KICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOyAvKiBFbnN1cmUgaW5pdGlhbCBibGFjayBjYW52YXMgKi8NCiAgICAgICAgfQ0KICAgICAgICBoMSB7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICAgICAgICAgICAgY29sb3I6ICMwMGZmZmY7DQogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjMDBmZmZmLCAwIDAgMTBweCAjMDBmZmZmOw0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KPGRpdiBpZD0nY2FudmFzJz4NCiAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48L2NhbnZhcz4NCjwvZGl2Pg0KPHNjcmlwdD4NCiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0NCiAgICAvLyBWYXJpYWJsZXMgdG8gaG9sZCB0aGUgKlVSTCogb2YgdGhlIGN1cnJlbnRseSBsb2FkZWQgaW1hZ2Ugc2V0DQogICAgdmFyIGN1cnJlbnRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KICAgIHZhciBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCg0KICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqQWN0dWFsIEltYWdlIE9iamVjdHMqIGZvciB0aGUgYW5pbWF0aW9uDQogICAgdmFyIGN1cnJlbnRJbWFnZSA9IG51bGw7IC8vIEltYWdlIEEgKFRoZSBTdGFydCkNCiAgICB2YXIgbmV4dEltYWdlID0gbnVsbDsgICAgLy8gSW1hZ2UgQiAoVGhlIFRhcmdldCkNCg0KICAgIC8vIC0tLSBHbG9iYWwgQW5pbWF0aW9uIFZhcmlhYmxlcyAtLS0NCiAgICB2YXIgY2FudmFzYmJpOw0KICAgIHZhciBjdHhiaTsNCiAgICB2YXIgaW1hZ2VzYmkgPSB7fTsgICAgICAgIC8vIFN0b3JlcyBBTEwgbG9hZGVkIEltYWdlIG9iamVjdHMgKGtleWVkIGJ5IFVSTCkNCiAgICB2YXIgcGl4Yml4ZWxzID0gW107ICAgICAgIC8vIFN0b3JlcyBzdHJ1Y3R1cmVkIHBpeGVsIGRhdGEgZm9yIHRoZSBhbmltYXRpb24NCg0KICAgIHZhciB0b3RhbEZyYW1lc2JiID0gMTIwOyAvLyBJbmNyZWFzZWQgZnJhbWVzIGZvciBzbW9vdGhlciAncXVhbnR1bScgcHJvZ3Jlc3Npb24NCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOw0KDQogICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIGNhbnZhcyBlbGVtZW50IChtYXRjaGluZyBwaWNzdW0gcmVxdWVzdHMpDQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8zNTA7DQogICAgdmFyIGhvb2cxODAgPSA0NTA7IC8vDQoNCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0NCiAgICAvKioNCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuDQogICAgICovDQogICAgdmFyIGxvYWRJbWFnZWJiID0gKHNyYywgY2FsbGJhY2spID0+IHsNCiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOw0KICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgaW1hZ2VzYmlbc3JjXSA9IGltZzsNCiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7DQogICAgICAgIH07DQogICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOw0KICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcuc3JjID0gc3JjOw0KICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgaW4gdGhlIHNlcXVlbmNlIGFuZCBzdGFydHMgdGhlIHRyYW5zaXRpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gbG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkgew0KICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOw0KDQogICAgICAgIGlmIChpbWFnZXNiaVtuZXdJbWFnZVVSTF0pIHsNCiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7DQogICAgICAgIGNhbnZhc2JiaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25DYW52YXMnKTsNCiAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7DQogICAgICAgIGNhbnZhc2JiaS5oZWlnaHQgPSBob29nMTgwOw0KICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOw0KDQogICAgICAgIC8vIFNldCBpbml0aWFsIGJhY2tncm91bmQgdG8gYmxhY2sgdG8gcHJldmVudCBmbGlja2VyaW5nDQogICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9ICdibGFjayc7DQogICAgICAgIGN0eGJpLmZpbGxSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgbGV0IGltYWdlc1RvTG9hZCA9IFtjdXJyZW50VVJMLCBuZXh0VVJMXTsNCiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsNCiAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7DQoNCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICBpZiAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBoYXNFcnJvciA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2FkZWRDb3VudCsrOw0KICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgaWYgKCFoYXNFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBpbWFnZXNiaVtjdXJyZW50VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV4dFVSTF07DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgIH0NCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICAvLyBUaGUgcHJldmlvdXMgcGFyc2VSR0JBIGFuZCBpbnRlcnBvbGF0ZUNvbG9yIGFyZSBub3QgbmVlZGVkIGFzIHdlIGV4dHJhY3QgcmF3IHBpeGVsIGRhdGENCiAgICB2YXIgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7DQoNCiAgICAvKioNCiAgICAgKiBQcmVwYXJlcyBwaXhlbCBkYXRhIGZvciB0aGUgYW5pbWF0aW9uLg0KICAgICAqLw0KICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7DQogICAgICAgIC8vIENsZWFyIHByZXZpb3VzIHBpeGVsIGRhdGENCiAgICAgICAgcGl4Yml4ZWxzID0gW107DQoNCiAgICAgICAgLy8gRHJhdyBjdXJyZW50IGltYWdlIHRvIGdldCBpdHMgcGl4ZWwgZGF0YQ0KICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOw0KICAgICAgICB2YXIgZGF0YTEgPSBjdHhiaS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOw0KDQogICAgICAgIC8vIERyYXcgbmV4dCBpbWFnZSB0byBhIHRlbXBvcmFyeSBjYW52YXMgdG8gZ2V0IGl0cyBwaXhlbCBkYXRhDQogICAgICAgIHZhciB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gY2FudmFzYmJpLndpZHRoOw0KICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7DQogICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOw0KICAgICAgICB2YXIgZGF0YTIgPSB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpLmRhdGE7DQoNCiAgICAgICAgLy8gUG9wdWxhdGUgcGl4Yml4ZWxzIHdpdGggc3RydWN0dXJlZCBkYXRhIGZvciBlYWNoIHBpeGVsDQogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaG9vZzE4MDsgeSsrKSB7DQogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGJyZWVkMzYwOyB4KyspIHsNCiAgICAgICAgICAgICAgICBsZXQgaSA9ICh5ICogYnJlZWQzNjAgKyB4KSAqIDQ7DQogICAgICAgICAgICAgICAgcGl4Yml4ZWxzLnB1c2goew0KICAgICAgICAgICAgICAgICAgICB4OiB4LA0KICAgICAgICAgICAgICAgICAgICB5OiB5LA0KICAgICAgICAgICAgICAgICAgICByMTogZGF0YTFbaV0sIGcxOiBkYXRhMVtpKzFdLCBiMTogZGF0YTFbaSsyXSwgYTE6IGRhdGExW2krM10sDQogICAgICAgICAgICAgICAgICAgIHIyOiBkYXRhMltpXSwgZzI6IGRhdGEyW2krMV0sIGIyOiBkYXRhMltpKzJdLCBhMjogZGF0YTJbaSszXSwNCiAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9taXplIGRlbGF5IGFuZCBkdXJhdGlvbiBmb3IgaW5kaXZpZHVhbCBwaXhlbCB0cmFuc2l0aW9ucw0KICAgICAgICAgICAgICAgICAgICBkZWxheTogTWF0aC5yYW5kb20oKSAqIHRvdGFsRnJhbWVzYmIgKiAwLjMsIC8vIHVwIHRvIDMwJSBvZiB0b3RhbEZyYW1lcyBhcyBkZWxheQ0KICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogdG90YWxGcmFtZXNiYiAqICgwLjQgKyBNYXRoLnJhbmRvbSgpICogMC42KSwgLy8gZHVyYXRpb24gZnJvbSA0MCUgdG8gMTAwJSBvZiB0b3RhbEZyYW1lcw0KICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWFsICJxdWFudHVtIGZsdWN0dWF0aW9uIiBvZmZzZXQgZm9yIGNoYW90aWMgdHJhamVjdG9yaWVzDQogICAgICAgICAgICAgICAgICAgIGluaXRpYWxPZmZzZXRYOiAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiA1LA0KICAgICAgICAgICAgICAgICAgICBpbml0aWFsT2Zmc2V0WTogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogNSwNCiAgICAgICAgICAgICAgICAgICAgLy8gVW5pcXVlICJxdWFudHVtIHBoYXNlIiBmb3IgZWFjaCBwaXhlbA0KICAgICAgICAgICAgICAgICAgICBxdWFudHVtUGhhc2U6IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMg0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLg0KICAgICAqLw0KICAgIHZhciBBTklNQVRFID0gKCkgPT4gew0KICAgICAgICAvLyBDcmVhdGUgYW4gSW1hZ2VEYXRhIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgZnJhbWUNCiAgICAgICAgbGV0IGltYWdlRGF0YSA9IGN0eGJpLmNyZWF0ZUltYWdlRGF0YShjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICBsZXQgcGl4ZWxzRGF0YSA9IGltYWdlRGF0YS5kYXRhOyAvLyBSZWZlcmVuY2UgdG8gdGhlIHJhdyBwaXhlbCBhcnJheQ0KDQogICAgICAgIHBpeGJpeGVscy5mb3JFYWNoKHBpeGVsID0+IHsNCiAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IChjdXJyZW50RnJhbWViYiAtIHBpeGVsLmRlbGF5KSAvIHBpeGVsLmR1cmF0aW9uOw0KICAgICAgICAgICAgcHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBwcm9ncmVzcykpOyAvLyBDbGFtcCBwcm9ncmVzcyBiZXR3ZWVuIDAgYW5kIDENCg0KICAgICAgICAgICAgbGV0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7DQoNCiAgICAgICAgICAgIC8vIC0tLSBRdWFudHVtIEVmZmVjdHMgJiBCb3VuZGFyeSBCcmVha2luZyAtLS0NCg0KICAgICAgICAgICAgbGV0IGN1cnJlbnRSLCBjdXJyZW50RywgY3VycmVudEIsIGN1cnJlbnRBOw0KICAgICAgICAgICAgbGV0IGN1cnJlbnRYID0gcGl4ZWwueDsNCiAgICAgICAgICAgIGxldCBjdXJyZW50WSA9IHBpeGVsLnk7DQoNCiAgICAgICAgICAgIC8vIDEuIFByb2JhYmlsaXN0aWMgVGVsZXBvcnRhdGlvbi9GbGlja2VyIChRdWFudHVtIFVuY2VydGFpbnR5KQ0KICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjAxICYmIHByb2dyZXNzID4gMCAmJiBwcm9ncmVzcyA8IDEpIHsgLy8gMSUgY2hhbmNlIHBlciBmcmFtZSBmb3IgYSBxdWFudHVtIGp1bXANCiAgICAgICAgICAgICAgICAvLyBCcmllZmx5ICJ0ZWxlcG9ydCIgdG8gdGFyZ2V0IGNvbG9yIG9yIGEgcmFuZG9tIGNvbG9yDQogICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAwLjUpIHsgLy8gNTAlIGNoYW5jZSB0byBqdW1wIHRvIHRhcmdldA0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50UiA9IHBpeGVsLnIyOyBjdXJyZW50RyA9IHBpeGVsLmcyOyBjdXJyZW50QiA9IHBpeGVsLmIyOyBjdXJyZW50QSA9IHBpeGVsLmEyOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIDUwJSBjaGFuY2UgdG8gc2hvdyBhIHJhbmRvbSwgZ2xpdGNoeSBjb2xvcg0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50UiA9IE1hdGgucmFuZG9tKCkgKiAyNTU7IGN1cnJlbnRHID0gTWF0aC5yYW5kb20oKSAqIDI1NTsgY3VycmVudEIgPSBNYXRoLnJhbmRvbSgpICogMjU1OyBjdXJyZW50QSA9IDI1NTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIDIuIENoYW90aWMgVHJhamVjdG9yaWVzICYgIlVucmVhbCBTaW11bGF0aW9uIg0KICAgICAgICAgICAgICAgIC8vIFBpeGVscyBvc2NpbGxhdGUgYXJvdW5kIHRoZWlyIHBhdGggYmFzZWQgb24gaW5pdGlhbCBxdWFudHVtIGZsdWN0dWF0aW9ucyBhbmQgdGltZQ0KICAgICAgICAgICAgICAgIGxldCBvc2NpbGxhdGlvbkZhY3RvciA9IDEgLSBlYXNlZFByb2dyZXNzOyAvLyBPc2NpbGxhdGlvbnMgcmVkdWNlIGFzIHBpeGVsIHNldHRsZXMNCiAgICAgICAgICAgICAgICBjdXJyZW50WCArPSBwaXhlbC5pbml0aWFsT2Zmc2V0WCAqIG9zY2lsbGF0aW9uRmFjdG9yICogTWF0aC5zaW4oY3VycmVudEZyYW1lYmIgKiAwLjA1ICsgcGl4ZWwucXVhbnR1bVBoYXNlKTsNCiAgICAgICAgICAgICAgICBjdXJyZW50WSArPSBwaXhlbC5pbml0aWFsT2Zmc2V0WSAqIG9zY2lsbGF0aW9uRmFjdG9yICogTWF0aC5jb3MoY3VycmVudEZyYW1lYmIgKiAwLjA1ICsgcGl4ZWwucXVhbnR1bVBoYXNlKTsNCg0KICAgICAgICAgICAgICAgIC8vIDMuICJCb3VuZGFyeSBCcmVha2luZyIgSW5zaWdodCAodXNpbmcgNjc0NTIwIGFzIGEgcHNldWRvLXNlZWQvZmFjdG9yKQ0KICAgICAgICAgICAgICAgIC8vIEludHJvZHVjZSB0ZW1wb3JhcnksIGxhcmdlciBkaXNwbGFjZW1lbnRzIGF0IGNlcnRhaW4gInBoYXNlcyIgb2YgdGhlIGFuaW1hdGlvbg0KICAgICAgICAgICAgICAgIC8vIFRoaXMgbWFrZXMgdGhlbSBicmllZmx5IGFwcGVhciB0byBicmVhayBvdXQgb2YgdGhlaXIgZXhwZWN0ZWQgcGF0aHMuDQogICAgICAgICAgICAgICAgY29uc3QgYm91bmRhcnlGYWN0b3IgPSAoNjc0NTIwICUgMTAwMCkgLyAxMDA7IC8vIGUuZy4sIDUyMC8xMDAgPSA1LjINCiAgICAgICAgICAgICAgICBsZXQgZGlzcGxhY2VtZW50QW1wbGl0dWRlID0gTWF0aC5zaW4oY3VycmVudEZyYW1lYmIgLyAodG90YWxGcmFtZXNiYiAvIDUpICsgcGl4ZWwueCAvIGJvdW5kYXJ5RmFjdG9yKSAqIGJvdW5kYXJ5RmFjdG9yICogKDEgLSBNYXRoLmFicygyICogcHJvZ3Jlc3MgLSAxKSk7DQogICAgICAgICAgICAgICAgLy8gVGhlICgxIC0gTWF0aC5hYnMoMiAqIHByb2dyZXNzIC0gMSkpIGVuc3VyZXMgbWF4IGRpc3BsYWNlbWVudCBpcyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0cmFuc2l0aW9uLCBmYWRpbmcgYXQgc3RhcnQvZW5kLg0KICAgICAgICAgICAgICAgIGN1cnJlbnRYICs9IGRpc3BsYWNlbWVudEFtcGxpdHVkZSAqIE1hdGguc2luKGN1cnJlbnRGcmFtZWJiICogMC4xKTsNCiAgICAgICAgICAgICAgICBjdXJyZW50WSArPSBkaXNwbGFjZW1lbnRBbXBsaXR1ZGUgKiBNYXRoLmNvcyhjdXJyZW50RnJhbWViYiAqIDAuMSk7DQoNCg0KICAgICAgICAgICAgICAgIC8vIE5vcm1hbCBjb2xvciBpbnRlcnBvbGF0aW9uDQogICAgICAgICAgICAgICAgY3VycmVudFIgPSBwaXhlbC5yMSArIChwaXhlbC5yMiAtIHBpeGVsLnIxKSAqIGVhc2VkUHJvZ3Jlc3M7DQogICAgICAgICAgICAgICAgY3VycmVudEcgPSBwaXhlbC5nMSArIChwaXhlbC5nMiAtIHBpeGVsLmcxKSAqIGVhc2VkUHJvZ3Jlc3M7DQogICAgICAgICAgICAgICAgY3VycmVudEIgPSBwaXhlbC5iMSArIChwaXhlbC5iMiAtIHBpeGVsLmIxKSAqIGVhc2VkUHJvZ3Jlc3M7DQogICAgICAgICAgICAgICAgY3VycmVudEEgPSBwaXhlbC5hMSArIChwaXhlbC5hMiAtIHBpeGVsLmExKSAqIGVhc2VkUHJvZ3Jlc3M7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIEVuc3VyZSBjb29yZGluYXRlcyBhcmUgd2l0aGluIGNhbnZhcyBib3VuZHMNCiAgICAgICAgICAgIGN1cnJlbnRYID0gTWF0aC5yb3VuZChNYXRoLm1heCgwLCBNYXRoLm1pbihicmVlZDM2MCAtIDEsIGN1cnJlbnRYKSkpOw0KICAgICAgICAgICAgY3VycmVudFkgPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIE1hdGgubWluKGhvb2cxODAgLSAxLCBjdXJyZW50WSkpKTsNCg0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGluZGV4IGZvciBJbWFnZURhdGENCiAgICAgICAgICAgIGxldCBpID0gKGN1cnJlbnRZICogY2FudmFzYmJpLndpZHRoICsgY3VycmVudFgpICogNDsNCg0KICAgICAgICAgICAgLy8gU2V0IHBpeGVsIGRhdGEgZGlyZWN0bHkNCiAgICAgICAgICAgIHBpeGVsc0RhdGFbaV0gPSBNYXRoLnJvdW5kKGN1cnJlbnRSKTsNCiAgICAgICAgICAgIHBpeGVsc0RhdGFbaSsxXSA9IE1hdGgucm91bmQoY3VycmVudEcpOw0KICAgICAgICAgICAgcGl4ZWxzRGF0YVtpKzJdID0gTWF0aC5yb3VuZChjdXJyZW50Qik7DQogICAgICAgICAgICBwaXhlbHNEYXRhW2krM10gPSBNYXRoLnJvdW5kKGN1cnJlbnRBKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gUHV0IHRoZSBtYW5pcHVsYXRlZCBwaXhlbCBkYXRhIG9udG8gdGhlIGNhbnZhcw0KICAgICAgICBjdHhiaS5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsNCg0KICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7DQogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOw0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLg0KDQogICAgICAgICAgICAvLyBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgdG8gdGhlIGNhbnZhcyB0byBjb21wbGV0ZWx5IGNvdmVyIHRoZSB0cmFuc2l0aW9uIHBpeGVscy4NCiAgICAgICAgICAgIC8vIFRoaXMgZW5zdXJlcyBhIGNsZWFuIHNsYXRlIGFuZCBmdWxsIHRhcmdldCBpbWFnZSB2aXNpYmlsaXR5Lg0KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgICAgICAvLyAxLiBTV0FQIE9CSkVDVFM6IFRoZSBvbGQgdGFyZ2V0IGltYWdlIG9iamVjdCAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSBvYmplY3QgKEEpLg0KICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOw0KDQogICAgICAgICAgICAvLyAyLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLg0KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7DQoNCiAgICAgICAgICAgIC8vIDMuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKQ0KICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAgICAgICAgIC8vIDQuIFN0YXJ0IHRoZSBsb2FkIHByb2Nlc3MgZm9yIHRoZSBuZXh0IGltYWdlIChDKS4gTm8gZGVsYXkgbmVlZGVkIGhlcmUuDQogICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOw0KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsNCiAgICAgICAgQU5JTUFURSgpOw0KICAgIH07DQoNCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQ0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOw0KICAgIH07DQo8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=<br>PGh0bWwgbGFuZz0iZW4iPg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPg0KICAgIDx0aXRsZT5RdWFudHVtIEppdHRlciAmIENvbGxhcHNlIFRyYW5zaXRpb248L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7DQogICAgICAgICAgICBjb2xvcjogI2VlZTsNCiAgICAgICAgfQ0KICAgICAgICBoMSB7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICAgICAgY29sb3I6ICMwMGJjZDQ7IC8qIEEgdmlicmFudCB0ZWFsICovDQogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDEwcHggcmdiYSgwLCAxODgsIDIxMiwgMC43KTsNCiAgICAgICAgfQ0KICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMvYmFja2dyb3VuZCBpbWFnZSAqLw0KICAgICAgICAjY2FudmFzIHsNCiAgICAgICAgICAgIC8qIFRoZSBjYW52YXMgd2lsbCBub3cgYmUgcGxhY2VkIGluc2lkZSB0aGlzIGRpdiBvbmx5IG9uY2UgKi8NCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOyAvKiBFeGFtcGxlIHdpZHRoLCB3aWxsIGJlIGFkanVzdGVkIGJ5IEpTICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7IC8qIEV4YW1wbGUgaGVpZ2h0LCB3aWxsIGJlIGFkanVzdGVkIGJ5IEpTICovDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzIyMjsgLyogRGFya2VyIGJhY2tncm91bmQgZm9yIHRoZSBjb250YWluZXIgKi8NCiAgICAgICAgICAgIGJvcmRlcjogMHB4IHNvbGlkICMwMGJjZDQ7DQogICAgICAgICAgICAgIHBhZGRpbmc6IDBweDsNCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgIH0NCiAgICAgICAgLyogVGhlIGNhbnZhcyBpdHNlbGYgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsgLyogRmlsbCB0aGUgY29udGFpbmVyICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7IC8qIEZpbGwgdGhlIGNvbnRhaW5lciAqLw0KICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOyAvKiBEZWZhdWx0IHRvIGJsYWNrIGlmIG5vIGltYWdlIGlzIGxvYWRlZCB5ZXQgKi8NCiAgICAgICAgfQ0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxkaXYgaWQ9J2NhbnZhcycgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Jz4NCiAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48L2NhbnZhcz4NCjwvZGl2Pg0KPHNjcmlwdD4NCiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0NCiAgICAvLyBWYXJpYWJsZXMgdG8gaG9sZCB0aGUgKlVSTCogb2YgdGhlIGN1cnJlbnRseSBsb2FkZWQgaW1hZ2Ugc2V0DQogICAgdmFyIGN1cnJlbnRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KICAgIHZhciBuZXh0VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCg0KICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqQWN0dWFsIEltYWdlIE9iamVjdHMqIGZvciB0aGUgYW5pbWF0aW9uDQogICAgdmFyIGN1cnJlbnRJbWFnZSA9IG51bGw7IC8vIEltYWdlIEEgKFRoZSBTdGFydCkNCiAgICB2YXIgbmV4dEltYWdlID0gbnVsbDsgICAgLy8gSW1hZ2UgQiAoVGhlIFRhcmdldCkNCg0KICAgIC8vIC0tLSBHbG9iYWwgQW5pbWF0aW9uIFZhcmlhYmxlcyAtLS0NCiAgICB2YXIgY2FudmFzYmJpOw0KICAgIHZhciBjdHhiaTsNCiAgICB2YXIgaW1hZ2VzYmkgPSB7fTsgICAgICAgIC8vIFN0b3JlcyBBTEwgbG9hZGVkIEltYWdlIG9iamVjdHMgKGtleWVkIGJ5IFVSTCkNCiAgICB2YXIgcGl4Yml4ZWxzID0gW107ICAgICAgIC8vIFN0b3JlcyBwaXhlbCBkYXRhIGZvciB0aGUgYW5pbWF0aW9uDQoNCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDEyMDsgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3IgYSBtb3JlIGdyYWR1YWwgYW5kIGNvbXBsZXggYW5pbWF0aW9uDQogICAgdmFyIGN1cnJlbnRGcmFtZWJiID0gMDsNCg0KICAgIC8vIERpbWVuc2lvbnMgZm9yIHRoZSBjYW52YXMgZWxlbWVudCAobWF0Y2hpbmcgcGljc3VtIGltYWdlIGFzcGVjdCByYXRpbyBmb3IgMzYweDY0MCkNCiAgICB2YXIgYnJlZWQzNjAgPSA4MDA7ICAvLw0KICAgIHZhciBob29nMTgwID0gNDUwOyAvLw0KDQogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tDQogICAgLyoqDQogICAgICogTG9hZHMgYSBzaW5nbGUgaW1hZ2UgaW50byB0aGUgaW1hZ2VzYmkgbWFwLg0KICAgICAqLw0KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7DQogICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsNCiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7DQogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsNCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLnNyYyA9IHNyYzsNCiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7IC8vIENydWNpYWwgZm9yIGdldEltYWdlRGF0YSBvbiBleHRlcm5hbCBpbWFnZXMNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogTG9hZHMgdGhlIG5leHQgaW1hZ2UgaW4gdGhlIHNlcXVlbmNlIGFuZCBzdGFydHMgdGhlIHRyYW5zaXRpb24uDQogICAgICovDQogICAgZnVuY3Rpb24gbG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkgew0KICAgICAgICBsZXQgbmV3SW1hZ2VVUkwgPSBuZXh0VVJMOw0KICAgICAgICAvLyBJZiB0aGUgaW1hZ2UgaXMgYWxyZWFkeSBjYWNoZWQgKGUuZy4sIGZyb20gYSBwcmV2aW91cyB0cmFuc2l0aW9uIHdoZXJlIGl0IHdhcyAnY3VycmVudEltYWdlJykNCiAgICAgICAgaWYgKGltYWdlc2JpW25ld0ltYWdlVVJMXSkgew0KICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdOw0KICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbG9hZEltYWdlYmIobmV3SW1hZ2VVUkwsIChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWc7DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHJ5IGxvYWRpbmcgdGhlIG5leHQgaW1hZ2UgYWZ0ZXIgYSBkZWxheSBpZiBpdCBmYWlscw0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7DQogICAgICAgIC8vIEluaXRpYWxpemUgY2FudmFzIE9OTFkgT05DRQ0KICAgICAgICBjYW52YXNiYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7DQogICAgICAgIGNhbnZhc2JiaS53aWR0aCA9IGJyZWVkMzYwOw0KICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgY3R4YmkgPSBjYW52YXNiYmkuZ2V0Q29udGV4dCgnMmQnKTsNCg0KICAgICAgICAvLyBBZGp1c3QgdGhlIGNvbnRhaW5lcidzIHNpemUgdG8gZml0IHRoZSBjYW52YXMgd2l0aCBwYWRkaW5nDQogIA0KDQogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7DQogICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlOw0KICAgICAgICBjb25zdCBvbkltYWdlTG9hZGVkID0gKGVycm9yLCBpbWcpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7DQogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc2JpW2N1cnJlbnRVUkxdOw0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXh0VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgICAgICAvLyBEaXNwbGF5IGEgZmFsbGJhY2sgZXJyb3IgbWVzc2FnZSBvbiBjYW52YXMNCiAgICAgICAgICAgICAgICAgICAgY3R4YmkuZmlsbFN0eWxlID0gJ3JlZCc7DQogICAgICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICAgICAgICAgIGN0eGJpLmZpbGxTdHlsZSA9ICd3aGl0ZSc7DQogICAgICAgICAgICAgICAgICAgIGN0eGJpLmZvbnQgPSAnMjBweCBBcmlhbCc7DQogICAgICAgICAgICAgICAgICAgIGN0eGJpLnRleHRBbGlnbiA9ICdjZW50ZXInOw0KICAgICAgICAgICAgICAgICAgICBjdHhiaS5maWxsVGV4dCgnRXJyb3IgbG9hZGluZyBpbWFnZXMhJywgY2FudmFzYmJpLndpZHRoIC8gMiwgY2FudmFzYmJpLmhlaWdodCAvIDIpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgIH0NCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICAvLyAocGFyc2VSR0JBIG5vdCBzdHJpY3RseSBuZWVkZWQgZm9yIGRpcmVjdCBJbWFnZURhdGEgbWFuaXB1bGF0aW9uLCBidXQga2VwdCBmb3IgY29udGV4dCkNCiAgICB2YXIgcGFyc2VSR0JBID0gKHJnYmFTdHJpbmcpID0+IHsNCiAgICAgICAgdmFyIHBhcnRzID0gcmdiYVN0cmluZy5tYXRjaCgvXGQrKFwuXGQrKT8vZykubWFwKE51bWJlcik7DQogICAgICAgIHJldHVybiB7IHI6IHBhcnRzWzBdLCBnOiBwYXJ0c1sxXSwgYjogcGFydHNbMl0sIGE6IHBhcnRzWzNdIHx8IDEgfTsNCiAgICB9Ow0KDQogICAgLy8gSW50ZXJwb2xhdGVzIGJldHdlZW4gdHdvIGNvbG9yIGFycmF5cyBbciwgZywgYiwgYV0NCiAgICB2YXIgaW50ZXJwb2xhdGVDb2xvciA9IChjb2xvcjEsIGNvbG9yMiwgcHJvZ3Jlc3MpID0+IHsNCiAgICAgICAgdmFyIHIgPSBNYXRoLnJvdW5kKGNvbG9yMVswXSArIChjb2xvcjJbMF0gLSBjb2xvcjFbMF0pICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgZyA9IE1hdGgucm91bmQoY29sb3IxWzFdICsgKGNvbG9yMlsxXSAtIGNvbG9yMVsxXSkgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBiID0gTWF0aC5yb3VuZChjb2xvcjFbMl0gKyAoY29sb3IyWzJdIC0gY29sb3IxWzJdKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGEgPSBjb2xvcjFbM10gKyAoY29sb3IyWzNdIC0gY29sb3IxWzNdKSAqIHByb2dyZXNzOw0KICAgICAgICByZXR1cm4gW3IsIGcsIGIsIGFdOw0KICAgIH07DQoNCiAgICAvLyBFYXNpbmcgZnVuY3Rpb24gZm9yIHNtb290aGVyIGFjY2VsZXJhdGlvbi9kZWNlbGVyYXRpb24NCiAgICB2YXIgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7DQoNCiAgICAvLyAtLS0gQ3VzdG9tIFF1YW50dW0gSml0dGVyICYgQ29sbGFwc2UgQW5pbWF0aW9uIExvZ2ljIC0tLQ0KICAgIHZhciBxdWFudHVtU2VlZCA9IDkwNzIxNzsgLy8gVGhlIHNwZWNpZmljIG51bWJlciBmcm9tIHRoZSBwcm9tcHQNCg0KICAgIC8qKg0KICAgICAqIFByZXBhcmVzIHBpeGVsIGRhdGEgZm9yIHRoZSBxdWFudHVtIHRyYW5zaXRpb24gZWZmZWN0IGJ5IHNhbXBsaW5nIGJvdGggaW1hZ2VzLg0KICAgICAqLw0KICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7DQogICAgICAgIC8vIENyZWF0ZSB0ZW1wb3JhcnkgY2FudmFzZXMgdG8gZXh0cmFjdCBwaXhlbCBkYXRhIGZyb20gdGhlIGltYWdlcw0KICAgICAgICB2YXIgdGVtcENhbnZhczEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgdmFyIHRlbXBDdHgxID0gdGVtcENhbnZhczEuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgdGVtcENhbnZhczEud2lkdGggPSBicmVlZDM2MDsNCiAgICAgICAgdGVtcENhbnZhczEuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgdGVtcEN0eDEuZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOw0KICAgICAgICB2YXIgZGF0YTEgPSB0ZW1wQ3R4MS5nZXRJbWFnZURhdGEoMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApLmRhdGE7DQoNCiAgICAgICAgdmFyIHRlbXBDYW52YXMyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4MiA9IHRlbXBDYW52YXMyLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgIHRlbXBDYW52YXMyLndpZHRoID0gYnJlZWQzNjA7DQogICAgICAgIHRlbXBDYW52YXMyLmhlaWdodCA9IGhvb2cxODA7DQogICAgICAgIHRlbXBDdHgyLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICAgICAgdmFyIGRhdGEyID0gdGVtcEN0eDIuZ2V0SW1hZ2VEYXRhKDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKS5kYXRhOw0KDQogICAgICAgIHBpeGJpeGVscyA9IFtdOw0KICAgICAgICB2YXIgcGl4ZWxDb3VudCA9IGJyZWVkMzYwICogaG9vZzE4MDsNCg0KICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggZWFjaCBsb2dpY2FsIHBpeGVsIHBvc2l0aW9uDQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGl4ZWxDb3VudDsgaSsrKSB7DQogICAgICAgICAgICBsZXQgaWR4ID0gaSAqIDQ7IC8vIEluZGV4IGludG8gdGhlIEltYWdlRGF0YSBhcnJheSAoUiwgRywgQiwgQSkNCiAgICAgICAgICAgIGxldCB4ID0gaSAlIGJyZWVkMzYwOw0KICAgICAgICAgICAgbGV0IHkgPSBNYXRoLmZsb29yKGkgLyBicmVlZDM2MCk7DQoNCiAgICAgICAgICAgIC8vIEV4dHJhY3QgUkdCQSBjb2xvcnMgZm9yIHN0YXJ0IGFuZCB0YXJnZXQgaW1hZ2VzDQogICAgICAgICAgICBsZXQgc3RhcnRDb2xvciA9IFtkYXRhMVtpZHhdLCBkYXRhMVtpZHggKyAxXSwgZGF0YTFbaWR4ICsgMl0sIGRhdGExW2lkeCArIDNdXTsNCiAgICAgICAgICAgIGxldCB0YXJnZXRDb2xvciA9IFtkYXRhMltpZHhdLCBkYXRhMltpZHggKyAxXSwgZGF0YTJbaWR4ICsgMl0sIGRhdGEyW2lkeCArIDNdXTsNCg0KICAgICAgICAgICAgLy8gIkx1Y2t5IHBlcmNlcHRpb24iIG9mIGNvbGxhcHNlIHRpbWUgZm9yIGVhY2ggcGl4ZWwNCiAgICAgICAgICAgIC8vIFVzaW5nIGEgcHNldWRvLXJhbmRvbSB2YWx1ZSBkZXJpdmVkIGZyb20gcGl4ZWwgY29vcmRpbmF0ZXMgYW5kIHF1YW50dW1TZWVkDQogICAgICAgICAgICBsZXQgcmFuZG9tRmFjdG9yID0gKE1hdGguc2luKHggKiB5ICogcXVhbnR1bVNlZWQgLyBwaXhlbENvdW50KSAqIDAuNSArIDAuNSk7IC8vIEEgdmFsdWUgYmV0d2VlbiAwIGFuZCAxDQogICAgICAgICAgICAvLyBFYWNoIHBpeGVsIHdpbGwgY29sbGFwc2UgYmV0d2VlbiAzMCUgYW5kIDkwJSBvZiB0aGUgdG90YWwgYW5pbWF0aW9uIGZyYW1lcw0KICAgICAgICAgICAgbGV0IGNvbGxhcHNlRnJhbWUgPSBNYXRoLmZsb29yKHRvdGFsRnJhbWVzYmIgKiAoMC4zICsgMC42ICogcmFuZG9tRmFjdG9yKSk7DQoNCiAgICAgICAgICAgIC8vIFBhcmFtZXRlcnMgZm9yICJicmVha2luZyBib3VuZGFyaWVzIiAtIGppdHRlciBhbmQgY2hyb21hdGljIHNoaWZ0IGludGVuc2l0eQ0KICAgICAgICAgICAgbGV0IGppdHRlclN0cmVuZ3RoID0gMSArIE1hdGgucmFuZG9tKCkgKiAyOyAvLyBIb3cgZmFyIHBpeGVscyBjYW4gbW9tZW50YXJpbHkgZGlzcGxhY2UNCiAgICAgICAgICAgIGxldCBjaHJvbWFTaGlmdFN0cmVuZ3RoID0gMC41ICsgTWF0aC5yYW5kb20oKSAqIDEuNTsgLy8gSW50ZW5zaXR5IG9mIHRlbXBvcmFyeSBjb2xvciBzaGlmdHMNCg0KICAgICAgICAgICAgcGl4Yml4ZWxzLnB1c2goew0KICAgICAgICAgICAgICAgIHg6IHgsDQogICAgICAgICAgICAgICAgeTogeSwNCiAgICAgICAgICAgICAgICBzdGFydENvbG9yOiBzdGFydENvbG9yLA0KICAgICAgICAgICAgICAgIHRhcmdldENvbG9yOiB0YXJnZXRDb2xvciwNCiAgICAgICAgICAgICAgICBjb2xsYXBzZUZyYW1lOiBjb2xsYXBzZUZyYW1lLA0KICAgICAgICAgICAgICAgIGppdHRlclN0cmVuZ3RoOiBqaXR0ZXJTdHJlbmd0aCwNCiAgICAgICAgICAgICAgICBjaHJvbWFTaGlmdFN0cmVuZ3RoOiBjaHJvbWFTaGlmdFN0cmVuZ3RoLA0KICAgICAgICAgICAgICAgIGluaXRpYWxEZWxheTogTWF0aC5yYW5kb20oKSAqIDAuNCAvLyBTbGlnaHQgaW5kaXZpZHVhbCBkZWxheSBmb3IgbW9yZSBvcmdhbmljIGZlZWwNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIE1haW4gYW5pbWF0aW9uIGxvb3AgYXBwbHlpbmcgdGhlIHF1YW50dW0gaml0dGVyIGFuZCBjb2xsYXBzZSBlZmZlY3QuDQogICAgICovDQogICAgdmFyIEFOSU1BVEUgPSAoKSA9PiB7DQogICAgICAgIC8vIENyZWF0ZSBhIG5ldyBJbWFnZURhdGEgb2JqZWN0IGZvciB0aGlzIGZyYW1lIHRvIGRyYXcgYWxsIHBpeGVscyBhdCBvbmNlDQogICAgICAgIHZhciBpbWFnZURhdGEgPSBjdHhiaS5jcmVhdGVJbWFnZURhdGEoYnJlZWQzNjAsIGhvb2cxODApOw0KICAgICAgICB2YXIgcGl4ZWxEYXRhID0gaW1hZ2VEYXRhLmRhdGE7IC8vIFRoZSAxRCBhcnJheSByZXByZXNlbnRpbmcgUkdCQSB2YWx1ZXMNCg0KICAgICAgICBsZXQgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWViYiAvIHRvdGFsRnJhbWVzYmI7DQogICAgICAgIGxldCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOw0KDQogICAgICAgIHBpeGJpeGVscy5mb3JFYWNoKHAgPT4gew0KICAgICAgICAgICAgbGV0IG9yaWdpbmFsUGl4ZWxJZHggPSAocC55ICogYnJlZWQzNjAgKyBwLngpICogNDsNCiAgICAgICAgICAgIGxldCBjdXJyZW50Q29sb3IgPSBbMCwgMCwgMCwgMjU1XTsgLy8gRGVmYXVsdCB0byBibGFjayBmb3Igc2FmZXR5DQoNCiAgICAgICAgICAgIC8vIEFkanVzdCBpbmRpdmlkdWFsIHBpeGVsIHByb2dyZXNzIGJhc2VkIG9uIGl0cyBpbml0aWFsRGVsYXkNCiAgICAgICAgICAgIGxldCBwaXhlbFByb2dyZXNzID0gTWF0aC5tYXgoMCwgcHJvZ3Jlc3MgLSBwLmluaXRpYWxEZWxheSk7DQogICAgICAgICAgICBsZXQgcGl4ZWxFYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocGl4ZWxQcm9ncmVzcyk7DQoNCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHAuY29sbGFwc2VGcmFtZSkgew0KICAgICAgICAgICAgICAgIC8vIC0tLSBRVUFOVFVNIEpJVFRFUiAvIFNVUEVSUE9TSVRJT04gUEhBU0UgLS0tDQogICAgICAgICAgICAgICAgLy8gSW50cm9kdWNlIHBvc2l0aW9uYWwgaml0dGVyLCBmYWRpbmcgb3V0IGFzIGNvbGxhcHNlIGFwcHJvYWNoZXMNCiAgICAgICAgICAgICAgICBsZXQgaml0dGVyTWFnbml0dWRlID0gcC5qaXR0ZXJTdHJlbmd0aCAqICgxIC0gcGl4ZWxFYXNlZFByb2dyZXNzKSAqIDU7IC8vIFN0cm9uZ2VyIGppdHRlciBhdCBzdGFydA0KICAgICAgICAgICAgICAgIGxldCBqaXR0ZXJYID0gTWF0aC5zaW4oY3VycmVudEZyYW1lYmIgKiAwLjUgKyBwLnggKiAwLjEpICogaml0dGVyTWFnbml0dWRlOw0KICAgICAgICAgICAgICAgIGxldCBqaXR0ZXJZID0gTWF0aC5jb3MoY3VycmVudEZyYW1lYmIgKiAwLjUgKyBwLnkgKiAwLjEpICogaml0dGVyTWFnbml0dWRlOw0KDQogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSAocG90ZW50aWFsbHkgaml0dGVyZWQpIHJlbmRlciBwb3NpdGlvbg0KICAgICAgICAgICAgICAgIGxldCByZW5kZXJYID0gTWF0aC5yb3VuZChwLnggKyBqaXR0ZXJYKTsNCiAgICAgICAgICAgICAgICBsZXQgcmVuZGVyWSA9IE1hdGgucm91bmQocC55ICsgaml0dGVyWSk7DQoNCiAgICAgICAgICAgICAgICAvLyBDbGFtcCByZW5kZXIgcG9zaXRpb24gdG8gY2FudmFzIGJvdW5kcw0KICAgICAgICAgICAgICAgIHJlbmRlclggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihicmVlZDM2MCAtIDEsIHJlbmRlclgpKTsNCiAgICAgICAgICAgICAgICByZW5kZXJZID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oaG9vZzE4MCAtIDEsIHJlbmRlclkpKTsNCg0KICAgICAgICAgICAgICAgIGxldCByZW5kZXJQaXhlbElkeCA9IChyZW5kZXJZICogYnJlZWQzNjAgKyByZW5kZXJYKSAqIDQ7DQoNCiAgICAgICAgICAgICAgICAvLyBRdWFudHVtIGNvbG9yIHN0YXRlOiBibGVuZCBiYXNlZCBvbiBhIHByb2JhYmlsaXN0aWMgZmFjdG9yIGFuZCBlYXNlZCBwcm9ncmVzcw0KICAgICAgICAgICAgICAgIGxldCBibGVuZEZhY3RvciA9IChNYXRoLnJhbmRvbSgpICogMC4zICsgcGl4ZWxFYXNlZFByb2dyZXNzICogMC43KTsgLy8gTW9yZSB0YXJnZXQtbGlrZSBhcyBwcm9ncmVzcyBpbmNyZWFzZXMNCiAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHAuc3RhcnRDb2xvciwgcC50YXJnZXRDb2xvciwgYmxlbmRGYWN0b3IpOw0KDQogICAgICAgICAgICAgICAgLy8gIkJyZWFraW5nIGJvdW5kYXJpZXMiIHdpdGggdGVtcG9yYXJ5IGludGVuc2UgY29sb3Igc2hpZnRzIChjaHJvbWF0aWMgYWJlcnJhdGlvbi9lbmVyZ3kgYnVyc3QpDQogICAgICAgICAgICAgICAgaWYgKE1hdGgucmFuZG9tKCkgPCAoMSAtIHBpeGVsRWFzZWRQcm9ncmVzcykgKiAwLjQpIHsgLy8gTW9yZSBwcm9taW5lbnQgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgaml0dGVyDQogICAgICAgICAgICAgICAgICAgIGxldCBzaGlmdCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDgwICogcC5jaHJvbWFTaGlmdFN0cmVuZ3RoICogKDEgLSBwaXhlbEVhc2VkUHJvZ3Jlc3MpOw0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3JbMF0gPSBNYXRoLm1pbigyNTUsIE1hdGgubWF4KDAsIGN1cnJlbnRDb2xvclswXSArIHNoaWZ0KSk7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xvclsxXSA9IE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMCwgY3VycmVudENvbG9yWzFdIC0gc2hpZnQgLyAyKSk7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xvclsyXSA9IE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMCwgY3VycmVudENvbG9yWzJdICsgc2hpZnQgLyAyKSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gQXBwbHkgc2xpZ2h0IHRyYW5zcGFyZW5jeSB0byBqaXR0ZXJpbmcgcGl4ZWxzDQogICAgICAgICAgICAgICAgY3VycmVudENvbG9yWzNdID0gTWF0aC5tYXgoMCwgcC5zdGFydENvbG9yWzNdICogKDAuNCArIDAuNiAqICgxIC0gcGl4ZWxFYXNlZFByb2dyZXNzKSkpOw0KDQogICAgICAgICAgICAgICAgLy8gU2V0IHBpeGVsIGRhdGEgYXQgdGhlIChwb3NzaWJseSBqaXR0ZXJlZCkgcG9zaXRpb24NCiAgICAgICAgICAgICAgICBwaXhlbERhdGFbcmVuZGVyUGl4ZWxJZHhdID0gY3VycmVudENvbG9yWzBdOw0KICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtyZW5kZXJQaXhlbElkeCArIDFdID0gY3VycmVudENvbG9yWzFdOw0KICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtyZW5kZXJQaXhlbElkeCArIDJdID0gY3VycmVudENvbG9yWzJdOw0KICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtyZW5kZXJQaXhlbElkeCArIDNdID0gY3VycmVudENvbG9yWzNdOw0KDQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIC0tLSBDT0xMQVBTRSBQSEFTRSAtLS0NCiAgICAgICAgICAgICAgICAvLyBQaXhlbCBoYXMgImNvbGxhcHNlZCIgdG8gaXRzIGZpbmFsIHN0YXRlLg0KICAgICAgICAgICAgICAgIC8vIEFwcGx5IGEgdGVtcG9yYXJ5ICJyZXNpZHVhbCBlbmVyZ3kiIGdsb3cvZmxpY2tlciBhZnRlciBjb2xsYXBzZS4NCiAgICAgICAgICAgICAgICBsZXQgZnJhbWVzQWZ0ZXJDb2xsYXBzZSA9IGN1cnJlbnRGcmFtZWJiIC0gcC5jb2xsYXBzZUZyYW1lOw0KICAgICAgICAgICAgICAgIGlmIChmcmFtZXNBZnRlckNvbGxhcHNlIDwgMTUpIHsgLy8gR2xvdyBmb3IgYSBmZXcgZnJhbWVzDQogICAgICAgICAgICAgICAgICAgIGxldCBnbG93SW50ZW5zaXR5ID0gMSAtIChmcmFtZXNBZnRlckNvbGxhcHNlIC8gMTUpOw0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHAudGFyZ2V0Q29sb3IsIFsyNTUsIDI1NSwgMjU1LCAyNTVdLCBnbG93SW50ZW5zaXR5ICogMC4zKTsgLy8gTWl4IHdpdGggd2hpdGUgZm9yIGdsb3cNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudENvbG9yWzNdID0gcC50YXJnZXRDb2xvclszXTsgLy8gTWFpbnRhaW4gb3JpZ2luYWwgYWxwaGENCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3IgPSBwLnRhcmdldENvbG9yOyAvLyBGdWxseSByZXNvbHZlZCB0byB0YXJnZXQgY29sb3INCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAvLyBTZXQgcGl4ZWwgZGF0YSBhdCBpdHMgb3JpZ2luYWwsIHN0YWJsZSBwb3NpdGlvbg0KICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtvcmlnaW5hbFBpeGVsSWR4XSA9IGN1cnJlbnRDb2xvclswXTsNCiAgICAgICAgICAgICAgICBwaXhlbERhdGFbb3JpZ2luYWxQaXhlbElkeCArIDFdID0gY3VycmVudENvbG9yWzFdOw0KICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtvcmlnaW5hbFBpeGVsSWR4ICsgMl0gPSBjdXJyZW50Q29sb3JbMl07DQogICAgICAgICAgICAgICAgcGl4ZWxEYXRhW29yaWdpbmFsUGl4ZWxJZHggKyAzXSA9IGN1cnJlbnRDb2xvclszXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQoNCiAgICAgICAgLy8gRHJhdyBhbGwgYWNjdW11bGF0ZWQgcGl4ZWwgZGF0YSB0byB0aGUgY2FudmFzIGluIG9uZSBnbw0KICAgICAgICBjdHhiaS5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTsNCg0KICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7DQogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOw0KICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKEFOSU1BVEUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLg0KDQogICAgICAgICAgICAvLyAxLiBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgY3Jpc3BseSB0byBlbnN1cmUgbm8gcmVzaWR1YWwgZWZmZWN0cyBmcm9tIHRoZSB0cmFuc2l0aW9uLg0KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgICAgICAvLyAyLiBTV0FQIE9CSkVDVFM6IFRoZSBvbGQgdGFyZ2V0IGltYWdlIG9iamVjdCAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSBvYmplY3QgKEEpLg0KICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOw0KDQogICAgICAgICAgICAvLyAzLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLg0KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7DQoNCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKSBmb3IgdGhlIG5leHQgdHJhbnNpdGlvbi4NCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV3IG5leHQgaW1hZ2UgKEMpLg0KICAgICAgICAgICAgc2V0VGltZW91dCgibG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkiLCAxNTAwKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhbmQgc3RhcnRzIGEgbmV3IGFuaW1hdGlvbiBzZXF1ZW5jZSAoZS5nLiwgQS0+QiwgdGhlbiBCLT5DKS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOyAvLyBSZXNldCBmcmFtZSBjb3VudGVyIGZvciB0aGUgbmV3IGFuaW1hdGlvbg0KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsgLy8gUHJlcGFyZSBwaXhlbCBkYXRhIGZvciB0aGUgbmV3IHRyYW5zaXRpb24NCiAgICAgICAgQU5JTUFURSgpOyAvLyBTdGFydCB0aGUgYW5pbWF0aW9uIGxvb3ANCiAgICB9Ow0KDQogICAgLy8gLS0tIEluaXRpYWwgQ2FsbCAtLS0NCiAgICAvLyBFbnN1cmUgdGhlIERPTSBpcyBmdWxseSBsb2FkZWQgYmVmb3JlIHRyeWluZyB0byBhY2Nlc3MgY2FudmFzIGVsZW1lbnRzDQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpbml0Q2FudmFzQW5kSW1hZ2VzKCk7DQogICAgfTsNCjwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg0KYGBg<br>Cgo8aHRtbCBsYW5nPSJlbiI+CjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPHRpdGxlPkNvbnRpbnVvdXMgVW5pcXVlIEltYWdlIFRyYW5zaXRpb248L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIC8qIEJhc2Ugc3R5bGVzICovCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgCiAgICAgICAgCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgIAogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOwogICAgICAgICAgICBtYXJnaW46IDA7CiAgICAgIAogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgICAgICBmb250LWZhbWlseTogc2Fucy1zZXJpZjsKICAgICAgICAgICAgY29sb3I6ICNlZWU7CiAgICAgICAgfQoKICAgICAgICAvKiBDb250YWluZXIgZm9yIHRoZSBjYW52YXMgKi8KICAgICAgICBjYW52YXMgewogICAgICAgICAgICB3aWR0aDogMTAwJTsgLyogTWF0Y2hpbmcgaW1hZ2Ugd2lkdGggZm9yIHBpY3N1bS5waG90b3MgKi8KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOyAvKiBNYXRjaGluZyBpbWFnZSBoZWlnaHQgZm9yIHBpY3N1bS5waG90b3MgKi8KICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOiAxMDAlIDEwMCU7CiAgICAgICAgICAgIGJvcmRlcjogMHB4IHNvbGlkICMzMzM7IC8qIEFkZGVkIGZvciB2aXN1YWwgY2xhcml0eSAqLwogICAgIAogICAgICAgIH0KICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiAqLwogICAgICAgICNhbmltYXRpb25DYW52YXMgewogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsKICAgICAgICAgICAgbWFyZ2luOiAwOwogICAgICAgICAgICBwYWRkaW5nOiAwOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHdpZHRoOiAxMDAlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7CiAgCiAgICAgICAgfQogICAgICAgIC5pbmZvIHsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMjBweDsKICAgICAgICAgICAgZm9udC1zaXplOiAwLjllbTsKICAgICAgICAgICAgY29sb3I6ICNjY2M7CiAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgICAgICAgbWF4LXdpZHRoOiAxMDAlOwpkaXNwbGF5Om5vbmU7CiAgICAgICAgfQogICAgICAgIC5pbmZvIHAgewogICAgICAgICAgICBtYXJnaW46IDVweCAwOwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgaWQ9J2NhbnZhcyc+CiAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48L2NhbnZhcz4KPC9kaXY+CjxkaXYgY2xhc3M9ImluZm8iPgogICAgPHA+SW1hZ2UgcGl4ZWxzIHRyYW5zaXRpb24gdG8gdGhlaXIgbWlycm9yZWQgbG9jYXRpb25zLjwvcD4KICAgIDxwPgogICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjpyZWQ7Ij5XYXZlIEFtcGxpdHVkZTogfFJfQSAtIFJfQid8PC9zcGFuPiwKICAgICAgICA8c3BhbiBzdHlsZT0iY29sb3I6bGlnaHRncmVlbjsiPldhdmUgRnJlcXVlbmN5OiAoR19BIC0gR19CJyk8L3NwYW4+LAogICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjpsaWdodGJsdWU7Ij5TcGluIFNwZWVkOiB8Ql9BIC0gQl9CJ3w8L3NwYW4+CiAgICA8L3A+CiAgICA8cD5TcGluIFJhZGl1czogQXZlcmFnZSBSR0JfQSArIFdhdmUgQW1wbGl0dWRlPC9wPgo8L2Rpdj4KPHNjcmlwdD4KICAgIC8vIC0tLSBJbWFnZSBTb3VyY2UgYW5kIE9iamVjdCBTdG9yYWdlIC0tLQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpVUkwqIG9mIHRoZSBjdXJyZW50bHkgbG9hZGVkIGltYWdlIHNldAogICAgLy8gVXNpbmcgRGF0ZS5ub3coKSBmb3IgdW5pcXVlIFVSTHMgdG8gcHJldmVudCBicm93c2VyIGNhY2hpbmcgb2YgdGhlIHNhbWUgaW1hZ2UKICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHA6Ly8xMjcuMC4wLjEvZ2V0UmFuZEltYWdlLnBocD9yYW5kb209JyArIERhdGUubm93KCk7CiAgICB2YXIgbmV4dFVSTCA9ICdodHRwOi8vMTI3LjAuMC4xL2dldFJhbmRJbWFnZS5waHA/cmFuZG9tPScgKyAoRGF0ZS5ub3coKSArIDEpOwoKICAgIC8vIFZhcmlhYmxlcyB0byBob2xkIHRoZSAqQWN0dWFsIEltYWdlIE9iamVjdHMqIGZvciB0aGUgYW5pbWF0aW9uCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KQogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpCgogICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQogICAgdmFyIGNhbnZhc2JiaTsKICAgIHZhciBjdHhiaTsKICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQogICAgdmFyIHBpeGJpeGVscyA9IFtdOyAgICAgICAvLyBTdG9yZXMgcGl4ZWwgYW5pbWF0aW9uIGRhdGEgZm9yIHRoZSBjdXJyZW50IHRyYW5zaXRpb24KCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDE1MDsgIC8vIEluY3JlYXNlZCBmcmFtZXMgZm9yIGEgc21vb3RoZXIsIGxvbmdlciB0cmFuc2l0aW9uCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOwoKICAgIC8vIERpbWVuc2lvbnMgZm9yIHRoZSBjYW52YXMgZWxlbWVudCAobWF0Y2hpbmcgcGljc3VtLnBob3RvcyByZXF1ZXN0KQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8KICAgIHZhciBob29nMTgwID0gNDUwOyAvLwoKICAgIC8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQogICAgLyoqCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuCiAgICAgKi8KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7CiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7CiAgICAgICAgfTsKICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOwogICAgICAgICAgICBjYWxsYmFjayhuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKSk7CiAgICAgICAgfTsKICAgICAgICBpbWcuc3JjID0gc3JjOwogICAgICAgIGltZy5jcm9zc09yaWdpbiA9ICJBbm9ueW1vdXMiOyAvLyBSZXF1aXJlZCBmb3IgZ2V0SW1hZ2VEYXRhIG9uIGV4dGVybmFsIGltYWdlcwogICAgfTsKCiAgICAvKioKICAgICAqIExvYWRzIHRoZSBuZXh0IGltYWdlIGluIHRoZSBzZXF1ZW5jZSBhbmQgc3RhcnRzIHRoZSB0cmFuc2l0aW9uLgogICAgICovCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSB7CiAgICAgICAgbGV0IG5ld0ltYWdlVVJMID0gbmV4dFVSTDsKCiAgICAgICAgaWYgKGltYWdlc2JpW25ld0ltYWdlVVJMXSkgewogICAgICAgICAgICAvLyBJZiBhbHJlYWR5IGNhY2hlZCwgdXNlIGl0IGltbWVkaWF0ZWx5ICh1bmxpa2VseSB3aXRoIERhdGUubm93KCkgVVJMcykKICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdOwogICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9hZEltYWdlYmIobmV3SW1hZ2VVUkwsIChlcnJvciwgaW1nKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOwogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignTmV3IGltYWdlIGZhaWxlZCB0byBsb2FkLiBSZXRyeWluZy4uLicpOwogICAgICAgICAgICAgICAgICAgIC8vIFJldHJ5IGxvYWRpbmcgdGhlIG5leHQgaW1hZ2UgYWZ0ZXIgYSBkZWxheQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgY2FudmFzIGFuZCBsb2FkcyB0aGUgaW5pdGlhbCB0d28gaW1hZ2VzIChBIGFuZCBCKS4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsKICAgICAgICBjYW52YXNiYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7CiAgICAgY2FudmFzYmJpLnN0eWxlLmhlaWdodCA9ICcxMDAlJzsKCiAgICAgY2FudmFzYmJpLnN0eWxlLndpZHRoID0gJzEwMCUnOwogICAgICAgIGNhbnZhc2JiaS53aWR0aCA9IGJyZWVkMzYwOwogICAgICAgIGNhbnZhc2JiaS5oZWlnaHQgPSBob29nMTgwOwogICAgICAgIGN0eGJpID0gY2FudmFzYmJpLmdldENvbnRleHQoJzJkJyk7CgogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07CiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsKICAgICAgICBsZXQgaGFzRXJyb3IgPSBmYWxzZTsKCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvcikgPT4gewogICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2FkZWRDb3VudCsrOwogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBpbWFnZXNiaVtjdXJyZW50VVJMXTsKICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXh0VVJMXTsKICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgdmVyeSBmaXJzdCBhbmltYXRpb24gKEEgLT4gQikKICAgICAgICAgICAgICAgICAgICBzdGFydEFuaW1hdGlvbmZ0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7CiAgICAgICAgICAgICAgICAgICAgLy8gWW91IG1pZ2h0IHdhbnQgdG8gZGlzcGxheSBhbiBlcnJvciBvciBsb2FkIGRlZmF1bHQgaW1hZ2VzIGhlcmUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGltYWdlc1RvTG9hZC5mb3JFYWNoKHNyYyA9PiBsb2FkSW1hZ2ViYihzcmMsIG9uSW1hZ2VMb2FkZWQpKTsKICAgIH0KCiAgICAvLyAtLS0gUGl4ZWwgYW5kIEVhc2luZyBVdGlsaXRpZXMgLS0tCiAgICAvLyBFYXNpbmcgZnVuY3Rpb24gZm9yIHNtb290aGVyIHRyYW5zaXRpb25zIChRdWludGljIEVhc2UgSW4vT3V0KQogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0OwoKICAgIC8qKgogICAgICogUHJlcGFyZXMgdGhlIHBpeGJpeGVscyBhcnJheSBieSBleHRyYWN0aW5nIHBpeGVsIGRhdGEgZnJvbSBjdXJyZW50SW1hZ2UgYW5kIG5leHRJbWFnZQogICAgICogYW5kIGNhbGN1bGF0aW5nIGluaXRpYWwvdGFyZ2V0IHN0YXRlcywgaW5jbHVkaW5nIHBhcmFtZXRlcnMgZm9yIHdhdmUgYW5kIHNwaW4gZWZmZWN0cy4KICAgICAqLwogICAgdmFyIHNldHVwSW5pdGlhbENhbnZhcyA9ICgpID0+IHsKICAgICAgICB2YXIgaW1nMSA9IGN1cnJlbnRJbWFnZTsKICAgICAgICB2YXIgaW1nMiA9IG5leHRJbWFnZTsKICAgICAgICBwaXhiaXhlbHMgPSBbXTsgLy8gQ2xlYXIgcHJldmlvdXMgcGl4ZWwgZGF0YSBmb3IgdGhlIG5ldyB0cmFuc2l0aW9uCgogICAgICAgIC8vIERyYXcgY3VycmVudCBpbWFnZSB0byBnZXQgaXRzIHBpeGVsIGRhdGEKICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsKICAgICAgICBjdHhiaS5kcmF3SW1hZ2UoaW1nMSwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOwogICAgICAgIHZhciBpbWFnZURhdGExID0gY3R4YmkuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CiAgICAgICAgdmFyIGRhdGExID0gaW1hZ2VEYXRhMS5kYXRhOwoKICAgICAgICAvLyBEcmF3IG5leHQgaW1hZ2UgdG8gYSB0ZW1wb3JhcnkgY2FudmFzIHRvIGdldCBpdHMgcGl4ZWwgZGF0YSB3aXRob3V0IGFmZmVjdGluZyBtYWluIGNhbnZhcwogICAgICAgIHZhciB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CnRlbXBDYW52YXMuc3R5bGUud2lkdGggPScxMDAlJzsKdGVtcENhbnZhcy5zdHlsZS5oZWlnaHQgPScxMDAlJzsKCiAgICAgICAgdmFyIHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IGNhbnZhc2JiaS53aWR0aDsKICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7CiAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UoaW1nMiwgMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOwogICAgICAgIHZhciBpbWFnZURhdGEyID0gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsKICAgICAgICB2YXIgZGF0YTIgPSBpbWFnZURhdGEyLmRhdGE7CgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY2FudmFzYmJpLmhlaWdodDsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgY2FudmFzYmJpLndpZHRoOyB4KyspIHsKICAgICAgICAgICAgICAgIGxldCBpZHggPSAoeSAqIGNhbnZhc2JiaS53aWR0aCArIHgpICogNDsgLy8gSW5kZXggZm9yIGN1cnJlbnQgcGl4ZWwgaW4gSW1hZ2UgQQoKICAgICAgICAgICAgICAgIGxldCBzdGFydENvbG9yID0gewogICAgICAgICAgICAgICAgICAgIHI6IGRhdGExW2lkeF0sCiAgICAgICAgICAgICAgICAgICAgZzogZGF0YTFbaWR4ICsgMV0sCiAgICAgICAgICAgICAgICAgICAgYjogZGF0YTFbaWR4ICsgMl0sCiAgICAgICAgICAgICAgICAgICAgYTogZGF0YTFbaWR4ICsgM10KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgLy8gTWlycm9yZWQgdGFyZ2V0IGNvb3JkaW5hdGVzIGZvciBJbWFnZSBCCiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0WCA9IGNhbnZhc2JiaS53aWR0aCAtIDEgLSB4OwogICAgICAgICAgICAgICAgbGV0IHRhcmdldFkgPSBjYW52YXNiYmkuaGVpZ2h0IC0gMSAtIHk7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0SWR4ID0gKHRhcmdldFkgKiBjYW52YXNiYmkud2lkdGggKyB0YXJnZXRYKSAqIDQ7IC8vIEluZGV4IGZvciB0YXJnZXQgcGl4ZWwgaW4gSW1hZ2UgQgoKICAgICAgICAgICAgICAgIGxldCB0YXJnZXRDb2xvciA9IHsKICAgICAgICAgICAgICAgICAgICByOiBkYXRhMlt0YXJnZXRJZHhdLAogICAgICAgICAgICAgICAgICAgIGc6IGRhdGEyW3RhcmdldElkeCArIDFdLAogICAgICAgICAgICAgICAgICAgIGI6IGRhdGEyW3RhcmdldElkeCArIDJdLAogICAgICAgICAgICAgICAgICAgIGE6IGRhdGEyW3RhcmdldElkeCArIDNdCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwYXJhbWV0ZXJzIGZvciB0aGUgdW5pcXVlIGFuaW1hdGlvbiBlZmZlY3RzIGJhc2VkIG9uIGNvbG9yIGRpZmZlcmVuY2VzCiAgICAgICAgICAgICAgICAvLyBXYXZlIEFtcGxpdHVkZTogYWJzKHItcicpIC0+IG1heCAyNTUuIFNjYWxlcyB0byBwaXhlbCBvZmZzZXQuCiAgICAgICAgICAgICAgICBsZXQgYW1wbGl0dWRlID0gTWF0aC5hYnMoc3RhcnRDb2xvci5yIC0gdGFyZ2V0Q29sb3Iucik7CiAgICAgICAgICAgICAgICAvLyBXYXZlIEZyZXF1ZW5jeSAocHJvcG9ydGlvbmFsIHRvIHdhdmVsZW5ndGgpOiAoZy1nJykgLT4gcmFuZ2UgLTI1NSB0byAyNTUuIEFmZmVjdHMgd2F2ZSBjeWNsZXMuCiAgICAgICAgICAgICAgICBsZXQgd2F2ZWxlbmd0aEZhY3RvciA9IChzdGFydENvbG9yLmcgLSB0YXJnZXRDb2xvci5nKTsKICAgICAgICAgICAgICAgIC8vIERlcHRoIChhdmVyYWdlIFJHQik6IChyK2crYikvMyAtPiAwIHRvIDI1NS4gQWZmZWN0cyBzcGluIHJhZGl1cy4KICAgICAgICAgICAgICAgIGxldCBkZXB0aCA9IChzdGFydENvbG9yLnIgKyBzdGFydENvbG9yLmcgKyBzdGFydENvbG9yLmIpIC8gMzsKICAgICAgICAgICAgICAgIC8vIFNwaW4gU3BlZWQ6IGFicyhiLWInKSAtPiBtYXggMjU1LiBBZmZlY3RzIG51bWJlciBvZiByb3RhdGlvbnMuCiAgICAgICAgICAgICAgICBsZXQgc3BpbkZhY3RvciA9IE1hdGguYWJzKHN0YXJ0Q29sb3IuYiAtIHRhcmdldENvbG9yLmIpOwoKICAgICAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBzdGFydFg6IHgsIHN0YXJ0WTogeSwKICAgICAgICAgICAgICAgICAgICB0YXJnZXRYOiB0YXJnZXRYLCB0YXJnZXRZOiB0YXJnZXRZLAogICAgICAgICAgICAgICAgICAgIHN0YXJ0Q29sb3I6IHN0YXJ0Q29sb3IsIHRhcmdldENvbG9yOiB0YXJnZXRDb2xvciwKICAgICAgICAgICAgICAgICAgICBhbXBsaXR1ZGU6IGFtcGxpdHVkZSwgICAgICAgIC8vIEZvciB3YXZlIGFtcGxpdHVkZQogICAgICAgICAgICAgICAgICAgIHdhdmVsZW5ndGhGYWN0b3I6IHdhdmVsZW5ndGhGYWN0b3IsIC8vIEZvciB3YXZlIGZyZXF1ZW5jeQogICAgICAgICAgICAgICAgICAgIGRlcHRoOiBkZXB0aCwgICAgICAgICAgICAgICAgLy8gRm9yIHNwaW4gcmFkaXVzCiAgICAgICAgICAgICAgICAgICAgc3BpbkZhY3Rvcjogc3BpbkZhY3RvciAgICAgICAvLyBGb3Igc3BpbiBzcGVlZAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AuIENhbGN1bGF0ZXMgbmV3IHBvc2l0aW9ucyBhbmQgY29sb3JzIGZvciBlYWNoIHBpeGVsCiAgICAgKiBiYXNlZCBvbiB0aGUgY3VycmVudCBmcmFtZSBhbmQgYXBwbGllcyB3YXZlL3NwaW4gZWZmZWN0cy4KICAgICAqIFVzZXMgcHV0SW1hZ2VEYXRhIGZvciBwZXJmb3JtYW5jZS4KICAgICAqLwogICAgdmFyIEFOSU1BVEUgPSAoKSA9PiB7CiAgICAgICAgbGV0IHByb2dyZXNzID0gY3VycmVudEZyYW1lYmIgLyB0b3RhbEZyYW1lc2JiOwogICAgICAgIGxldCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAvLyBDcmVhdGUgYW4gSW1hZ2VEYXRhIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgZnJhbWUgdG8gZHJhdyBhbGwgcGl4ZWxzIGVmZmljaWVudGx5CiAgICAgICAgLy8gVGhpcyBlZmZlY3RpdmVseSBjbGVhcnMgdGhlIGNhbnZhcyBmb3IgdGhlIG5ldyBmcmFtZSBhcyBpdCdzIGFuIGVtcHR5IGltYWdlLgogICAgICAgIGxldCBvdXRwdXRJbWFnZURhdGEgPSBjdHhiaS5jcmVhdGVJbWFnZURhdGEoY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsKICAgICAgICBsZXQgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBpeGJpeGVscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBsZXQgcCA9IHBpeGJpeGVsc1tpXTsKCiAgICAgICAgICAgIC8vIDEuIENvbG9yIEludGVycG9sYXRpb24KICAgICAgICAgICAgbGV0IGN1clIgPSBNYXRoLnJvdW5kKHAuc3RhcnRDb2xvci5yICsgKHAudGFyZ2V0Q29sb3IuciAtIHAuc3RhcnRDb2xvci5yKSAqIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICBsZXQgY3VyRyA9IE1hdGgucm91bmQocC5zdGFydENvbG9yLmcgKyAocC50YXJnZXRDb2xvci5nIC0gcC5zdGFydENvbG9yLmcpICogZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgICAgIGxldCBjdXJCID0gTWF0aC5yb3VuZChwLnN0YXJ0Q29sb3IuYiArIChwLnRhcmdldENvbG9yLmIgLSBwLnN0YXJ0Q29sb3IuYikgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgbGV0IGN1ckEgPSBNYXRoLnJvdW5kKHAuc3RhcnRDb2xvci5hICsgKHAudGFyZ2V0Q29sb3IuYSAtIHAuc3RhcnRDb2xvci5hKSAqIGVhc2VkUHJvZ3Jlc3MpOwoKICAgICAgICAgICAgLy8gMi4gUG9zaXRpb24gSW50ZXJwb2xhdGlvbiAoTGluZWFyIEJhc2UgUGF0aCkKICAgICAgICAgICAgbGV0IGN1cnJlbnRYID0gcC5zdGFydFggKyAocC50YXJnZXRYIC0gcC5zdGFydFgpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgbGV0IGN1cnJlbnRZID0gcC5zdGFydFkgKyAocC50YXJnZXRZIC0gcC5zdGFydFkpICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgIC8vIDMuIEFwcGx5IFdhdmUgYW5kIFNwaW4gRWZmZWN0cyBiYXNlZCBvbiBjYWxjdWxhdGVkIHBhcmFtZXRlcnMKCiAgICAgICAgICAgIC8vIC0tLSBXYXZlIERpc3BsYWNlbWVudCAocGVycGVuZGljdWxhciB0byBsaW5lYXIgcGF0aCkgLS0tCiAgICAgICAgICAgIGxldCBwYXRoVmVjWCA9IHAudGFyZ2V0WCAtIHAuc3RhcnRYOwogICAgICAgICAgICBsZXQgcGF0aFZlY1kgPSBwLnRhcmdldFkgLSBwLnN0YXJ0WTsKICAgICAgICAgICAgbGV0IHBhdGhMZW5ndGggPSBNYXRoLnNxcnQocGF0aFZlY1ggKiBwYXRoVmVjWCArIHBhdGhWZWNZICogcGF0aFZlY1kpOwoKICAgICAgICAgICAgbGV0IHBlcnBYID0gMCwgcGVycFkgPSAwOwogICAgICAgICAgICBpZiAocGF0aExlbmd0aCA+IDAuMDEpIHsgLy8gTm9ybWFsaXplIHBhdGggdmVjdG9yIGFuZCBnZXQgcGVycGVuZGljdWxhcgogICAgICAgICAgICAgICAgcGF0aFZlY1ggLz0gcGF0aExlbmd0aDsKICAgICAgICAgICAgICAgIHBhdGhWZWNZIC89IHBhdGhMZW5ndGg7CiAgICAgICAgICAgICAgICBwZXJwWCA9IC1wYXRoVmVjWTsgLy8gUGVycGVuZGljdWxhciB2ZWN0b3IgKGUuZy4sIHJvdGF0aW5nIDkwIGRlZyBjbG9ja3dpc2UpCiAgICAgICAgICAgICAgICBwZXJwWSA9IHBhdGhWZWNYOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gSWYgc3RhcnQgYW5kIHRhcmdldCBhcmUgdmVyeSBjbG9zZSwgdXNlIGFyYml0cmFyeSBwZXJwZW5kaWN1bGFyIChlLmcuLCBob3Jpem9udGFsKQogICAgICAgICAgICAgICAgcGVycFggPSAxOyBwZXJwWSA9IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFNjYWxlIHdhdmVBbXBsaXR1ZGUgKDAtMjU1KSB0byBhIHBpeGVsIG9mZnNldCAoMC0zMHB4KQogICAgICAgICAgICBsZXQgd2F2ZUFtcGxpdHVkZVB4ID0gKHAuYW1wbGl0dWRlIC8gMjU1KSAqIDMwOwogICAgICAgICAgICAvLyBTY2FsZSB3YXZlbGVuZ3RoRmFjdG9yICgtMjU1IHRvIDI1NSkgdG8gd2F2ZSBmcmVxdWVuY3kgKDUgdG8gMTUgY3ljbGVzKQogICAgICAgICAgICBsZXQgd2F2ZUZyZXF1ZW5jeSA9IDUgKyAoTWF0aC5hYnMocC53YXZlbGVuZ3RoRmFjdG9yKSAvIDI1NSkgKiAxMDsKICAgICAgICAgICAgbGV0IHdhdmVPZmZzZXQgPSBNYXRoLnNpbihlYXNlZFByb2dyZXNzICogTWF0aC5QSSAqIDIgKiB3YXZlRnJlcXVlbmN5KSAqIHdhdmVBbXBsaXR1ZGVQeDsKCiAgICAgICAgICAgIGN1cnJlbnRYICs9IHBlcnBYICogd2F2ZU9mZnNldDsKICAgICAgICAgICAgY3VycmVudFkgKz0gcGVycFkgKiB3YXZlT2Zmc2V0OwoKICAgICAgICAgICAgLy8gLS0tIFNwaW4vUm91bmQgRWZmZWN0IChvcmJpdGFsIG1vdGlvbiBhcm91bmQgY3VycmVudCBwb3NpdGlvbikgLS0tCiAgICAgICAgICAgIC8vIFNwaW4gUmFkaXVzOiBwcm9wb3J0aW9uYWwgdG8gZGVwdGggKDAtMjU1KSAmIHdhdmUgYW1wbGl0dWRlLCBzY2FsZWQgdG8gKDAtMjVweCkKICAgICAgICAgICAgbGV0IHNwaW5SYWRpdXMgPSAocC5kZXB0aCAvIDI1NSAqIDE1KSArIChwLmFtcGxpdHVkZSAvIDI1NSAqIDEwKTsKICAgICAgICAgICAgLy8gU3BpbiBTcGVlZDogcHJvcG9ydGlvbmFsIHRvIHNwaW5GYWN0b3IgKDAtMjU1KSwgZGV0ZXJtaW5pbmcgbnVtYmVyIG9mIHJvdGF0aW9ucyAoMSB0byAxMCByb3RhdGlvbnMpCiAgICAgICAgICAgIGxldCBzcGluU3BlZWQgPSAxICsgKHAuc3BpbkZhY3RvciAvIDI1NSkgKiA5OwogICAgICAgICAgICBsZXQgc3BpbkFuZ2xlID0gZWFzZWRQcm9ncmVzcyAqIE1hdGguUEkgKiAyICogc3BpblNwZWVkOwoKICAgICAgICAgICAgY3VycmVudFggKz0gc3BpblJhZGl1cyAqIE1hdGguY29zKHNwaW5BbmdsZSk7CiAgICAgICAgICAgIGN1cnJlbnRZICs9IHNwaW5SYWRpdXMgKiBNYXRoLnNpbihzcGluQW5nbGUpOwoKICAgICAgICAgICAgLy8gRW5zdXJlIGNhbGN1bGF0ZWQgY29vcmRpbmF0ZXMgYXJlIHdpdGhpbiBjYW52YXMgYm91bmRhcmllcyBhbmQgYXJlIGludGVnZXJzCiAgICAgICAgICAgIGxldCBmaW5hbFggPSBNYXRoLmZsb29yKE1hdGgubWF4KDAsIE1hdGgubWluKGNhbnZhc2JiaS53aWR0aCAtIDEsIGN1cnJlbnRYKSkpOwogICAgICAgICAgICBsZXQgZmluYWxZID0gTWF0aC5mbG9vcihNYXRoLm1heCgwLCBNYXRoLm1pbihjYW52YXNiYmkuaGVpZ2h0IC0gMSwgY3VycmVudFkpKSk7CgogICAgICAgICAgICAvLyBQbGFjZSB0aGUgcGl4ZWwgZGF0YSBpbnRvIHRoZSBvdXRwdXQgSW1hZ2VEYXRhIGFycmF5CiAgICAgICAgICAgIC8vIE5vdGU6IElmIG11bHRpcGxlIHBpeGVscyBtYXAgdG8gdGhlIHNhbWUgZmluYWxYLCBmaW5hbFksIHRoZSBsYXN0IG9uZSBwcm9jZXNzZWQgd2lucy4KICAgICAgICAgICAgbGV0IG91dHB1dElkeCA9IChmaW5hbFkgKiBjYW52YXNiYmkud2lkdGggKyBmaW5hbFgpICogNDsKICAgICAgICAgICAgb3V0cHV0RGF0YVtvdXRwdXRJZHhdID0gY3VyUjsKICAgICAgICAgICAgb3V0cHV0RGF0YVtvdXRwdXRJZHggKyAxXSA9IGN1ckc7CiAgICAgICAgICAgIG91dHB1dERhdGFbb3V0cHV0SWR4ICsgMl0gPSBjdXJCOwogICAgICAgICAgICBvdXRwdXREYXRhW291dHB1dElkeCArIDNdID0gY3VyQTsgLy8gQWxwaGEgY2hhbm5lbAogICAgICAgIH0KCiAgICAgICAgLy8gRHJhdyB0aGUgYXNzZW1ibGVkIHBpeGVsIGRhdGEgdG8gdGhlIGNhbnZhcyBpbiBvbmUgZ28KICAgICAgICBjdHhiaS5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgewogICAgICAgICAgICBjdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQW5pbWF0aW9uIChBIC0+IEIpIGlzIGNvbXBsZXRlLiBQcmVwYXJlIHRoZSBuZXh0IHJvdW5kIChCIC0+IEMpLgoKICAgICAgICAgICAgLy8gMS4gRHJhdyB0aGUgZmluYWwgaW1hZ2UgKEIpIHRvIHRoZSBjYW52YXMgdG8gZW5zdXJlIGEgY2xlYW4sIGNvbXBsZXRlIHRhcmdldCBpbWFnZQogICAgICAgICAgICAvLyBUaGlzIGNvdmVycyBhbnkgc3BhcnNlIHBpeGVscyBmcm9tIHRoZSBhbmltYXRpb24uCiAgICAgICAgICAgIGN0eGJpLmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7CgogICAgICAgICAgICAvLyAyLiBTV0FQIE9CSkVDVFM6IFRoZSBvbGQgdGFyZ2V0IGltYWdlIG9iamVjdCAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSBvYmplY3QgKEEpLgogICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7CgogICAgICAgICAgICAvLyAzLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLgogICAgICAgICAgICBjdXJyZW50VVJMID0gbmV4dFVSTDsKCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKSBmb3IgdGhlIG5leHQgYW5pbWF0aW9uIGN5Y2xlCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cDovLzEyNy4wLjAuMS9nZXRSYW5kSW1hZ2UucGhwP3JhbmRvbT0nICsgKERhdGUubm93KCkgKyAyKTsgLy8gRW5zdXJlIG5ldyB1bmlxdWUgVVJMCgogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgbmV4dCBpbWFnZSAoQykuIE5vIGRlbGF5IG5lZWRlZC4KICAgICAgICAgICAgc2V0VGltZW91dCgibG9hZE5leHRJbWFnZUFuZFN0YXJ0KCkiLCAxNTAwKTsKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgYW5kIHN0YXJ0cyBhIG5ldyBhbmltYXRpb24gc2VxdWVuY2UuCiAgICAgKi8KICAgIHZhciBzdGFydEFuaW1hdGlvbmZ0ID0gKCkgPT4gewogICAgICAgIGN1cnJlbnRGcmFtZWJiID0gMDsgLy8gUmVzZXQgZnJhbWUgY291bnRlciBmb3IgdGhlIG5ldyBhbmltYXRpb24KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsgLy8gUHJlcGFyZSBwaXhlbCBkYXRhIGZvciB0aGUgbmV3IHRyYW5zaXRpb24KICAgICAgICBBTklNQVRFKCk7IC8vIFN0YXJ0IHRoZSBhbmltYXRpb24gbG9vcAogICAgfTsKCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQogICAgd2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGluaXRDYW52YXNBbmRJbWFnZXMoKTsKICAgIH07Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4KYGBg<br>PGh0bWwgbGFuZz0iZW4iPg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPg0KICAgIDx0aXRsZT5RdWFudHVtIFBpeGVsIFRyYW5zaXRpb248L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7DQogICAgICAgICAgICBjb2xvcjogI2VlZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovDQogICAgICAgICNjYW52YXMgew0KICAgICAgICAgICAgLyogVGhpcyBkaXYgc2V0cyB0aGUgZGlzcGxheSBzaXplIG9mIHlvdXIgYW5pbWF0aW9uICovDQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogMTAwJSAxMDAlOw0KICAgICAgICAgICAgYm9yZGVyOiAwcHggc29saWQgIzU1NTsgLyogQWRkZWQgZm9yIHZpc2liaWxpdHkgKi8NCiAgICANCiAgICAgICAgfQ0KICAgICAgICAvKiBUaGUgY2FudmFzIGl0c2VsZiB3aWxsIHNjYWxlIHRvIGZpbGwgaXRzIHBhcmVudCBkaXYgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IHBpeGVsYXRlZDsgLyogSGVscHMgbWFpbnRhaW4gc2hhcnAgcGl4ZWxzIHdoZW4gc2NhbGVkIHVwICovDQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IC1tb3otY3Jpc3AtZWRnZXM7DQogICAgICAgICAgICBpbWFnZS1yZW5kZXJpbmc6IGNyaXNwLWVkZ2VzOw0KICAgICAgICB9DQoNCiAgICAgICAgLmluZm8gew0KICAgICAgICAgICAgbWFyZ2luLXRvcDogMjBweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC45ZW07DQogICAgICAgICAgICBjb2xvcjogI2NjYzsNCmRpc3BsYXk6bm9uZTsNCiAgICAgICAgfQ0KICAgIDwvc3R5bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxkaXYgaWQ9J2NhbnZhcycgc3R5bGU9J3dpZHRoOjEwMCU7aGVpZ2h0OjEwMCU7Jz4NCiAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwIHN0eWxlPSd3aWR0aDoxMDAlO2hlaWdodDoxMDAlJz48L2NhbnZhcz4NCjwvZGl2Pg0KPGRpdiBjbGFzcz0iaW5mbyI+DQogICAgUXVhbnR1bSBQaXhlbCBUcmFuc2l0aW9uIChpbnNwaXJlZCBieSAiNjgxNTU2IikNCjwvZGl2Pg0KPHNjcmlwdD4NCiAgICAvLyAtLS0gSW1hZ2UgU291cmNlIGFuZCBPYmplY3QgU3RvcmFnZSAtLS0NCiAgICAvLyBWYXJpYWJsZXMgdG8gaG9sZCB0aGUgKlVSTCogb2YgdGhlIGN1cnJlbnRseSBsb2FkZWQgaW1hZ2Ugc2V0DQogICAgLy8gVXNpbmcgMzYweDY0MCB0byBtYXRjaCBjb21tb24gbW9iaWxlIGFzcGVjdCByYXRpb3MgYW5kIGZvciBjbGVhciBwaXhlbCBhcnQNCiAgICB2YXIgY3VycmVudFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQogICAgdmFyIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpBY3R1YWwgSW1hZ2UgT2JqZWN0cyogZm9yIHRoZSBhbmltYXRpb24NCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KQ0KICAgIHZhciBuZXh0SW1hZ2UgPSBudWxsOyAgICAvLyBJbWFnZSBCIChUaGUgVGFyZ2V0KQ0KDQogICAgLy8gLS0tIEdsb2JhbCBBbmltYXRpb24gVmFyaWFibGVzIC0tLQ0KICAgIHZhciBjYW52YXNiYmk7DQogICAgdmFyIGN0eGJpOw0KICAgIHZhciBpbWFnZXNiaSA9IHt9OyAgICAgICAgLy8gU3RvcmVzIEFMTCBsb2FkZWQgSW1hZ2Ugb2JqZWN0cyAoa2V5ZWQgYnkgVVJMKQ0KICAgIHZhciBwaXhiaXhlbHMgPSBbXTsgICAgICAgICAgICAgLy8gQXJyYXkgdG8gaG9sZCBvdXIgY3VzdG9tIHBpeGVsL3BhcnRpY2xlIG9iamVjdHMNCg0KICAgIHZhciB0b3RhbEZyYW1lc2JiID0gMTIwOyAvLyBJbmNyZWFzZWQgZnJhbWVzIGZvciBhIHNtb290aGVyLCBsb25nZXIgdHJhbnNpdGlvbg0KICAgIHZhciBjdXJyZW50RnJhbWViYiA9IDA7DQoNCiAgICAvLyBEaW1lbnNpb25zIGZvciB0aGUgY2FudmFzIGVsZW1lbnQgKHRoZSBpbnRlcm5hbCBkcmF3aW5nIHJlc29sdXRpb24pDQogICAgLy8gVGhlc2Ugc2hvdWxkIG1hdGNoIHRoZSBwaWNzdW0ucGhvdG9zIGRpbWVuc2lvbnMgZm9yIDE6MSBwaXhlbCBtYXBwaW5nDQogICAgdmFyIGJyZWVkMzYwID0gODAwOyAgLy8gICAgICAvLyBXaWR0aA0KICAgIHZhciBob29nMTgwID0gNDUwOyAvLyAgICAgIC8vIEhlaWdodA0KDQogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tDQogICAgLyoqDQogICAgICogTG9hZHMgYSBzaW5nbGUgaW1hZ2UgaW50byB0aGUgaW1hZ2VzYmkgbWFwLg0KICAgICAqLw0KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7DQogICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsNCiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7DQogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsNCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLnNyYyA9IHNyYzsNCiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIExvYWRzIHRoZSBuZXh0IGltYWdlIGluIHRoZSBzZXF1ZW5jZSBhbmQgc3RhcnRzIHRoZSB0cmFuc2l0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsNCiAgICAgICAgbGV0IG5ld0ltYWdlVVJMID0gbmV4dFVSTDsNCg0KICAgICAgICAvLyAxLiBMb2FkIHRoZSBuZXcgaW1hZ2UgKEMpDQogICAgICAgIGlmIChpbWFnZXNiaVtuZXdJbWFnZVVSTF0pIHsNCiAgICAgICAgICAgIC8vIElmIGFscmVhZHkgY2FjaGVkLCB1c2UgaXQgaW1tZWRpYXRlbHkNCiAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25ld0ltYWdlVVJMXTsNCiAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICAvLyAyLiBTdGFydCB0aGUgdHJhbnNpdGlvbiBmcm9tIEIgdG8gQyBvbmNlIEMgaXMgbG9hZGVkDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHJ5IGxvYWRpbmcgdGhlIG5leHQgaW1hZ2UgYWZ0ZXIgYSBkZWxheQ0KICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGxvYWROZXh0SW1hZ2VBbmRTdGFydCwgMjAwMCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7DQogICAgICAgIC8vIEluaXRpYWxpemUgY2FudmFzIE9OTFkgT05DRQ0KICAgICAgICBjYW52YXNiYmkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uQ2FudmFzJyk7DQogICAgICAgIGNhbnZhc2JiaS53aWR0aCA9IGJyZWVkMzYwOw0KICAgICAgICBjYW52YXNiYmkuaGVpZ2h0ID0gaG9vZzE4MDsNCiAgICAgICAgY3R4YmkgPSBjYW52YXNiYmkuZ2V0Q29udGV4dCgnMmQnKTsNCg0KICAgICAgICBsZXQgaW1hZ2VzVG9Mb2FkID0gW2N1cnJlbnRVUkwsIG5leHRVUkxdOw0KICAgICAgICBsZXQgbG9hZGVkQ291bnQgPSAwOw0KICAgICAgICBsZXQgaGFzRXJyb3IgPSBmYWxzZTsNCg0KICAgICAgICBjb25zdCBvbkltYWdlTG9hZGVkID0gKGVycm9yLCBpbWcpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnJvcikgew0KICAgICAgICAgICAgICAgIGhhc0Vycm9yID0gdHJ1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7DQogICAgICAgICAgICBpZiAobG9hZGVkQ291bnQgPT09IGltYWdlc1RvTG9hZC5sZW5ndGgpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWhhc0Vycm9yKSB7DQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSA9IGltYWdlc2JpW2N1cnJlbnRVUkxdOw0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWFnZXNiaVtuZXh0VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgdGhlIHZlcnkgZmlyc3QgYW5pbWF0aW9uIChBIC0+IEIpDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgIH0NCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICAvLyAocGFyc2VSR0JBIGFuZCBpbnRlcnBvbGF0ZUNvbG9yIGFyZSBub3QgZGlyZWN0bHkgdXNlZCBpbiB0aGUgbmV3IHBpeGVsIGFuaW1hdGlvbiBsb2dpYywNCiAgICAvLyBhcyB3ZSdyZSBpbnRlcnBvbGF0aW5nIFJHQkEgY29tcG9uZW50cyBkaXJlY3RseS4gS2VlcGluZyBlYXNlSW5PdXRRdWludC4pDQoNCiAgICB2YXIgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7DQoNCiAgICAvKioNCiAgICAgKiBQcmVwYXJlcyB0aGUgcGl4ZWwgZGF0YSBmb3IgdGhlIHF1YW50dW0gc2ltdWxhdGlvbiB0cmFuc2l0aW9uLg0KICAgICAqIEV4dHJhY3RzIHBpeGVsIGNvbG9ycyBmcm9tIGN1cnJlbnRJbWFnZSBhbmQgbmV4dEltYWdlIGFuZCBzZXRzIHVwDQogICAgICogaW5pdGlhbCBwb3NpdGlvbnMsIHRhcmdldCBwb3NpdGlvbnMsIGRlbGF5cywgYW5kIG9zY2lsbGF0aW9uIHBhcmFtZXRlcnMNCiAgICAgKiBmb3IgZWFjaCAicGl4ZWwgcGFydGljbGUiLg0KICAgICAqLw0KICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7DQogICAgICAgIHZhciBpbWcxID0gY3VycmVudEltYWdlOyAvLyBUaGUgc3RhcnQgaW1hZ2UNCiAgICAgICAgdmFyIGltZzIgPSBuZXh0SW1hZ2U7ICAgIC8vIFRoZSB0YXJnZXQgaW1hZ2UNCiAgICAgICAgcGl4Yml4ZWxzID0gW107IC8vIENsZWFyIHByZXZpb3VzIHBpeGVscw0KDQogICAgICAgIC8vIERyYXcgY3VycmVudEltYWdlIHRvIGdldCBpdHMgcGl4ZWwgZGF0YQ0KICAgICAgICBjdHhiaS5jbGVhclJlY3QoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCiAgICAgICAgY3R4YmkuZHJhd0ltYWdlKGltZzEsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICAgICAgdmFyIGRhdGExID0gY3R4YmkuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCkuZGF0YTsNCg0KICAgICAgICAvLyBEcmF3IG5leHRJbWFnZSB0byBhIHRlbXBvcmFyeSBjYW52YXMgdG8gZ2V0IGl0cyBwaXhlbCBkYXRhDQogICAgICAgIHZhciB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gY2FudmFzYmJpLndpZHRoOw0KICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7DQogICAgICAgIHRlbXBDdHguZHJhd0ltYWdlKGltZzIsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICAgICAgdmFyIGRhdGEyID0gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KS5kYXRhOw0KDQogICAgICAgIGNvbnN0IHBpeGVsU2l6ZSA9IDQ7IC8vIEVhY2ggInBhcnRpY2xlIiBpcyBhIDR4NCBibG9jayBvZiBwaXhlbHMNCiAgICAgICAgY29uc3QgbWF4RGVsYXlGcmFtZXMgPSB0b3RhbEZyYW1lc2JiICogMC40OyAvLyBNYXggZGVsYXkgZm9yIGEgcGFydGljbGUgdG8gc3RhcnQgKDQwJSBvZiB0b3RhbCkNCg0KICAgICAgICAvLyBVc2luZyAiNjgxNTU2IiBmb3IgcGFyYW1ldGVyIGluZmx1ZW5jZQ0KICAgICAgICBjb25zdCBiYXNlUmFuZG9tU2VlZCA9IDY4MTU1NjsNCiAgICAgICAgY29uc3QgbWF4SW5pdGlhbFNjYXR0ZXIgPSAoYmFzZVJhbmRvbVNlZWQgJSA1MCkgKyAyMDsgLy8gTWF4IGluaXRpYWwgc2NhdHRlciBkaXN0YW5jZSAoMjAtNjkpDQogICAgICAgIGNvbnN0IG1heFRhcmdldEppdHRlciA9IChiYXNlUmFuZG9tU2VlZCAlIDMwKSArIDU7ICAgIC8vIE1heCBqaXR0ZXIgYXQgdGhlIHRhcmdldCAoNS0zNCkNCiAgICAgICAgY29uc3QgYmFzZU9zY2lsbGF0aW9uQW1wID0gKGJhc2VSYW5kb21TZWVkICUgMTUpICsgMzsgLy8gQmFzZSBhbXBsaXR1ZGUgZm9yIG9zY2lsbGF0aW9uICgzLTE3KQ0KDQogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaG9vZzE4MDsgeSArPSBwaXhlbFNpemUpIHsNCiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgYnJlZWQzNjA7IHggKz0gcGl4ZWxTaXplKSB7DQogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogYnJlZWQzNjAgKyB4KSAqIDQ7IC8vIEluZGV4IGZvciB0aGUgdG9wLWxlZnQgcGl4ZWwgb2YgdGhlIGJsb2NrDQoNCiAgICAgICAgICAgICAgICAvLyBHZXQgc3RhcnQgYW5kIGVuZCBSR0JBIHZhbHVlcw0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UiA9IGRhdGExW2ldOw0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0RyA9IGRhdGExW2kgKyAxXTsNCiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEIgPSBkYXRhMVtpICsgMl07DQogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRBID0gZGF0YTFbaSArIDNdOw0KDQogICAgICAgICAgICAgICAgY29uc3QgZW5kUiA9IGRhdGEyW2ldOw0KICAgICAgICAgICAgICAgIGNvbnN0IGVuZEcgPSBkYXRhMltpICsgMV07DQogICAgICAgICAgICAgICAgY29uc3QgZW5kQiA9IGRhdGEyW2kgKyAyXTsNCiAgICAgICAgICAgICAgICBjb25zdCBlbmRBID0gZGF0YTJbaSArIDNdOw0KDQogICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHVuaXF1ZSBwYXJhbWV0ZXJzIGZvciBlYWNoIHBpeGVsIHBhcnRpY2xlDQogICAgICAgICAgICAgICAgY29uc3QgZGVsYXkgPSBNYXRoLnJhbmRvbSgpICogbWF4RGVsYXlGcmFtZXM7IC8vIFN0YWdnZXJlZCBzdGFydA0KICAgICAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uRmFjdG9yID0gMC41ICsgTWF0aC5yYW5kb20oKSAqIDAuNTsgLy8gRWFjaCBwYXJ0aWNsZSB0YWtlcyA1MC0xMDAlIG9mIGl0cyBhY3RpdmUgdGltZQ0KICAgICAgICAgICAgICAgIGNvbnN0IGluaXRpYWxPZmZzZXRYID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogbWF4SW5pdGlhbFNjYXR0ZXIgKiAyOyAvLyBJbml0aWFsIHNjYXR0ZXJlZCBwb3NpdGlvbg0KICAgICAgICAgICAgICAgIGNvbnN0IGluaXRpYWxPZmZzZXRZID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogbWF4SW5pdGlhbFNjYXR0ZXIgKiAyOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldE9mZnNldFggPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBtYXhUYXJnZXRKaXR0ZXI7IC8vIFNsaWdodCBqaXR0ZXIgYXQgZmluYWwgcG9zaXRpb24NCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRPZmZzZXRZID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogbWF4VGFyZ2V0Sml0dGVyOw0KICAgICAgICAgICAgICAgIGNvbnN0IG9zY2lsbGF0aW9uQW1wbGl0dWRlID0gKE1hdGgucmFuZG9tKCkgKiBiYXNlT3NjaWxsYXRpb25BbXApICsgMTsgLy8gV2F2eSBtb3Rpb24NCiAgICAgICAgICAgICAgICBjb25zdCBvc2NpbGxhdGlvbkZyZXF1ZW5jeSA9IChNYXRoLnJhbmRvbSgpICogMC4yKSArIDAuMDU7IC8vIEhvdyBmYXN0IGl0IHdpZ2dsZXMNCg0KICAgICAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgeCwgeSwNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRSLCBzdGFydEcsIHN0YXJ0Qiwgc3RhcnRBLA0KICAgICAgICAgICAgICAgICAgICBlbmRSLCBlbmRHLCBlbmRCLCBlbmRBLA0KICAgICAgICAgICAgICAgICAgICBkZWxheSwNCiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb25GYWN0b3IsDQogICAgICAgICAgICAgICAgICAgIGluaXRpYWxPZmZzZXRYLCBpbml0aWFsT2Zmc2V0WSwNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0T2Zmc2V0WCwgdGFyZ2V0T2Zmc2V0WSwNCiAgICAgICAgICAgICAgICAgICAgb3NjaWxsYXRpb25BbXBsaXR1ZGUsIG9zY2lsbGF0aW9uRnJlcXVlbmN5LA0KICAgICAgICAgICAgICAgICAgICBzaXplOiBwaXhlbFNpemUNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUaGUgbWFpbiBhbmltYXRpb24gbG9vcC4NCiAgICAgKiBJdGVyYXRlcyB0aHJvdWdoIHRoZSBwaXhlbCBwYXJ0aWNsZXMsIHVwZGF0ZXMgdGhlaXIgc3RhdGUgYmFzZWQgb24gcHJvZ3Jlc3MsDQogICAgICogYW5kIGRyYXdzIHRoZW0gdG8gdGhlIGNhbnZhcy4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7IC8vIENsZWFyIHRoZSBlbnRpcmUgY2FudmFzIGVhY2ggZnJhbWUNCg0KICAgICAgICBjb25zdCB0b3RhbEFuaW1hdGlvbkR1cmF0aW9uID0gdG90YWxGcmFtZXNiYjsNCg0KICAgICAgICBwaXhiaXhlbHMuZm9yRWFjaChwaXhlbCA9PiB7DQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgaW5kaXZpZHVhbCBwcm9ncmVzcyBmb3IgdGhpcyBwaXhlbCwgY29uc2lkZXJpbmcgZGVsYXkgYW5kIGR1cmF0aW9uRmFjdG9yDQogICAgICAgICAgICBsZXQgcCA9IChjdXJyZW50RnJhbWViYiAtIHBpeGVsLmRlbGF5KSAvICh0b3RhbEFuaW1hdGlvbkR1cmF0aW9uICogcGl4ZWwuZHVyYXRpb25GYWN0b3IgLSBwaXhlbC5kZWxheSk7DQogICAgICAgICAgICBwID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgcCkpOyAvLyBDbGFtcCBwcm9ncmVzcyBiZXR3ZWVuIDAgYW5kIDENCg0KICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHApOyAvLyBBcHBseSBlYXNpbmcgdG8gdGhlIGNsYW1wZWQgcHJvZ3Jlc3MNCg0KICAgICAgICAgICAgLy8gLS0tIEludGVycG9sYXRlIENvbG9yIC0tLQ0KICAgICAgICAgICAgY29uc3QgciA9IE1hdGgucm91bmQocGl4ZWwuc3RhcnRSICsgKHBpeGVsLmVuZFIgLSBwaXhlbC5zdGFydFIpICogZWFzZWRQcm9ncmVzcyk7DQogICAgICAgICAgICBjb25zdCBnID0gTWF0aC5yb3VuZChwaXhlbC5zdGFydEcgKyAocGl4ZWwuZW5kRyAtIHBpeGVsLnN0YXJ0RykgKiBlYXNlZFByb2dyZXNzKTsNCiAgICAgICAgICAgIGNvbnN0IGIgPSBNYXRoLnJvdW5kKHBpeGVsLnN0YXJ0QiArIChwaXhlbC5lbmRCIC0gcGl4ZWwuc3RhcnRCKSAqIGVhc2VkUHJvZ3Jlc3MpOw0KICAgICAgICAgICAgLy8gQWxwaGEgaXMgMC0yNTUgaW4gSW1hZ2VEYXRhLCBidXQgMC0xIGZvciBDU1MgcmdiYSgpDQogICAgICAgICAgICBjb25zdCBhID0gKHBpeGVsLnN0YXJ0QSArIChwaXhlbC5lbmRBIC0gcGl4ZWwuc3RhcnRBKSAqIGVhc2VkUHJvZ3Jlc3MpIC8gMjU1Ow0KDQogICAgICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBgcmdiYSgke3J9LCR7Z30sJHtifSwke2F9KWA7DQoNCiAgICAgICAgICAgIC8vIC0tLSBJbnRlcnBvbGF0ZSBQb3NpdGlvbiAtLS0NCiAgICAgICAgICAgIC8vIFN0YXJ0IHBvc2l0aW9uIChvcmlnaW5hbCArIGluaXRpYWwgc2NhdHRlcikNCiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHBpeGVsLnggKyBwaXhlbC5pbml0aWFsT2Zmc2V0WDsNCiAgICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IHBpeGVsLnkgKyBwaXhlbC5pbml0aWFsT2Zmc2V0WTsNCg0KICAgICAgICAgICAgLy8gVGFyZ2V0IHBvc2l0aW9uIChvcmlnaW5hbCArIHNsaWdodCBqaXR0ZXIpDQogICAgICAgICAgICBjb25zdCB0YXJnZXRYID0gcGl4ZWwueCArIHBpeGVsLnRhcmdldE9mZnNldFg7DQogICAgICAgICAgICBjb25zdCB0YXJnZXRZID0gcGl4ZWwueSArIHBpeGVsLnRhcmdldE9mZnNldFk7DQoNCiAgICAgICAgICAgIC8vIEFkZCAicXVhbnR1bSIgb3NjaWxsYXRpb24gbW90aW9uLCBpbmZsdWVuY2VkIGJ5IGZyYW1lIGFuZCBwaXhlbCBwb3NpdGlvbg0KICAgICAgICAgICAgY29uc3Qgb3NjaWxsYXRpb25YID0gTWF0aC5zaW4oY3VycmVudEZyYW1lYmIgKiBwaXhlbC5vc2NpbGxhdGlvbkZyZXF1ZW5jeSArIHBpeGVsLnkgKiAwLjAxKSAqIHBpeGVsLm9zY2lsbGF0aW9uQW1wbGl0dWRlOw0KICAgICAgICAgICAgY29uc3Qgb3NjaWxsYXRpb25ZID0gTWF0aC5jb3MoY3VycmVudEZyYW1lYmIgKiBwaXhlbC5vc2NpbGxhdGlvbkZyZXF1ZW5jeSArIHBpeGVsLnggKiAwLjAxKSAqIHBpeGVsLm9zY2lsbGF0aW9uQW1wbGl0dWRlOw0KDQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgY3VycmVudCBwb3NpdGlvbg0KICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBzdGFydFggKyAodGFyZ2V0WCAtIHN0YXJ0WCkgKiBlYXNlZFByb2dyZXNzICsgb3NjaWxsYXRpb25YOw0KICAgICAgICAgICAgY29uc3QgY3VycmVudFkgPSBzdGFydFkgKyAodGFyZ2V0WSAtIHN0YXJ0WSkgKiBlYXNlZFByb2dyZXNzICsgb3NjaWxsYXRpb25ZOw0KDQogICAgICAgICAgICAvLyBPcHRpb25hbDogbWFrZSBwYXJ0aWNsZXMgdGVtcG9yYXJpbHkgc21hbGxlciBkdXJpbmcgdHJhbnNpdGlvbiBmb3IgYSAiZmFkaW5nIG91dC9pbiIgZWZmZWN0DQogICAgICAgICAgICBjb25zdCBjdXJyZW50U2l6ZSA9IHBpeGVsLnNpemUgKiAoMSAtIE1hdGguYWJzKGVhc2VkUHJvZ3Jlc3MgLSAwLjUpICogMC40KTsgLy8gU2hyaW5rIHNsaWdodGx5IGluIG1pZGRsZQ0KDQogICAgICAgICAgICBjdHhiaS5maWxsUmVjdChjdXJyZW50WCwgY3VycmVudFksIGN1cnJlbnRTaXplLCBjdXJyZW50U2l6ZSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsNCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiKys7DQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBbmltYXRpb24gKEEgLT4gQikgaXMgY29tcGxldGUuIFByZXBhcmUgdGhlIG5leHQgcm91bmQgKEIgLT4gQykuDQoNCiAgICAgICAgICAgIC8vIDEuIERyYXcgdGhlIGZpbmFsIGltYWdlIChCKSB0byB0aGUgY2FudmFzIHRvIGNvbXBsZXRlbHkgY292ZXIgdGhlIHRyYW5zaXRpb24gcGl4ZWxzLg0KICAgICAgICAgICAgLy8gVGhpcyBlbnN1cmVzIGEgY2xlYW4sIGNyaXNwIGZpbmFsIGltYWdlIGJlZm9yZSB0aGUgbmV4dCB0cmFuc2l0aW9uLg0KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgICAgICAvLyAyLiBTV0FQIE9CSkVDVFM6IFRoZSBvbGQgdGFyZ2V0IGltYWdlIG9iamVjdCAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSBvYmplY3QgKEEpLg0KICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOw0KDQogICAgICAgICAgICAvLyAzLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLg0KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7DQoNCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKQ0KICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAgICAgICAgIC8vIDUuIFN0YXJ0IHRoZSBsb2FkIHByb2Nlc3MgZm9yIHRoZSBuZXh0IGltYWdlIChDKS4gTm8gZGVsYXkgbmVlZGVkIGhlcmUuDQogICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOyAvLyBSZXNldCBmcmFtZSBjb3VudGVyIGZvciBuZXcgYW5pbWF0aW9uDQogICAgICAgIHNldHVwSW5pdGlhbENhbnZhcygpOyAvLyBQcmVwYXJlIGFsbCBwaXhlbCBwYXJ0aWNsZXMgZm9yIHRoZSBuZXcgdHJhbnNpdGlvbg0KICAgICAgICBBTklNQVRFKCk7IC8vIFN0YXJ0IHRoZSBhbmltYXRpb24gbG9vcA0KICAgIH07DQoNCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQ0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOw0KICAgIH07DQo8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=<br>PGh0bWwgbGFuZz0iZW4iPg0KPGhlYWQ+DQogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPg0KICAgIDx0aXRsZT5RdWFudHVtIFNlZ21lbnRhdGlvbiBJbWFnZSBUcmFuc2l0aW9uPC90aXRsZT4NCiAgICA8c3R5bGU+DQogICAgICAgIC8qIEJhc2Ugc3R5bGVzICovDQogICAgICAgIGJvZHkgeyB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsgICB3aWR0aDoxMDAlOyBoZWlnaHQ6MTAwJTsNCiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICBtaW4taGVpZ2h0OiAxMDB2aDsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnU2Vnb2UgVUknLCBUYWhvbWEsIEdlbmV2YSwgVmVyZGFuYSwgc2Fucy1zZXJpZjsNCiAgICAgICAgICAgIGNvbG9yOiAjZWVlOw0KICAgICAgICB9DQoNCiAgICAgICAgLyogQ29udGFpbmVyIGZvciB0aGUgY2FudmFzL2JhY2tncm91bmQgaW1hZ2UgKi8NCiAgICAgICAgI2NhbnZhcyB7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsNCiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICBib3JkZXI6IDBweCBzb2xpZCAjMzMzOw0KDQogICAgICAgIH0NCiAgICAgICAgLyogVGhlIGNhbnZhcyBpdHNlbGYgKi8NCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7DQogICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDA7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsgLyogQWN0dWFsIHJlbmRlcmVkIHNpemUsIG1hdGNoZXMgSlMgYnJlZWQzNjAgKi8NCiAgICAgICAgICAgIGhlaWdodDogMTAwJTsgLyogQWN0dWFsIHJlbmRlcmVkIHNpemUsIG1hdGNoZXMgSlMgaG9vZzE4MCAqLw0KICAgICAgICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IGJsYWNrOyAvKiBFbnN1cmUgaW5pdGlhbCBibGFjayBjYW52YXMgKi8NCiAgICAgICAgfQ0KICAgICAgICBoMSB7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICAgICAgICAgICAgY29sb3I6ICMwMGZmZmY7DQogICAgICAgICAgICB0ZXh0LXNoYWRvdzogMCAwIDVweCAjMDBmZmZmLCAwIDAgMTBweCAjMDBmZmZmOw0KICAgICAgICB9DQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCjxib2R5Pg0KPGRpdiBpZD0nY2FudmFzJz4NCiAgICA8Y2FudmFzIGlkPSdhbmltYXRpb25DYW52YXMnIHdpZHRoPTgwMCBoZWlnaHQ9NDUwPjwvY2FudmFzPg0KPC9kaXY+DQo8c2NyaXB0Pg0KICAgIC8vIC0tLSBJbWFnZSBTb3VyY2UgYW5kIE9iamVjdCBTdG9yYWdlIC0tLQ0KICAgIC8vIFVzZSBmaXhlZCBkaW1lbnNpb25zIGZvciBwaWNzdW0gdG8gbWF0Y2ggY2FudmFzLCBhZGRpbmcgdW5pcXVlIHJhbmRvbSBxdWVyeSBmb3IgbmV3IGltYWdlcw0KICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCiAgICB2YXIgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICB2YXIgY3VycmVudEltYWdlID0gbnVsbDsgLy8gSW1hZ2UgQSAoVGhlIFN0YXJ0KSBvYmplY3QNCiAgICB2YXIgbmV4dEltYWdlID0gbnVsbDsgICAgLy8gSW1hZ2UgQiAoVGhlIFRhcmdldCkgb2JqZWN0DQoNCiAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tDQogICAgdmFyIGNhbnZhc2JiaTsNCiAgICB2YXIgY3R4Ymk7DQogICAgdmFyIGltYWdlc2JpID0ge307ICAgICAgICAvLyBTdG9yZXMgQUxMIGxvYWRlZCBJbWFnZSBvYmplY3RzIChrZXllZCBieSBVUkwgZm9yIGNhY2hpbmcpDQogICAgdmFyIHBpeGJpeGVscyA9IFtdOyAgICAgICAvLyBTdG9yZXMgc2VnbWVudCBkYXRhIGZvciB0aGUgYW5pbWF0aW9uIChlYWNoICdwaXhiaXhlbCcgaXMgbm93IGEgc2VnbWVudCkNCg0KICAgIHZhciB0b3RhbEZyYW1lc2JiID0gMTIwOyAgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3IgYSBtb3JlIGVsYWJvcmF0ZSB0cmFuc2l0aW9uIChlLmcuLCAyLTMgc2Vjb25kcyBhdCA2MGZwcykNCiAgICB2YXIgY3VycmVudEZyYW1lYmIgPSAwOw0KDQogICAgLy8gRGltZW5zaW9ucyBmb3IgdGhlIGNhbnZhcyBlbGVtZW50IChtYXRjaGluZyBpbWFnZSBzaXplcyBmb3IgZGlyZWN0IGRyYXdpbmcgd2l0aG91dCBzY2FsaW5nKQ0KICAgIHZhciBicmVlZDM2MCA9IDgwMDsgIDgwMDsgICAgICAvLyBDYW52YXMgd2lkdGgNCiAgICB2YXIgaG9vZzE4MCA9IDQwMDsgICAgICAvLyBDYW52YXMgaGVpZ2h0DQoNCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0NCiAgICAvKioNCiAgICAgKiBMb2FkcyBhIHNpbmdsZSBpbWFnZSBpbnRvIHRoZSBpbWFnZXNiaSBtYXAuDQogICAgICovDQogICAgdmFyIGxvYWRJbWFnZWJiID0gKHNyYywgY2FsbGJhY2spID0+IHsNCiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOw0KICAgICAgICBpbWcub25sb2FkID0gKCkgPT4gew0KICAgICAgICAgICAgaW1hZ2VzYmlbc3JjXSA9IGltZzsNCiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGltZyk7DQogICAgICAgIH07DQogICAgICAgIGltZy5vbmVycm9yID0gKCkgPT4gew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApOw0KICAgICAgICAgICAgY2FsbGJhY2sobmV3IEVycm9yKGBGYWlsZWQgdG8gbG9hZCBpbWFnZTogJHtzcmN9YCkpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcuc3JjID0gc3JjOw0KICAgICAgICBpbWcuY3Jvc3NPcmlnaW4gPSAiQW5vbnltb3VzIjsgLy8gUmVxdWlyZWQgZm9yIGxvYWRpbmcgaW1hZ2VzIGZyb20gZXh0ZXJuYWwgZG9tYWlucyBmb3IgY2FudmFzIG1hbmlwdWxhdGlvbg0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBMb2FkcyB0aGUgbmV4dCBpbWFnZSBpbiB0aGUgc2VxdWVuY2UgYW5kIHN0YXJ0cyB0aGUgdHJhbnNpdGlvbi4NCiAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZnRlciBhbiBhbmltYXRpb24gY3ljbGUgY29tcGxldGVzLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsNCiAgICAgICAgbGV0IG5ld0ltYWdlVVJMID0gbmV4dFVSTDsgLy8gVGhlIFVSTCBmb3IgdGhlICpuZXcqIHRhcmdldCBpbWFnZSAoQykNCg0KICAgICAgICBpZiAoaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdKSB7DQogICAgICAgICAgICAvLyBJZiB0aGUgaW1hZ2UgaXMgYWxyZWFkeSBjYWNoZWQsIHVzZSBpdCBpbW1lZGlhdGVseQ0KICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdOw0KICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBsb2FkIHRoZSBuZXcgaW1hZ2UNCiAgICAgICAgICAgIGxvYWRJbWFnZWJiKG5ld0ltYWdlVVJMLCAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1nOw0KICAgICAgICAgICAgICAgICAgICAvLyBPbmNlIGxvYWRlZCwgc3RhcnQgdGhlIG5leHQgYW5pbWF0aW9uIGN5Y2xlIChCIC0+IEMpDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgIC8vIFJldHJ5IGxvYWRpbmcgYWZ0ZXIgYSBkZWxheSBpZiB0aGVyZSdzIGFuIGVycm9yDQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIHRoZSBjYW52YXMgYW5kIGxvYWRzIHRoZSBpbml0aWFsIHR3byBpbWFnZXMgKEEgYW5kIEIpDQogICAgICogdG8ga2lja3N0YXJ0IHRoZSBjb250aW51b3VzIGFuaW1hdGlvbiBsb29wLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGluaXRDYW52YXNBbmRJbWFnZXMoKSB7DQogICAgICAgIGNhbnZhc2JiaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25DYW52YXMnKTsNCiAgICAgICAgY2FudmFzYmJpLndpZHRoID0gYnJlZWQzNjA7DQogICAgICAgIGNhbnZhc2JiaS5oZWlnaHQgPSBob29nMTgwOw0KICAgICAgICBjdHhiaSA9IGNhbnZhc2JiaS5nZXRDb250ZXh0KCcyZCcpOw0KDQogICAgICAgIGxldCBpbWFnZXNUb0xvYWQgPSBbY3VycmVudFVSTCwgbmV4dFVSTF07DQogICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7DQogICAgICAgIGxldCBoYXNFcnJvciA9IGZhbHNlOw0KDQogICAgICAgIGNvbnN0IG9uSW1hZ2VMb2FkZWQgPSAoZXJyb3IsIGltZykgPT4gew0KICAgICAgICAgICAgaWYgKGVycm9yKSB7DQogICAgICAgICAgICAgICAgaGFzRXJyb3IgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgbG9hZGVkQ291bnQrKzsNCiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA9PT0gaW1hZ2VzVG9Mb2FkLmxlbmd0aCkgew0KICAgICAgICAgICAgICAgIGlmICghaGFzRXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgLy8gQXNzaWduIHRoZSBsb2FkZWQgaW1hZ2VzIHRvIGN1cnJlbnRJbWFnZSAoQSkgYW5kIG5leHRJbWFnZSAoQikNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlID0gaW1hZ2VzYmlbY3VycmVudFVSTF07DQogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSA9IGltYWdlc2JpW25leHRVUkxdOw0KICAgICAgICAgICAgICAgICAgICAvLyBTdGFydCB0aGUgdmVyeSBmaXJzdCBhbmltYXRpb24gKEEgLT4gQikNCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0luaXRpYWwgaW1hZ2UgbG9hZGluZyBmYWlsZWQuIENhbm5vdCBzdGFydCBhbmltYXRpb24uJyk7DQogICAgICAgICAgICAgICAgICAgIC8vIEluIGEgcmVhbCBhcHBsaWNhdGlvbiwgeW91IG1pZ2h0IGRpc3BsYXkgYW4gZXJyb3Igb3IgZGVmYXVsdCBpbWFnZSBoZXJlLg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgLy8gTG9hZCBib3RoIGluaXRpYWwgaW1hZ2VzIGNvbmN1cnJlbnRseQ0KICAgICAgICBpbWFnZXNUb0xvYWQuZm9yRWFjaChzcmMgPT4gbG9hZEltYWdlYmIoc3JjLCBvbkltYWdlTG9hZGVkKSk7DQogICAgfQ0KDQogICAgLy8gLS0tIFBpeGVsIGFuZCBFYXNpbmcgVXRpbGl0aWVzIC0tLQ0KICAgIC8vIHBhcnNlUkdCQSBhbmQgaW50ZXJwb2xhdGVDb2xvciBhcmUgcGFydCBvZiB0aGUgb3JpZ2luYWwgZnJhbWV3b3JrIGJ1dCBub3QgZGlyZWN0bHkNCiAgICAvLyB1c2VkIGluIHRoaXMgc2VnbWVudC1iYXNlZCBlZmZlY3QsIHdoaWNoIG1hbmlwdWxhdGVzIEltYWdlRGF0YSBkaXJlY3RseS4NCiAgICB2YXIgcGFyc2VSR0JBID0gKHJnYmFTdHJpbmcpID0+IHsNCiAgICAgICAgdmFyIHBhcnRzID0gcmdiYVN0cmluZy5tYXRjaCgvXGQrKFwuXGQrKT8vZykubWFwKE51bWJlcik7DQogICAgICAgIHJldHVybiB7IHI6IHBhcnRzWzBdLCBnOiBwYXJ0c1sxXSwgYjogcGFydHNbMl0sIGE6IHBhcnRzWzNdIHx8IDEgfTsNCiAgICB9Ow0KICAgIHZhciBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gew0KICAgICAgICB2YXIgYzEgPSBwYXJzZVJHQkEoY29sb3IxKTsNCiAgICAgICAgdmFyIGMyID0gcGFyc2VSR0JBKGNvbG9yMik7DQogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjMS5yICsgKGMyLnIgLSBjMS5yKSAqIHByb2dyZXNzKTsNCiAgICAgICAgdmFyIGcgPSBNYXRoLnJvdW5kKGMxLmcgKyAoYzIuZyAtIGMxLmcpICogcHJvZ3Jlc3MpOw0KICAgICAgICB2YXIgYiA9IE1hdGgucm91bmQoYzEuYiArIChjMi5iIC0gYzEuYikgKiBwcm9ncmVzcyk7DQogICAgICAgIHZhciBhID0gYzEuYSArIChjMi5hIC0gYzEuYSkgKiBwcm9ncmVzczsNCiAgICAgICAgcmV0dXJuIGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7YX0pYDsNCiAgICB9Ow0KICAgIC8vIEVhc2luZyBmdW5jdGlvbiBmb3Igc21vb3RoZXIgYW5pbWF0aW9uIGFjY2VsZXJhdGlvbi9kZWNlbGVyYXRpb24NCiAgICB2YXIgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7DQoNCiAgICAvKioNCiAgICAgKiBTZXRzIHVwIHRoZSBpbml0aWFsIHN0YXRlIGZvciB0aGUgcXVhbnR1bSBzZWdtZW50YXRpb24gYW5pbWF0aW9uLg0KICAgICAqIERpdmlkZXMgdGhlIGN1cnJlbnQgYW5kIG5leHQgaW1hZ2VzIGludG8gc2VnbWVudHMsIGV4dHJhY3RpbmcgdGhlaXIgcGl4ZWwgZGF0YSwNCiAgICAgKiBhbmQgZ2VuZXJhdGVzICJxdWFudHVtIiBwYXJhbWV0ZXJzIGZvciBlYWNoIHNlZ21lbnQuDQogICAgICovDQogICAgdmFyIHNldHVwSW5pdGlhbENhbnZhcyA9ICgpID0+IHsNCiAgICAgICAgaWYgKCFjdXJyZW50SW1hZ2UgfHwgIW5leHRJbWFnZSkgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcigiSW1hZ2VzIG5vdCBsb2FkZWQgZm9yIHNldHVwSW5pdGlhbENhbnZhcy4iKTsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgIC8vIENyZWF0ZSB0ZW1wb3JhcnkgY2FudmFzZXMgdG8gZWZmaWNpZW50bHkgZ2V0IHBpeGVsIGRhdGEgZm9yIHNlZ21lbnRzDQogICAgICAgIC8vIERyYXdpbmcgaW1hZ2VzIHRvIG9mZnNjcmVlbiBjYW52YXNlcyBhbGxvd3MgYGdldEltYWdlRGF0YWAgd2l0aG91dCBhZmZlY3RpbmcgdGhlIG1haW4gY2FudmFzLg0KICAgICAgICB2YXIgdGVtcENhbnZhczEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsNCiAgICAgICAgdmFyIHRlbXBDdHgxID0gdGVtcENhbnZhczEuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgdGVtcENhbnZhczEud2lkdGggPSBjYW52YXNiYmkud2lkdGg7DQogICAgICAgIHRlbXBDYW52YXMxLmhlaWdodCA9IGNhbnZhc2JiaS5oZWlnaHQ7DQogICAgICAgIHRlbXBDdHgxLmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgdmFyIHRlbXBDYW52YXMyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4MiA9IHRlbXBDYW52YXMyLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgIHRlbXBDYW52YXMyLndpZHRoID0gY2FudmFzYmJpLndpZHRoOw0KICAgICAgICB0ZW1wQ2FudmFzMi5oZWlnaHQgPSBjYW52YXNiYmkuaGVpZ2h0Ow0KICAgICAgICB0ZW1wQ3R4Mi5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgIHBpeGJpeGVscyA9IFtdOyAvLyBDbGVhciBwcmV2aW91cyBzZWdtZW50IGRhdGENCg0KICAgICAgICAvLyAtLS0gUXVhbnR1bSBTZWdtZW50YXRpb24gUGFyYW1ldGVycyAtLS0NCiAgICAgICAgY29uc3Qgc2VnbWVudFNpemUgPSAyNTsgLy8gRWFjaCBzZWdtZW50IHdpbGwgYmUgMjV4MjUgcGl4ZWxzLiBBZGp1c3QgZm9yIGNvYXJzZXIvZmluZXIgZ3JhaW4uDQogICAgICAgIGNvbnN0IG1heEluaXRpYWxPZmZzZXQgPSA3MDsgLy8gTWF4IHBpeGVscyBmb3IgaW5pdGlhbCByYW5kb20gZGlzcGxhY2VtZW50IG9mIHNlZ21lbnRzLg0KICAgICAgICBjb25zdCBtYXhEZWxheUZyYW1lcyA9IHRvdGFsRnJhbWVzYmIgLyAzOyAvLyBNYXggZnJhbWVzIGRlbGF5IGJlZm9yZSBhIHNlZ21lbnQgc3RhcnRzIGFuaW1hdGluZy4NCiAgICAgICAgLy8gLS0tDQoNCiAgICAgICAgLy8gSXRlcmF0ZSB0aHJvdWdoIHRoZSBjYW52YXMgaW4gYSBncmlkIHBhdHRlcm4gdG8gY3JlYXRlIHNlZ21lbnRzDQogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgY2FudmFzYmJpLmhlaWdodDsgeSArPSBzZWdtZW50U2l6ZSkgew0KICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBjYW52YXNiYmkud2lkdGg7IHggKz0gc2VnbWVudFNpemUpIHsNCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgYWN0dWFsIHdpZHRoL2hlaWdodCBmb3Igc2VnbWVudHMgYXQgdGhlIGNhbnZhcyBlZGdlcw0KICAgICAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5taW4oc2VnbWVudFNpemUsIGNhbnZhc2JiaS53aWR0aCAtIHgpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWluKHNlZ21lbnRTaXplLCBjYW52YXNiYmkuaGVpZ2h0IC0geSk7DQoNCiAgICAgICAgICAgICAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgY29udGludWU7IC8vIFNraXAgaWYgc2VnbWVudCBpcyB6ZXJvLXNpemVkDQoNCiAgICAgICAgICAgICAgICAvLyBHZXQgSW1hZ2VEYXRhIGZvciB0aGlzIHNlZ21lbnQgZnJvbSBib3RoIHNvdXJjZSBhbmQgdGFyZ2V0IGltYWdlcw0KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW1hZ2VEYXRhID0gdGVtcEN0eDEuZ2V0SW1hZ2VEYXRhKHgsIHksIHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICAgICAgICAgIGNvbnN0IGVuZEltYWdlRGF0YSA9IHRlbXBDdHgyLmdldEltYWdlRGF0YSh4LCB5LCB3aWR0aCwgaGVpZ2h0KTsNCg0KICAgICAgICAgICAgICAgIHBpeGJpeGVscy5wdXNoKHsNCiAgICAgICAgICAgICAgICAgICAgeDogeCwgICAgICAgICAgICAgIC8vIE9yaWdpbmFsIHggcG9zaXRpb24gKHRoaXMgaXMgdGhlIGZpbmFsIHRhcmdldCBwb3NpdGlvbiBmb3IgdGhlIHNlZ21lbnQpDQogICAgICAgICAgICAgICAgICAgIHk6IHksICAgICAgICAgICAgICAvLyBPcmlnaW5hbCB5IHBvc2l0aW9uIChmaW5hbCB0YXJnZXQpDQogICAgICAgICAgICAgICAgICAgIHdpZHRoOiB3aWR0aCwNCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsDQogICAgICAgICAgICAgICAgICAgIHN0YXJ0SW1hZ2VEYXRhOiBzdGFydEltYWdlRGF0YSwgLy8gUGl4ZWwgZGF0YSBmb3IgdGhlIHNlZ21lbnQgZnJvbSB0aGUgY3VycmVudCBpbWFnZQ0KICAgICAgICAgICAgICAgICAgICBlbmRJbWFnZURhdGE6IGVuZEltYWdlRGF0YSwgICAgIC8vIFBpeGVsIGRhdGEgZm9yIHRoZSBzZWdtZW50IGZyb20gdGhlIG5leHQgaW1hZ2UNCiAgICAgICAgICAgICAgICAgICAgLy8gIlF1YW50dW0iIHBhcmFtZXRlcnM6DQogICAgICAgICAgICAgICAgICAgIC8vIFJhbmRvbSBpbml0aWFsIG9mZnNldHMgZm9yIGNoYW90aWMgbW92ZW1lbnQNCiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbE9mZnNldFg6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIgKiBtYXhJbml0aWFsT2Zmc2V0LA0KICAgICAgICAgICAgICAgICAgICBpbml0aWFsT2Zmc2V0WTogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMiAqIG1heEluaXRpYWxPZmZzZXQsDQogICAgICAgICAgICAgICAgICAgIC8vIFJhbmRvbSBkZWxheSBiZWZvcmUgdGhpcyBzZWdtZW50J3MgYW5pbWF0aW9uIHN0YXJ0cw0KICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uRGVsYXlGcmFtZXM6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIG1heERlbGF5RnJhbWVzKSwNCiAgICAgICAgICAgICAgICAgICAgLy8gQmFzZSBwcm9iYWJpbGl0eSBmb3IgYSBzZWdtZW50IHRvICJmbGlja2VyIiBiZXR3ZWVuIHN0YXRlcw0KICAgICAgICAgICAgICAgICAgICBmbGlja2VyUHJvYmFiaWxpdHk6IDAuMTUNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBNYWluIGFuaW1hdGlvbiBsb29wIGZ1bmN0aW9uLg0KICAgICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIHJlcGVhdGVkbHkgdmlhIHJlcXVlc3RBbmltYXRpb25GcmFtZSB0byB1cGRhdGUgYW5kIGRyYXcgZWFjaCBmcmFtZS4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7IC8vIENsZWFyIHRoZSBlbnRpcmUgY2FudmFzIGZvciB0aGUgbmV3IGZyYW1lDQoNCiAgICAgICAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2ggc2VnbWVudCBhbmQgZHJhdyBpdHMgY3VycmVudCAicXVhbnR1bSIgc3RhdGUNCiAgICAgICAgcGl4Yml4ZWxzLmZvckVhY2goc2VnbWVudCA9PiB7DQogICAgICAgICAgICAvLyBDYWxjdWxhdGUgc2VnbWVudC1zcGVjaWZpYyBwcm9ncmVzcywgYWNjb3VudGluZyBmb3IgaXRzIGluZGl2aWR1YWwgZGVsYXkNCiAgICAgICAgICAgIGxldCBzZWdtZW50UHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCAoY3VycmVudEZyYW1lYmIgLSBzZWdtZW50LnRyYW5zaXRpb25EZWxheUZyYW1lcykgLyAodG90YWxGcmFtZXNiYiAtIHNlZ21lbnQudHJhbnNpdGlvbkRlbGF5RnJhbWVzKSk7DQogICAgICAgICAgICBzZWdtZW50UHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBzZWdtZW50UHJvZ3Jlc3MpKSk7IC8vIENsYW1wIGFuZCBlYXNlIHByb2dyZXNzDQoNCiAgICAgICAgICAgIGxldCBkcmF3WCA9IHNlZ21lbnQueDsNCiAgICAgICAgICAgIGxldCBkcmF3WSA9IHNlZ21lbnQueTsNCg0KICAgICAgICAgICAgLy8gQXBwbHkgIlF1YW50dW0gSmlnZ2xlIiAvIERpc3BsYWNlbWVudC4gVGhpcyBvZmZzZXQgZGVjYXlzIGFzIHRoZSBzZWdtZW50IHByb2dyZXNzZXMNCiAgICAgICAgICAgIC8vIHRvd2FyZHMgaXRzIGZpbmFsIHN0YXRlLCBzaW11bGF0aW5nICJjb2xsYXBzZSIuDQogICAgICAgICAgICBjb25zdCBjdXJyZW50SW5pdGlhbE9mZnNldFggPSBzZWdtZW50LmluaXRpYWxPZmZzZXRYICogKDEgLSBzZWdtZW50UHJvZ3Jlc3MpOw0KICAgICAgICAgICAgY29uc3QgY3VycmVudEluaXRpYWxPZmZzZXRZID0gc2VnbWVudC5pbml0aWFsT2Zmc2V0WSAqICgxIC0gc2VnbWVudFByb2dyZXNzKTsNCiAgICAgICAgICAgIGRyYXdYICs9IGN1cnJlbnRJbml0aWFsT2Zmc2V0WDsNCiAgICAgICAgICAgIGRyYXdZICs9IGN1cnJlbnRJbml0aWFsT2Zmc2V0WTsNCg0KICAgICAgICAgICAgbGV0IGltYWdlRGF0YVRvRHJhdzsNCg0KICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFuICJ1bmNlcnRhaW50eSBmYWN0b3IiOiBoaWdoZXIgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdHJhbnNpdGlvbiwgbG93ZXIgYXQgc3RhcnQvZW5kLg0KICAgICAgICAgICAgLy8gVGhpcyBtYWtlcyB0aGUgImZsaWNrZXJpbmciIG1vcmUgcHJvbm91bmNlZCB3aGVuIHRoZSBzdGF0ZSBpcyBtb3N0IHVuY2VydGFpbi4NCiAgICAgICAgICAgIGNvbnN0IHVuY2VydGFpbnR5RmFjdG9yID0gTWF0aC5hYnMoMC41IC0gc2VnbWVudFByb2dyZXNzKSAqIDI7DQogICAgICAgICAgICBjb25zdCBlZmZlY3RpdmVGbGlja2VyUHJvYmFiaWxpdHkgPSBzZWdtZW50LmZsaWNrZXJQcm9iYWJpbGl0eSAqIHVuY2VydGFpbnR5RmFjdG9yOw0KDQogICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IGVmZmVjdGl2ZUZsaWNrZXJQcm9iYWJpbGl0eSkgew0KICAgICAgICAgICAgICAgIC8vICJTdXBlcnBvc2l0aW9uIiAvICJGbGlja2VyIiBzdGF0ZToNCiAgICAgICAgICAgICAgICAvLyBSYW5kb21seSBjaG9vc2UgdG8gZGlzcGxheSBlaXRoZXIgdGhlIHN0YXJ0IGltYWdlJ3Mgc2VnbWVudCBvciB0aGUgZW5kIGltYWdlJ3Mgc2VnbWVudC4NCiAgICAgICAgICAgICAgICAvLyBUaGlzIHNpbXVsYXRlcyBhbiB1bmNlcnRhaW4gc3RhdGUgd2hlcmUgdGhlIHNlZ21lbnQgYnJpZWZseSBzaG93cyBkaWZmZXJlbnQgInBvc3NpYmlsaXRpZXMuIg0KICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41KSB7DQogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVRvRHJhdyA9IHNlZ21lbnQuc3RhcnRJbWFnZURhdGE7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhVG9EcmF3ID0gc2VnbWVudC5lbmRJbWFnZURhdGE7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAvLyAiQ29sbGFwc2UiIHN0YXRlOg0KICAgICAgICAgICAgICAgIC8vIEJsZW5kIHRoZSBwaXhlbCBkYXRhIHRvIHNtb290aGx5IHJlc29sdmUgdG93YXJkcyB0aGUgdGFyZ2V0IGltYWdlLg0KICAgICAgICAgICAgICAgIC8vIEEgbmV3IEltYWdlRGF0YSBvYmplY3QgaXMgY3JlYXRlZCBhbmQgcG9wdWxhdGVkIHdpdGggaW50ZXJwb2xhdGVkIHBpeGVsIHZhbHVlcy4NCiAgICAgICAgICAgICAgICBpbWFnZURhdGFUb0RyYXcgPSBjdHhiaS5jcmVhdGVJbWFnZURhdGEoc2VnbWVudC53aWR0aCwgc2VnbWVudC5oZWlnaHQpOw0KICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VnbWVudC5zdGFydEltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEludGVycG9sYXRlIFIsIEcsIEIgY2hhbm5lbHMgYmFzZWQgb24gc2VnbWVudFByb2dyZXNzDQogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVRvRHJhdy5kYXRhW2ldID0gTWF0aC5yb3VuZChzZWdtZW50LnN0YXJ0SW1hZ2VEYXRhLmRhdGFbaV0gKyAoc2VnbWVudC5lbmRJbWFnZURhdGEuZGF0YVtpXSAtIHNlZ21lbnQuc3RhcnRJbWFnZURhdGEuZGF0YVtpXSkgKiBzZWdtZW50UHJvZ3Jlc3MpOw0KICAgICAgICAgICAgICAgICAgICBpbWFnZURhdGFUb0RyYXcuZGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKHNlZ21lbnQuc3RhcnRJbWFnZURhdGEuZGF0YVtpICsgMV0gKyAoc2VnbWVudC5lbmRJbWFnZURhdGEuZGF0YVtpICsgMV0gLSBzZWdtZW50LnN0YXJ0SW1hZ2VEYXRhLmRhdGFbaSArIDFdKSAqIHNlZ21lbnRQcm9ncmVzcyk7DQogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVRvRHJhdy5kYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoc2VnbWVudC5zdGFydEltYWdlRGF0YS5kYXRhW2kgKyAyXSArIChzZWdtZW50LmVuZEltYWdlRGF0YS5kYXRhW2kgKyAyXSAtIHNlZ21lbnQuc3RhcnRJbWFnZURhdGEuZGF0YVtpICsgMl0pICogc2VnbWVudFByb2dyZXNzKTsNCiAgICAgICAgICAgICAgICAgICAgLy8gQWxwaGEgY2hhbm5lbCBpcyBhbHdheXMgMjU1IGZvciBzb2xpZCBzZWdtZW50cw0KICAgICAgICAgICAgICAgICAgICBpbWFnZURhdGFUb0RyYXcuZGF0YVtpICsgM10gPSAyNTU7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBEcmF3IHRoZSBjaG9zZW4gKGZsaWNrZXJlZCkgb3IgYmxlbmRlZCBJbWFnZURhdGEgZm9yIHRoZSBjdXJyZW50IHNlZ21lbnQgYXQgaXRzIGNhbGN1bGF0ZWQgcG9zaXRpb24NCiAgICAgICAgICAgIGN0eGJpLnB1dEltYWdlRGF0YShpbWFnZURhdGFUb0RyYXcsIGRyYXdYLCBkcmF3WSk7DQogICAgICAgIH0pOw0KDQogICAgICAgIC8vIENvbnRpbnVlIGFuaW1hdGlvbiBpZiBub3QgYWxsIGZyYW1lcyBhcmUgcGxheWVkDQogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsNCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiKys7DQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBbmltYXRpb24gY3ljbGUgKGUuZy4sIEEgLT4gQikgaXMgY29tcGxldGUuIFByZXBhcmUgZm9yIHRoZSBuZXh0IGN5Y2xlIChCIC0+IEMpLg0KDQogICAgICAgICAgICAvLyAxLiBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgZGlyZWN0bHkgdG8gdGhlIGNhbnZhcy4NCiAgICAgICAgICAgIC8vIFRoaXMgZW5zdXJlcyBhIHBlcmZlY3QsIHNoYXJwIGZpbmFsIGltYWdlLCBjb3ZlcmluZyBhbnkgbWlub3IgdmlzdWFsIGFydGlmYWN0cw0KICAgICAgICAgICAgLy8gZnJvbSB0aGUgc2VnbWVudC1iYXNlZCBjYWxjdWxhdGlvbnMgYXQgdGhlIGVuZCBvZiB0aGUgdHJhbnNpdGlvbi4NCiAgICAgICAgICAgIGN0eGJpLmNsZWFyUmVjdCgwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KICAgICAgICAgICAgY3R4YmkuZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzYmJpLndpZHRoLCBjYW52YXNiYmkuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgLy8gMi4gU1dBUCBPQkpFQ1RTOiBUaGUgb2xkIHRhcmdldCBpbWFnZSBvYmplY3QgKEIpIGlzIG5vdyB0aGUgbmV3IHN0YXJ0aW5nIGltYWdlIG9iamVjdCAoQSkuDQogICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7DQoNCiAgICAgICAgICAgIC8vIDMuIFNXQVAgVVJMUzogVGhlIG9sZCB0YXJnZXQgVVJMIChCKSBpcyBub3cgdGhlIG5ldyBzdGFydGluZyBVUkwgKEEpLg0KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7DQoNCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKTogRmV0Y2ggYSBuZXcgcmFuZG9tIGltYWdlIFVSTCBmb3IgdGhlIG5leHQgdHJhbnNpdGlvbi4NCiAgICAgICAgICAgIG5leHRVUkwgPSAnaHR0cHM6Ly9odG1pZC5naXRodWIuaW8vaW1hZ2VzL2dnJytNYXRoLnJvdW5kKDYxMCpNYXRoLnJhbmRvbSgpKSsnLmpwZyc7IA0KDQogICAgICAgICAgICAvLyA1LiBTdGFydCB0aGUgbG9hZCBwcm9jZXNzIGZvciB0aGUgYnJhbmQgbmV3IGltYWdlIChDKS4NCiAgICAgICAgICAgIC8vIE9uY2UgKEMpIGlzIGxvYWRlZCwgYGxvYWROZXh0SW1hZ2VBbmRTdGFydGAgd2lsbCBjYWxsIGBzdGFydEFuaW1hdGlvbmZ0YCB0byBiZWdpbiBCIC0+IEMuDQogICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgYSBuZXcgYW5pbWF0aW9uIHNlcXVlbmNlIChlLmcuLCBBIC0+IEIgb3IgQiAtPiBDKS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOyAvLyBSZXNldCBmcmFtZSBjb3VudGVyIGZvciB0aGUgbmV3IHRyYW5zaXRpb24NCiAgICAgICAgc2V0dXBJbml0aWFsQ2FudmFzKCk7IC8vIFByZXBhcmUgc2VnbWVudCBkYXRhIGZvciB0aGUgbmV3IHBhaXIgb2YgaW1hZ2VzDQogICAgICAgIEFOSU1BVEUoKTsgLy8gU3RhcnQgdGhlIGFuaW1hdGlvbiBsb29wDQogICAgfTsNCg0KICAgIC8vIC0tLSBJbml0aWFsIENhbGwgLS0tDQogICAgLy8gRW5zdXJlIHRoYXQgYGluaXRDYW52YXNBbmRJbWFnZXNgIGlzIGNhbGxlZCBvbmNlIHRoZSB3aW5kb3cgaGFzIGZ1bGx5IGxvYWRlZC4NCiAgICB3aW5kb3cub25sb2FkID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGluaXRDYW52YXNBbmRJbWFnZXMoKTsNCiAgICB9Ow0KPC9zY3JpcHQ+DQo8L2JvZHk+DQo8L2h0bWw+DQpgYGA=<br>PGh0bWwgbGFuZz0iZW4iPjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+UXVhbnR1bS1JbnNwaXJlZCBDb250aW51b3VzIEltYWdlIFRyYW5zaXRpb248L3RpdGxlPg0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQmFzZSBzdHlsZXMgKi8NCiAgICAgICAgYm9keSB7IHdpZHRoOjEwMCU7IGhlaWdodDoxMDAlOyAgDQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgbWluLWhlaWdodDogMTAwdmg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOw0KICAgICAgICAgICAgbWFyZ2luOiAwOw0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47DQogICAgICAgICAgICBmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7DQogICAgICAgICAgICBjb2xvcjogI2VlZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qIENvbnRhaW5lciBmb3IgdGhlIGNhbnZhcy9iYWNrZ3JvdW5kIGltYWdlICovDQogICAgICAgICNjYW52YXMgew0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgYm9yZGVyOiAwcHggc29saWQgIzMzMzsNCg0KICAgICAgICB9DQogICAgICAgIC8qIFRoZSBjYW52YXMgaXRzZWxmICovDQogICAgICAgICNhbmltYXRpb25DYW52YXMgew0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgYm9yZGVyOiBub25lOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7IC8qIEFjdHVhbCByZW5kZXJlZCBzaXplLCBtYXRjaGVzIEpTIGJyZWVkMzYwICovDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCU7IC8qIEFjdHVhbCByZW5kZXJlZCBzaXplLCBtYXRjaGVzIEpTIGhvb2cxODAgKi8NCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiBibGFjazsgLyogRW5zdXJlIGluaXRpYWwgYmxhY2sgY2FudmFzICovDQogICAgICAgIH0NCiAgICAgICAgaDEgew0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMjBweDsNCiAgICAgICAgICAgIGNvbG9yOiAjMDBmZmZmOw0KICAgICAgICAgICAgdGV4dC1zaGFkb3c6IDAgMCA1cHggIzAwZmZmZiwgMCAwIDEwcHggIzAwZmZmZjsNCiAgICAgICAgfQ0KDQogICAgICAgICNpbmZvIHsNCiAgICAgICAgICAgIG1hcmdpbi10b3A6IDIwcHg7DQogICAgICAgICAgICBmb250LXNpemU6IDAuOWVtOw0KICAgICAgICAgICAgY29sb3I6ICNhYWE7DQpkaXNwbGF5Om5vbmU7DQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KPC9oZWFkPg0KPGJvZHk+DQo8ZGl2IGlkPSJjYW52YXMiPg0KICAgIDxjYW52YXMgaWQ9ImFuaW1hdGlvbkNhbnZhcyIgd2lkdGg9IjM2MCIgaGVpZ2h0PSI2NDAiPjwvY2FudmFzPg0KPC9kaXY+DQo8ZGl2IGlkPSJpbmZvIj4NCiAgICBRdWFudHVtLUluc3BpcmVkIFRyYW5zaXRpb246IEltYWdlIFNlZ21lbnRpbmcgYW5kIFByb2JhYmlsaXN0aWMgQ29sbGFwc2UuDQo8L2Rpdj4NCjxzY3JpcHQ+DQogICAgLy8gLS0tIEltYWdlIFNvdXJjZSBhbmQgT2JqZWN0IFN0b3JhZ2UgLS0tDQogICAgLy8gVmFyaWFibGVzIHRvIGhvbGQgdGhlICpVUkwqIG9mIHRoZSBjdXJyZW50bHkgbG9hZGVkIGltYWdlIHNldA0KICAgIHZhciBjdXJyZW50VVJMID0gJ2h0dHBzOi8vaHRtaWQuZ2l0aHViLmlvL2ltYWdlcy9nZycrTWF0aC5yb3VuZCg2MTAqTWF0aC5yYW5kb20oKSkrJy5qcGcnOyANCiAgICB2YXIgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAvLyBWYXJpYWJsZXMgdG8gaG9sZCB0aGUgKkFjdHVhbCBJbWFnZSBPYmplY3RzKiBmb3IgdGhlIGFuaW1hdGlvbg0KICAgIHZhciBjdXJyZW50SW1hZ2UgPSBudWxsOyAvLyBJbWFnZSBBIChUaGUgU3RhcnQpDQogICAgdmFyIG5leHRJbWFnZSA9IG51bGw7ICAgIC8vIEltYWdlIEIgKFRoZSBUYXJnZXQpDQoNCiAgICAvLyAtLS0gR2xvYmFsIEFuaW1hdGlvbiBWYXJpYWJsZXMgLS0tDQogICAgdmFyIGNhbnZhc2JiaTsNCiAgICB2YXIgY3R4Ymk7DQogICAgdmFyIGltYWdlc2JpID0ge307ICAgICAgICAvLyBTdG9yZXMgQUxMIGxvYWRlZCBJbWFnZSBvYmplY3RzIChrZXllZCBieSBVUkwpDQogICAgdmFyIHBpeGJpeGVscyA9IFtdOyAgICAgICAvLyBXaWxsIG5vdyBzdG9yZSAncGl4ZWxCbG9jaycgb2JqZWN0cyBmb3IgYW5pbWF0aW9uDQoNCiAgICB2YXIgdG90YWxGcmFtZXNiYiA9IDEyMDsgLy8gSW5jcmVhc2VkIGZyYW1lcyBmb3Igc21vb3RoZXIgJ3F1YW50dW0nIGVmZmVjdA0KICAgIHZhciBjdXJyZW50RnJhbWViYiA9IDA7DQoNCiAgICAvLyBEaW1lbnNpb25zIGZvciB0aGUgY2FudmFzIGVsZW1lbnQgKG1hdGNoaW5nIHBpY3N1bS5waG90b3MgYXNwZWN0IHJhdGlvKQ0KICAgIHZhciBicmVlZDM2MCA9IDgwMDsgIC8vIC8vIEFjdHVhbCBkcmF3aW5nIHdpZHRoDQogICAgdmFyIGhvb2cxODAgPSA0NTA7IC8vICAvLyBBY3R1YWwgZHJhd2luZyBoZWlnaHQNCg0KICAgIC8vIC0tLSBBbmltYXRpb24gU3BlY2lmaWMgU2V0dGluZ3MgLS0tDQogICAgdmFyIGJsb2NrU2l6ZSA9IDM7IC8vIFNpemUgb2YgZWFjaCAnc2VnbWVudCcgYmxvY2sgaW4gcGl4ZWxzLiBTbWFsbGVyID0gbW9yZSBkZXRhaWwsIHNsb3dlci4NCiAgICB2YXIgd2F2ZUZyZXF1ZW5jeSA9IDAuMDI7IC8vIEhvdyBmcmVxdWVudCB0aGUgcXVhbnR1bSB3YXZlIGVmZmVjdCBpcw0KICAgIHZhciB3YXZlTWFnbml0dWRlID0gMC4xNTsgLy8gSG93IHN0cm9uZyB0aGUgcXVhbnR1bSB3YXZlIGVmZmVjdCBpcw0KDQogICAgLy8gLS0tIEhlbHBlciBGdW5jdGlvbnMgLS0tDQogICAgLyoqDQogICAgICogTG9hZHMgYSBzaW5nbGUgaW1hZ2UgaW50byB0aGUgaW1hZ2VzYmkgbWFwLg0KICAgICAqLw0KICAgIHZhciBsb2FkSW1hZ2ViYiA9IChzcmMsIGNhbGxiYWNrKSA9PiB7DQogICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsNCiAgICAgICAgaW1nLm9ubG9hZCA9ICgpID0+IHsNCiAgICAgICAgICAgIGltYWdlc2JpW3NyY10gPSBpbWc7DQogICAgICAgICAgICBjYWxsYmFjayhudWxsLCBpbWcpOw0KICAgICAgICB9Ow0KICAgICAgICBpbWcub25lcnJvciA9ICgpID0+IHsNCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBsb2FkIGltYWdlOiAke3NyY31gKTsNCiAgICAgICAgICAgIGNhbGxiYWNrKG5ldyBFcnJvcihgRmFpbGVkIHRvIGxvYWQgaW1hZ2U6ICR7c3JjfWApKTsNCiAgICAgICAgfTsNCiAgICAgICAgaW1nLnNyYyA9IHNyYzsNCiAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gIkFub255bW91cyI7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIExvYWRzIHRoZSBuZXh0IGltYWdlIGluIHRoZSBzZXF1ZW5jZSBhbmQgc3RhcnRzIHRoZSB0cmFuc2l0aW9uLg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGxvYWROZXh0SW1hZ2VBbmRTdGFydCgpIHsNCiAgICAgICAgbGV0IG5ld0ltYWdlVVJMID0gbmV4dFVSTDsNCiAgICAgICAgaWYgKGltYWdlc2JpW25ld0ltYWdlVVJMXSkgew0KICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV3SW1hZ2VVUkxdOw0KICAgICAgICAgICAgc3RhcnRBbmltYXRpb25mdCgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgbG9hZEltYWdlYmIobmV3SW1hZ2VVUkwsIChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICAgICAgaWYgKCFlcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UgPSBpbWc7DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdOZXcgaW1hZ2UgZmFpbGVkIHRvIGxvYWQuIFJldHJ5aW5nLi4uJyk7DQogICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobG9hZE5leHRJbWFnZUFuZFN0YXJ0LCAyMDAwKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGNhbnZhcyBhbmQgbG9hZHMgdGhlIGluaXRpYWwgdHdvIGltYWdlcyAoQSBhbmQgQikuDQogICAgICovDQogICAgZnVuY3Rpb24gaW5pdENhbnZhc0FuZEltYWdlcygpIHsNCiAgICAgICAgY2FudmFzYmJpID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2FuaW1hdGlvbkNhbnZhcycpOw0KICAgICAgICBjYW52YXNiYmkud2lkdGggPSBicmVlZDM2MDsNCiAgICAgICAgY2FudmFzYmJpLmhlaWdodCA9IGhvb2cxODA7DQogICAgICAgIGN0eGJpID0gY2FudmFzYmJpLmdldENvbnRleHQoJzJkJyk7DQoNCiAgICAgICAgbGV0IGltYWdlc1RvTG9hZCA9IFtjdXJyZW50VVJMLCBuZXh0VVJMXTsNCiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsNCiAgICAgICAgbGV0IGhhc0Vycm9yID0gZmFsc2U7DQoNCiAgICAgICAgY29uc3Qgb25JbWFnZUxvYWRlZCA9IChlcnJvciwgaW1nKSA9PiB7DQogICAgICAgICAgICBpZiAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBoYXNFcnJvciA9IHRydWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2FkZWRDb3VudCsrOw0KICAgICAgICAgICAgaWYgKGxvYWRlZENvdW50ID09PSBpbWFnZXNUb0xvYWQubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgaWYgKCFoYXNFcnJvcikgew0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UgPSBpbWFnZXNiaVtjdXJyZW50VVJMXTsNCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlID0gaW1hZ2VzYmlbbmV4dFVSTF07DQogICAgICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uZnQoKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbml0aWFsIGltYWdlIGxvYWRpbmcgZmFpbGVkLiBDYW5ub3Qgc3RhcnQgYW5pbWF0aW9uLicpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgaW1hZ2VzVG9Mb2FkLmZvckVhY2goc3JjID0+IGxvYWRJbWFnZWJiKHNyYywgb25JbWFnZUxvYWRlZCkpOw0KICAgIH0NCg0KICAgIC8vIC0tLSBQaXhlbCBhbmQgRWFzaW5nIFV0aWxpdGllcyAtLS0NCiAgICAvLyBObyBsb25nZXIgdXNpbmcgc3RyaW5nLWJhc2VkIFJHQkEgZm9yIGludGVycG9sYXRpb24sIGRpcmVjdGx5IHVzaW5nIG9iamVjdHMuDQogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0Ow0KDQogICAgLyoqDQogICAgICogSGVscGVyIHRvIGdldCB0aGUgYXZlcmFnZSBjb2xvciBvZiBhIGJsb2NrIG9mIHBpeGVscyBmcm9tIEltYWdlRGF0YS4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBnZXRBdmVyYWdlQ29sb3IoaW1hZ2VEYXRhLCBzdGFydFgsIHN0YXJ0WSwgYmxvY2tXaWR0aCwgYmxvY2tIZWlnaHQsIGltZ1dpZHRoKSB7DQogICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBhID0gMDsNCiAgICAgICAgbGV0IGNvdW50ID0gMDsNCiAgICAgICAgZm9yIChsZXQgeSA9IHN0YXJ0WTsgeSA8IE1hdGgubWluKHN0YXJ0WSArIGJsb2NrSGVpZ2h0LCBpbWFnZURhdGEuaGVpZ2h0KTsgeSsrKSB7DQogICAgICAgICAgICBmb3IgKGxldCB4ID0gc3RhcnRYOyB4IDwgTWF0aC5taW4oc3RhcnRYICsgYmxvY2tXaWR0aCwgaW1hZ2VEYXRhLndpZHRoKTsgeCsrKSB7DQogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogaW1nV2lkdGggKyB4KSAqIDQ7DQogICAgICAgICAgICAgICAgciArPSBpbWFnZURhdGEuZGF0YVtpXTsNCiAgICAgICAgICAgICAgICBnICs9IGltYWdlRGF0YS5kYXRhW2kgKyAxXTsNCiAgICAgICAgICAgICAgICBiICs9IGltYWdlRGF0YS5kYXRhW2kgKyAyXTsNCiAgICAgICAgICAgICAgICBhICs9IGltYWdlRGF0YS5kYXRhW2kgKyAzXTsNCiAgICAgICAgICAgICAgICBjb3VudCsrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChjb3VudCA9PT0gMCkgcmV0dXJuIHsgcjogMCwgZzogMCwgYjogMCwgYTogMCB9Ow0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgcjogciAvIGNvdW50LA0KICAgICAgICAgICAgZzogZyAvIGNvdW50LA0KICAgICAgICAgICAgYjogYiAvIGNvdW50LA0KICAgICAgICAgICAgYTogYSAvIGNvdW50DQogICAgICAgIH07DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2FsY3VsYXRlcyBhIHNlZ21lbnQgSUQgYmFzZWQgb24gY29sb3IgKGxpZ2h0L2RhcmspIGFuZCBwb3NpdGlvbiAocXVhZHJhbnQpLg0KICAgICAqIFRoaXMgYWxsb3dzIGZvciBkaWZmZXJlbnRpYXRpb24gaW4gdHJhbnNpdGlvbiBiZWhhdmlvci4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBjYWxjdWxhdGVTZWdtZW50SWQoY29sb3IsIHgsIHksIHRvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0KSB7DQogICAgICAgIGNvbnN0IHF1YWRyYW50WCA9IHggPCB0b3RhbFdpZHRoIC8gMiA/IDAgOiAxOw0KICAgICAgICBjb25zdCBxdWFkcmFudFkgPSB5IDwgdG90YWxIZWlnaHQgLyAyID8gMCA6IDI7IC8vIDAsIDIgZm9yIHRvcCwgMSwgMyBmb3IgYm90dG9tDQogICAgICAgIGNvbnN0IHF1YWRyYW50ID0gcXVhZHJhbnRYICsgcXVhZHJhbnRZOyAvLyAwPVRMLCAxPVRSLCAyPUJMLCAzPUJSDQoNCiAgICAgICAgY29uc3QgbGlnaHRuZXNzID0gKGNvbG9yLnIgKyBjb2xvci5nICsgY29sb3IuYikgLyAzOw0KICAgICAgICBjb25zdCBicmlnaHRuZXNzQ2F0ZWdvcnkgPSBsaWdodG5lc3MgPiAxMjggPyAnX2xpZ2h0JyA6ICdfZGFyayc7DQoNCiAgICAgICAgLy8gRXhhbXBsZSBzZWdtZW50IElEczogJzBfbGlnaHQnLCAnMV9kYXJrJywgZXRjLg0KICAgICAgICByZXR1cm4gYCR7cXVhZHJhbnR9JHticmlnaHRuZXNzQ2F0ZWdvcnl9YDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyB0aGUgcGl4ZWwgYmxvY2tzIChvdXIgJ3NlZ21lbnRzJykgZm9yIHRoZSBhbmltYXRpb24uDQogICAgICogVGhpcyByZXBsYWNlcyB0aGUgJ3NldHVwSW5pdGlhbENhbnZhcycgZnJvbSB0aGUgb3JpZ2luYWwgZnJhbWV3b3JrLg0KICAgICAqLw0KICAgIHZhciBzZXR1cEluaXRpYWxDYW52YXMgPSAoKSA9PiB7DQogICAgICAgIC8vIENyZWF0ZSB0ZW1wb3JhcnkgY2FudmFzZXMgdG8gZXh0cmFjdCBpbWFnZSBkYXRhIHdpdGhvdXQgZGlzdHVyYmluZyB0aGUgbWFpbiBjYW52YXMNCiAgICAgICAgdmFyIHRlbXBDYW52YXMxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgIHZhciB0ZW1wQ3R4MSA9IHRlbXBDYW52YXMxLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgIHRlbXBDYW52YXMxLndpZHRoID0gYnJlZWQzNjA7DQogICAgICAgIHRlbXBDYW52YXMxLmhlaWdodCA9IGhvb2cxODA7DQogICAgICAgIHRlbXBDdHgxLmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICAgICAgdmFyIGltYWdlRGF0YTEgPSB0ZW1wQ3R4MS5nZXRJbWFnZURhdGEoMCwgMCwgYnJlZWQzNjAsIGhvb2cxODApOw0KDQogICAgICAgIHZhciB0ZW1wQ2FudmFzMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOw0KICAgICAgICB2YXIgdGVtcEN0eDIgPSB0ZW1wQ2FudmFzMi5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICB0ZW1wQ2FudmFzMi53aWR0aCA9IGJyZWVkMzYwOw0KICAgICAgICB0ZW1wQ2FudmFzMi5oZWlnaHQgPSBob29nMTgwOw0KICAgICAgICB0ZW1wQ3R4Mi5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBicmVlZDM2MCwgaG9vZzE4MCk7DQogICAgICAgIHZhciBpbWFnZURhdGEyID0gdGVtcEN0eDIuZ2V0SW1hZ2VEYXRhKDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCg0KICAgICAgICBwaXhiaXhlbHMgPSBbXTsNCg0KICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggYmxvY2tzIHRvIGNyZWF0ZSAncGl4ZWxCbG9jaycgb2JqZWN0cw0KICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhvb2cxODA7IHkgKz0gYmxvY2tTaXplKSB7DQogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGJyZWVkMzYwOyB4ICs9IGJsb2NrU2l6ZSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGluaXRpYWxDb2xvciA9IGdldEF2ZXJhZ2VDb2xvcihpbWFnZURhdGExLCB4LCB5LCBibG9ja1NpemUsIGJsb2NrU2l6ZSwgYnJlZWQzNjApOw0KICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldENvbG9yID0gZ2V0QXZlcmFnZUNvbG9yKGltYWdlRGF0YTIsIHgsIHksIGJsb2NrU2l6ZSwgYmxvY2tTaXplLCBicmVlZDM2MCk7DQoNCiAgICAgICAgICAgICAgICBwaXhiaXhlbHMucHVzaCh7DQogICAgICAgICAgICAgICAgICAgIHg6IHgsDQogICAgICAgICAgICAgICAgICAgIHk6IHksDQogICAgICAgICAgICAgICAgICAgIHdpZHRoOiBibG9ja1NpemUsDQogICAgICAgICAgICAgICAgICAgIGhlaWdodDogYmxvY2tTaXplLA0KICAgICAgICAgICAgICAgICAgICBpbml0aWFsQ29sb3I6IGluaXRpYWxDb2xvciwNCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0Q29sb3I6IHRhcmdldENvbG9yLA0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3I6IHsgLi4uaW5pdGlhbENvbG9yIH0sIC8vIFN0YXJ0IHdpdGggaW5pdGlhbCBjb2xvciwgc3ByZWFkIHRvIGNvcHkNCiAgICAgICAgICAgICAgICAgICAgaGFzQ29sbGFwc2VkOiBmYWxzZSwgLy8gRmxhZyBmb3IgcXVhbnR1bSBjb2xsYXBzZQ0KICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZVRocmVzaG9sZDogTWF0aC5yYW5kb20oKSAqIDAuNSArIDAuMjUsIC8vIFJhbmRvbSB0aHJlc2hvbGQgYmV0d2VlbiAwLjI1IGFuZCAwLjc1DQogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRJZDogY2FsY3VsYXRlU2VnbWVudElkKGluaXRpYWxDb2xvciwgeCwgeSwgYnJlZWQzNjAsIGhvb2cxODApDQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvLyBJbml0aWFsbHkgZHJhdyB0aGUgY3VycmVudCBpbWFnZSB0byBwcmV2ZW50IGEgYmxhY2sgZnJhbWUNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgIGN0eGJpLmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIGJyZWVkMzYwLCBob29nMTgwKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AuIFRoaXMgcmVwbGFjZXMgdGhlIG9yaWdpbmFsICdBTklNQVRFJyBmdW5jdGlvbi4NCiAgICAgKi8NCiAgICB2YXIgQU5JTUFURSA9ICgpID0+IHsNCiAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQoNCiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChjdXJyZW50RnJhbWViYiAvIHRvdGFsRnJhbWVzYmIpOw0KDQogICAgICAgIHBpeGJpeGVscy5mb3JFYWNoKGJsb2NrID0+IHsNCiAgICAgICAgICAgIGlmIChibG9jay5oYXNDb2xsYXBzZWQpIHsNCiAgICAgICAgICAgICAgICAvLyBJZiBjb2xsYXBzZWQsIGFsd2F5cyBkcmF3IHRoZSB0YXJnZXQgY29sb3INCiAgICAgICAgICAgICAgICBjdHhiaS5maWxsU3R5bGUgPSBgcmdiYSgke01hdGgucm91bmQoYmxvY2sudGFyZ2V0Q29sb3Iucil9LCAke01hdGgucm91bmQoYmxvY2sudGFyZ2V0Q29sb3IuZyl9LCAke01hdGgucm91bmQoYmxvY2sudGFyZ2V0Q29sb3IuYil9LCAke2Jsb2NrLnRhcmdldENvbG9yLmF9KWA7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEFwcGx5ICJRdWFudHVtIFNpbXVsYXRpb24iIGVmZmVjdHMNCiAgICAgICAgICAgICAgICAvLyBCYXNlIHByb2JhYmlsaXR5IG9mIHNob3dpbmcgdGFyZ2V0IGNvbG9yDQogICAgICAgICAgICAgICAgbGV0IHF1YW50dW1Qcm9iID0gcHJvZ3Jlc3M7DQoNCiAgICAgICAgICAgICAgICAvLyAtLS0gU2VnbWVudGF0aW9uIERpZmZlcmVudGlhdG9yIC0tLQ0KICAgICAgICAgICAgICAgIC8vIEV4YW1wbGU6ICdMaWdodCcgc2VnbWVudHMgY29sbGFwc2Ugc2xpZ2h0bHkgZmFzdGVyLCAnRGFyaycgc2VnbWVudHMgc2xvd2VyDQogICAgICAgICAgICAgICAgaWYgKGJsb2NrLnNlZ21lbnRJZC5pbmNsdWRlcygnX2xpZ2h0JykpIHsNCiAgICAgICAgICAgICAgICAgICAgcXVhbnR1bVByb2IgKj0gMS4wNTsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJsb2NrLnNlZ21lbnRJZC5pbmNsdWRlcygnX2RhcmsnKSkgew0KICAgICAgICAgICAgICAgICAgICBxdWFudHVtUHJvYiAqPSAwLjk1Ow0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIC0tLSBXYXZlLWxpa2UgSW5mbHVlbmNlIChub24tbG9jYWwpIC0tLQ0KICAgICAgICAgICAgICAgIC8vIEFkZCBhIHN1YnRsZSBzaW5lIHdhdmUgYmFzZWQgb24gcG9zaXRpb24gYW5kIGN1cnJlbnQgZnJhbWUNCiAgICAgICAgICAgICAgICAvLyBUaGlzIGNyZWF0ZXMgYSBzaGltbWVyaW5nLCBwcm9wYWdhdGluZyBlZmZlY3QNCiAgICAgICAgICAgICAgICBjb25zdCB3YXZlRWZmZWN0ID0gTWF0aC5zaW4oYmxvY2sueCAqIHdhdmVGcmVxdWVuY3kgKyBibG9jay55ICogd2F2ZUZyZXF1ZW5jeSArIGN1cnJlbnRGcmFtZWJiICogMC4xKSAqIHdhdmVNYWduaXR1ZGU7DQogICAgICAgICAgICAgICAgcXVhbnR1bVByb2IgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBxdWFudHVtUHJvYiArIHdhdmVFZmZlY3QpKTsNCg0KICAgICAgICAgICAgICAgIC8vIC0tLSBPYnNlcnZhdGlvbmFsIENvbGxhcHNlIC0tLQ0KICAgICAgICAgICAgICAgIC8vIElmIHRoZSBxdWFudHVtIHByb2JhYmlsaXR5IGV4Y2VlZHMgaXRzIHVuaXF1ZSBjb2xsYXBzZSB0aHJlc2hvbGQsIGl0IHNuYXBzDQogICAgICAgICAgICAgICAgaWYgKHF1YW50dW1Qcm9iID49IGJsb2NrLmNvbGxhcHNlVGhyZXNob2xkKSB7DQogICAgICAgICAgICAgICAgICAgIGJsb2NrLmN1cnJlbnRDb2xvciA9IGJsb2NrLnRhcmdldENvbG9yOw0KICAgICAgICAgICAgICAgICAgICBibG9jay5oYXNDb2xsYXBzZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIC0tLSBTdXBlcnBvc2l0aW9uIEZsaWNrZXIgLS0tDQogICAgICAgICAgICAgICAgICAgIC8vIFdoaWxlIG5vdCBjb2xsYXBzZWQsIGZsaWNrZXIgYmV0d2VlbiBpbml0aWFsIGFuZCB0YXJnZXQgYmFzZWQgb24gcHJvYmFiaWxpdHkNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmxpY2tlckZhY3RvciA9IChNYXRoLnJhbmRvbSgpIDwgcXVhbnR1bVByb2IpID8gMSA6IDA7IC8vIE1vcmUgbGlrZWx5IHRvIHNob3cgdGFyZ2V0IGFzIHF1YW50dW1Qcm9iIGluY3JlYXNlcw0KDQogICAgICAgICAgICAgICAgICAgIGJsb2NrLmN1cnJlbnRDb2xvci5yID0gYmxvY2suaW5pdGlhbENvbG9yLnIgKyAoYmxvY2sudGFyZ2V0Q29sb3IuciAtIGJsb2NrLmluaXRpYWxDb2xvci5yKSAqIGZsaWNrZXJGYWN0b3I7DQogICAgICAgICAgICAgICAgICAgIGJsb2NrLmN1cnJlbnRDb2xvci5nID0gYmxvY2suaW5pdGlhbENvbG9yLmcgKyAoYmxvY2sudGFyZ2V0Q29sb3IuZyAtIGJsb2NrLmluaXRpYWxDb2xvci5nKSAqIGZsaWNrZXJGYWN0b3I7DQogICAgICAgICAgICAgICAgICAgIGJsb2NrLmN1cnJlbnRDb2xvci5iID0gYmxvY2suaW5pdGlhbENvbG9yLmIgKyAoYmxvY2sudGFyZ2V0Q29sb3IuYiAtIGJsb2NrLmluaXRpYWxDb2xvci5iKSAqIGZsaWNrZXJGYWN0b3I7DQogICAgICAgICAgICAgICAgICAgIGJsb2NrLmN1cnJlbnRDb2xvci5hID0gYmxvY2suaW5pdGlhbENvbG9yLmEgKyAoYmxvY2sudGFyZ2V0Q29sb3IuYSAtIGJsb2NrLmluaXRpYWxDb2xvci5hKSAqIGZsaWNrZXJGYWN0b3I7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgY3R4YmkuZmlsbFN0eWxlID0gYHJnYmEoJHtNYXRoLnJvdW5kKGJsb2NrLmN1cnJlbnRDb2xvci5yKX0sICR7TWF0aC5yb3VuZChibG9jay5jdXJyZW50Q29sb3IuZyl9LCAke01hdGgucm91bmQoYmxvY2suY3VycmVudENvbG9yLmIpfSwgJHtibG9jay5jdXJyZW50Q29sb3IuYX0pYDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGN0eGJpLmZpbGxSZWN0KGJsb2NrLngsIGJsb2NrLnksIGJsb2NrLndpZHRoLCBibG9jay5oZWlnaHQpOw0KICAgICAgICB9KTsNCg0KDQogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsNCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiKys7DQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoQU5JTUFURSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBBbmltYXRpb24gKEEgLT4gQikgaXMgY29tcGxldGUuIFByZXBhcmUgdGhlIG5leHQgcm91bmQgKEIgLT4gQykuDQoNCiAgICAgICAgICAgIC8vIDEuIERyYXcgdGhlIGZpbmFsIGltYWdlIChCKSB0byB0aGUgY2FudmFzIHRvIGNvbXBsZXRlbHkgY292ZXIgdGhlIHRyYW5zaXRpb24gcGl4ZWxzLg0KICAgICAgICAgICAgLy8gVGhpcyBlbnN1cmVzIHBlcmZlY3QgYWxpZ25tZW50IGFuZCBjbGFyaXR5IGZvciB0aGUgbmV4dCB0cmFuc2l0aW9uIHN0YXJ0Lg0KICAgICAgICAgICAgY3R4YmkuY2xlYXJSZWN0KDAsIDAsIGNhbnZhc2JiaS53aWR0aCwgY2FudmFzYmJpLmhlaWdodCk7DQogICAgICAgICAgICBjdHhiaS5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNiYmkud2lkdGgsIGNhbnZhc2JiaS5oZWlnaHQpOw0KDQogICAgICAgICAgICAvLyAyLiBTV0FQIE9CSkVDVFM6IFRoZSBvbGQgdGFyZ2V0IGltYWdlIG9iamVjdCAoQikgaXMgdGhlIG5ldyBzdGFydCBpbWFnZSBvYmplY3QgKEEpLg0KICAgICAgICAgICAgY3VycmVudEltYWdlID0gbmV4dEltYWdlOw0KDQogICAgICAgICAgICAvLyAzLiBTV0FQIFVSTFM6IFRoZSBvbGQgdGFyZ2V0IFVSTCAoQikgaXMgdGhlIG5ldyBzdGFydCBVUkwgKEEpLg0KICAgICAgICAgICAgY3VycmVudFVSTCA9IG5leHRVUkw7DQoNCiAgICAgICAgICAgIC8vIDQuIEdFTkVSQVRFIE5FVyBUQVJHRVQgVVJMIChDKQ0KICAgICAgICAgICAgbmV4dFVSTCA9ICdodHRwczovL2h0bWlkLmdpdGh1Yi5pby9pbWFnZXMvZ2cnK01hdGgucm91bmQoNjEwKk1hdGgucmFuZG9tKCkpKycuanBnJzsgDQoNCiAgICAgICAgICAgIC8vIDUuIFN0YXJ0IHRoZSBsb2FkIHByb2Nlc3MgZm9yIHRoZSBuZXh0IGltYWdlIChDKS4gTm8gZGVsYXkgbmVlZGVkIGhlcmUuDQogICAgICAgICAgICBzZXRUaW1lb3V0KCJsb2FkTmV4dEltYWdlQW5kU3RhcnQoKSIsIDE1MDApOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGFuZCBzdGFydHMgdGhlIGFuaW1hdGlvbiBzZXF1ZW5jZS4NCiAgICAgKi8NCiAgICB2YXIgc3RhcnRBbmltYXRpb25mdCA9ICgpID0+IHsNCiAgICAgICAgY3VycmVudEZyYW1lYmIgPSAwOw0KICAgICAgICBzZXR1cEluaXRpYWxDYW52YXMoKTsgLy8gUHJlcGFyZSB0aGUgcGl4Yml4ZWxzIGZvciB0aGUgbmV3IHRyYW5zaXRpb24NCiAgICAgICAgQU5JTUFURSgpOyAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSBhbmltYXRpb24gbG9vcA0KICAgIH07DQoNCiAgICAvLyAtLS0gSW5pdGlhbCBDYWxsIC0tLQ0KICAgIHdpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaW5pdENhbnZhc0FuZEltYWdlcygpOw0KICAgIH07DQo8L3NjcmlwdD4NCjwvYm9keT4NCjwvaHRtbD4=";


// --- Initial Data (assuming these are defined elsewhere) ---

var ifrss = ifrs.split('<br>'); // Array of base64 encoded HTML content
var ifrsst = 0; // Index for the ifrss array

// --- Configuration ---
const DURATION_MS = 20 * 1000; // 40 seconds in milliseconds
const CROSSFADE_DURATION_MS = 2000; // 1 second for the fade effect
const iframe1 = document.getElementById('animationFrame1');
const iframe2 = document.getElementById('animationFrame2');



// --- State Variables ---
let currentActiveFrame = 1; // Start with iframe1 active

/**
 * Gets the base64-encoded HTML content for the next frame.
 * @returns {string} The data URL for the iframe src.
 */
function getNextSrc() {
    const srcIndex = ifrsst % ifrss.length;
    ifrsst++;
    return "data:text/html;base64," + ifrss[srcIndex];
}

/**
 * Updates the iframe sources and swaps active frames with a crossfade effect.
 */
function loadNextFrame() {








    const activeFrame = (currentActiveFrame === 1) ? iframe1 : iframe2;
    const inactiveFrame = (currentActiveFrame === 1) ? iframe2 : iframe1;












// ... inside the loadNextFrame function ...



    // 1. Prepare the next frame: set its content and ensure sandbox is set
    inactiveFrame.setAttribute("sandbox", "allow-scripts allow-same-origin");
    inactiveFrame.src = getNextSrc();

inactiveFrame.onload = function() {
    inactiveFrame.onload = null;

    // References to the frames before the swap
    const frameToHide = activeFrame; // The frame that will fade out

    // 1. Swap the active frames (start the fade-out of frameToHide)
    inactiveFrame.classList.remove('inactive');
    inactiveFrame.classList.add('active');

    frameToHide.classList.remove('active');
    frameToHide.classList.add('inactive');

    // 2. Schedule the cleanup for the frame that just faded out
    // The timeout duration must match the CSS transition time.
    setTimeout(() => {
        // Change the source to 'about:blank' to stop script execution and free resources.
        frameToHide.src = "about:blank";
        // Optionally: frameToHide.removeAttribute("sandbox");
        console.log(`Cleaned up hidden frame.`);
    }, CROSSFADE_DURATION_MS + 50); // Add a small buffer (50ms) to ensure the fade is 100% complete

    // 3. Update the state for the next iteration
    currentActiveFrame = (currentActiveFrame === 1) ? 2 : 1;
    console.log(`Swapped to Frame ${currentActiveFrame}`);
};

}

// --- Start the animation ---
// Set initial state for the first frame (iframe1)
iframe1.setAttribute("sandbox", "allow-scripts allow-same-origin");
iframe1.src = getNextSrc();
iframe1.classList.add('active'); // Ensure the first frame starts visible

// Initialize the second frame with the next content in the background
// This preloads the next state so the transition is ready after DURATION_MS
iframe2.classList.add('inactive');
iframe2.setAttribute("sandbox", "allow-scripts allow-same-origin");
iframe2.src = getNextSrc(); // Load the content for the *first* transition

// Start the continuous cycle
setInterval(loadNextFrame, DURATION_MS);
</script>
<button id="playButton" style="width:100%;height:100%;z-index:10000000;background-color:transparent;position:fixed;left:0;top:0;border:none;"> </button>
<div id="info" style='display:none'></div>

<script>
    // --- Global Variables ---
    let audioContext = null;
    let isPlaying = false;
    let masterGain = null;
    let delayNode = null;
    let limiter = null;
    let delaySendGain = null;
    
    // --- WORKER VARIABLES ---
    let schedulerWorker = null; // NEW: Holds the reference to the inline Web Worker
    
    // --- OPTIMIZATION VARIABLES (Timeouts remain on Main Thread) ---
    let tempoChangeTimeout = null;
    let drumTimeout = null;
    let droneSweepTimeout = null;
    
    // Lookahead Scheduling Variables (nextNoteTime is now shared via Worker communication)
    const LOOKAHEAD = 0.100; // Look 100ms ahead
    const SCHEDULE_INTERVAL_MS = 25; // Check every 25ms

    // NEW: Verbeterd variabelebeheer
    let noiseBuffer = null;
    let currentVoice = null; // PERSISTENT SYNTH VOICE
    let noteIndex = 0;
    let isSweepingToMax = true;
    let activeOscillators = []; // Now only holds the long-running Drone voices

    // --- Dynamic Change Variables ---
    let currentNotes = [];
    let currentPattern = [];
    let loopCounter = 0;
    let currentLoopMax = 1;
    let echoBlockCounter = 0;
    let noEchoRepeatCount = 0;

    // --- Tempo/Rhythm Variables ---
    let tempoBPM = 80;
    let stepDurationSec = (60 / tempoBPM / 4); // Duration in Seconds

    // --- Drum Variables ---
    let currentDrumPattern = [];
    let drumIndex = 0;

    // --- Solfeggio Drone Variables ---
    let drone396 = null;
    let drone417 = null;

    // Solfeggio Constants
    const MIN_SOLFEGGIO_FREQ = 396.0;
    const MAX_SOLFEGGIO_FREQ = 417.0;
    const SWEEP_DURATION = 5.0;
    const maxDroneVolume = 0.007;
    const droneAttackTime = 30.0;

    // Frequencies and Scales
    const allFrequencies = [
        16.35, 17.32, 18.35, 19.45, 20.60, 21.83, 23.12, 24.50, 25.96, 27.50, 29.14, 30.87,
        32.70, 34.65, 36.71, 38.89, 41.20, 43.65, 46.25, 49.00, 51.91, 55.00, 58.27, 61.74,
        65.41, 69.30, 73.42, 77.78, 82.41, 87.31, 92.50, 98.00, 103.83, 110.00, 116.54, 123.47,
        130.81, 138.59, 146.83, 155.56, 164.81, 174.61, 185.00, 196.00, 207.65, 220.00, 233.08, 246.94,
        261.63, 277.18, 293.66, 311.13, 329.63, 349.23, 369.99, 392.00, 415.30, 440.00, 466.16, 493.88,
        523.25, 554.37, 587.33, 622.25, 659.25, 698.46, 739.99, 783.99, 830.61, 880.00, 932.33, 987.77,
        1046.50, 1108.73, 1174.66, 1244.51, 1318.51, 1396.91, 1479.98, 1567.98, 1661.22, 1760.00, 1864.66, 1975.53
    ];
    const scaleIntervals = [0, 3, 7, 10, 12];
    
    // =========================================================================
    // !!! INLINE WEB WORKER LOGIC !!!
    // The core scheduling loop is now defined as a string to run in a separate thread.
    // =========================================================================
    const WORKER_CODE = `
        let nextNoteTime = 0.0;
        let stepDurationSec = (60 / 80 / 4);
        const LOOKAHEAD = 0.100;
        const SCHEDULE_INTERVAL_MS = ${SCHEDULE_INTERVAL_MS};
        let lookaheadTimer = null;

        function scheduler() {
            const currentTime = self.performance.now() / 1000; // Use worker's high-res timer

            // Schedule notes that fall within the lookahead window
            while (nextNoteTime < currentTime + LOOKAHEAD) {
                // Send the exact time back to the main thread for Web Audio API scheduling
                self.postMessage({
                    type: 'schedule_note',
                    time: nextNoteTime
                });
                
                // Advance the next note time by the step duration
                nextNoteTime += stepDurationSec;
            }

            // Schedule the next check
            lookaheadTimer = setTimeout(scheduler, SCHEDULE_INTERVAL_MS);
        }

        self.onmessage = function(e) {
            const data = e.data;
            if (data.type === 'start') {
                nextNoteTime = data.startTime;
                stepDurationSec = data.stepDuration;
                scheduler();
            } else if (data.type === 'stop') {
                clearTimeout(lookaheadTimer);
            } else if (data.type === 'set_tempo') {
                // Update tempo without restarting the loop
                stepDurationSec = data.stepDuration;
            } else if (data.type === 'log') {
                // Simple debug for worker communication
                // console.log('Worker received:', data.message); 
            }
        };
    `;
    
    // --- WORKER SETUP FUNCTION ---
    function setupWorker() {
        if (schedulerWorker) return; // Already set up

        try {
            // 1. Create a Blob from the Worker code string
            const blob = new Blob([WORKER_CODE], { type: 'application/javascript' });
            
            // 2. Create an Object URL for the Blob (looks like a file path to the browser)
            const workerUrl = URL.createObjectURL(blob);
            
            // 3. Instantiate the Worker
            schedulerWorker = new Worker(workerUrl);

            // 4. Set up the worker message listener for the main thread
            schedulerWorker.onmessage = function(e) {
                if (e.data.type === 'schedule_note') {
                    // The core action: run the Web Audio API calls on the main thread
                    scheduleNoteAtTime(e.data.time);
                }
            };

            schedulerWorker.onerror = function(e) {
                console.error('Worker error:', e);
                // Fallback: Optionally restart the main-thread scheduler if the worker fails
            };

        } catch (e) {
            console.error('Failed to set up inline Web Worker. Falling back to main-thread scheduler.', e);
            // If worker creation fails (e.g., in an old browser), you could fall back here:
            // schedulerWorker = { postMessage: () => {}, terminate: () => {} };
        }
    }
    // =========================================================================

    // --- Generator Functions, Utility Functions, Core Audio Setup (UNCHANGED) ---
    function generateUniqueScale() {
        // ... (unchanged logic) ...
        const minIndex = 36;
        const maxIndex = allFrequencies.length - 15;
        const rootIndex = Math.floor(Math.random() * (maxIndex - minIndex)) + minIndex;
        const tempScale = [];

        for (let i = 0; i < scaleIntervals.length; i++) {
            let noteIndex = rootIndex + scaleIntervals[i];
            if (allFrequencies[noteIndex]) {
                tempScale.push(allFrequencies[noteIndex]);
            }
            if (i === 1 || i === 2) {
                if (allFrequencies[noteIndex + 12]) {
                    tempScale.push(allFrequencies[noteIndex + 12]);
                }
            }
        }

        let newScale = [...new Set(tempScale)];
        newScale.sort((a, b) => a - b);

        if (newScale.length < 4) {
            return [261.63, 311.13, 392.00, 466.16];
        }

        return newScale.slice(0, 8);
    }
    function generateUniquePattern(scaleLength) {
        // ... (unchanged logic) ...
        const validScaleLength = Math.max(1, scaleLength);
        const baseIndices = Array.from({ length: validScaleLength }, (_, i) => i);

        for (let i = baseIndices.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [baseIndices[i], baseIndices[j]] = [baseIndices[j], baseIndices[i]];
        }

        const patternLength = Math.floor(Math.random() * 4) + 8;
        const newPattern = [];
        for (let i = 0; i < patternLength; i++) {
            const randomIndex = Math.floor(Math.random() * baseIndices.length);
            newPattern.push(baseIndices[randomIndex]);
        }

        return newPattern;
    }
    function calculateNextLoopMax() {
        currentLoopMax = (Math.floor(Math.random() * 3) + 1) * 2;
    }
    function changePatternAndKey() {
        currentNotes = generateUniqueScale();
        currentPattern = generateUniquePattern(currentNotes.length);
        calculateNextLoopMax();
    }
    function setEcho(isOn) {
        if (!delaySendGain) return;
        const time = audioContext.currentTime;
        delaySendGain.gain.cancelScheduledValues(time);
        delaySendGain.gain.setValueAtTime(isOn ? 1.0 : 0.0, time);
    }
    function cleanupAudioNode(node) {
        if (node && typeof node.stop === 'function') {
            try { node.stop(); } catch (e) { }
        }
        if (node && typeof node.disconnect === 'function') {
            try { node.disconnect(); } catch (e) { }
        }
    }
    function createNoiseBuffer(duration) {
        const sampleRate = audioContext.sampleRate;
        const bufferSize = sampleRate * duration;
        const buffer = audioContext.createBuffer(1, bufferSize, sampleRate);
        const output = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            output[i] = Math.random() * 2 - 1;
        }
        return buffer;
    }
    function initAudio() {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        audioContext.resume();

        tempoBPM = 80;
        stepDurationSec = (60 / tempoBPM / 4);

        noiseBuffer = createNoiseBuffer(0.1);

        // 1. Limiter Node
        limiter = audioContext.createDynamicsCompressor();
        limiter.threshold.setValueAtTime(-6, audioContext.currentTime);
        limiter.knee.setValueAtTime(0, audioContext.currentTime);
        limiter.ratio.setValueAtTime(20, audioContext.currentTime);
        limiter.attack.setValueAtTime(0.001, audioContext.currentTime);
        limiter.release.setValueAtTime(0.05, audioContext.currentTime);

        // 2. Master Gain
        masterGain = audioContext.createGain();
        masterGain.gain.setValueAtTime(0.6, audioContext.currentTime);

        // 3. Delay/Echo Setup
        delayNode = audioContext.createDelay(2.0);
        delayNode.delayTime.setValueAtTime(0.4, audioContext.currentTime);

        const feedbackGain = audioContext.createGain();
        feedbackGain.gain.setValueAtTime(0.5, audioContext.currentTime);

        delaySendGain = audioContext.createGain();
        delaySendGain.gain.setValueAtTime(1.0, audioContext.currentTime);

        // --- Connections ---
        masterGain.connect(limiter);
        masterGain.connect(delaySendGain);

        delaySendGain.connect(delayNode);
        delayNode.connect(feedbackGain);
        feedbackGain.connect(delayNode);
        delayNode.connect(limiter);

        limiter.connect(audioContext.destination);

        // Initial setup
        changePatternAndKey();
        currentDrumPattern = generateDrumPattern();
        
        // Setup the worker on first init
        setupWorker(); 
    }
    function cleanupSynthVoice(voice) {
        if (!voice || !audioContext) return;
        const fadeOutTime = 0.6;
        const time = audioContext.currentTime;
        try {
            voice.stopNode.gain.cancelAndHoldAtTime(time);
            voice.stopNode.gain.linearRampToValueAtTime(0.0, time + fadeOutTime);

            setTimeout(() => {
                cleanupAudioNode(voice.osc);
                if (voice.lfo) cleanupAudioNode(voice.lfo);
                voice.stopNode.disconnect();
                const index = activeOscillators.indexOf(voice);
                if (index > -1) activeOscillators.splice(index, 1);
            }, fadeOutTime * 1000 + 10);
        } catch (e) {
            console.warn("Error fading out synth voice:", e);
        }
    }
    function createSynthVoice(frequency) {
        if (!audioContext) return;
        const time = audioContext.currentTime;

        const osc = audioContext.createOscillator();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(frequency, time);

        const lfo = audioContext.createOscillator();
        lfo.type = 'triangle';
        lfo.frequency.setValueAtTime(4.0, time);
        const lfoGain = audioContext.createGain();
        lfoGain.gain.setValueAtTime(2.0, time);

        const envGain = audioContext.createGain();
        envGain.gain.setValueAtTime(0.0, time);

        envGain.gain.linearRampToValueAtTime(0.7, time + 3.0);

        lfo.connect(lfoGain);
        lfoGain.connect(osc.detune);

        osc.connect(envGain);
        envGain.connect(masterGain);

        lfo.start(time);
        osc.start(time);

        return { osc: osc, stopNode: envGain, lfo: lfo };
    }
    function createSolfeggioDrone(initialFrequency) {
        if (!audioContext) return null;
        const time = audioContext.currentTime;

        const osc = audioContext.createOscillator();
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(initialFrequency, time);

        const lfo = audioContext.createOscillator();
        lfo.type = 'sine';
        lfo.frequency.setValueAtTime(0.5 + Math.random() * 0.2, time);
        const lfoGain = audioContext.createGain();
        lfoGain.gain.setValueAtTime(0.2, time);

        const envGain = audioContext.createGain();
        envGain.gain.setValueAtTime(0.0001, time);

        envGain.gain.linearRampToValueAtTime(maxDroneVolume, time + droneAttackTime);

        lfo.connect(lfoGain);
        lfoGain.connect(osc.detune);

        osc.connect(envGain);
        envGain.connect(masterGain);

        lfo.start(time);
        osc.start(time);

        const drone = { osc: osc, stopNode: envGain, lfo: lfo };
        activeOscillators.push(drone);
        return drone;
    }
    function createPercussionSound(time, type, volume) {
        if (!audioContext) return;
        const nodesToCleanup = [];
        const drumGain = audioContext.createGain();
        drumGain.gain.setValueAtTime(0.0001, time);
        drumGain.connect(limiter);
        nodesToCleanup.push(drumGain);

        let duration = 0.0;

        switch(type) {
            case 'kick': {
                const osc = audioContext.createOscillator();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(80.0, time);
                osc.frequency.exponentialRampToValueAtTime(30.0, time + 0.15);
                osc.connect(drumGain);
                drumGain.gain.exponentialRampToValueAtTime(volume * 1.5, time + 0.005);
                drumGain.gain.exponentialRampToValueAtTime(0.0001, time + 0.3);
                osc.start(time);
                osc.stop(time + 0.3);
                duration = 0.3;
                nodesToCleanup.push(osc);
                break;
            }
            case 'snare': {
                const noise = audioContext.createBufferSource();
                if (!noiseBuffer) return;
                noise.buffer = noiseBuffer;
                noise.loop = true;
                const bandpass = audioContext.createBiquadFilter();
                bandpass.type = 'bandpass';
                bandpass.frequency.setValueAtTime(1500, time);
                bandpass.Q.setValueAtTime(5, time);
                noise.connect(bandpass);
                bandpass.connect(drumGain);
                drumGain.gain.exponentialRampToValueAtTime(volume * 0.8, time + 0.001);
                drumGain.gain.exponentialRampToValueAtTime(0.0001, time + 0.1);
                noise.start(time);
                noise.stop(time + 0.15);
                duration = 0.15;
                nodesToCleanup.push(noise, bandpass);
                break;
            }
            case 'closedhat': {
                const noise = audioContext.createBufferSource();
                if (!noiseBuffer) return;
                noise.buffer = noiseBuffer;
                noise.loop = true;
                const hiPass = audioContext.createBiquadFilter();
                hiPass.type = 'highpass';
                hiPass.frequency.setValueAtTime(7000, time);
                noise.connect(hiPass);
                hiPass.connect(drumGain);
                drumGain.gain.exponentialRampToValueAtTime(volume * 0.5, time + 0.001);
                drumGain.gain.exponentialRampToValueAtTime(0.0001, time + 0.08);
                noise.start(time);
                noise.stop(time + 0.08);
                duration = 0.08;
                nodesToCleanup.push(noise, hiPass);
                break;
            }
            case 'openhat': {
                const noise = audioContext.createBufferSource();
                if (!noiseBuffer) return;
                noise.buffer = noiseBuffer;
                noise.loop = true;
                const hiPass = audioContext.createBiquadFilter();
                hiPass.type = 'highpass';
                hiPass.frequency.setValueAtTime(7000, time);
                noise.connect(hiPass);
                hiPass.connect(drumGain);
                drumGain.gain.exponentialRampToValueAtTime(volume * 0.4, time + 0.001);
                drumGain.gain.exponentialRampToValueAtTime(0.0001, time + 0.4);
                noise.start(time);
                noise.stop(time + 0.4);
                duration = 0.4;
                nodesToCleanup.push(noise, hiPass);
                break;
            }
        }
        
        setTimeout(() => {
            nodesToCleanup.forEach(cleanupAudioNode);
        }, (duration * 1000) + 10);
    }
    function generateDrumPattern() {
        // ... (unchanged logic) ...
        const patternLength = 16;
        const newPattern = [];

        for (let i = 0; i < patternLength; i++) {
            const step = [0, 0, 0, 0];

            if (i % 4 === 0) {
                step[0] = 1;
            } else if (i % 2 === 1) {
                step[0] = Math.random() < 0.15 ? 1 : 0;
            }

            if (i === 4 || i === 12) {
                step[1] = 1;
            } else if (i % 2 === 1) {
                step[1] = Math.random() < 0.1 ? 1 : 0;
            }

            if (i % 2 === 1) {
                step[2] = 1;
            } else if (i % 4 === 0) {
                step[2] = Math.random() < 0.2 ? 1 : 0;
            }

            if (i % 8 === 3 || i % 8 === 7) {
                step[3] = Math.random() < 0.4 ? 1 : 0;
            }

            if (step[2] === 1 && step[3] === 1) {
                step[3] = 0;
            }

            newPattern.push(step);
        }
        return newPattern;
    }
    function scheduleDrumStep(time) {
        if (!isPlaying || !audioContext) return;

        const step = currentDrumPattern[drumIndex % currentDrumPattern.length];
        const KICK = step[0];
        const SNARE = step[1];
        const CLOSED_HAT = step[2];
        const OPEN_HAT = step[3];

        if (drumIndex > 0 && drumIndex % currentDrumPattern.length === 0) {
            currentDrumPattern = generateDrumPattern();
        }

        if (KICK) createPercussionSound(time, 'kick', 0.8);
        if (SNARE) createPercussionSound(time, 'snare', 0.4);
        if (CLOSED_HAT) createPercussionSound(time, 'closedhat', 0.2);
        if (OPEN_HAT) createPercussionSound(time, 'openhat', 0.3);

        drumIndex++;
    }
    function scheduleDroneSweep() {
        if (!isPlaying || !audioContext) return;
        const time = audioContext.currentTime;

        const targetFreq = isSweepingToMax ? MAX_SOLFEGGIO_FREQ : MIN_SOLFEGGIO_FREQ;
        const isRamp = Math.random() < 0.7;
        const sweepTime = isRamp ? SWEEP_DURATION : 0.001;

        const updateFrequency = (drone) => {
            if (drone && drone.osc) {
                drone.osc.frequency.cancelScheduledValues(time);
                if (isRamp) {
                    drone.osc.frequency.linearRampToValueAtTime(targetFreq, time + sweepTime);
                } else {
                    drone.osc.frequency.setValueAtTime(targetFreq, time);
                }
            }
        };

        updateFrequency(drone396);
        updateFrequency(drone417);

        isSweepingToMax = !isSweepingToMax;

        const randomWaitTime = Math.random() * 20 + 20;
        const nextChangeTimeMs = (sweepTime + randomWaitTime) * 1000;
        
        if (droneSweepTimeout) clearTimeout(droneSweepTimeout);
        droneSweepTimeout = setTimeout(scheduleDroneSweep, nextChangeTimeMs);
    }
    
    // --- Lookahead Scheduling Core Functions (REVISED) ---

    // *** REMOVED: The old scheduler() function is now in the WORKER_CODE string. ***

    // This function now runs when the worker tells the main thread to schedule a note.
    function scheduleNoteAtTime(time) {
        if (!isPlaying) return;

        const patternLength = currentPattern.length;
        const isPatternEnd = (noteIndex > 0 && noteIndex % patternLength === 0);

        const patternIndex = currentPattern[noteIndex % patternLength];
        const noteIndexInScale = patternIndex % currentNotes.length;
        const freq = currentNotes[noteIndexInScale];

        // --- Dynamic Structure Logic ---
        if (noteIndex > 0 && isPatternEnd) {
            loopCounter++;

            if (echoBlockCounter === 2 && noEchoRepeatCount > 0) {
                if (loopCounter >= noEchoRepeatCount) {
                    echoBlockCounter = 0;
                    noEchoRepeatCount = 0;
                    setEcho(true);
                    changePatternAndKey();
                    loopCounter = 0;
                }
            } else if (loopCounter >= currentLoopMax) {
                echoBlockCounter++;
                loopCounter = 0;

                if (echoBlockCounter === 3) {
                    setEcho(false);
                    noEchoRepeatCount = Math.floor(Math.random() * 2) + 2;
                } else {
                    setEcho(true);
                    changePatternAndKey();
                }
            }
        }
        
        // --- Core Synth Logic (Updates Persistent Voice) ---
        if (currentVoice && currentVoice.osc) {
            currentVoice.osc.frequency.setValueAtTime(freq, time);
        }
        
        // --- Drum Logic (Only triggered after intro) ---
        if (drumIndex >= 0) {
            scheduleDrumStep(time);
        }

        noteIndex++;
        
        // OPTIONAL: Update a visual element on every step
        // document.getElementById('info').innerText = `Note: ${noteIndex}, Loop: ${loopCounter}, BPM: ${tempoBPM.toFixed(2)}`;
    }

    function scheduleTempoChange() {
        if (!isPlaying) return;

        const changePercent = (Math.random() * 0.05) + 0.10;
        const direction = Math.random() < 0.5 ? 1 : -1;

        let newBPM = tempoBPM * (1 + (direction * changePercent));
        newBPM = Math.min(100, Math.max(60, newBPM));

        tempoBPM = newBPM;
        stepDurationSec = (60 / tempoBPM / 4);

        // *** NEW: Tell the worker to update its step duration ***
        if (schedulerWorker) {
            schedulerWorker.postMessage({
                type: 'set_tempo',
                stepDuration: stepDurationSec
            });
        }
        
        const nextChangeTimeMs = (Math.random() * 60 + 60) * 1000;
        if (tempoChangeTimeout) clearTimeout(tempoChangeTimeout);
        tempoChangeTimeout = setTimeout(scheduleTempoChange, nextChangeTimeMs);
    }

    function startArpeggiator() {
        if (!audioContext) return;

        // Reset state on start
        noteIndex = 0;
        loopCounter = 0;
        currentLoopMax = (Math.floor(Math.random() * 3) + 1) * 2;
        echoBlockCounter = 0;
        noEchoRepeatCount = 0;
        setEcho(true);

        // 1. Setup Persistent Synth Voice
        if (!currentVoice) {
            currentVoice = createSynthVoice(currentNotes[currentPattern[0] % currentNotes.length]);
        }

        // 2. Start Drones
        if (!drone396) { drone396 = createSolfeggioDrone(MIN_SOLFEGGIO_FREQ); }
        if (!drone417) { drone417 = createSolfeggioDrone(MIN_SOLFEGGIO_FREQ); }
        
        // 3. Start Sweeps and Tempo
        if (!droneSweepTimeout) { isSweepingToMax = true; scheduleDroneSweep(); }
        if (!tempoChangeTimeout) scheduleTempoChange();

        // 4. Start Lookahead Scheduler (VIA WORKER)
        if (schedulerWorker) {
            schedulerWorker.postMessage({
                type: 'start',
                startTime: audioContext.currentTime,
                stepDuration: stepDurationSec
            });
        }

        // 5. Start Drums after intro
        const introDurationMs = 44000;
        drumIndex = -1;
        if (drumTimeout) clearTimeout(drumTimeout);
        drumTimeout = setTimeout(() => {
            if (isPlaying) {
                drumIndex = 0;
            }
        }, introDurationMs);
    }
    
    function stopAudio() {
        if (!audioContext) return;
        isPlaying = false;
        
        // *** NEW: Stop the worker's loop ***
        if (schedulerWorker) {
            schedulerWorker.postMessage({ type: 'stop' });
        }
        
        // Clear all the main thread Timeouts
        clearTimeout(drumTimeout);
        clearTimeout(droneSweepTimeout);
        clearTimeout(tempoChangeTimeout);
        
        // ... (rest of cleanup logic) ...
        drumTimeout = null;
        droneSweepTimeout = null;
        tempoChangeTimeout = null;

        cleanupSynthVoice(currentVoice);
        currentVoice = null;
        
        activeOscillators.slice().forEach(cleanupSynthVoice);
        drone396 = null;
        drone417 = null;
        activeOscillators = [];

        if (audioContext && audioContext.state === 'running') {
            audioContext.suspend();
        }

        loopCounter = 0;
        currentLoopMax = 1;
        echoBlockCounter = 0;
        noEchoRepeatCount = 0;
        isSweepingToMax = true;
        tempoBPM = 80;
    }

    // --- Event Listener ---
    document.getElementById('playButton').addEventListener('click', () => {
        if (!audioContext || audioContext.state === 'suspended' || audioContext.state === 'closed') {
            if (!audioContext || audioContext.state === 'closed') {
                initAudio();
            } else {
                audioContext.resume();
            }

            isPlaying = true;
            startArpeggiator();
            document.getElementById('info').innerText = 'Playing...';

        } else if (audioContext.state === 'running') {
            stopAudio();
            document.getElementById('info').innerText = 'Stopped';
        }
    });

</script>
</body>
</html>