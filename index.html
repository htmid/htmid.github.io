<!DOCTYPE html>
<html lang="en">
<head>
 <meta name="author" content="Stephan Wolfram - Ridouan Ben Massoud - (Player Bing's Copilot: Credits, Great Sound Weeds from Original Roland GM.sf2 included)  Google Gemini & chat Deepseek Ai. All Rechten Voorbehouden.">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Systemic Accountability & Exploitation Signal</title>
	  <style>
    :root {
  --win95-bg: #008080; /* Classic Windows 95 teal */
  --win95-grey-dark: #808080; /* Windows 95 dark grey */
  --win95-grey-med: #C0C0C0; /* Windows 95 medium grey */
  --win95-grey-light: #E0E0E0; /* Windows 95 light grey */
  --win95-blue: #000080; /* Classic Windows 95 blue */
  --win95-blue-bright: #1084d0; /* Brighter blue for accents */
  --win95-green: #008000; /* Windows 95 green */
  --win95-red: #800000; /* Windows 95 red */
  --win95-yellow: #808000; /* Windows 95 yellow */
  --win95-shadow: rgba(0, 0, 0, 0.35); /* Windows-style shadow */
  --win95-highlight: rgba(255, 255, 255, 0.7); /* Bevel highlight */
}

html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  background: var(--win95-bg);
  background-image: linear-gradient(
    45deg,
    rgba(0, 128, 128, 0.9) 0%,
    rgba(0, 0, 128, 0.9) 100%
  );
  color: #000;
  font-family: "MS Sans Serif", "Microsoft Sans Serif", Tahoma, Geneva, sans-serif;
  font-size: 11px;
  letter-spacing: 0.5px;
}

.wrap {
  display: grid;
  place-items: center;
  position: fixed;
  top: 33%;
  left: 27.5%;
  width: 33%;
  opacity: 0.95;
}

/* Windows 95 style player */
.player {
  position: relative;
  width: min(860px, 92vw);
  background: var(--win95-grey-med);
  border: 0px solid;
  border-color: var(--win95-grey-light) var(--win95-grey-dark) var(--win95-grey-dark) var(--win95-grey-light);
  box-shadow: 
    0px 4px 12px var(--win95-shadow),
    inset 2px 2px 0 var(--win95-highlight),
    inset -2px -2px 0 var(--win95-grey-dark);
  transition: all 0.16s ease;
}

.top {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 14px;
  background: var(--win95-blue);

}

.btn {
  appearance: none;
  border: 0px solid;
  border-color: var(--win95-grey-light) var(--win95-grey-dark) var(--win95-grey-dark) var(--win95-grey-light);
  background: var(--win95-grey-med);
  color: #000;
  font-family: "MS Sans Serif", sans-serif;
  font-size: 11px;
  font-weight: bold;
  padding: 6px 12px;
  cursor: pointer;
  min-width: 80px;
  text-align: center;
  box-shadow: 
    inset 1px 1px 0 var(--win95-highlight),
    inset -1px -1px 0 var(--win95-grey-dark);
  transition: all 0.15s ease;
}

.btn:hover {
  border-color: var(--win95-grey-dark) var(--win95-grey-light) var(--win95-grey-light) var(--win95-grey-dark);
  box-shadow: 
    inset 1px 1px 0 var(--win95-grey-dark),
    inset -1px -1px 0 var(--win95-grey-light);
}

.btn:active {
  border-color: var(--win95-grey-dark) var(--win95-grey-light) var(--win95-grey-light) var(--win95-grey-dark);
  background: var(--win95-grey-dark);
  transform: translate(1px, 1px);
}

.filelabel {
  position: relative;
  overflow: hidden;
}

.filelabel input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

.spacer {
  flex: 1;
}

.title {
  font-weight: bold;
  color: #FFF;
  font-size: 14px;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  letter-spacing: 0.5px;
}

.tri {
  width: 0;
  height: 0;
  border-left: 8px solid transparent;
  border-right: 8px solid transparent;
  border-bottom: 14px solid #FFF;
  filter: drop-shadow(1px 1px 1px rgba(0, 0, 0, 0.5));
}

.bar {
  position: relative;
  height: 16px;
  margin: 12px 14px 14px;
  background: var(--win95-grey-light);
  border: 0px solid;
  border-color: var(--win95-grey-dark) var(--win95-grey-light) var(--win95-grey-light) var(--win95-grey-dark);
  box-shadow: inset 1px 1px 0 var(--win95-grey-dark), inset -1px -1px 0 var(--win95-grey-light);
}

.prog {
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--win95-blue), var(--win95-blue-bright));
  box-shadow: inset 1px 1px 0 rgba(255, 255, 255, 0.4);
}

.hint {
  position: absolute;
  right: 12px;
  top: 12px;
  color: #000;
  background: var(--win95-yellow);
  padding: 4px 8px;
  border: 0px solid;
  border-color: var(--win95-grey-light) var(--win95-grey-dark) var(--win95-grey-dark) var(--win95-grey-light);
  font-size: 10px;
  font-weight: bold;
  display: none;
}

canvas {
  display: block;
  width: 100%;
  height: 22vh;
  background: rgba(0, 0, 0, 0.1);

  border-bottom: 0px solid var(--win95-grey-dark);
}

/* Windows 95 neon frame overlay */
.neon-frame {
  position: absolute;
  inset: 0;
  pointer-events: none;
  background: repeating-linear-gradient(
    45deg,
    rgba(0, 128, 128, 0.2) 0px,
    rgba(0, 128, 128, 0.2) 2px,
    rgba(0, 0, 128, 0.2) 2px,
    rgba(0, 0, 128, 0.2) 4px
  );
  opacity: 0;
  transition: opacity 0.25s ease;
  border: 2px solid var(--win95-blue-bright);
  box-shadow: inset 0 0 12px rgba(16, 132, 208, 0.3);
}

.neon-frame.active {
  opacity: 1;
}

/* Windows 95 detached parts */
.part {
  position: absolute;
  width: 110px;
  height: 110px;
  border: 2px solid;
  border-color: var(--win95-grey-light) var(--win95-grey-dark) var(--win95-grey-dark) var(--win95-grey-light);
  display: grid;
  place-items: center;
  color: #000;
  font-weight: bold;
  background: var(--win95-grey-med);
  box-shadow: 4px 4px 8px var(--win95-shadow);
  pointer-events: none;
  will-change: transform, border-radius, filter;
}

.partA {
  background: linear-gradient(135deg, var(--win95-blue), var(--win95-blue-bright));
  color: #FFF;
}

.partB {
  background: linear-gradient(135deg, var(--win95-green), #00C000);
  color: #FFF;
}

.partC {
  background: linear-gradient(135deg, var(--win95-red), #C00000);
  color: #FFF;
}

/* 20s: Buttons get Windows 95 retro effects */
.btn.neonize {
  color: #000;
  background: linear-gradient(135deg, var(--win95-blue-bright), var(--win95-blue));
  border-color: var(--win95-blue-bright) var(--win95-blue) var(--win95-blue) var(--win95-blue-bright);
  animation: win95ColorShift 2.2s linear infinite, win95Freestyle 1.6s ease-in-out infinite alternate;
  box-shadow: 
    0 0 8px rgba(16, 132, 208, 0.6),
    inset 1px 1px 0 rgba(255, 255, 255, 0.4),
    inset -1px -1px 0 rgba(0, 0, 128, 0.4);
}

@keyframes win95ColorShift {
  0%   { border-color: var(--win95-blue) var(--win95-blue-bright) var(--win95-blue-bright) var(--win95-blue); }
  25%  { border-color: var(--win95-green) #00C000 #00C000 var(--win95-green); }
  50%  { border-color: var(--win95-red) #C00000 #C00000 var(--win95-red); }
  75%  { border-color: var(--win95-yellow) #C0C000 #C0C000 var(--win95-yellow); }
  100% { border-color: var(--win95-blue) var(--win95-blue-bright) var(--win95-blue-bright) var(--win95-blue); }
}

@keyframes win95Freestyle {
  0%   { transform: translate(0,0) rotate(0deg) scale(1); }
  25%  { transform: translate(-8px, 4px) rotate(-3deg) scale(1.03); }
  50%  { transform: translate(6px, -6px) rotate(4deg) scale(0.98); }
  75%  { transform: translate(-4px, 8px) rotate(-6deg) scale(1.04); }
  100% { transform: translate(8px, -5px) rotate(6deg) scale(0.97); }
}

/* 30s: Player gets Windows 95 system error style */
.player.spin-osc {
  animation: win95Spin 1.4s linear infinite, win95OscillateX 0.34s ease-in-out infinite alternate;
  border-color: var(--win95-red) #C00000 #C00000 var(--win95-red);
  background: linear-gradient(135deg, var(--win95-grey-med), #E0E0E0);
}

@keyframes win95Spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

@keyframes win95OscillateX {
  from { transform: translateX(-40px); }
  to { transform: translateX(40px); }
}

/* 35s: Windows 95 extreme error state */
.player.neon-round {
  border-radius: 4px; /* Windows 95 rarely used circles */
  background: repeating-linear-gradient(
    45deg,
    var(--win95-blue),
    var(--win95-blue) 4px,
    var(--win95-red) 4px,
    var(--win95-red) 8px
  );
  border-color: var(--win95-blue-bright) var(--win95-blue) var(--win95-blue) var(--win95-blue-bright);
  animation: win95ErrorPulse 1.2s ease-in-out infinite alternate, win95Schizo 0.8s linear infinite;
  box-shadow: 
    0 0 20px rgba(16, 132, 208, 0.5),
    0 0 30px rgba(192, 0, 0, 0.4),
    inset 0 0 20px rgba(255, 255, 255, 0.3);
}

@keyframes win95ErrorPulse {
  0% { 
    border-color: var(--win95-blue) var(--win95-red) var(--win95-red) var(--win95-blue);
    box-shadow: 0 0 15px rgba(16, 132, 208, 0.6), 0 0 25px rgba(192, 0, 0, 0.5);
  }
  100% { 
    border-color: var(--win95-red) var(--win95-blue) var(--win95-blue) var(--win95-red);
    box-shadow: 0 0 25px rgba(192, 0, 0, 0.7), 0 0 35px rgba(16, 132, 208, 0.6);
  }
}

@keyframes win95Schizo {
  0%   { transform: translate(-6px, 0) rotate(-3deg) scale(1.01); }
  20%  { transform: translate(8px, -4px) rotate(6deg) scale(0.99); }
  40%  { transform: translate(-12px, 6px) rotate(-10deg) scale(1.02); }
  60%  { transform: translate(14px, -8px) rotate(12deg) scale(0.98); }
  80%  { transform: translate(-8px, 4px) rotate(-6deg) scale(1.03); }
  100% { transform: translate(10px, -5px) rotate(9deg) scale(0.97); }
}

/* Additional Windows 95 style elements */
.win95-header {
  background: linear-gradient(90deg, var(--win95-blue), #0000A0);
  color: #FFF;
  padding: 6px 10px;
  font-weight: bold;
  border-bottom: 2px solid var(--win95-grey-dark);
}

.win95-window {
  background: var(--win95-grey-med);
  border: 2px solid;
  border-color: var(--win95-grey-light) var(--win95-grey-dark) var(--win95-grey-dark) var(--win95-grey-light);
  margin: 8px;
}

  </style>
    <style>
	 :root {
    --bg: #0b0b12;
    --fg: #e8efff;
  }
  /* Screen centering and 50% sizing */
  body {
    margin: 0;

    color: var(--fg);
    height: 100vh;
    display: grid;
    place-items: center;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    overflow: hidden;
  }
  
  
    #log{
  
   height: 300px;
  overflow-y: scroll;
  scrollbar-width: none;      /* Firefox */
}

#log::-webkit-scrollbar {
  display: none;              /* Chrome, Edge, Safari */
}

textarea {
  display: flex;
  flex-direction: column-reverse;
  overflow-y: scroll;
  scrollbar-width: none;
}

textarea::-webkit-scrollbar {
  display: none;
}


  #world {
    position: relative;
    width: 50vw;
    height: 50vh;
    display: grid;
    grid-template-rows: auto 1fr;
    border: 2px solid rgba(255,255,255,0.12);
    border-radius: 18px;
    box-shadow: 0 0 40px rgba(64,128,255,0.25), inset 0 0 30px rgba(255,255,255,0.05);
    backdrop-filter: blur(6px) saturate(120%);
    overflow: hidden;
  }
  canvas#field {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    z-index: 0;
  }
  /* Language console */
  #voice {
    z-index: 3;
    padding: 8px 12px;
    border-bottom: 1px solid rgba(255,255,255,0.12);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(0,0,0,0));
    font-size: 12px;
    letter-spacing: 0.2px;
    line-height: 1.35;
    height: 56px;
    overflow: hidden;
  }
  #voice .line { opacity: 0.9; }
  #voice .metrics { opacity: 0.7; font-size: 11px; }
  /* Panel containing the required fieldsets */
  #animatedPanel {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 10px;
    height: calc(100% - 56px);
    overflow: auto;
    scrollbar-width: thin;
  }
  a {
text-decoration: none;
}
  
  fieldset {
    position: relative;
    border: 2px solid rgba(255,255,255,0.25);
    border-radius: 12px;
    padding: 8px 12px;
    mix-blend-mode: screen;
    background: rgba(8,12,24,0.3);
    transition: filter 0.6s ease, transform 0.8s cubic-bezier(.2,.7,.1,1), border-color 0.8s ease;
  }
  fieldset[data-affect="energy"] { border-color: rgba(64,192,255,0.45); }
  fieldset[data-affect="love"]   { border-color: rgba(255,64,192,0.45); }
  fieldset[data-affect="flow"]   { border-color: rgba(64,255,128,0.45); }

  legend {
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 0.3px;
    transition: color 0.6s ease;
  }
  .control-row {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
  }

  /* Unique buttons via per-element genome */
  button {
    position: relative;
    cursor: pointer;
    border: none;
    padding: 8px 12px;
    color: #081018;
    font-weight: 600;
    letter-spacing: 0.2px;
    background: #aaf;
    border-radius: 10px;
    transition: transform 300ms ease, filter 300ms ease, background 400ms ease, border-radius 400ms ease;
    outline: 0;
  }
  button.stop { color: #fff; }
  button:disabled { opacity: 0.6; cursor: not-allowed; }

  .status-bar, .tempo-display {
    font-size: 12px;
    opacity: 0.85;
    transition: color 0.6s ease, font-size 0.6s ease;
  }

  .progress-container {
    width: 100%;
    height: 12px;
    background: rgba(255,255,255,0.08);
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid rgba(255,255,255,0.12);
  }
  .progress-bar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #49ffa8, #38a1ff);
    transition: width 0.2s linear;
  }

  /* Trait badges */
  .traits {
    position: absolute;
    top: 6px; right: 8px;
    font-size: 10px;
    opacity: 0.7;
  }
  .badge { margin-left: 6px; padding: 2px 6px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.25); }
    </style>
	
	<style>
        /* Stijlen van de originele code behouden voor consistentie */
        * {
            box-sizing: border-box;
        }



        #containerg {
            max-width: 600px;
	    background-position:center center;
            backgruond-size:30% 30%;	
            margin: 0 auto;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
     
        }

        /* --- Nieuwe en Aangepaste Stijlen voor Checkboxen & Toggle --- */

        .select-wrapper {
            max-width: 300px;
            margin: 0 auto 20px auto;
            border-radius: 8px;
            background-color: white;
			color:black;
            border: 2px solid #ddd;
            position: relative; /* Voor absolute positionering van de dropdown-pijl */
        }

        .dropdown-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 12px 15px;
            font-size: 16px;
			color:black;
            background-color: transparent;
            border: none;
            cursor: pointer;
            text-align: left;
            border-radius: 6px;
            outline: none;
            color: #333;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .dropdown-toggle:focus {
            box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
        }

        .arrow {
            transition: transform 0.3s;
            font-size: 18px;
        }

        .select-wrapper.open .arrow {
            transform: rotate(180deg);
        }

        .genre-options {
    
            overflow-y: auto;
            border-top: 1px solid #eee;
            padding: 0;
            margin: 0;
            display: none; /* Standaard verborgen */
        }
        
        .select-wrapper.open .genre-options {
            display: block; /* Toon bij 'open' */
        }

        .genre-option-item {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .genre-option-item:hover {
            background-color: #f0f0f0;
        }

        .genre-option-item input[type="checkbox"] {
            margin-right: 10px;
            /* Basis checkbox styling */
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Styling voor geselecteerde tekst in toggle-knop */
        .toggle-text {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex-grow: 1;
        }
        
        /* --- Controls & Counters (Behouden en Aangepast) --- */

        .controlsg {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .icon-btn {
            padding: 8px 12px;
            background-color: #007AFF;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        .icon-btn:hover {
            background-color: #0056CC;
        }

        .icon-btn.reset {
            background-color: #6c757d;
        }

        .icon-btn.reset:hover {
            background-color: #545b62;
        }

        .counter {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 14px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Oude info-box verwijderd, counter is voldoende */

        /* Mobiele aanpassingen */
        @media (max-width: 768px) {
            .dropdown-toggle {
                padding: 15px;
                font-size: 17px;
                min-height: 50px;
            }
            .controlsg {
                gap: 10px;
            }
            .icon-btn {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }
        }
    </style>
	
<style>
  :root {
    --bg: #0b0b12;
    --fg: #e8efff;
    --primary: rgba(64, 128, 255, 0.6);
    --border: rgba(255, 255, 255, 0.12);
    --card-bg: rgba(20, 20, 20, 0.26);
  }
  
  /* --- Globale Styling & Centering --- */
  body {
    margin: 0;
    background: var(--bg);
    color: var(--fg);
    min-height: 100vh;
    max-height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    padding: 10px;
  }
  
  /* --- #weerre container --- */
  #weerre {
    position: relative;
    color: white;
    background-color: var(--card-bg);
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    
    /* Responsive sizing */
    width: min(95%, 1200px);
    height: min(95vh, 800px);
    max-height: 95vh;
    
    display: grid;
    grid-template-rows: auto 1fr auto;
    grid-template-columns: 1fr;
    gap: 10px;
    border: 2px solid var(--border);
    border-radius: 18px;
    box-shadow: 0 0 40px rgba(64,128,255,0.25), inset 0 0 30px rgba(255,255,255,0.05);
    backdrop-filter: blur(6px) saturate(120%);
    overflow: hidden;
    padding: 15px;
  }
  
  /* Top section with title and genre selector */
  #weerre > table {
    width: 100%;
    height: auto;
    border-spacing: 0;
    table-layout: fixed;
  }
  
  #weerre > table tr {
    display: flex;
    flex-wrap: wrap;
  }
  
  #weerre > table td {
    padding: 5px;
    vertical-align: top;
    box-sizing: border-box;
  }
  
  #weerre > table td[style*="width:70%"],
  #weerre > table td:first-child {
    flex: 7;
    min-width: 300px;
  }
  
  #weerre > table td[style*="width:50%"],
  #weerre > table td:last-child {
    flex: 5;
    min-width: 250px;
  }
  
  /* Title section */
  #weerre > table td:first-child > div {
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
  }
  
  #weerre > table td:first-child > div > div:first-child {
    font-size: clamp(1.5rem, 4vw, 3rem);
    color: transparent;
    margin-bottom: 5px;
  }
  
  #weerre > table td:first-child > div > div:nth-child(2) {
    font-size: clamp(1.8rem, 5vw, 3.5rem);
    line-height: 1.2;
  }
  
  #weerre > table td:first-child > div > div:nth-child(2) span {
    font-size: clamp(0.5rem, 1.5vw, 1rem);
    vertical-align: middle;
  }
  
  /* Genre selector section */
  #containerg {
    background: rgba(255, 255, 255, 0.05);

	background-size:100% 100%;
    padding: 15px;
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: 100%;

    overflow-y: auto;
  }
  
  #containerg h1 {
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    margin-bottom: 10px;
  }
  
  .controlsg {
    display: flex;
    gap: 8px;
    margin-bottom: 10px;
  }
  
  .icon-btn {
    padding: 6px 12px;
    border: 1px solid rgba(128, 128, 255, 0.5);
    border-radius: 6px;
    background: transparent;
    color: var(--fg);
    cursor: pointer;
    font-size: clamp(0.9rem, 2vw, 1rem);
  }
  
  .select-wrapper {
    position: relative;
    margin-bottom: 10px;
  }
  
  .dropdown-toggle {
    width: 100%;
    padding: 10px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.3);
    color: var(--fg);
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-size: clamp(0.9rem, 2vw, 1rem);
  }
  
  .genre-options {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: rgba(20, 20, 30, 0.95);
	color:white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    padding: 10px;

    overflow-y: auto;
    z-index: 1000;
  }
  
  .counter {
    text-align: center;
    font-size: clamp(0.8rem, 1.8vw, 0.95rem);
    padding: 8px;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.05);
  }
  
  /* Log section */
  fieldset[data-affect="love"] {
    background-color: transparent;
    border: none;
    margin: 5px 0;
    padding: 5px;
  }
  
  #aa {
    text-decoration: none;
    color: white;
  }
  
  #enil {
    color: white;
    font-size: clamp(1.5rem, 4vw, 2.5rem);
  }
  
  #log {
    color: white;
    width: 100%;
    height: 60px;
    background-color: transparent;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 8px;
    font-family: inherit;
    font-size: clamp(0.8rem, 1.8vw, 0.95rem);
    resize: none;
    box-sizing: border-box;
  }
  
  /* Copyright section */
  fieldset[data-affect="energy"] {
    text-align: right;
    border: none;
    background-color: transparent;
    width: 100%;
    margin: 5px 0;
    padding: 5px;
  }
  
  fieldset[data-affect="energy"] legend {
    width: 100%;
  }
  
  fieldset[data-affect="energy"] legend > div {
    font-size: clamp(0.7rem, 1.5vw, 0.9rem);
    margin-right: 10px;
    line-height: 1.3;
  }
  
  /* Audio controls */
  #audioState {
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    border: medium;
    background-color: transparent;
    color: rgb(255, 255, 255);
    padding: 8px 12px;
    border-radius: 6px;
    min-height: 44px;
    display: flex;
    align-items: center;
  }
  
  /* Playback controls */
  fieldset[data-affect="flow"] {
    border: none;
    width: 100%;
    background-color: transparent;
    margin-top: auto;
    padding: 5px;
  }
  
  fieldset[data-affect="flow"] > div {
    position: relative;
    width: 100%;
    text-align: center;
  }
  
  /* Playback buttons */
  #playBtn,
  #stopBtn,
  #pauseBtn {
    padding: clamp(8px, 1.5vw, 12px) clamp(12px, 2.5vw, 16px);
    border: none;
    border-radius: 8px;
    background: rgba(64, 128, 255, 0.2);
    color: var(--fg);
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    cursor: pointer;
    margin: 0 5px;
    min-height: 44px;
    min-width: 44px;
  }
  
  #stopBtn {
    background: rgba(255, 64, 64, 0.2);
  }
  
  #playBtn:hover,
  #stopBtn:hover,
  #pauseBtn:hover {
    background: var(--primary);
  }
  
  #stopBtn:hover {
    background: rgba(255, 64, 64, 0.4);
  }
  
  /* Status displays */
  #playbackStats,
  #tempoDisplay {
    display: inline-block;
    margin: 0 10px;
    padding: 8px 12px;
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    font-size: clamp(0.8rem, 1.8vw, 0.95rem);
    min-height: 44px;
    display: none;
    vertical-align: middle;
  }
  
  /* Progress bar */
  .progress-container {
    width: 100%;
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    overflow: hidden;
    margin: 10px 0;
  }
  
  .progress-bar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #49ffa8, #38a1ff);
    transition: width 0.2s linear;
  }
  
  /* Canvas */
  canvas#eld {
    display: none;
  }
  
  canvas#bgCanvas {
    display: none;
  }
  
  /* Hidden iframe */
  iframe[src^="data:text/html"] {
    position: fixed;
    top: -1%;
    left: -1%;
    height: 102%;
    width: 102%;
    border: none;
    pointer-events: none;
    z-index: -1;
  }
  
  /* Control rows */
  .control-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 5px;
    align-items: center;
    justify-content: flex-end;
  }
  
  /* --- MEDIA QUERY for small screens --- */
  @media (max-width: 768px) {
    #weerre {
      width: 98%;
      height: 98vh;
      padding: 10px;
    }
    
    #weerre > table tr {
      flex-direction: column;
    }
    
    #weerre > table td {
      width: 100% !important;
      min-width: 100%;
    }
    
    #containerg {
     height: 100%;
    }
    
    .control-row {
      justify-content: center;
    }
    
    #initAudioBtn,
    .status-bar,
    .tempo-display {
      width: 100%;
      text-align: center;
      margin-top: 5px;
    }
    
    #playBtn,
    #stopBtn,
    #pauseBtn {
      flex: 1;
      min-width: 80px;
    }
  }
  
  @media (max-width: 480px) {
    #weerre {
      padding: 8px;
      border-radius: 12px;
    }
    
    #weerre > table td:first-child > div > div:first-child {
      font-size: 1.2rem;
    }
    
    #weerre > table td:first-child > div > div:nth-child(2) {
      font-size: 1.4rem;
    }
    
    #containerg h1 {
      font-size: 1rem;
    }
    
    .controlsg {
      justify-content: center;
    }
    
    .icon-btn {
      padding: 5px 10px;
      font-size: 0.9rem;
    }
    
    #playBtn,
    #stopBtn,
    #pauseBtn {
      font-size: 1.2rem;
      padding: 8px;
      min-width: 70px;
    }
    
    #audioState {
      font-size: 1rem;
      padding: 6px 10px;
    }
  }
  
  /* Very small screens */
  @media (max-height: 600px) {
    #weerre {
      height: 96vh;
    }
    
    #log {
      height: 40px;
    }
    
    #containerg {
      height: 100%;
    }
  }
 
  
</style>

<style>
    #scrl {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #050505;
        height: 100vh;
        font-family: 'Courier New', Courier, monospace;
    }

    .ticker-container {
        position: fixed;
        width: 100%;
        white-space: nowrap;
        overflow: hidden;
        background: rgba(20, 0, 0, 0.2);

;
        display: flex;
        align-items: center;
    }

    .top { top: 1%; height: 60px; }
    .bottom { bottom: 4%; height: 60px; }

    .ticker-content {
        display: inline-block;
        will-change: transform;
        backface-visibility: hidden;
    }

    .ticker-item {
        display: inline-block;
        font-size: 2.3rem;
        font-weight: bold;
        color: #212121;
        text-transform: uppercase;
        padding: 0 5px;
    }

    .bottom .ticker-item {
        color: #232323;
        font-size: 2.0rem;
    }

    .ticker-separator {
        display: inline-block;
        color: #550000;
        font-size: 1.5rem;
        padding: 0 4px;
        opacity: 0.5;
display:none;
    }

    .overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
        background-size: 100% 4px;
        z-index: 10;
        pointer-events: none;
    }
</style>

	<script>
	
	
	   const SF2_BASE64_DATA = ""; 

	
const top256Genres = [
  "Classical", "Jazz", "Blues", "Rock", "Metal", "Pop", "Hip Hop", "R&B", "Soul", "Funk", "Disco", "Reggae", "Country", "Electronic", "Folk", "Punk", "Indie", "Alternative",
  "Ambient", "Techno", "House",  "Dubstep", "Drum and Bass", "Trap", "Lo-fi", "Synth-pop", "Electropop", "New Wave", "Post-punk", "Grunge", "Emo", 
  "Progressive Rock", "Psychedelic Rock", "Hard Rock", "Heavy Metal", "Death Metal", "Black Metal", "Thrash Metal", "Power Metal", "Gothic Metal", "Industrial", "Hardcore",
  "Ska", "Reggaeton", "Salsa", "Bachata", "Merengue", "Cumbia", "Tango", "Bossa Nova", "Samba", "Afrobeat", "Highlife", "K-pop", "J-pop", "C-pop", "Mandopop",
  "Cantopop", "Britpop", "Europop", "Schlager", "Chanson", "Fado", "Bluegrass", "Zydeco", "Cajun", "Gospel", "Spirituals", "Hymns", "New Age", "World", "Latin",
  "Celtic", "Klezmer", "Gregorian", "Opera", "Orchestral", "Film Score", "Video Game", "Musical Theatre", "Broadway", "Easy Listening", "Lounge", "Chill-out", "Downtempo",
  "Trip Hop", "Breakbeat", "Big Beat", "Acid Jazz", "Nu Jazz", "Smooth Jazz", "Bebop", "Swing", "Ragtime", "Boogie-woogie", "Dixieland", "Barbershop", "A Cappella",
  "Instrumental", "Acoustic", "Experimental", "Noise", "Drone", "Glitch", "Plunderphonics", "Vaporwave", "Synthwave", "Future Funk", "Hyperpop", "Cloud Rap", "Mumble Rap",
  "Gangsta Rap", "Conscious Hip Hop", "Jazz Rap", "Boom Bap", "G-funk", "Crunk", "Trap Metal", "Pop Punk", "Hardcore Punk", "Post-hardcore", "Pop Rock", "Soft Rock",
  "Classic Rock", "Southern Rock", "Heartland Rock", "Arena Rock", "Surf Rock", "Rockabilly", "Psychobilly", "Gothabilly", "Stoner Rock", "Desert Rock", "Post-rock",
  "Math Rock", "Slowcore", "Sadcore", "Screamo", "Metalcore", "Deathcore", "Grindcore", "Powerviolence", "Crust Punk", "Anarcho-punk", "Oi!", "Ska Punk", "Pop Country",
  "Outlaw Country", "Alt-country", "Americana", "Bluegrass", "Honky-tonk", "Western Swing", "Tejano", "Norteño", "Banda", "Mariachi", "Ranchera", "Corrido", "Nueva Canción",
  "Bolero", "Rumba", "Son", "Cha-cha-chá", "Mambo", "Salsa Romántica", "Timba", "Merengue Urbano", "Bachata Moderna", "Reggaeton", "Dembow", "Dancehall", "Dub", "Lovers Rock",
  "Roots Reggae", "Ska", "Rocksteady", "Dub Poetry", "Ragga", "Dance-pop", "Teen Pop", "Bubblegum Pop", "Power Pop",  "Indie Pop", "Dream Pop", "Twee Pop",
  "Chamber Pop", "Sophisti-pop", "New Romantic", "Synth-pop", "Electroclash",  "Eurodisco", "Hi-NRG", "Italo Dance", "Eurobeat", "Hands Up", "Happy Hardcore",
    "Jumpstyle", "Frenchcore", "Speedcore", "Breakcore", "Jungle", "Drumfunk", "Liquid Funk", "Neurofunk", "Ambient House", "Deep House", "Tech House",
  "French House", "Italo House", "Acid House", "Chicago House", "Garage House", "2-step", "Future Garage", "Bassline", "Grime", "Dubstep",
  "Brostep", "Riddim", "Future Bass", "Tropical House", "Melodic House", "Afro House", "Amapiano", "Gqom", "Kuduro", "Benga", "Highlife", "Afrobeat", "Afro-pop", "Rai",
  "Gnawa", "Mbalax", "Soukous", "Zouk", "Kizomba", "Bachata", "Vallenato", "Forró", "Axé", "Frevo", "Pagode", "MPB", "Tropicália", "Fado", "Sevdah", "Manele",
  "Chalga", "Rebetiko", "Laïkó", "Tarantella",  "Schlager", "Volksmusik", "Yodeling", "Folk Metal", "Viking Metal", "Pirate Metal", "Symphonic Metal", "Neoclassical Metal",
  "Nu Metal", "Alternative Metal", "Rap Metal", "Funk Metal", "Glam Metal", "Hair Metal", "Doom Metal", "Sludge Metal", "Stoner Metal", "Drone Metal", "Avant-garde Metal",
  "Progressive Metal", "Djent", "Mathcore", "Nintendocore", "Kawaii Metal", "Visual Kei", "J-rock", "J-metal", "City Pop", "Shibuya-kei", "Anime Song", "Enka", "Kayōkyoku",
  "Trot", "Pansori", "Gugak", "K-pop", "K-hip Hop", "K-rock", "K-indie", "Canto-pop", "Mando-pop", "Taiwanese Pop", "Hong Kong English Pop", "Chinese Rock", "Chinese Hip Hop",
  "Bollywood", "Filmi", "Carnatic", "Hindustani", "Qawwali", "Bhangra", "Dangdut", "Keroncong", "Gamelan", "Luk Thung", "Mor Lam", "Pinoy Pop", "Pinoy Rock", "Original Pilipino",
  "V-pop", "Arabesque", "Arabic Pop", "Khaleeji", "Turbo-folk", "Chalga", "Manele", "Tallava", "Sevdah", "Rebetiko", "Fado",  "Tango", "Milonga", "Candombe", "Murga"
];










var GENRES = [
    {
        name: 'Ambient',
        scale: 'dorian',
        root: 'D',
        bpm: 80,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 88, bass: 35, chords: 92 },
        leadOptions: [88, 89, 92, 94, 73, 5, 90, 91, 95, 102, 99, 52, 53, 54, 96],
        bassOptions: [35, 32, 43, 36, 37, 38, 39, 87, 48, 49, 34, 33, 45, 46],
        chordsOptions: [92, 88, 48, 51, 5, 89, 90, 94, 95, 52, 53, 102, 99, 96, 97]
    },
    {
        name: 'Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 128,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 62 },
        leadOptions: [81, 80, 86, 62, 90, 87, 84, 85, 95, 102, 103, 82, 83, 104, 105],
        bassOptions: [39, 38, 87, 36, 37, 35, 81, 86, 85, 84, 83, 82, 104, 105],
        chordsOptions: [62, 90, 80, 18, 19, 17, 81, 87, 95, 102, 103, 104, 105, 106, 107]
    },
    {
        name: 'House',
        scale: 'major',
        root: 'G',
        bpm: 124,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '707' }
        },
        wave: 'triangle',
        instruments: { lead: 80, bass: 33, chords: 17 },
        leadOptions: [80, 4, 86, 81, 62, 5, 87, 90, 88, 89, 95, 82, 83, 84, 85],
        bassOptions: [33, 35, 38, 32, 34, 36, 37, 39, 87, 86, 85, 84, 83, 82],
        chordsOptions: [4, 5, 17, 90, 62, 16, 18, 19, 88, 89, 92, 93, 94, 95, 96]
    },
    {
        name: 'Trance',
        scale: 'major',
        root: 'D',
        bpm: 138,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [2, 3] },
            chords: { oct: [4, 5] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 86, bass: 39, chords: 95 },
        leadOptions: [86, 81, 95, 84, 90, 87, 85, 82, 83, 102, 103, 104, 105, 106, 107],
        bassOptions: [39, 38, 87, 36, 37, 81, 86, 85, 84, 83, 82, 104, 105, 106],
        chordsOptions: [95, 90, 94, 88, 89, 91, 92, 102, 103, 99, 100, 101, 104, 105, 106]
    },
    {
        name: 'Drum&Bass',
        scale: 'minor',
        root: 'B',
        bpm: 170,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'amen' }
        },
        wave: 'sine',
        instruments: { lead: 62, bass: 87, chords: 50 },
        leadOptions: [62, 39, 87, 81, 50, 51, 86, 85, 84, 102, 103, 104, 105, 106, 107],
        bassOptions: [87, 39, 38, 36, 37, 35, 81, 86, 85, 84, 83, 82, 104, 105, 106],
        chordsOptions: [50, 51, 90, 91, 92, 93, 94, 95, 102, 103, 104, 105, 106, 107, 108]
    },
    {
        name: 'Dubstep',
        scale: 'phrygian',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 39, chords: 118 },
        leadOptions: [87, 81, 62, 118, 86, 85, 84, 83, 102, 103, 104, 105, 106, 107],
        bassOptions: [39, 38, 87, 36, 37, 81, 86, 85, 84, 83, 82, 104, 105, 106],
        chordsOptions: [118, 87, 62, 97, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111]
    },
    {
        name: 'Pop',
        scale: 'major',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sine',
        instruments: { lead: 5, bass: 33, chords: 25 },
        leadOptions: [5, 4, 73, 27, 48, 49, 52, 53, 1, 2, 6, 7, 8, 9, 10],
        bassOptions: [33, 34, 38, 32, 35, 36, 37, 39, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 27, 5, 4, 1, 0, 2, 6, 7, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Rock',
        scale: 'minor',
        root: 'E',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 34, 18, 66, 67, 27, 28, 31, 25, 26, 32, 33, 35, 36],
        bassOptions: [34, 33, 35, 32, 36, 37, 38, 39, 43, 44, 45, 46, 47, 48],
        chordsOptions: [30, 29, 18, 17, 19, 27, 28, 25, 26, 16, 20, 21, 22, 23, 24]
    },
    {
        name: 'Metal',
        scale: 'phrygian',
        root: 'E',
        bpm: 150,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 34, 61, 87, 86, 85, 84, 83, 82, 81, 80, 79, 78],
        bassOptions: [34, 39, 33, 32, 36, 37, 38, 35, 43, 44, 45, 46, 47, 48],
        chordsOptions: [30, 29, 18, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71]
    },
    {
        name: 'Jazz',
        scale: 'dorian',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 65, bass: 32, chords: 26 },
        leadOptions: [65, 66, 56, 4, 11, 12, 13, 64, 67, 71, 73, 74, 75, 76, 77],
        bassOptions: [32, 35, 43, 33, 34, 36, 37, 38, 39, 40, 41, 42, 44, 45],
        chordsOptions: [26, 4, 16, 5, 0, 1, 2, 6, 7, 17, 18, 19, 20, 21, 22]
    },
    {
        name: 'Blues',
        scale: 'pentatonic',
        root: 'A',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'blues' }
        },
        wave: 'triangle',
        instruments: { lead: 66, bass: 33, chords: 17 },
        leadOptions: [66, 27, 30, 22, 17, 16, 18, 19, 20, 21, 23, 24, 25, 26],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45],
        chordsOptions: [17, 16, 4, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Funk',
        scale: 'dorian',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'funk' }
        },
        wave: 'triangle',
        instruments: { lead: 27, bass: 36, chords: 4 },
        leadOptions: [27, 36, 4, 65, 34, 35, 37, 38, 39, 40, 41, 42, 43, 44],
        bassOptions: [36, 37, 33, 34, 35, 38, 39, 40, 41, 42, 43, 44, 45, 46],
        chordsOptions: [4, 5, 27, 7, 6, 8, 9, 10, 11, 12, 13, 14, 15, 16]
    },
    {
        name: 'Reggae',
        scale: 'major',
        root: 'C',
        bpm: 74,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'reggae' }
        },
        wave: 'sine',
        instruments: { lead: 22, bass: 33, chords: 17 },
        leadOptions: [22, 35, 25, 66, 17, 16, 18, 19, 20, 21, 23, 24, 26, 27],
        bassOptions: [33, 35, 39, 32, 34, 36, 37, 38, 40, 41, 42, 43, 44, 45],
        chordsOptions: [17, 24, 25, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14]
    },
    {
        name: 'Afrobeats',
        scale: 'major',
        root: 'F',
        bpm: 108,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 75, bass: 39, chords: 24 },
        leadOptions: [75, 73, 113, 24, 108, 109, 110, 111, 112, 114, 115, 116, 117, 118],
        bassOptions: [39, 32, 33, 34, 35, 36, 37, 38, 40, 41, 42, 43, 44, 45],
        chordsOptions: [24, 25, 4, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124]
    },
    {
        name: 'Salsa',
        scale: 'major',
        root: 'C',
        bpm: 180,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'triangle',
        instruments: { lead: 56, bass: 33, chords: 0 },
        leadOptions: [56, 21, 114, 73, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
        bassOptions: [33, 32, 35, 34, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45],
        chordsOptions: [0, 4, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32]
    },
    {
        name: 'Klezmer',
        scale: 'phrygian',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 40 },
        leadOptions: [21, 40, 71, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120],
        bassOptions: [32, 58, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
        chordsOptions: [40, 48, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32]
    },
    {
        name: 'Indian Raga',
        scale: 'phrygian',
        root: 'C',
        bpm: 96,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 104, bass: 105, chords: 107 },
        leadOptions: [104, 107, 77, 106, 105, 108, 109, 110, 111, 112, 113, 114, 115, 116],
        bassOptions: [105, 43, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 44],
        chordsOptions: [107, 104, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99]
    },
    {
        name: 'Middle Eastern',
        scale: 'phrygian',
        root: 'D',
        bpm: 112,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'daf' }
        },
        wave: 'triangle',
        instruments: { lead: 111, bass: 32, chords: 106 },
        leadOptions: [111, 106, 104, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85],
        bassOptions: [32, 43, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45, 46, 47],
        chordsOptions: [106, 104, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59]
    },
    {
        name: 'Lo-Fi',
        scale: 'minor',
        root: 'G',
        bpm: 72,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'lofi' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 33, chords: 89 },
        leadOptions: [4, 5, 89, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83],
        bassOptions: [33, 32, 39, 34, 35, 36, 37, 38, 40, 41, 42, 43, 44, 45],
        chordsOptions: [89, 4, 5, 1, 2, 3, 6, 7, 8, 9, 10, 11, 12, 13]
    },
    {
        name: 'Experimental',
        scale: 'chromatic',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'glitch' }
        },
        wave: 'square',
        instruments: { lead: 85, bass: 39, chords: 97 },
        leadOptions: [85, 97, 102, 118, 99, 100, 101, 103, 104, 105, 106, 107, 108, 109],
        bassOptions: [39, 38, 87, 86, 85, 84, 83, 82, 81, 80, 79, 78, 77, 76],
        chordsOptions: [97, 102, 99, 90, 91, 92, 93, 94, 95, 96, 98, 100, 101, 103]
    },
    {
        name: 'Chiptune',
        scale: 'major',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [2, 3] },
            chords: { oct: [4] },
            drums: { kit: 'chips' }
        },
        wave: 'square',
        instruments: { lead: 80, bass: 81, chords: 90 },
        leadOptions: [80, 81, 86, 82, 83, 84, 85, 87, 88, 89, 90, 91, 92, 93],
        bassOptions: [81, 38, 39, 80, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91],
        chordsOptions: [90, 80, 81, 88, 89, 91, 92, 93, 94, 95, 96, 97, 98, 99]
    },
    {
        name: 'Ribab (Rwira)',
        scale: 'pentatonic',
        root: 'A',
        bpm: 105,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'daf' }
        },
        wave: 'triangle',
        instruments: { lead: 110, bass: 35, chords: 25 },
        leadOptions: [110, 105, 104, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35],
        bassOptions: [35, 32, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
        chordsOptions: [25, 24, 73, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117]
    },
    {
        name: 'Rai',
        scale: 'phrygian',
        root: 'D',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'afro' }
        },
        wave: 'sawtooth',
        instruments: { lead: 66, bass: 33, chords: 21 },
        leadOptions: [66, 75, 21, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121],
        bassOptions: [33, 34, 36, 35, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46],
        chordsOptions: [21, 24, 17, 18, 19, 20, 22, 23, 25, 26, 27, 28, 29, 30]
    },
    {
        name: 'Chinese Classical',
        scale: 'pentatonic',
        root: 'G',
        bpm: 72,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [3, 4] },
            chords: { oct: [4, 5] },
            drums: { kit: 'chinese' }
        },
        wave: 'sine',
        instruments: { lead: 111, bass: 117, chords: 112 },
        leadOptions: [111, 106, 105, 104, 107, 108, 109, 110, 112, 113, 114, 115, 116, 117],
        bassOptions: [117, 107, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43],
        chordsOptions: [112, 107, 106, 105, 104, 108, 109, 110, 111, 113, 114, 115, 116, 117]
    },
    {
        name: 'Chinese Traditional',
        scale: 'pentatonic',
        root: 'C',
        bpm: 88,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'chinese_traditional' }
        },
        wave: 'triangle',
        instruments: { lead: 106, bass: 32, chords: 107 },
        leadOptions: [106, 105, 111, 104, 107, 108, 109, 110, 112, 113, 114, 115, 116, 117],
        bassOptions: [32, 117, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54],
        chordsOptions: [107, 112, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35]
    },
    {
        name: 'Oriental',
        scale: 'phrygian',
        root: 'E',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 111, bass: 43, chords: 104 },
        leadOptions: [111, 104, 106, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85],
        bassOptions: [43, 32, 35, 36, 37, 38, 39, 40, 41, 42, 44, 45, 46, 47],
        chordsOptions: [104, 106, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59]
    },
    {
        name: 'Bluegrass',
        scale: 'major',
        root: 'G',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'folk' }
        },
        wave: 'triangle',
        instruments: { lead: 105, bass: 32, chords: 110 },
        leadOptions: [105, 110, 25, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
        bassOptions: [32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45],
        chordsOptions: [110, 105, 25, 24, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35]
    },
    {
        name: 'Cinematic',
        scale: 'minor',
        root: 'A',
        bpm: 96,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'orchestral' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 43, chords: 48 },
        leadOptions: [40, 44, 46, 56, 52, 97, 41, 42, 45, 47, 48, 49, 50, 51],
        bassOptions: [43, 32, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
        chordsOptions: [48, 49, 55, 14, 52, 53, 54, 56, 57, 58, 59, 60, 61, 62]
    },
    {
        name: 'Synthwave',
        scale: 'minor',
        root: 'F',
        bpm: 110,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'electro' }
        },
        wave: 'sawtooth',
        instruments: { lead: 86, bass: 38, chords: 90 },
        leadOptions: [86, 81, 80, 62, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104],
        bassOptions: [38, 39, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92],
        chordsOptions: [90, 88, 89, 4, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72]
    },
    {
        name: 'Trap',
        scale: 'minor',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'triangle',
        instruments: { lead: 81, bass: 87, chords: 88 },
        leadOptions: [81, 80, 87, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82, 81, 80, 79, 78, 77, 76],
        chordsOptions: [88, 90, 81, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72]
    },
	{
        name: 'Samba',
        scale: 'major',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2, 3] },
            chords: { oct: [4, 5] },
            drums: { kit: 'samba' }
        },
        wave: 'triangle',
        instruments: { lead: 73, bass: 32, chords: 24 },
        leadOptions: [73, 72, 74, 75, 65, 66, 56, 57, 21, 22, 114, 115],
        bassOptions: [32, 33, 34, 35, 36, 43, 44, 45],
        chordsOptions: [24, 25, 26, 16, 17, 18, 19, 20, 21, 22, 23]
    },
    {
        name: 'Tango',
        scale: 'harmonic minor',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'tango' }
        },
        wave: 'sawtooth',
        instruments: { lead: 21, bass: 43, chords: 0 },
        leadOptions: [21, 23, 40, 41, 42, 68, 69, 71, 110, 111],
        bassOptions: [43, 32, 33, 34, 35, 36, 5, 6],
        chordsOptions: [0, 2, 6, 7, 16, 17, 18, 19, 20, 21, 22]
    },
    {
        name: 'Flamenco',
        scale: 'phrygian',
        root: 'E',
        bpm: 132,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'flamenco' }
        },
        wave: 'triangle',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 26, 105, 106, 107, 40, 41, 73, 74],
        bassOptions: [32, 33, 35, 36, 43, 105, 106],
        chordsOptions: [24, 25, 26, 105, 106, 107, 16, 17, 18, 19, 20]
    },
    {
        name: 'Highlife',
        scale: 'major',
        root: 'F',
        bpm: 128,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'highlife' }
        },
        wave: 'sine',
        instruments: { lead: 27, bass: 36, chords: 17 },
        leadOptions: [27, 65, 66, 56, 57, 73, 74, 75, 113, 114],
        bassOptions: [36, 37, 33, 34, 35, 38, 39],
        chordsOptions: [17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
    },
    {
        name: 'Soukous',
        scale: 'major',
        root: 'G',
        bpm: 122,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soukous' }
        },
        wave: 'triangle',
        instruments: { lead: 26, bass: 36, chords: 17 },
        leadOptions: [26, 27, 65, 66, 56, 73, 74, 113, 114, 115],
        bassOptions: [36, 37, 33, 34, 35, 38, 39],
        chordsOptions: [17, 18, 19, 20, 21, 22, 23, 24, 25, 26]
    },
    {
        name: 'Bhangra',
        scale: 'mixolydian',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'bhangra' }
        },
        wave: 'sawtooth',
        instruments: { lead: 104, bass: 38, chords: 52 },
        leadOptions: [104, 105, 106, 111, 77, 78, 16, 17, 18, 53],
        bassOptions: [38, 39, 33, 34, 35, 36, 37],
        chordsOptions: [52, 53, 16, 17, 18, 19, 20, 21, 22, 23, 24]
    },
    {
        name: 'Balkan Brass',
        scale: 'minor',
        root: 'G',
        bpm: 180,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'balkan' }
        },
        wave: 'square',
        instruments: { lead: 56, bass: 58, chords: 61 },
        leadOptions: [56, 57, 59, 60, 61, 62, 63, 64, 65, 66],
        bassOptions: [58, 43, 44, 45, 46, 47, 48, 34],
        chordsOptions: [61, 62, 63, 48, 49, 50, 51, 52, 53, 54, 55]
    },
    {
        name: 'Zydeco',
        scale: 'mixolydian',
        root: 'A',
        bpm: 132,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'zydeco' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 17 },
        leadOptions: [21, 22, 110, 105, 66, 67, 16, 17, 18],
        bassOptions: [32, 33, 34, 35, 36, 37, 38, 39],
        chordsOptions: [17, 16, 18, 19, 20, 21, 22, 23, 24, 25, 26]
    },
    {
        name: 'Cumbia',
        scale: 'minor',
        root: 'A',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'cumbia' }
        },
        wave: 'sine',
        instruments: { lead: 65, bass: 33, chords: 23 },
        leadOptions: [65, 66, 64, 56, 57, 21, 22, 23, 114, 115],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [23, 21, 22, 16, 17, 18, 19, 20, 24, 25, 26]
    },
    {
        name: 'Mariachi',
        scale: 'major',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'mariachi' }
        },
        wave: 'sawtooth',
        instruments: { lead: 56, bass: 43, chords: 25 },
        leadOptions: [56, 57, 59, 60, 65, 66, 64, 21, 22, 23],
        bassOptions: [43, 32, 33, 34, 35, 36, 5, 6],
        chordsOptions: [25, 26, 27, 16, 17, 18, 19, 20, 21, 22, 23]
    },
    {
        name: 'Polka',
        scale: 'major',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'polka' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 43, chords: 17 },
        leadOptions: [21, 22, 23, 65, 66, 64, 72, 73, 74, 13],
        bassOptions: [43, 32, 33, 34, 35, 36, 5, 6],
        chordsOptions: [17, 16, 18, 19, 20, 21, 22, 23, 24, 25, 26]
    },
    {
        name: 'Gospel',
        scale: 'major',
        root: 'Eb',
        bpm: 90,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'gospel' }
        },
        wave: 'sine',
        instruments: { lead: 53, bass: 33, chords: 1 },
        leadOptions: [53, 52, 54, 5, 4, 16, 17, 18, 19, 48],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [1, 0, 2, 16, 17, 18, 19, 20, 21, 48, 49]
    },
    {
        name: 'Ska',
        scale: 'major',
        root: 'G',
        bpm: 180,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'ska' }
        },
        wave: 'square',
        instruments: { lead: 57, bass: 34, chords: 17 },
        leadOptions: [57, 56, 59, 60, 65, 66, 27, 28, 29, 30],
        bassOptions: [34, 33, 35, 32, 36, 37, 38, 39],
        chordsOptions: [17, 16, 18, 19, 27, 28, 29, 30, 25, 26, 24]
    },
    {
        name: 'Soca',
        scale: 'major',
        root: 'C',
        bpm: 115,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soca' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 17 },
        leadOptions: [81, 80, 82, 83, 84, 85, 55, 56, 57, 114],
        bassOptions: [39, 38, 87, 36, 37, 35, 81, 86],
        chordsOptions: [17, 18, 19, 80, 81, 82, 83, 84, 85, 55, 56]
    },
    {
        name: 'Juju',
        scale: 'major',
        root: 'F',
        bpm: 108,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'juju' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 16 },
        leadOptions: [24, 25, 26, 108, 109, 73, 74, 75, 113, 114],
        bassOptions: [32, 33, 34, 35, 36, 37, 38, 39],
        chordsOptions: [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26]
    },
    {
        name: 'Mbalax',
        scale: 'mixolydian',
        root: 'D',
        bpm: 125,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'mbalax' }
        },
        wave: 'triangle',
        instruments: { lead: 66, bass: 36, chords: 17 },
        leadOptions: [66, 65, 67, 56, 57, 73, 74, 111, 112, 113],
        bassOptions: [36, 37, 33, 34, 35, 38, 39],
        chordsOptions: [17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27]
    },
    {
        name: 'Bossa Nova',
        scale: 'major',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'bossa' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 32, chords: 24 },
        leadOptions: [73, 24, 65, 75, 74, 76, 77, 78, 79, 21],
        bassOptions: [32, 35, 24, 25, 26, 27, 28, 29],
        chordsOptions: [24, 26, 4, 5, 6, 7, 8, 9, 10, 11, 12]
    },
    {
        name: 'Forró',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'forro' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 24 },
        leadOptions: [21, 23, 73, 74, 75, 65, 66, 64, 114, 115],
        bassOptions: [32, 33, 34, 35, 36, 37, 38, 39],
        chordsOptions: [24, 25, 26, 16, 17, 18, 19, 20, 21, 22, 23]
    },
    {
        name: 'Calypso',
        scale: 'major',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'calypso' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 33, chords: 24 },
        leadOptions: [114, 113, 115, 75, 76, 77, 21, 22, 23, 73],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [24, 25, 26, 16, 17, 18, 19, 20, 21, 22, 23]
    },
    {
        name: 'Gagaku',
        scale: 'pentatonic',
        root: 'D',
        bpm: 60,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [3, 4] },
            chords: { oct: [4, 5] },
            drums: { kit: 'gagaku' }
        },
        wave: 'sine',
        instruments: { lead: 77, bass: 43, chords: 107 },
        leadOptions: [77, 78, 79, 106, 107, 108, 73, 74, 75, 76],
        bassOptions: [43, 32, 33, 34, 35, 36, 37, 38],
        chordsOptions: [107, 106, 77, 78, 79, 73, 74, 75, 76, 13, 14]
    },
	  {
        name: 'Griot',
        scale: 'pentatonic',
        root: 'F',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'griot' }
        },
        wave: 'sine',
        instruments: { lead: 108, bass: 32, chords: 106 },
        leadOptions: [108, 104, 105, 107, 77, 78, 73, 74, 110, 111],
        bassOptions: [32, 33, 34, 35, 36, 43, 108, 107],
        chordsOptions: [106, 107, 108, 104, 105, 24, 25, 26, 16, 17]
    },
    {
        name: 'Qawwali',
        scale: 'phrygian',
        root: 'C',
        bpm: 85,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'qawwali' }
        },
        wave: 'sine',
        instruments: { lead: 105, bass: 43, chords: 52 },
        leadOptions: [105, 104, 111, 53, 54, 52, 21, 22, 73, 74],
        bassOptions: [43, 32, 33, 34, 35, 36, 105, 104],
        chordsOptions: [52, 53, 54, 105, 104, 16, 17, 18, 19, 20]
    },
    {
        name: 'Fado',
        scale: 'harmonic_minor',
        root: 'D',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'fado' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 40, 41, 42, 68, 69, 71, 73, 74],
        bassOptions: [32, 33, 34, 35, 36, 43, 24, 25],
        chordsOptions: [24, 25, 40, 41, 42, 16, 17, 18, 19, 20]
    },
    {
        name: 'Andean',
        scale: 'pentatonic',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'andean' }
        },
        wave: 'triangle',
        instruments: { lead: 79, bass: 32, chords: 24 },
        leadOptions: [79, 75, 76, 77, 78, 73, 74, 21, 22, 23],
        bassOptions: [32, 33, 34, 35, 36, 43, 79, 75],
        chordsOptions: [24, 25, 79, 75, 76, 16, 17, 18, 19, 20]
    },
    {
        name: 'Gregorian Chant',
        scale: 'dorian',
        root: 'D',
        bpm: 60,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [1, 2] },
            chords: { oct: [2, 3] },
            drums: { kit: 'chant' }
        },
        wave: 'sine',
        instruments: { lead: 52, bass: 43, chords: 52 },
        leadOptions: [52, 53, 54, 19, 20, 91, 92, 48, 49, 50],
        bassOptions: [43, 32, 33, 34, 35, 36, 52, 53],
        chordsOptions: [52, 53, 54, 19, 20, 91, 92, 48, 49, 50]
    },
    {
        name: 'Boogie Woogie',
        scale: 'blues',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'boogie' }
        },
        wave: 'triangle',
        instruments: { lead: 4, bass: 33, chords: 4 },
        leadOptions: [4, 5, 16, 17, 18, 7, 6, 2, 3, 1],
        bassOptions: [33, 34, 35, 36, 37, 4, 5, 16],
        chordsOptions: [4, 5, 16, 17, 18, 7, 6, 2, 3, 1]
    },
    {
        name: 'Motown',
        scale: 'major',
        root: 'Eb',
        bpm: 112,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'motown' }
        },
        wave: 'sine',
        instruments: { lead: 53, bass: 33, chords: 5 },
        leadOptions: [53, 52, 54, 5, 4, 27, 28, 65, 66, 56],
        bassOptions: [33, 34, 35, 36, 37, 53, 52, 5],
        chordsOptions: [5, 4, 53, 52, 54, 27, 28, 65, 66, 16]
    },
    {
        name: 'Disco',
        scale: 'major',
        root: 'F',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 36, chords: 17 },
        leadOptions: [81, 80, 82, 83, 84, 85, 55, 56, 57, 27],
        bassOptions: [36, 37, 33, 34, 35, 81, 80, 17],
        chordsOptions: [17, 16, 81, 80, 82, 55, 56, 57, 27, 28]
    },
    {
        name: 'New Wave',
        scale: 'minor',
        root: 'D',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'newwave' }
        },
        wave: 'square',
        instruments: { lead: 82, bass: 39, chords: 90 },
        leadOptions: [82, 81, 83, 84, 85, 86, 87, 88, 89, 5],
        bassOptions: [39, 38, 37, 36, 35, 82, 81, 90],
        chordsOptions: [90, 88, 89, 82, 81, 83, 84, 85, 86, 87]
    },
    {
        name: 'Grunge',
        scale: 'minor',
        root: 'E',
        bpm: 110,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'grunge' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 31, 27, 28, 25, 26, 17, 18, 19],
        bassOptions: [34, 33, 35, 32, 36, 37, 30, 29],
        chordsOptions: [30, 29, 31, 27, 28, 25, 26, 17, 18, 19]
    },
    {
        name: 'Trip Hop',
        scale: 'minor',
        root: 'G',
        bpm: 90,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'triphop' }
        },
        wave: 'sine',
        instruments: { lead: 91, bass: 39, chords: 89 },
        leadOptions: [91, 90, 92, 93, 94, 95, 54, 53, 52, 102],
        bassOptions: [39, 38, 37, 36, 35, 91, 90, 89],
        chordsOptions: [89, 88, 90, 91, 92, 93, 94, 95, 54, 53]
    },
    {
        name: 'Dub',
        scale: 'minor',
        root: 'C',
        bpm: 85,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'dub' }
        },
        wave: 'sine',
        instruments: { lead: 102, bass: 39, chords: 97 },
        leadOptions: [102, 103, 99, 100, 101, 98, 96, 95, 94, 118],
        bassOptions: [39, 38, 37, 36, 35, 102, 103, 97],
        chordsOptions: [97, 96, 98, 102, 103, 99, 100, 101, 95, 94]
    },
    {
        name: 'Psychedelic Rock',
        scale: 'mixolydian',
        root: 'A',
        bpm: 115,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'psych' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 34, chords: 17 },
        leadOptions: [27, 28, 29, 30, 31, 16, 17, 18, 19, 20],
        bassOptions: [34, 33, 35, 32, 36, 37, 27, 28],
        chordsOptions: [17, 16, 18, 27, 28, 29, 30, 31, 19, 20]
    },
    {
        name: 'Baroque',
        scale: 'major',
        root: 'D',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'baroque' }
        },
        wave: 'sine',
        instruments: { lead: 6, bass: 43, chords: 6 },
        leadOptions: [6, 7, 0, 1, 2, 46, 47, 40, 41, 42],
        bassOptions: [43, 32, 33, 34, 35, 36, 6, 7],
        chordsOptions: [6, 7, 0, 1, 2, 46, 47, 40, 41, 42]
    },
    {
        name: 'Renaissance',
        scale: 'dorian',
        root: 'G',
        bpm: 90,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'renaissance' }
        },
        wave: 'sine',
        instruments: { lead: 74, bass: 43, chords: 46 },
        leadOptions: [74, 73, 75, 76, 77, 6, 7, 46, 47, 13],
        bassOptions: [43, 32, 33, 34, 35, 36, 74, 73],
        chordsOptions: [46, 47, 74, 73, 75, 6, 7, 76, 77, 13]
    },
    {
        name: 'Minimalism',
        scale: 'chromatic',
        root: 'C',
        bpm: 70,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'minimal' }
        },
        wave: 'sine',
        instruments: { lead: 11, bass: 43, chords: 11 },
        leadOptions: [11, 12, 13, 14, 8, 9, 10, 0, 1, 2],
        bassOptions: [43, 32, 33, 34, 35, 36, 11, 12],
        chordsOptions: [11, 12, 13, 14, 8, 9, 10, 0, 1, 2]
    },
    {
        name: 'Post Rock',
        scale: 'minor',
        root: 'F',
        bpm: 95,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'postrock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 92, bass: 34, chords: 92 },
        leadOptions: [92, 93, 94, 95, 48, 49, 50, 51, 40, 41],
        bassOptions: [34, 33, 35, 32, 36, 37, 92, 93],
        chordsOptions: [92, 93, 94, 95, 48, 49, 50, 51, 40, 41]
    },
    {
        name: 'Shoegaze',
        scale: 'major',
        root: 'E',
        bpm: 105,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'shoegaze' }
        },
        wave: 'sawtooth',
        instruments: { lead: 94, bass: 34, chords: 94 },
        leadOptions: [94, 95, 92, 93, 90, 91, 88, 89, 102, 103],
        bassOptions: [34, 33, 35, 32, 36, 37, 94, 95],
        chordsOptions: [94, 95, 92, 93, 90, 91, 88, 89, 102, 103]
    },
    {
        name: 'Noise',
        scale: 'chromatic',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [3, 4, 5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [2, 3, 4] },
            drums: { kit: 'noise' }
        },
        wave: 'square',
        instruments: { lead: 118, bass: 39, chords: 119 },
        leadOptions: [118, 119, 120, 121, 122, 123, 124, 125, 126, 127],
        bassOptions: [39, 38, 37, 36, 35, 118, 119, 120],
        chordsOptions: [119, 118, 120, 121, 122, 123, 124, 125, 126, 127]
    },
    {
        name: 'Drone',
        scale: 'chromatic',
        root: 'D',
        bpm: 60,
        roles: {
            lead: { oct: [2, 3] },
            bass: { oct: [1, 2] },
            chords: { oct: [2, 3] },
            drums: { kit: 'drone' }
        },
        wave: 'sine',
        instruments: { lead: 93, bass: 43, chords: 93 },
        leadOptions: [93, 94, 95, 92, 91, 90, 89, 88, 48, 49],
        bassOptions: [43, 32, 33, 34, 35, 36, 93, 94],
        chordsOptions: [93, 94, 95, 92, 91, 90, 89, 88, 48, 49]
    },
    {
        name: 'Waltz',
        scale: 'major',
        root: 'C',
        bpm: 180,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'waltz' }
        },
        wave: 'sine',
        instruments: { lead: 48, bass: 43, chords: 0 },
        leadOptions: [48, 49, 0, 1, 2, 40, 41, 42, 46, 47],
        bassOptions: [43, 32, 33, 34, 35, 36, 48, 49],
        chordsOptions: [0, 1, 2, 48, 49, 40, 41, 42, 46, 47]
    },
    {
        name: 'March',
        scale: 'major',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'march' }
        },
        wave: 'square',
        instruments: { lead: 56, bass: 58, chords: 61 },
        leadOptions: [56, 57, 59, 60, 61, 62, 63, 47, 48, 49],
        bassOptions: [58, 43, 44, 45, 46, 47, 56, 57],
        chordsOptions: [61, 62, 63, 56, 57, 59, 60, 47, 48, 49]
    },
    {
        name: 'Sea Shanty',
        scale: 'mixolydian',
        root: 'D',
        bpm: 130,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'shanty' }
        },
        wave: 'sine',
        instruments: { lead: 21, bass: 32, chords: 21 },
        leadOptions: [21, 22, 23, 16, 17, 18, 19, 20, 73, 74],
        bassOptions: [32, 33, 34, 35, 36, 43, 21, 22],
        chordsOptions: [21, 22, 23, 16, 17, 18, 19, 20, 73, 74]
    },
	
    {
        name: 'Swing',
        scale: 'major',
        root: 'Bb',
        bpm: 180,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'swing' }
        },
        wave: 'triangle',
        instruments: { lead: 57, bass: 32, chords: 0 },
        leadOptions: [57, 56, 65, 66, 4, 5, 27, 28, 48, 49],
        bassOptions: [32, 33, 34, 35, 36, 43, 57, 56],
        chordsOptions: [0, 4, 5, 16, 17, 27, 28, 48, 49, 57]
    },
    {
        name: 'Bebop',
        scale: 'chromatic',
        root: 'F',
        bpm: 220,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'bebop' }
        },
        wave: 'sawtooth',
        instruments: { lead: 65, bass: 32, chords: 0 },
        leadOptions: [65, 66, 64, 56, 57, 4, 5, 27, 28, 11],
        bassOptions: [32, 33, 34, 35, 36, 43, 65, 66],
        chordsOptions: [0, 4, 5, 16, 17, 27, 28, 56, 57, 65]
    },
    {
        name: 'Cool Jazz',
        scale: 'dorian',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'cooljazz' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 32, chords: 5 },
        leadOptions: [73, 74, 65, 66, 4, 5, 11, 12, 48, 49],
        bassOptions: [32, 33, 34, 35, 36, 43, 73, 74],
        chordsOptions: [5, 4, 16, 17, 48, 49, 73, 74, 11, 12]
    },
    {
        name: 'Hard Bop',
        scale: 'blues',
        root: 'Eb',
        bpm: 200,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'hardbop' }
        },
        wave: 'sawtooth',
        instruments: { lead: 66, bass: 33, chords: 17 },
        leadOptions: [66, 65, 56, 57, 27, 28, 4, 5, 34, 35],
        bassOptions: [33, 34, 32, 35, 36, 43, 66, 65],
        chordsOptions: [17, 16, 27, 28, 4, 5, 34, 35, 56, 57]
    },
    {
        name: 'Free Jazz',
        scale: 'chromatic',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [3, 4, 5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [2, 3, 4] },
            drums: { kit: 'freejazz' }
        },
        wave: 'square',
        instruments: { lead: 62, bass: 39, chords: 97 },
        leadOptions: [62, 63, 87, 86, 85, 118, 119, 102, 103, 55],
        bassOptions: [39, 38, 37, 36, 35, 62, 63, 87],
        chordsOptions: [97, 102, 103, 62, 63, 87, 86, 118, 119, 55]
    },
    {
        name: 'Modal Jazz',
        scale: 'dorian',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'modaljazz' }
        },
        wave: 'sine',
        instruments: { lead: 71, bass: 32, chords: 5 },
        leadOptions: [71, 65, 66, 73, 74, 4, 5, 11, 12, 48],
        bassOptions: [32, 33, 34, 35, 36, 43, 71, 65],
        chordsOptions: [5, 4, 16, 17, 48, 49, 71, 65, 11, 12]
    },
    {
        name: 'Jazz Fusion',
        scale: 'chromatic',
        root: 'A',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'fusion' }
        },
        wave: 'sawtooth',
        instruments: { lead: 87, bass: 39, chords: 90 },
        leadOptions: [87, 81, 62, 63, 86, 85, 84, 27, 28, 65],
        bassOptions: [39, 38, 37, 36, 35, 87, 81, 62],
        chordsOptions: [90, 88, 89, 87, 81, 62, 63, 27, 28, 65]
    },
    {
        name: 'Smooth Jazz',
        scale: 'major',
        root: 'F',
        bpm: 95,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'smoothjazz' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 33, chords: 5 },
        leadOptions: [66, 65, 73, 74, 4, 5, 27, 28, 48, 49],
        bassOptions: [33, 34, 32, 35, 36, 43, 66, 65],
        chordsOptions: [5, 4, 16, 17, 48, 49, 66, 65, 27, 28]
    },
    {
        name: 'J-Pop',
        scale: 'major',
        root: 'C',
        bpm: 128,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'jpop' }
        },
        wave: 'triangle',
        instruments: { lead: 81, bass: 33, chords: 5 },
        leadOptions: [81, 80, 82, 83, 84, 85, 48, 49, 27, 28],
        bassOptions: [33, 34, 32, 35, 36, 43, 81, 80],
        chordsOptions: [5, 4, 16, 17, 48, 49, 81, 80, 27, 28]
    },
    {
        name: 'K-Pop',
        scale: 'minor',
        root: 'G',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'kpop' }
        },
        wave: 'sawtooth',
        instruments: { lead: 87, bass: 39, chords: 90 },
        leadOptions: [87, 81, 82, 83, 84, 85, 48, 49, 27, 28],
        bassOptions: [39, 38, 37, 36, 35, 87, 81, 82],
        chordsOptions: [90, 88, 89, 87, 81, 82, 48, 49, 27, 28]
    },
    {
        name: 'City Pop',
        scale: 'major',
        root: 'F',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'citypop' }
        },
        wave: 'triangle',
        instruments: { lead: 86, bass: 36, chords: 5 },
        leadOptions: [86, 81, 82, 83, 84, 85, 48, 49, 27, 28],
        bassOptions: [36, 37, 33, 34, 35, 86, 81, 82],
        chordsOptions: [5, 4, 16, 17, 48, 49, 86, 81, 27, 28]
    },
    {
        name: 'Vaporwave',
        scale: 'major',
        root: 'Eb',
        bpm: 85,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'vaporwave' }
        },
        wave: 'sine',
        instruments: { lead: 90, bass: 39, chords: 5 },
        leadOptions: [90, 88, 89, 91, 92, 93, 94, 95, 48, 49],
        bassOptions: [39, 38, 37, 36, 35, 90, 88, 89],
        chordsOptions: [5, 4, 90, 88, 89, 91, 92, 48, 49, 16]
    },
    {
        name: 'Future Bass',
        scale: 'minor',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'futurebass' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Witch House',
        scale: 'minor',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'witchhouse' }
        },
        wave: 'square',
        instruments: { lead: 102, bass: 39, chords: 97 },
        leadOptions: [102, 103, 99, 100, 101, 98, 96, 95, 94, 118],
        bassOptions: [39, 38, 37, 36, 35, 102, 103, 99],
        chordsOptions: [97, 96, 98, 102, 103, 99, 100, 101, 95, 94]
    },
    {
        name: 'Synthpop',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'synthpop' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [39, 38, 37, 36, 35, 81, 80, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Italo Disco',
        scale: 'major',
        root: 'F',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'italo' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [39, 38, 37, 36, 35, 81, 80, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Eurodance',
        scale: 'major',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'eurodance' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [39, 38, 37, 36, 35, 81, 80, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Hardstyle',
        scale: 'minor',
        root: 'A',
        bpm: 150,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'hardstyle' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Gabber',
        scale: 'chromatic',
        root: 'C',
        bpm: 200,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1] },
            chords: { oct: [4] },
            drums: { kit: 'gabber' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Psytrance',
        scale: 'minor',
        root: 'D',
        bpm: 145,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'psytrance' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Goa Trance',
        scale: 'phrygian',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'goa' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Progressive House',
        scale: 'minor',
        root: 'F',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'proghouse' }
        },
        wave: 'sawtooth',
        instruments: { lead: 90, bass: 39, chords: 88 },
        leadOptions: [90, 88, 89, 91, 92, 93, 94, 95, 81, 82],
        bassOptions: [39, 38, 37, 36, 35, 90, 88, 89],
        chordsOptions: [88, 89, 90, 91, 92, 93, 94, 95, 81, 82]
    },
    {
        name: 'Deep House',
        scale: 'minor',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'deephouse' }
        },
        wave: 'sine',
        instruments: { lead: 89, bass: 33, chords: 5 },
        leadOptions: [89, 88, 90, 91, 92, 93, 94, 95, 73, 74],
        bassOptions: [33, 34, 32, 35, 36, 43, 89, 88],
        chordsOptions: [5, 4, 89, 88, 90, 91, 73, 74, 16, 17]
    },
    {
        name: 'UK Garage',
        scale: 'minor',
        root: 'F',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'ukgarage' }
        },
        wave: 'triangle',
        instruments: { lead: 81, bass: 39, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [39, 38, 37, 36, 35, 81, 80, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Footwork',
        scale: 'chromatic',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'footwork' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
    {
        name: 'Jungle',
        scale: 'minor',
        root: 'B',
        bpm: 170,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'jungle' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [87, 39, 38, 86, 85, 84, 83, 82],
        chordsOptions: [90, 88, 89, 81, 80, 82, 83, 84, 85, 86]
    },
	    {
        name: 'Gypsy Jazz',
        scale: 'harmonic_minor',
        root: 'D',
        bpm: 200,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'gypsy' }
        },
        wave: 'triangle',
        instruments: { lead: 25, bass: 32, chords: 25 },
        leadOptions: [25, 26, 21, 22, 40, 41, 65, 66, 73, 74],
        bassOptions: [32, 33, 34, 35, 36, 43, 25, 26],
        chordsOptions: [25, 26, 21, 22, 16, 17, 18, 19, 20, 24]
    },
    {
        name: 'Mambo',
        scale: 'major',
        root: 'C',
        bpm: 200,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'mambo' }
        },
        wave: 'sawtooth',
        instruments: { lead: 56, bass: 33, chords: 17 },
        leadOptions: [56, 57, 65, 66, 21, 22, 114, 115, 73, 74],
        bassOptions: [33, 34, 32, 35, 36, 43, 56, 57],
        chordsOptions: [17, 16, 21, 22, 114, 115, 24, 25, 26, 27]
    },
    {
        name: 'Merengue',
        scale: 'major',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'merengue' }
        },
        wave: 'triangle',
        instruments: { lead: 114, bass: 33, chords: 17 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 56, 57, 65],
        bassOptions: [33, 34, 32, 35, 36, 43, 114, 113],
        chordsOptions: [17, 16, 21, 22, 114, 113, 24, 25, 26, 27]
    },
    {
        name: 'Bachata',
        scale: 'minor',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'bachata' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 21, 22, 73, 74, 114, 115, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 24, 25],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 27]
    },
    {
        name: 'Son Cubano',
        scale: 'major',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'son' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 24 },
        leadOptions: [21, 22, 114, 115, 73, 74, 56, 57, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 21, 22],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 27]
    },
    {
        name: 'Rumba',
        scale: 'phrygian',
        root: 'E',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'rumba' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 108, 109, 110],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Guaracha',
        scale: 'major',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'guaracha' }
        },
        wave: 'sawtooth',
        instruments: { lead: 56, bass: 33, chords: 17 },
        leadOptions: [56, 57, 21, 22, 114, 115, 73, 74, 65, 66],
        bassOptions: [33, 34, 32, 35, 36, 43, 56, 57],
        chordsOptions: [17, 16, 21, 22, 114, 115, 24, 25, 26, 27]
    },
    {
        name: 'Cha Cha Cha',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'chacha' }
        },
        wave: 'triangle',
        instruments: { lead: 114, bass: 33, chords: 17 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 56, 57, 65],
        bassOptions: [33, 34, 32, 35, 36, 43, 114, 113],
        chordsOptions: [17, 16, 21, 22, 114, 113, 24, 25, 26, 27]
    },
    {
        name: 'Danzón',
        scale: 'major',
        root: 'G',
        bpm: 90,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'danzon' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 32, chords: 0 },
        leadOptions: [73, 74, 21, 22, 56, 57, 65, 66, 40, 41],
        bassOptions: [32, 33, 34, 35, 36, 43, 73, 74],
        chordsOptions: [0, 4, 21, 22, 16, 17, 18, 19, 20, 48]
    },
    {
        name: 'Bolero',
        scale: 'minor',
        root: 'D',
        bpm: 80,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'bolero' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 32, chords: 24 },
        leadOptions: [40, 41, 73, 74, 21, 22, 56, 57, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 40, 41],
        chordsOptions: [24, 25, 40, 41, 16, 17, 18, 19, 20, 48]
    },
    {
        name: 'Pachanga',
        scale: 'major',
        root: 'F',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pachanga' }
        },
        wave: 'sawtooth',
        instruments: { lead: 56, bass: 33, chords: 17 },
        leadOptions: [56, 57, 21, 22, 114, 115, 73, 74, 65, 66],
        bassOptions: [33, 34, 32, 35, 36, 43, 56, 57],
        chordsOptions: [17, 16, 21, 22, 114, 115, 24, 25, 26, 27]
    },
    {
        name: 'Timba',
        scale: 'chromatic',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'timba' }
        },
        wave: 'sawtooth',
        instruments: { lead: 62, bass: 39, chords: 17 },
        leadOptions: [62, 63, 56, 57, 21, 22, 114, 115, 73, 74],
        bassOptions: [39, 38, 33, 34, 35, 36, 62, 63],
        chordsOptions: [17, 16, 62, 63, 21, 22, 114, 115, 24, 25]
    },
    {
        name: 'Charanga',
        scale: 'major',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'charanga' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 32, chords: 24 },
        leadOptions: [73, 74, 40, 41, 21, 22, 56, 57, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 73, 74],
        chordsOptions: [24, 25, 73, 74, 16, 17, 18, 19, 20, 40]
    },
    {
        name: 'Mozambique',
        scale: 'major',
        root: 'F',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'mozambique' }
        },
        wave: 'triangle',
        instruments: { lead: 114, bass: 33, chords: 17 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 56, 57, 65],
        bassOptions: [33, 34, 32, 35, 36, 43, 114, 113],
        chordsOptions: [17, 16, 21, 22, 114, 113, 24, 25, 26, 27]
    },
    {
        name: 'Conga',
        scale: 'major',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'conga' }
        },
        wave: 'sawtooth',
        instruments: { lead: 114, bass: 33, chords: 17 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 56, 57, 65],
        bassOptions: [33, 34, 32, 35, 36, 43, 114, 113],
        chordsOptions: [17, 16, 21, 22, 114, 113, 24, 25, 26, 27]
    },
    {
        name: 'Bomba',
        scale: 'phrygian',
        root: 'E',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'bomba' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 108, 109, 110],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Plena',
        scale: 'major',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'plena' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 24 },
        leadOptions: [21, 22, 114, 115, 73, 74, 56, 57, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 21, 22],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 27]
    },
    {
        name: 'Guajira',
        scale: 'major',
        root: 'A',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'guajira' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 21, 22, 73, 74, 114, 115, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 24, 25],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 27]
    },
    {
        name: 'Son Montuno',
        scale: 'major',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'montuno' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 24 },
        leadOptions: [21, 22, 114, 115, 73, 74, 56, 57, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 21, 22],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 27]
    },
    {
        name: 'Guaguancó',
        scale: 'phrygian',
        root: 'E',
        bpm: 105,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'guaguanco' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 108, 109, 110],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Colombia',
        scale: 'minor',
        root: 'A',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'colombia' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 108, 109, 110],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Yambú',
        scale: 'phrygian',
        root: 'D',
        bpm: 85,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'yambu' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 108, 109, 110],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Guarapachangueo',
        scale: 'chromatic',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'guarapachangueo' }
        },
        wave: 'sawtooth',
        instruments: { lead: 114, bass: 39, chords: 17 },
        leadOptions: [114, 113, 115, 21, 22, 73, 74, 108, 109, 110],
        bassOptions: [39, 38, 33, 34, 35, 36, 114, 113],
        chordsOptions: [17, 16, 114, 113, 21, 22, 24, 25, 26, 27]
    },
    {
        name: 'Batá',
        scale: 'pentatonic',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'bata' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 108, 109, 110, 73, 74, 21, 22],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Iyesá',
        scale: 'phrygian',
        root: 'E',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'iyesa' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 108, 109, 110, 73, 74, 21, 22],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Makuta',
        scale: 'pentatonic',
        root: 'F',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'makuta' }
        },
        wave: 'triangle',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 113, 115, 108, 109, 110, 73, 74, 21, 22],
        bassOptions: [32, 33, 34, 35, 36, 43, 114, 113],
        chordsOptions: [24, 25, 114, 113, 16, 17, 18, 19, 20, 21]
    },
    {
        name: 'Villancico',
        scale: 'major',
        root: 'G',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'villancico' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 32, chords: 24 },
        leadOptions: [73, 74, 21, 22, 40, 41, 48, 49, 52, 53],
        bassOptions: [32, 33, 34, 35, 36, 43, 73, 74],
        chordsOptions: [24, 25, 73, 74, 16, 17, 18, 19, 20, 40]
    },
    {
        name: 'Punto Cubano',
        scale: 'major',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'punto' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 21, 22, 73, 74, 40, 41, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 24, 25],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 40]
    },
    {
        name: 'Tonada',
        scale: 'minor',
        root: 'A',
        bpm: 85,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'tonada' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 21, 22, 73, 74, 40, 41, 65, 66],
        bassOptions: [32, 33, 34, 35, 36, 43, 24, 25],
        chordsOptions: [24, 25, 21, 22, 16, 17, 18, 19, 20, 40]
    },
	{
        name: 'Chaabi (Maghreb)',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'darbuka' }
        },
        wave: 'sawtooth',
        instruments: { lead: 73, bass: 35, chords: 25 },
        leadOptions: [73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Rai (Algeria)',
        scale: 'minor',
        root: 'D',
        bpm: 130,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'square',
        instruments: { lead: 74, bass: 36, chords: 26 },
        leadOptions: [74, 73, 72, 71, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61],
        bassOptions: [36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Gnawa (Marokko)',
        scale: 'pentatonic',
        root: 'G',
        bpm: 105,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'taarija' }
        },
        wave: 'triangle',
        instruments: { lead: 73, bass: 35, chords: 25 },
        leadOptions: [73, 72, 71, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12]
    },
    {
        name: 'Andalusisch (Klassiek)',
        scale: 'maqam_bayati',
        root: 'D',
        bpm: 90,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'bendir' }
        },
        wave: 'sine',
        instruments: { lead: 49, bass: 33, chords: 25 },
        leadOptions: [49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62],
        bassOptions: [33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Malhoun (Marokko)',
        scale: 'major',
        root: 'F',
        bpm: 100,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'daf' }
        },
        wave: 'sawtooth',
        instruments: { lead: 68, bass: 40, chords: 28 },
        leadOptions: [68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81],
        bassOptions: [40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53],
        chordsOptions: [28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41]
    },
    {
        name: 'Kabyle (Berber)',
        scale: 'dorian',
        root: 'A',
        bpm: 115,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [3] },
            chords: { oct: [4] },
            drums: { kit: 'bendir' }
        },
        wave: 'square',
        instruments: { lead: 72, bass: 38, chords: 26 },
        leadOptions: [72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85],
        bassOptions: [38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Tuareg (Desert)',
        scale: 'pentatonic',
        root: 'E',
        bpm: 95,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'sawtooth',
        instruments: { lead: 73, bass: 35, chords: 25 },
        leadOptions: [73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Desert Blues',
        scale: 'blues',
        root: 'G',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 35, chords: 26 },
        leadOptions: [27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Shaabi (Egypte)',
        scale: 'minor',
        root: 'C',
        bpm: 125,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 29 },
        leadOptions: [81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94],
        bassOptions: [38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51],
        chordsOptions: [29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42]
    },
    {
        name: 'Mahraganat (Egypte)',
        scale: 'minor',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'electronic' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 40, chords: 30 },
        leadOptions: [87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100],
        bassOptions: [40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53],
        chordsOptions: [30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43]
    },
    {
        name: 'Tarab (Klassiek)',
        scale: 'maqam_rast',
        root: 'C',
        bpm: 80,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'riqq' }
        },
        wave: 'sine',
        instruments: { lead: 50, bass: 34, chords: 26 },
        leadOptions: [50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63],
        bassOptions: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Dabke (Levant)',
        scale: 'major',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'sawtooth',
        instruments: { lead: 65, bass: 37, chords: 28 },
        leadOptions: [65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78],
        bassOptions: [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50],
        chordsOptions: [28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41]
    },
    {
        name: 'Khaliji (Golf)',
        scale: 'major',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [3] },
            chords: { oct: [4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 76, bass: 39, chords: 27 },
        leadOptions: [76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52],
        chordsOptions: [27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40]
    },
    {
        name: 'Mugham (Azerbeidzjan)',
        scale: 'maqam_shur',
        root: 'E',
        bpm: 70,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'daf' }
        },
        wave: 'sine',
        instruments: { lead: 52, bass: 36, chords: 24 },
        leadOptions: [52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65],
        bassOptions: [36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
        chordsOptions: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37]
    },
    {
        name: 'Persian Pop',
        scale: 'minor',
        root: 'B',
        bpm: 128,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'rockkit' }
        },
        wave: 'sawtooth',
        instruments: { lead: 73, bass: 36, chords: 25 },
        leadOptions: [73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
        bassOptions: [36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Arabesk (Turkije)',
        scale: 'minor',
        root: 'A',
        bpm: 100,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'square',
        instruments: { lead: 70, bass: 38, chords: 26 },
        leadOptions: [70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83],
        bassOptions: [38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Fasi (Fez)',
        scale: 'maqam_saba',
        root: 'F',
        bpm: 85,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: 'bendir' }
        },
        wave: 'sine',
        instruments: { lead: 55, bass: 32, chords: 24 },
        leadOptions: [55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68],
        bassOptions: [32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45],
        chordsOptions: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37]
    },
    {
        name: 'Hawzi (Algerije)',
        scale: 'major',
        root: 'C',
        bpm: 95,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [3] },
            chords: { oct: [4] },
            drums: { kit: 'daf' }
        },
        wave: 'sawtooth',
        instruments: { lead: 67, bass: 35, chords: 25 },
        leadOptions: [67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Mezwed (Tunesië)',
        scale: 'major',
        root: 'G',
        bpm: 135,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'darbuka' }
        },
        wave: 'square',
        instruments: { lead: 71, bass: 37, chords: 26 },
        leadOptions: [71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84],
        bassOptions: [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Musique Orientale',
        scale: 'maqam_hijaz',
        root: 'D',
        bpm: 90,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'riqq' }
        },
        wave: 'sine',
        instruments: { lead: 53, bass: 34, chords: 25 },
        leadOptions: [53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66],
        bassOptions: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Saharan Rock',
        scale: 'minor',
        root: 'E',
        bpm: 110,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'rockkit' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 36, chords: 27 },
        leadOptions: [29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42],
        bassOptions: [36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
        chordsOptions: [27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40]
    },
    {
        name: 'Moorish Rock',
        scale: 'phrygian',
        root: 'A',
        bpm: 115,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'rockkit' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 37, chords: 26 },
        leadOptions: [30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43],
        bassOptions: [37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Izran (Rif)',
        scale: 'pentatonic',
        root: 'G',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [3] },
            chords: { oct: [4] },
            drums: { kit: 'bendir' }
        },
        wave: 'sine',
        instruments: { lead: 72, bass: 35, chords: 24 },
        leadOptions: [72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37]
    },
    {
        name: 'Amazigh Rock',
        scale: 'mixolydian',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'rockkit' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 36, chords: 27 },
        leadOptions: [30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43],
        bassOptions: [36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
        chordsOptions: [27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40]
    },
    {
        name: 'Ahidous (Atlas)',
        scale: 'dorian',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'bendir' }
        },
        wave: 'square',
        instruments: { lead: 74, bass: 38, chords: 26 },
        leadOptions: [74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87],
        bassOptions: [38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51],
        chordsOptions: [26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39]
    },
    {
        name: 'Ahwash (Souss)',
        scale: 'pentatonic',
        root: 'A',
        bpm: 125,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'bendir' }
        },
        wave: 'triangle',
        instruments: { lead: 73, bass: 35, chords: 25 },
        leadOptions: [73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Rwayes (Berber)',
        scale: 'phrygian',
        root: 'E',
        bpm: 95,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'taarija' }
        },
        wave: 'sine',
        instruments: { lead: 70, bass: 34, chords: 24 },
        leadOptions: [70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83],
        bassOptions: [34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47],
        chordsOptions: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37]
    },
    {
        name: 'Tagnawit (Spiritueel)',
        scale: 'pentatonic',
        root: 'G',
        bpm: 100,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'taarija' }
        },
        wave: 'triangle',
        instruments: { lead: 73, bass: 35, chords: 25 },
        leadOptions: [73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38]
    },
    {
        name: 'Taqtoqa (Rif)',
        scale: 'major',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [3] },
            chords: { oct: [4] },
            drums: { kit: 'darbuka' }
        },
        wave: 'square',
        instruments: { lead: 76, bass: 39, chords: 28 },
        leadOptions: [76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89],
        bassOptions: [39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52],
        chordsOptions: [28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41]
    },
    {
        name: 'Tindé (Toeareg)',
        scale: 'pentatonic',
        root: 'D',
        bpm: 85,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'daf' }
        },
        wave: 'triangle',
        instruments: { lead: 71, bass: 35, chords: 24 },
        leadOptions: [71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84],
        bassOptions: [35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48],
        chordsOptions: [24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37]
    },
	
	    {
        name: 'Classical',
        scale: 'major',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'orchestral' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 43, chords: 48 },
        leadOptions: [40, 41, 42, 44, 45, 46, 48, 49, 50, 51, 60, 68, 70, 71, 73],
        bassOptions: [43, 42, 32, 33, 35, 41, 45, 58, 70],
        chordsOptions: [48, 49, 50, 51, 0, 1, 6, 7, 14, 15, 19, 20, 21]
    },
    {
        name: 'Jazz',
        scale: 'dorian',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 65, bass: 32, chords: 26 },
        leadOptions: [65, 66, 56, 4, 11, 12, 13, 64, 67, 71, 73, 74, 75, 76, 77],
        bassOptions: [32, 35, 43, 33, 34, 36, 37, 38, 39, 40, 41, 42, 44, 45],
        chordsOptions: [26, 4, 16, 5, 0, 1, 2, 6, 7, 17, 18, 19, 20, 21, 22]
    },
    {
        name: 'Blues',
        scale: 'pentatonic',
        root: 'E',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'blues' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 33, chords: 26 },
        leadOptions: [30, 29, 27, 26, 25, 28, 31, 22, 18, 19, 56, 57, 65, 66],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [26, 25, 27, 18, 17, 0, 1, 4, 19, 20]
    },
    {
        name: 'Rock',
        scale: 'minor',
        root: 'E',
        bpm: 124,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 31, 27, 28, 26, 25, 80, 81, 18, 19, 20],
        bassOptions: [34, 33, 35, 36, 37, 38, 39],
        chordsOptions: [30, 29, 31, 18, 19, 17, 16, 0, 1]
    },
    {
        name: 'Metal',
        scale: 'phrygian',
        root: 'E',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 39, chords: 30 },
        leadOptions: [30, 31, 29, 81, 82, 85, 87, 18, 19],
        bassOptions: [39, 38, 34, 33, 35, 36, 37],
        chordsOptions: [30, 29, 31, 18, 19]
    },
    {
        name: 'Pop',
        scale: 'major',
        root: 'C',
        bpm: 118,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 33, chords: 88 },
        leadOptions: [81, 82, 80, 89, 90, 4, 5, 2, 73, 74, 56, 61, 62],
        bassOptions: [33, 34, 38, 39, 32, 35, 81],
        chordsOptions: [88, 89, 90, 91, 0, 1, 4, 5, 12, 13]
    },
    {
        name: 'R&B',
        scale: 'minor',
        root: 'Bb',
        bpm: 85,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 33, chords: 95 },
        leadOptions: [4, 5, 88, 89, 73, 74, 11, 12, 56, 57, 65, 66],
        bassOptions: [33, 34, 32, 35, 38, 39],
        chordsOptions: [95, 94, 5, 4, 0, 1, 17, 18, 88, 89]
    },
    {
        name: 'Soul',
        scale: 'major',
        root: 'G',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'funk' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 33, chords: 4 },
        leadOptions: [56, 57, 65, 66, 61, 62, 58, 4, 5, 17, 18],
        bassOptions: [33, 32, 34, 35, 36, 37],
        chordsOptions: [4, 5, 17, 18, 0, 1, 19, 20, 26, 27]
    },
    {
        name: 'Funk',
        scale: 'dorian',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'funk' }
        },
        wave: 'triangle',
        instruments: { lead: 57, bass: 36, chords: 26 },
        leadOptions: [57, 56, 61, 62, 65, 66, 81, 80, 84, 11, 12],
        bassOptions: [36, 37, 34, 33, 32, 35, 38, 39],
        chordsOptions: [26, 27, 17, 18, 4, 5, 0, 1]
    },
    {
        name: 'Disco',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sawtooth',
        instruments: { lead: 61, bass: 33, chords: 52 },
        leadOptions: [61, 62, 56, 57, 81, 80, 48, 49, 11, 12],
        bassOptions: [33, 32, 38, 39, 34, 35],
        chordsOptions: [52, 53, 54, 55, 48, 49, 0, 1, 4, 5]
    },
    {
        name: 'Reggae',
        scale: 'major',
        root: 'C',
        bpm: 74,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'reggae' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 33, chords: 26 },
        leadOptions: [56, 57, 65, 66, 61, 62, 11, 12, 13, 22],
        bassOptions: [33, 32, 34, 35, 38, 39],
        chordsOptions: [26, 27, 24, 25, 4, 5, 17, 18]
    },
    {
        name: 'Country',
        scale: 'major',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'country' }
        },
        wave: 'triangle',
        instruments: { lead: 105, bass: 32, chords: 25 },
        leadOptions: [105, 106, 107, 26, 27, 25, 24, 40, 41, 65, 66],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [25, 24, 26, 0, 1, 2, 3, 27, 28]
    },
    {
        name: 'Electronic',
        scale: 'minor',
        root: 'C',
        bpm: 128,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'electro' }
        },
        wave: 'square',
        instruments: { lead: 80, bass: 38, chords: 90 },
        leadOptions: [80, 81, 82, 83, 84, 85, 86, 87, 62, 63],
        bassOptions: [38, 39, 81, 87, 33, 34],
        chordsOptions: [90, 88, 89, 91, 92, 62, 63, 81]
    },
    {
        name: 'Folk',
        scale: 'major',
        root: 'D',
        bpm: 105,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 25 },
        leadOptions: [24, 25, 105, 109, 110, 73, 74, 40, 41, 26],
        bassOptions: [32, 33, 43, 42],
        chordsOptions: [25, 24, 26, 0, 1, 105]
    },
    {
        name: 'Punk',
        scale: 'minor',
        root: 'A',
        bpm: 165,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'punk' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 34, chords: 29 },
        leadOptions: [29, 30, 31, 27, 28, 26],
        bassOptions: [34, 33, 35, 39],
        chordsOptions: [29, 30, 31, 27, 28]
    },
    {
        name: 'Indie',
        scale: 'major',
        root: 'E',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'indie' }
        },
        wave: 'sine',
        instruments: { lead: 27, bass: 34, chords: 26 },
        leadOptions: [27, 28, 26, 25, 24, 81, 80, 73],
        bassOptions: [34, 33, 32, 35],
        chordsOptions: [26, 27, 25, 0, 1, 4, 88]
    },
    {
        name: 'Alternative',
        scale: 'minor',
        root: 'G',
        bpm: 122,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 27 },
        leadOptions: [30, 29, 27, 28, 81, 80, 90],
        bassOptions: [34, 33, 35, 38, 39],
        chordsOptions: [27, 28, 30, 29, 26, 18, 19]
    },
    {
        name: 'Ambient',
        scale: 'lydian',
        root: 'C',
        bpm: 60,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 95, chords: 92 },
        leadOptions: [99, 100, 101, 102, 91, 95, 96, 97],
        bassOptions: [95, 94, 93, 33, 34],
        chordsOptions: [92, 91, 90, 89, 48, 49, 101]
    },
    {
        name: 'Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 62 },
        leadOptions: [81, 80, 87, 86, 62, 63, 38, 39],
        bassOptions: [38, 39, 87, 86, 81],
        chordsOptions: [62, 63, 64, 80, 81, 87]
    },
    {
        name: 'House',
        scale: 'minor',
        root: 'F',
        bpm: 124,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 88 },
        leadOptions: [81, 80, 88, 89, 17, 18, 5, 2, 73],
        bassOptions: [38, 39, 33, 34, 81],
        chordsOptions: [88, 89, 90, 17, 18, 4, 5, 0]
    },
    {
        name: 'Dubstep',
        scale: 'phrygian',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 39, chords: 118 },
        leadOptions: [87, 81, 80, 62, 63, 30, 31],
        bassOptions: [39, 38, 87, 86, 118],
        chordsOptions: [118, 97, 62, 63, 81]
    },
    {
        name: 'Drum and Bass',
        scale: 'minor',
        root: 'F',
        bpm: 172,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'amen' }
        },
        wave: 'sine',
        instruments: { lead: 62, bass: 87, chords: 50 },
        leadOptions: [62, 81, 80, 73, 5, 11, 30],
        bassOptions: [87, 39, 38, 33, 34],
        chordsOptions: [50, 51, 90, 89, 95]
    },
    {
        name: 'Trap',
        scale: 'minor',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'triangle',
        instruments: { lead: 81, bass: 87, chords: 88 },
        leadOptions: [81, 80, 87, 56, 11, 10, 22, 2],
        bassOptions: [87, 39, 38, 33, 34],
        chordsOptions: [88, 90, 81, 80, 4, 5]
    },
    {
        name: 'Lo-fi',
        scale: 'minor',
        root: 'G',
        bpm: 80,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'lofi' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 33, chords: 89 },
        leadOptions: [4, 5, 89, 73, 74, 11, 12, 66, 65, 24],
        bassOptions: [33, 32, 39, 38, 34],
        chordsOptions: [89, 4, 5, 0, 1, 17, 18, 95]
    },
    {
        name: 'Synth-pop',
        scale: 'major',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'electro' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 82, 80, 62, 63, 51, 52, 90],
        bassOptions: [38, 39, 81, 82, 33, 34],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51]
    },
    {
        name: 'Electropop',
        scale: 'major',
        root: 'C',
        bpm: 122,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 82, 80, 89, 90, 62, 63, 73],
        bassOptions: [38, 39, 33, 34, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 4, 5]
    },
    {
        name: 'New Wave',
        scale: 'minor',
        root: 'D',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: '80s' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 26 },
        leadOptions: [81, 80, 62, 63, 27, 28, 73, 74],
        bassOptions: [38, 39, 34, 33, 32],
        chordsOptions: [26, 27, 25, 90, 89, 88, 50]
    },
    {
        name: 'Post-punk',
        scale: 'minor',
        root: 'A',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'punk' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 34, chords: 27 },
        leadOptions: [29, 30, 27, 28, 81, 80, 90],
        bassOptions: [34, 33, 32, 35, 38, 39],
        chordsOptions: [27, 28, 29, 26, 30, 18, 19]
    },
    {
        name: 'Grunge',
        scale: 'minor',
        root: 'E',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 31, 27, 28, 26, 25],
        bassOptions: [34, 33, 35, 39],
        chordsOptions: [30, 29, 31, 18, 19, 17, 16]
    },
    {
        name: 'Emo',
        scale: 'minor',
        root: 'G#',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 34, chords: 27 },
        leadOptions: [29, 30, 27, 28, 26, 25, 80],
        bassOptions: [34, 33, 35, 39],
        chordsOptions: [27, 28, 29, 30, 26, 18, 19]
    },
    {
        name: 'Progressive Rock',
        scale: 'mixolydian',
        root: 'E',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'prog' }
        },
        wave: 'sawtooth',
        instruments: { lead: 19, bass: 35, chords: 30 },
        leadOptions: [19, 20, 30, 29, 81, 80, 56, 61, 62, 73, 74],
        bassOptions: [35, 34, 33, 32, 36, 37, 38, 39],
        chordsOptions: [30, 29, 18, 19, 17, 16, 0, 1, 4, 5]
    },

    {
        name: 'Psychedelic Rock',
        scale: 'mixolydian',
        root: 'A',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 34, chords: 91 },
        leadOptions: [29, 30, 31, 27, 102, 103, 91, 95, 96, 56, 18],
        bassOptions: [34, 33, 35, 36, 38, 39],
        chordsOptions: [91, 95, 90, 89, 18, 19, 0, 1, 26, 27]
    },
    {
        name: 'Hard Rock',
        scale: 'minor',
        root: 'E',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 31, 27, 28, 81, 80],
        bassOptions: [34, 33, 35, 39, 38],
        chordsOptions: [30, 29, 31, 18, 19, 17, 16]
    },
    {
        name: 'Heavy Metal',
        scale: 'phrygian',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 31, 29, 18, 19, 81, 82],
        bassOptions: [34, 39, 38, 33, 35],
        chordsOptions: [30, 29, 31, 18, 19]
    },
    {
        name: 'Death Metal',
        scale: 'locrian',
        root: 'D',
        bpm: 180,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1] },
            chords: { oct: [2, 3] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 39, chords: 30 },
        leadOptions: [30, 31, 81, 87, 18, 19, 118],
        bassOptions: [39, 38, 34, 35],
        chordsOptions: [30, 31, 18, 19]
    },
    {
        name: 'Black Metal',
        scale: 'minor',
        root: 'E',
        bpm: 170,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 39, chords: 30 },
        leadOptions: [30, 31, 18, 19, 52, 53, 48, 49],
        bassOptions: [39, 38, 34, 35],
        chordsOptions: [30, 31, 18, 19, 48, 49]
    },
    {
        name: 'Thrash Metal',
        scale: 'chromatic',
        root: 'E',
        bpm: 190,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 31, 29, 18, 19, 81, 80],
        bassOptions: [34, 33, 35, 39, 38],
        chordsOptions: [30, 29, 31]
    },
    {
        name: 'Power Metal',
        scale: 'major',
        root: 'D',
        bpm: 165,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'metal' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 48 },
        leadOptions: [30, 31, 56, 57, 60, 61, 81, 18, 19],
        bassOptions: [34, 33, 35, 38, 39],
        chordsOptions: [48, 49, 50, 51, 30, 31, 19, 20]
    },
    {
        name: 'Gothic Metal',
        scale: 'minor',
        root: 'B',
        bpm: 90,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 19 },
        leadOptions: [30, 31, 40, 41, 42, 48, 49, 52, 53, 19, 20],
        bassOptions: [34, 33, 35, 39, 38],
        chordsOptions: [19, 20, 48, 49, 52, 53, 30, 31]
    },
    {
        name: 'Industrial',
        scale: 'chromatic',
        root: 'C',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'industrial' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 118 },
        leadOptions: [87, 81, 80, 62, 30, 31, 102, 103, 118],
        bassOptions: [38, 39, 87, 86, 33, 34],
        chordsOptions: [118, 102, 103, 81, 80, 30, 31]
    },
    {
        name: 'Hardcore',
        scale: 'minor',
        root: 'A',
        bpm: 180,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'punk' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 31, 29, 28, 27, 81],
        bassOptions: [34, 33, 35, 39],
        chordsOptions: [30, 31, 29, 28, 27]
    },
    {
        name: 'Ska',
        scale: 'major',
        root: 'G',
        bpm: 135,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'ska' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 26 },
        leadOptions: [56, 57, 58, 61, 62, 65, 66, 67, 11, 12],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [26, 27, 25, 24, 4, 5, 0, 1, 17, 18]
    },
    {
        name: 'Reggaeton',
        scale: 'minor',
        root: 'F#',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 87, chords: 24 },
        leadOptions: [81, 80, 82, 62, 63, 56, 11, 2, 73, 74],
        bassOptions: [87, 39, 38, 33, 34],
        chordsOptions: [24, 25, 4, 5, 88, 89, 90]
    },
    {
        name: 'Salsa',
        scale: 'mixolydian',
        root: 'C',
        bpm: 180,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 0 },
        leadOptions: [56, 57, 58, 61, 62, 65, 66, 0, 1, 11, 12],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [0, 1, 4, 5, 17, 18, 56, 57, 11, 12]
    },
    {
        name: 'Bachata',
        scale: 'major',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 33, chords: 24 },
        leadOptions: [24, 25, 26, 27, 105, 106, 0, 1, 4, 5],
        bassOptions: [33, 34, 32, 35, 38, 39],
        chordsOptions: [24, 25, 26, 27, 0, 1, 4, 5]
    },
    {
        name: 'Merengue',
        scale: 'major',
        root: 'C',
        bpm: 150,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 0 },
        leadOptions: [56, 57, 58, 61, 62, 21, 22, 0, 1, 11, 12],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [0, 1, 2, 4, 5, 21, 22, 56, 57]
    },
    {
        name: 'Cumbia',
        scale: 'minor',
        root: 'G',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 0 },
        leadOptions: [21, 22, 56, 57, 73, 74, 24, 25, 11, 12, 0, 1],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [0, 1, 2, 4, 5, 21, 22, 24, 25]
    },
    {
        name: 'Tango',
        scale: 'harmonicMinor',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'tango' }
        },
        wave: 'sine',
        instruments: { lead: 21, bass: 32, chords: 40 },
        leadOptions: [21, 22, 40, 41, 0, 1, 73, 74, 110],
        bassOptions: [32, 33, 43, 42, 35],
        chordsOptions: [40, 41, 48, 49, 0, 1, 21, 22]
    },
    {
        name: 'Bossa Nova',
        scale: 'major',
        root: 'F',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'bossa' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 32, chords: 24 },
        leadOptions: [66, 65, 73, 74, 56, 57, 11, 12, 0, 1, 4, 5, 24],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [24, 25, 4, 5, 0, 1, 17, 18, 88, 89]
    },
    {
        name: 'Samba',
        scale: 'major',
        root: 'G',
        bpm: 130,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'samba' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 24 },
        leadOptions: [56, 57, 58, 61, 62, 11, 12, 0, 1, 24, 25, 26],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [24, 25, 0, 1, 4, 5, 56, 57, 11, 12]
    },
    {
        name: 'AfrobeatInMeasure',
        scale: 'dorian',
        root: 'A',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'triangle',
        instruments: { lead: 56, bass: 33, chords: 26 },
        leadOptions: [56, 57, 58, 61, 62, 65, 66, 81, 80, 11, 12, 17, 18],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [26, 27, 24, 25, 17, 18, 4, 5, 0, 1]
    },
    {
        name: 'Highlife',
        scale: 'major',
        root: 'F',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 26 },
        leadOptions: [56, 57, 61, 62, 11, 12, 26, 27, 24, 25, 0, 1],
        bassOptions: [32, 33, 34, 35, 36, 37],
        chordsOptions: [26, 27, 24, 25, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'K-pop',
        scale: 'major',
        root: 'C',
        bpm: 128,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 88 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 73, 74, 56, 61, 2],
        bassOptions: [38, 39, 33, 34, 87, 81, 82],
        chordsOptions: [88, 89, 90, 91, 0, 1, 4, 5, 81, 80, 50, 51]
    },
    {
        name: 'J-pop',
        scale: 'major',
        root: 'D',
        bpm: 135,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 82, 80, 89, 90, 62, 63, 30, 31, 27, 28, 73],
        bassOptions: [38, 39, 33, 34, 35, 81, 82],
        chordsOptions: [90, 88, 89, 81, 80, 0, 1, 30, 31, 48, 49]
    },
    {
        name: 'C-pop',
        scale: 'major',
        root: 'C',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 33, chords: 0 },
        leadOptions: [81, 80, 89, 90, 0, 1, 4, 5, 73, 74, 107],
        bassOptions: [33, 34, 32, 35, 38, 39],
        chordsOptions: [0, 1, 4, 5, 88, 89, 48, 49, 12, 13]
    },
    {
        name: 'Mandopop',
        scale: 'major',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 33, chords: 48 },
        leadOptions: [0, 1, 4, 5, 73, 74, 88, 89, 40, 41, 107],
        bassOptions: [33, 34, 32, 35, 38, 39, 43],
        chordsOptions: [48, 49, 0, 1, 4, 5, 88, 89, 52, 53]
    },
    {
        name: 'Cantopop',
        scale: 'major',
        root: 'Ab',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 33, chords: 48 },
        leadOptions: [0, 1, 4, 5, 73, 74, 11, 12, 88, 89, 107],
        bassOptions: [33, 34, 32, 35, 43, 42],
        chordsOptions: [48, 49, 0, 1, 4, 5, 52, 53, 88, 89]
    },
    {
        name: 'Britpop',
        scale: 'major',
        root: 'E',
        bpm: 122,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sine',
        instruments: { lead: 27, bass: 34, chords: 26 },
        leadOptions: [27, 28, 29, 30, 26, 25, 24, 0, 1, 18, 19, 73],
        bassOptions: [34, 33, 35, 32],
        chordsOptions: [26, 27, 25, 24, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'Europop',
        scale: 'major',
        root: 'C',
        bpm: 124,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'pop' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 51, 52, 11, 12],
        bassOptions: [38, 39, 33, 34, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 0, 1, 4, 5]
    },
    {
        name: 'Schlager',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'disco' }
        },
        wave: 'sine',
        instruments: { lead: 21, bass: 32, chords: 0 },
        leadOptions: [21, 22, 56, 57, 11, 12, 0, 1, 4, 5, 61, 62],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [0, 1, 4, 5, 21, 22, 48, 49, 88, 89]
    },
    {
        name: 'Chanson',
        scale: 'minor',
        root: 'A',
        bpm: 110,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 21, bass: 32, chords: 0 },
        leadOptions: [21, 22, 24, 25, 40, 41, 73, 74, 0, 1, 66, 65],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [0, 1, 4, 5, 24, 25, 40, 41, 48, 49]
    },
    {
        name: 'Fado',
        scale: 'harmonicMinor',
        root: 'D',
        bpm: 80,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 26, 27, 40, 41, 105],
        bassOptions: [32, 33, 43, 42, 35],
        chordsOptions: [24, 25, 26, 27, 0, 1, 4, 5]
    },
    {
        name: 'Bluegrass',
        scale: 'major',
        root: 'G',
        bpm: 145,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'triangle',
        instruments: { lead: 105, bass: 32, chords: 25 },
        leadOptions: [105, 106, 107, 40, 41, 24, 25, 26, 27],
        bassOptions: [32, 33, 43, 42],
        chordsOptions: [25, 24, 26, 27, 105, 106, 0, 1]
    },
    {
        name: 'Zydeco',
        scale: 'major',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'zydeco' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 25 },
        leadOptions: [21, 22, 23, 56, 57, 115, 24, 25],
        bassOptions: [32, 33, 34, 35, 38],
        chordsOptions: [25, 24, 21, 22, 0, 1, 4, 5]
    },
    {
        name: 'Cajun',
        scale: 'major',
        root: 'G',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'sine',
        instruments: { lead: 110, bass: 32, chords: 21 },
        leadOptions: [110, 40, 41, 21, 22, 24, 25],
        bassOptions: [32, 33, 43, 42],
        chordsOptions: [21, 22, 24, 25, 0, 1]
    },
    {
        name: 'Gospel',
        scale: 'major',
        root: 'Eb',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'funk' }
        },
        wave: 'sine',
        instruments: { lead: 19, bass: 33, chords: 0 },
        leadOptions: [19, 20, 52, 53, 54, 56, 57, 4, 5, 17, 18],
        bassOptions: [33, 34, 32, 35, 36, 37],
        chordsOptions: [0, 1, 4, 5, 19, 20, 17, 18, 52, 53]
    },
    {
        name: 'Spirituals',
        scale: 'major',
        root: 'F',
        bpm: 80,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 52, bass: 32, chords: 19 },
        leadOptions: [52, 53, 54, 19, 20, 0, 1],
        bassOptions: [32, 33, 34, 35],
        chordsOptions: [19, 20, 0, 1, 52, 53]
    },
    {
        name: 'Hymns',
        scale: 'major',
        root: 'C',
        bpm: 70,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 19, bass: 32, chords: 19 },
        leadOptions: [19, 20, 52, 53, 48, 49, 0, 1],
        bassOptions: [32, 33, 35, 43, 42],
        chordsOptions: [19, 20, 48, 49, 0, 1, 52, 53]
    },
    {
        name: 'New Age',
        scale: 'lydian',
        root: 'C',
        bpm: 65,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 95, chords: 91 },
        leadOptions: [99, 100, 46, 73, 74, 11, 12, 88, 89],
        bassOptions: [95, 94, 93, 33, 34, 32],
        chordsOptions: [91, 92, 95, 88, 89, 48, 49, 100]
    },
    {
        name: 'World',
        scale: 'mixolydian',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'world' }
        },
        wave: 'triangle',
        instruments: { lead: 104, bass: 32, chords: 104 },
        leadOptions: [104, 105, 110, 111, 73, 74, 21, 22, 108, 109],
        bassOptions: [32, 33, 35, 38, 39],
        chordsOptions: [104, 105, 111, 24, 25, 0, 1, 4, 5]
    },
    {
        name: 'Latin',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 0 },
        leadOptions: [56, 57, 61, 62, 24, 25, 0, 1, 11, 12],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [0, 1, 4, 5, 24, 25, 56, 57, 11, 12]
    },
    {
        name: 'Celtic',
        scale: 'dorian',
        root: 'D',
        bpm: 115,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'world' }
        },
        wave: 'triangle',
        instruments: { lead: 109, bass: 32, chords: 105 },
        leadOptions: [109, 110, 40, 41, 73, 74, 24, 25, 105, 106],
        bassOptions: [32, 33, 35, 43, 42],
        chordsOptions: [105, 106, 25, 24, 0, 1, 26, 27]
    },
    {
        name: 'Klezmer',
        scale: 'phrygianDominant',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'world' }
        },
        wave: 'sine',
        instruments: { lead: 71, bass: 32, chords: 21 },
        leadOptions: [71, 72, 56, 57, 58, 21, 22, 40, 41, 110],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [21, 22, 0, 1, 4, 5, 110]
    },
    {
        name: 'Gregorian',
        scale: 'aeolian',
        root: 'C',
        bpm: 50,
        roles: {
            lead: { oct: [4] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 52, bass: 52, chords: 52 },
        leadOptions: [52, 53, 54, 19, 20],
        bassOptions: [52, 53, 54, 19, 20],
        chordsOptions: [52, 53, 54, 19, 20]
    },
    {
        name: 'Opera',
        scale: 'minor',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'orchestral' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 43, chords: 48 },
        leadOptions: [40, 41, 42, 52, 53, 54, 68, 69, 70, 71, 73],
        bassOptions: [43, 42, 32, 33, 35, 58],
        chordsOptions: [48, 49, 50, 51, 0, 1, 6, 7, 14, 15]
    },
    {
        name: 'Orchestral',
        scale: 'major',
        root: 'D',
        bpm: 100,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'orchestral' }
        },
        wave: 'sine',
        instruments: { lead: 48, bass: 43, chords: 48 },
        leadOptions: [48, 49, 50, 51, 40, 41, 42, 56, 57, 60, 68, 70, 73],
        bassOptions: [43, 42, 58, 70, 32, 33, 35],
        chordsOptions: [48, 49, 50, 51, 0, 1, 6, 7, 19, 20]
    },
    {
        name: 'Film Score',
        scale: 'minor',
        root: 'E',
        bpm: 80,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sine',
        instruments: { lead: 48, bass: 43, chords: 95 },
        leadOptions: [48, 49, 40, 41, 60, 61, 95, 96, 99, 100],
        bassOptions: [43, 42, 58, 38, 39, 95],
        chordsOptions: [95, 96, 48, 49, 50, 51, 91, 92, 0, 1]
    },
    {
        name: 'Video Game',
        scale: 'minor',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 80, bass: 38, chords: 81 },
        leadOptions: [80, 81, 82, 62, 63, 118, 51, 50],
        bassOptions: [38, 39, 81, 80, 87, 86, 33, 34],
        chordsOptions: [81, 80, 62, 63, 90, 89, 50, 51]
    },
    {
        name: 'Musical Theatre',
        scale: 'major',
        root: 'Bb',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 32, chords: 48 },
        leadOptions: [0, 1, 56, 57, 65, 66, 40, 41, 61, 62],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [48, 49, 0, 1, 4, 5, 6, 7, 21, 22]
    },
    {
        name: 'Broadway',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 48 },
        leadOptions: [56, 57, 58, 61, 62, 65, 66, 0, 1, 11, 12],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [48, 49, 0, 1, 4, 5, 56, 57, 6, 7]
    },
    {
        name: 'Easy Listening',
        scale: 'major',
        root: 'G',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 65, bass: 32, chords: 0 },
        leadOptions: [65, 66, 73, 74, 11, 12, 4, 5, 0, 1, 24, 25],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [0, 1, 4, 5, 48, 49, 17, 18, 88, 89]
    },
    {
        name: 'Lounge',
        scale: 'major',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 33, chords: 88 },
        leadOptions: [4, 5, 66, 65, 73, 74, 11, 12, 17, 18, 56],
        bassOptions: [33, 32, 34, 35, 38, 39],
        chordsOptions: [88, 89, 4, 5, 17, 18, 0, 1, 95, 96]
    },
    {
        name: 'Chill-out',
        scale: 'major',
        root: 'F',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 33, chords: 95 },
        leadOptions: [99, 100, 73, 74, 11, 12, 88, 89, 4, 5, 101],
        bassOptions: [33, 32, 38, 39, 34, 35, 95],
        chordsOptions: [95, 96, 88, 89, 4, 5, 0, 1, 91, 92]
    },
    {
        name: 'Downtempo',
        scale: 'minor',
        root: 'G',
        bpm: 85,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 33, chords: 95 },
        leadOptions: [73, 74, 99, 100, 4, 5, 11, 12, 62, 63, 89, 90],
        bassOptions: [33, 32, 38, 39, 34, 35, 87, 95],
        chordsOptions: [95, 96, 91, 92, 88, 89, 4, 5, 0, 1]
    },
    {
        name: 'Trip Hop',
        scale: 'minor',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'lofi' }
        },
        wave: 'triangle',
        instruments: { lead: 73, bass: 39, chords: 90 },
        leadOptions: [73, 74, 11, 12, 62, 63, 81, 80, 56, 4, 5, 30, 31],
        bassOptions: [39, 38, 87, 86, 33, 34, 35],
        chordsOptions: [90, 89, 95, 96, 4, 5, 0, 1, 17, 18, 30, 31]
    },
    {
        name: 'BreakbeatInMeasure',
        scale: 'minor',
        root: 'F',
        bpm: 135,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'break' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 87 },
        leadOptions: [81, 80, 62, 63, 87, 86, 11, 12, 22, 2],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63, 90, 89]
    },
    {
        name: 'Big Beat',
        scale: 'minor',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 30 },
        leadOptions: [81, 80, 30, 31, 87, 86, 118, 62, 63, 11, 12],
        bassOptions: [39, 38, 87, 86, 33, 34, 30, 31],
        chordsOptions: [30, 31, 81, 80, 118, 87, 18, 19]
    },
    {
        name: 'Acid Jazz',
        scale: 'dorian',
        root: 'G',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'funk' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 33, chords: 17 },
        leadOptions: [66, 65, 56, 57, 61, 62, 4, 5, 11, 12, 17, 18],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [17, 18, 4, 5, 0, 1, 88, 89, 26, 27]
    },
    {
        name: 'Nu Jazz',
        scale: 'dorian',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 38, chords: 88 },
        leadOptions: [66, 65, 73, 74, 81, 80, 11, 12, 4, 5, 62, 63],
        bassOptions: [38, 39, 33, 34, 32, 35, 81],
        chordsOptions: [88, 89, 90, 4, 5, 17, 18, 0, 1, 95, 96]
    },
    {
        name: 'Smooth Jazz',
        scale: 'major',
        root: 'F',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 65, bass: 33, chords: 4 },
        leadOptions: [65, 66, 4, 5, 73, 74, 11, 12, 56, 57, 24, 25],
        bassOptions: [33, 32, 34, 35, 43, 42],
        chordsOptions: [4, 5, 0, 1, 17, 18, 88, 89, 95, 96]
    },
    {
        name: 'Bebop',
        scale: 'chromatic',
        root: 'C',
        bpm: 180,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 32, chords: 0 },
        leadOptions: [66, 65, 56, 57, 58, 61, 62, 67, 71, 72, 11, 12],
        bassOptions: [32, 33, 35, 43, 42],
        chordsOptions: [0, 1, 4, 5, 6, 7, 17, 18, 19, 20]
    },
    {
        name: 'Swing',
        scale: 'major',
        root: 'G',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 0 },
        leadOptions: [56, 57, 58, 61, 62, 65, 66, 67, 11, 12, 0, 1],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [0, 1, 4, 5, 6, 7, 17, 18, 56, 57, 11, 12]
    },
    {
        name: 'Ragtime',
        scale: 'major',
        root: 'C',
        bpm: 170,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 0, chords: 0 },
        leadOptions: [0, 1, 2, 3, 4, 5],
        bassOptions: [0, 1, 2, 3],
        chordsOptions: [0, 1, 2, 3, 4, 5]
    },
    {
        name: 'Boogie-woogie',
        scale: 'major',
        root: 'G',
        bpm: 160,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 32, chords: 0 },
        leadOptions: [0, 1, 2, 3, 4, 5, 30, 31, 11, 12],
        bassOptions: [32, 33, 34, 35, 0, 1],
        chordsOptions: [0, 1, 4, 5, 17, 18, 30, 31]
    },
    {
        name: 'Dixieland',
        scale: 'major',
        root: 'C',
        bpm: 150,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 57, bass: 58, chords: 11 },
        leadOptions: [57, 56, 65, 66, 58, 59, 71, 72, 11, 12, 0, 1],
        bassOptions: [58, 59, 43, 42, 32, 33],
        chordsOptions: [11, 12, 13, 0, 1, 4, 5, 56, 57]
    },
    {
        name: 'Drone',
        scale: 'minor',
        root: 'C',
        bpm: 40,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [1] },
            chords: { oct: [2, 3] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 97, bass: 95, chords: 91 },
        leadOptions: [97, 98, 91, 95, 87, 86, 52, 53, 101, 102],
        bassOptions: [95, 94, 93, 39, 38, 87],
        chordsOptions: [91, 90, 89, 48, 49, 95, 96, 101]
    },
    {
        name: 'Glitch',
        scale: 'chromatic',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'glitch' }
        },
        wave: 'square',
        instruments: { lead: 118, bass: 39, chords: 115 },
        leadOptions: [118, 115, 120, 121, 125, 81, 80, 87, 86],
        bassOptions: [39, 38, 118, 115, 87, 86],
        chordsOptions: [115, 118, 117, 81, 80, 120, 121]
    },
    {
        name: 'Vaporwave',
        scale: 'major',
        root: 'A',
        bpm: 75,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: '80s' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 33, chords: 95 },
        leadOptions: [4, 5, 88, 89, 73, 74, 11, 12, 17, 18, 99, 100],
        bassOptions: [33, 34, 38, 39, 32, 35, 95],
        chordsOptions: [95, 96, 88, 89, 4, 5, 17, 18, 0, 1]
    },
    {
        name: 'Synthwave',
        scale: 'minor',
        root: 'E',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '80s' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 82, 80, 62, 63, 50, 51, 89, 90],
        bassOptions: [38, 39, 33, 34, 81, 82, 87],
        chordsOptions: [90, 88, 89, 81, 80, 50, 51, 62, 63]
    },
    {
        name: 'Darkwave',
        scale: 'phrygian',
        root: 'B',
        bpm: 105,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'electro' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 91 },
        leadOptions: [81, 80, 48, 49, 19, 20, 87, 86, 101, 102],
        bassOptions: [38, 39, 87, 86, 33, 34, 35],
        chordsOptions: [91, 95, 96, 48, 49, 19, 20, 81, 80]
    },
    {
        name: 'Chillwave',
        scale: 'major',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'lofi' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 33, chords: 88 },
        leadOptions: [99, 100, 89, 90, 4, 5, 73, 74, 11, 12, 101],
        bassOptions: [33, 32, 38, 39, 34, 35, 95],
        chordsOptions: [88, 89, 95, 96, 4, 5, 0, 1, 91, 92]
    },
    {
        name: 'Outrun',
        scale: 'minor',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '80s' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 82, 62, 63, 30, 31, 89, 90],
        bassOptions: [38, 39, 81, 87, 33, 34, 35],
        chordsOptions: [90, 89, 81, 80, 50, 51, 62, 63]
    },
    {
        name: 'EBM',
        scale: 'chromatic',
        root: 'C',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'industrial' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 62 },
        leadOptions: [87, 86, 81, 80, 62, 38, 39, 118, 30, 31],
        bassOptions: [38, 39, 87, 86, 33, 34, 118],
        chordsOptions: [62, 63, 87, 86, 81, 80, 30, 31]
    },
    {
        name: 'Future Bass',
        scale: 'major',
        root: 'G',
        bpm: 150,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 73, 74, 56, 11],
        bassOptions: [87, 39, 38, 33, 34, 81],
        chordsOptions: [90, 89, 88, 81, 80, 62, 63, 4, 5]
    },
    {
        name: 'Grime',
        scale: 'phrygian',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'grime' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 118 },
        leadOptions: [87, 86, 81, 80, 62, 63, 11, 2, 73],
        bassOptions: [38, 39, 87, 86, 33, 34, 118],
        chordsOptions: [118, 87, 81, 80, 62, 63]
    },
    {
        name: 'Garage',
        scale: 'minor',
        root: 'A',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sine',
        instruments: { lead: 88, bass: 39, chords: 88 },
        leadOptions: [88, 89, 17, 18, 4, 5, 81, 80, 11, 2, 73],
        bassOptions: [39, 38, 33, 34, 87, 81],
        chordsOptions: [88, 89, 90, 17, 18, 4, 5, 0, 1]
    },
    {
        name: 'Dub',
        scale: 'minor',
        root: 'C',
        bpm: 70,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3] },
            drums: { kit: 'reggae' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 33, chords: 26 },
        leadOptions: [56, 57, 61, 62, 65, 66, 11, 12, 13, 22, 102],
        bassOptions: [33, 34, 32, 35, 38, 39],
        chordsOptions: [26, 27, 24, 25, 4, 5, 17, 18, 102, 103]
    },
    {
        name: 'Dancehall',
        scale: 'minor',
        root: 'G',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 39, chords: 24 },
        leadOptions: [81, 80, 62, 63, 56, 11, 12, 2, 73, 74],
        bassOptions: [39, 38, 87, 86, 33, 34, 35],
        chordsOptions: [24, 25, 88, 89, 4, 5, 17, 18]
    },
    {
        name: 'Soca',
        scale: 'major',
        root: 'C',
        bpm: 155,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soca' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 114 },
        leadOptions: [114, 115, 56, 57, 61, 62, 11, 12, 0, 1],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [114, 115, 0, 1, 4, 5, 56, 57, 11, 12]
    },
    {
        name: 'Calypso',
        scale: 'major',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soca' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 32, chords: 24 },
        leadOptions: [114, 115, 56, 57, 61, 62, 11, 12, 0, 1, 24, 25],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [24, 25, 114, 115, 0, 1, 4, 5]
    },
    {
        name: 'Flamenco',
        scale: 'phrygianDominant',
        root: 'E',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'triangle',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 26, 27, 40, 41, 0, 1],
        bassOptions: [32, 33, 35, 43, 42],
        chordsOptions: [24, 25, 26, 27, 0, 1, 4, 5]
    },
    {
        name: 'Folk Rock',
        scale: 'major',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sine',
        instruments: { lead: 25, bass: 34, chords: 24 },
        leadOptions: [25, 24, 26, 27, 28, 73, 74, 110, 0, 1],
        bassOptions: [34, 33, 32, 35],
        chordsOptions: [24, 25, 26, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'Country Rock',
        scale: 'major',
        root: 'G',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 26, bass: 34, chords: 25 },
        leadOptions: [26, 27, 28, 25, 24, 105, 106, 110, 40, 41],
        bassOptions: [34, 33, 32, 35, 43, 42],
        chordsOptions: [25, 24, 26, 27, 0, 1, 4, 5, 28, 29]
    },
    {
        name: 'Southern Rock',
        scale: 'mixolydian',
        root: 'E',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 31, 28, 27, 26, 25, 18, 19],
        bassOptions: [34, 33, 32, 35, 36, 37],
        chordsOptions: [30, 29, 31, 18, 19, 17, 16, 0, 1]
    },
    {
        name: 'Jam Band',
        scale: 'mixolydian',
        root: 'A',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'funk' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 34, chords: 17 },
        leadOptions: [27, 28, 29, 30, 17, 18, 56, 57, 19, 20],
        bassOptions: [34, 33, 32, 35, 36, 37, 38, 39],
        chordsOptions: [17, 18, 19, 20, 26, 27, 0, 1, 4, 5]
    },
    {
        name: 'Psychedelic Trance',
        scale: 'phrygian',
        root: 'E',
        bpm: 145,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 87 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 102, 103],
        bassOptions: [39, 38, 87, 86, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63, 102, 103]
    },
    {
        name: 'Goa Trance',
        scale: 'phrygian',
        root: 'F#',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 62 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 56],
        bassOptions: [39, 38, 87, 86, 81],
        chordsOptions: [62, 63, 81, 80, 87, 86]
    },
    {
        name: 'Eurodance',
        scale: 'minor',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 50, 51, 11, 12],
        bassOptions: [38, 39, 33, 34, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 0, 1]
    },
    {
        name: 'Happy Hardcore',
        scale: 'major',
        root: 'G',
        bpm: 170,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [2] },
            chords: { oct: [4, 5] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 82, 62, 63, 50, 51, 11, 12, 2],
        bassOptions: [38, 39, 33, 34, 81, 87],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 0, 1, 4, 5]
    },
    {
        name: 'Hardstyle',
        scale: 'minor',
        root: 'F',
        bpm: 150,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 50, 51, 30, 31],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'Jumpstyle',
        scale: 'minor',
        root: 'C',
        bpm: 145,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 30, 31, 11, 12],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63]
    },
    {
        name: 'Gabber',
        scale: 'chromatic',
        root: 'E',
        bpm: 180,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 118 },
        leadOptions: [81, 80, 87, 86, 30, 31, 118, 62, 63],
        bassOptions: [39, 38, 87, 86, 118, 33, 34],
        chordsOptions: [118, 81, 80, 87, 86, 30, 31]
    },
    {
        name: 'Hardcore Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 30, 31, 62, 63],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'Breakcore',
        scale: 'chromatic',
        root: 'D',
        bpm: 190,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'break' }
        },
        wave: 'square',
        instruments: { lead: 118, bass: 39, chords: 81 },
        leadOptions: [118, 81, 80, 87, 86, 62, 63, 30, 31, 120],
        bassOptions: [39, 38, 118, 87, 86, 33, 34],
        chordsOptions: [81, 80, 118, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'IDM',
        scale: 'chromatic',
        root: 'C',
        bpm: 105,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'glitch' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 38, chords: 95 },
        leadOptions: [99, 100, 118, 115, 81, 80, 62, 63, 73, 74, 11],
        bassOptions: [38, 39, 87, 86, 33, 34, 95],
        chordsOptions: [95, 96, 91, 92, 88, 89, 81, 80, 115]
    },
    {
        name: 'Ambient Techno',
        scale: 'minor',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: '909' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 38, chords: 91 },
        leadOptions: [99, 100, 81, 80, 95, 96, 73, 74, 11, 12],
        bassOptions: [38, 39, 95, 94, 33, 34, 87],
        chordsOptions: [91, 92, 95, 96, 88, 89, 48, 49, 81, 80]
    },
    {
        name: 'Minimal Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 115],
        bassOptions: [38, 39, 87, 86, 33, 34],
        chordsOptions: [81, 80, 87, 86, 62, 63]
    },
    {
        name: 'Dub Techno',
        scale: 'minor',
        root: 'C',
        bpm: 124,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 95, bass: 38, chords: 88 },
        leadOptions: [95, 96, 81, 80, 73, 74, 102, 103, 11, 12],
        bassOptions: [38, 39, 33, 34, 87, 86, 95],
        chordsOptions: [88, 89, 95, 96, 81, 80, 17, 18, 4, 5]
    },
    {
        name: 'Deep House',
        scale: 'minor7',
        root: 'G',
        bpm: 122,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 33, chords: 88 },
        leadOptions: [4, 5, 17, 18, 66, 65, 73, 74, 11, 12, 81],
        bassOptions: [33, 34, 38, 39, 32, 35, 87],
        chordsOptions: [88, 89, 4, 5, 17, 18, 0, 1, 95, 96]
    },
    {
        name: 'Tech House',
        scale: 'minor',
        root: 'C',
        bpm: 126,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 88, 89],
        bassOptions: [38, 39, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 88, 89]
    },
    {
        name: 'Progressive House',
        scale: 'minor',
        root: 'E',
        bpm: 128,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 82, 80, 89, 90, 62, 63, 50, 51, 11],
        bassOptions: [38, 39, 33, 34, 87, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 62, 63]
    },
    {
        name: 'Electro House',
        scale: 'minor',
        root: 'A',
        bpm: 128,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 30, 31, 118],
        bassOptions: [39, 38, 87, 86, 33, 34, 81, 80],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'Big Room House',
        scale: 'phrygian',
        root: 'F',
        bpm: 128,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 30, 31, 50, 51],
        bassOptions: [87, 86, 39, 38, 81, 33, 34],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'Future House',
        scale: 'minor',
        root: 'G',
        bpm: 126,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 88, 89, 11, 2],
        bassOptions: [38, 39, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 88, 89, 62, 63]
    },
    {
        name: 'Tropical House',
        scale: 'major',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 33, chords: 4 },
        leadOptions: [114, 115, 73, 74, 11, 12, 66, 65, 4, 5, 0, 1],
        bassOptions: [33, 32, 34, 35, 38, 39, 43],
        chordsOptions: [4, 5, 0, 1, 88, 89, 17, 18, 95, 96]
    },
    {
        name: 'G-House',
        scale: 'phrygian',
        root: 'C',
        bpm: 124,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 87 },
        leadOptions: [87, 86, 81, 80, 62, 63, 11, 2, 118],
        bassOptions: [38, 39, 87, 86, 33, 34, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63]
    },
    {
        name: 'Bass House',
        scale: 'minor',
        root: 'F',
        bpm: 126,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 118, 11, 2],
        bassOptions: [87, 86, 39, 38, 33, 34, 118, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 118]
    },
    {
        name: 'Funky House',
        scale: 'major',
        root: 'G',
        bpm: 126,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 33, chords: 17 },
        leadOptions: [56, 57, 61, 62, 17, 18, 4, 5, 0, 1, 11, 12, 66],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [17, 18, 4, 5, 0, 1, 88, 89, 56, 57]
    },
    {
        name: 'Soulful House',
        scale: 'major7',
        root: 'C',
        bpm: 124,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sine',
        instruments: { lead: 17, bass: 33, chords: 88 },
        leadOptions: [17, 18, 4, 5, 0, 1, 66, 65, 73, 74, 52, 53],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [88, 89, 4, 5, 17, 18, 0, 1, 95, 96]
    },
    {
        name: 'French House',
        scale: 'major',
        root: 'F',
        bpm: 126,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 33, chords: 17 },
        leadOptions: [81, 80, 17, 18, 4, 5, 56, 57, 61, 62, 0, 1],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39, 81],
        chordsOptions: [17, 18, 4, 5, 0, 1, 88, 89, 90, 81]
    },
    {
        name: 'Italo Disco',
        scale: 'major',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 82, 80, 89, 90, 62, 63, 50, 51, 11],
        bassOptions: [38, 39, 33, 34, 81, 82],
        chordsOptions: [90, 88, 89, 81, 80, 50, 51, 0, 1]
    },
    {
        name: 'Hi-NRG',
        scale: 'major',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 50, 51, 2],
        bassOptions: [38, 39, 33, 34, 81, 82, 87],
        chordsOptions: [81, 80, 90, 89, 88, 50, 51, 0, 1]
    },
    {
        name: 'Nu-Disco',
        scale: 'major',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 33, chords: 17 },
        leadOptions: [81, 80, 17, 18, 4, 5, 56, 57, 0, 1, 88, 89],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39, 81],
        chordsOptions: [17, 18, 4, 5, 0, 1, 88, 89, 95, 96, 81]
    },
    {
        name: 'Hard Trance',
        scale: 'minor',
        root: 'E',
        bpm: 145,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 50, 51, 30, 31],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'Progressive Trance',
        scale: 'minor',
        root: 'A',
        bpm: 135,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 95, 96, 11],
        bassOptions: [38, 39, 33, 34, 87, 81, 95],
        chordsOptions: [90, 89, 88, 81, 80, 95, 96, 50, 51]
    },
    {
        name: 'Uplifting Trance',
        scale: 'major',
        root: 'C',
        bpm: 138,
        roles: {
            lead: { oct: [6] },
            bass: { oct: [2] },
            chords: { oct: [4, 5] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 48 },
        leadOptions: [81, 82, 80, 89, 90, 62, 63, 48, 49, 11],
        bassOptions: [38, 39, 33, 34, 81, 82, 87],
        chordsOptions: [48, 49, 50, 51, 90, 89, 88, 81, 80]
    },
    {
        name: 'Vocal Trance',
        scale: 'minor',
        root: 'G',
        bpm: 135,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 52, bass: 38, chords: 90 },
        leadOptions: [52, 53, 54, 81, 80, 89, 90, 62, 63, 11, 2],
        bassOptions: [38, 39, 33, 34, 87, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 48, 49, 50, 51]
    },
    {
        name: 'Acid Techno',
        scale: 'phrygian',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 87, bass: 39, chords: 87 },
        leadOptions: [87, 86, 81, 80, 62, 63, 11, 2, 38, 39],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63]
    },
    {
        name: 'Industrial Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 135,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'industrial' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 118 },
        leadOptions: [87, 86, 81, 80, 62, 63, 118, 30, 31, 102],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 30],
        chordsOptions: [118, 87, 86, 81, 80, 30, 31, 102]
    },
    {
        name: 'Detroit Techno',
        scale: 'minor',
        root: 'C',
        bpm: 128,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 88 },
        leadOptions: [81, 80, 62, 63, 89, 90, 73, 74, 11, 12, 17],
        bassOptions: [38, 39, 33, 34, 87, 81, 82],
        chordsOptions: [88, 89, 90, 81, 80, 17, 18, 4, 5, 0, 1]
    },
    {
        name: 'Berlin Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 81 },
        leadOptions: [87, 86, 81, 80, 62, 63, 11, 2, 115, 118],
        bassOptions: [38, 39, 87, 86, 33, 34, 115],
        chordsOptions: [81, 80, 87, 86, 62, 63, 115, 118]
    },
    {
        name: 'Hard Techno',
        scale: 'chromatic',
        root: 'C',
        bpm: 145,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 30, 31, 118, 11],
        bassOptions: [39, 38, 87, 86, 33, 34, 118, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31, 118]
    },
    {
        name: 'Dubstep',
        scale: 'phrygian',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 39, chords: 87 },
        leadOptions: [87, 86, 81, 80, 62, 63, 118, 11, 2, 73],
        bassOptions: [39, 38, 87, 86, 33, 34, 118, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63, 118]
    },
    {
        name: 'Brostep',
        scale: 'chromatic',
        root: 'F',
        bpm: 145,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 118, 30, 31, 11],
        bassOptions: [87, 86, 39, 38, 33, 34, 118, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 118, 30, 31]
    },
    {
        name: 'Melodic Dubstep',
        scale: 'major',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 90 },
        leadOptions: [81, 80, 89, 90, 62, 63, 48, 49, 11, 2, 73],
        bassOptions: [87, 39, 38, 33, 34, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 62, 63, 48, 49, 0, 1]
    },
    {
        name: 'Riddim',
        scale: 'chromatic',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 39, chords: 87 },
        leadOptions: [87, 86, 81, 80, 62, 63, 118, 11, 2],
        bassOptions: [39, 38, 87, 86, 33, 34, 118, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63, 118]
    },
    {
        name: 'Trap',
        scale: 'minor',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 87, chords: 24 },
        leadOptions: [81, 80, 62, 63, 11, 12, 13, 2, 73, 74, 56],
        bassOptions: [87, 39, 38, 33, 34, 81],
        chordsOptions: [24, 25, 88, 89, 4, 5, 17, 18, 81, 80]
    },
    {
        name: 'Phonk',
        scale: 'minor',
        root: 'F#',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 87, chords: 95 },
        leadOptions: [81, 80, 11, 2, 118, 62, 63, 73, 74, 102],
        bassOptions: [87, 39, 38, 33, 34, 118, 81],
        chordsOptions: [95, 96, 88, 89, 4, 5, 17, 18, 0, 1]
    },
    {
        name: 'Moombahton',
        scale: 'minor',
        root: 'C',
        bpm: 108,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 39, chords: 24 },
        leadOptions: [81, 80, 62, 63, 56, 57, 11, 12, 2, 73, 74],
        bassOptions: [39, 38, 87, 86, 33, 34, 35],
        chordsOptions: [24, 25, 88, 89, 4, 5, 17, 18, 81, 80]
    },
    {
        name: 'Jungle',
        scale: 'minor',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'break' }
        },
        wave: 'sine',
        instruments: { lead: 11, bass: 39, chords: 95 },
        leadOptions: [11, 12, 13, 81, 80, 56, 57, 102, 103, 2, 73],
        bassOptions: [39, 38, 87, 86, 33, 34, 35],
        chordsOptions: [95, 96, 88, 89, 4, 5, 17, 18, 102, 103]
    },
    {
        name: 'Drum and Bass',
        scale: 'minor',
        root: 'F',
        bpm: 174,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'break' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 87 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 50, 51],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [87, 86, 81, 80, 95, 96, 62, 63]
    },
    {
        name: 'Liquid Funk',
        scale: 'major',
        root: 'Bb',
        bpm: 172,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'break' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 33, chords: 88 },
        leadOptions: [66, 65, 73, 74, 11, 12, 4, 5, 0, 1, 17, 18],
        bassOptions: [33, 32, 38, 39, 34, 35, 95],
        chordsOptions: [88, 89, 4, 5, 17, 18, 0, 1, 95, 96]
    },
    {
        name: 'Neurofunk',
        scale: 'chromatic',
        root: 'C',
        bpm: 175,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 87, bass: 38, chords: 118 },
        leadOptions: [87, 86, 81, 80, 62, 63, 118, 11, 2],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 81],
        chordsOptions: [118, 87, 86, 81, 80, 62, 63]
    },
    {
        name: 'Jump-up',
        scale: 'minor',
        root: 'G',
        bpm: 175,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 38, 39],
        bassOptions: [39, 38, 87, 86, 81, 33, 34],
        chordsOptions: [81, 80, 87, 86, 62, 63]
    },
    {
        name: 'Atmospheric DnB',
        scale: 'major',
        root: 'Eb',
        bpm: 170,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'break' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 33, chords: 95 },
        leadOptions: [99, 100, 73, 74, 11, 12, 88, 89, 4, 5, 101],
        bassOptions: [33, 32, 38, 39, 34, 35, 95],
        chordsOptions: [95, 96, 88, 89, 91, 92, 4, 5, 0, 1]
    },
    {
        name: 'Step',
        scale: 'minor',
        root: 'C',
        bpm: 172,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 39, chords: 87 },
        leadOptions: [87, 86, 81, 80, 62, 63, 11, 2],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [87, 86, 81, 80, 62, 63]
    },
    {
        name: 'Darkstep',
        scale: 'phrygian',
        root: 'D',
        bpm: 175,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 39, chords: 118 },
        leadOptions: [81, 80, 87, 86, 118, 30, 31, 19, 20],
        bassOptions: [39, 38, 87, 86, 118, 33, 34],
        chordsOptions: [118, 81, 80, 87, 86, 30, 31]
    },
    {
        name: '2-step',
        scale: 'minor',
        root: 'A',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'garage' }
        },
        wave: 'sine',
        instruments: { lead: 88, bass: 39, chords: 88 },
        leadOptions: [88, 89, 17, 18, 4, 5, 73, 74, 11, 12, 81],
        bassOptions: [39, 38, 33, 34, 87, 81],
        chordsOptions: [88, 89, 17, 18, 4, 5, 0, 1, 95, 96]
    },
    {
        name: 'Speed Garage',
        scale: 'minor',
        root: 'G',
        bpm: 135,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'garage' }
        },
        wave: 'square',
        instruments: { lead: 11, bass: 39, chords: 81 },
        leadOptions: [11, 12, 13, 81, 80, 2, 73, 56, 57],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 88, 89, 4, 5]
    },
    {
        name: 'UK Funky',
        scale: 'major',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 114, bass: 33, chords: 17 },
        leadOptions: [114, 115, 56, 57, 11, 12, 17, 18, 4, 5, 0],
        bassOptions: [33, 34, 32, 35, 38, 39],
        chordsOptions: [17, 18, 4, 5, 0, 1, 114, 115, 88, 89]
    },
    {
        name: 'Future Garage',
        scale: 'minor',
        root: 'F',
        bpm: 130,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'lofi' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 33, chords: 95 },
        leadOptions: [73, 74, 99, 100, 11, 12, 4, 5, 88, 89, 101],
        bassOptions: [33, 32, 38, 39, 34, 35, 95],
        chordsOptions: [95, 96, 88, 89, 4, 5, 0, 1, 91, 92]
    },
    {
        name: 'Grimestep',
        scale: 'phrygian',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'grime' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 118 },
        leadOptions: [87, 86, 81, 80, 62, 63, 11, 2],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 81],
        chordsOptions: [118, 87, 81, 80, 62, 63]
    },
    {
        name: 'Wonky',
        scale: 'chromatic',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 90 },
        leadOptions: [81, 80, 62, 63, 89, 90, 11, 2, 73, 74],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [90, 89, 88, 4, 5, 17, 18, 0, 1]
    },
    {
        name: 'Footwork',
        scale: 'chromatic',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 11, bass: 87, chords: 11 },
        leadOptions: [11, 12, 13, 81, 80, 62, 63, 115, 2],
        bassOptions: [87, 39, 38, 33, 34, 81],
        chordsOptions: [11, 12, 81, 80, 88, 89, 4, 5]
    },
    {
        name: 'Juke',
        scale: 'minor',
        root: 'G',
        bpm: 155,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 11, 12, 13, 62, 63, 2, 73],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 88, 89, 4, 5, 17, 18]
    },
    {
        name: 'Electroclash',
        scale: 'minor',
        root: 'A',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 30, 31, 11],
        bassOptions: [38, 39, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 30, 31]
    },
    {
        name: 'Synthpop',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '80s' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 82, 89, 90, 62, 63, 50, 51, 11, 12],
        bassOptions: [38, 39, 33, 34, 81, 82, 87],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 0, 1, 4, 5]
    },
    {
        name: 'New Romantic',
        scale: 'major',
        root: 'D',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: '80s' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 48 },
        leadOptions: [81, 80, 48, 49, 73, 74, 11, 12, 56, 57, 0, 1],
        bassOptions: [38, 39, 33, 34, 35, 81],
        chordsOptions: [48, 49, 50, 51, 0, 1, 4, 5, 88, 89, 90]
    },
    {
        name: 'Electro',
        scale: 'minor',
        root: 'C',
        bpm: 125,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 11, 2, 118, 120],
        bassOptions: [38, 39, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 118]
    },
    {
        name: 'Freestyle',
        scale: 'minor',
        root: 'A',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 89, 90, 62, 63, 56, 57, 11, 12, 2],
        bassOptions: [38, 39, 33, 34, 81, 87],
        chordsOptions: [90, 89, 88, 81, 80, 4, 5, 0, 1]
    },
    {
        name: 'Eletro Funk',
        scale: 'minor',
        root: 'G',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 39, chords: 81 },
        leadOptions: [81, 80, 87, 86, 62, 63, 56, 57, 11, 12, 2],
        bassOptions: [39, 38, 87, 86, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 17, 18, 4, 5, 0, 1]
    },
    {
        name: 'Miami Bass',
        scale: 'minor',
        root: 'C',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 87, chords: 81 },
        leadOptions: [81, 80, 62, 63, 11, 2, 118, 87, 86],
        bassOptions: [87, 39, 38, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63]
    },
    {
        name: 'Post-punk',
        scale: 'minor',
        root: 'E',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 34, chords: 29 },
        leadOptions: [27, 28, 29, 30, 26, 25, 81, 80, 18, 19],
        bassOptions: [34, 33, 35, 38, 39, 32],
        chordsOptions: [29, 30, 31, 18, 19, 27, 26, 0, 1]
    },
    {
        name: 'Goth Rock',
        scale: 'minor',
        root: 'B',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'electro' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 34, chords: 19 },
        leadOptions: [27, 28, 29, 30, 19, 20, 48, 49, 81, 80, 52],
        bassOptions: [34, 33, 35, 38, 39, 32],
        chordsOptions: [19, 20, 48, 49, 18, 17, 30, 31, 0, 1]
    },
    {
        name: 'Shoegaze',
        scale: 'major',
        root: 'A',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 34, chords: 30 },
        leadOptions: [29, 30, 31, 27, 28, 91, 95, 102, 103, 19, 20],
        bassOptions: [34, 33, 35, 32, 38, 39],
        chordsOptions: [30, 29, 31, 91, 95, 102, 103, 48, 49, 0, 1]
    },
    {
        name: 'Dream Pop',
        scale: 'major',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 99, bass: 33, chords: 95 },
        leadOptions: [99, 100, 73, 74, 11, 12, 88, 89, 4, 5, 0, 1],
        bassOptions: [33, 32, 34, 35, 38, 39, 95],
        chordsOptions: [95, 96, 88, 89, 4, 5, 0, 1, 91, 92, 48, 49]
    },
    {
        name: 'No Wave',
        scale: 'chromatic',
        root: 'C',
        bpm: 135,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'punk' }
        },
        wave: 'square',
        instruments: { lead: 30, bass: 39, chords: 30 },
        leadOptions: [30, 31, 118, 87, 86, 120, 125, 2],
        bassOptions: [39, 38, 34, 35, 87, 86],
        chordsOptions: [30, 31, 118, 87, 86, 18, 19]
    },
    {
        name: 'Noise Rock',
        scale: 'chromatic',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 39, chords: 30 },
        leadOptions: [30, 31, 118, 81, 80, 87, 86, 18, 19],
        bassOptions: [39, 38, 34, 35, 87, 86, 118],
        chordsOptions: [30, 31, 118, 18, 19, 87, 86]
    },
    {
        name: 'Experimental Rock',
        scale: 'chromatic',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 91 },
        leadOptions: [30, 31, 29, 27, 81, 80, 118, 102, 103, 18, 19],
        bassOptions: [34, 33, 35, 38, 39, 87, 86],
        chordsOptions: [91, 95, 102, 103, 30, 31, 18, 19, 0, 1]
    },
    {
        name: 'Art Rock',
        scale: 'major',
        root: 'G',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 34, chords: 48 },
        leadOptions: [0, 1, 4, 5, 56, 57, 65, 66, 73, 74, 11, 12, 19, 20],
        bassOptions: [34, 33, 32, 35, 43, 42],
        chordsOptions: [48, 49, 0, 1, 4, 5, 17, 18, 19, 20]
    },
    {
        name: 'Math Rock',
        scale: 'major',
        root: 'D',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 34, chords: 27 },
        leadOptions: [27, 28, 26, 25, 24, 0, 1, 4, 5, 17, 18],
        bassOptions: [34, 33, 32, 35, 36, 37],
        chordsOptions: [27, 26, 25, 24, 0, 1, 4, 5, 17, 18]
    },
	{
        name: 'Indie Rock',
        scale: 'major',
        root: 'G',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 27, bass: 34, chords: 26 },
        leadOptions: [27, 28, 29, 30, 0, 1, 11, 12, 17, 18],
        bassOptions: [34, 33, 35, 38, 39],
        chordsOptions: [26, 27, 25, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'Indie Pop',
        scale: 'major',
        root: 'C',
        bpm: 118,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 11, bass: 33, chords: 4 },
        leadOptions: [11, 12, 73, 74, 99, 100, 4, 5, 0, 1, 66],
        bassOptions: [33, 34, 32, 35, 38, 39, 95],
        chordsOptions: [4, 5, 0, 1, 17, 18, 88, 89, 95, 96]
    },
    {
        name: 'Britpop',
        scale: 'major',
        root: 'A',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 29, bass: 34, chords: 26 },
        leadOptions: [29, 30, 27, 28, 0, 1, 17, 18, 19, 20],
        bassOptions: [34, 33, 35, 32, 36, 37],
        chordsOptions: [26, 27, 25, 0, 1, 17, 18, 19, 20]
    },
    {
        name: 'Garage Rock',
        scale: 'mixolydian',
        root: 'E',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3] },
            drums: { kit: 'punk' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 29, 31, 18, 19, 27, 28],
        bassOptions: [34, 33, 35, 32],
        chordsOptions: [30, 31, 29, 18, 19, 17, 16]
    },
    {
        name: 'Lo-Fi Indie',
        scale: 'major',
        root: 'G',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'lofi' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 4 },
        leadOptions: [24, 25, 99, 100, 73, 74, 11, 12, 4, 5],
        bassOptions: [32, 33, 38, 39, 34, 35, 95],
        chordsOptions: [4, 5, 17, 18, 0, 1, 95, 96, 24, 25]
    },
    {
        name: 'AfrobeatInMeasure',
        scale: 'mixolydian',
        root: 'C',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 33, chords: 17 },
        leadOptions: [56, 57, 61, 62, 60, 114, 11, 12, 26, 27],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [17, 18, 4, 5, 0, 1, 26, 27, 114, 115]
    },
    {
        name: 'Highlife',
        scale: 'major',
        root: 'F',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 26, bass: 32, chords: 24 },
        leadOptions: [26, 27, 56, 57, 11, 12, 0, 1, 4, 5],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [24, 25, 0, 1, 4, 5, 17, 18, 56, 57]
    },
    {
        name: 'Kwaito',
        scale: 'minor',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'square',
        instruments: { lead: 87, bass: 38, chords: 88 },
        leadOptions: [87, 86, 11, 12, 17, 18, 81, 80, 73, 74],
        bassOptions: [38, 39, 33, 34, 87, 86, 95],
        chordsOptions: [88, 89, 4, 5, 17, 18, 95, 96, 81, 80]
    },
    {
        name: 'Amapiano',
        scale: 'minor7',
        root: 'C',
        bpm: 113,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 4, bass: 38, chords: 88 },
        leadOptions: [4, 5, 11, 12, 17, 18, 81, 80, 73, 74, 56, 57],
        bassOptions: [38, 39, 33, 34, 87, 86, 95],
        chordsOptions: [88, 89, 4, 5, 17, 18, 0, 1, 95, 96]
    },
    {
        name: 'Bossa Nova',
        scale: 'major7',
        root: 'F',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 32, chords: 24 },
        leadOptions: [73, 74, 66, 65, 11, 12, 0, 1, 4, 5, 52, 53],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [24, 25, 0, 1, 4, 5, 17, 18, 88, 89]
    },
    {
        name: 'Samba',
        scale: 'major',
        root: 'G',
        bpm: 100,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 24 },
        leadOptions: [56, 57, 61, 62, 11, 12, 0, 1, 73, 74, 114],
        bassOptions: [32, 33, 34, 35, 38, 39, 43],
        chordsOptions: [24, 25, 0, 1, 4, 5, 114, 115, 17, 18]
    },
    {
        name: 'Cumbia',
        scale: 'minor',
        root: 'C',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 21, bass: 32, chords: 24 },
        leadOptions: [21, 22, 56, 57, 11, 12, 73, 74, 114, 0, 1],
        bassOptions: [32, 33, 34, 35, 38, 39],
        chordsOptions: [24, 25, 0, 1, 4, 5, 17, 18, 21, 22]
    },
    {
        name: 'Reggaeton',
        scale: 'minor',
        root: 'G',
        bpm: 95,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 39, chords: 88 },
        leadOptions: [81, 80, 11, 12, 13, 62, 63, 2, 73, 74, 56],
        bassOptions: [39, 38, 87, 86, 33, 34, 35],
        chordsOptions: [88, 89, 4, 5, 17, 18, 24, 25, 0, 1]
    },
    {
        name: 'Merengue',
        scale: 'major',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 32, chords: 0 },
        leadOptions: [56, 57, 61, 62, 11, 12, 0, 1, 114, 115, 65, 66],
        bassOptions: [32, 33, 34, 35, 38, 39, 43],
        chordsOptions: [0, 1, 4, 5, 17, 18, 24, 25, 56, 57]
    },
    {
        name: 'Bachata',
        scale: 'minor',
        root: 'B',
        bpm: 125,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 24, bass: 32, chords: 24 },
        leadOptions: [24, 25, 26, 27, 0, 1, 4, 5, 11, 12],
        bassOptions: [32, 33, 34, 35, 38, 39, 43],
        chordsOptions: [24, 25, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'Tango',
        scale: 'minor',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'triangle',
        instruments: { lead: 21, bass: 32, chords: 0 },
        leadOptions: [21, 22, 23, 40, 41, 48, 49, 0, 1],
        bassOptions: [32, 33, 35, 43, 42, 38],
        chordsOptions: [0, 1, 4, 5, 17, 18, 21, 22, 48, 49]
    },
    {
        name: 'Mariachi',
        scale: 'major',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'latin' }
        },
        wave: 'sine',
        instruments: { lead: 56, bass: 43, chords: 24 },
        leadOptions: [56, 57, 61, 62, 40, 41, 0, 1, 11, 12],
        bassOptions: [43, 42, 32, 33, 35],
        chordsOptions: [24, 25, 0, 1, 4, 5, 56, 57]
    },
    {
        name: 'K-pop',
        scale: 'major',
        root: 'C',
        bpm: 128,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 89, 90, 62, 63, 50, 51, 11, 12, 2, 73],
        bassOptions: [38, 39, 33, 34, 87, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'J-pop',
        scale: 'major',
        root: 'A',
        bpm: 160,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 34, chords: 90 },
        leadOptions: [81, 80, 29, 30, 62, 63, 50, 51, 11, 12, 2],
        bassOptions: [34, 33, 35, 38, 39, 81, 82],
        chordsOptions: [90, 89, 88, 81, 80, 50, 51, 0, 1, 4, 5, 17, 18, 29, 30]
    },
    {
        name: 'City Pop',
        scale: 'major9',
        root: 'F',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'disco' }
        },
        wave: 'sine',
        instruments: { lead: 62, bass: 33, chords: 88 },
        leadOptions: [62, 63, 66, 65, 73, 74, 11, 12, 17, 18, 4, 5, 0, 1],
        bassOptions: [33, 34, 32, 35, 36, 37, 38, 39],
        chordsOptions: [88, 89, 4, 5, 17, 18, 0, 1, 95, 96, 62, 63]
    },
    {
        name: 'Enka',
        scale: 'minorPentatonic',
        root: 'E',
        bpm: 80,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 32, chords: 48 },
        leadOptions: [40, 41, 73, 74, 11, 12, 105, 106, 110, 0, 1],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [48, 49, 0, 1, 4, 5, 17, 18, 40, 41]
    },
    {
        name: 'Rai',
        scale: 'phrygian',
        root: 'G',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'afro' }
        },
        wave: 'sine',
        instruments: { lead: 21, bass: 38, chords: 88 },
        leadOptions: [21, 22, 56, 57, 11, 12, 81, 80, 2, 73, 74],
        bassOptions: [38, 39, 33, 34, 87, 86, 95],
        chordsOptions: [88, 89, 4, 5, 17, 18, 81, 80, 21, 22]
    },
    {
        name: 'Qawwali',
        scale: 'minor',
        root: 'D',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1] },
            chords: { oct: [3, 4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 52, bass: 95, chords: 20 },
        leadOptions: [52, 53, 54, 55, 11, 12, 73, 74, 21, 22, 102],
        bassOptions: [95, 94, 33, 34, 32, 35],
        chordsOptions: [20, 21, 22, 4, 5, 0, 1, 48, 49, 102, 103]
    },
    {
        name: 'Bhangra',
        scale: 'major',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 104, bass: 39, chords: 81 },
        leadOptions: [104, 105, 106, 56, 57, 11, 12, 81, 80, 2, 73, 74],
        bassOptions: [39, 38, 87, 86, 33, 34, 35],
        chordsOptions: [81, 80, 88, 89, 4, 5, 17, 18, 0, 1]
    },
    {
        name: 'Carnatic',
        scale: 'major',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1] },
            chords: { oct: [4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 95, chords: 95 },
        leadOptions: [40, 41, 110, 111, 73, 74, 11, 12, 105, 52, 53],
        bassOptions: [95, 94, 33, 34, 32, 35],
        chordsOptions: [95, 96, 91, 92, 48, 49, 0, 1, 4, 5]
    },
    {
        name: 'Hindustani',
        scale: 'major',
        root: 'D',
        bpm: 80,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1] },
            chords: { oct: [4] },
            drums: { kit: 'tabla' }
        },
        wave: 'sine',
        instruments: { lead: 104, bass: 95, chords: 95 },
        leadOptions: [104, 105, 106, 11, 12, 73, 74, 40, 41, 52, 53],
        bassOptions: [95, 94, 33, 34, 32, 35],
        chordsOptions: [95, 96, 91, 92, 48, 49, 0, 1, 4, 5]
    },
    {
        name: 'Gamelan',
        scale: 'pentatonic',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'perc' }
        },
        wave: 'sine',
        instruments: { lead: 112, bass: 112, chords: 112 },
        leadOptions: [112, 113, 114, 115, 10, 11, 12, 13, 14, 9, 8],
        bassOptions: [112, 113, 114, 115, 33, 34, 38, 39],
        chordsOptions: [112, 113, 114, 115, 10, 11, 12, 13, 14]
    },
    {
        name: 'Klezmer',
        scale: 'phrygianDominant',
        root: 'D',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'triangle',
        instruments: { lead: 71, bass: 32, chords: 20 },
        leadOptions: [71, 72, 68, 69, 56, 57, 11, 12, 40, 41, 0, 1],
        bassOptions: [32, 33, 34, 35, 43, 42, 38],
        chordsOptions: [20, 21, 22, 0, 1, 4, 5, 17, 18, 48, 49]
    },
    {
        name: 'Celtic',
        scale: 'mixolydian',
        root: 'D',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'sine',
        instruments: { lead: 73, bass: 33, chords: 24 },
        leadOptions: [73, 74, 109, 110, 111, 11, 12, 40, 41, 0, 1, 24, 25],
        bassOptions: [33, 34, 32, 35, 43, 42],
        chordsOptions: [24, 25, 0, 1, 4, 5, 17, 18, 105, 106]
    },
    {
        name: 'Bluegrass',
        scale: 'major',
        root: 'G',
        bpm: 145,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'folk' }
        },
        wave: 'sine',
        instruments: { lead: 105, bass: 32, chords: 105 },
        leadOptions: [105, 106, 26, 27, 24, 25, 110, 111, 0, 1, 40, 41],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [105, 106, 24, 25, 26, 27, 0, 1, 4, 5]
    },
    {
        name: 'Americana',
        scale: 'major',
        root: 'C',
        bpm: 105,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sine',
        instruments: { lead: 25, bass: 34, chords: 24 },
        leadOptions: [25, 24, 26, 27, 105, 106, 110, 111, 73, 74, 0, 1],
        bassOptions: [34, 33, 32, 35, 43, 42],
        chordsOptions: [24, 25, 26, 27, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'Alternative Country',
        scale: 'major',
        root: 'D',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'rock' }
        },
        wave: 'sawtooth',
        instruments: { lead: 26, bass: 34, chords: 25 },
        leadOptions: [26, 27, 28, 25, 24, 30, 31, 105, 106, 110, 0, 1],
        bassOptions: [34, 33, 32, 35, 38, 39],
        chordsOptions: [25, 24, 26, 27, 0, 1, 4, 5, 17, 18, 28, 29]
    },
    {
        name: 'Harsh Noise',
        scale: 'chromatic',
        root: 'C',
        bpm: 160,
        roles: {
            lead: { oct: [4, 5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'industrial' }
        },
        wave: 'square',
        instruments: { lead: 127, bass: 127, chords: 127 },
        leadOptions: [127, 126, 125, 120, 118, 30, 31],
        bassOptions: [127, 87, 86, 118, 39, 38],
        chordsOptions: [127, 126, 118, 87, 86, 30, 31]
    },
    {
        name: 'Power Electronics',
        scale: 'chromatic',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1] },
            chords: { oct: [3] },
            drums: { kit: 'industrial' }
        },
        wave: 'sawtooth',
        instruments: { lead: 118, bass: 87, chords: 118 },
        leadOptions: [118, 120, 127, 87, 86, 30, 31, 52, 53],
        bassOptions: [87, 86, 118, 38, 39, 30],
        chordsOptions: [118, 127, 87, 86, 30, 31]
    },
    {
        name: 'Dark Ambient',
        scale: 'minor',
        root: 'A',
        bpm: 60,
        roles: {
            lead: { oct: [3, 4] },
            bass: { oct: [1] },
            chords: { oct: [2, 3] },
            drums: { kit: 'soft' }
        },
        wave: 'sine',
        instruments: { lead: 95, bass: 95, chords: 91 },
        leadOptions: [95, 96, 102, 103, 11, 12, 118, 120, 125],
        bassOptions: [95, 94, 33, 34, 38, 39, 87],
        chordsOptions: [91, 92, 95, 96, 102, 103, 48, 49, 19, 20]
    },
    {
        name: 'Drone',
        scale: 'chromatic',
        root: 'C',
        bpm: 40,
        roles: {
            lead: { oct: [3] },
            bass: { oct: [1] },
            chords: { oct: [2] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 95, bass: 95, chords: 95 },
        leadOptions: [95, 102, 125, 48, 19, 91],
        bassOptions: [95, 94, 38, 39, 87, 86],
        chordsOptions: [95, 102, 48, 19, 91, 103]
    },
    {
        name: 'Avant-Garde Jazz',
        scale: 'chromatic',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 66, bass: 32, chords: 0 },
        leadOptions: [66, 65, 56, 57, 11, 12, 60, 61, 62, 73, 74, 1],
        bassOptions: [32, 33, 34, 35, 43, 42],
        chordsOptions: [0, 1, 4, 5, 17, 18, 11, 12, 88, 89]
    },
    {
        name: 'Free Improvisation',
        scale: 'chromatic',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [4, 5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'jazz' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 32, chords: 0 },
        leadOptions: [0, 1, 11, 12, 66, 65, 56, 57, 102, 103, 118],
        bassOptions: [32, 33, 35, 43, 34, 38, 39],
        chordsOptions: [0, 1, 4, 5, 17, 18, 11, 12, 48, 49]
    },
    {
        name: 'Vaporwave',
        scale: 'major7',
        root: 'Eb',
        bpm: 85,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 11, bass: 33, chords: 88 },
        leadOptions: [11, 12, 62, 63, 66, 65, 73, 74, 99, 100, 4, 5, 0, 1],
        bassOptions: [33, 32, 38, 39, 34, 35, 95],
        chordsOptions: [88, 89, 95, 96, 4, 5, 17, 18, 0, 1, 62, 63]
    },
    {
        name: 'Hyperpop',
        scale: 'major',
        root: 'C',
        bpm: 155,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 81, bass: 87, chords: 81 },
        leadOptions: [81, 80, 62, 63, 11, 12, 50, 51, 2, 73, 74, 118],
        bassOptions: [87, 86, 39, 38, 33, 34, 81],
        chordsOptions: [81, 80, 87, 86, 62, 63, 88, 89, 90]
    },
    {
        name: 'Symphonic Metal',
        scale: 'minor',
        root: 'E',
        bpm: 135,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 48 },
        leadOptions: [30, 29, 31, 81, 80, 48, 49, 52, 53, 54, 11, 2],
        bassOptions: [34, 33, 35, 38, 39, 87, 86],
        chordsOptions: [48, 49, 50, 51, 52, 53, 30, 31, 19, 20]
    },
    {
        name: 'Gothic Metal',
        scale: 'minor',
        root: 'B',
        bpm: 120,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 19 },
        leadOptions: [30, 31, 29, 19, 20, 48, 49, 52, 53, 81, 80],
        bassOptions: [34, 33, 35, 38, 39, 87],
        chordsOptions: [19, 20, 48, 49, 52, 53, 30, 31, 18, 17]
    },
    {
        name: 'Doom Metal',
        scale: 'minor',
        root: 'C',
        bpm: 70,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 30 },
        leadOptions: [30, 31, 29, 118, 87, 86, 18, 19, 48, 49],
        bassOptions: [34, 33, 35, 38, 39, 87, 86],
        chordsOptions: [30, 31, 118, 18, 19, 48, 49]
    },
    {
        name: 'Industrial Metal',
        scale: 'chromatic',
        root: 'E',
        bpm: 110,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3] },
            drums: { kit: 'industrial' }
        },
        wave: 'square',
        instruments: { lead: 30, bass: 38, chords: 118 },
        leadOptions: [30, 31, 118, 87, 86, 81, 80, 11, 2, 38, 39],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 30, 31],
        chordsOptions: [118, 30, 31, 87, 86, 81, 80]
    },
    {
        name: 'Folk Metal',
        scale: 'minor',
        root: 'A',
        bpm: 125,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 73, bass: 34, chords: 30 },
        leadOptions: [73, 74, 21, 22, 109, 110, 11, 12, 30, 31, 0, 1],
        bassOptions: [34, 33, 35, 38, 39, 87],
        chordsOptions: [30, 31, 21, 22, 0, 1, 4, 5, 17, 18, 48, 49]
    },
    {
        name: 'Viking Metal',
        scale: 'minor',
        root: 'E',
        bpm: 115,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 30, bass: 34, chords: 52 },
        leadOptions: [30, 31, 52, 53, 54, 48, 49, 19, 20, 11, 2],
        bassOptions: [34, 33, 35, 38, 39, 87, 86],
        chordsOptions: [52, 53, 48, 49, 30, 31, 19, 20, 54, 55]
    },
    {
        name: 'Pirate Metal',
        scale: 'minor',
        root: 'G',
        bpm: 140,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'heavy' }
        },
        wave: 'sawtooth',
        instruments: { lead: 21, bass: 34, chords: 30 },
        leadOptions: [21, 22, 11, 12, 30, 31, 56, 57, 61, 62, 0, 1],
        bassOptions: [34, 33, 35, 38, 39, 87, 86],
        chordsOptions: [30, 31, 21, 22, 0, 1, 4, 5, 17, 18]
    },
    {
        name: 'Soundtrack',
        scale: 'major',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 48, bass: 43, chords: 48 },
        leadOptions: [48, 49, 40, 41, 73, 74, 11, 12, 0, 1, 68, 69],
        bassOptions: [43, 42, 32, 33, 35, 95],
        chordsOptions: [48, 49, 50, 51, 52, 53, 0, 1, 4, 5, 91, 92]
    },
    {
        name: 'Film Score',
        scale: 'minor',
        root: 'D',
        bpm: 80,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 40, bass: 43, chords: 48 },
        leadOptions: [40, 41, 48, 49, 52, 53, 11, 12, 73, 74, 0, 1],
        bassOptions: [43, 42, 32, 33, 35, 95, 94],
        chordsOptions: [48, 49, 50, 51, 52, 53, 0, 1, 4, 5, 95, 96]
    },
    {
        name: 'Video Game Music',
        scale: 'major',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 11, 12, 2, 73, 74, 50, 51, 89, 90],
        bassOptions: [38, 39, 33, 34, 87, 81, 82],
        chordsOptions: [81, 80, 88, 89, 90, 4, 5, 0, 1, 17, 18]
    },
    {
        name: 'Chiptune',
        scale: 'major',
        root: 'C',
        bpm: 140,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'none' }
        },
        wave: 'square',
        instruments: { lead: 81, bass: 38, chords: 81 },
        leadOptions: [81, 80, 82, 62, 63, 11, 2],
        bassOptions: [38, 39, 33, 34, 81, 80],
        chordsOptions: [81, 80, 62, 63]
    },
    {
        name: '8-bit',
        scale: 'major',
        root: 'G',
        bpm: 150,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'none' }
        },
        wave: 'square',
        instruments: { lead: 80, bass: 38, chords: 80 },
        leadOptions: [80, 81, 62, 63, 11, 2],
        bassOptions: [38, 39, 80, 81],
        chordsOptions: [80, 81, 62, 63]
    },
    {
        name: '16-bit',
        scale: 'minor',
        root: 'C',
        bpm: 130,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '909' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 38, chords: 90 },
        leadOptions: [81, 80, 89, 90, 11, 12, 56, 57, 62, 63, 73, 74],
        bassOptions: [38, 39, 33, 34, 81, 87],
        chordsOptions: [90, 89, 88, 81, 80, 4, 5, 0, 1, 17, 18]
    },
    {
        name: 'Musique Concrète',
        scale: 'chromatic',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [4, 5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'perc' }
        },
        wave: 'sine',
        instruments: { lead: 120, bass: 125, chords: 102 },
        leadOptions: [120, 121, 122, 123, 124, 125, 126, 127, 118, 115, 102, 103],
        bassOptions: [125, 124, 120, 121, 33, 34, 38, 39, 87, 86, 95],
        chordsOptions: [102, 103, 114, 115, 118, 120, 121, 9, 10, 11, 12]
    },
    {
        name: 'Electronic Art Music',
        scale: 'chromatic',
        root: 'C',
        bpm: 90,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 81, bass: 33, chords: 95 },
        leadOptions: [81, 80, 95, 96, 102, 103, 11, 12, 118, 120, 125],
        bassOptions: [33, 34, 38, 39, 87, 86, 95],
        chordsOptions: [95, 96, 91, 92, 102, 103, 48, 49, 118]
    },
    {
        name: 'Spectral Music',
        scale: 'chromatic',
        root: 'C',
        bpm: 60,
        roles: {
            lead: { oct: [4, 5] },
            bass: { oct: [1] },
            chords: { oct: [3, 4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 95, bass: 95, chords: 95 },
        leadOptions: [95, 96, 102, 103, 91, 92, 120, 125],
        bassOptions: [95, 94, 33, 34, 38, 39, 87],
        chordsOptions: [95, 96, 91, 92, 102, 103, 48, 49, 0, 1]
    },
    {
        name: 'Electroacoustic',
        scale: 'chromatic',
        root: 'C',
        bpm: 100,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 95, bass: 33, chords: 91 },
        leadOptions: [95, 96, 102, 103, 11, 12, 118, 120, 125, 0, 1],
        bassOptions: [33, 34, 38, 39, 87, 86, 95],
        chordsOptions: [91, 92, 95, 96, 102, 103, 48, 49, 118, 0, 1]
    },
    {
        name: 'Sound Art',
        scale: 'chromatic',
        root: 'C',
        bpm: 80,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [3, 4] },
            drums: { kit: 'none' }
        },
        wave: 'sine',
        instruments: { lead: 125, bass: 125, chords: 125 },
        leadOptions: [125, 124, 123, 120, 118, 102, 103, 95, 96, 11, 12],
        bassOptions: [125, 124, 120, 118, 38, 39, 87, 86, 95, 94],
        chordsOptions: [125, 124, 120, 118, 102, 103, 95, 96, 91, 92, 48, 49]
    },
    {
        name: 'Glitch',
        scale: 'chromatic',
        root: 'C',
        bpm: 110,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: 'glitch' }
        },
        wave: 'square',
        instruments: { lead: 120, bass: 38, chords: 118 },
        leadOptions: [120, 125, 118, 115, 87, 86, 81, 80, 11, 2],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 115, 81],
        chordsOptions: [118, 120, 87, 86, 81, 80, 62, 63]
    },
    {
        name: 'Circuit Bending',
        scale: 'chromatic',
        root: 'C',
        bpm: 120,
        roles: {
            lead: { oct: [5, 6] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'glitch' }
        },
        wave: 'square',
        instruments: { lead: 120, bass: 38, chords: 118 },
        leadOptions: [120, 121, 125, 127, 81, 80, 11, 2, 118],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 115, 81],
        chordsOptions: [118, 120, 127, 81, 80, 87, 86]
    },
    {
        name: 'Plunderphonics',
        scale: 'major',
        root: 'C',
        bpm: 115,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [2] },
            chords: { oct: [4] },
            drums: { kit: '808' }
        },
        wave: 'sine',
        instruments: { lead: 0, bass: 33, chords: 0 },
        leadOptions: [0, 1, 11, 12, 17, 18, 4, 5, 56, 57, 65, 66, 73, 74, 118, 120],
        bassOptions: [33, 34, 38, 39, 32, 35, 87, 86, 95],
        chordsOptions: [0, 1, 4, 5, 17, 18, 48, 49, 88, 89, 95, 96, 118]
    },
    {
        name: 'Post-Industrial',
        scale: 'chromatic',
        root: 'C',
        bpm: 105,
        roles: {
            lead: { oct: [5] },
            bass: { oct: [1, 2] },
            chords: { oct: [4] },
            drums: { kit: 'industrial' }
        },
        wave: 'square',
        instruments: { lead: 118, bass: 38, chords: 118 },
        leadOptions: [118, 87, 86, 30, 31, 11, 2, 120, 125, 19, 20],
        bassOptions: [38, 39, 87, 86, 118, 33, 34, 30, 31, 95],
        chordsOptions: [118, 87, 86, 30, 31, 19, 20, 102, 103]
    }
	
	
	
];


        // ==================== GENRE ECA RULES WITH PERCUSSION ====================
        const GENRE_ECA_RULES = {
            'Techno': [110, 51, 102, 90],
            'House': [110, 102, 60, 85],
            'Trance': [110, 51, 150, 94],
            'Drum&Bass': [94, 51, 102, 110],
            'Chiptune': [90, 51, 60, 73],
            'Ambient': [90, 60, 150, 45],
            'Pop': [60, 90, 150, 85],
            'Jazz': [150, 90, 60, 78],
            'Blues': [60, 90, 150, 75],
            'Funk': [90, 102, 60, 95],
            'Bossa Nova': [90, 150, 60, 70],
            'Bluegrass': [90, 60, 150, 80],
            'Dubstep': [30, 51, 94, 102],
            'Experimental': [30, 94, 110, 73],
            'Chinese Classical': [85, 110, 95, 50],
            'Chinese Traditional': [80, 105, 90, 65],
            'Lo-Fi': [94, 60, 102, 70],
            'Rock': [110, 90, 150, 105],
            'Metal': [94, 51, 110, 115],
            'Trap': [94, 51, 102, 96],
            'Cinematic': [73, 126, 150, 85],
            'Indian Raga': [73, 126, 102, 75],
            'Middle Eastern': [73, 126, 102, 82],
            'Afrobeats': [73, 90, 60, 95],
            'Salsa': [90, 60, 150, 98],
            'Reggae': [102, 90, 60, 80],
            'Klezmer': [73, 150, 60, 78],
            'Ribab (Rwira)': [73, 150, 60, 85],
            'Rai': [73, 90, 60, 90],
            'Oriental': [73, 126, 102, 80],
			    'Samba': [90, 102, 60, 110],
    'Tango': [110, 90, 150, 85],
    'Flamenco': [110, 51, 102, 90],
    'Highlife': [90, 60, 150, 95],
    'Soukous': [90, 102, 60, 98],
    'Bhangra': [102, 90, 60, 110],
    'Balkan Brass': [110, 51, 102, 120],
    'Zydeco': [90, 150, 60, 85],
    'Cumbia': [90, 60, 150, 80],
    'Mariachi': [110, 90, 150, 95],
    'Polka': [110, 90, 150, 100],
    'Gospel': [73, 126, 150, 85],
    'Ska': [110, 90, 150, 105],
    'Soca': [90, 102, 60, 100],
    'Juju': [90, 60, 150, 88],
    'Mbalax': [90, 102, 60, 95],
    'Forró': [90, 150, 60, 92],
    'Calypso': [90, 60, 150, 85],
    'Gagaku': [73, 126, 102, 65],
	    'Griot': [73, 126, 102, 80],
    'Qawwali': [73, 126, 150, 85],
    'Fado': [110, 90, 150, 78],
    'Andean': [90, 60, 150, 82],
    'Gregorian Chant': [73, 126, 102, 60],
    'Boogie Woogie': [110, 90, 150, 95],
    'Zydeco': [90, 150, 60, 85],
    'Ska': [110, 90, 150, 105],
    'Motown': [90, 102, 60, 88],
    'Disco': [90, 102, 60, 92],
    'New Wave': [94, 51, 102, 88],
    'Grunge': [110, 90, 150, 100],
    'Trip Hop': [94, 60, 102, 75],
    'Dub': [94, 51, 102, 70],
    'Psychedelic Rock': [110, 90, 150, 95],
    'Baroque': [73, 126, 150, 80],
    'Renaissance': [73, 126, 102, 75],
    'Minimalism': [90, 60, 150, 65],
    'Post Rock': [94, 60, 102, 85],
    'Shoegaze': [94, 51, 102, 90],
    'Noise': [30, 94, 110, 100],
    'Drone': [90, 60, 150, 55],
    'Waltz': [110, 90, 150, 85],
    'March': [110, 90, 150, 95],
    'Sea Shanty': [90, 150, 60, 80],
	    'Swing': [110, 90, 150, 95],
    'Bebop': [150, 90, 60, 100],
    'Cool Jazz': [90, 60, 150, 80],
    'Hard Bop': [110, 90, 150, 98],
    'Free Jazz': [30, 94, 110, 85],
    'Modal Jazz': [90, 60, 150, 82],
    'Jazz Fusion': [94, 51, 102, 92],
    'Smooth Jazz': [90, 60, 150, 78],
    'J-Pop': [90, 102, 60, 88],
    'K-Pop': [94, 51, 102, 90],
    'City Pop': [90, 102, 60, 85],
    'Vaporwave': [94, 60, 102, 70],
    'Future Bass': [94, 51, 102, 95],
    'Witch House': [94, 51, 102, 80],
    'Synthpop': [90, 102, 60, 88],
    'Italo Disco': [90, 102, 60, 90],
    'Eurodance': [90, 102, 60, 95],
    'Hardstyle': [94, 51, 102, 110],
    'Gabber': [30, 94, 110, 120],
    'Psytrance': [94, 51, 102, 100],
    'Goa Trance': [94, 51, 102, 98],
    'Progressive House': [90, 102, 60, 88],
    'Deep House': [90, 60, 150, 82],
    'UK Garage': [94, 51, 102, 90],
    'Footwork': [94, 51, 102, 105],
    'Jungle': [94, 51, 102, 108],
		    'Gypsy Jazz': [110, 90, 150, 95],
    'Mambo': [110, 51, 102, 100],
    'Merengue': [90, 102, 60, 95],
    'Bachata': [90, 60, 150, 85],
    'Son Cubano': [90, 150, 60, 88],
    'Rumba': [90, 60, 150, 82],
    'Guaracha': [110, 51, 102, 98],
    'Cha Cha Cha': [90, 102, 60, 92],
    'Danzón': [73, 126, 150, 80],
    'Bolero': [73, 126, 102, 75],
    'Pachanga': [110, 51, 102, 96],
    'Timba': [94, 51, 102, 95],
    'Charanga': [90, 150, 60, 85],
    'Mozambique': [90, 102, 60, 90],
    'Conga': [90, 102, 60, 92],
    'Bomba': [90, 60, 150, 85],
    'Plena': [90, 150, 60, 88],
    'Guajira': [90, 60, 150, 82],
    'Son Montuno': [90, 150, 60, 90],
    'Guaguancó': [90, 60, 150, 85],
    'Colombia': [73, 126, 102, 80],
    'Yambú': [73, 126, 150, 75],
    'Guarapachangueo': [94, 51, 102, 98],
    'Batá': [90, 60, 150, 85],
    'Iyesá': [90, 60, 150, 82],
    'Makuta': [90, 102, 60, 88],
    'Villancico': [73, 126, 150, 80],
    'Punto Cubano': [73, 126, 102, 75],
    'Tonada': [73, 126, 150, 78],
	 'Chaabi': [60, 73, 90, 110],
    'Rai': [45, 73, 60, 105],
    'Gnawa': [73, 60, 90, 110],
    'Andalusisch': [30, 54, 60, 73],
    'Malhoun': [90, 60, 73, 105],
    'Kabyle': [60, 90, 73, 110],
    'Tuareg': [110, 73, 60, 105],
    'DesertBlues': [105, 73, 90, 110],
    'Shaabi': [110, 60, 73, 105],
    'Mahraganat': [90, 73, 60, 110],
    'Tarab': [30, 54, 60, 73],
    'Dabke': [110, 73, 90, 105],
    'Khaliji': [90, 60, 73, 110],
    'Mugham': [54, 30, 60, 73],
    'PersianPop': [73, 90, 60, 110],
    'Arabesk': [60, 73, 90, 105],
    'Fasi': [30, 54, 60, 90],
    'Hawzi': [60, 73, 90, 105],
    'Mezwed': [110, 90, 73, 105],
    'MusiqueOrientale': [30, 60, 73, 90],
    'SaharanRock': [110, 73, 90, 105],
    'MoorishRock': [105, 73, 90, 110],
    'Izran': [60, 73, 90, 110],
    'AmazighRock': [110, 73, 90, 105],
    'Ahidous': [73, 90, 60, 110],
    'Ahwash': [90, 60, 73, 110],
    'Rwayes': [54, 30, 60, 73],
    'Tagnawit': [73, 90, 60, 110],
    'Taqtoqa': [110, 73, 90, 105],
    'Tindé': [60, 73, 90, 105],
	'Classical': [110, 51, 102, 90],
    'Jazz': [110, 102, 60, 85],
    'Blues': [110, 51, 150, 94],
    'Rock': [94, 51, 102, 110],
    'Metal': [90, 51, 60, 73],
    'Pop': [90, 60, 150, 45],
    'R&B': [110, 102, 60, 85],
    'Soul': [110, 51, 150, 94],
    'Funk': [94, 51, 102, 110],
    'Disco': [90, 51, 60, 73],
    'Reggae': [90, 60, 150, 45],
    'Country': [110, 51, 102, 90],
    'Electronic': [110, 102, 60, 85],
    'Folk': [110, 51, 150, 94],
    'Punk': [94, 51, 102, 110],
    'Indie': [90, 51, 60, 73],
    'Alternative': [90, 60, 150, 45],
    'Ambient': [110, 51, 102, 90],
    'Techno': [110, 102, 60, 85],
    'House': [110, 51, 150, 94],
    'Dubstep': [94, 51, 102, 110],
    'Drum and Bass': [90, 51, 60, 73],
    'Trap': [90, 60, 150, 45],
    'Lo-fi': [110, 51, 102, 90],
    'Synth-pop': [110, 102, 60, 85],
    'Electropop': [110, 51, 150, 94],
    'New Wave': [94, 51, 102, 110],
    'Post-punk': [90, 51, 60, 73],
    'Grunge': [90, 60, 150, 45],
    'Emo': [110, 51, 102, 90],
    'Progressive Rock': [110, 102, 60, 85],
    'Psychedelic Rock': [110, 51, 150, 94],
    'Hard Rock': [94, 51, 102, 110],
    'Heavy Metal': [90, 51, 60, 73],
    'Death Metal': [90, 60, 150, 45],
    'Black Metal': [110, 51, 102, 90],
    'Thrash Metal': [110, 102, 60, 85],
    'Power Metal': [110, 51, 150, 94],
    'Gothic Metal': [94, 51, 102, 110],
    'Industrial': [90, 51, 60, 73],
    'Hardcore': [90, 60, 150, 45],
    'Ska': [110, 51, 102, 90],
    'Reggaeton': [110, 102, 60, 85],
    'Salsa': [110, 51, 150, 94],
    'Bachata': [94, 51, 102, 110],
    'Flamenco': [90, 51, 60, 73],
    'Bossa Nova': [90, 60, 150, 45],
    'Samba': [110, 51, 102, 90],
    'Tango': [110, 102, 60, 85],
    'Opera': [110, 51, 150, 94],
    'Choral': [94, 51, 102, 110],
    'Baroque': [90, 51, 60, 73],
    'Romantic': [90, 60, 150, 45],
    'Modern Classical': [110, 51, 102, 90],
    'Minimalism': [110, 102, 60, 85],
    'Avant-garde': [110, 51, 150, 94],
    'Experimental': [94, 51, 102, 110],
    'Noise': [90, 51, 60, 73],
    'Drone': [90, 60, 150, 45],
    'IDM': [110, 51, 102, 90],
    'Glitch': [110, 102, 60, 85],
    'Breakcore': [110, 51, 150, 94],
    'Hardstyle': [94, 51, 102, 110],
	'Gabber': [90, 51, 60, 73],
    'Eurodance': [90, 60, 150, 45],
    'Trance': [110, 51, 102, 90],
    'Psytrance': [110, 102, 60, 85],
    'Hard Trance': [110, 51, 150, 94],
    'Goa Trance': [94, 51, 102, 110],
    'Dream Trance': [90, 51, 60, 73],
    'Progressive Trance': [90, 60, 150, 45],
    'Deep House': [110, 51, 102, 90],
    'Tech House': [110, 102, 60, 85],
    'Acid House': [110, 51, 150, 94],
    'Tropical House': [94, 51, 102, 110],
    'Future House': [90, 51, 60, 73],
    'G-House': [90, 60, 150, 45],
    'Electro House': [110, 51, 102, 90],
    'Big Room': [110, 102, 60, 85],
    'Hard Techno': [110, 51, 150, 94],
    'Minimal Techno': [94, 51, 102, 110],
    'Dub Techno': [90, 51, 60, 73],
    'Acid Techno': [90, 60, 150, 45],
    'Detroit Techno': [110, 51, 102, 90],
    'Liquid Funk': [110, 102, 60, 85],
    'Neurofunk': [110, 51, 150, 94],
    'Jump Up': [94, 51, 102, 110],
    'Jungle': [90, 51, 60, 73],
    'Ragga Jungle': [90, 60, 150, 45],
    'UK Garage': [110, 51, 102, 90],
    '2-Step': [110, 102, 60, 85],
    'Grime': [110, 51, 150, 94],
    'Future Bass': [94, 51, 102, 110],
    'Vaporwave': [90, 51, 60, 73],
    'Synthwave': [90, 60, 150, 45],
    'Chillwave': [110, 51, 102, 90],
    'Darkwave': [110, 102, 60, 85],
    'EBM': [110, 51, 150, 94],
    'Futurepop': [94, 51, 102, 110],
    'Aggrotech': [90, 51, 60, 73],
    'Downtempo': [90, 60, 150, 45],
    'Trip Hop': [110, 51, 102, 90],
    'Psybient': [110, 102, 60, 85],
    'Illbient': [110, 51, 150, 94],
    'Ambient House': [94, 51, 102, 110],
    'Ambient Techno': [90, 51, 60, 73],
    'Dark Ambient': [90, 60, 150, 45],
    'New Age': [110, 51, 102, 90],
    'Space Music': [110, 102, 60, 85],
    'World Music': [110, 51, 150, 94],
    'AfrobeatInMeasure': [94, 51, 102, 110],
    'Ethno Jazz': [90, 51, 60, 73],
    'Latin Jazz': [90, 60, 150, 45],
    'Cool Jazz': [110, 51, 102, 90],
    'Bebop': [110, 102, 60, 85],
    'Hard Bop': [110, 51, 150, 94],
    'Free Jazz': [94, 51, 102, 110],
    'Jazz Fusion': [90, 51, 60, 73],
    'Smooth Jazz': [90, 60, 150, 45],
    'Swing': [110, 51, 102, 90],
    'Big Band': [110, 102, 60, 85],
    'Ragtime': [110, 51, 150, 94],
    'Boogie-woogie': [94, 51, 102, 110],
    'Dixieland': [90, 51, 60, 73],
    'Delta Blues': [90, 60, 150, 45],
    'Chicago Blues': [110, 51, 102, 90],
    'Texas Blues': [110, 102, 60, 85],
	'Jump Blues': [110, 51, 150, 94],
    'Electric Blues': [94, 51, 102, 110],
    'Blues Rock': [90, 51, 60, 73],
    'Southern Rock': [90, 60, 150, 45],
    'Rock and Roll': [110, 51, 102, 90],
    'Rockabilly': [110, 102, 60, 85],
    'Surf Rock': [110, 51, 150, 94],
    'Garage Rock': [94, 51, 102, 110],
    'Glam Rock': [90, 51, 60, 73],
    'Soft Rock': [90, 60, 150, 45],
    'Hard Rock (Alternative)': [110, 51, 102, 90],
    'Arena Rock': [110, 102, 60, 85],
    'Gothic Rock': [110, 51, 150, 94],
    'Shoegaze': [94, 51, 102, 110],
    'Dream Pop': [90, 51, 60, 73],
    'Jangle Pop': [90, 60, 150, 45],
    'Power Pop': [110, 51, 102, 90],
    'Britpop': [110, 102, 60, 85],
    'Madchester': [110, 51, 150, 94],
    'Post-rock': [94, 51, 102, 110],
    'Math Rock': [90, 51, 60, 73],
    'Krautrock': [90, 60, 150, 45],
    'Space Rock': [110, 51, 102, 90],
    'Stoner Rock': [110, 102, 60, 85],
    'Desert Rock': [110, 51, 150, 94],
    'Sludge Metal': [94, 51, 102, 110],
    'Doom Metal': [90, 51, 60, 73],
    'Symphonic Metal': [90, 60, 150, 45],
    'Folk Metal': [110, 51, 102, 90],
    'Viking Metal': [110, 102, 60, 85],
    'Pirate Metal': [110, 51, 150, 94],
    'Nu Metal': [94, 51, 102, 110],
    'Metalcore': [90, 51, 60, 73],
    'Deathcore': [90, 60, 150, 45],
    'Grindcore': [110, 51, 102, 90],
    'Pop Punk': [110, 102, 60, 85],
    'Skate Punk': [110, 51, 150, 94],
    'Hardcore Punk': [94, 51, 102, 110],
    'Post-hardcore': [90, 51, 60, 73],
    'Screamo': [90, 60, 150, 45],
    'Crust Punk': [110, 51, 102, 90],
    'Anarcho-punk': [110, 102, 60, 85],
    'Psychobilly': [110, 51, 150, 94],
    'Horrorpunk': [94, 51, 102, 110],
    'Oi!': [90, 51, 60, 73],
    'Street Punk': [90, 60, 150, 45],
    'Ska Punk': [110, 51, 102, 90],
    'Reggae Rock': [110, 102, 60, 85],
    'Dancehall': [110, 51, 150, 94],
    'Dub': [94, 51, 102, 110],
    'Lovers Rock': [90, 51, 60, 73],
    'Roots Reggae': [90, 60, 150, 45],
    'Ska (Second Wave)': [110, 51, 102, 90],
    'Rocksteady': [110, 102, 60, 85],	
	'Bluegrass': [110, 51, 150, 94],
    'Americana': [94, 51, 102, 110],
    'Alt-country': [90, 51, 60, 73],
    'Honky-tonk': [90, 60, 150, 45],
    'Western Swing': [110, 51, 102, 90],
    'Outlaw Country': [110, 102, 60, 85],
    'Contemporary Country': [110, 51, 150, 94],
    'Celtic Folk': [94, 51, 102, 110],
    'Chanson': [90, 51, 60, 73],
    'Fado': [90, 60, 150, 45],
    'Flamenco (Modern)': [110, 51, 102, 90],
    'Enka': [110, 102, 60, 85],
    'K-pop': [110, 51, 150, 94],
    'J-pop': [94, 51, 102, 110],
    'C-pop': [90, 51, 60, 73],
    'V-pop': [90, 60, 150, 45],
    'Cantopop': [110, 51, 102, 90],
    'Mandopop': [110, 102, 60, 85],
    'Latin Pop': [110, 51, 150, 94],
    'Reggaeton (Modern)': [94, 51, 102, 110],
    'Salsa (Modern)': [90, 51, 60, 73],
    'Merengue': [90, 60, 150, 45],
    'Cumbia': [110, 51, 102, 90],
    'Bachata (Modern)': [110, 102, 60, 85],
    'Mariachi': [110, 51, 150, 94],
    'Ranchera': [94, 51, 102, 110],
    'Bolero': [90, 51, 60, 73],
    'Bossanova (Modern)': [90, 60, 150, 45],
    'Samba (Modern)': [110, 51, 102, 90],
    'MPB': [110, 102, 60, 85],
    'Tropicália': [110, 51, 150, 94],
    'Calypso': [94, 51, 102, 110],
    'Soca': [90, 51, 60, 73],
    'Zouk': [90, 60, 150, 45],
    'Kizomba': [110, 51, 102, 90],
    'Kuduro': [110, 102, 60, 85],
    'Mbaqanga': [110, 51, 150, 94],
    'Highlife': [94, 51, 102, 110],
    'Desert Blues': [90, 51, 60, 73],
    'Gnawa': [90, 60, 150, 45],
    'Rai': [110, 51, 102, 90],
    'Qawwali': [110, 102, 60, 85],
    'Hindustani': [110, 51, 150, 94],
    'Carnatic': [94, 51, 102, 110],
    'Thai Pop': [90, 51, 60, 73],
    'Luk Thung': [90, 60, 150, 45],
    'Dangdut': [110, 51, 102, 90],
    'V-pop (Contemporary)': [110, 102, 60, 85],
    'P-pop': [110, 51, 150, 94],
    'Anison': [94, 51, 102, 110],
    'Video Game Music': [90, 51, 60, 73],
    'Chiptune': [90, 60, 150, 45],
    'Soundtrack': [110, 51, 102, 90],
    'Film Score': [110, 102, 60, 85],
    'Production Music': [110, 51, 150, 94],
    'Trailer Music': [94, 51, 102, 110],
    'Holiday Music': [90, 51, 60, 73],
    'Christian Music': [90, 60, 150, 45],
    'Gospel': [110, 51, 102, 90],
    'Contemporary Christian': [110, 102, 60, 85],
    'Children\'s Music': [110, 51, 150, 94],
    'Comedy Music': [94, 51, 102, 110],
    'Novelty Music': [90, 51, 60, 73],
    'Plunderphonics': [90, 60, 150, 45]
	
        };

        const GENRE_PERCUSSION = {
            'soft': [36, 40, 42],
            'orchestral': [35, 40, 42],
            'electro': [36, 39, 42],
            '909': [36, 38, 42],
            '707': [36, 40, 42],
            'amen': [36, 38, 42],
            'heavy': [35, 38, 42],
            'boom-bap': [36, 40, 42],
            '808': [36, 39, 42],
            'pop': [36, 38, 42],
            'rock': [35, 38, 42],
            'metal': [35, 38, 42],
            'jazz': [35, 40, 42],
            'blues': [36, 38, 42],
            'funk': [36, 39, 42],
            'reggae': [36, 38, 42],
            'afro': [36, 42, 54],
            'latin': [36, 42, 54],
            'bossa': [36, 38, 42],
            'folk': [35, 38, 42],
            'tabla': [66, 60, 62],
            'daf': [35, 60, 54],
            'lofi': [36, 38, 42],
            'glitch': [36, 38, 42],
            'chinese': [60, 62, 54],
            'chinese_traditional': [60, 62, 77],
            'chips': [36, 38, 42],			
    'samba': [36, 38, 54],
    'tango': [36, 40, 42],
    'flamenco': [36, 37, 39],
    'highlife': [36, 38, 42],
    'soukous': [36, 38, 42],
    'bhangra': [36, 42, 54],
    'balkan': [36, 38, 42],
    'zydeco': [36, 38, 42],
    'cumbia': [36, 38, 42],
    'mariachi': [36, 38, 42],
    'polka': [36, 38, 42],
    'gospel': [36, 38, 42],
    'ska': [36, 38, 42],
    'soca': [36, 38, 42],
    'juju': [36, 38, 54],
    'mbalax': [36, 38, 54],
    'forro': [36, 38, 42],
    'calypso': [36, 38, 42],
    'gagaku': [66, 60, 77],
	    'griot': [36, 54, 77],
    'qawwali': [66, 60, 62],
    'fado': [36, 38, 42],
    'andean': [36, 54, 115],
    'chant': [47, 55, 14],
    'boogie': [36, 38, 42],
    'zydeco': [36, 38, 42],
    'ska': [36, 38, 42],
    'motown': [36, 38, 42],
    'disco': [36, 38, 42],
    'newwave': [36, 38, 42],
    'grunge': [36, 38, 42],
    'triphop': [36, 38, 42],
    'dub': [36, 38, 42],
    'psych': [36, 38, 42],
    'baroque': [47, 46, 14],
    'renaissance': [47, 46, 13],
    'minimal': [36, 38, 42],
    'postrock': [36, 38, 42],
    'shoegaze': [36, 38, 42],
    'noise': [36, 38, 118],
    'drone': [47, 55, 14],
    'waltz': [36, 38, 42],
    'march': [36, 38, 47],
    'shanty': [36, 38, 42],
	    'swing': [36, 38, 42],
    'bebop': [36, 38, 42],
    'cooljazz': [36, 38, 42],
    'hardbop': [36, 38, 42],
    'freejazz': [36, 38, 42],
    'modaljazz': [36, 38, 42],
    'fusion': [36, 38, 42],
    'smoothjazz': [36, 38, 42],
    'jpop': [36, 38, 42],
    'kpop': [36, 38, 42],
    'citypop': [36, 38, 42],
    'vaporwave': [36, 38, 42],
    'futurebass': [36, 38, 42],
    'witchhouse': [36, 38, 42],
    'synthpop': [36, 38, 42],
    'italo': [36, 38, 42],
    'eurodance': [36, 38, 42],
    'hardstyle': [36, 38, 42],
    'gabber': [36, 38, 42],
    'psytrance': [36, 38, 42],
    'goa': [36, 38, 42],
    'proghouse': [36, 38, 42],
    'deephouse': [36, 38, 42],
    'ukgarage': [36, 38, 42],
    'footwork': [36, 38, 42],
    'jungle': [36, 38, 42],
	    'gypsy': [36, 38, 42],
    'mambo': [36, 42, 54],
    'merengue': [36, 38, 42],
    'bachata': [36, 38, 42],
    'son': [36, 38, 42],
    'rumba': [36, 42, 54],
    'guaracha': [36, 38, 42],
    'chacha': [36, 38, 42],
    'danzon': [36, 38, 42],
    'bolero': [36, 38, 42],
    'pachanga': [36, 38, 42],
    'timba': [36, 38, 42],
    'charanga': [36, 38, 42],
    'mozambique': [36, 42, 54],
    'conga': [36, 42, 54],
    'bomba': [36, 42, 54],
    'plena': [36, 38, 42],
    'guajira': [36, 38, 42],
    'montuno': [36, 38, 42],
    'guaguanco': [36, 42, 54],
    'colombia': [36, 42, 54],
    'yambu': [36, 42, 54],
    'guarapachangueo': [36, 42, 54],
    'bata': [36, 42, 54],
    'iyesa': [36, 42, 54],
    'makuta': [36, 42, 54],
    'villancico': [36, 38, 42],
    'punto': [36, 38, 42],
    'tonada': [36, 38, 42],
    'darbuka': [36, 38, 42],          // Goblet drum
    'bendir': [54, 56, 60],           // Frame drum with snare
    'taarija': [37, 39, 43],          // Moroccan clay drum
    'tabla': [60, 62, 64],            // Indian tabla
    'riqq': [65, 66, 67],             // Tambourine
    'rockkit': [36, 38, 42],          // Standard rock kit
    'electronic': [80, 81, 82],       // Electronic beats
    'tbel': [75, 76, 77],             // Large Berber drum
    'qraqeb': [70, 71, 72],           // Metal castanets
    'ney': [73, 74, 75],              // Flute breaths
    'oud': [25, 26, 27],              // Lute plucks
    'kanun': [28, 29, 30],            // Zither plucks
    'neyzan': [76, 77, 78],           // Double flute
    'gasba': [79, 80, 81],            // Reed flute
    'guembri': [31, 32, 33],          // Bass lute
    'lotar': [34, 35, 36],            // Berber lute
    'zurna': [82, 83, 84],            // Shawm
    'mizmar': [85, 86, 87],           // Double-reed
    'rabab': [37, 38, 39],            // Spike fiddle
    'violin': [40, 41, 42],           // Violin
    'accordion': [43, 44, 45],        // Accordion
    'synthesizer': [88, 89, 90],      // Synth
    'chant': [91, 92, 93],            // Vocal chant
    'handclap': [39, 40, 41],         // Hand claps
    'fingercymbals': [42, 43, 44],    // Small cymbals
    'waterdrum': [45, 46, 47],        // Water drum
    'windchimes': [94, 95, 96],       // Wind chimes
    'thunder': [97, 98, 99],          // Thunder
    'rain': [100, 101, 102],           // Rain
	'Classical': [35, 40, 42],
    'Jazz': [36, 40, 42],
    'Blues': [36, 38, 42],
    'Rock': [36, 38, 42],
    'Metal': [35, 38, 42],
    'Pop': [36, 40, 42],
    'R&B': [36, 40, 42],
    'Soul': [36, 38, 42],
    'Funk': [36, 38, 42],
    'Disco': [36, 38, 42],
    'Reggae': [36, 40, 42],
    'Country': [36, 38, 42],
    'Electronic': [36, 39, 42],
    'Folk': [36, 40, 42],
    'Punk': [36, 38, 42],
    'Indie': [36, 40, 42],
    'Alternative': [36, 38, 42],
    'Ambient': [36, 40, 42],
    'Techno': [36, 38, 42],
    'House': [36, 38, 42],
    'Dubstep': [35, 38, 42],
    'Drum and Bass': [36, 38, 42],
    'Trap': [36, 39, 42],
    'Lo-fi': [36, 40, 42],
    'Synth-pop': [36, 39, 42],
    'Electropop': [36, 40, 42],
    'New Wave': [36, 40, 42],
    'Post-punk': [36, 38, 42],
    'Grunge': [36, 38, 42],
    'Emo': [36, 38, 42],
    'Progressive Rock': [36, 38, 42],
    'Psychedelic Rock': [36, 38, 42],
    'Hard Rock': [35, 38, 42],
    'Heavy Metal': [35, 38, 42],
    'Death Metal': [35, 38, 42],
    'Black Metal': [35, 38, 42],
    'Thrash Metal': [35, 38, 42],
    'Power Metal': [35, 38, 42],
    'Gothic Metal': [35, 38, 42],
    'Industrial': [36, 38, 42],
    'Hardcore': [36, 38, 42],
    'Ska': [36, 38, 42],
    'Reggaeton': [36, 39, 42],
    'Salsa': [36, 40, 42],
    'Bachata': [36, 40, 42],
    'Flamenco': [36, 40, 42],
    'Bossa Nova': [36, 40, 42],
    'Samba': [36, 40, 42],
    'Tango': [36, 40, 42],
    'Opera': [35, 40, 42],
    'Choral': [35, 40, 42],
    'Baroque': [35, 40, 42],
    'Romantic': [35, 40, 42],
    'Modern Classical': [35, 40, 42],
    'Minimalism': [36, 40, 42],
    'Avant-garde': [36, 40, 42],
    'Experimental': [36, 40, 42],
    'Noise': [35, 38, 42],
    'Drone': [36, 40, 42],
    'IDM': [36, 39, 42],
    'Glitch': [36, 39, 42],
    'Breakcore': [36, 38, 42],
    'Hardstyle': [35, 38, 42],
	'Gabber': [35, 38, 42],
    'Eurodance': [36, 38, 42],
    'Trance': [36, 38, 42],
    'Psytrance': [36, 38, 42],
    'Hard Trance': [36, 38, 42],
    'Goa Trance': [36, 38, 42],
    'Dream Trance': [36, 40, 42],
    'Progressive Trance': [36, 38, 42],
    'Deep House': [36, 38, 42],
    'Tech House': [36, 38, 42],
    'Acid House': [36, 38, 42],
    'Tropical House': [36, 40, 42],
    'Future House': [36, 38, 42],
    'G-House': [36, 39, 42],
    'Electro House': [36, 39, 42],
    'Big Room': [35, 38, 42],
    'Hard Techno': [35, 38, 42],
    'Minimal Techno': [36, 38, 42],
    'Dub Techno': [36, 40, 42],
    'Acid Techno': [36, 38, 42],
    'Detroit Techno': [36, 38, 42],
    'Liquid Funk': [36, 40, 42],
    'Neurofunk': [36, 38, 42],
    'Jump Up': [36, 38, 42],
    'Jungle': [36, 38, 42],
    'Ragga Jungle': [36, 38, 42],
    'UK Garage': [36, 38, 42],
    '2-Step': [36, 38, 42],
    'Grime': [36, 39, 42],
    'Future Bass': [36, 39, 42],
    'Vaporwave': [36, 40, 42],
    'Synthwave': [36, 39, 42],
    'Chillwave': [36, 40, 42],
    'Darkwave': [36, 38, 42],
    'EBM': [36, 38, 42],
    'Futurepop': [36, 40, 42],
    'Aggrotech': [35, 38, 42],
    'Downtempo': [36, 40, 42],
    'Trip Hop': [36, 39, 42],
    'Psybient': [36, 40, 42],
    'Illbient': [36, 40, 42],
    'Ambient House': [36, 40, 42],
    'Ambient Techno': [36, 40, 42],
    'Dark Ambient': [36, 40, 42],
    'New Age': [36, 40, 42],
    'Space Music': [36, 40, 42],
    'World Music': [36, 40, 42],
    'AfrobeatInMeasure': [36, 38, 42],
    'Ethno Jazz': [36, 40, 42],
    'Latin Jazz': [36, 40, 42],
    'Cool Jazz': [36, 40, 42],
    'Bebop': [36, 38, 42],
    'Hard Bop': [36, 38, 42],
    'Free Jazz': [36, 40, 42],
    'Jazz Fusion': [36, 38, 42],
    'Smooth Jazz': [36, 40, 42],
    'Swing': [36, 40, 42],
    'Big Band': [36, 40, 42],
    'Ragtime': [36, 40, 42],
    'Boogie-woogie': [36, 38, 42],
    'Dixieland': [36, 40, 42],
    'Delta Blues': [36, 38, 42],
    'Chicago Blues': [36, 38, 42],
    'Texas Blues': [36, 38, 42],
	'Jump Blues': [36, 38, 42],
    'Electric Blues': [36, 38, 42],
    'Blues Rock': [36, 38, 42],
    'Southern Rock': [36, 38, 42],
    'Rock and Roll': [36, 38, 42],
    'Rockabilly': [36, 38, 42],
    'Surf Rock': [36, 38, 42],
    'Garage Rock': [36, 38, 42],
    'Glam Rock': [36, 38, 42],
    'Soft Rock': [36, 40, 42],
    'Hard Rock (Alternative)': [35, 38, 42],
    'Arena Rock': [36, 38, 42],
    'Gothic Rock': [36, 38, 42],
    'Shoegaze': [36, 40, 42],
    'Dream Pop': [36, 40, 42],
    'Jangle Pop': [36, 40, 42],
    'Power Pop': [36, 40, 42],
    'Britpop': [36, 40, 42],
    'Madchester': [36, 38, 42],
    'Post-rock': [36, 40, 42],
    'Math Rock': [36, 38, 42],
    'Krautrock': [36, 38, 42],
    'Space Rock': [36, 38, 42],
    'Stoner Rock': [35, 38, 42],
    'Desert Rock': [36, 38, 42],
    'Sludge Metal': [35, 38, 42],
    'Doom Metal': [35, 38, 42],
    'Symphonic Metal': [35, 38, 42],
    'Folk Metal': [35, 38, 42],
    'Viking Metal': [35, 38, 42],
    'Pirate Metal': [35, 38, 42],
    'Nu Metal': [35, 38, 42],
    'Metalcore': [35, 38, 42],
    'Deathcore': [35, 38, 42],
    'Grindcore': [35, 38, 42],
    'Pop Punk': [36, 38, 42],
    'Skate Punk': [36, 38, 42],
    'Hardcore Punk': [36, 38, 42],
    'Post-hardcore': [36, 38, 42],
    'Screamo': [36, 38, 42],
    'Crust Punk': [36, 38, 42],
    'Anarcho-punk': [36, 38, 42],
    'Psychobilly': [36, 38, 42],
    'Horrorpunk': [36, 38, 42],
    'Oi!': [36, 38, 42],
    'Street Punk': [36, 38, 42],
    'Ska Punk': [36, 38, 42],
    'Reggae Rock': [36, 40, 42],
    'Dancehall': [36, 39, 42],
    'Dub': [36, 40, 42],
    'Lovers Rock': [36, 40, 42],
    'Roots Reggae': [36, 40, 42],
    'Ska (Second Wave)': [36, 38, 42],
    'Rocksteady': [36, 40, 42],
	'Bluegrass': [36, 40, 42],
    'Americana': [36, 38, 42],
    'Alt-country': [36, 38, 42],
    'Honky-tonk': [36, 38, 42],
    'Western Swing': [36, 40, 42],
    'Outlaw Country': [36, 38, 42],
    'Contemporary Country': [36, 38, 42],
    'Celtic Folk': [36, 40, 42],
    'Chanson': [36, 40, 42],
    'Fado': [36, 40, 42],
    'Flamenco (Modern)': [36, 40, 42],
    'Enka': [36, 40, 42],
    'K-pop': [36, 39, 42],
    'J-pop': [36, 40, 42],
    'C-pop': [36, 40, 42],
    'V-pop': [36, 40, 42],
    'Cantopop': [36, 40, 42],
    'Mandopop': [36, 40, 42],
    'Latin Pop': [36, 40, 42],
    'Reggaeton (Modern)': [36, 39, 42],
    'Salsa (Modern)': [36, 40, 42],
    'Merengue': [36, 40, 42],
    'Cumbia': [36, 40, 42],
    'Bachata (Modern)': [36, 40, 42],
    'Mariachi': [36, 40, 42],
    'Ranchera': [36, 40, 42],
    'Bolero': [36, 40, 42],
    'Bossanova (Modern)': [36, 40, 42],
    'Samba (Modern)': [36, 40, 42],
    'MPB': [36, 40, 42],
    'Tropicália': [36, 38, 42],
    'Calypso': [36, 40, 42],
    'Soca': [36, 40, 42],
    'Zouk': [36, 40, 42],
    'Kizomba': [36, 40, 42],
    'Kuduro': [36, 39, 42],
    'Mbaqanga': [36, 38, 42],
    'Highlife': [36, 38, 42],
    'Desert Blues': [36, 38, 42],
    'Gnawa': [36, 40, 42],
    'Rai': [36, 38, 42],
    'Qawwali': [36, 40, 42],
    'Hindustani': [35, 40, 42],
    'Carnatic': [35, 40, 42],
    'Thai Pop': [36, 40, 42],
    'Luk Thung': [36, 40, 42],
    'Dangdut': [36, 38, 42],
    'V-pop (Contemporary)': [36, 40, 42],
    'P-pop': [36, 40, 42],
    'Anison': [36, 39, 42],
    'Video Game Music': [36, 39, 42],
    'Chiptune': [36, 39, 42],
    'Soundtrack': [35, 40, 42],
    'Film Score': [35, 40, 42],
    'Production Music': [36, 40, 42],
    'Trailer Music': [35, 38, 42],
    'Holiday Music': [36, 40, 42],
    'Christian Music': [36, 40, 42],
    'Gospel': [36, 38, 42],
    'Contemporary Christian': [36, 40, 42],
    'Children\'s Music': [36, 40, 42],
    'Comedy Music': [36, 40, 42],
    'Novelty Music': [36, 40, 42],
    'Plunderphonics': [36, 39, 42]
	
        };
		
		
		const GENRE_PERCUSSION_ONS = {
    'soft': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 2), 0.3],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7]
    ],
    'orchestral': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 8), 0.8]
    ],
    'electro': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.2],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 && Math.random() < 0.7), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 3 && Math.random() < 0.5)), 0.6]
    ],
    '909': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.25],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.75]
    ],
    '707': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'amen': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.15],
        [(beatInMeasure) => (beatInMeasure % 8 === 2 || beatInMeasure % 8 === 6), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.6]
    ],
    'heavy': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || beatInMeasure % 8 === 3), 0.9]
    ],
    'boom-bap': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.6), 0.35],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.65],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.4)), 0.8]
    ],
    '808': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.2],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || (beatInMeasure % 8 === 6 && Math.random() < 0.3)), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || (beatInMeasure % 16 === 11 && Math.random() < 0.5)), 0.9]
    ],
    'pop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'rock': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.6)), 0.8]
    ],
    'metal': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.7), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || (beatInMeasure % 4 === 1 && Math.random() < 0.5)), 0.9]
    ],
    'jazz': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.7), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 4 === 3), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 4), 0.7]
    ],
    'blues': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.3)), 0.7]
    ],
    'funk': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.8), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || (beatInMeasure % 8 === 4 && Math.random() < 0.5)), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || beatInMeasure % 8 === 3), 0.7]
    ],
    'reggae': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 3), 0.8]
    ],
    'afro': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'latin': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.7]
    ],
    'bossa': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.25],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.6]
    ],
    'folk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'tabla': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 8 || beatInMeasure % 16 === 12), 0.8]
    ],
    'daf': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.7]
    ],
    'lofi': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.6), 0.25],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 && Math.random() < 0.8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 && Math.random() < 0.9), 0.6]
    ],
    'glitch': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.3), 0.2],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || (beatInMeasure % 8 === 5 && Math.random() < 0.4)), 0.4],
        [(beatInMeasure) => ((beatInMeasure % 3 === 0 || beatInMeasure % 5 === 0) && Math.random() < 0.6), 0.6]
    ],
    'chinese': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 6), 0.8]
    ],
    'chinese_traditional': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 8 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 8), 0.9]
    ],
    'chips': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.2],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.6]
    ],
	 'samba': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9]
    ],
    'tango': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'flamenco': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 && Math.random() < 0.7), 0.4],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => ((beatInMeasure % 3 === 0 || beatInMeasure % 5 === 0) && Math.random() < 0.5), 0.8]
    ],
    'highlife': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.8]
    ],
    'soukous': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || beatInMeasure % 8 === 3), 0.7]
    ],
    'bhangra': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.8]
    ],
    'balkan': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.8), 0.5],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 3 === 0 && Math.random() < 0.6)), 0.9]
    ],
    'zydeco': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.8]
    ],
    'cumbia': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.7]
    ],
    'mariachi': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.8]
    ],
    'polka': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9]
    ],
    'gospel': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.7), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 4), 0.8]
    ],
    'ska': [
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.4], // Emphasized upbeats
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'soca': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || beatInMeasure % 8 === 3), 0.7]
    ],
    'juju': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.8]
    ],
    'mbalax': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'forro': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.8]
    ],
    'calypso': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.7]
    ],
    'gagaku': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.9]
    ],
	    'griot': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9]
    ],
    'qawwali': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9]
    ],
    'fado': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'andean': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'chant': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.9]
    ],
    'boogie': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'disco': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.9]
    ],
    'newwave': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'triphop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.6), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'baroque': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9]
    ],
    'minimal': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.9]
    ],
    'waltz': [
        [(beatInMeasure) => (beatInMeasure % 3 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 6 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 12 === 0), 0.9]
    ],
    'march': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'shanty': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
	
	    'swing': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.3)), 0.8]
    ],
    'bebop': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.7), 0.5],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 3 && Math.random() < 0.5)), 0.9]
    ],
    'cooljazz': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.6), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'hardbop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.4)), 0.9]
    ],
    'freejazz': [
        [(beatInMeasure) => (Math.random() < 0.4), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || (beatInMeasure % 8 === 6 && Math.random() < 0.6)), 0.5],
        [(beatInMeasure) => ((beatInMeasure % 3 === 0 || beatInMeasure % 5 === 0) && Math.random() < 0.7), 0.7]
    ],
    'modaljazz': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.8]
    ],
    'fusion': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.8]
    ],
    'smoothjazz': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.8), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'jpop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'kpop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.8]
    ],
    'citypop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'vaporwave': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 && Math.random() < 0.7), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
    'futurebass': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.4)), 0.7]
    ],
    'witchhouse': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 && Math.random() < 0.6), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 8), 0.8]
    ],
    'synthpop': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'italo': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1), 0.8]
    ],
    'eurodance': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'hardstyle': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9]
    ],
    'gabber': [
        [(beatInMeasure) => (beatInMeasure % 0.5 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9]
    ],
    'psytrance': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'goa': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 3 && Math.random() < 0.5)), 0.9]
    ],
    'proghouse': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'deephouse': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.7), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7]
    ],
    'ukgarage': [
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.4], // Emphasized off-beats
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'footwork': [
        [(beatInMeasure) => (beatInMeasure % 0.5 === 0 && Math.random() < 0.6), 0.3],
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7]
    ],
    'jungle': [
        [(beatInMeasure) => (beatInMeasure % 0.5 === 0), 0.2],
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8]
    ],
	    'gypsy': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.4)), 0.8]
    ],
    'mambo': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || beatInMeasure % 8 === 3), 0.8]
    ],
    'merengue': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'bachata': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 8 === 1 && Math.random() < 0.3)), 0.7]
    ],
    'son': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'rumba': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'guaracha': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'chacha': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 4 === 3), 0.8]
    ],
    'danzon': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'bolero': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'pachanga': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'timba': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 1 || beatInMeasure % 8 === 3), 0.8]
    ],
    'charanga': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'mozambique': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'conga': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'bomba': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'plena': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'guajira': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'montuno': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'guaguanco': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'colombia': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'yambu': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.3],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 5), 0.7]
    ],
    'guarapachangueo': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8]
    ],
    'bata': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9]
    ],
    'iyesa': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9]
    ],
    'makuta': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9]
    ],
    'villancico': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'punto': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'tonada': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
	 'daf': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],                       // Kick op elke 2e beat
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 6), 0.5], // Snare accenten
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.7]  // Hi-hat syncopatie
    ],
    'darbuka': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0 || beatInMeasure % 4 === 1), 0.4], // Dum pattern
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 8 === 3), 0.6], // Tek pattern
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 8 === 7), 0.5]  // Ka accenten
    ],
    'bendir': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.4],                         // Basisslag
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && beatInMeasure % 4 !== 0), 0.6], // Zijslag
        [(beatInMeasure) => (beatInMeasure % 8 === 3 || beatInMeasure % 8 === 7), 0.5]  // Vingerklik
    ],
    'taarija': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5],                         // Open klap
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.4],                         // Muted klap
        [(beatInMeasure) => (beatInMeasure % 8 === 3 || beatInMeasure % 8 === 6), 0.6]  // Accenten
    ],
    'tabla': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],                         // Dayan (rechterhand) bass
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.6],                         // Bayan (linkerhand) tone
        [(beatInMeasure) => (beatInMeasure % 8 === 2 || beatInMeasure % 8 === 5), 0.4]  // Ta accenten
    ],
    'riqq': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],                         // Basisslag
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.5],                         // Rim click
        [(beatInMeasure) => (beatInMeasure % 8 === 3 || beatInMeasure % 8 === 7), 0.7]  // Bell accent
    ],
    'rockkit': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3],                         // Kick op downbeat
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.5],                         // Snare op backbeat
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.2]                          // Constant hi-hat
    ],
    'electronic': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],                         // Zware kick
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.6],                         // Clap/snare
        [(beatInMeasure) => (beatInMeasure % 0.5 === 0), 0.4]                        // Snelle hi-hat
    ],
    'tbel': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],                         // Zware slag
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.5],                         // Medium slag
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.6]                          // Accent slag
    ],
    'qraqeb': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.4],                         // Constante basis
        [(beatInMeasure) => (beatInMeasure % 2 === 0.5), 0.6],                       // Syncopatie
        [(beatInMeasure) => (beatInMeasure % 4 === 1.5), 0.5]                        // Accenten
    ],
    'ney': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.3],                         // Breath accent
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.2],                         // Subtiele pulse
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.4]                          // Ornament
    ],
    'oud': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],                         // Basistoon
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.3],                         // Harmonie
        [(beatInMeasure) => (beatInMeasure % 8 === 2), 0.6]                          // Melodisch accent
    ],
    'kanun': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.4],                         // Basis arpeggio
        [(beatInMeasure) => (beatInMeasure % 2 === 0.5), 0.3],                       // Snelle noten
        [(beatInMeasure) => (beatInMeasure % 8 === 3.5), 0.5]                        // Triller
    ],
    'neyzan': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],                         // Drone basis
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.4],                         // Ondersteuning
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.7]                          // Melodisch accent
    ],
    'gasba': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],                         // Lange tonen
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.3],                         // Korte frasen
        [(beatInMeasure) => (beatInMeasure % 8 === 2.5), 0.6]                        // Versiering
    ],
    'guembri': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],                         // Bassline
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.5],                         // Harmonie
        [(beatInMeasure) => (beatInMeasure % 8 === 3.5), 0.6]                        // Riff
    ],
    'lotar': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],                         // Ritmische basis
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.4],                         // Tegenritme
        [(beatInMeasure) => (beatInMeasure % 8 === 2.5), 0.7]                        // Solo accent
    ],
    'zurna': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],                         // Hoge noten
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.6],                         // Middentonen
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.9]                          // Trillers
    ],
    'mizmar': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],                         // Krachtige tonen
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.5],                         // Ondersteuning
        [(beatInMeasure) => (beatInMeasure % 8 === 2.5), 0.8]                        // Ornamenten
    ],
    'rabab': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5],                         // Melodische basis
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.3],                         // Tremolo
        [(beatInMeasure) => (beatInMeasure % 8 === 3.5), 0.6]                        // Glissando
    ],
    'violin': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.4],                         // Lange noten
        [(beatInMeasure) => (beatInMeasure % 2 === 0.5), 0.6],                       // Staccato
        [(beatInMeasure) => (beatInMeasure % 8 === 2), 0.7]                          // Vibrato accent
    ],
    'accordion': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5],                         // Basis akkoord
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.4],                         // Tegenakkoord
        [(beatInMeasure) => (beatInMeasure % 8 === 3.5), 0.6]                        // Riff
    ],
    'synthesizer': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],                         // Bass synth
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.5],                         // Lead synth
        [(beatInMeasure) => (beatInMeasure % 8 === 2.5), 0.8]                        // Effect
    ],
    'chant': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],                         // Refrein
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.4],                         // Couplet
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.7]                          // Crescendo
    ],
    'handclap': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5],                         // Basis klap
        [(beatInMeasure) => (beatInMeasure % 4 === 1), 0.7],                         // Echo klap
        [(beatInMeasure) => (beatInMeasure % 8 === 3.5), 0.6]                        // Syncopatie
    ],
    'fingercymbals': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.3],                         // Constante tik
        [(beatInMeasure) => (beatInMeasure % 2 === 0.5), 0.5],                       // Accent
        [(beatInMeasure) => (beatInMeasure % 4 === 1.5), 0.4]                        // Triller
    ],
    'waterdrum': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],                         // Diepe tonen
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.4],                         // Hoge tonen
        [(beatInMeasure) => (beatInMeasure % 8 === 2.5), 0.5]                        // Resonantie
    ],
    'windchimes': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7],                         // Grote beweging
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],                         // Middelgroot
        [(beatInMeasure) => (beatInMeasure % 2 === 1), 0.3]                          // Kleine beweging
    ],
    'thunder': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9],                        // Donderklap
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],                         // Rommelend
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5]                          // Echo
    ],
    'rain': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.2],                         // Constante regen
        [(beatInMeasure) => (beatInMeasure % 2 === 0.5), 0.4],                       // Hardere druppels
        [(beatInMeasure) => (beatInMeasure % 4 === 1.5), 0.3]                        // Plensbui
    ],
	    'Classical': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
    'Jazz': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || (beatInMeasure % 4 === 3 && Math.random() < 0.3)), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 2 || beatInMeasure % 8 === 6), 0.4],
        [(beatInMeasure) => (beatInMeasure % 2 === 0 && Math.random() < 0.6), 0.3]
    ],
    'Blues': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 3 || beatInMeasure % 8 === 7), 0.3]
    ],
    'Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Metal': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 1 || beatInMeasure % 8 === 5), 0.6]
    ],
    'Pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'R&B': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4]
    ],
    'Soul': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 6), 0.4]
    ],
    'Funk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 3 || beatInMeasure % 16 === 11), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Disco': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Reggae': [
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Country': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.4]
    ],
    'Electronic': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Folk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.6]
    ],
    'Punk': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'Indie': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4]
    ],
    'Alternative': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3]
    ],
    'Ambient': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0 && Math.random() < 0.4), 0.3],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.2],
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.5]
    ],
    'Techno': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'House': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 2 || beatInMeasure % 16 === 10), 0.3]
    ],
    'Dubstep': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.8],
        [(beatInMeasure) => (beatInMeasure % 32 === 28), 0.6]
    ],
    'Drum and Bass': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.6]
    ],
    'Trap': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.5]
    ],
    'Lo-fi': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 10 && Math.random() < 0.5), 0.3]
    ],
    'Synth-pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Electropop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'New Wave': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Post-punk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Grunge': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5]
    ],
    'Emo': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4]
    ],
    'Progressive Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 16 === 14), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5]
    ],
	'Psychedelic Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4]
    ],
    'Hard Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6]
    ],
    'Heavy Metal': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.7]
    ],
    'Death Metal': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 1.0]
    ],
    'Black Metal': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.7]
    ],
    'Thrash Metal': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.5), 0.6]
    ],
    'Power Metal': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7]
    ],
    'Gothic Metal': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
    'Industrial': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 6), 0.6]
    ],
    'Hardcore': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7]
    ],
    'Ska': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 1 || beatInMeasure % 4 === 3), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Reggaeton': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 8 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6]
    ],
    'Salsa': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 3 || beatInMeasure % 16 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10 || beatInMeasure % 16 === 12), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5]
    ],
    'Bachata': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Flamenco': [
        [(beatInMeasure) => (beatInMeasure % 12 === 0 || beatInMeasure % 12 === 3 || beatInMeasure % 12 === 6 || beatInMeasure % 12 === 8 || beatInMeasure % 12 === 10), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4]
    ],
    'Bossa Nova': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 3 || beatInMeasure % 16 === 7 || beatInMeasure % 16 === 10), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Samba': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 14), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5]
    ],
    'Tango': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 15), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.5]
    ],
    'Opera': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.7]
    ],
    'Choral': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.6]
    ],
    'Baroque': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7]
    ],
    'Romantic': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.6]
    ],
    'Modern Classical': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 && Math.random() < 0.7), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.6]
    ],
    'Minimalism': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.3]
    ],
    'Avant-garde': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 && Math.random() < 0.5), 0.4],
        [(beatInMeasure) => (beatInMeasure % 7 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 13 === 0), 0.5]
    ],
    'Experimental': [
        [(beatInMeasure) => (Math.random() < 0.3), 0.4],
        [(beatInMeasure) => (beatInMeasure % 5 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.6]
    ],
    'Noise': [
        [(beatInMeasure) => (Math.random() < 0.8), 0.5],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6]
    ],
    'Drone': [
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 64 === 32), 0.2],
        [(beatInMeasure) => (beatInMeasure % 128 === 0), 0.4]
    ],
    'IDM': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || (beatInMeasure % 16 === 11 && Math.random() < 0.7)), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 32 === 27), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 && Math.random() < 0.4), 0.3]
    ],
    'Glitch': [
        [(beatInMeasure) => (Math.random() < 0.4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7]
    ],
    'Breakcore': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.7), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 11 || beatInMeasure % 16 === 15), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9]
    ],
    'Hardstyle': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
	'Soca': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 3 || beatInMeasure % 16 === 11), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 6), 0.7]
    ],
    'Calypso': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Grime': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10 && Math.random() < 0.6), 0.5]
    ],
    'Garage': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 13 || beatInMeasure % 16 === 15), 0.6]
    ],
    'Dub': [
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.9],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.6],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.4]
    ],
    'Dancehall': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 6), 0.6]
    ],
    'Hard Trance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5]
    ],
    'Nu-Disco': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Phonk': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 6), 0.4]
    ],
    'Synthpop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'New Romantic': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7]
    ],
    'Electro': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 10), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Freestyle': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.5]
    ],
    'Electro Funk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 3 || beatInMeasure % 16 === 11), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7]
    ],
    'Merengue': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.5]
    ],
    'Mariachi': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.7]
    ],
    'K-pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'J-pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'City Pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Viking Metal': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6]
    ],
    'Pirate Metal': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 2 || beatInMeasure % 8 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5]
    ],
    'Soundtrack': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 && Math.random() < 0.4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.3],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.6]
    ],
    'Film Score': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.4],
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.7]
    ],
    'Future Bass': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 11), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5]
    ],
    'Plunderphonics': [
        [(beatInMeasure) => (Math.random() < 0.5 && beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Folktronica': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4]
    ],
    'Indietronica': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Synthwave': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Vaporwave': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.3]
    ],
    'Chillwave': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4]
    ],
    'Darkwave': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Coldwave': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
	'Eletro Funk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 3 || beatInMeasure % 16 === 11), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Merengue': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.5]
    ],
    'Bachata': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 13), 0.4]
    ],
    'Tango': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Mariachi': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
    'K-pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'J-pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'City Pop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Enka': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.7]
    ],
    'Rai': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5]
    ],
    'Qawwali': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.8]
    ],
    'Bhangra': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.6]
    ],
    'Carnatic': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6]
    ],
    'Hindustani': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.4]
    ],
    'Gamelan': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 10), 0.6],
        [(beatInMeasure) => (beatInMeasure % 32 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7]
    ],
    'Flamenco': [
        [(beatInMeasure) => (beatInMeasure % 12 === 0 || beatInMeasure % 12 === 3 || beatInMeasure % 12 === 6 || beatInMeasure % 12 === 8 || beatInMeasure % 12 === 10), 0.8],
        [(beatInMeasure) => (beatInMeasure % 12 === 11), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5]
    ],
    'Fado': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.6]
    ],
    'Chanson': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.6]
    ],
    'Schlager': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Klezmer': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.4]
    ],
    'Celtic': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.7]
    ],
    'Polka': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6]
    ],
    'Valse': [
        [(beatInMeasure) => (beatInMeasure % 3 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 3 === 1), 0.4],
        [(beatInMeasure) => (beatInMeasure % 12 === 0), 0.8]
    ],
    'Opera': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.3],
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.7]
    ],
    'Baroque': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.4],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
    'Contemporary Classical': [
        [(beatInMeasure) => (Math.random() < 0.3 && beatInMeasure % 8 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.3]
    ],
    'Minimalism': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.5]
    ],
    'Experimental': [
        [(beatInMeasure) => (Math.random() < 0.4 && beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 13 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 7), 0.4]
    ],
    'Noise': [
        [(beatInMeasure) => (Math.random() < 0.7), 0.4],
        [(beatInMeasure) => (Math.random() < 0.2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.3]
    ],
    'Drone': [
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 128 === 64), 0.4],
        [(beatInMeasure) => (beatInMeasure % 256 === 0), 0.8]
    ],
    'Dark Ambient': [
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 64 === 32), 0.3],
        [(beatInMeasure) => (beatInMeasure % 128 === 0), 0.6]
    ],
    'IDM': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 11 || beatInMeasure % 32 === 26), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
	'Glitch': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0 || beatInMeasure % 16 === 11 || beatInMeasure % 32 === 26), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 16 === 7), 0.7],
        [(beatInMeasure) => (Math.random() < 0.4), 0.6]
    ],
    'Breakcore': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 3 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 11), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 16 === 14), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 10 || beatInMeasure % 32 === 28), 0.7]
    ],
    'Hardstyle': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Gabber': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.5]
    ],
    'Happy Hardcore': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Eurodance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.5]
    ],
    'Trance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Psytrance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 1 || beatInMeasure % 4 === 2 || beatInMeasure % 4 === 3), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Goa Trance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 13 || beatInMeasure % 16 === 15), 0.6]
    ],
    'Progressive Trance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Dream Trance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4]
    ],
    'Uplifting Trance': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Hardcore Techno': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.5]
    ],
    'Acid Techno': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.6]
    ],
    'Dub Techno': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5]
    ],
    'Minimal Techno': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Detroit Techno': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Lounge': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Chillout': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.6]
    ],
    'Nu Jazz': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.5]
    ],
    'Acid Jazz': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Soul Jazz': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Smooth Jazz': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.7]
    ],
    'Jazz Fusion': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 7), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Hard Bop': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 3), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4]
    ],
    'Bebop': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 5), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Cool Jazz': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.6]
    ],
    'Free Jazz': [
        [(beatInMeasure) => (Math.random() < 0.4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 7 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 13 === 0), 0.4]
    ],
    'Modal Jazz': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.5],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.7]
    ],
    'Post-bop': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 11), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Latin Jazz': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 12), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 3), 0.6]
    ],
    'Gypsy Jazz': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.8]
    ],
	'Swing': [
        [(beatInMeasure) => (beatInMeasure % 12 === 0 || beatInMeasure % 12 === 8), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 12 === 4), 0.5]
    ],
    'Big Band': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4 || beatInMeasure % 16 === 14), 0.8]
    ],
    'Ragtime': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 2 || beatInMeasure % 8 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 4), 0.5]
    ],
    'Dixieland': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.5]
    ],
    'Third Stream': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6]
    ],
    'Jazz-funk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Acid Jazz (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Nu Jazz (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Bossa Nova': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 3), 0.5]
    ],
    'Samba': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 2), 0.6]
    ],
    'AfrobeatInMeasure': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 4 || beatInMeasure % 16 === 10 || beatInMeasure % 16 === 14), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 7), 0.5]
    ],
    'Highlife': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 6), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Juju': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 12), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.5]
    ],
    'Mbalax': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 7 || beatInMeasure % 16 === 15), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.5]
    ],
    'Makossa': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 10), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Soukous': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 11), 0.5]
    ],
    'Kwaito': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Desert Blues': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 10), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Ethio-jazz': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Gnoua': [
        [(beatInMeasure) => (beatInMeasure % 12 === 0 || beatInMeasure % 12 === 4 || beatInMeasure % 12 === 8), 0.8],
        [(beatInMeasure) => (beatInMeasure % 12 === 6), 0.6],
        [(beatInMeasure) => (beatInMeasure % 3 === 0), 0.5]
    ],
    'Zouk': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.5]
    ],
    'Kizomba': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 7 || beatInMeasure % 16 === 15), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4]
    ],
    'Soca (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 10 || beatInMeasure % 16 === 14), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 2), 0.6]
    ],
    'Calypso (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 16 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Dancehall (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6 || beatInMeasure % 16 === 14), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 3), 0.6]
    ],
    'Dub (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.5],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.4]
    ],
    'Grime (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 11 || beatInMeasure % 32 === 26), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Garage (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 10 || beatInMeasure % 16 === 15), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    '2-Step': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 10 || beatInMeasure % 16 === 15), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 6), 0.5]
    ],
    'Future Garage': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 10), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'UK Bass': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 11), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Wonky': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 7 || beatInMeasure % 16 === 13), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.5]
    ],
	'Downtempo': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4]
    ],
    'Trip Hop': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 8 === 3), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Illbient': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 11), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5],
        [(beatInMeasure) => (beatInMeasure % 32 === 28), 0.4]
    ],
    'Acid Hop': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 13), 0.5]
    ],
    'Glitch Hop': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0 || beatInMeasure % 16 === 11 || beatInMeasure % 32 === 26), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2 || beatInMeasure % 16 === 7), 0.6],
        [(beatInMeasure) => (Math.random() < 0.4), 0.5]
    ],
    'Nu-Metal': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Funk Metal': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 3 || beatInMeasure % 16 === 11), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Industrial Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Industrial Metal': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.7]
    ],
    'Digital Hardcore': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.7]
    ],
    'EBM': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6]
    ],
    'Aggrotech': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.7]
    ],
    'Futurepop': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Synth-Goth': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.8]
    ],
    'Dark Electro': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Electro-Industrial': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.6]
    ],
    'Power Noise': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (Math.random() < 0.6), 0.7],
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.5]
    ],
    'Dark Ambient (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.3],
        [(beatInMeasure) => (beatInMeasure % 64 === 32), 0.2],
        [(beatInMeasure) => (beatInMeasure % 128 === 0), 0.5]
    ],
    'Ritual Ambient': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 8), 0.3],
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.6]
    ],
    'Drone Doom': [
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 128 === 64), 0.4],
        [(beatInMeasure) => (beatInMeasure % 256 === 0), 0.7]
    ],
    'Stoner Doom': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.5]
    ],
    'Sludge Doom': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.7],
        [(beatInMeasure) => (beatInMeasure % 32 === 28), 0.6]
    ],
    'Funeral Doom': [
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 32 === 16), 0.5],
        [(beatInMeasure) => (beatInMeasure % 64 === 0), 0.8]
    ],
    'Blackened Death Metal': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.7]
    ],
    'Technical Death Metal': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 16 === 3 || beatInMeasure % 16 === 7 || beatInMeasure % 16 === 11), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 1.0]
    ],
    'Melodic Death Metal': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.7]
    ],
    'Symphonic Death Metal': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7]
    ],
    'Brutal Death Metal': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.7]
    ],
    'Deathgrind': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.9],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.8]
    ],
    'Goregrind': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (Math.random() < 0.7), 0.6]
    ],
	'Porngrind': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 13), 0.7]
    ],
    'Noise Metal': [
        [(beatInMeasure) => (Math.random() < 0.7), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.3), 0.5]
    ],
    'Mathcore': [
        [(beatInMeasure) => (beatInMeasure % 7 === 0 || beatInMeasure % 13 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 11), 0.7]
    ],
    'Screamo (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Emocore': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.5]
    ],
    'Post-Hardcore': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'Metalcore (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.7]
    ],
    'Deathcore (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.7]
    ],
    'Nintendocore': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Electronicore': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'Synthcore': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.5]
    ],
    'Cybergrind': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 16 === 11), 0.8],
        [(beatInMeasure) => (Math.random() < 0.6), 0.7]
    ],
    'Hardcore Punk': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 1.0]
    ],
    'Crust Punk': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.6]
    ],
    'D-beatInMeasure': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0 || beatInMeasure % 8 === 3 || beatInMeasure % 8 === 6), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 0.6]
    ],
    'Powerviolence': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 16 === 7), 0.8],
        [(beatInMeasure) => (Math.random() < 0.5), 0.7]
    ],
    'Grindcore (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 1 === 0), 1.0],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 16 === 15), 0.9]
    ],
    'Thrashcore': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.9],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.8],
        [(beatInMeasure) => (beatInMeasure % 1 === 0 && Math.random() < 0.6), 0.7]
    ],
    'Crossover Thrash': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.9]
    ],
    'Skate Punk': [
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.7],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Pop Punk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ],
    'Ska Punk': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 1 || beatInMeasure % 4 === 3), 0.8],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.6]
    ],
    'Reggae Rock': [
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.8],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 14), 0.4]
    ],
    'Dub Rock': [
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.7],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.6],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.5]
    ],
    'Post-Rock (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 8 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 8), 0.4],
        [(beatInMeasure) => (beatInMeasure % 32 === 0), 0.7]
    ],
    'Math Rock': [
        [(beatInMeasure) => (beatInMeasure % 5 === 0 || beatInMeasure % 11 === 0), 0.7],
        [(beatInMeasure) => (beatInMeasure % 4 === 2), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 13), 0.5]
    ],
    'Space Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 12), 0.7]
    ],
    'Krautrock (2nd Var)': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.8],
        [(beatInMeasure) => (beatInMeasure % 2 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.7]
    ],
    'Art Rock': [
        [(beatInMeasure) => (beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4]
    ],
    'Experimental Rock': [
        [(beatInMeasure) => (Math.random() < 0.4), 0.5],
        [(beatInMeasure) => (beatInMeasure % 7 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 0), 0.7]
    ],
    'Avant-Garde Rock': [
        [(beatInMeasure) => (beatInMeasure % 13 === 0), 0.5],
        [(beatInMeasure) => (beatInMeasure % 5 === 0), 0.4],
        [(beatInMeasure) => (Math.random() < 0.3), 0.6]
    ],
    'Plunderphonics': [
        [(beatInMeasure) => (Math.random() < 0.5 && beatInMeasure % 4 === 0), 0.6],
        [(beatInMeasure) => (beatInMeasure % 16 === 10), 0.4],
        [(beatInMeasure) => (beatInMeasure % 8 === 4), 0.5]
    ]

	
};



const SCALE_SEMITONES = {
    // Your existing scales:
    major: [0, 2, 4, 5, 7, 9, 11],
    minor: [0, 2, 3, 5, 7, 8, 10],
    dorian: [0, 2, 3, 5, 7, 9, 10],
    phrygian: [0, 1, 3, 5, 7, 8, 10],
    pentatonic: [0, 2, 4, 7, 9],
    chromatic: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    
    // Previously added:
    mixolydian: [0, 2, 4, 5, 7, 9, 10],
    harmonic_minor: [0, 2, 3, 5, 7, 8, 11],
    blues: [0, 3, 5, 6, 7, 10],
        major: [0, 2, 4, 5, 7, 9, 11],
    minor: [0, 2, 3, 5, 7, 8, 10],
    dorian: [0, 2, 3, 5, 7, 9, 10],
    phrygian: [0, 1, 3, 5, 7, 8, 10],
    lydian: [0, 2, 4, 6, 7, 9, 11],
    mixolydian: [0, 2, 4, 5, 7, 9, 10],
    locrian: [0, 1, 3, 5, 6, 8, 10],
    pentatonic: [0, 2, 4, 7, 9],
    chromatic: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11],
    harmonicMinor: [0, 2, 3, 5, 7, 8, 11],
    melodicMinor: [0, 2, 3, 5, 7, 9, 11],
    wholeTone: [0, 2, 4, 6, 8, 10],
    blues: [0, 3, 5, 6, 7, 10],
    // NEW SCALES NEEDED:
    lydian: [0, 2, 4, 6, 7, 9, 11],           // Used in: Film scores, Jazz fusion
    locrian: [0, 1, 3, 5, 6, 8, 10],          // Used in: Experimental, Metal
    melodic_minor: [0, 2, 3, 5, 7, 9, 11],    // Used in: Jazz, Fusion
    whole_tone: [0, 2, 4, 6, 8, 10],          // Used in: Impressionist, Experimental
    diminished: [0, 2, 3, 5, 6, 8, 9, 11],    // Used in: Jazz, Metal
    augmented: [0, 3, 4, 7, 8, 11],           // Used in: Experimental, Avant-garde
    enigmatic: [0, 1, 4, 6, 8, 10, 11],       // Used in: Experimental, Film
    double_harmonic: [0, 1, 4, 5, 7, 8, 11],  // Used in: Middle Eastern, Oriental
    hirajoshi: [0, 2, 3, 7, 8],               // Used in: Japanese traditional
    in_sen: [0, 1, 5, 7, 10],                 // Used in: Japanese traditional
    yo: [0, 2, 5, 7, 9],                      // Used in: Japanese traditional
    hungarian_minor: [0, 2, 3, 6, 7, 8, 11],  // Used in: Eastern European, Gypsy
    gypsy: [0, 2, 3, 6, 7, 8, 10],            // Used in: Flamenco, Eastern European
    neapolitan_minor: [0, 1, 3, 5, 7, 8, 11], // Used in: Classical, Film
    persian: [0, 1, 4, 5, 6, 8, 11],          // Used in: Middle Eastern
    arabic: [0, 1, 4, 5, 7, 8, 11],           // Used in: Middle Eastern
    byzantine: [0, 1, 4, 5, 7, 8, 11],       // Used in: Eastern Mediterranean
    balinese: [0, 1, 3, 5, 7, 8],             // Used in: Indonesian traditional
    pelog: [0, 1, 3, 5, 7, 8, 10],           // Used in: Indonesian traditional
    iwato: [0, 1, 5, 6, 10],                  // Used in: Japanese traditional
    prometheus: [0, 2, 4, 6, 9, 10],          // Used in: Russian, Experimental
    tritone: [0, 1, 4, 6, 7, 10]              // Used in: Experimental, Metal
};






	</script>
	</head>
<body style='background-size:100% 100%'>
<div style='display:none'>
<div style='display:none'>

    <canvas id="videoCanvas"></canvas>
    
    <!-- Chorus Indicator -->
    <div class="chorus-indicator" id="chorusIndicator">🎵 CHORUS!</div>
    
    <!-- Simplified Player -->
    <div id="simplePlayer">
        <div class="player-title" id="playerTitle">Muziek Speler</div>
        <div class="player-controls">
            <button class="player-btn" id="simplePlayBtn" title="Play">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M3 2v12l10-6z"/>
                </svg>
            </button>
            <button class="player-btn stop" id="simpleStopBtn" title="Stop">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <rect width="12" height="12" x="2" y="2"/>
                </svg>
            </button>
            <button class="player-btn skip" id="simpleSkipBtn" title="Skip">
                <svg width="10" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M3 2v12l10-6z"/>
                </svg>
                <svg width="10" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M3 2v12l10-6z"/>
                </svg>
            </button>
            <button class="player-btn menu" id="menuToggleBtn" title="Show Controls">
                <span class="menu-bar"></span>
                <span class="menu-bar"></span>
                <span class="menu-bar"></span>
            </button>
        </div>
    </div>

    <!-- Full Control Panel -->
    <div class="panel" id="audioPanel">
        <button class="close-panel" id="closePanelBtn">×</button>
      <h1 style="font-size: 1.2rem; color: #e8efff; opacity: 0.8; margin-left: 15px;">Non Free Music News App</h1>
        <div class="row">
            <label>Genre:</label>
            <select id="genreSelect">
                <!-- Options will be populated by JavaScript -->
            </select>
            <label>Active roles (random 2–4):</label>
            <select id="roleMode">
                <option value="random24">Random 2–4 roles</option>
                <option value="all">All roles on</option>
                <option value="all">All roles on</option>
                <option value="leadBass">Lead + Bass</option>
                <option value="leadChords">Lead + Chords</option>
                <option value="bassDrums">Bass + Drums</option>
            </select>
            <label>
                <input id="playAudio" type="checkbox" checked>Play audio preview
            </label>
        </div>
        <div class="row">
            <label for="radialSelect" style='display:none'>Kies Radiaal:</label>
            <select id="radialSelect" style='display:none'>
                <option value="1" selected>Radiaal 1 (3 buren: Links, Centrum, Rechts)</option>
                <option value="2">Radiaal 2 (5 buren: 2L, 1L, Centrum, 1R, 2R)</option>
            </select>
            <label>Rule:</label>
            <input id="ruleNumber" value="110">
            <label>Seed:</label>
            <input id="seed" type="text" value="Gouda-001">
            <label>Height:</label>
            <input id="height" type="number" min="16" max="1024" value="128">
            <label>Width:</label>
            <input id="width" type="number" min="16" max="1024" value="128">
            <label>
                <input id="cyclic" type="checkbox" checked>Cyclic boundaries
            </label>
            <label>
                <input id="showEvolution" type="checkbox">CA overlay
            </label>
        </div>
        <div class="row">
            <label>Tempo (BPM):</label>
            <input id="bpm" type="number" min="40" max="220" value="110">
            <label>Notes/beat:</label>
            <input id="notesPerBeat" type="number" min="1" max="8" value="2">
            <label>Duration (s):</label>
            <input id="durationSec" type="number" min="5" max="120" value="60">
        </div>
        <div class="row">
            <label>SoundFont:</label>
            <div class="file-input-wrapper">
                <button class="btn soundfont" id="loadSoundfontBtn">Load SF2 File</button>
                <input type="file" id="soundfontFile" accept=".sf2">
            </div>
            <label>Reverb:</label>
            <input id="reverbMix" type="range" min="0" max="1" step="0.05" value="0.4">
            <label>Filter (Hz):</label>
            <input id="filterHz" type="number" min="100" max="12000" value="1800">
        </div>
        <div class="instrument-controls" id="instrumentControls">
            <div class="instrument-control">
                <label>Lead Instrument:</label>
                <select id="leadInstrument">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="instrument-control">
                <label>Bass Instrument:</label>
                <select id="bassInstrument">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="instrument-control">
                <label>Chords Instrument:</label>
                <select id="chordsInstrument">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
            <div class="instrument-control">
                <label>Drums Kit:</label>
                <select id="drumsKit">
                    <option value="0">Standard Kit</option>
                    <option value="8">Room Kit</option>
                    <option value="16">Power Kit</option>
                    <option value="24">Electronic Kit</option>
                </select>
            </div>
        </div>
        <div class="row">
            <button class="btn" id="generateBtn" style="background-color:#1e88e5">
                Generate 
                <svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M3 2v12l10-6z"></path>
                </svg>
            </button>
            <button class="btn secondary" id="nextVariationBtn">Next variation</button>
            <button class="btn secondary" id="randomizeBtn">Randomize</button>
            <button class="btn secondary" id="downloadMidiBtn">Download MIDI</button>
            <button class="btn secondary" id="wolframTonesBtn" style='display:none'>CATones mode</button>
            <button class="btn stop" id="stopBtnn" style='display:none'>Stop Playback</button>
            <button class="btn auto-play" id="autoPlayBtn" style='display:none'>Auto-Play</button>
        </div>
        <div class="status" id="statusText">Ready.</div>
        <div class="loading-bar" id="loadingBar" style="display: none;">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
        <div class="soundfont-info" id="soundfontInfo">No SoundFont loaded. Click "Load SF2 File" to upload a SoundFont for enhanced audio.</div>
        <div class="small">Genres bepalen toonladder, root, rolbereik, ritme en instrumentstijl. MIDI export maakt een standaard SMF met meerdere tracks.</div>
    </div>
</div>


	
	<iframe id='xyz7'  sandbox='allow-scripts'  style='border:none;position:fixed;left:0;top:0;width:100%;height:100%;opacity:.5' srcdoc="
	
	"></iframe>
<iframe id='xyz'  style='border:none;position:fixed;left:0;top:0;width:100%;height:100%'></iframe>
    <script>
	
	
	
	imgg="";
	var imgl=imgg.split("<br>");
	
        // ==================== UI CONTROLS ====================
        const simplePlayer = document.getElementById('simplePlayer');
        const playerTitle = document.getElementById('playerTitle');
        const simplePlayBtn = document.getElementById('simplePlayBtn');
        const simpleStopBtn = document.getElementById('simpleStopBtn');
        const menuToggleBtn = document.getElementById('menuToggleBtn');
        const audioPanel = document.getElementById('audioPanel');
        const closePanelBtn = document.getElementById('closePanelBtn');
        const genreSelect = document.getElementById('genreSelect');
        const autoPlayBtn = document.getElementById('autoPlayBtn');
        //nnconst stopBtn = document.getElementById('stopBtn');
        const skipBtn = document.getElementById('simpleSkipBtn');
        const chorusIndicator = document.getElementById('chorusIndicator');

        // Update player title based on genre selection
        genreSelect.addEventListener('change', function() {
            playerTitle.textContent = this.options[this.selectedIndex].text;
        });

        // Toggle between simple and full control modes
        menuToggleBtn.addEventListener('click', function() {
            audioPanel.classList.add('active');
        });

        closePanelBtn.addEventListener('click', function() {
            audioPanel.classList.remove('active');
        });

        var rstarted = 0;
        // Connect simple player buttons to full control buttons
        simplePlayBtn.addEventListener('click', function() {
            if(rstarted == 0){
                setTimeout(() => {
                    rstarted = 1;
                    loadInlineSoundFont().catch(console.error);
                    autoPlayBtn.click();
                    setTimeout(() => {
                       // stopBtn.click();
                    }, 250);
                }, 1500);
            } else {
                autoPlayBtn.click();
            }
        });

        simpleStopBtn.addEventListener('click', function() {
            //stopBtn.click();
        });

        simpleSkipBtn.addEventListener('click', function() {
           // stopBtn.click();
            setTimeout(() => autoPlayBtn.click(), 500);
        });

        // Initialize player title


        // Simulate some functionality for demonstration
        autoPlayBtn.addEventListener('click', function() {
            document.getElementById('statusText').textContent = 'Playing...';
        });
/*
        stopBtn.addEventListener('click', function() {
            document.getElementById('statusText').textContent = 'Stopped.';
        });
		*/

        // ==================== CORE APPLICATION ====================
        const canvas = document.getElementById('videoCanvas');
        //const ctx = canvas.getContext('2d');
        //canvas.width = 1280;
        //canvas.height = 720;

        let currentRadial = 1;
        const rultypeRad2 = [5901188200, 6132266537, 5989082269, 3939909810, 2187097860, 5614370765, 5272673556, 1780478520, 720581818, 1377414797, 1226447482, 4048539824, 5125853076, 2812885758, 529315828, 4287755508, 5126404892, 280217644, 3998813487, 431643732, 4156513646, 3147094149, 3353215924, 5031890556];
        const radialSelect = document.getElementById('radialSelect');
        let variationIndex = 0;
        let currentRuleTypeArray = [2, 4, 6, 7, 8, 10, 11, 12, 16, 19, 27, 28, 29, 30, 31, 32, 34, 46, 55, 61, 62, 63, 66, 74, 76, 83, 86, 87, 90, 91, 98, 102, 103, 106, 107, 108, 110, 111, 121, 123, 125, 127, 130, 136, 138, 147, 148, 150, 151, 152, 154, 155, 162, 166, 167, 168, 170, 183, 184, 194, 196, 226];

        radialSelect.addEventListener('change', (event) => {
            currentRadial = parseInt(event.target.value, 10);
            console.log(`Nieuwe Radiaal: ${currentRadial}`);
            if (currentRadial === 2) {
                currentRuleTypeArray = rultypeRad2;
                console.log('Regels ingesteld op rultypeRad2.');
            } else {
                console.log('Regels ingesteld op Radiaal 1 array.');
            }
        });

        // Set random seed
        document.getElementById('seed').value = "Gouda-" + Math.round(1000000 * wielsieder());

        // Control elements
        const statusText = document.getElementById('statusText');
        const soundfontInfo = document.getElementById('soundfontInfo');
        const loadingBar = document.getElementById('loadingBar');
        const loadingProgress = document.getElementById('loadingProgress');
        const ctrl = {
            genreSelect: document.getElementById('genreSelect'),
            roleMode: document.getElementById('roleMode'),
            playAudio: document.getElementById('playAudio'),
            ruleNumber: document.getElementById('ruleNumber'),
            seed: document.getElementById('seed'),
            height: document.getElementById('height'),
            width: document.getElementById('width'),
            cyclic: document.getElementById('cyclic'),
            radialSelect: document.getElementById('radialSelect'),
            showEvolution: document.getElementById('showEvolution'),
            bpm: document.getElementById('bpm'),
            notesPerBeat: document.getElementById('notesPerBeat'),
            durationSec: document.getElementById('durationSec'),
            soundfontFile: document.getElementById('soundfontFile'),
            loadSoundfontBtn: document.getElementById('loadSoundfontBtn'),
            leadInstrument: document.getElementById('leadInstrument'),
            bassInstrument: document.getElementById('bassInstrument'),
            chordsInstrument: document.getElementById('chordsInstrument'),
            drumsKit: document.getElementById('drumsKit'),
            reverbMix: document.getElementById('reverbMix'),
            filterHz: document.getElementById('filterHz'),
            generateBtn: document.getElementById('generateBtn'),
            nextVariationBtn: document.getElementById('nextVariationBtn'),
            randomizeBtn: document.getElementById('randomizeBtn'),
            downloadMidiBtn: document.getElementById('downloadMidiBtn'),
            wolframTonesBtn: document.getElementById('wolframTonesBtn'),
            //stopBtn: document.getElementById('stopBtn'),
            autoPlayBtn: document.getElementById('autoPlayBtn'),
        };

        // ==================== CHORUS ENHANCEMENT SYSTEM ====================
        class ChorusEnhancer {
            constructor() {
                this.currentSection = 'verse';
                this.sectionSteps = 0;
                this.sectionLength = 16; // steps per section
                this.songStructure = ['intro', 'verse', 'pre-chorus', 'chorus', 'verse', 'pre-chorus', 'chorus', 'bridge', 'chorus', 'outro'];
                this.structureIndex = 0;
                this.chorusBoost = {
                    volume: 1.3,
                    density: 1.4,
                    complexity: 1.5,
                    eq: { low: 1.1, mid: 1.4, high: 1.2 }
                };
            }

            advanceSection() {
                this.sectionSteps = 0;
                this.structureIndex = (this.structureIndex + 1) % this.songStructure.length;
                this.currentSection = this.songStructure[this.structureIndex];
                
                // Show chorus indicator
                if (this.currentSection === 'chorus') {
                    this.showChorusIndicator();
                }
                
                console.log(`🎵 Section: ${this.currentSection.toUpperCase()}`);
                return this.currentSection;
            }

            showChorusIndicator() {
                chorusIndicator.classList.add('active');
                setTimeout(() => {
                    chorusIndicator.classList.remove('active');
                }, 2000);
            }

            getSectionMultipliers() {
                const isChorus = this.currentSection === 'chorus';
                const isPreChorus = this.currentSection === 'pre-chorus';
                
                if (isChorus) {
                    return {
                        volume: this.chorusBoost.volume,
                        density: this.chorusBoost.density,
                        complexity: this.chorusBoost.complexity,
                        velocity: 1.2,
                        duration: 1.1
                    };
                } else if (isPreChorus) {
                    return {
                        volume: 1.1,
                        density: 1.2,
                        complexity: 1.1,
                        velocity: 1.0,
                        duration: 1.0
                    };
                } else {
                    return {
                        volume: 1.0,
                        density: 1.0,
                        complexity: 1.0,
                        velocity: 0.8,
                        duration: 0.9
                    };
                }
            }

            step() {
                this.sectionSteps++;
                if (this.sectionSteps >= this.sectionLength) {
                    this.advanceSection();
                }
            }

            applyChorusEffects(events, role) {
                const multipliers = this.getSectionMultipliers();
                const isChorus = this.currentSection === 'chorus';
                
                return events.map(event => {
                    const enhancedEvent = { ...event };
                    
                    // Volume/velocity boost in chorus
                    enhancedEvent.vel = Math.min(1.0, event.vel * multipliers.velocity);
                    
                    // Longer notes in chorus for more epic feel
                    if (isChorus && role !== 'drums') {
                        enhancedEvent.dur = event.dur * multipliers.duration;
                    }
                    
                    // More complex patterns in chorus
                    if (isChorus && wielsieder() < 0.3) {
                        enhancedEvent.midi = enhancedEvent.midi + (wielsieder() < 0.5 ? 1 : -1);
                    }
                    
                    return enhancedEvent;
                });
            }
        }

        const chorusEnhancer = new ChorusEnhancer();

        // ==================== EXPANDED INSTRUMENT DATABASE ====================
        const GM_INSTRUMENTS = [
            "000: Acoustic Grand Piano", "001: Bright Acoustic Piano", "002: Electric Grand Piano", 
            "003: Honky-tonk Piano", "004: Electric Piano 1", "005: Electric Piano 2", 
            "006: Harpsichord", "007: Clavinet", "008: Celesta", "009: Glockenspiel", 
            "010: Music Box", "011: Vibraphone", "012: Marimba", "013: Xylophone", 
            "014: Tubular Bells", "015: Dulcimer", "016: Drawbar Organ", "017: Percussive Organ", 
            "018: Rock Organ", "019: Church Organ", "020: Reed Organ", "021: Accordion", 
            "022: Harmonica", "023: Tango Accordion", "024: Acoustic Guitar (nylon)", 
            "025: Acoustic Guitar (steel)", "026: Electric Guitar (jazz)", "027: Electric Guitar (clean)", 
            "028: Electric Guitar (muted)", "029: Overdriven Guitar", "030: Distortion Guitar", 
            "031: Guitar Harmonics", "032: Acoustic Bass", "033: Electric Bass (finger)", 
            "034: Electric Bass (pick)", "035: Fretless Bass", "036: Slap Bass 1", 
            "037: Slap Bass 2", "038: Synth Bass 1", "039: Synth Bass 2", "040: Violin", 
            "041: Viola", "042: Cello", "043: Contrabass", "044: Tremolo Strings", 
            "045: Pizzicato Strings", "046: Orchestral Harp", "047: Timpani", "048: String Ensemble 1", 
            "049: String Ensemble 2", "050: SynthStrings 1", "051: SynthStrings 2", 
            "052: Choir Aahs", "053: Voice Oohs", "054: Synth Voice", "055: Orchestra Hit", 
            "056: Trumpet", "057: Trombone", "058: Tuba", "059: Muted Trumpet", 
            "060: French Horn", "061: Brass Section", "062: Synth Brass 1", "063: Synth Brass 2", 
            "064: Soprano Sax", "065: Alto Sax", "066: Tenor Sax", "067: Baritone Sax", 
            "068: Oboe", "069: English Horn", "070: Bassoon", "071: Clarinet", 
            "072: Piccolo", "073: Flute", "074: Recorder", "075: Pan Flute", 
            "076: Blown Bottle", "077: Shakuhachi", "078: Whistle", "079: Ocarina", 
            "080: Lead 1 (square)", "081: Lead 2 (sawtooth)", "082: Lead 3 (calliope)", 
            "083: Lead 4 (chiff)", "084: Lead 5 (charang)", "085: Lead 6 (voice)", 
            "086: Lead 7 (fifths)", "087: Lead 8 (bass+lead)", "088: Pad 1 (new age)", 
            "089: Pad 2 (warm)", "090: Pad 3 (polysynth)", "091: Pad 4 (choir)", 
            "092: Pad 5 (bowed)", "093: Pad 6 (metallic)", "094: Pad 7 (halo)", 
            "095: Pad 8 (sweep)", "096: FX 1 (rain)", "097: FX 2 (soundtrack)", 
            "098: FX 3 (crystal)", "099: FX 4 (atmosphere)", "100: FX 5 (brightness)", 
            "101: FX 6 (goblins)", "102: FX 7 (echoes)", "103: FX 8 (sci-fi)", 
            "104: Sitar", "105: Banjo", "106: Shamisen", "107: Koto", "108: Kalimba", 
            "109: Bagpipe", "110: Fiddle", "111: Shanai", "112: Tinkle Bell", 
            "113: Agogo", "114: Steel Drums", "115: Woodblock", "116: Taiko Drum", 
            "117: Melodic Tom", "118: Synth Drum", "119: Reverse Cymbal", "120: Guitar Fret Noise", 
            "121: Breath Noise", "122: Seashore", "123: Bird Tweet", "124: Telephone Ring", 
            "125: Helicopter", "126: Applause", "127: Gunshot"
        ];

        // ==================== GENRE DEFINITIONS WITH EXPANDED INSTRUMENTS ====================










var modulus113 = Math.pow(2, 32);
var modulus101 = Math.pow(2, 32);
var a113 = 1664525;
var c11333 = 1013904223;
var a11xx33 = 1664525;
var sseed11=Math.round(400000000*Math.random());
function wielsieder() {
    //sseed11 = (a11xx33 * sseed11 + c11333) % modulus113;
    return Math.random(); //(sseed11 / modulus101);
}

/**
 * Genereert een "Live" genre-object door willekeurige elementen uit alle bestaande genres te combineren.
 * De selectie is mondiaal synchroon door een tijdgebaseerde seed te gebruiken.
 * * @param {Array<Object>} GENRES - De lijst van bestaande GENRES.
 * @param {function(number=): number} wielsieder - De seeded random functie.
 * - wielsieder(seed) om de generator te initialiseren met een seed (de globale tijd).
 * - wielsieder() om een willekeurige float tussen 0 (incl) en 1 (excl) te krijgen.
 * @returns {Object} Het nieuwe "Live" genre-object.
 */
/**
 * Genereert een mondiaal synchroon "Live" genre.
 */
function generateLiveGenre(GEN) {
    // --- 1. Bereken de mondiale seed op basis van de tijd ---
    // We gebruiken 1 januari 1972 als nulpunt.
    const EPOCH_1972 = new Date(Date.UTC(1972, 0, 1, 0, 0, 0)).getTime();
    const TWO_MINUTES_MS = 2 * 60 * 1000;
    
    const nu = new Date().getTime();
    const verstrekenTijd = nu - EPOCH_1972;
    
    // De 'seed' is het aantal blokken van 2 minuten sinds 1972.
    // Iedereen op de wereld krijgt hier exact hetzelfde gehele getal uit (mits de klok klopt).
    const tijdSeed = Math.floor(verstrekenTijd / TWO_MINUTES_MS);
    
    // Overschrijf de globale sseed11 voor de wielsieder
    sseed11 = tijdSeed;

    // --- 2. Hulpfunctie om geseede willekeurige items te kiezen ---
    const getSeededRandomItem = (array) => {
        const r = wielsieder(); // Gebruikt de nieuwe tijd-seed
        return array[Math.floor(r * array.length)];
    };

    // --- 3. Verzamel alle unieke bouwstenen uit de bestaande GENRES ---
    let pool = {
        scales: [], roots: [], bpms: [], waves: [],
        leads: [], basses: [], chords: [], drums: [],
        leadOpts: [], bassOpts: [], chordsOpts: []
    };

    GEN.forEach(g => {
        if (!pool.scales.includes(g.scale)) pool.scales.push(g.scale);
        if (!pool.roots.includes(g.root)) pool.roots.push(g.root);
        if (!pool.bpms.includes(g.bpm)) pool.bpms.push(g.bpm);
        if (!pool.waves.includes(g.wave)) pool.waves.push(g.wave);
        
        pool.leads.push(g.instruments.lead);
        pool.basses.push(g.instruments.bass);
        pool.chords.push(g.instruments.chords);
        pool.drums.push(g.roles.drums.kit);
        
        // Voeg alle opties toe aan de grote vijver
        pool.leadOpts.push(...g.leadOptions);
        pool.bassOpts.push(...g.bassOptions);
        pool.chordsOpts.push(...g.chordsOptions);
    });

    // Maak de opties-lijsten uniek om dubbelingen te voorkomen
    pool.leadOpts = [...new Set(pool.leadOpts)];
    pool.bassOpts = [...new Set(pool.bassOpts)];
    pool.chordsOpts = [...new Set(pool.chordsOpts)];

    // --- 4. Stel het Live-object samen ---
    // Omdat we wielsieder() telkens in dezelfde volgorde aanroepen, 
    // zal elk onderdeel (sub-i) voor iedereen op de wereld hetzelfde zijn.
    
    const liveGenre = {
        name: "Live",
        scale: getSeededRandomItem(pool.scales),
        root: getSeededRandomItem(pool.roots),
        bpm: getSeededRandomItem(pool.bpms),
        wave: getSeededRandomItem(pool.waves),
        roles: {
            lead: { oct: [4, 5] }, 
            bass: { oct: [2, 3] },
            chords: { oct: [3, 4] },
            drums: { kit: getSeededRandomItem(pool.drums) }
        },
        instruments: {
            lead: getSeededRandomItem(pool.leads),
            bass: getSeededRandomItem(pool.basses),
            chords: getSeededRandomItem(pool.chords)
        },
        // We vullen de lijst aan tot 15 elementen voor de compositie-engine
        leadOptions: Array.from({length: 15}, () => getSeededRandomItem(pool.leadOpts)),
        bassOptions: Array.from({length: 15}, () => getSeededRandomItem(pool.bassOpts)),
        chordsOptions: Array.from({length: 15}, () => getSeededRandomItem(pool.chordsOpts))
    };

    return liveGenre;
}


ee=generateLiveGenre(GENRES );
GENRES[GENRES.length]=ee;




/**
 * Genereert een "Live" ECA-regel object door willekeurige, unieke regels uit alle bestaande ECA-genres te combineren.
 * De selectie is mondiaal synchroon door de tijdgebaseerde globale sseed11 te gebruiken.
 * * @param {Object} GENRE_ECA_RULES - Het object met genre namen en arrays van ECA regels.
 * @returns {Object} Een object { name: 'Live', rules: [array van 4 unieke ECA regels] }.
 */







function generateLiveECA(GENR) {
    // --- 1. Hergebruik de globale synchrone seed berekening ---
    
    // Deze stap is cruciaal voor synchronisatie, maar is al uitgevoerd in de eerste functie.
    // We herhalen het hier om ervoor te zorgen dat bij een directe aanroep van deze functie 
    // de sseed11 correct wordt ingesteld op het huidige 2-minuten interval.
    const EPOCH_START_YEAR = 1972;
    const EPOCH_DATE = new Date(Date.UTC(EPOCH_START_YEAR, 0, 1, 0, 0, 0)); 
    const TWO_MINUTES_IN_MS = 2 * 60 * 1000;
    
    const now = new Date();
    const nowUTC = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), now.getUTCHours(), now.getUTCMinutes(), 0, 0); 
    
    const timeDifferenceMs = nowUTC - EPOCH_DATE.getTime();
    const initialSeed = Math.floor(timeDifferenceMs / TWO_MINUTES_IN_MS);

    // Initialiseer de wielsieder door de globale variabele sseed11 te overschrijven
    // Dit garandeert dat de wielsieder nu dezelfde reeks getallen genereert wereldwijd.
    sseed11 = initialSeed; 

    // --- 2. Verzamel alle unieke ECA-regels uit alle genres ---
    const allUniqueRules = new Set();

    // Loop over alle arrays in het GENRE_ECA_RULES object
    for (const genre in GENR) {
        if (GENR.hasOwnProperty(genre)) {
            const rulesArray = GENRE_ECA_RULES[genre];
            rulesArray.forEach(rule => allUniqueRules.add(rule));
        }
    }
    
    // Converteer de Set naar een Array
    const availableRules = Array.from(allUniqueRules);

    // Functie om N willekeurige unieke elementen uit een pool te selecteren (geseede shuffle)
    const selectRandomSubset = (pool, n = 4) => {
        const shuffled = [...pool];
        
        // Fisher-Yates shuffle met de seeded random functie (wielsieder())
        for (let i = shuffled.length - 1; i > 0; i--) {
            // Gebruik wielsieder voor de gesynchroniseerde willekeurigheid
            const j = Math.floor(wielsieder() * (i + 1)); 
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        
        // Neem de eerste N elementen (standaard 4 voor de ECA Rules)
        return shuffled.slice(0, Math.min(n, pool.length)); 
    };

    // --- 3. Construeer het nieuwe "Live" ECA object ---
    const liveECA = {
        name: 'Live',
        rules: selectRandomSubset(availableRules, 4) // Selecteer 4 unieke, gesynchroniseerde regels
    };

    return liveECA;
}

eee=generateLiveECA(GENRE_ECA_RULES)
GENRE_ECA_RULES[GENRE_ECA_RULES.length]=eee;


        // ==================== AUDIO SYSTEM ====================
        let audioCtx = null;
        let masterGain = null;
        let filterNode = null;
        let convolver = null;
        let reverbGain = null;
        let soundfontPlayer = null;

        function ensureAudio() {
            if (audioCtx) return;
            
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            if (audioCtx.state === 'suspended') {
                audioCtx.resume().then(() => {
                    console.log('AudioContext resumed successfully');
                });
            }
            
            masterGain = audioCtx.createGain();
            masterGain.gain.value = 0.12;
            masterGain.connect(audioCtx.destination);

            ensureAudio.dryGain = masterGain;
            
            soundfontPlayer = new SoundFontPlayer(audioCtx);
            
            console.log("Audio context initialized");
        }

        // ==================== SIMPLIFIED SOUNDFONT PLAYER ====================
        class SoundFontPlayer {
            constructor(audioContext) {
                this.audioContext = audioContext;
                this.sf2 = null;
                this.zoneBuffers = [];
            }

            async loadSoundFont(arrayBuffer) {
                statusText.textContent = "Loading SoundFont...";
                loadingBar.style.display = 'block';
                loadingProgress.style.width = '5%';

                try {
                    // Simplified SF2 loading - just store the buffer
                    this.sf2 = { arrayBuffer };
                    this.zoneBuffers = [];
                    
                    loadingProgress.style.width = '100%';
                    soundfontInfo.textContent = "SoundFont loaded successfully";
                    statusText.textContent = "SoundFont ready for playback";
                    
                    setTimeout(() => {
                        loadingBar.style.display = 'none';
                    }, 300);
                    return true;
                    
                } catch (err) {
                    console.error("SF2 load error:", err);
                    statusText.textContent = "Error loading SoundFont - using fallback synth";
                    soundfontInfo.textContent = "Error loading SoundFont - fallback synth active";
                    loadingBar.style.display = 'none';
                    return false;
                }
            }

            playNote(startTime, duration, midiNote, velocity, program, channel) {
                console.log(`🎹 Play: ch=${channel}, prog=${program}, note=${midiNote}, vel=${velocity}`);
                
                // Always use channel 9 for drums
                if (channel === 9) {
                    console.log(`🥁 Drum: note=${midiNote}`);
                    this.playDrumSynth(startTime, duration, midiNote, velocity);
                    return;
                }

                // Fallback to basic synth
                const freq = 440 * Math.pow(2, (midiNote - 69) / 12);
                const wave = this.getWaveformForProgram(program);
                this.playBasicSynth(startTime, duration, freq, velocity, wave);
            }

            getWaveformForProgram(program) {
                if (program >= 0 && program <= 7) return 'sine';
                if (program >= 8 && program <= 15) return 'sine';
                if (program >= 16 && program <= 23) return 'triangle';
                if (program >= 24 && program <= 31) return 'triangle';
                if (program === 32 || program === 33) return 'triangle';
                if (program === 35) return 'sine';
                if (program === 34 || program === 36 || program === 37) return 'square';
                if (program === 38 || program === 39) return 'triangle';
                if (program >= 40 && program <= 47) return 'sine';
                if (program >= 48 && program <= 55) return 'triangle';
                if (program >= 56 && program <= 63) return 'sawtooth';
                if (program >= 64 && program <= 79) return 'triangle';
                if (program >= 80 && program <= 87) return 'square';
                if (program >= 88 && program <= 95) return 'sine';
                return 'sine';
            }

            playBasicSynth(startTime, duration, frequency, velocity, type = 'sine') {
                if (!audioCtx) return;
                
                const v = Math.max(0.05, Math.min(1.0, velocity));
                const attack = 0.02;
                const decay = 0.1;
                const sustain = 0.6 * v;
                const release = Math.min(0.3, duration * 0.5);
                const noteMaster = audioCtx.createGain();
                
                noteMaster.gain.setValueAtTime(0, startTime);
                noteMaster.gain.linearRampToValueAtTime(v, startTime + attack);
                noteMaster.gain.linearRampToValueAtTime(sustain, startTime + attack + decay);
                noteMaster.gain.setValueAtTime(sustain, startTime + Math.max(0, duration - release));
                noteMaster.gain.linearRampToValueAtTime(0.0001, startTime + duration + release);
                
                if (masterGain) noteMaster.connect(masterGain);

                let oscCount = 1;
                let detuneAmount = 0;

                if (type === 'sawtooth' || type === 'square') {
                    oscCount = 3;
                    detuneAmount = 12;
                }

                for (let i = 0; i < oscCount; i++) {
                    const osc = audioCtx.createOscillator();
                    osc.type = type;
                    let offset = 0;
                    if (i === 1) offset = detuneAmount;
                    if (i === 2) offset = -detuneAmount;

                    osc.detune.value = offset;
                    osc.frequency.setValueAtTime(frequency, startTime);

                    if (type === 'sawtooth') {
                        const filter = audioCtx.createBiquadFilter();
                        filter.type = 'lowpass';
                        filter.Q.value = 3;
                        filter.frequency.setValueAtTime(frequency * 1.5, startTime);
                        filter.frequency.exponentialRampToValueAtTime(frequency * 4, startTime + attack);
                        filter.frequency.exponentialRampToValueAtTime(frequency * 2, startTime + duration);
                        osc.connect(filter);
                        filter.connect(noteMaster);
                    } else {
                        osc.connect(noteMaster);
                    }

                    osc.start(startTime);
                    osc.stop(startTime + duration + release + 0.1);
                }
            }

            playDrumSynth(startTime, duration, midiNote, velocity) {
                if (!audioCtx) return;
                
                const osc = audioCtx.createOscillator();
                const amp = audioCtx.createGain();
                const filter = audioCtx.createBiquadFilter();
                
                if (midiNote === 36 || midiNote === 35) {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(80, startTime);
                    osc.frequency.exponentialRampToValueAtTime(30, startTime + 0.1);
                    filter.frequency.setValueAtTime(200, startTime);
                    filter.type = 'lowpass';
                } else if (midiNote === 38 || midiNote === 40) {
                    osc.type = 'square';
                    filter.type = 'bandpass';
                    filter.frequency.setValueAtTime(1200, startTime);
                    filter.Q.setValueAtTime(0.8, startTime);
                } else {
                    osc.type = 'square';
                    filter.type = 'highpass';
                    filter.frequency.setValueAtTime(6000, startTime);
                }
                
                const v = Math.max(0.05, Math.min(.86, velocity));
                amp.gain.setValueAtTime(v, startTime);
                amp.gain.exponentialRampToValueAtTime(0.0001, startTime + Math.max(0.05, duration * 0.8));
                osc.connect(filter);
                filter.connect(amp);
                
                if (masterGain) amp.connect(masterGain);
                
                osc.start(startTime);
                osc.stop(startTime + duration + 0.02);
            }
        }

        // ==================== MUSIC GENERATION CORE ====================


        const ROOT_TO_SEMITONE = {
            C: 0, 'C#': 1, D: 2, 'D#': 3, E: 4, F: 5, 'F#': 6, 
            G: 7, 'G#': 8, A: 9, 'A#': 10, B: 11
        };

        function midiToFreq(m) {
            return 440 * Math.pow(2, (m - 69) / 12);
        }

        function hashStringToInt(s) {
            let h = 2166136261;
            for (let i = 0; i < s.length; i++) {
                h ^= s.charCodeAt(i);
                h = Math.imul(h, 16777619);
            }
            return h >>> 0;
        }

        function mulberry32(seed) {
            return function() {
                seed |= 0; seed = seed + 0x6D2B79F5 | 0;
                let t = Math.imul(seed ^ seed >>> 15, 1 | seed);
                t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
                return ((t ^ t >>> 14) >>> 0) / 4294967296;
            };
        }

        function evolveGeneralizedCA(rule, width, height, cyclic, radial, rng, seedRowStrategy) {
            const rows = new Array(height);
            let row = new Array(width).fill(0);

            if (seedRowStrategy === 'randomSparse') {
                for (let i = 0; i < width; i++)
                    row[i] = rng() < 0.15 ? 1 : 0;
            } else {
                row[Math.floor(width / 2)] = 1;
            }
            rows[0] = row.slice();

            const neighborhoodCount = Math.pow(2, 2 * radial + 1);
            const ruleBits = new Array(neighborhoodCount);
            for (let mask = 0; mask < neighborhoodCount; mask++) {
                ruleBits[mask] = (rule >> mask) & 1;
            }

            for (let h = 1; h < height; h++) {
                const next = new Array(width);
                for (let x = 0; x < width; x++) {
                    let neighborhoodIndex = 0;

                    for (let j = -radial; j <= radial; j++) {
                        let cellState;

                        if (cyclic) {
                            const neighborIndex = (x + j + width) % width;
                            cellState = row[neighborIndex];
                        } else {
                            const neighborIndex = x + j;
                            if (neighborIndex < 0 || neighborIndex >= width) {
                                cellState = 0;
                            } else {
                                cellState = row[neighborIndex];
                            }
                        }

                        const bitPos = radial - j;

                        if (cellState === 1) {
                            neighborhoodIndex += Math.pow(2, bitPos);
                        }
                    }

                    next[x] = ruleBits[neighborhoodIndex];
                }
                rows[h] = next;
                row = next;
            }
            return rows;
        }

        function getRulde(genreName, role) {
            const ruleSet = GENRE_ECA_RULES[genreName] || [90, 60, 102];
            if (role === 'lead') return ruleSet[0];
            if (role === 'bass') return ruleSet[1];
            if (role === 'chords') return ruleSet[2];
            if (role === 'drums') return ruleSet[3];
            return 90;
        }

        
		function mapRoleEvents(rows, role, scaleName, rootName, bpm, notesPerBeat, durationSec, rng) {
    const scale = SCALE_SEMITONES[scaleName] || SCALE_SEMITONES.pentatonic;
    const root = ROOT_TO_SEMITONE[rootName] || 0;
    const secondsPerBeat = 60 / bpm;
    const stepDur = secondsPerBeat / notesPerBeat;

    const durationMultiplier = 1 + rng() * 2;
    const extendedDurationSec = durationSec * durationMultiplier;
    const totalSteps = Math.floor(extendedDurationSec / stepDur);

    const width = rows[0].length, height = rows.length;
    const events = [];

    const silencePeriods = [];
    const numSilencePeriods = Math.floor(rng() * 3);
    for (let i = 0; i < numSilencePeriods; i++) {
        const startStep = Math.floor(rng() * totalSteps * 0.7);
        const durationSteps = Math.floor(4 + rng() * 16);
        silencePeriods.push({ start: startStep, duration: durationSteps });
    }

    for (let t = 0; t < totalSteps; t++) {
        let inSilence = false;
        for (const silence of silencePeriods) {
            if (t >= silence.start && t < silence.start + silence.duration) {
                inSilence = true;
                break;
            }
        }

        const r = Math.floor((t / totalSteps) * (height - 1));
        const c = t % width;
        const cell = rows[r][c];
        
        // Calculate beatInMeasure based on time and time signature
        const beatsPerMeasure = 4; // Common time signature
        const stepsPerBeat = 1; // Since we're working in steps already
        const stepsPerMeasure = beatsPerMeasure * stepsPerBeat;
        const beatInMeasure = t % stepsPerMeasure;

        let scaleIdx, octave, durMult = 1.0, rest = false, vel = 0.5;

        if (role === 'lead') {
            const baseIdx = (cell ? 2 : 1) + (t % 4) + Math.floor(wielsieder() * 2);
            scaleIdx = baseIdx % scale.length;
            octave = rng() < 0.2 ? 6 : 5;
            vel = 0.5 + 0.4 * (cell ? 1 : 0.3);
            rest = inSilence || (t % 8 === 0 && rng() < 0.3);
            durMult = (t % 4 === 0) ? 1.2 : 0.9;
        } else if (role === 'bass') {
            const baseIdx = (cell ? 0 : 1) + (t % 2);
            scaleIdx = baseIdx % Math.min(scale.length, 5);
            octave = 2;
            vel = 0.4 + 0.25 * (cell ? 1 : 0.5);
            rest = inSilence || ((t % 8 !== 0) && rng() < 0.15);
            durMult = 1.4;
        } else if (role === 'chords') {
            const baseIdx = (cell ? 1 : 0) + (t % 3);
            scaleIdx = baseIdx % scale.length;
            octave = 4;
            vel = 0.45 + 0.4 * (cell ? 1 : 0.3);
            rest = inSilence || (t % 8 === 4 && rng() < 0.4);
            durMult = 1.6;
        } else if (role === 'drums') {
            const genreIndex = parseInt(ctrl.genreSelect.value, 10);
            const genre = GENRES[genreIndex];
            const kitName = genre.roles.drums.kit;
            const percussionNotes = GENRE_PERCUSSION[kitName] || [36, 38, 42];
            const rhythmPatterns = GENRE_PERCUSSION_ONS[kitName] || GENRE_PERCUSSION_ONS['pop'];

            const hatNote = percussionNotes[2] || 42;
            const snareNote = percussionNotes[1] || 38;
            const kickNote = percussionNotes[0] || 36;

            // Use genre-specific rhythm patterns with proper beatInMeasure
            const [hatOnFn, hatDur] = rhythmPatterns[0];
            const [snareOnFn, snareDur] = rhythmPatterns[1];
            const [kickOnFn, kickDur] = rhythmPatterns[2];

            const hatOn = hatOnFn(beatInMeasure) && !inSilence && (cell || rng() < 0.7);
            const snareOn = snareOnFn(beatInMeasure) && !inSilence && (cell || rng() < 0.8);
            const kickOn = kickOnFn(beatInMeasure) && !inSilence && (cell || rng() < 0.9);

            if (hatOn) events.push({
                role: 'drums', lane: 'hat', startStep: t,
                dur: stepDur * hatDur, vel: 0.8, rest: false, midi: hatNote
            });
            if (snareOn) events.push({
                role: 'drums', lane: 'snare', startStep: t,
                dur: stepDur * snareDur, vel: 1.0, rest: false, midi: snareNote
            });
            if (kickOn) events.push({
                role: 'drums', lane: 'kick', startStep: t,
                dur: stepDur * kickDur, vel: 1.0, rest: false, midi: kickNote
            });
            continue;
        }

        const midi = 12 * octave + root + scale[scaleIdx];
        const freq = midiToFreq(midi);
        const dur = stepDur * durMult * (rest ? 0 : 1);
        events.push({ role, startStep: t, dur, freq, vel, rest, midi });
    }
    
    return { events, stepDur, extendedDurationSec };
}
		
        function randomActiveRoles(mode, rng) {
            const roles = ['lead', 'bass', 'chords', 'drums'];
            if (mode === 'all') return roles;
            if (mode === 'leadBass') return ['lead', 'bass'];
            if (mode === 'leadChords') return ['lead', 'chords'];
            if (mode === 'bassDrums') return ['bass', 'drums'];
            const count = 2 + Math.floor(rng() * 3);
            const pool = roles.slice();
            const chosen = [];
            for (let i = 0; i < count; i++) {
                const idx = Math.floor(rng() * pool.length);
                chosen.push(pool[idx]);
                pool.splice(idx, 1);
            }
            return chosen;
        }

        let lastCompByRole = null;
        let lastBpm = null;


/*
  function generateAll() {
                const genre = GENRES[parseInt(ctrl.genreSelect.value, 10)];
                xxx = ctrl.ruleNumber.value;
                xx = xxx.split('#');
                if (xx.length > 1) {

                    const rule = parseInt(xx[1], 10);
                } else {
                    const rule = parseInt(ctrl.ruleNumber.value, 10);
                }
                const seedStr = ctrl.seed.value;
                const height = parseInt(ctrl.height.value, 10);
                const width = parseInt(ctrl.width.value, 10);
                const cyclic = ctrl.cyclic.checked;

                let ruleNumber;

                if (currentRadial === 2) {
                    const numRules = rultypeRad2.length;
                    const ruleIndex = variationIndex % numRules;

                    ruleNumber = rultypeRad2[ruleIndex];
                    statusText.textContent = `Radiaal 2 Geselecteerd. Regel Index: ${ruleIndex} (Waarde: ${ruleNumber})`;

                } else {//ruleNumber = parseInt(ctrl.ruleNumber.value, 10); 
                // statusText.textContent = `Radiaal 1 Geselecteerd. Regel: ${ruleNumber}`;
                }

                const genreIndex = parseInt(ctrl.genreSelect.value, 10);
                document.getElementById('playerTitle').innerHTML = GENRES[genreIndex].name;
                const genreName = GENRES[genreIndex].name;

                const ruleSet = GENRE_ECA_RULES[genreName];
                // || [90, 60, 102]; // Default to a safe set (90, 60, 102)

                function getRule(genreName, role) {
                    let rule = 90;
                    // Default Rule 90 for safety
                    //alert(genreName);
                    if (role === 'lead') {
                        rule = ruleSet[0];

                        xxx = ctrl.ruleNumber.value;
                        xx = xxx.split('#');
                        if (xx.length > 1) {
                            rule = parseInt(xx[1], 10);

                        } else {
                            document.getElementById('ruleNumber').value = ruleSet[0];

                        }

                        //document.getElementById('ruleNumber').value="#"+rule;
                        //ctrl.ruleNumber.value=rule;

                    } else if (role === 'bass') {
                        rule = ruleSet[1];
                    } else if (role === 'chords') {
                        rule = ruleSet[2];
                    } else if (role === 'drums') {
                        rule = ruleSet[3];
                    }

                    return rule;
                    // Returns the simple ECA rule (e.g., 51, 90, 110)
                }

                const bpm = parseInt(ctrl.bpm.value, 10);
                const npb = parseInt(ctrl.notesPerBeat.value, 10);
                const durationSec = parseFloat(ctrl.durationSec.value);

                const baseSeedInt = hashStringToInt(`${genreName}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
                const rng = mulberry32(baseSeedInt);

                const scaleName = genre.scale;
                const rootName = genre.root;
                const activeRoles = randomActiveRoles(ctrl.roleMode.value, rng);

                const compByRole = {};
                const instrumentByRole = {};

                function chooseWave(base) {
                    const w = ['sine', 'triangle', 'sawtooth', 'square'];
                    if (base === 'sine')
                        return rng() < 0.7 ? 'sine' : w[Math.floor(rng() * w.length)];
                    if (base === 'triangle')
                        return rng() < 0.7 ? 'triangle' : w[Math.floor(rng() * w.length)];
                    if (base === 'sawtooth')
                        return rng() < 0.7 ? 'sawtooth' : w[Math.floor(rng() * w.length)];
                    return rng() < 0.7 ? 'square' : w[Math.floor(rng() * w.length)];
                }

                let gridHash = '';
                let extendedDuration = durationSec;

                activeRoles.forEach(role => {

                    const roleRule = getRule(genreName, role);

                    const roleSeedInt = hashStringToInt(`${genreName}|${roleRule}|${role}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
                    const roleRng = mulberry32(roleSeedInt);

                    const seedStrategy = roleRng() < 0.5 ? 'randomSparse' : 'singleCenter';

                    const rows = evolveGeneralizedCA(roleRule, width, height, cyclic, currentRadial, roleRng, seedStr);

                    const currentGridHash = hashRows(rows);
                    if (role === 'lead' && currentGridHash === gridHash) {
                        rows[0][Math.floor(roleRng() * width)] ^= 1;
                    }
                    gridHash = currentGridHash;

                    const comp = mapRoleEvents(rows, role, scaleName, rootName, bpm, npb, durationSec, roleRng);
                    comp.events.forEach(ev => {
                        if (role !== 'drums' && ev.freq) {
                            ev.midi = Math.round(69 + 12 * Math.log2(ev.freq / 440));
                        }
                    }
                    );

                    compByRole[role] = comp;
                    instrumentByRole[role] = {
                        wave: chooseWave(genre.wave)
                    };

                    extendedDuration = Math.max(extendedDuration, comp.extendedDurationSec || durationSec);
                }
                );

                lastCompByRole = compByRole;
                lastBpm = bpm;

                if (ctrl.showEvolution.checked) {
                    const lastRole = activeRoles[activeRoles.length - 1];
                    const lastRoleRule = getRule(genreName, lastRole);
                    const lastRoleSeedInt = hashStringToInt(`${genreName}|${lastRoleRule}|${lastRole}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
                    const lastRoleRng = mulberry32(lastRoleSeedInt);
                    const lastRows = evolveGeneralizedCA(lastRoleRule, width, height, cyclic, currentRadial, lastRoleRng, seedStr);
                    drawEvolution(lastRows);
                }

                statusText.textContent = `${genreName} | roles: ${activeRoles.join(', ')} | rules: [${getRule(genreName, 'lead')}, ${getRule(genreName, 'bass')}, ${getRule(genreName, 'chords')}] | seed "${seedStr}", ${height}x${width}, cyclic=${cyclic}. Variation ${variationIndex}. Duration: ${extendedDuration.toFixed(1)}s`;

                if (ctrl.playAudio.checked)
                    scheduleMulti(compByRole, instrumentByRole);
            }

  
*/






function generateAllo() {
            const genreIndex = parseInt(ctrl.genreSelect.value, 10);
            const genre = GENRES[genreIndex];
            const genreName = genre.name;

            const ruleNumber = parseInt(ctrl.ruleNumber.value, 10);
            const seedStr = ctrl.seed.value;
            const height = parseInt(ctrl.height.value, 10);
            const width = parseInt(ctrl.width.value, 10);
            const cyclic = ctrl.cyclic.checked;
            const bpm = parseInt(ctrl.bpm.value, 10);
            const npb = parseInt(ctrl.notesPerBeat.value, 10);
            const durationSec = parseFloat(ctrl.durationSec.value);

            const baseSeedInt = hashStringToInt(`${genreName}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
            const rng = mulberry32(baseSeedInt);

            const scaleName = genre.scale;
            const rootName = genre.root;
            const activeRoles = randomActiveRoles(ctrl.roleMode.value, rng);

            const compByRole = {};
            const instrumentByRole = {};

            let extendedDuration = durationSec;

            activeRoles.forEach(role => {
                const roleRule = getRulde(genreName, role);
				if(role=="lead"){
				    const rule = Math.floor(wielsieder() * 256);
					ctrl.ruleNumber.value = roleRule;
	
				}
				
                const roleSeedInt = hashStringToInt(`${genreName}|${roleRule}|${role}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
                const roleRng = mulberry32(roleSeedInt);

                const seedStrategy = roleRng() < 0.5 ? 'randomSparse' : 'singleCenter';
                const rows = evolveGeneralizedCA(roleRule, width, height, cyclic, currentRadial, roleRng, seedStr);

                const comp = mapRoleEvents(rows, role, scaleName, rootName, bpm, npb, durationSec, roleRng);
                comp.events.forEach(ev => {
                    if (role !== 'drums' && ev.freq) {
                        ev.midi = Math.round(69 + 12 * Math.log2(ev.freq / 440));
                    }
                });

                compByRole[role] = comp;
                instrumentByRole[role] = { wave: genre.wave };
                extendedDuration = Math.max(extendedDuration, comp.extendedDurationSec || durationSec);
            });

            lastCompByRole = compByRole;
            lastBpm = bpm;
			MIDIF=genreName+(Math.floor(100000000*wielsieder()))+'.mid'; 

            statusText.textContent = `${genreName} | roles: ${activeRoles.join(', ')} | rules: [${getRulde(genreName, 'lead')}, ${getRulde(genreName, 'bass')}, ${getRulde(genreName, 'chords')}] | seed "${seedStr}", ${height}x${width}, cyclic=${cyclic}. Variation ${variationIndex}. Duration: ${extendedDuration.toFixed(1)}s`;

      //      if (ctrl.playAudio.checked) scheduleMulti(compByRole, instrumentByRole);
        }





  function generateAll() {
            const genreIndex = parseInt(ctrl.genreSelect.value, 10);
            const genre = GENRES[genreIndex];
            const genreName = genre.name;

            const ruleNumber = parseInt(ctrl.ruleNumber.value, 10);
            const seedStr = ctrl.seed.value;
            const height = parseInt(ctrl.height.value, 10);
            const width = parseInt(ctrl.width.value, 10);
            const cyclic = ctrl.cyclic.checked;
            const bpm = parseInt(ctrl.bpm.value, 10);
            const npb = parseInt(ctrl.notesPerBeat.value, 10);
            const durationSec = parseFloat(ctrl.durationSec.value);

            const baseSeedInt = hashStringToInt(`${genreName}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
            const rng = mulberry32(baseSeedInt);

            const scaleName = genre.scale;
            const rootName = genre.root;
            const activeRoles = randomActiveRoles(ctrl.roleMode.value, rng);

            const compByRole = {};
            const instrumentByRole = {};

            let extendedDuration = durationSec;

            activeRoles.forEach(role => {
                const roleRule = getRulde(genreName, role);
				if(role=="lead"){
				    const rule = Math.floor(wielsieder() * 256);
					ctrl.ruleNumber.value = roleRule;
	
				}
				
                const roleSeedInt = hashStringToInt(`${genreName}|${roleRule}|${role}|${seedStr}|${height}|${width}|${cyclic}|${bpm}|${npb}|${durationSec}|${variationIndex}`);
                const roleRng = mulberry32(roleSeedInt);

                const seedStrategy = roleRng() < 0.5 ? 'randomSparse' : 'singleCenter';
                const rows = evolveGeneralizedCA(roleRule, width, height, cyclic, currentRadial, roleRng, seedStr);

                const comp = mapRoleEvents(rows, role, scaleName, rootName, bpm, npb, durationSec, roleRng);
                comp.events.forEach(ev => {
                    if (role !== 'drums' && ev.freq) {
                        ev.midi = Math.round(69 + 12 * Math.log2(ev.freq / 440));
                    }
                });

                compByRole[role] = comp;
                instrumentByRole[role] = { wave: genre.wave };
                extendedDuration = Math.max(extendedDuration, comp.extendedDurationSec || durationSec);
            });

            lastCompByRole = compByRole;
            lastBpm = bpm;

            statusText.textContent = `${genreName} | roles: ${activeRoles.join(', ')} | rules: [${getRulde(genreName, 'lead')}, ${getRulde(genreName, 'bass')}, ${getRulde(genreName, 'chords')}] | seed "${seedStr}", ${height}x${width}, cyclic=${cyclic}. Variation ${variationIndex}. Duration: ${extendedDuration.toFixed(1)}s`;

            if (ctrl.playAudio.checked) scheduleMulti(compByRole, instrumentByRole);
        }

        // ==================== PLAYBACK SCHEDULER ====================
        let playbackTimer = null;
        let isAutoPlaying = false;

        function scheduleMulti(compByRole, instrumentByRole) {
            ensureAudio();
            chorusEnhancer.advanceSection(); // Start with first section

            const now = audioCtx.currentTime;
            const lookAhead = 0.15;
            const scheduleInterval = 50;

            const indices = { lead: 0, bass: 0, chords: 0, drums: 0 };
            const steps = {
                lead: compByRole.lead?.stepDur || 0.2,
                bass: compByRole.bass?.stepDur || 0.2,
                chords: compByRole.chords?.stepDur || 0.2,
                drums: compByRole.drums?.stepDur || 0.2
            };

            playbackTimer = setInterval(() => {
                var ct = 1;
				try{ ct = audioCtx.currentTime; }
				catch(v){ }

                function process(role) {
                    const comp = compByRole[role];
                    if (!comp) return;
                    const inst = instrumentByRole[role];
                    
					    const genreIndex = parseInt(ctrl.genreSelect.value, 10);
    const genre = GENRES[genreIndex];
					
					
                    while (indices[role] < comp.events.length) {
                        const ev = comp.events[indices[role]];
                        const start = now + ev.startStep * steps[role];
                        
                        if (start < ct + lookAhead) {
                            if (!ev.rest) {
                                if (role === 'drums') {
                                    const doubledVelocity = Math.min(1.0, ev.vel * 2);
                                    if (soundfontPlayer) {
                                        soundfontPlayer.playNote(start, ev.dur, ev.midi, doubledVelocity, 0, 9);
                                    }
                                } else {
                                    const programMap = {
                                        lead: parseInt(ctrl.leadInstrument.value, 10) || genre.instruments?.lead || 0,
                                        bass: parseInt(ctrl.bassInstrument.value, 10) || genre.instruments?.bass || 32,
                                        chords: parseInt(ctrl.chordsInstrument.value, 10) || genre.instruments?.chords || 0
                                    };
                                    
                                    const program = programMap[role] || 0;
                                    const channelMap = { lead: 0, bass: 1, chords: 2, drums: 9 };
                                    const channel = channelMap[role] || 0;
                                    
                                    playNote(start, ev.dur, ev.freq, ev.vel, inst.wave, channel, program);
                                }
                            }
                            indices[role]++;
                        } else break;
                    }
					
					return true;
                }

                process('lead');
                process('bass');
                process('chords');
                process('drums');

                // Advance chorus section
                chorusEnhancer.step();

                const done = (!compByRole.lead || indices.lead >= compByRole.lead.events.length) &&
                    (!compByRole.bass || indices.bass >= compByRole.bass.events.length) &&
                    (!compByRole.chords || indices.chords >= compByRole.chords.events.length) &&
                    (!compByRole.drums || indices.drums >= compByRole.drums.events.length);
                
                if (done) {
                    clearInterval(playbackTimer);
                    playbackTimer = null;
                    statusText.textContent = 'Playback finished.';
                    if (isAutoPlaying) {
                        setTimeout(() => {
                            if (isAutoPlaying) generateRandomTrack();
                        }, 1000);
                    }
                }
            }, scheduleInterval);
            statusText.textContent = 'Playing...';
        }

        function playNote(start, dur, freq, velocity, instrumentType, channel = 0, program = 0) {
            if (!audioCtx) return;
            const midiNote = Math.round(69 + 12 * Math.log2(freq / 440));

            if (soundfontPlayer) {
                soundfontPlayer.playNote(start, dur, midiNote, velocity, program, channel);
            }
        }

        // ==================== UI INITIALIZATION ====================
     function populateGenreInstruments(genreIndex) {
    const genre = GENRES[genreIndex];

    const roleMaps = {
        leadInstrument: { options: genre.leadOptions, defaultGM: genre.instruments.lead },
        bassInstrument: { options: genre.bassOptions, defaultGM: genre.instruments.bass },
        chordsInstrument: { options: genre.chordsOptions, defaultGM: genre.instruments.chords },
    };

    for (const roleId in roleMaps) {
        const select = ctrl[roleId];
        const optionsData = roleMaps[roleId];
        const options = optionsData.options || [];
        const defaultInst = optionsData.defaultGM;

        select.innerHTML = '';

        if (options.length === 0) {
            const opt = document.createElement('option');
            opt.value = -1;
            opt.textContent = "No genre options";
            select.appendChild(opt);
            continue;
        }

        options.forEach(index => {
            const opt = document.createElement('option');
            opt.value = index;
            opt.textContent = GM_INSTRUMENTS[index] || `Instr ${index}`;
            select.appendChild(opt);
        });

        // RANDOM SELECTION instead of always first element
        if (options.length > 0) {
            const randomIndex = Math.floor(wielsieder() * options.length);
            select.value = options[randomIndex];
        } else if (defaultInst !== undefined && options.includes(defaultInst)) {
            select.value = defaultInst;
        } else {
            select.value = options[0];
        }
    }
}

function applyGenreSettings(genreIndex) {
    if (isNaN(genreIndex)) genreIndex = 0;
    const genre = GENRES[genreIndex];
    if (!genre) return;

    populateGenreInstruments(genreIndex);
    ctrl.bpm.value = genre.bpm;
    playerTitle.textContent = genre.name;
    
    // Force a new random selection each time
    const rng = wielsieder();
    if (ctrl.leadInstrument.options.length > 0) {
        const randomLead = Math.floor(rng * ctrl.leadInstrument.options.length);
        ctrl.leadInstrument.selectedIndex = randomLead;
    }
    if (ctrl.bassInstrument.options.length > 0) {
        const randomBass = Math.floor(rng * 0.3 * ctrl.bassInstrument.options.length); // Slightly weighted toward beginning
        ctrl.bassInstrument.selectedIndex = randomBass;
    }
    if (ctrl.chordsInstrument.options.length > 0) {
        const randomChords = Math.floor(rng * ctrl.chordsInstrument.options.length);
        ctrl.chordsInstrument.selectedIndex = randomChords;
    }
}
        // Initialize genre select
        (function initGenreSelect() {
            const sel = ctrl.genreSelect;
            sel.innerHTML = '';
            GENRES.forEach((g, i) => {
                const opt = document.createElement('option');
                opt.value = i;
                opt.textContent = g.name;
                sel.appendChild(opt);
            });
            sel.value = 0;
            applyGenreSettings(0);

            sel.addEventListener('change', function() {
                applyGenreSettings(parseInt(this.value, 10));
            });
        })();
		
		
		
		
		
		
		
			
       const workerCode = `
  function writeUint32(view, offset, value) {
    view.setUint32(offset, value, false); // Big Endian
    return offset + 4;
  }
  function writeUint16(view, offset, value) {
    view.setUint16(offset, value, false);
    return offset + 2;
  }
  function writeVarint(view, offset, value) {
    if (value < 0) value = 0; 
    let buffer = [];
    do {
      let byte = value & 0x7F;
      value >>>= 7;
      if (buffer.length > 0) byte |= 0x80;
      buffer.push(byte);
    } while (value > 0);
    
    for (let i = buffer.length - 1; i >= 0; i--) {
      view.setUint8(offset++, buffer[i]);
    }
    return offset;
  }
  
  function bpmToMicroseconds(bpm) {
    return Math.round(60000000 / bpm);
  }

  function createMidiTrack(events, ppq, channel, program, trackName) {
    const midiActions = [];
    
    events.forEach(ev => {
      const startTick = Math.round(ev.start * ppq);
      const endTick = Math.round((ev.start + ev.dur) * ppq);
      const velocity = Math.max(1, Math.min(127, Math.round(ev.vel * 127)));
      
      midiActions.push({
        tick: startTick,
        type: 0x90, // Note On
        byte1: ev.midi,
        byte2: velocity
      });
      
      midiActions.push({
        tick: endTick,
        type: 0x80, // Note Off
        byte1: ev.midi,
        byte2: 0
      });
    });

    midiActions.sort((a, b) => {
      if (a.tick !== b.tick) return a.tick - b.tick;
      return (a.type === 0x80 ? -1 : 1);
    });

    const bufferSize = 1024 + (midiActions.length * 8); // Safe estimate
    const buffer = new ArrayBuffer(bufferSize);
    const view = new DataView(buffer);
    let offset = 0;

    if (trackName) {
      offset = writeVarint(view, offset, 0);
      view.setUint8(offset++, 0xFF);
      view.setUint8(offset++, 0x03);
      const nameBytes = new TextEncoder().encode(trackName);
      view.setUint8(offset++, nameBytes.length);
      for (let b of nameBytes) view.setUint8(offset++, b);
    }

    offset = writeVarint(view, offset, 0);
    view.setUint8(offset++, 0xC0 | channel);
    view.setUint8(offset++, program);

    let lastTick = 0;
    for (const action of midiActions) {
      const delta = action.tick - lastTick;
      offset = writeVarint(view, offset, delta);
      view.setUint8(offset++, action.type | channel);
      view.setUint8(offset++, action.byte1);
      view.setUint8(offset++, action.byte2);
      lastTick = action.tick;
    }

    offset = writeVarint(view, offset, 0);
    view.setUint8(offset++, 0xFF);
    view.setUint8(offset++, 0x2F);
    view.setUint8(offset++, 0x00);

    return buffer.slice(0, offset);
  }

  function buildMIDI(compByRole, ppq, bpm, roleInstruments, drumKitMap) {
    const microsecondsPerBeat = bpmToMicroseconds(bpm);
    const tracks = [];
    
    const tempoBuf = new ArrayBuffer(128);
    const tView = new DataView(tempoBuf);
    let tOff = 0;
    
    tOff = writeVarint(tView, tOff, 0);
    tView.setUint8(tOff++, 0xFF); tView.setUint8(tOff++, 0x51); tView.setUint8(tOff++, 0x03);
    tView.setUint8(tOff++, (microsecondsPerBeat >> 16) & 0xFF);
    tView.setUint8(tOff++, (microsecondsPerBeat >> 8) & 0xFF);
    tView.setUint8(tOff++, microsecondsPerBeat & 0xFF);
    
    tOff = writeVarint(tView, tOff, 0);
    tView.setUint8(tOff++, 0xFF); tView.setUint8(tOff++, 0x58); tView.setUint8(tOff++, 0x04);
    tView.setUint8(tOff++, 0x04); tView.setUint8(tOff++, 0x02); tView.setUint8(tOff++, 0x18); tView.setUint8(tOff++, 0x08);
    
    tOff = writeVarint(tView, tOff, 0);
    tView.setUint8(tOff++, 0xFF); tView.setUint8(tOff++, 0x2F); tView.setUint8(tOff++, 0x00);
    tracks.push(tempoBuf.slice(0, tOff));

    const roleConfigs = [
      { role: 'lead', channel: 0, program: roleInstruments.lead, name: 'Lead' },
      { role: 'bass', channel: 1, program: roleInstruments.bass, name: 'Bass' },
      { role: 'chords', channel: 2, program: roleInstruments.chords, name: 'Chords' },
      { role: 'drums', channel: 9, program: roleInstruments.drums, name: 'Drums' }
    ];

    const beatScalar = bpm / 60.0;

    roleConfigs.forEach(config => {
      const comp = compByRole[config.role];
      if (!comp || !comp.events) return;

      const processedEvents = comp.events
        .filter(ev => !ev.rest && ev.midi != null)
        .map(ev => {
          let v = ev.vel || 0.7;
          let note = ev.midi;

          if (config.role === 'drums') {
             v = Math.min(1.0, v * 1.5); // Boost drums
             
             if (drumKitMap && ev.lane) {
                 if (ev.lane === 'kick' && drumKitMap.kick) note = drumKitMap.kick;
                 else if (ev.lane === 'snare' && drumKitMap.snare) note = drumKitMap.snare;
                 else if (ev.lane === 'hat' && drumKitMap.hat) note = drumKitMap.hat;
             }
          }

          return {
            start: (ev.startStep * comp.stepDur) * beatScalar, // Exact Beat Start
            dur: ev.dur * beatScalar,                         // Exact Beat Dur
            midi: note,
            vel: v
          };
        });

      if (processedEvents.length > 0) {
        tracks.push(createMidiTrack(processedEvents, ppq, config.channel, config.program, config.name));
      }
    });

    let totalSize = 14; // Header size
    tracks.forEach(t => totalSize += (8 + t.byteLength));
    
    const finalBuf = new ArrayBuffer(totalSize);
    const view = new DataView(finalBuf);
    let offset = 0;

    view.setUint8(offset++, 0x4D); view.setUint8(offset++, 0x54); view.setUint8(offset++, 0x68); view.setUint8(offset++, 0x64);
    offset = writeUint32(view, offset, 6);
    offset = writeUint16(view, offset, 1); // Format 1 (Multi-track)
    offset = writeUint16(view, offset, tracks.length);
    offset = writeUint16(view, offset, ppq);

    tracks.forEach(track => {
      view.setUint8(offset++, 0x4D); view.setUint8(offset++, 0x54); view.setUint8(offset++, 0x72); view.setUint8(offset++, 0x6B);
      offset = writeUint32(view, offset, track.byteLength);
      new Uint8Array(finalBuf, offset, track.byteLength).set(new Uint8Array(track));
      offset += track.byteLength;
    });

    return finalBuf;
  }

  self.onmessage = function(e) {
    try {
      const { compByRole, ppq, bpm, roleInstruments, drumKitMap } = e.data;
      if (!compByRole) throw new Error("No data");
      
      const midiBytes = buildMIDI(compByRole, ppq || 480, bpm || 120, roleInstruments || {}, drumKitMap || {});
      self.postMessage({ type: 'midi_ready', buffer: midiBytes }, [midiBytes]);
    } catch (err) {
      self.postMessage({ type: 'midi_error', message: err.toString() });
    }
  };
`;











function downloadMidiWithEntryo(base64Data, entryoValue) {
    // 1. Convert Base64 to Uint8Array
    const binaryString = window.atob(base64Data);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
    }

    // 2. Prepare the Meta Event: FF 02 [length] [text]
    const encoder = new TextEncoder();
    const entryoBytes = encoder.encode(entryoValue);
    const metaHeader = new Uint8Array([0x00, 0xFF, 0x02, entryoBytes.length]);
    
    // 3. Combine bytes
    // Note: We inject this at the start of the first MTrk chunk (usually offset 22)
    // A standard MIDI header is 14 bytes, followed by 'MTrk' (4 bytes) and length (4 bytes)
    const injectionPoint = 22; 
    const newMidi = new Uint8Array(bytes.length + metaHeader.length + entryoBytes.length);
    
    newMidi.set(bytes.slice(0, injectionPoint), 0);
    newMidi.set(metaHeader, injectionPoint);
    newMidi.set(entryoBytes, injectionPoint + metaHeader.length);
    newMidi.set(bytes.slice(injectionPoint), injectionPoint + metaHeader.length + entryoBytes.length);

    // 4. Update the Track Chunk size (the 4 bytes before injectionPoint)
    // This ensures the MIDI file remains valid
    const oldSize = (bytes[18] << 24) | (bytes[19] << 16) | (bytes[20] << 8) | bytes[21];
    const newSize = oldSize + metaHeader.length + entryoBytes.length;
    newMidi[18] = (newSize >> 24) & 0xFF;
    newMidi[19] = (newSize >> 16) & 0xFF;
    newMidi[20] = (newSize >> 8) & 0xFF;
    newMidi[21] = newSize & 0xFF;

    // 5. Trigger Download
    const blob = new Blob([newMidi], { type: 'audio/midi' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = "output_with_violation.mid";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}





function downloadMIDI() {
    try {
        const ablob = new Blob([workerCode], { type: 'application/javascript' });
        const aworkerUrl = URL.createObjectURL(ablob);
        midiWorker = new Worker(aworkerUrl);

        midiWorker.onmessage = function(e) {
            const { type, buffer, message } = e.data;

            if (type === 'midi_ready') {
                try {
                    let finalBuffer = buffer;
                    
                    // 1. Prepare the text from the entryo variable

const entryoValue = entryo; //(typeof entryo !== 'undefined' && entryo) ? "SIGNAL: " + String(entryo) : "";

if (entryoValue.length > 0) {
    const originalBytes = new Uint8Array(buffer);
    const encoder = new TextEncoder();
    const entryoBytes = encoder.encode(entryoValue);
    
    // 0xFF 0x01 is a Text Event. 
    // TiMidity and FluidSynth are much more likely to print this to the console.
    const metaEvent = new Uint8Array([0x00, 0xFF, 0x01, entryoBytes.length, ...entryoBytes]);
    
    const injectionPoint = 22; // Start of first track data
    const newMidi = new Uint8Array(originalBytes.length + metaEvent.length);
    
    newMidi.set(originalBytes.slice(0, injectionPoint), 0);
    newMidi.set(metaEvent, injectionPoint);
    newMidi.set(originalBytes.slice(injectionPoint), injectionPoint + metaEvent.length);

    // Update the Track Chunk size (Bytes 18-21)
    const oldSize = (originalBytes[18] << 24) | (originalBytes[19] << 16) | (originalBytes[20] << 8) | originalBytes[21];
    const newSize = oldSize + metaEvent.length;
    newMidi[18] = (newSize >> 24) & 0xFF;
    newMidi[19] = (newSize >> 16) & 0xFF;
    newMidi[20] = (newSize >> 8) & 0xFF;
    newMidi[21] = newSize & 0xFF;
    
    finalBuffer = newMidi.buffer;
alert('ok');
}

                    // 5. Trigger Download
                    const blob = new Blob([finalBuffer], { type: 'audio/midi' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'CA_' + GENRES[parseInt(ctrl.genreSelect.value, 10)].name + '_' + Date.now() + '.mid';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 60000);
                    statusText.textContent = 'MIDI Exported with Signal metadata.';
                } catch (error) {
                    statusText.textContent = 'Error creating download: ' + error.message;
                }
            } else if (type === 'midi_error') {
                statusText.textContent = 'MIDI creation error: ' + message;
            }
        };

        midiWorker.onerror = (error) => console.error("Worker error:", error);

    } catch (e) {
        console.error("Error creating inline worker:", e);
    }

    // --- Validation logic before posting to worker ---
    if (!lastCompByRole || !midiWorker) return;

    const genreIndex = parseInt(ctrl.genreSelect.value, 10);
    const genreObj = GENRES[genreIndex];
    const kitArray = GENRE_PERCUSSION[genreObj.roles?.drums?.kit] || [36, 38, 42];

    midiWorker.postMessage({
        compByRole: lastCompByRole,
        ppq: 480,
        bpm: lastBpm || 120,
        roleInstruments: {
            lead: parseInt(ctrl.leadInstrument.value, 10) || genreObj.instruments?.lead || 0,
            bass: parseInt(ctrl.bassInstrument.value, 10) || genreObj.instruments?.bass || 34,
            chords: parseInt(ctrl.chordsInstrument.value, 10) || genreObj.instruments?.chords || 24,
            drums: getGenreDrumProgram(genreIndex)
        },
        drumKitMap: { kick: kitArray[0], snare: kitArray[1], hat: kitArray[2] }
    });
}

function ____downloadMIDI() {
    try {
        const ablob = new Blob([workerCode], {
            type: 'application/javascript'
        });
        const aworkerUrl = URL.createObjectURL(ablob);
        midiWorker = new Worker(aworkerUrl);

        midiWorker.onmessage = function(e) {
            const { type, buffer, message } = e.data;

            if (type === 'midi_ready') {
                try {
                    // --- START DYNAMIC INJECTION OF ENTRYO ---
                    let finalBuffer = buffer;
                    
                    // Access the dynamic entryo value (assuming it's a global or accessible variable)
                  //  const entryoValue = (typeof entryo !== 'undefined' && entryo) ? String(entryo) : "";

                    if (entryo.length > 0) {
                        const originalBytes = new Uint8Array(buffer);
                        const encoder = new TextEncoder();
                        const entryoBytes = encoder.encode(entryo);
                        
                        // MIDI Copyright Meta Event: DeltaTime(00) + FF + Type(02) + Length + Data
                        const metaEvent = new Uint8Array([0x00, 0xFF, 0x02, entryoBytes.length, ...entryoBytes]);
                        
                        // Standard MIDI files have a 14-byte header. 
                        // The first track (MTrk) starts at index 14. 
                        // We inject the meta event at index 22 (immediately after 'MTrk' and the 4-byte length).
                        const injectionPoint = 22;
                        const newMidi = new Uint8Array(originalBytes.length + metaEvent.length);
                        
                        newMidi.set(originalBytes.slice(0, injectionPoint), 0);
                        newMidi.set(metaEvent, injectionPoint);
                        newMidi.set(originalBytes.slice(injectionPoint), injectionPoint + metaEvent.length);

                        // Update MTrk chunk size (bytes 18-21) to account for the new data
                        const oldSize = (originalBytes[18] << 24) | (originalBytes[19] << 16) | (originalBytes[20] << 8) | originalBytes[21];
                        const newSize = oldSize + metaEvent.length;
                        newMidi[18] = (newSize >> 24) & 0xFF;
                        newMidi[19] = (newSize >> 16) & 0xFF;
                        newMidi[20] = (newSize >> 8) & 0xFF;
                        newMidi[21] = newSize & 0xFF;
                        
                        finalBuffer = newMidi.buffer;
                    }
                    // --- END DYNAMIC INJECTION ---

                    const blob = new Blob([finalBuffer], {
                        type: 'audio/midi'
                    });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'CA_' + GENRES[parseInt(ctrl.genreSelect.value, 10)].name + '_' + Date.now() + '.mid';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => {
                        URL.revokeObjectURL(url);
                    }, 60000);
                    
                    statusText.textContent = 'MIDI Download completed (Metadata: ' + (entryoValue || 'None') + ')';
                } catch (error) {
                    statusText.textContent = 'Error creating download: ' + error.message;
                    console.error("Download error:", error);
                }
            } else if (type === 'midi_error') {
                statusText.textContent = 'MIDI creation error: ' + message;
                console.error("MIDI Worker error:", message);
            }
        };

        midiWorker.onerror = function(error) {
            statusText.textContent = 'MIDI Worker error occurred';
            console.error("Worker error:", error);
        };

    } catch (e) {
        console.error("Error creating inline worker:", e);
        statusText.textContent = "Error: Could not start background worker.";
    }

    if (!lastCompByRole) {
        statusText.textContent = 'Generate first, then download MIDI.';
        return;
    }
    if (!midiWorker) {
        statusText.textContent = 'Error: Worker is not loaded.';
        return;
    }

    let hasValidData = false;
    for (const role in lastCompByRole) {
        const comp = lastCompByRole[role];
        if (comp && comp.events && comp.events.length > 0) {
            hasValidData = true;
            break;
        }
    }

    if (!hasValidData) {
        statusText.textContent = 'No valid music data to export. Generate music first.';
        return;
    }

    statusText.textContent = 'Generating MIDI in background... Please wait.';

    const genreIndex = parseInt(ctrl.genreSelect.value, 10);
    const genreObj = GENRES[genreIndex];
    const drumProgram = getGenreDrumProgram(genreIndex);

    const kitName = genreObj.roles?.drums?.kit;
    const kitArray = GENRE_PERCUSSION[kitName] || [36, 38, 42];

    const drumKitMap = {
        kick: kitArray[0],
        snare: kitArray[1],
        hat: kitArray[2]
    };

    const roleInstruments = {
        lead: parseInt(ctrl.leadInstrument.value, 10) || genreObj.instruments?.lead || 0,
        bass: parseInt(ctrl.bassInstrument.value, 10) || genreObj.instruments?.bass || 34,
        chords: parseInt(ctrl.chordsInstrument.value, 10) || genreObj.instruments?.chords || 24,
        drums: drumProgram
    };

    midiWorker.postMessage({
        compByRole: lastCompByRole,
        ppq: 480,
        bpm: lastBpm || 120,
        roleInstruments: roleInstruments,
        drumKitMap: drumKitMap
    });
}














     function edownloadMIDI() {
	 
	 
	 
	 
	 
	 
	 
	 
	 
	 
            try {
                const ablob = new Blob([workerCode],{
                    type: 'application/javascript'
                });
                const aworkerUrl = URL.createObjectURL(ablob);
                midiWorker = new Worker(aworkerUrl);

                midiWorker.onmessage = function(e) {
                    const {type, buffer, message} = e.data;

                    if (type === 'midi_ready') {
                        try {
                            const blob = new Blob([buffer],{
                                type: 'audio/midi'
                            });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'CA_' + GENRES[parseInt(ctrl.genreSelect.value, 10)].name + '_' + Date.now() + '.mid';
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            setTimeout( () => {
                                URL.revokeObjectURL(url);
                            }
                            , 60000);
                            statusText.textContent = 'MIDI Download completed.';
                        } catch (error) {
                            statusText.textContent = 'Error creating download: ' + error.message;
                            console.error("Download error:", error);
                        }
                    } else if (type === 'midi_error') {
                        statusText.textContent = 'MIDI creation error: ' + message;
                        console.error("MIDI Worker error:", message);
                    }
                }
                ;

                midiWorker.onerror = function(error) {
                    statusText.textContent = 'MIDI Worker error occurred';
                    console.error("Worker error:", error);
                }
                ;

            } catch (e) {
                console.error("Error creating inline worker:", e);
                statusText.textContent = "Error: Could not start background worker.";
            }

	 
	 
	 
	 
                if (!lastCompByRole) {
                    statusText.textContent = 'Generate first, then download MIDI.';
                    return;
                }
                if (!midiWorker) {
                    statusText.textContent = 'Error: Worker is not loaded.';
                    return;
                }

                let hasValidData = false;
                for (const role in lastCompByRole) {
                    const comp = lastCompByRole[role];
                    if (comp && comp.events && comp.events.length > 0) {
                        hasValidData = true;
                        break;
                    }
                }

                if (!hasValidData) {
                    statusText.textContent = 'No valid music data to export. Generate music first.';
                    return;
                }

                statusText.textContent = 'Generating MIDI in background... Please wait.';

                const genreIndex = parseInt(ctrl.genreSelect.value, 10);
                const genreObj = GENRES[genreIndex];
                const drumProgram = getGenreDrumProgram(genreIndex);
                // GM Kit Program (0, 8, 16, etc.)

                const kitName = genreObj.roles?.drums?.kit;

                const kitArray = GENRE_PERCUSSION[kitName] || [36, 38, 42];

                const drumKitMap = {
                    kick: kitArray[0],
                    snare: kitArray[1],
                    hat: kitArray[2]
                };

                const roleInstruments = {
                    lead: parseInt(ctrl.leadInstrument.value, 10) || genreObj.instruments?.lead || 0,
                    bass: parseInt(ctrl.bassInstrument.value, 10) || genreObj.instruments?.bass || 34,
                    chords: parseInt(ctrl.chordsInstrument.value, 10) || genreObj.instruments?.chords || 24,
                    drums: drumProgram // Pass the GM Program number for the worker to set the kit
                };

                midiWorker.postMessage({
                    compByRole: lastCompByRole,
                    ppq: 480,
                    bpm: lastBpm || 120,
                    roleInstruments: roleInstruments,
                    drumKitMap: drumKitMap // Sending the specific note numbers for mapping
                });
            }
 function getGenreDrumProgram(genreIndex) {
                const genre = GENRES[genreIndex];
                if (!genre || !genre.roles || !genre.roles.drums)
                    return 0;

                const kit = genre.roles.drums.kit;

                switch (kit) {
                case 'orchestral':
                    return 48;
                case 'electro':
                case 'techno':
                case '909':
                    // Electronic Kit
                case '808':
                case 'trap':
                case 'hip-hop':
                case 'boom-bap':
                    return 25;
                    // TR-808 Kit
                case 'jazz':
                    return 32;
                case 'brush':
                    return 40;
                case 'rock':
                case 'heavy':
                case 'metal':
                    return 16;
                    // Power Kit
                case 'soft':
                case 'pop':
                    return 8;
                    // Room Kit
                case 'afro':
                case 'latin':
                case 'reggae':
                    return 0;
                    // Standard Kit usually handles percussion best
                default:
                    return 0;
                }
            }
			
			
			
			
			for(t=0;t<GENRES.length;t++){
			console.log(t+":"+GENRES[t].name);
			}
			var selectedGenres=new Array();
			
			var ffff=window.location.href;
	var exfff=ffff.split("styles=");
	if(exfff.length>1){
	var hdddd=exfff[1];
	var jjjjj=hdddd.split('&');
	var fennre=jjjjj[0];
	var kapis=fennre.split('|');
	
	for(n=0;n<kapis.length;n++){
	selectedGenres[n]=[];
	var ll=parseInt(kapis[n]+"");
	selectedGenres[n]=GENRES[ll];
	
	}
	
	GENRES=selectedGenres;
	
	//genreIdx=parseInt(""+kapis[(gencoutter%kapis.length)]);
	//gencoutter++;
	
	}
	
			
			
			
var gencoutter=0;
        // ==================== CONTROL HANDLERS ====================
function randomizeControls() {
    currentRadial = 1;
    ctrl.radialSelect.value = currentRadial.toString();



    ctrl.seed.value = Math.floor(wielsieder() * 999999999);

    var  genreIdx = Math.floor(wielsieder() * GENRES.length);
	
    ctrl.genreSelect.value = genreIdx;
    applyGenreSettings(genreIdx);

    if (ctrl.roleMode && ctrl.roleMode.options) {
        const randomIndex = Math.floor(wielsieder() * ctrl.roleMode.options.length);
        ctrl.roleMode.value = ctrl.roleMode.options[randomIndex].value;
    }

    // Additional random instrument selection
    if (ctrl.leadInstrument.options.length > 0) {
        ctrl.leadInstrument.selectedIndex = Math.floor(wielsieder() * ctrl.leadInstrument.options.length);
    }
    if (ctrl.bassInstrument.options.length > 0) {
        ctrl.bassInstrument.selectedIndex = Math.floor(wielsieder() * ctrl.bassInstrument.options.length);
    }
    if (ctrl.chordsInstrument.options.length > 0) {
        ctrl.chordsInstrument.selectedIndex = Math.floor(wielsieder() * ctrl.chordsInstrument.options.length);
    }

    ctrl.height.value = 128;
    ctrl.width.value = 128;
    ctrl.cyclic.checked = true;
    ctrl.bpm.value = parseInt(ctrl.bpm.value) + Math.floor((wielsieder() * 20) - 10);
    ctrl.notesPerBeat.value = 2 + Math.floor(wielsieder() * 3);
    ctrl.reverbMix.value = (0.1 + wielsieder() * 0.3).toFixed(2);
    ctrl.filterHz.value = 1500 + Math.floor(wielsieder() * 2500);

    statusText.textContent = `Randomized: ${GENRES[genreIdx].name}`;
    variationIndex = 0;
}

        function stopPlayback() {
            if (playbackTimer) {
                clearInterval(playbackTimer);
                playbackTimer = null;
            }
            isAutoPlaying = false;
            ctrl.autoPlayBtn.textContent = 'Auto-Play';
            if (audioCtx) {
                audioCtx.close().then(() => {
                    audioCtx = null;
                    statusText.textContent = 'Playback stopped.';
                }).catch(err => {
                    console.error('Error stopping audio:', err);
                    audioCtx = null;
                    statusText.textContent = 'Playback stopped.';
                });
            } else {
                statusText.textContent = 'Playback stopped.';
            }
        }

        function toggleAutoPlay() {
            if (isAutoPlaying) {
                isAutoPlaying = false;
                ctrl.autoPlayBtn.textContent = 'Auto-Play';
                statusText.textContent = 'Auto-play stopped.';
            } else {
                isAutoPlaying = true;
                ctrl.autoPlayBtn.textContent = 'Stop Auto-Play';
                generateRandomTrack();
            }
        }

        function generateRandomTrack() {
            if (!isAutoPlaying) return;
            randomizeControls();
            variationIndex = 0;
            generateAll();
        }

        async function loadSoundFontFromFile(file) {
            if (!file) return;
            statusText.textContent = "Loading SoundFont file...";
            try {
                const arrayBuffer = await file.arrayBuffer();
                ensureAudio();
                const success = await soundfontPlayer.loadSoundFont(arrayBuffer);
                if (success) {
                    statusText.textContent = `SoundFont "${file.name}" loaded successfully`;
                }
            } catch (error) {
                console.error("Error loading SoundFont file:", error);
                statusText.textContent = "Error loading SoundFont - using fallback synth";
            }
        }
//
     		const INLINE_SOUNDFONT_BASE64='data:application/octet-stream;base64,U' ;

		async function loadInlineSoundFont() {
    statusText.textContent = "Loading default SoundFont...";
    try {
        // Laad een externe SoundFont
        const response = await fetch(INLINE_SOUNDFONT_BASE64);
        const arrayBuffer = await response.arrayBuffer();
        
        ensureAudio();
        const success = await soundfontPlayer.loadSoundFont(arrayBuffer);
        if (success) {
            statusText.textContent = "Default SoundFont loaded successfully";
        }
    } catch (error) {
        console.error("Error loading default SoundFont:", error);
        statusText.textContent = "Error loading default SoundFont";
    }
}
document.body.style.backgroundImage="url(data:image/jpeg;base64,"+imgl[0]+")";
var getet=1;
var fldksjgljdflgj=0;
function maakbase64midrandom() {

if(fldksjgljdflgj==1){
document.getElementById('stopBtn').innerText="▷▷";
}
fldksjgljdflgj++;
//document.body.style.backgroundImage="url(data:image/jpeg;base64,"+imgl[getet%imgl.length]+")";
getet++;

    // Generate a random track
    randomizeControls();
    variationIndex = 0;
    generateAllo();
    
    // Wait a moment for generation to complete, then create MIDI
    setTimeout(() => {
        if (!lastCompByRole) {
            console.log("Error: No music data generated");
            return;
        }
        
        try {
            const ablob = new Blob([workerCode], { type: 'application/javascript' });
            const aworkerUrl = URL.createObjectURL(ablob);
            const midiWorker = new Worker(aworkerUrl);

            midiWorker.onmessage = function(e) {
                const { type, buffer, message } = e.data;

                if (type === 'midi_ready') {
                    try {
                        // Convert ArrayBuffer to base64
                        const bytes = new Uint8Array(buffer);
                        let binary = '';
                        for (let i = 0; i < bytes.byteLength; i++) {
                            binary += String.fromCharCode(bytes[i]);
                        }
                        const base64 = btoa(binary);
                        
                        console.log("MIDI Base64:", base64);
                        console.log("MIDI length:", base64.length, "characters");
                        CURRENT_MIDI_FILE=base64;
						           const genreIndexe = parseInt(ctrl.genreSelect.value, 10);
			
			MIDIFA=GENRES[genreIndexe].name+"-"+Math.round(1000000000*wielsieder())+".mid";
			
			
						
								
					document.getElementById('aa').setAttribute('download',MIDIFA);
			document.getElementById('aa').setAttribute('href','data:audio/midi;base64,'+CURRENT_MIDI_FILE);	
						
                        // Clean up
                        URL.revokeObjectURL(aworkerUrl);
                    } catch (error) {
                        console.error("Error converting to base64:", error);
                    }
                } else if (type === 'midi_error') {
                    console.error("MIDI creation error:", message);
                }
            };

            midiWorker.onerror = function(error) {
                console.error("Worker error:", error);
            };

            // Prepare data for worker
            const genreIndex = parseInt(ctrl.genreSelect.value, 10);
			
			document.getElementById('enil2').innerHTML=GENRES[genreIndex].name;
			
		fixAchter(GENRES[genreIndex].name, document.getElementById('weerre'),500,500);
            const genreObj = GENRES[genreIndex];
            const drumProgram = getGenreDrumProgram(genreIndex);
            const kitName = genreObj.roles?.drums?.kit;
            const kitArray = GENRE_PERCUSSION[kitName] || [36, 38, 42];

            const drumKitMap = {
                kick: kitArray[0],
                snare: kitArray[1],
                hat: kitArray[2]
            };

            const roleInstruments = {
                lead: parseInt(ctrl.leadInstrument.value, 10) || genreObj.instruments?.lead || 0,
                bass: parseInt(ctrl.bassInstrument.value, 10) || genreObj.instruments?.bass || 34,
                chords: parseInt(ctrl.chordsInstrument.value, 10) || genreObj.instruments?.chords || 24,
                drums: drumProgram
            };

            // Send to worker
            midiWorker.postMessage({
                compByRole: lastCompByRole,
                ppq: 480,
                bpm: lastBpm || 120,
                roleInstruments: roleInstruments,
                drumKitMap: drumKitMap
            });

        } catch (e) {
            console.error("Error creating MIDI worker:", e);
        }
    }, 500); // Short delay to ensure generation completes
	
	
	var sdfjfj=window.location.href;
	var methh=sdfjfj.split('down=1');
	if(methh.length>1){
	document.getElementById('aa').click();
	setTimeout('maakbase64midrandom()', 500);
	
	}
	
}



        // ==================== EVENT LISTENERS ====================
        ctrl.generateBtn.addEventListener('click', () => {
            currentRadial = parseInt(ctrl.radialSelect.value, 10);
            variationIndex = 0;
            generateAll();
        });

        ctrl.nextVariationBtn.addEventListener('click', () => {
            variationIndex++;
            generateAll();
        });

        ctrl.randomizeBtn.addEventListener('click', randomizeControls);
        ctrl.downloadMidiBtn.addEventListener('click', () => {
            statusText.textContent = 'MIDI download would be implemented here';
			   downloadMIDI();
        });

     //  ctrl.stopBtn.addEventListener('click', stopPlayback);
        ctrl.autoPlayBtn.addEventListener('click', toggleAutoPlay);
        ctrl.soundfontFile.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) loadSoundFontFromFile(file);
        });

        // Audio context initialization on user interaction
        document.addEventListener('click', function initAudio() {
            if (!audioCtx) ensureAudio();
            document.removeEventListener('click', initAudio);
        }, { once: true });

        // Initialize


function generateGlyphPNG(inputString, widthInteger, heightInteger) {
    // Normalization function
    function normalizeString(str, normalizeCase = true, trimSpaces = true) {
        let normalized = str;
        if (normalizeCase) normalized = normalized.toLowerCase();
        if (trimSpaces) normalized = normalized.trim().replace(/\s+/g, ' ');
        return normalized;
    }
    
    // Deterministic hash function
    function stringHash(str) {
        let hash = 0;
        for (let i = 0; i < str.length; i++) {
            const char = str.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        return Math.abs(hash);
    }
    
    // Generate SVG string
    function generateGlyphSVG(str) {
        const normalizedStr = normalizeString(str, true, true);
        const hash = stringHash(normalizedStr);
        
        const hue = hash % 360;
        const color1 = `hsl(${hue}, 85%, 60%)`;
        const color2 = `hsl(${hue}, 85%, 40%)`;
        const color3 = `hsl(${hue + 60}, 85%, 50%)`;
        
        const baseSides = 3 + (hash % 6);
        const baseRadius = 35 + (hash % 10);
        const rotation = (hash % 360) * Math.PI / 180;
        
        const centerX = 50;
        const centerY = 50;
        
        let svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
            <defs>
                <filter id="glow${hash}">
                    <feGaussianBlur stdDeviation="1.5" result="coloredBlur"/>
                    <feMerge>
                        <feMergeNode in="coloredBlur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
                <radialGradient id="grad${hash}" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" stop-color="${color1}" stop-opacity="0.8"/>
                    <stop offset="100%" stop-color="${color2}" stop-opacity="0.3"/>
                </radialGradient>
            </defs>
            <rect width="100" height="100" fill="transparent"/>`;
        
        const basePoints = [];
        for (let i = 0; i < baseSides; i++) {
            const angle = rotation + (i / baseSides) * Math.PI * 2;
            const x = centerX + Math.cos(angle) * baseRadius;
            const y = centerY + Math.sin(angle) * baseRadius;
            basePoints.push(`${x},${y}`);
        }
        
        svg += `<polygon points="${basePoints.join(' ')}" fill="url(#grad${hash})" stroke="${color2}" stroke-width="1.5" filter="url(#glow${hash})"/>`;
        
        for (let i = 0; i < Math.min(normalizedStr.length, 12); i++) {
            const charCode = normalizedStr.charCodeAt(i);
            const char = normalizedStr.charAt(i);
            const layerRadius = 10 + (i * 4) + (charCode % 10);
            const layerSides = 3 + (charCode % 6);
            const layerRotation = (charCode * i) % 360 * Math.PI / 180;
            const layerOpacity = 0.7 - (i * 0.05);
            
            const charPoints = [];
            for (let j = 0; j < layerSides; j++) {
                const angle = layerRotation + (j / layerSides) * Math.PI * 2;
                const x = centerX + Math.cos(angle) * layerRadius;
                const y = centerY + Math.sin(angle) * layerRadius;
                charPoints.push(`${x},${y}`);
            }
            
            if (i % 3 === 0) {
                svg += `<polygon points="${charPoints.join(' ')}" fill="none" stroke="${color3}" stroke-width="${1 + (i % 3)}" opacity="${layerOpacity}"/>`;
            } else if (i % 3 === 1) {
                charPoints.forEach(point => {
                    const [x, y] = point.split(',').map(Number);
                    svg += `<circle cx="${x}" cy="${y}" r="${1.5 + (i % 4)/2}" fill="${color1}" opacity="${layerOpacity}"/>`;
                });
            } else {
                svg += `<circle cx="${centerX}" cy="${centerY}" r="${layerRadius}" fill="none" stroke="${color1}" stroke-width="0.5" stroke-dasharray="${2 + (i % 3)}" opacity="${layerOpacity}"/>`;
            }
            
            if (char.match(/[A-Za-z]/)) {
                const symbolAngle = layerRotation;
                const symbolX = centerX + Math.cos(symbolAngle) * (layerRadius + 5);
                const symbolY = centerY + Math.sin(symbolAngle) * (layerRadius + 5);
                svg += `<text x="${symbolX}" y="${symbolY}" text-anchor="middle" dy="0.3em" font-size="4" fill="${color2}" font-family="Arial" opacity="0.8">${char.toUpperCase()}</text>`;
            }
        }
        
        const coreRadius = 5 + (normalizedStr.length % 10);
        svg += `<circle cx="${centerX}" cy="${centerY}" r="${coreRadius}" fill="${color1}" filter="url(#glow${hash})"/>`;
        svg += `</svg>`;
        
        return svg;
    }
    
    // Create canvas and draw glyph
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    canvas.width = widthInteger;
    canvas.height = heightInteger;
    
    // Clear canvas with transparent background
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Create SVG blob
    const svgString = generateGlyphSVG(inputString);
    const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
    const svgUrl = URL.createObjectURL(svgBlob);
    
    return new Promise((resolve) => {
        const img = new Image();
        img.onload = function() {
            // Calculate centered position
            const scale = 1*Math.min(canvas.width / 100, canvas.height / 100);
            const scaledWidth = 100 * scale;
            const scaledHeight = 100 * scale;
            const x = (canvas.width - scaledWidth) / 2;
            const y = (canvas.height - scaledHeight) / 2;
            	ctx.globalAlpha = 0.25;
            ctx.drawImage(img, x, y, scaledWidth, scaledHeight);
            URL.revokeObjectURL(svgUrl);
                 //ctx.drawImage(rrr, x, y, scaledWidth, scaledHeight);
            // Convert to base64 PNG
            const pngBase64 = canvas.toDataURL('image/png');
            resolve(pngBase64);
        };
        img.src = svgUrl;
    });
}


function fixAchter(string_, el_, wid_, hei_){
// Usage example:
eg=el_.getBoundingClientRect();
el_.style.backgroundRepeat='no-repeat';
el_.style.backgroundSize=Math.round(eg.width/2)+'px '+Math.round(eg.width/2)+'px';
el_.style.backgroundPosition='center center';

generateGlyphPNG(string_, wid_, hei_).then(base64 => el_.style.backgroundImage='url('+base64+')'    );
}

		
		// Initialize player title after genre select is populated
function initializePlayerTitle() {
    if (genreSelect.options.length > 0) {
        playerTitle.textContent = genreSelect.options[genreSelect.selectedIndex].text;
    } else {
        // Fallback if not ready yet
        playerTitle.textContent = "Muziek Speler";
        // Try again after a short delay
        setTimeout(initializePlayerTitle, 100);
    }
}

// Call this after you populate the genreSelect
(function initGenreSelect() {
    const sel = ctrl.genreSelect;
    sel.innerHTML = '';
    GENRES.forEach((g, i) => {
        const opt = document.createElement('option');
        opt.value = i;
        opt.textContent = g.name;
        sel.appendChild(opt);
    });
    sel.value = 0;
    applyGenreSettings(0);

    // NOW initialize the player title after genres are loaded
    initializePlayerTitle();

    sel.addEventListener('change', function() {
        applyGenreSettings(parseInt(this.value, 10));
        // Update player title when genre changes
        playerTitle.textContent = this.options[this.selectedIndex].text;
    });
})();

// Also update the simplePlayBtn event listener to use the initialized title
simplePlayBtn.addEventListener('click', function() {
    if(rstarted == 0){
        setTimeout(() => {
            rstarted = 1;
            loadInlineSoundFont().catch(console.error);
            autoPlayBtn.click();
            setTimeout(() => {
                //stopBtn.click();
            }, 250);
        }, 1500);
    } else {
        autoPlayBtn.click();
    }
});

// Remove the problematic standalone line:
// playerTitle.textContent = genreSelect.options[genreSelect.selectedIndex].text;
		
        console.log("Cellular Automata Music Generator initialized with chorus enhancement system");

    </script>

	</div>
	

<div id='scrl' style='width:100%;height:100%;position:fixed;left:0;top:0'>
    <div class="overlay"></div>
    <div id="ticker-top-row" class="ticker-container top">
        <div id="top-content" class="ticker-content"></div>
    </div>
    <div id="ticker-bottom-row" class="ticker-container top">
        <div id="bottom-content" class="ticker-content"></div>
    </div>
</div>

<script>
class MarkovChainGenerator {
    constructor(zinnen, nGramSize = 2) {
        this.zinnen = zinnen;
        this.nGramSize = nGramSize;
        this.chain = new Map();
        this.startNGrams = new Set();
        this.gebruikteZinnen = new Set();
        this.buildChain();
    }
    
    buildChain() {
        // Bouw Markov chain met n-grams
        for (const zin of this.zinnen) {
            const woorden = this.cleanAndTokenize(zin);
            if (woorden.length < this.nGramSize) continue;
            
            // Voeg begin n-gram toe
            const startNGram = woorden.slice(0, this.nGramSize).join(' ');
            this.startNGrams.add(startNGram);
            
            // Bouw de chain
            for (let i = 0; i < woorden.length - this.nGramSize; i++) {
                const currentNGram = woorden.slice(i, i + this.nGramSize).join(' ');
                const nextWord = woorden[i + this.nGramSize];
                
                if (!this.chain.has(currentNGram)) {
                    this.chain.set(currentNGram, []);
                }
                this.chain.get(currentNGram).push(nextWord);
            }
            
            // Voeg eindmarkering toe
            const lastNGram = woorden.slice(-this.nGramSize).join(' ');
            if (!this.chain.has(lastNGram)) {
                this.chain.set(lastNGram, []);
            }
            this.chain.get(lastNGram).push(null); // null betekent einde van zin
        }
    }
    
    cleanAndTokenize(zin) {
        // Verwijder interpunctie behalve apostrof voor samenstellingen
        const cleaned = zin.toLowerCase()
            .replace(/[.,!?;:"()]/g, '')
            .replace(/\s+/g, ' ')
            .trim();
        
        return cleaned.split(' ');
    }
    
    genereer() {
        let poging = 0;
        const maxPogingen = 100;
        
        while (poging < maxPogingen) {
            // Kies een start n-gram
            const startNGrams = Array.from(this.startNGrams);
            if (startNGrams.length === 0) break;
            
            let currentNGram = startNGrams[Math.floor(Math.random() * startNGrams.length)];
            const woorden = currentNGram.split(' ');
            const resultaat = [...woorden];
            
            // Genereer tot maximaal 15 woorden
            for (let i = 0; i < 25; i++) {
                if (!this.chain.has(currentNGram)) break;
                
                const volgendeOpties = this.chain.get(currentNGram);
                if (!volgendeOpties || volgendeOpties.length === 0) break;
                
                const volgende = volgendeOpties[Math.floor(Math.random() * volgendeOpties.length)];
                
                if (volgende === null) {
                    // Einde van zin bereikt
                    const zin = this.capitalizeZin(resultaat.join(' '));
                    
                    // Controleer of zin niet te kort is en niet recent gebruikt
                    if (resultaat.length >= 4 && !this.gebruikteZinnen.has(zin)) {
                        this.gebruikteZinnen.add(zin);
                        if (this.gebruikteZinnen.size > 100) {
                            // Verwijder oudste om geheugen te sparen
                            const first = this.gebruikteZinnen.values().next().value;
                            this.gebruikteZinnen.delete(first);
                        }
                        return zin + " +++";
                    }
                    break;
                }
                
                resultaat.push(volgende);
                
                // Update current n-gram
                woorden.shift();
                woorden.push(volgende);
                currentNGram = woorden.join(' ');
            }
            
            poging++;
        }
        
        // Fallback naar originele zin
        return this.getFallbackZin();
    }
    
    capitalizeZin(zin) {
        return zin.split(' ')
            .map((woord, index) => {
                if (index === 0) {
                    return woord.charAt(0).toUpperCase() + woord.slice(1);
                }
                return woord;
            })
            .join(' ');
    }
    
    getFallbackZin() {
        // Zoek een originele zin die niet recent gebruikt is
        const beschikbaar = this.zinnen.filter(z => !this.gebruikteZinnen.has(z));
        
        if (beschikbaar.length > 0) {
            const zin = beschikbaar[Math.floor(Math.random() * beschikbaar.length)];
            this.gebruikteZinnen.add(zin);
            return zin + " +++";
        }
        
        // Reset als alles gebruikt is
        this.gebruikteZinnen.clear();
        const zin = this.zinnen[Math.floor(Math.random() * this.zinnen.length)];
        this.gebruikteZinnen.add(zin);
        return zin + " +++";
    }
}

class InfiniteTicker {
    constructor() {
        this.topContainer = document.getElementById('top-content');
        this.bottomContainer = document.getElementById('bottom-content');
        this.topRow = document.getElementById('ticker-top-row');
        this.bottomRow = document.getElementById('ticker-bottom-row');
        
        this.topPosition = 0;
        this.bottomPosition = 0;
        this.speedTop = 90; // pixels per seconde
        this.speedBottom = 75; // pixels per seconde
        this.animationId = null;
        this.lastTime = performance.now();
        
        // Buffer aan het einde om tijd te hebben nieuwe zinnen toe te voegen
        this.bufferThreshold = 1500; // pixels
        
        // Cleanup threshold als klasse variabele
        this.cleanupThreshold = 5000; // pixels
        
        // Minimum aantal zinnen in buffer
        this.minZinnen = 8;
        
        // Zinnen database - de array die je al hebt
        this.duivelseUitspraken =  [
    "De wind fluisterde leugens die muren werden.",
"Bescherming is een kooi met gouden sleutels.",
"Het systeem kijkt in de spiegel en ziet alleen zichzelf.",
"Zorg werd gerecht dat recht werd vergeten.",
"Papieren beschermen de macht, niet de mens.",
"De procedure is het doel, niet de menselijkheid.",
"Elke handtekening een nagel in de kist van vrijheid.",
"Ze bouwen kooien en noemen het bescherming.",
"De wet is een mes dat alleen naar beneden snijdt.",
"Bureaucratie is geweld in slow motion.",
"Zij die moeten beschermen, isoleren het meest.",
"Het zegel op het document is het geluid van een deur die op slot gaat.",
"Zinloos bewind is gelegaliseerde wreedheid.",
"Ze meten hun macht aan onze eenzaamheid.",
"De rechter spreekt, de mensheid zwijgt.",
"Protocollen zijn de nieuwe bijbels van de waanzin.",
"Hun empathie eindigt waar hun macht begint.",
"Een dossier is een mens zonder gezicht.",
"Ze verwarren controle met zorg.",
"Het systeem eet zijn zwaksten op.",
"Elke stempel een beetje ziel verdwenen.",
"Zij redeneren terwijl wij bloeden.",
"De wet is een spiegel die alleen hun gelijk reflecteert.",
"Bescherming als voorwendsel, vernietiging als resultaat.",
"Hun papierwerk is belangrijker dan ons bestaan.",
"De geesteszieke is hij die het systeem gezond noemt.",
"Vrijheid is het enige dat ze niet kunnen voorschrijven.",
"Zij zien cijfers waar mensen horen te zijn.",
"Hun mededogen zit opgesloten in archieven.",
"De staat als chirurg die gezond weefsel verwijdert.",
"Elke beperking een ladder om hoger te klimmen.",
"Ze offeren mensen op aan hun procedures.",
"Het rechtspraak is een toneelstuk met echte tranen.",
"Hun waanzin heeft een officieel stempel.",
"Bescherm ons van onze beschermers.",
"De kooi is van papier, maar het slot is van staal.",
"Zij die ons isoleren noemen het veiligheid.",
"De wind van gerechtigheid waait alleen door hun kantoren.",
"Hun spiegel liegt en zij geloven het.",
"Macht is hun enige moraliteit.",
"Ze vullen formulieren in terwijl levens leeglopen.",
"Het systeem is een god die offers eist.",
"Hun nachtmerrie is ons dagelijks leven.",
"De rechtbank is een tempel van ijdele goden.",
"Ze verpakken uitsluiting in mooie woorden.",
"Elke regel een strop voor de kwetsbaren.",
"Zij beschermen het systeem van de mens.",
"Hun compassie is een legende in hun eigen hoofd.",
"De waarheid is het eerste slachtoffer van hun procedures.",
"Ze bouwen muren en noemen het zorg.",
"Hun ogen zien alleen wat op papier staat.",
"De staat als alchemist die goud in lood verandert.",
"Bescherming betekent dat zij beslissen wie mens is.",
"Hun nacht is wakker van eigen grootheid.",
"De wet is een wapen dat nooit op hen gericht is.",
"Ze verdrinken mensen in een zee van papier.",
"Hun systeem is perfect behalve voor mensen.",
"Elke uitspraak een nagel, elke procedure een kist.",
"Zij respecteren alleen hun eigen spiegelbeeld.",
"De wind van vervolging waait door elke gang.",
"Hun realiteit is een waan die wet werd.",
"Ze bewaken de kooi alsof het een schatkist is.",
"Bescherming is wat zij nodig hebben van ons.",
"Hun dag is nacht voor wie lijdt.",
"De rechtspraak is een machine zonder hart.",
"Ze meten menselijkheid in paragrafen.",
"Elke beperking een teken van hun angst.",
"Zij vervolgen om niet te hoeven zien.",
"Hun spiegel toont alleen wat zij willen zijn.",
"De staat als kunstenaar van menselijk leed.",
"Papieren realiteiten vervangen echte levens.",
"Hun bescherming is een virus in menselijke vorm.",
"Ze isoleren om te kunnen heersen.",
"Elke handeling een daad van institutionele waanzin.",
"Zij zien patiënten waar er mensen zijn.",
"Hun wind waait alleen door hun eigen zalen.",
"De kooi van zorg heeft geen deur naar buiten.",
"Ze vergiftigen met goedkeuringstempels.",
"Hun realiteit is een nachtmerrie voor anderen.",
"Bescherming als wapen, zorg als excuus.",
"De spiegel liegt en zij zijn de leugen.",
"Zij vervolgen het menselijke in de mens.",
"Hun nacht is vol dagelijkse vernietiging.",
"De wet is hun speeltuin, ons slagveld.",
"Ze verpakken leed in professionele termen.",
"Elke dag een nieuwe reden om te heersen.",
"Zij bouwen gevangenissen van papier en trots.",
"Hun wind voert nooit naar vrijheid.",
"De staat als duivel in maatpak.",
"Bescherming is hun woord voor controle.",
"Ze kijken in de spiegel en zien een redder.",
"Hun realiteit is een psychose met macht.",
"Elke handtekening een doodvonnis voor hoop.",
"Zij isoleren om niet te voelen.",
"De rechtbank is hun theater, wij het toneel.",
"Hun waanzin heeft de macht van de wet.",
"Ze beschermen zichzelf tegen menselijkheid.",
"Hun dag begint waar onze nacht nooit eindigt.",
"De wind van hun beslissing breekt levens.",
"Zij zien cijfers, wij verliezen gezichten.",
"Hun systeem is een cirkel zonder uitweg.",
"Bescherming als muur, zorg als slot.",
"De spiegel toont hun lege overtuiging.",
"Ze vervolgen wat zij niet begrijpen.",
"Hun nacht is wakker van eigen belangrijkheid.",
"De wet is een mes zonder handvat.",
"Elke procedure een stap van de mens af.",
"Zij bewaken de leegte van hun systeem.",
"Hun realiteit is een ziekte die zij verspreiden.",
"De staat als chirurg die zielen verwijdert.",
"Papieren vervangen harten, stempels vervangen zorg.",
"Hun bescherming is een val waarin wij lopen.",
"Ze isoleren om hun eigen wereld heel te houden.",
"Elke beperking een teken van hun onmacht.",
"Zij zien een diagnose waar een mens staat.",
"Hun wind waait door dossiers, niet door kamers.",
"De kooi heeft geen naam maar wel sleutels.",
"Ze vergiftigen met bureaucratische precisie.",
"Hun waarheid is een leugen met een stempel.",
"Bescherming betekent dat zij winnen.",
"De spiegel toont alleen hun eigen gelijk.",
"Zij vervolgen het licht in donkere tijden.",
"Hun nacht is dagelijks bestuur van leed.",
"De wet is hun spel, wij de verliezers.",
"Ze verpakken uitsluiting in juridische taal.",
"Elke dag een nieuwe laag in de papieren kooi.",
"Zij bouwen muren van protocol en ego.",
"Hun wind voert naar niets dan hun centrum.",
"De staat als kunstenaar van papieren werkelijkheid.",
"Bescherming is wat zij nemen, niet geven.",
"Ze kijken in de spiegel en knikken tevreden.",
"Hun realiteit is een gevangenis voor geesten.",
"Elke handtekening een zegel op iemands lot.",
"Zij isoleren om hun macht te voelen.",
"De rechtbank spreekt duivels in mensentaal.",
"Hun waanzin heeft de kracht van een stempel.",
"Ze beschermen het systeem tegen menselijkheid.",
"Hun dag is nachtmerrie voor wie wakker is.",
"De wind van hun macht breekt zachte stemmen.",
"Zij zien regels waar mensen horen te zijn.",
"Hun systeem is een doolhof zonder uitgang.",
"Bescherming als wapen, recht als schild.",
"De spiegel liegt over wie de duivel is.",
"Ze vervolgen de kwetsbaarheid die zij vrezen.",
"Hun nacht is vol daglicht voor leed.",
"De wet is een god die alleen zij aanbidden.",
"Elke procedure een mes in de rug van vertrouwen.",
"Zij bewaken de poort van hun eigen hel.",
"Hun realiteit is een ziekte met autoriteit.",
"De staat als schilder van zwarte dagen.",
"Papieren werkelijkheid is hun enige waarheid.",
"Hun bescherming is een net dat verstikt.",
"Ze isoleren om hun twijfels te begraven.",
"Elke beperking een bewijs van hun angst.",
"Zij zien een geval waar een mens staat.",
"Hun wind waait alleen door kantoren.",
"De kooi is van inkt en arrogantie.",
"Ze vergiftigen met elke nieuwe regel.",
"Hun waarheid is een val voor onschuld.",
"Bescherming betekent dat zij slapen terwijl wij waken.",
"De spiegel toont hun koude perfectie.",
"Zij vervolgen de mens in de patiënt.",
"Hun nacht is dagwerk aan vernietiging.",
"De wet is hun bijbel, ons vonnis.",
"Ze verpakken leed in nette mappen.",
"Elke dag een nieuwe laag isolatie.",
"Zij bouwen een burcht van papieren.",
"Hun wind voert naar centra van macht.",
"De staat als componist van menselijk leed.",
"Bescherming is hun masker voor controle.",
"Ze kijken in de spiegel en zien genade.",
"Hun realiteit is een spel met echte levens.",
"Elke handtekening een punt in hun carrière.",
"Zij isoleren om niet aan te hoeven raken.",
"De rechtbank is hun podium van kou.",
"Hun waanzin heeft de kleur van officiële zegels.",
"Ze beschermen hun wereld van onze realiteit.",
"Hun dag is nacht voor wie gevoel heeft.",
"De wind van hun besluit vaagt hoop weg.",
"Zij zien projecten waar levens zijn.",
"Hun systeem is een web dat verstrikt.",
"Bescherming als dekmantel, zorg als wapen.",
"De spiegel toont alleen hun eigen waan.",
"Ze vervolgen het leven in de naam van leven.",
"Hun nacht is werkplaats van eenzaamheid.",
"De wet is een harnas dat alleen zij dragen.",
"Elke procedure een breuk in menselijkheid.",
"Zij bewaken de leugen van hun nut.",
"Hun realiteit is een psychose met pen.",
"De staat als architect van hopeloosheid.",
"Papieren vervangen handen, regels vervangen hart.",
"Hun bescherming is een storm in een kamer.",
"Ze isoleren om hun angst te beheersen.",
"Elke beperking een teken van hun onwetendheid.",
"Zij zien statistieken waar tranen zijn.",
"Hun wind waait door archieven, niet door straten.",
"De kooi heeft de geur van vers papier.",
"Ze vergiftigen met bureaucratische elegantie.",
"Hun waarheid is een cel met uitzicht op macht.",
"Bescherming betekent dat zij rijker worden.",
"De spiegel toont hun kille schoonheid.",
"Zij vervolgen de stem die vraagtekens stelt.",
"Hun nacht is dagelijks feest van papier.",
"De wet is hun muziek, ons geschreeuw.",
"Ze verpakken pijn in professionele taal.",
"Elke dag een nieuwe regel om te breken.",
"Zij bouwen een tempel van procedures.",
"Hun wind voert naar kamers zonder ramen.",
"De staat als dichter van institutionele leugens.",
"Bescherming is hun woord voor macht.",
"Ze kijken in de spiegel en zien orde.",
"Hun realiteit is een droom die nachtmerrie werd.",
"Elke handtekening een bewijs van hun bestaan.",
"Zij isoleren om hun twijfels te verbergen.",
"De rechtbank spreekt taal van kille sterren.",
"Hun waanzin heeft de structuur van wetten.",
"Ze beschermen de schijn van normaliteit.",
"Hun dag is nacht voor wie liefheeft.",
"De wind van hun systeem droogt tranen op.",
"Zij zien processen waar mensen horen.",
"Hun systeem is een machine die menselijkheid vermaalt.",
"Bescherming als masker, recht als toneel.",
"De spiegel toont hun ijskoude glimlach.",
"Ze vervolgen de waarheid in de naam van waarheid.",
"Hun nacht is werkplaats van eenzaamheid.",
"De wet is een schild dat alleen hen beschermt.",
"Elke procedure een verraad aan vertrouwen.",
"Zij bewaken de poort van hun eigen waan.",
"Hun realiteit is een ziekte die zij verspreiden.",
"De staat als tuinman die bloemen verwijdert.",
"Papieren bloeden niet, dus zij denken het is veilig.",
"Hun bescherming is een valstrik met zijden handschoenen.",
"Ze isoleren om hun eigen imperfectie niet te zien.",
"Elke beperking een schreeuw van hun onzekerheid.",
"Zij zien nummers waar harten kloppen.",
"Hun wind waait door dossiers, niet door huizen.",
"De kooi is van bureaucratisch staal.",
"Ze vergiftigen met elke nieuwe richtlijn.",
"Hun waarheid is een leugen met een paraaf.",
"Bescherming betekent dat zij nooit fout zijn.",
"De spiegel toont hun gepolijste leegte.",
"Zij vervolgen het menselijke alsof het een misdaad is.",
"Hun nacht is gevuld met dagelijkse executies.",
"De wet is hun wapen, ons lichaam het doelwit.",
"Ze verpakken wanhoop in nette tabellen.",
"Elke dag een nieuwe muur om te beklimmen.",
"Zij bouwen een piramide van papieren lijden.",
"Hun wind voert naar centra van koude macht.",
"De staat als regisseur van menselijk drama.",
"Bescherming is hun excuus voor geweld.",
"Ze kijken in de spiegel en zien rechtvaardigheid.",
"Hun realiteit is een nachtmerrie met handtekening.",
"Elke handtekening een spijker in iemands kist.",
"Zij isoleren om hun eigen menselijkheid niet te voelen.",
"De rechtbank is hun altaar, wij het offer.",
"Hun waanzin heeft de kracht van een instelling.",
"Ze beschermen de machine tegen menselijke storing.",
"Hun dag is nacht voor wie nog voelt.",
"De wind van hun beslissing breekt zielen.",
"Zij zien kosten waar levens zijn.",
"Hun systeem is een doolhof zonder einde.",
"Bescherming als gevangenis, zorg als cipier.",
"De spiegel toont hun kille perfectie.",
"Ze vervolgen de hoop alsof het een ziekte is.",
"Hun nacht is werkplaats van institutionele waanzin.",
"De wet is hun speelgoed, ons leven de prijs.",
"Elke procedure een daad van psychologisch geweld.",
"Zij bewaken de schatkist van hun eigen ego.",
"Hun realiteit is een psychose met pen en papier.",
"De staat als alchemist die menselijkheid in goud verandert.",
"Papieren hebben geen ogen om te huilen.",
"Hun bescherming is een web dat verstikt.",
"Ze isoleren om hun eigen schaduw niet te zien.",
"Elke beperking een echo van hun angst.",
"Zij zien dossiers waar verhalen zijn.",
"Hun wind waait door gangen van macht.",
"De kooi is gemaakt van officiële documenten.",
"Ze vergiftigen met bureaucratische zorgvuldigheid.",
"Hun waarheid is een masker dat nooit afgaat.",
"Bescherming betekent dat zij altijd gelijk hebben.",
"De spiegel toont hun glanzende onmenselijkheid.",
"Zij vervolgen de kwetsbaren alsof het objecten zijn.",
"Hun nacht is gevuld met dagelijkse vernietiging.",
"De wet is hun koningin, wij het volk dat buigt.",
"Ze verpakken lijden in mooie grafieken.",
"Elke dag een nieuwe barrière om te overwinnen.",
"Zij bouwen een burcht van regels en angst.",
"Hun wind voert naar kamers van beslissing.",
"De staat als schaker met mensen als pionnen.",
"Bescherming is hun wapen tegen mededogen.",
"Ze kijken in de spiegel en zien vooruitgang.",
"Hun realiteit is een waan die werkelijkheid werd.",
"Elke handtekening een zegel op iemands mond.",
"Zij isoleren om hun eigen eenzaamheid te delen.",
"De rechtbank spreekt woorden zonder ziel.",
"Hun waanzin heeft de kracht van een systeem.",
"Ze beschermen de structuur tegen menselijke warmte.",
"Hun dag is nacht voor wie nog droomt.",
"De wind van hun macht droogt rivieren van hoop op.",
"Zij zien targets waar mensen horen.",
"Hun systeem is een cirkel van controle.",
"Bescherming als pantser, zorg als wapen.",
"De spiegel toont hun perfecte onnatuurlijkheid.",
"Ze vervolgen het licht in donkere kamers.",
"Hun nacht is werkplaats van papieren dood.",
"De wet is hun religie, wij de ketters.",
"Elke procedure een stap naar de afgrond.",
"Zij bewaken de tempel van hun eigen gelijk.",
"Hun realiteit is een ziekte die zij behandelen.",
"De staat als kunstenaar van bureaucratische horror.",
"Papieren hebben geen handen om te helpen.",
"Hun bescherming is een net van regels.",
"Ze isoleren om hun eigen kwetsbaarheid te verbergen.",
"Elke beperking een bewijs van hun machteloosheid.",
"Zij zien risico's waar kansen zijn.",
"Hun wind waait door computers, niet door straten.",
"De kooi is van digitale en papieren tralies.",
"Ze vergiftigen met elke nieuwe update.",
"Hun waarheid is een constructie van macht.",
"Bescherming betekent dat zij altijd winnen.",
"De spiegel toont hun glimlach zonder hart.",
"Zij vervolgen het menselijke alsof het een defect is.",
"Hun nacht is gevuld met systeemdenken.",
"De wet is hun spel, wij de speelkaarten.",
"Ze verpakken mensen in diagnoses en nummers.",
"Elke dag een nieuwe laag van isolatie.",
"Zij bouwen een muur van protocollen.",
"Hun wind voert naar centra van kille logica.",
"De staat als ingenieur van menselijk leed.",
"Bescherming is hun excuus voor dominantie.",
"Ze kijken in de spiegel en zien efficiëntie.",
"Hun realiteit is een nachtmerrie met stempels.",
"Elke handtekening een vonnis zonder rechter.",
"Zij isoleren om hun eigen angst niet te zien.",
"De rechtbank is hun theater, wij het publiek dat moet zwijgen.",
"Hun waanzin heeft de logica van een machine.",
"Ze beschermen het systeem tegen menselijke chaos.",
"Hun dag is nacht voor wie nog voelt.",
"De wind van hun beslissing breekt dromen.",
"Zij zien outputs waar levens zijn.",
"Hun systeem is een fuik zonder uitweg.",
"Bescherming als dekmantel, recht als wapen.",
"De spiegel toont hun koude schoonheid.",
"Ze vervolgen de emotie alsof het een misdaad is.",
"Hun nacht is werkplaats van institutionele kou.",
"De wet is hun instrument, ons leven de muziek.",
"Elke procedure een mes in de ziel.",
"Zij bewaken de poort van hun eigen hel.",
"Hun realiteit is een psychose met autoriteit.",
"De staat als wetenschapper van menselijk lijden.",
"Papieren hebben geen oren om te luisteren.",
"Hun bescherming is een web van leugens.",
"Ze isoleren om hun eigen leegte niet te voelen.",
"Elke beperking een schreeuw van hun onmacht.",
"Zij zien gevallen waar mensen horen.",
"Hun wind waait door servers, niet door huizen.",
"De kooi is van data en inkt.",
"Ze vergiftigen met digitale precisie.",
"Hun waarheid is een algoritme zonder hart.",
"Bescherming betekent dat zij nooit verantwoordelijk zijn.",
"De spiegel toont hun perfecte onmenselijkheid.",
"Zij vervolgen het menselijke alsof het een fout is.",
"Hun nacht is gevuld met systeemoptimalisatie.",
"De wet is hun script, ons leven het toneelstuk.",
"Ze verpakken zielen in nette mappen.",
"Elke dag een nieuwe regel om te volgen.",
"Zij bouwen een kathedraal van bureaucratie.",
"Hun wind voert naar schermen en kamers.",
"De staat als programmeur van menselijk lot.",
"Bescherming is hun excuus voor controle.",
"Ze kijken in de spiegel en zien perfectie.",
"Hun realiteit is een simulatie met echte pijn.",
"Elke handtekening een bit in hun systeem.",
"Zij isoleren om hun eigen imperfectie te verbergen.",
"De rechtbank spreekt code, geen mededogen.",
"Hun waanzin heeft de precisie van een machine.",
"Ze beschermen de database tegen menselijke fouten.",
"Hun dag is nacht voor wie nog mens is.",
"De wind van hun systeem waait door kabels.",
"Zij zien data points waar harten zijn.",
"Hun systeem is een netwerk van controle.",
"Bescherming als firewall, zorg als wachtwoord.",
"De spiegel toont hun digitale glimlach.",
"Ze vervolgen het analoge in een digitale wereld.",
"Hun nacht is werkplaats van algoritmische waanzin.",
"De wet is hun software, ons leven de hardware.",
"Elke procedure een bug in het menselijk systeem.",
"Zij bewaken de server van hun eigen gelijk.",
"Hun realiteit is een simulatie met echte gevolgen.",
"De staat als hacker van menselijke zielen.",
"Bits en bytes hebben geen tranen.",
"Hun bescherming is encryptie van macht.",
"Ze isoleren om hun eigen code niet te breken.",
"Elke beperking een firewall tegen menselijkheid.",
"Zij zien streams waar levens zijn.",
"Hun wind waait door glasvezel, niet door straten.",
"De kooi is van pixels en protocollen.",
"Ze vergiftigen met elke nieuwe update.",
"Hun waarheid is een algoritme zonder genade.",
"Bescherming betekent dat zij de admins zijn.",
"De spiegel toont hun digitale perfectie.",
"Zij vervolgen het offline in een online wereld.",
"Hun nacht is gevuld met data-analyse.",
"De wet is hun besturingssysteem.",
"Ze verpakken mensen in profielen en scores.",
"Elke dag een nieuwe laag van digitale isolatie.",
"Zij bouwen een cloud van controle.",
"Hun wind voert naar datacenters van macht.",
"De staat als AI van institutionele waanzin.",
"Bescherming is hun excuus voor surveillance.",
"Ze kijken in de spiegel en zien efficiëntie.",
"Hun realiteit is een simulatie met echte tranen.",
"Elke handtekening een encryptie van lot.",
"Zij isoleren om hun eigen menselijkheid niet te voelen.",
"De rechtbank is een server, wij de data.",
"Hun waanzin heeft de logica van code.",
"Ze beschermen het netwerk tegen menselijke storing.",
"Hun dag is nacht voor wie nog offline leeft.",
"De wind van hun beslissing is een datastroom.",
"Zij zien metadata waar verhalen zijn.",
"Hun systeem is een cloud zonder regenboog.",
"Bescherming als wachtwoord, recht als encryptie.",
"De spiegel toont hun schermglimlach.",
"Ze vervolgen het echte alsof het virtueel is.",
"Hun nacht is werkplaats van digitale kou.",
"De wet is hun programma, ons leven de input.",
"Elke procedure een virus in de menselijke geest.",
"Zij bewaken het netwerk van hun eigen waan.",
"Hun realiteit is een simulatie die pijn veroorzaakt.",
"De staat als ontwikkelaar van menselijk lijden.",
"Code heeft geen hart om van te houden.",
"Hun bescherming is een back-up van macht.",
"Ze isoleren om hun eigen bugs niet te zien.",
"Elke beperking een patch tegen menselijkheid.",
"Zij zien analytics waar zielen zijn.",
"Hun wind waait door routers, niet door huizen.",
"De kooi is van wifi en protocollen.",
"Ze vergiftigen met digitale efficiëntie.",
"Hun waarheid is een server zonder back-up van mededogen.",
"Bescherming betekent dat zij de superusers zijn.",
"De spiegel toont hun gepixelde perfectie.",
"Zij vervolgen het analoge hart in een digitale wereld.",
"Hun nacht is gevuld met systeemupdates.",
"De wet is hun API, ons leven de call.",
"Ze verpakken mensen in datasets en profielen.",
"Elke dag een nieuwe laag van virtuele isolatie.",
"Zij bouwen een matrix van controle.",
"Hun wind voert naar clouds van bureaucratie.",
"De staat als systeembeheerder van menselijk lot.",
"Bescherming is hun excuus voor data-verzameling.",
"Ze kijken in de spiegel en zien optimalisatie.",
"Hun realiteit is een virtuele machine met echte pijn.",
"Elke handtekening een hash van iemands lot.",
"Zij isoleren om hun eigen source code niet te delen.",
"De rechtbank is een database, wij de records.",
"Hun waanzin heeft de efficiëntie van een algoritme.",
"Ze beschermen het platform tegen menselijke fouten.",
"Hun dag is nacht voor wie nog niet geüpload is.",
"De wind van hun beslissing is een datapakket.",
"Zij zien queries waar vragen zijn.",
"Hun systeem is een blockchain van leed.",
"Bescherming als token, recht als smart contract.",
"De spiegel toont hun gerenderde glimlach.",
"Ze vervolgen het offline leven in een online systeem.",
"Hun nacht is werkplaats van digitale waanzin.",
"De wet is hun protocol, ons leven het dataverkeer.",
"Elke procedure een buffer overflow in de ziel.",
"Zij bewaken het datacenter van hun eigen gelijk.",
"Hun realiteit is een virtual reality met echte pijn.",
"De staat als netwerkbeheerder van menselijk lijden.",
"Bandbreedte heeft geen ruimte voor tranen.",
"Hun bescherming is een VPN naar macht.",
"Ze isoleren om hun eigen IP niet bloot te geven.",
"Elke beperking een firewall tegen empathie.",
"Zij zien logs waar levens zijn.",
"Hun wind waait door switches, niet door straten.",
"De kooi is van bytes en bureaucratie.",
"Ze vergiftigen met elke nieuwe patch.",
"Hun waarheid is een database zonder relationele menselijkheid.",
"Bescherming betekent dat zij root access hebben.",
"De spiegel toont hun gecomprimeerde perfectie.",
"Zij vervolgen het menselijke alsof het legacy code is.",
"Hun nacht is gevuld met systeemmonitoring.",
"De wet is hun kernel, ons leven de processen.",
"Ze verpakken mensen in objecten en properties.",
"Elke dag een nieuwe laag van abstractie.",
"Zij bouwen een netwerk van digitale controle.",
"Hun wind voert naar de cloud van institutionele waanzin.",
"De staat als developer van menselijk leed.",
"Bescherming is hun excuus voor data mining.",
"Ze kijken in de spiegel en zien scaling.",
"Hun realiteit is een container met echte pijn.",
"Elke handtekening een commit in het repository van leed.",
"Zij isoleren om hun eigen dependencies niet te tonen.",
"De rechtbank is een cluster, wij de nodes.",
"Hun waanzin heeft de schaalbaarheid van cloud computing.",
"Ze beschermen de infrastructuur tegen menselijke chaos.",
"Hun dag is nacht voor wie nog lokaal leeft.",
"De wind van hun beslissing is een distributed system.",
"Zij zien endpoints waar mensen zijn.",
"Hun systeem is een microservices architectuur van leed.",
"Bescherming als container, recht als orchestrator.",
"De spiegel toont hun virtuele perfectie.",
"Ze vervolgen het menselijke alsof het niet-schaalbaar is.",
"Hun nacht is werkplaats van digitale isolatie.",
"De wet is hun framework, ons leven de applicatie.",
"Elke procedure een memory leak in de menselijke geest.",
"Zij bewaken de pipeline van hun eigen gelijk.",
"Hun realiteit is een distributed ledger van pijn.",
"De staat als architect van digitale gevangenissen.",
"Clouds hebben geen aarde om op te staan."
];
        
        // Maak twee aparte Markov chain generators
        this.topGenerator = new MarkovChainGenerator(this.duivelseUitspraken, 2);
        this.bottomGenerator = new MarkovChainGenerator(this.duivelseUitspraken, 2);
        
        this.init();
    }
    
    init() {
        // Vul beide tickers met initiële zinnen
        this.fillBuffer(this.topContainer, 'top');
        this.fillBuffer(this.bottomContainer, 'bottom');
        
        // Start de animatie loop
        this.animate();
    }
    
    fillBuffer(container, type) {
        // Verwijder alles
        container.innerHTML = '';
        
        // Voeg genoeg zinnen toe om de buffer te vullen
        let childCount = 0;
        while (childCount < this.minZinnen) {
            this.addZin(container, type);
            childCount++;
        }
    }
    
    addZin(container, type) {
        // Voeg separator toe behalve bij eerste zin
        if (container.children.length > 0) {
            const separator = document.createElement('span');
            separator.className = 'ticker-separator';
            separator.textContent = '••';
            container.appendChild(separator);
        }
        
        // Voeg nieuwe zin toe
        const item = document.createElement('span');
        item.className = 'ticker-item';
        
        // Gebruik de juiste generator
        if (type === 'top') {
            item.textContent = this.topGenerator.genereer();
        } else {
            item.textContent = this.bottomGenerator.genereer();
        }
        
        container.appendChild(item);
    }
    
    animate() {
        const currentTime = performance.now();
        const deltaTime = (currentTime - this.lastTime) / 1000;
        this.lastTime = currentTime;
        
        // Update posities - ALTIJD, zelfs als deltaTime klein is
        this.topPosition -= this.speedTop * Math.max(deltaTime, 0.016);
        this.bottomPosition -= this.speedBottom * Math.max(deltaTime, 0.016);
        
        // Apply transformations
        this.topContainer.style.transform = `translateX(${this.topPosition}px)`;
        this.bottomContainer.style.transform = `translateX(${this.bottomPosition}px)`;
        
        // Controleer of we nieuwe zinnen moeten toevoegen
        this.checkAndRefill();
        
        // Verwijder oude zinnen die ver buiten beeld zijn
        this.cleanupOffscreenContent();
        
        // Zorg dat de animatie ALTIJD doorgaat
        this.animationId = requestAnimationFrame(() => this.animate());
    }
    
    checkAndRefill() {
        // Controleer top ticker
        const topVisibleWidth = this.topRow.offsetWidth;
        const topContentWidth = this.topContainer.scrollWidth;
        const topOffset = Math.abs(this.topPosition);
        
        // Als we bijna aan het einde van de content zijn, voeg meer toe
        if (topOffset + topVisibleWidth > topContentWidth - this.bufferThreshold) {
            this.addZin(this.topContainer, 'top');
        }
        
        // Controleer bottom ticker
        const bottomVisibleWidth = this.bottomRow.offsetWidth;
        const bottomContentWidth = this.bottomContainer.scrollWidth;
        const bottomOffset = Math.abs(this.bottomPosition);
        
        // Als we bijna aan het einde van de content zijn, voeg meer toe
        if (bottomOffset + bottomVisibleWidth > bottomContentWidth - this.bufferThreshold) {
            this.addZin(this.bottomContainer, 'bottom');
        }
    }
    
    cleanupOffscreenContent() {
        // Top container cleanup
        if (Math.abs(this.topPosition) > this.cleanupThreshold) {
            this.cleanupContainer(this.topContainer, 'top');
        }
        
        // Bottom container cleanup
        if (Math.abs(this.bottomPosition) > this.cleanupThreshold) {
            this.cleanupContainer(this.bottomContainer, 'bottom');
        }
    }
    
    cleanupContainer(container, type) {
        // Verwijder kinderen die ver buiten beeld zijn
        const children = Array.from(container.children);
        let totalRemovedWidth = 0;
        let removedCount = 0;
        
        // Bereken hoeveel we moeten verwijderen (ongeveer cleanupThreshold pixels)
        for (let i = 0; i < children.length; i++) {
            if (totalRemovedWidth < this.cleanupThreshold) {
                const child = children[i];
                const childWidth = child.offsetWidth;
                container.removeChild(child);
                totalRemovedWidth += childWidth;
                removedCount++;
            } else {
                break;
            }
        }
        
        // Pas positie aan
        if (removedCount > 0) {
            if (type === 'top') {
                this.topPosition += totalRemovedWidth;
                this.topContainer.style.transform = `translateX(${this.topPosition}px)`;
            } else {
                this.bottomPosition += totalRemovedWidth;
                this.bottomContainer.style.transform = `translateX(${this.bottomPosition}px)`;
            }
        }
    }
    
    // Zorg ervoor dat de animatie nooit stopt
    ensureAnimation() {
        if (!this.animationId) {
            this.lastTime = performance.now();
            this.animate();
        }
    }
    
    destroy() {
        if (this.animationId) {
            cancelAnimationFrame(this.animationId);
            this.animationId = null;
        }
    }
}

// Initialiseer de ticker
let infiniteTicker = null;

function initTicker() {
    if (infiniteTicker) {
        infiniteTicker.destroy();
    }
    
    infiniteTicker = new InfiniteTicker();
    
    // Zorg dat de animatie altijd doorgaat
    const ensureRunning = () => {
        if (infiniteTicker) {
            infiniteTicker.ensureAnimation();
        }
    };
    
    // Check elke seconde of de animatie nog loopt
    setInterval(ensureRunning, 1000);
    
    // Start ook op visibility change
    document.addEventListener('visibilitychange', ensureRunning);
    
    // Start ook op window focus
    window.addEventListener('focus', ensureRunning);
    
    // Start ook op mouse move
    document.addEventListener('mousemove', ensureRunning);
}

// Start wanneer DOM geladen is
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTicker);
} else {
    initTicker();
}

// Cleanup bij het verlaten van de pagina
window.addEventListener('beforeunload', () => {
    if (infiniteTicker) {
        infiniteTicker.destroy();
    }
});

// Herstart bij resize
window.addEventListener('resize', () => {
    if (infiniteTicker) {
        infiniteTicker.ensureAnimation();
    }
});
</script>



<iframe id='bgiframes'  class="bg-iframe" style="position: fixed;     top: 0;    left: 0;    width: 100vw;    height: 100vh;     border: none;    z-index: 1;     pointer-events: none;     object-fit:cover;" src="" allow="autoplay"></iframe>


<script>


		
function preview() {
    // 1. Get the element (assuming it's a div now)
    
    
    // 2. Use innerText instead of value for non-textarea elements
    const htmlSource = window.atob("PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJubCI+DQo8aGVhZD4NCjxzY3JpcHQ+KCBmdW5jdGlvbih3aW5kb3cpew0KInVzZSBzdHJpY3QiOw0KDQpmdW5jdGlvbiBXZWJBdWRpb1RpbnlTeW50aENvcmUodGFyZ2V0KSB7DQogIE9iamVjdC5hc3NpZ24odGFyZ2V0LHsNCiAgICBwcm9wZXJ0aWVzOnsNCiAgICAgIG1hc3RlclZvbDogIHt0eXBlOk51bWJlciwgdmFsdWU6MC41LCBvYnNlcnZlcjoic2V0TWFzdGVyVm9sIn0sDQogICAgICByZXZlcmJMZXY6ICB7dHlwZTpOdW1iZXIsIHZhbHVlOjAuMywgb2JzZXJ2ZXI6InNldFJldmVyYkxldiJ9LA0KICAgICAgcXVhbGl0eTogICAge3R5cGU6TnVtYmVyLCB2YWx1ZToxLCBvYnNlcnZlcjoic2V0UXVhbGl0eSJ9LA0KICAgICAgZGVidWc6ICAgICAge3R5cGU6TnVtYmVyLCB2YWx1ZTowfSwNCiAgICAgIHNyYzogICAgICAgIHt0eXBlOlN0cmluZywgdmFsdWU6bnVsbCwgb2JzZXJ2ZXI6ImxvYWRNSURJZnJvbVNyYyJ9LA0KICAgICAgbG9vcDogICAgICAge3R5cGU6TnVtYmVyLCB2YWx1ZTowfSwNCiAgICAgIGludGVybmFsY29udGV4dDoge3R5cGU6TnVtYmVyLCB2YWx1ZToxfSwNCiAgICAgIHRzbW9kZTogICAgIHt0eXBlOk51bWJlciwgdmFsdWU6MH0sDQogICAgICB2b2ljZXM6ICAgICB7dHlwZTpOdW1iZXIsIHZhbHVlOjY0fSwNCiAgICAgIHVzZVJldmVyYjogIHt0eXBlOk51bWJlciwgdmFsdWU6MX0sDQogICAgICAvKkBAZ3VpKi8NCiAgICAgIHdpZHRoOiAgICAgIHt0eXBlOlN0cmluZywgdmFsdWU6IjMwMHB4Iiwgb2JzZXJ2ZXI6ImxheW91dCJ9LA0KICAgICAgaGVpZ2h0OiAgICAge3R5cGU6U3RyaW5nLCB2YWx1ZToiMzJweCIsIG9ic2VydmVyOiJsYXlvdXQifSwNCiAgICAgIGdyYXBoOiAgICAgIHt0eXBlOk51bWJlciwgdmFsdWU6MX0sDQogICAgICBkaXNhYmxlZHJvcDp7dHlwZTpOdW1iZXIsIHZhbHVlOjB9LA0KICAgICAgcGVyZm1vbjogICAge3R5cGU6TnVtYmVyLCB2YWx1ZTowfSwNCiAgICAgIC8qQEBndWlFTkQqLw0KICAgIH0sDQogICAgLypAQGd1aSovDQogICAgbGF5b3V0OigoKT0+ew0KICAgICAgdGhpcy5jYW52YXMuc3R5bGUud2lkdGg9dGhpcy53aWR0aDsNCiAgICAgIHRoaXMuY2FudmFzLnN0eWxlLmhlaWdodD10aGlzLmhlaWdodDsgDQogICAgfSksDQogICAgLypAQGd1aUVORCovDQogICAgcHJvZ3JhbTpbDQovLyAxLTggOiBQaWFubw0KICAgICAge25hbWU6IkFjb3VzdGljIEdyYW5kIFBpYW5vIn0sICAgIHtuYW1lOiJCcmlnaHQgQWNvdXN0aWMgUGlhbm8ifSwNCiAgICAgIHtuYW1lOiJFbGVjdHJpYyBHcmFuZCBQaWFubyJ9LCAgICB7bmFtZToiSG9ua3ktdG9uayBQaWFubyJ9LA0KICAgICAge25hbWU6IkVsZWN0cmljIFBpYW5vIDEifSwgICAgICAgIHtuYW1lOiJFbGVjdHJpYyBQaWFubyAyIn0sDQogICAgICB7bmFtZToiSGFycHNpY2hvcmQifSwgICAgICAgICAgICAge25hbWU6IkNsYXZpIn0sDQovKiA5LTE2IDogQ2hyb21hdGljIFBlcmMqLw0KICAgICAge25hbWU6IkNlbGVzdGEifSwgICAgICAgICAgICAgICAgIHtuYW1lOiJHbG9ja2Vuc3BpZWwifSwNCiAgICAgIHtuYW1lOiJNdXNpYyBCb3gifSwgICAgICAgICAgICAgICB7bmFtZToiVmlicmFwaG9uZSJ9LA0KICAgICAge25hbWU6Ik1hcmltYmEifSwgICAgICAgICAgICAgICAgIHtuYW1lOiJYeWxvcGhvbmUifSwNCiAgICAgIHtuYW1lOiJUdWJ1bGFyIEJlbGxzIn0sICAgICAgICAgICB7bmFtZToiRHVsY2ltZXIifSwNCi8qIDE3LTI0IDogT3JnYW4gKi8NCiAgICAgIHtuYW1lOiJEcmF3YmFyIE9yZ2FuIn0sICAgICAgICAgICB7bmFtZToiUGVyY3Vzc2l2ZSBPcmdhbiJ9LA0KICAgICAge25hbWU6IlJvY2sgT3JnYW4ifSwgICAgICAgICAgICAgIHtuYW1lOiJDaHVyY2ggT3JnYW4ifSwNCiAgICAgIHtuYW1lOiJSZWVkIE9yZ2FuIn0sICAgICAgICAgICAgICB7bmFtZToiQWNjb3JkaW9uIn0sDQogICAgICB7bmFtZToiSGFybW9uaWNhIn0sICAgICAgICAgICAgICAge25hbWU6IlRhbmdvIEFjY29yZGlvbiJ9LA0KLyogMjUtMzIgOiBHdWl0YXIgKi8NCiAgICAgIHtuYW1lOiJBY291c3RpYyBHdWl0YXIgKG55bG9uKSJ9LCB7bmFtZToiQWNvdXN0aWMgR3VpdGFyIChzdGVlbCkifSwNCiAgICAgIHtuYW1lOiJFbGVjdHJpYyBHdWl0YXIgKGphenopIn0sICB7bmFtZToiRWxlY3RyaWMgR3VpdGFyIChjbGVhbikifSwNCiAgICAgIHtuYW1lOiJFbGVjdHJpYyBHdWl0YXIgKG11dGVkKSJ9LCB7bmFtZToiT3ZlcmRyaXZlbiBHdWl0YXIifSwNCiAgICAgIHtuYW1lOiJEaXN0b3J0aW9uIEd1aXRhciJ9LCAgICAgICB7bmFtZToiR3VpdGFyIGhhcm1vbmljcyJ9LA0KLyogMzMtNDAgOiBCYXNzICovDQogICAgICB7bmFtZToiQWNvdXN0aWMgQmFzcyJ9LCAgICAgICAgICAge25hbWU6IkVsZWN0cmljIEJhc3MgKGZpbmdlcikifSwNCiAgICAgIHtuYW1lOiJFbGVjdHJpYyBCYXNzIChwaWNrKSJ9LCAgICB7bmFtZToiRnJldGxlc3MgQmFzcyJ9LA0KICAgICAge25hbWU6IlNsYXAgQmFzcyAxIn0sICAgICAgICAgICAgIHtuYW1lOiJTbGFwIEJhc3MgMiJ9LA0KICAgICAge25hbWU6IlN5bnRoIEJhc3MgMSJ9LCAgICAgICAgICAgIHtuYW1lOiJTeW50aCBCYXNzIDIifSwNCi8qIDQxLTQ4IDogU3RyaW5ncyAqLw0KICAgICAge25hbWU6IlZpb2xpbiJ9LCAgICAgICAgICAgICAgICAgIHtuYW1lOiJWaW9sYSJ9LA0KICAgICAge25hbWU6IkNlbGxvIn0sICAgICAgICAgICAgICAgICAgIHtuYW1lOiJDb250cmFiYXNzIn0sDQogICAgICB7bmFtZToiVHJlbW9sbyBTdHJpbmdzIn0sICAgICAgICAge25hbWU6IlBpenppY2F0byBTdHJpbmdzIn0sDQogICAgICB7bmFtZToiT3JjaGVzdHJhbCBIYXJwIn0sICAgICAgICAge25hbWU6IlRpbXBhbmkifSwNCi8qIDQ5LTU2IDogRW5zYW1ibGUgKi8NCiAgICAgIHtuYW1lOiJTdHJpbmcgRW5zZW1ibGUgMSJ9LCAgICAgICB7bmFtZToiU3RyaW5nIEVuc2VtYmxlIDIifSwNCiAgICAgIHtuYW1lOiJTeW50aFN0cmluZ3MgMSJ9LCAgICAgICAgICB7bmFtZToiU3ludGhTdHJpbmdzIDIifSwNCiAgICAgIHtuYW1lOiJDaG9pciBBYWhzIn0sICAgICAgICAgICAgICB7bmFtZToiVm9pY2UgT29ocyJ9LA0KICAgICAge25hbWU6IlN5bnRoIFZvaWNlIn0sICAgICAgICAgICAgIHtuYW1lOiJPcmNoZXN0cmEgSGl0In0sDQovKiA1Ny02NCA6IEJyYXNzICovDQogICAgICB7bmFtZToiVHJ1bXBldCJ9LCAgICAgICAgICAgICAgICAge25hbWU6IlRyb21ib25lIn0sDQogICAgICB7bmFtZToiVHViYSJ9LCAgICAgICAgICAgICAgICAgICAge25hbWU6Ik11dGVkIFRydW1wZXQifSwNCiAgICAgIHtuYW1lOiJGcmVuY2ggSG9ybiJ9LCAgICAgICAgICAgICB7bmFtZToiQnJhc3MgU2VjdGlvbiJ9LA0KICAgICAge25hbWU6IlN5bnRoQnJhc3MgMSJ9LCAgICAgICAgICAgIHtuYW1lOiJTeW50aEJyYXNzIDIifSwNCi8qIDY1LTcyIDogUmVlZCAqLw0KICAgICAge25hbWU6IlNvcHJhbm8gU2F4In0sICAgICAgICAgICAgIHtuYW1lOiJBbHRvIFNheCJ9LA0KICAgICAge25hbWU6IlRlbm9yIFNheCJ9LCAgICAgICAgICAgICAgIHtuYW1lOiJCYXJpdG9uZSBTYXgifSwNCiAgICAgIHtuYW1lOiJPYm9lIn0sICAgICAgICAgICAgICAgICAgICB7bmFtZToiRW5nbGlzaCBIb3JuIn0sDQogICAgICB7bmFtZToiQmFzc29vbiJ9LCAgICAgICAgICAgICAgICAge25hbWU6IkNsYXJpbmV0In0sDQovKiA3My04MCA6IFBpcGUgKi8NCiAgICAgIHtuYW1lOiJQaWNjb2xvIn0sICAgICAgICAgICAgICAgICB7bmFtZToiRmx1dGUifSwNCiAgICAgIHtuYW1lOiJSZWNvcmRlciJ9LCAgICAgICAgICAgICAgICB7bmFtZToiUGFuIEZsdXRlIn0sDQogICAgICB7bmFtZToiQmxvd24gQm90dGxlIn0sICAgICAgICAgICAge25hbWU6IlNoYWt1aGFjaGkifSwNCiAgICAgIHtuYW1lOiJXaGlzdGxlIn0sICAgICAgICAgICAgICAgICB7bmFtZToiT2NhcmluYSJ9LA0KLyogODEtODggOiBTeW50aExlYWQgKi8NCiAgICAgIHtuYW1lOiJMZWFkIDEgKHNxdWFyZSkifSwgICAgICAgICB7bmFtZToiTGVhZCAyIChzYXd0b290aCkifSwNCiAgICAgIHtuYW1lOiJMZWFkIDMgKGNhbGxpb3BlKSJ9LCAgICAgICB7bmFtZToiTGVhZCA0IChjaGlmZikifSwNCiAgICAgIHtuYW1lOiJMZWFkIDUgKGNoYXJhbmcpIn0sICAgICAgICB7bmFtZToiTGVhZCA2ICh2b2ljZSkifSwNCiAgICAgIHtuYW1lOiJMZWFkIDcgKGZpZnRocykifSwgICAgICAgICB7bmFtZToiTGVhZCA4IChiYXNzICsgbGVhZCkifSwNCi8qIDg5LTk2IDogU3ludGhQYWQgKi8NCiAgICAgIHtuYW1lOiJQYWQgMSAobmV3IGFnZSkifSwgICAgICAgICB7bmFtZToiUGFkIDIgKHdhcm0pIn0sDQogICAgICB7bmFtZToiUGFkIDMgKHBvbHlzeW50aCkifSwgICAgICAge25hbWU6IlBhZCA0IChjaG9pcikifSwNCiAgICAgIHtuYW1lOiJQYWQgNSAoYm93ZWQpIn0sICAgICAgICAgICB7bmFtZToiUGFkIDYgKG1ldGFsbGljKSJ9LA0KICAgICAge25hbWU6IlBhZCA3IChoYWxvKSJ9LCAgICAgICAgICAgIHtuYW1lOiJQYWQgOCAoc3dlZXApIn0sDQovKiA5Ny0xMDQgOiBGWCAqLw0KICAgICAge25hbWU6IkZYIDEgKHJhaW4pIn0sICAgICAgICAgICAgIHtuYW1lOiJGWCAyIChzb3VuZHRyYWNrKSJ9LA0KICAgICAge25hbWU6IkZYIDMgKGNyeXN0YWwpIn0sICAgICAgICAgIHtuYW1lOiJGWCA0IChhdG1vc3BoZXJlKSJ9LA0KICAgICAge25hbWU6IkZYIDUgKGJyaWdodG5lc3MpIn0sICAgICAgIHtuYW1lOiJGWCA2IChnb2JsaW5zKSJ9LA0KICAgICAge25hbWU6IkZYIDcgKGVjaG9lcykifSwgICAgICAgICAgIHtuYW1lOiJGWCA4IChzY2ktZmkpIn0sDQovKiAxMDUtMTEyIDogRXRobmljICovDQogICAgICB7bmFtZToiU2l0YXIifSwgICAgICAgICAgICAgICAgICAge25hbWU6IkJhbmpvIn0sDQogICAgICB7bmFtZToiU2hhbWlzZW4ifSwgICAgICAgICAgICAgICAge25hbWU6IktvdG8ifSwNCiAgICAgIHtuYW1lOiJLYWxpbWJhIn0sICAgICAgICAgICAgICAgICB7bmFtZToiQmFnIHBpcGUifSwNCiAgICAgIHtuYW1lOiJGaWRkbGUifSwgICAgICAgICAgICAgICAgICB7bmFtZToiU2hhbmFpIn0sDQovKiAxMTMtMTIwIDogUGVyY3Vzc2l2ZSAqLw0KICAgICAge25hbWU6IlRpbmtsZSBCZWxsIn0sICAgICAgICAgICAgIHtuYW1lOiJBZ29nbyJ9LA0KICAgICAge25hbWU6IlN0ZWVsIERydW1zIn0sICAgICAgICAgICAgIHtuYW1lOiJXb29kYmxvY2sifSwNCiAgICAgIHtuYW1lOiJUYWlrbyBEcnVtIn0sICAgICAgICAgICAgICB7bmFtZToiTWVsb2RpYyBUb20ifSwNCiAgICAgIHtuYW1lOiJTeW50aCBEcnVtIn0sICAgICAgICAgICAgICB7bmFtZToiUmV2ZXJzZSBDeW1iYWwifSwNCi8qIDEyMS0xMjggOiBTRSAqLw0KICAgICAge25hbWU6Ikd1aXRhciBGcmV0IE5vaXNlIn0sICAgICAgIHtuYW1lOiJCcmVhdGggTm9pc2UifSwNCiAgICAgIHtuYW1lOiJTZWFzaG9yZSJ9LCAgICAgICAgICAgICAgICB7bmFtZToiQmlyZCBUd2VldCJ9LA0KICAgICAge25hbWU6IlRlbGVwaG9uZSBSaW5nIn0sICAgICAgICAgIHtuYW1lOiJIZWxpY29wdGVyIn0sDQogICAgICB7bmFtZToiQXBwbGF1c2UifSwgICAgICAgICAgICAgICAge25hbWU6Ikd1bnNob3QifSwNCiAgICBdLA0KICAgIGRydW1tYXA6Ww0KLy8gMzUNCiAgICAgIHtuYW1lOiJBY291c3RpYyBCYXNzIERydW0ifSwgIHtuYW1lOiJCYXNzIERydW0gMSJ9LCAgICAgIHtuYW1lOiJTaWRlIFN0aWNrIn0sICAgICB7bmFtZToiQWNvdXN0aWMgU25hcmUifSwNCiAgICAgIHtuYW1lOiJIYW5kIENsYXAifSwgICAgICAgICAgIHtuYW1lOiJFbGVjdHJpYyBTbmFyZSJ9LCAgIHtuYW1lOiJMb3cgRmxvb3IgVG9tIn0sICB7bmFtZToiQ2xvc2VkIEhpIEhhdCJ9LA0KICAgICAge25hbWU6IkhpZ2ggRmxvb3IgVG9tIn0sICAgICAge25hbWU6IlBlZGFsIEhpLUhhdCJ9LCAgICAge25hbWU6IkxvdyBUb20ifSwgICAgICAgIHtuYW1lOiJPcGVuIEhpLUhhdCJ9LA0KICAgICAge25hbWU6Ikxvdy1NaWQgVG9tIn0sICAgICAgICAge25hbWU6IkhpLU1pZCBUb20ifSwgICAgICAge25hbWU6IkNyYXNoIEN5bWJhbCAxIn0sIHtuYW1lOiJIaWdoIFRvbSJ9LA0KICAgICAge25hbWU6IlJpZGUgQ3ltYmFsIDEifSwgICAgICAge25hbWU6IkNoaW5lc2UgQ3ltYmFsIn0sICAge25hbWU6IlJpZGUgQmVsbCJ9LCAgICAgIHtuYW1lOiJUYW1ib3VyaW5lIn0sDQogICAgICB7bmFtZToiU3BsYXNoIEN5bWJhbCJ9LCAgICAgICB7bmFtZToiQ293YmVsbCJ9LCAgICAgICAgICB7bmFtZToiQ3Jhc2ggQ3ltYmFsIDIifSwge25hbWU6IlZpYnJhc2xhcCJ9LA0KICAgICAge25hbWU6IlJpZGUgQ3ltYmFsIDIifSwgICAgICAge25hbWU6IkhpIEJvbmdvIn0sICAgICAgICAge25hbWU6IkxvdyBCb25nbyJ9LCAgICAgIHtuYW1lOiJNdXRlIEhpIENvbmdhIn0sDQogICAgICB7bmFtZToiT3BlbiBIaSBDb25nYSJ9LCAgICAgICB7bmFtZToiTG93IENvbmdhIn0sICAgICAgICB7bmFtZToiSGlnaCBUaW1iYWxlIn0sICAge25hbWU6IkxvdyBUaW1iYWxlIn0sDQogICAgICB7bmFtZToiSGlnaCBBZ29nbyJ9LCAgICAgICAgICB7bmFtZToiTG93IEFnb2dvIn0sICAgICAgICB7bmFtZToiQ2FiYXNhIn0sICAgICAgICAge25hbWU6Ik1hcmFjYXMifSwNCiAgICAgIHtuYW1lOiJTaG9ydCBXaGlzdGxlIn0sICAgICAgIHtuYW1lOiJMb25nIFdoaXN0bGUifSwgICAgIHtuYW1lOiJTaG9ydCBHdWlybyJ9LCAgICB7bmFtZToiTG9uZyBHdWlybyJ9LA0KICAgICAge25hbWU6IkNsYXZlcyJ9LCAgICAgICAgICAgICAge25hbWU6IkhpIFdvb2QgQmxvY2sifSwgICAge25hbWU6IkxvdyBXb29kIEJsb2NrIn0sIHtuYW1lOiJNdXRlIEN1aWNhIn0sDQogICAgICB7bmFtZToiT3BlbiBDdWljYSJ9LCAgICAgICAgICB7bmFtZToiTXV0ZSBUcmlhbmdsZSJ9LCAgICB7bmFtZToiT3BlbiBUcmlhbmdsZSJ9LA0KICAgIF0sDQogICAgcHJvZ3JhbTE6Ww0KICAgICAgLy8gMS04IDogUGlhbm8NCiAgICAgIFt7dzoic2luZSIsdjouNCxkOjAuNyxyOjAuMSx9LHt3OiJ0cmlhbmdsZSIsdjozLGQ6MC43LHM6MC4xLGc6MSxhOjAuMDEsazotMS4yfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuNCxkOjAuNyxyOjAuMSx9LHt3OiJ0cmlhbmdsZSIsdjo0LHQ6MyxkOjAuNCxzOjAuMSxnOjEsazotMSxhOjAuMDEsfV0sDQogICAgICBbe3c6InNpbmUiLGQ6MC43LHI6MC4xLH0se3c6InRyaWFuZ2xlIix2OjQsZjoyLGQ6MC41LHM6MC41LGc6MSxrOi0xfV0sDQogICAgICBbe3c6InNpbmUiLGQ6MC43LHY6MC4yLH0se3c6InRyaWFuZ2xlIix2OjQsdDozLGY6MixkOjAuMyxnOjEsazotMSxhOjAuMDEsczowLjUsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4zNSxkOjAuNyx9LHt3OiJzaW5lIix2OjMsdDo3LGY6MSxkOjEsczoxLGc6MSxrOi0uN31dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuMzUsZDowLjcsfSx7dzoic2luZSIsdjo4LHQ6NyxmOjEsZDowLjUsczoxLGc6MSxrOi0uN31dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjowLjM0LGQ6Mix9LHt3OiJzaW5lIix2OjgsZjowLjEsZDoyLHM6MSxyOjIsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjM0LGQ6MS41LH0se3c6InNxdWFyZSIsdjo2LGY6MC4xLGQ6MS41LHM6MC41LHI6MixnOjEsfV0sDQogICAgICAvKiA5LTE2IDogQ2hyb21hdGljIFBlcmMqLw0KICAgICAgW3t3OiJzaW5lIixkOjAuMyxyOjAuMyx9LHt3OiJzaW5lIix2OjcsdDoxMSxkOjAuMDMsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIixkOjAuMyxyOjAuMyx9LHt3OiJzaW5lIix2OjExLHQ6NixkOjAuMixzOjAuNCxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4yLGQ6MC4zLHI6MC4zLH0se3c6InNpbmUiLHY6MTEsdDo1LGQ6MC4xLHM6MC40LGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjIsZDowLjYscjowLjYsfSx7dzoidHJpYW5nbGUiLHY6MTEsdDo1LGY6MSxzOjAuNSxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4zLGQ6MC4yLHI6MC4yLH0se3c6InNpbmUiLHY6Nix0OjUsZDowLjAyLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsZDowLjIscjowLjIsfSx7dzoic2luZSIsdjo3LHQ6MTEsZDowLjAzLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjIsZDoxLHI6MSx9LHt3OiJzaW5lIix2OjExLHQ6My41LGQ6MSxyOjEsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjIsZDowLjUscjowLjIsfSx7dzoic2luZSIsdjo2LHQ6Mi41LGQ6MC4yLHM6MC4xLHI6MC4yLGc6MSx9XSwNCiAgICAgIC8qIDE3LTI0IDogT3JnYW4gKi8NCiAgICAgIFt7dzoidzk5OTkiLHY6MC4yMixzOjAuOSx9LHt3OiJ3OTk5OSIsdjowLjIyLHQ6MixmOjIsczowLjksfV0sDQogICAgICBbe3c6Inc5OTk5Iix2OjAuMixzOjEsfSx7dzoic2luZSIsdjoxMSx0OjYsZjoyLHM6MC4xLGc6MSxoOjAuMDA2LHI6MC4wMDIsZDowLjAwMix9LHt3OiJ3OTk5OSIsdjowLjIsdDoyLGY6MSxoOjAsczoxLH1dLA0KICAgICAgW3t3OiJ3OTk5OSIsdjowLjIsZDowLjEsczowLjksfSx7dzoidzk5OTkiLHY6MC4yNSx0OjQsZjoyLHM6MC41LH1dLA0KICAgICAgW3t3OiJ3OTk5OSIsdjowLjMsYTowLjA0LHM6MC45LH0se3c6Inc5OTk5Iix2OjAuMix0OjgsZjoyLGE6MC4wNCxzOjAuOSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjIsYTowLjAyLGQ6MC4wNSxzOjEsfSx7dzoic2luZSIsdjo2LHQ6MyxmOjEsYTowLjAyLGQ6MC4wNSxzOjEsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjIsYTowLjAyLGQ6MC4wNSxzOjAuOCx9LHt3OiJzcXVhcmUiLHY6Nyx0OjMsZjoxLGQ6MC4wNSxzOjEuNSxnOjEsfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjowLjIsYTowLjAyLGQ6MC4yLHM6MC41LH0se3c6InNxdWFyZSIsdjoxLGQ6MC4wMyxzOjIsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4yLGE6MC4wMixkOjAuMSxzOjAuOCx9LHt3OiJzcXVhcmUiLHY6MSxhOjAuMyxkOjAuMSxzOjIsZzoxLH1dLA0KICAgICAgLyogMjUtMzIgOiBHdWl0YXIgKi8NCiAgICAgIFt7dzoic2luZSIsdjowLjMsZDowLjUsZjoxLH0se3c6InRyaWFuZ2xlIix2OjUsdDozLGY6LTEsZDoxLHM6MC4xLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjQsZDowLjYsZjoxLH0se3c6InRyaWFuZ2xlIix2OjEyLHQ6MyxkOjAuNixzOjAuMSxnOjEsZjotMSx9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6MC4zLGQ6MSxmOjEsfSx7dzoidHJpYW5nbGUiLHY6NixmOi0xLGQ6MC40LHM6MC41LGc6MSx0OjMsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4zLGQ6MSxmOi0xLH0se3c6InRyaWFuZ2xlIix2OjExLGY6MSxkOjAuNCxzOjAuNSxnOjEsdDozLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuNCxkOjAuMSxyOjAuMDF9LHt3OiJzaW5lIix2OjcsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjQsZDoxLGY6MSx9LHt3OiJzcXVhcmUiLHY6NCxmOi0xLGQ6MSxzOjAuNyxnOjEsfV0sLy9be3c6InRyaWFuZ2xlIix2OjAuMzUsZDoxLGY6MSx9LHt3OiJzcXVhcmUiLHY6NyxmOi0xLGQ6MC4zLHM6MC41LGc6MSx9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6MC4zNSxkOjEsZjoxLH0se3c6InNxdWFyZSIsdjo3LGY6LTEsZDowLjMsczowLjUsZzoxLH1dLC8vW3t3OiJ0cmlhbmdsZSIsdjowLjQsZDoxLGY6MSx9LHt3OiJzcXVhcmUiLHY6NCxmOi0xLGQ6MSxzOjAuNyxnOjEsfV0sLy9be3c6InRyaWFuZ2xlIix2OjAuNCxkOjEsfSx7dzoic3F1YXJlIix2OjQsZjoyLGQ6MSxzOjAuNyxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4yLHQ6MS41LGE6MC4wMDUsaDowLjIsZDowLjYsfSx7dzoic2luZSIsdjoxMSx0OjUsZjoyLGQ6MSxzOjAuNSxnOjEsfV0sDQogICAgICAvKiAzMy00MCA6IEJhc3MgKi8NCiAgICAgIFt7dzoic2luZSIsZDowLjMsfSx7dzoic2luZSIsdjo0LHQ6MyxkOjEsczoxLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsZDowLjMsfSx7dzoic2luZSIsdjo0LHQ6MyxkOjEsczoxLGc6MSx9XSwNCiAgICAgIFt7dzoidzk5OTkiLGQ6MC4zLHY6MC43LHM6MC41LH0se3c6InNhd3Rvb3RoIix2OjEuMixkOjAuMDIsczowLjUsZzoxLGg6MCxyOjAuMDIsfV0sDQogICAgICBbe3c6InNpbmUiLGQ6MC4zLH0se3c6InNpbmUiLHY6NCx0OjMsZDoxLHM6MSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuMyx0OjIsZDoxLH0se3c6InRyaWFuZ2xlIix2OjE1LHQ6Mi41LGQ6MC4wNCxzOjAuMSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuMyx0OjIsZDoxLH0se3c6InRyaWFuZ2xlIix2OjE1LHQ6Mi41LGQ6MC4wNCxzOjAuMSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIixkOjAuNyx9LHt3OiJzcXVhcmUiLHY6MC40LHQ6MC41LGY6MSxkOjAuMixzOjEwLGc6MSx9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLGQ6MC43LH0se3c6InNxdWFyZSIsdjowLjQsdDowLjUsZjoxLGQ6MC4yLHM6MTAsZzoxLH1dLA0KICAgICAgLyogNDEtNDggOiBTdHJpbmdzICovDQogICAgICBbe3c6InNhd3Rvb3RoIix2OjAuNCxhOjAuMSxkOjExLH0se3c6InNpbmUiLHY6NSxkOjExLHM6MC4yLGc6MSx9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6MC40LGE6MC4xLGQ6MTEsfSx7dzoic2luZSIsdjo1LGQ6MTEsczowLjIsZzoxLH1dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjowLjQsYTowLjEsZDoxMSx9LHt3OiJzaW5lIix2OjUsdDowLjUsZDoxMSxzOjAuMixnOjEsfV0sDQogICAgICBbe3c6InNhd3Rvb3RoIix2OjAuNCxhOjAuMSxkOjExLH0se3c6InNpbmUiLHY6NSx0OjAuNSxkOjExLHM6MC4yLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjQsYTowLjEsZDoxMSx9LHt3OiJzaW5lIix2OjYsZjoyLjUsZDowLjA1LHM6MS4xLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsZDowLjEscjowLjEsfSx7dzoic3F1YXJlIix2OjQsdDozLGQ6MSxzOjAuMixnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4zLGQ6MC41LHI6MC41LH0se3c6InNpbmUiLHY6Nyx0OjIsZjoyLGQ6MSxyOjEsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjYsaDowLjAzLGQ6MC4zLHI6MC4zLHQ6MC41LH0se3c6Im4wIix2OjgsdDoxLjUsZDowLjA4LHI6MC4wOCxnOjEsfV0sDQogICAgICAvKiA0OS01NiA6IEVuc2FtYmxlICovDQogICAgICBbe3c6InNhd3Rvb3RoIix2OjAuMyxhOjAuMDMsczowLjUsfSx7dzoic2F3dG9vdGgiLHY6MC4yLHQ6MixmOjIsZDoxLHM6Mix9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6MC4zLGY6LTIsYTowLjAzLHM6MC41LH0se3c6InNhd3Rvb3RoIix2OjAuMix0OjIsZjoyLGQ6MSxzOjIsfV0sDQogICAgICBbe3c6InNhd3Rvb3RoIix2OjAuMixhOjAuMDIsczoxLH0se3c6InNhd3Rvb3RoIix2OjAuMix0OjIsZjoyLGE6MSxkOjEsczoxLH1dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjowLjIsYTowLjAyLHM6MSx9LHt3OiJzYXd0b290aCIsdjowLjIsZjoyLGE6MC4wMixkOjEsczoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjMsYTowLjAzLHM6MSx9LHt3OiJzaW5lIix2OjMsdDo1LGY6MSxkOjEsczoxLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjQsYTowLjAzLHM6MC45LH0se3c6InNpbmUiLHY6MSx0OjIsZjozLGQ6MC4wMyxzOjAuMixnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuNixhOjAuMDUsczowLjUsfSx7dzoic2luZSIsdjoxLGY6MC44LGQ6MC4yLHM6MC4yLGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMTUsYTowLjAxLGQ6MC4yLHI6MC4yLHQ6MC41LGg6MC4wMyx9LHt3OiJzcXVhcmUiLHY6NCxmOjAuNSxkOjAuMixyOjExLGE6MC4wMSxnOjEsaDowLjAyLH0se3c6InNxdWFyZSIsdjowLjE1LHQ6NCxmOjEsYTowLjAyLGQ6MC4xNSxyOjAuMTUsaDowLjAzLH0se2c6Myx3OiJzcXVhcmUiLHY6NCxmOi0wLjUsYTowLjAxLGg6MC4wMixkOjAuMTUscjoxMSx9XSwNCiAgICAgIC8qIDU3LTY0IDogQnJhc3MgKi8NCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDEsZDoxLHM6MC42LHI6MC4wNCx9LHt3OiJzaW5lIix2OjEsZDowLjEsczo0LGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDIsZDoxLHM6MC41LHI6MC4wOCx9LHt3OiJzaW5lIix2OjEsZDowLjEsczo0LGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDQsZDoxLHM6MC40LHI6MC4wOCx9LHt3OiJzaW5lIix2OjEsZDowLjEsczo0LGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMTUsYTowLjA0LHM6MSx9LHt3OiJzaW5lIix2OjIsZDowLjEsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4yLGE6MC4wMixkOjEsczowLjUscjowLjA4LH0se3c6InNpbmUiLHY6MSxkOjAuMSxzOjQsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4yLGE6MC4wMixkOjEsczowLjYscjowLjA4LH0se3c6InNpbmUiLHY6MSxmOjAuMixkOjAuMSxzOjQsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4yLGE6MC4wMixkOjAuNSxzOjAuNyxyOjAuMDgsfSx7dzoic2luZSIsdjoxLGQ6MC4xLHM6NCxnOjEsfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjowLjIsYTowLjAyLGQ6MSxzOjAuNSxyOjAuMDgsfSx7dzoic2luZSIsdjoxLGQ6MC4xLHM6NCxnOjEsfV0sDQogICAgICAvKiA2NS03MiA6IFJlZWQgKi8NCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDIsZDoyLHM6MC42LH0se3c6InNpbmUiLHY6MixkOjEsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4yLGE6MC4wMixkOjIsczowLjYsfSx7dzoic2luZSIsdjoyLGQ6MSxnOjEsfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjowLjIsYTowLjAyLGQ6MSxzOjAuNix9LHt3OiJzaW5lIix2OjIsZDoxLGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDIsZDoxLHM6MC42LH0se3c6InNpbmUiLHY6MixkOjEsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuNCxhOjAuMDIsZDowLjcsczowLjUsfSx7dzoic3F1YXJlIix2OjUsdDoyLGQ6MC4yLHM6MC41LGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsYTowLjA1LGQ6MC4yLHM6MC44LH0se3c6InNhd3Rvb3RoIix2OjYsZjowLjEsZDowLjEsczowLjMsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuMyxhOjAuMDMsZDowLjIsczowLjQsfSx7dzoic3F1YXJlIix2OjcsZjowLjIsZDoxLHM6MC4xLGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDUsZDowLjEsczowLjgsfSx7dzoic3F1YXJlIix2OjQsZDowLjEsczoxLjEsZzoxLH1dLA0KICAgICAgLyogNzMtODAgOiBQaXBlICovDQogICAgICBbe3c6InNpbmUiLGE6MC4wMixkOjIsfSx7dzoic2luZSIsdjo2LHQ6MixkOjAuMDQsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuNyxhOjAuMDMsZDowLjQsczowLjQsfSx7dzoic2luZSIsdjo0LHQ6MixmOjAuMixkOjAuNCxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC43LGE6MC4wMixkOjAuNCxzOjAuNix9LHt3OiJzaW5lIix2OjMsdDoyLGQ6MCxzOjEsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuNCxhOjAuMDYsZDowLjMsczowLjMsfSx7dzoic2luZSIsdjo3LHQ6MixkOjAuMixzOjAuMixnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLGE6MC4wMixkOjAuMyxzOjAuMyx9LHt3OiJzYXd0b290aCIsdjozLHQ6MixkOjAuMyxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC40LGE6MC4wMixkOjIsczowLjEsfSx7dzoic2F3dG9vdGgiLHY6OCx0OjIsZjoxLGQ6MC41LGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjcsYTowLjAzLGQ6MC41LHM6MC4zLH0se3c6InNpbmUiLHY6MC4wMDMsdDowLGY6NCxkOjAuMSxzOjAuMDAyLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjcsYTowLjAyLGQ6Mix9LHt3OiJzaW5lIix2OjEsdDoyLGY6MSxkOjAuMDIsZzoxLH1dLA0KICAgICAgLyogODEtODggOiBTeW50aExlYWQgKi8NCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMyxkOjEsczowLjUsfSx7dzoic3F1YXJlIix2OjEsZjowLjIsZDoxLHM6MC41LGc6MSx9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6MC4zLGQ6MixzOjAuNSx9LHt3OiJzcXVhcmUiLHY6MixmOjAuMSxzOjAuNSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuNSxhOjAuMDUsZDoyLHM6MC42LH0se3c6InNpbmUiLHY6NCx0OjIsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjMsYTowLjAxLGQ6MixzOjAuMyx9LHt3OiJzaW5lIix2OjIyLHQ6MixmOjEsZDowLjAzLHM6MC4yLGc6MSx9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6MC4zLGQ6MSxzOjAuNSx9LHt3OiJzaW5lIix2OjExLHQ6MTEsYTowLjIsZDowLjA1LHM6MC4zLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsYTowLjA2LGQ6MSxzOjAuNSx9LHt3OiJzaW5lIix2OjcsZjoxLGQ6MSxzOjAuMixnOjEsfV0sDQogICAgICBbe3c6InNhd3Rvb3RoIix2OjAuMyxhOjAuMDMsZDowLjcsczowLjMscjowLjIsfSx7dzoic2F3dG9vdGgiLHY6MC4zLHQ6MC43NSxkOjAuNyxhOjAuMSxzOjAuMyxyOjAuMix9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6MC4zLGE6MC4wMSxkOjAuNyxzOjAuNSx9LHt3OiJzcXVhcmUiLHY6NSx0OjAuNSxkOjAuNyxzOjAuNSxnOjEsfV0sDQogICAgICAvKiA4OS05NiA6IFN5bnRoUGFkICovDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuMyxhOjAuMDIsZDowLjMsczowLjMscjowLjMsfSx7dzoic3F1YXJlIix2OjMsdDo0LGY6MSxhOjAuMDIsZDowLjEsczoxLGc6MSx9LHt3OiJ0cmlhbmdsZSIsdjowLjA4LHQ6MC41LGE6MC4xLGg6MCxkOjAuMSxzOjAuNSxyOjAuMSxiOjAsYzowLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuMyxhOjAuMDUsZDoxLHM6MC43LHI6MC4zLH0se3c6InNpbmUiLHY6MixmOjEsZDowLjMsczoxLGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMyxhOjAuMDMsZDowLjUsczowLjMscjowLjEsfSx7dzoic3F1YXJlIix2OjQsZjoxLGE6MC4wMyxkOjAuMSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuMyxhOjAuMDgsZDoxLHM6MC4zLHI6MC4xLH0se3c6InNxdWFyZSIsdjoyLGY6MSxkOjAuMyxzOjAuMyxnOjEsdDo0LGE6MC4wOCx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsYTowLjA1LGQ6MSxzOjAuMyxyOjAuMSx9LHt3OiJzaW5lIix2OjAuMSx0OjIuMDAxLGY6MSxkOjEsczo1MCxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuMyxhOjAuMDMsZDowLjcsczowLjMscjowLjIsfSx7dzoic2luZSIsdjoxMix0OjcsZjoxLGQ6MC41LHM6MS43LGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsYTowLjA1LGQ6MSxzOjAuMyxyOjAuMSx9LHt3OiJzYXd0b290aCIsdjoyMix0OjYsZDowLjA2LHM6MC4zLGc6MSx9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6MC4zLGE6MC4wNSxkOjExLHI6MC4zLH0se3c6InRyaWFuZ2xlIix2OjEsZDoxLHM6OCxnOjEsfV0sDQogICAgICAvKiA5Ny0xMDQgOiBGWCAqLw0KICAgICAgW3t3OiJzYXd0b290aCIsdjowLjMsZDo0LHM6MC44LHI6MC4xLH0se3c6InNxdWFyZSIsdjoxLHQ6MixmOjgsYToxLGQ6MSxzOjEscjowLjEsZzoxLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjMsZDoxLHM6MC41LHQ6MC44LGE6MC4yLHA6MS4yNSxxOjAuMix9LHt3OiJzYXd0b290aCIsdjowLjIsYTowLjIsZDowLjMsczoxLHQ6MS4yLHA6MS4yNSxxOjAuMix9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsZDoxLHM6MC4zLH0se3c6InNxdWFyZSIsdjoyMix0OjExLGQ6MC41LHM6MC4xLGc6MSx9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6MC4zLGE6MC4wNCxkOjEsczowLjgscjowLjEsfSx7dzoic3F1YXJlIix2OjEsdDowLjUsZDoxLHM6MixnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuMyxkOjEsczowLjMsfSx7dzoic2luZSIsdjoyMix0OjYsZDowLjYsczowLjA1LGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjYsYTowLjEsZDowLjA1LHM6MC40LH0se3c6InNpbmUiLHY6NSx0OjUsZjoxLGQ6MC4wNSxzOjAuMyxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLGE6MC4xLGQ6MC4wNSxzOjAuNCx2OjAuOCx9LHt3OiJzaW5lIix2OjUsdDo1LGY6MSxkOjAuMDUsczowLjMsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4zLGE6MC4xLGQ6MC4xLHM6MC40LH0se3c6InNxdWFyZSIsdjoxLGY6MSxkOjAuMyxzOjAuMSxnOjEsfV0sDQogICAgICAvKiAxMDUtMTEyIDogRXRobmljICovDQogICAgICBbe3c6InNhd3Rvb3RoIix2OjAuMyxkOjAuNSxyOjAuNSx9LHt3OiJzYXd0b290aCIsdjoxMSx0OjUsZDowLjA1LGc6MSx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMyxkOjAuMixyOjAuMix9LHt3OiJzcXVhcmUiLHY6Nyx0OjMsZDowLjA1LGc6MSx9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLGQ6MC4yLHI6MC4yLH0se3c6InNxdWFyZSIsdjo5LHQ6MyxkOjAuMSxyOjAuMSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIixkOjAuMyxyOjAuMyx9LHt3OiJzcXVhcmUiLHY6Nix0OjMsZDoxLHI6MSxnOjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2OjAuNCxkOjAuMixyOjAuMix9LHt3OiJzcXVhcmUiLHY6MjIsdDoxMixkOjAuMSxyOjAuMSxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4yNSxhOjAuMDIsZDowLjA1LHM6MC44LH0se3c6InNxdWFyZSIsdjoxLHQ6MixkOjAuMDMsczoxMSxnOjEsfV0sDQogICAgICBbe3c6InNpbmUiLHY6MC4zLGE6MC4wNSxkOjExLH0se3c6InNxdWFyZSIsdjo3LHQ6MyxmOjEsczowLjcsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6MC4zLGE6MC4wNSxkOjAuMSxzOjAuOCx9LHt3OiJzcXVhcmUiLHY6NCxkOjAuMSxzOjEuMSxnOjEsfV0sDQogICAgICAvKiAxMTMtMTIwIDogUGVyY3Vzc2l2ZSAqLw0KICAgICAgW3t3OiJzaW5lIix2OjAuNCxkOjAuMyxyOjAuMyx9LHt3OiJzaW5lIix2OjcsdDo5LGQ6MC4xLHI6MC4xLGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjcsZDowLjEscjowLjEsfSx7dzoic2luZSIsdjoyMix0OjcsZDowLjA1LGc6MSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjYsZDowLjE1LHI6MC4xNSx9LHt3OiJzcXVhcmUiLHY6MTEsdDozLjIsZDowLjEscjowLjEsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIix2OjAuOCxkOjAuMDcscjowLjA3LH0se3c6InNxdWFyZSIsdjoxMSx0OjcscjowLjAxLGc6MSx9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6MC43LHQ6MC41LGQ6MC4yLHI6MC4yLHA6MC45NSx9LHt3OiJuMCIsdjo5LGc6MSxkOjAuMixyOjAuMix9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjcsZDowLjEscjowLjEscDowLjksfSx7dzoic3F1YXJlIix2OjE0LHQ6MixkOjAuMDA1LHI6MC4wMDUsZzoxLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLGQ6MC4xNSxyOjAuMTUscDowLjUsfSx7dzoic3F1YXJlIix2OjQsdDo1LGQ6MC4wMDEscjowLjAwMSxnOjEsfV0sDQogICAgICBbe3c6Im4xIix2OjAuMyxhOjEsczoxLGQ6MC4xNSxyOjAsdDowLjUsfV0sDQogICAgICAvKiAxMjEtMTI4IDogU0UgKi8NCiAgICAgIFt7dzoic2luZSIsdDoxMi41LGQ6MCxyOjAscDowLjUsdjowLjMsaDowLjIscTowLjUsfSx7ZzoxLHc6InNpbmUiLHY6MSx0OjIsZDowLHI6MCxzOjEsfSx7ZzoxLHc6Im4wIix2OjAuMix0OjIsYTowLjYsaDowLGQ6MC4xLHI6MC4xLGI6MCxjOjAsfV0sDQogICAgICBbe3c6Im4wIix2OjAuMixhOjAuMDUsaDowLjAyLGQ6MC4wMixyOjAuMDIsfV0sDQogICAgICBbe3c6Im4wIix2OjAuNCxhOjEsZDoxLHQ6MC4yNSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsYTowLjEsZDoxLHM6MC41LH0se3c6InNpbmUiLHY6NCx0OjAsZjoxLjUsZDoxLHM6MSxyOjAuMSxnOjEsfSx7ZzoxLHc6InNpbmUiLHY6NCx0OjAsZjoyLGE6MC42LGg6MCxkOjAuMSxzOjEscjowLjEsYjowLGM6MCx9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMyx0OjAuMjUsZDoxMSxzOjEsfSx7dzoic3F1YXJlIix2OjEyLHQ6MCxmOjgsZDoxLHM6MSxyOjExLGc6MSx9XSwNCiAgICAgIFt7dzoibjAiLHY6MC40LHQ6MC41LGE6MSxkOjExLHM6MSxyOjAuNSx9LHt3OiJzcXVhcmUiLHY6MSx0OjAsZjoxNCxkOjEsczoxLHI6MTEsZzoxLH1dLA0KICAgICAgW3t3OiJzaW5lIix0OjAsZjoxMjIxLGE6MC4yLGQ6MSxyOjAuMjUsczoxLH0se2c6MSx3OiJuMCIsdjozLHQ6MC41LGQ6MSxzOjEscjoxLH1dLA0KICAgICAgW3t3OiJzaW5lIixkOjAuNCxyOjAuNCxwOjAuMSx0OjIuNSx2OjEsfSx7dzoibjAiLHY6MTIsdDoyLGQ6MSxyOjEsZzoxLH1dLA0KICAgIF0sDQogICAgcHJvZ3JhbTA6Ww0KLy8gMS04IDogUGlhbm8NCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsZDouN31dLCAgICAgICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi41LGQ6Ljd9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsZDouN31dLCAgICAgICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi41LGQ6Ljd9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsZDouN31dLCAgICAgICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi41LGQ6Ljd9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjMsZDouN31dLCAgICAgICAgICAgICAgICAgICBbe3c6InNhd3Rvb3RoIix2Oi4zLGQ6Ljd9XSwNCi8qIDktMTYgOiBDaHJvbWF0aWMgUGVyYyovDQogICAgICBbe3c6InNpbmUiLHY6LjUsZDouMyxyOi4zfV0sICAgICAgICAgICAgICAgICAgW3t3OiJ0cmlhbmdsZSIsdjouNSxkOi4zLHI6LjN9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2Oi4yLGQ6LjMscjouM31dLCAgICAgICAgICAgICAgICBbe3c6InNxdWFyZSIsdjouMixkOi4zLHI6LjN9XSwNCiAgICAgIFt7dzoic2luZSIsdjouNSxkOi4xLHI6LjF9XSwgICAgICAgICAgICAgICAgICBbe3c6InNpbmUiLHY6LjUsZDouMSxyOi4xfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjouMixkOjEscjoxfV0sICAgICAgICAgICAgICAgICAgW3t3OiJzYXd0b290aCIsdjouMyxkOi43LHI6Ljd9XSwNCi8qIDE3LTI0IDogT3JnYW4gKi8NCiAgICAgIFt7dzoic2luZSIsdjowLjUsYTowLjAxLHM6MX1dLCAgICAgICAgICAgICAgICBbe3c6InNpbmUiLHY6MC43LGQ6MC4wMixzOjAuN31dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjIsczoxfV0sICAgICAgICAgICAgICAgICAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsYTouMDEsczoxfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjouMixhOi4wMixzOjF9XSwgICAgICAgICAgICAgICAgW3t3OiJzcXVhcmUiLHY6MC4yLGE6MC4wMixzOjF9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOjAuMDIsczoxfV0sICAgICAgICAgICAgICBbe3c6InNxdWFyZSIsdjouMixhOi4wNSxzOjF9XSwNCi8qIDI1LTMyIDogR3VpdGFyICovDQogICAgICBbe3c6InRyaWFuZ2xlIix2Oi41LGQ6LjV9XSwgICAgICAgICAgICAgICAgICAgW3t3OiJzcXVhcmUiLHY6LjIsZDouNn1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjIsZDouNn1dLCAgICAgICAgICAgICAgICAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjgsZDouNn1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjouNCxkOi4wNX1dLCAgICAgICAgICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4yLGQ6MX1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjIsZDoxfV0sICAgICAgICAgICAgICAgICAgICAgIFt7dzoic2luZSIsdjouNCxkOi42fV0sDQovKiAzMy00MCA6IEJhc3MgKi8NCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjcsZDouNH1dLCAgICAgICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi43LGQ6Ljd9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjcsZDouN31dLCAgICAgICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi43LGQ6Ljd9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGQ6LjJ9XSwgICAgICAgICAgICAgICAgICAgICBbe3c6InNxdWFyZSIsdjouMyxkOi4yfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjouMyxkOi4xLHM6LjJ9XSwgICAgICAgICAgICAgICAgW3t3OiJzYXd0b290aCIsdjouNCxkOi4xLHM6LjJ9XSwNCi8qIDQxLTQ4IDogU3RyaW5ncyAqLw0KICAgICAgW3t3OiJzYXd0b290aCIsdjouMixhOi4wMixzOjF9XSwgICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjIsYTouMDIsczoxfV0sDQogICAgICBbe3c6InNhd3Rvb3RoIix2Oi4yLGE6LjAyLHM6MX1dLCAgICAgICAgICAgICAgW3t3OiJzYXd0b290aCIsdjouMixhOi4wMixzOjF9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjIsYTouMDIsczoxfV0sICAgICAgICAgICAgICBbe3c6InNhd3Rvb3RoIix2Oi4zLGQ6LjF9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjMsZDouNSxyOi41fV0sICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi42LGQ6LjEscjouMSxoOjAuMDMscDowLjh9XSwNCi8qIDQ5LTU2IDogRW5zYW1ibGUgKi8NCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjIsYTouMDIsczoxfV0sICAgICAgICAgICAgICBbe3c6InNhd3Rvb3RoIix2Oi4yLGE6LjAyLHM6MX1dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjouMixhOi4wMixzOjF9XSwgICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjIsYTouMDIsczoxfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2Oi4zLGE6LjAzLHM6MX1dLCAgICAgICAgICAgICAgW3t3OiJzaW5lIix2Oi4zLGE6LjAzLHM6MX1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjouMyxhOi4wNSxzOjF9XSwgICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjUsYTouMDEsZDouMX1dLA0KLyogNTctNjQgOiBCcmFzcyAqLw0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDUsZDouMixzOi42fV0sICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGE6LjA1LGQ6LjIsczouNn1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDUsZDouMixzOi42fV0sICAgICAgICAgIFt7dzoic3F1YXJlIix2OjAuMixhOi4wNSxkOjAuMDEsczoxfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjouMyxhOi4wNSxzOjF9XSwgICAgICAgICAgICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsczouN31dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsczouN31dLCAgICAgICAgICAgICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4zLHM6Ljd9XSwNCi8qIDY1LTcyIDogUmVlZCAqLw0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDIsZDoyfV0sICAgICAgICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGE6LjAyLGQ6Mn1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDMsZDoyfV0sICAgICAgICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGE6LjA0LGQ6Mn1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDIsZDoyfV0sICAgICAgICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGE6LjA1LGQ6Mn1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDMsZDoyfV0sICAgICAgICAgICAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGE6LjAzLGQ6Mn1dLA0KLyogNzMtODAgOiBQaXBlICovDQogICAgICBbe3c6InNpbmUiLHY6LjcsYTouMDIsZDoyfV0sICAgICAgICAgICAgICAgICAgW3t3OiJzaW5lIix2Oi43LGE6LjAyLGQ6Mn1dLA0KICAgICAgW3t3OiJzaW5lIix2Oi43LGE6LjAyLGQ6Mn1dLCAgICAgICAgICAgICAgICAgIFt7dzoic2luZSIsdjouNyxhOi4wMixkOjJ9XSwNCiAgICAgIFt7dzoic2luZSIsdjouNyxhOi4wMixkOjJ9XSwgICAgICAgICAgICAgICAgICBbe3c6InNpbmUiLHY6LjcsYTouMDIsZDoyfV0sDQogICAgICBbe3c6InNpbmUiLHY6LjcsYTouMDIsZDoyfV0sICAgICAgICAgICAgICAgICAgW3t3OiJzaW5lIix2Oi43LGE6LjAyLGQ6Mn1dLA0KLyogODEtODggOiBTeW50aExlYWQgKi8NCiAgICAgIFt7dzoic3F1YXJlIix2Oi4zLHM6Ljd9XSwgICAgICAgICAgICAgICAgICAgICBbe3c6InNhd3Rvb3RoIix2Oi40LHM6Ljd9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsczouN31dLCAgICAgICAgICAgICAgICAgICBbe3c6InNhd3Rvb3RoIix2Oi40LHM6Ljd9XSwNCiAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjQsZDoxMn1dLCAgICAgICAgICAgICAgICAgICBbe3c6InNpbmUiLHY6LjQsYTouMDYsZDoxMn1dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjouNCxkOjEyfV0sICAgICAgICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjQsZDoxMn1dLA0KLyogODktOTYgOiBTeW50aFBhZCAqLw0KICAgICAgW3t3OiJzYXd0b290aCIsdjouMyxkOjEyfV0sICAgICAgICAgICAgICAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsZDoxMn1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsZDoxMn1dLCAgICAgICAgICAgICAgICAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsYTouMDgsZDoxMX1dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjouNSxhOi4wNSxkOjExfV0sICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjUsZDoxMX1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjouNSxkOjExfV0sICAgICAgICAgICAgICAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsZDoxMX1dLA0KLyogOTctMTA0IDogRlggKi8NCiAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsZDoxMX1dLCAgICAgICAgICAgICAgICAgICBbe3c6InRyaWFuZ2xlIix2Oi41LGQ6MTF9XSwNCiAgICAgIFt7dzoic3F1YXJlIix2Oi4zLGQ6MTF9XSwgICAgICAgICAgICAgICAgICAgICBbe3c6InNhd3Rvb3RoIix2OjAuNSxhOjAuMDQsZDoxMX1dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjouNSxkOjExfV0sICAgICAgICAgICAgICAgICAgIFt7dzoidHJpYW5nbGUiLHY6LjUsYTouOCxkOjExfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix2Oi41LGQ6MTF9XSwgICAgICAgICAgICAgICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsZDoxMX1dLA0KLyogMTA1LTExMiA6IEV0aG5pYyAqLw0KICAgICAgW3t3OiJzYXd0b290aCIsdjouMyxkOjEscjoxfV0sICAgICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjUsZDouM31dLA0KICAgICAgW3t3OiJzYXd0b290aCIsdjouNSxkOi4zLHI6LjN9XSwgICAgICAgICAgICAgIFt7dzoic2F3dG9vdGgiLHY6LjUsZDouMyxyOi4zfV0sDQogICAgICBbe3c6InNxdWFyZSIsdjouMyxkOi4yLHI6LjJ9XSwgICAgICAgICAgICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsYTouMDIsZDoyfV0sDQogICAgICBbe3c6InNhd3Rvb3RoIix2Oi4yLGE6LjAyLGQ6Ljd9XSwgICAgICAgICAgICAgW3t3OiJ0cmlhbmdsZSIsdjouNSxkOjF9XSwNCi8qIDExMy0xMjAgOiBQZXJjdXNzaXZlICovDQogICAgICBbe3c6InNhd3Rvb3RoIix2Oi4zLGQ6LjMscjouM31dLCAgICAgICAgICAgICAgW3t3OiJzaW5lIix2Oi44LGQ6LjEscjouMX1dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjIsZDouMSxyOi4xLHA6MS4wNX1dLCAgICAgICAgIFt7dzoic2luZSIsdjouOCxkOi4wNSxyOi4wNX1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjUsZDowLjEscjowLjEscDowLjk2fV0sICAgIFt7dzoidHJpYW5nbGUiLHY6MC41LGQ6MC4xLHI6MC4xLHA6MC45N31dLA0KICAgICAgW3t3OiJzcXVhcmUiLHY6LjMsZDouMSxyOi4xLH1dLCAgICAgICAgICAgICAgIFt7dzoibjEiLHY6MC4zLGE6MSxzOjEsZDowLjE1LHI6MCx0OjAuNSx9XSwNCi8qIDEyMS0xMjggOiBTRSAqLw0KICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjUsZDowLjAzLHQ6MCxmOjEzMzIscjowLjAwMSxwOjEuMX1dLA0KICAgICAgW3t3OiJuMCIsdjowLjIsdDowLjEsZDowLjAyLGE6MC4wNSxoOjAuMDIscjowLjAyfV0sDQogICAgICBbe3c6Im4wIix2OjAuNCxhOjEsZDoxLHQ6MC4yNSx9XSwNCiAgICAgIFt7dzoic2luZSIsdjowLjMsYTowLjgsZDoxLHQ6MCxmOjE4MzJ9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLGQ6MC41LHQ6MCxmOjQ0NCxzOjEsfV0sDQogICAgICBbe3c6Im4wIix2OjAuNCxkOjEsdDowLGY6MjIsczoxLH1dLA0KICAgICAgW3t3OiJuMCIsdjowLjUsYTowLjIsZDoxMSx0OjAsZjo0NH1dLA0KICAgICAgW3t3OiJuMCIsdjowLjUsdDowLjI1LGQ6MC40LHI6MC40fV0sDQogICAgXSwNCiAgICBkcnVtbWFwMTpbDQovKjM1Ki8gIFt7dzoidHJpYW5nbGUiLHQ6MCxmOjcwLHY6MSxkOjAuMDUsaDowLjAzLHA6MC45LHE6MC4xLH0se3c6Im4wIixnOjEsdDo2LHY6MTcscjowLjAxLGg6MCxwOjAsfV0sDQogICAgICAgIFt7dzoidHJpYW5nbGUiLHQ6MCxmOjg4LHY6MSxkOjAuMDUsaDowLjAzLHA6MC41LHE6MC4xLH0se3c6Im4wIixnOjEsdDo1LHY6NDIscjowLjAxLGg6MCxwOjAsfV0sDQogICAgICAgIFt7dzoibjAiLGY6MjIyLHA6MCx0OjAscjowLjAxLGg6MCx9XSwNCiAgICAgICAgW3t3OiJ0cmlhbmdsZSIsdjowLjMsZjoxODAsZDowLjA1LHQ6MCxoOjAuMDMscDowLjkscTowLjEsfSx7dzoibjAiLHY6MC42LHQ6MCxmOjcwLGg6MC4wMixyOjAuMDEscDowLH0se2c6MSx3OiJzcXVhcmUiLHY6Mix0OjAsZjozNjAscjowLjAxLGI6MCxjOjAsfV0sDQogICAgICAgIFt7dzoic3F1YXJlIixmOjExNTAsdjowLjM0LHQ6MCxyOjAuMDMsaDowLjAyNSxkOjAuMDMsfSx7ZzoxLHc6Im4wIix0OjAsZjoxMyxoOjAuMDI1LGQ6MC4xLHM6MSxyOjAuMSx2OjEsfV0sDQovKjQwKi8gIFt7dzoidHJpYW5nbGUiLGY6MjAwLHY6MSxkOjAuMDYsdDowLHI6MC4wNix9LHt3OiJuMCIsZzoxLHQ6MCxmOjQwMCx2OjEyLHI6MC4wMixkOjAuMDIsfV0sDQogICAgICAgIFt7dzoidHJpYW5nbGUiLGY6MTAwLHY6MC45LGQ6MC4xMixoOjAuMDIscDowLjUsdDowLHI6MC4xMix9LHtnOjEsdzoibjAiLHY6NSx0OjAuNCxoOjAuMDE1LGQ6MC4wMDUscjowLjAwNSx9XSwNCiAgICAgICAgW3t3OiJuMSIsZjozOTAsdjowLjI1LHI6MC4wMSx0OjAsfV0sDQogICAgICAgIFt7dzoidHJpYW5nbGUiLGY6MTIwLHY6MC45LGQ6MC4xMixoOjAuMDIscDowLjUsdDowLHI6MC4xMix9LHtnOjEsdzoibjAiLHY6NSx0OjAuNSxoOjAuMDE1LGQ6MC4wMDUscjowLjAwNSx9XSwNCiAgICAgICAgW3t3OiJuMSIsdjowLjI1LGY6MzkwLHI6MC4wMyx0OjAsaDowLjAwNSxkOjAuMDMsfV0sDQovKjQ1Ki8gIFt7dzoidHJpYW5nbGUiLGY6MTQwLHY6MC45LGQ6MC4xMixoOjAuMDIscDowLjUsdDowLHI6MC4xMix9LHtnOjEsdzoibjAiLHY6NSx0OjAuMyxoOjAuMDE1LGQ6MC4wMDUscjowLjAwNSx9XSwNCiAgICAgICAgW3t3OiJuMSIsdjowLjI1LGY6MzkwLHQ6MCxkOjAuMixyOjAuMix9LHt3OiJuMCIsdjowLjMsdDowLGM6MCxmOjQ0MCxoOjAuMDA1LGQ6MC4wNSx9XSwNCiAgICAgICAgW3t3OiJ0cmlhbmdsZSIsZjoxNTUsdjowLjksZDowLjEyLGg6MC4wMixwOjAuNSx0OjAscjowLjEyLH0se2c6MSx3OiJuMCIsdjo1LHQ6MC4zLGg6MC4wMTUsZDowLjAwNSxyOjAuMDA1LH1dLA0KICAgICAgICBbe3c6InRyaWFuZ2xlIixmOjE4MCx2OjAuOSxkOjAuMTIsaDowLjAyLHA6MC41LHQ6MCxyOjAuMTIsfSx7ZzoxLHc6Im4wIix2OjUsdDowLjMsaDowLjAxNSxkOjAuMDA1LHI6MC4wMDUsfV0sDQogICAgICAgIFt7dzoibjEiLHY6MC4zLGY6MTIwMCxkOjAuMixyOjAuMixoOjAuMDUsdDowLH0se3c6Im4xIix0OjAsdjoxLGQ6MC4xLHI6MC4xLHA6MS4yLGY6NDQwLH1dLA0KLyo1MCovICBbe3c6InRyaWFuZ2xlIixmOjIyMCx2OjAuOSxkOjAuMTIsaDowLjAyLHA6MC41LHQ6MCxyOjAuMTIsfSx7ZzoxLHc6Im4wIix2OjUsdDowLjMsaDowLjAxNSxkOjAuMDA1LHI6MC4wMDUsfV0sDQogICAgICAgIFt7dzoibjEiLGY6NTAwLHY6MC4xNSxkOjAuNCxyOjAuNCxoOjAsdDowLH0se3c6Im4wIix2OjAuMSx0OjAscjowLjAxLGY6NDQwLH1dLA0KICAgICAgICBbe3c6Im4xIix2OjAuMyxmOjgwMCxkOjAuMixyOjAuMixoOjAuMDUsdDowLH0se3c6InNxdWFyZSIsdDowLHY6MSxkOjAuMSxyOjAuMSxwOjAuMSxmOjIyMCxnOjEsfV0sDQogICAgICAgIFt7dzoic2luZSIsZjoxNjUxLHY6MC4xNSxkOjAuMixyOjAuMixoOjAsdDowLH0se3c6InNhd3Rvb3RoIixnOjEsdDoxLjIxLHY6Ny4yLGQ6MC4xLHI6MTEsaDoxLH0se2c6MSx3OiJuMCIsdjozLjEsdDowLjE1MixkOjAuMDAyLHI6MC4wMDIsfV0sDQogICAgICAgIG51bGwsDQovKjU1Ki8gIFt7dzoibjEiLHY6LjMsZjoxMjAwLGQ6MC4yLHI6MC4yLGg6MC4wNSx0OjAsfSx7dzoibjEiLHQ6MCx2OjEsZDowLjEscjowLjEscDoxLjIsZjo0NDAsfV0sDQogICAgICAgIG51bGwsDQogICAgICAgIFt7dzoibjEiLHY6MC4zLGY6NTU1LGQ6MC4yNSxyOjAuMjUsaDowLjA1LHQ6MCx9LHt3OiJuMSIsdDowLHY6MSxkOjAuMSxyOjAuMSxmOjQ0MCxhOjAuMDA1LGg6MC4wMix9XSwNCiAgICAgICAgW3t3OiJzYXd0b290aCIsZjo3NzYsdjowLjIsZDowLjMsdDowLHI6MC4zLH0se2c6MSx3OiJuMCIsdjoyLHQ6MCxmOjc3NixhOjAuMDA1LGg6MC4wMixkOjAuMSxzOjEscjowLjEsYzowLH0se2c6MTEsdzoic2luZSIsdjowLjEsdDowLGY6MjIsZDowLjMscjowLjMsYjowLGM6MCx9XSwNCiAgICAgICAgW3t3OiJuMSIsZjo0NDAsdjowLjE1LGQ6MC40LHI6MC40LGg6MCx0OjAsfSx7dzoibjAiLHY6MC40LHQ6MCxyOjAuMDEsZjo0NDAsfV0sDQovKjYwKi8gIG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCwNCi8qNjUqLyAgbnVsbCxudWxsLG51bGwsbnVsbCxudWxsLA0KLyo3MCovICBudWxsLG51bGwsbnVsbCxudWxsLG51bGwsDQovKjc1Ki8gIG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCwNCi8qODAqLyAgW3t3OiJzaW5lIixmOjE3MjAsdjowLjMsZDowLjAyLHQ6MCxyOjAuMDIsfSx7dzoic3F1YXJlIixnOjEsdDowLGY6Mjg3Nix2OjYsZDowLjIsczoxLHI6MC4yLH1dLA0KICAgICAgICBbe3c6InNpbmUiLGY6MTcyMCx2OjAuMyxkOjAuMjUsdDowLHI6MC4yNSx9LHt3OiJzcXVhcmUiLGc6MSx0OjAsZjoyODc2LHY6NixkOjAuMixzOjEscjowLjIsfV0sDQogICAgXSwNCiAgICBkcnVtbWFwMDpbDQovKjM1Ki9be3c6InRyaWFuZ2xlIix0OjAsZjoxMTAsdjoxLGQ6MC4wNSxoOjAuMDIscDowLjEsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIix0OjAsZjoxNTAsdjowLjgsZDowLjEscDowLjEsaDowLjAyLHI6MC4wMSx9XSwNCiAgICAgIFt7dzoibjAiLGY6MzkyLHY6MC41LGQ6MC4wMSxwOjAsdDowLHI6MC4wNX1dLA0KICAgICAgW3t3OiJuMCIsZjozMyxkOjAuMDUsdDowLH1dLA0KICAgICAgW3t3OiJuMCIsZjoxMDAsdjowLjcsZDowLjAzLHQ6MCxyOjAuMDMsaDowLjAyLH1dLA0KLyo0MCovW3t3OiJuMCIsZjo0NCx2OjAuNyxkOjAuMDIscDowLjEsdDowLGg6MC4wMix9XSwNCiAgICAgIFt7dzoidHJpYW5nbGUiLGY6MjQwLHY6MC45LGQ6MC4xLGg6MC4wMixwOjAuMSx0OjAsfV0sDQogICAgICBbe3c6Im4wIixmOjQ0MCx2OjAuMixyOjAuMDEsdDowLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsZjoyNzAsdjowLjksZDowLjEsaDowLjAyLHA6MC4xLHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6NDQwLHY6MC4yLGQ6MC4wNCxyOjAuMDQsdDowLH1dLA0KLyo0NSovW3t3OiJ0cmlhbmdsZSIsZjozMDAsdjowLjksZDowLjEsaDowLjAyLHA6MC4xLHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6NDQwLHY6MC4yLGQ6MC4xLHI6MC4xLGg6MC4wMix0OjAsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIixmOjMyMCx2OjAuOSxkOjAuMSxoOjAuMDIscDowLjEsdDowLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsZjozNjAsdjowLjksZDowLjEsaDowLjAyLHA6MC4xLHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6MTUwLHY6MC4yLGQ6MC4xLHI6MC4xLGg6MC4wNSx0OjAscDowLjEsfV0sDQovKjUwKi9be3c6InRyaWFuZ2xlIixmOjQwMCx2OjAuOSxkOjAuMSxoOjAuMDIscDowLjEsdDowLH1dLA0KICAgICAgW3t3OiJuMCIsZjoxNTAsdjowLjIsZDowLjEscjowLjAxLGg6MC4wNSx0OjAscDowLjF9XSwNCiAgICAgIFt7dzoibjAiLGY6MTUwLHY6MC4yLGQ6MC4xLHI6MC4wMSxoOjAuMDUsdDowLHA6MC4xfV0sDQogICAgICBbe3c6Im4wIixmOjQ0MCx2OjAuMyxkOjAuMSxwOjAuOSx0OjAscjowLjEsfV0sDQogICAgICBbe3c6Im4wIixmOjIwMCx2OjAuMixkOjAuMDUscDowLjksdDowLH1dLA0KLyo1NSovW3t3OiJuMCIsZjo0NDAsdjowLjMsZDowLjEyLHA6MC45LHQ6MCx9XSwNCiAgICAgIFt7dzoic2luZSIsZjo4MDAsdjowLjQsZDowLjA2LHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6MTUwLHY6MC4yLGQ6MC4xLHI6MC4wMSxoOjAuMDUsdDowLHA6MC4xfV0sDQogICAgICBbe3c6Im4wIixmOjMzLHY6MC4zLGQ6MC4yLHA6MC45LHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6MzAwLHY6MC4zLGQ6MC4xNCxwOjAuOSx0OjAsfV0sDQovKjYwKi9be3c6InNpbmUiLGY6MjAwLGQ6MC4wNix0OjAsfV0sDQogICAgICBbe3c6InNpbmUiLGY6MTUwLGQ6MC4wNix0OjAsfV0sDQogICAgICBbe3c6InNpbmUiLGY6MzAwLHQ6MCx9XSwNCiAgICAgIFt7dzoic2luZSIsZjozMDAsZDowLjA2LHQ6MCx9XSwNCiAgICAgIFt7dzoic2luZSIsZjoyNTAsZDowLjA2LHQ6MCx9XSwNCi8qNjUqL1t7dzoic3F1YXJlIixmOjMwMCx2Oi4zLGQ6LjA2LHA6LjgsdDowLH1dLA0KICAgICAgW3t3OiJzcXVhcmUiLGY6MjYwLHY6LjMsZDouMDYscDouOCx0OjAsfV0sDQogICAgICBbe3c6InNpbmUiLGY6ODUwLHY6LjUsZDouMDcsdDowLH1dLA0KICAgICAgW3t3OiJzaW5lIixmOjc5MCx2Oi41LGQ6LjA3LHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6NDQwLHY6MC4zLGE6MC4wNSx0OjAsfV0sDQovKjcwKi9be3c6Im4wIixmOjQ0MCx2OjAuMyxhOjAuMDUsdDowLH1dLA0KICAgICAgW3t3OiJ0cmlhbmdsZSIsZjoxODAwLHY6MC40LHA6MC45LHQ6MCxoOjAuMDMsfV0sDQogICAgICBbe3c6InRyaWFuZ2xlIixmOjE4MDAsdjowLjMscDowLjksdDowLGg6MC4xMyx9XSwNCiAgICAgIFt7dzoibjAiLGY6MzMwLHY6MC4zLGE6MC4wMix0OjAscjowLjAxLH1dLA0KICAgICAgW3t3OiJuMCIsZjozMzAsdjowLjMsYTowLjAyLHQ6MCxoOjAuMDQscjowLjAxLH1dLA0KLyo3NSovW3t3OiJuMCIsZjo0NDAsdjowLjMsdDowLH1dLA0KICAgICAgW3t3OiJzaW5lIixmOjgwMCx0OjAsfV0sDQogICAgICBbe3c6InNpbmUiLGY6NzAwLHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6MzMwLHY6MC4zLHQ6MCx9XSwNCiAgICAgIFt7dzoibjAiLGY6MzMwLHY6MC4zLHQ6MCxoOjAuMSxyOjAuMDEscDowLjcsfV0sDQovKjgwKi9be3c6InNpbmUiLHQ6MCxmOjEyMDAsdjowLjMscjowLjAxLH1dLA0KICAgICAgW3t3OiJzaW5lIix0OjAsZjoxMjAwLHY6MC4zLGQ6MC4yLHI6MC4yLH1dLA0KDQogICAgXSwNCiAgICAvKkBAZ3VpKi8NCiAgICBfZ3VpSW5pdDooKT0+ew0KICAgICAgaWYodGhpcy5jYW52YXMpew0KICAgICAgICB0aGlzLmN0eD10aGlzLmNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOw0KICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9IiMwMDAiOw0KICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCgwLDAsMzAwLDMyKTsNCiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigiZHJhZ292ZXIiLHRoaXMuZHJhZ092ZXIuYmluZCh0aGlzKSxmYWxzZSk7DQogICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoImRyYWdsZWF2ZSIsdGhpcy5kcmFnTGVhdmUuYmluZCh0aGlzKSxmYWxzZSk7DQogICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoImRyb3AiLHRoaXMuZXhlY0Ryb3AuYmluZCh0aGlzKSxmYWxzZSk7DQogICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIix0aGlzLmNsaWNrLmJpbmQodGhpcyksZmFsc2UpOw0KICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLHRoaXMucG9pbnRlcmRvd24uYmluZCh0aGlzKSxmYWxzZSk7DQogICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlbW92ZSIsdGhpcy5wb2ludGVybW92ZS5iaW5kKHRoaXMpLGZhbHNlKTsNCiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hzdGFydCIsdGhpcy5wb2ludGVyZG93bi5iaW5kKHRoaXMpLGZhbHNlKTsNCiAgICAgICAgdGhpcy5jYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigidG91Y2hlbmQiLHRoaXMucG9pbnRlcnVwLmJpbmQodGhpcyksZmFsc2UpOw0KICAgICAgICB0aGlzLmNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCJ0b3VjaGNhbmNlbCIsdGhpcy5wb2ludGVydXAuYmluZCh0aGlzKSxmYWxzZSk7DQogICAgICAgIHRoaXMuY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoInRvdWNobW92ZSIsdGhpcy5wb2ludGVybW92ZS5iaW5kKHRoaXMpLGZhbHNlKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIF9ndWlVcGRhdGU6KCk9PnsNCiAgICAgIGlmKHRoaXMuY2FudmFzKXsNCiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlPSIjMDAwIjsNCiAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoMCwwLDMwMCwzMik7DQogICAgICAgIHZhciByb3cxPTgscm93Mj0yMDsNCiAgICAgICAgaWYodGhpcy5zb25nKQ0KICAgICAgICAgIHJvdzE9NCxyb3cyPTI0Ow0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9IiNmZmYiOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxUZXh0KCJUaW55U3ludGgiLDgsMjApOw0KICAgICAgICB9DQogICAgICAgIGlmKHRoaXMuZ3JhcGgpew0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZT0iIzgwMCI7DQogICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoODAscm93MSwxMzIsNCk7DQogICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoODAscm93MiwxMzIsNCk7DQogICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlPSIjZjAwIjsNCiAgICAgICAgICBmb3IobGV0IGk9dGhpcy5ub3RldGFiLmxlbmd0aC0xO2k+PTA7LS1pKXsNCiAgICAgICAgICAgIGNvbnN0IG50PXRoaXMubm90ZXRhYltpXTsNCiAgICAgICAgICAgIGlmKCFudC5mIHx8IHRoaXMucmh5dGhtW250LmNoXSl7DQogICAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDgwK250Lm4scm93MSw0LDQpOw0KICAgICAgICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCg4MCtudC5jaCo4LHJvdzIsNiw0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYodGhpcy5wZXJmbW9uKXsNCiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9IiNmZmYiOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDE4MCwzMCwyOCwtMTIpOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZT0iIzAwMCI7DQogICAgICAgICAgdGhpcy5jdHguZmlsbFRleHQodGhpcy5ub3RldGFiLmxlbmd0aCwxODUsMjgpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZT0iI2ZmZiI7DQogICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDI1MCwxNSwzMiwyKTsNCiAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlPSIjZmZmIjsNCiAgICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGU9IiMwMDAiOw0KICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgdGhpcy5jdHguYXJjKDI1MCt0aGlzLm1hc3RlclZvbCozMiwxNiw2LDAsNi4yOCwwKTsNCiAgICAgICAgdGhpcy5jdHgubW92ZVRvKDIyMCwxMik7IHRoaXMuY3R4LmxpbmVUbygyMjQsMTIpOyB0aGlzLmN0eC5saW5lVG8oMjMwLDYpOw0KICAgICAgICB0aGlzLmN0eC5saW5lVG8oMjMwLDI2KTsgdGhpcy5jdHgubGluZVRvKDIyNCwyMCk7IHRoaXMuY3R4LmxpbmVUbygyMjAsMjApOw0KICAgICAgICB0aGlzLmN0eC5maWxsKCk7DQogICAgICAgIHRoaXMuY3R4LnN0cm9rZSgpOw0KICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZT0iI2ZmZiI7DQogICAgICAgIHRoaXMuY3R4LmxpbmVXaWR0aD0yOw0KICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgdGhpcy5jdHguYXJjKDIzMCwxNiw0LC0xLDEsZmFsc2UpOw0KICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTsNCiAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7DQogICAgICAgIHRoaXMuY3R4LmFyYygyMzAsMTYsOCwtMSwxLGZhbHNlKTsNCiAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7DQogICAgICAgIGlmKHRoaXMubWFzdGVyVm9sPT0wKXsNCiAgICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZT0iIzAwMCI7DQogICAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoPTQ7DQogICAgICAgICAgdGhpcy5jdHguYmVnaW5QYXRoKCk7DQogICAgICAgICAgdGhpcy5jdHgubW92ZVRvKDIyMCw3KTsNCiAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oMjM4LDI1KTsNCiAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTsNCiAgICAgICAgICB0aGlzLmN0eC5zdHJva2VTdHlsZT0iI2ZmZiI7DQogICAgICAgICAgdGhpcy5jdHgubGluZVdpZHRoPTI7DQogICAgICAgICAgdGhpcy5jdHguc3Ryb2tlKCk7DQogICAgICAgIH0NCiAgICAgICAgaWYodGhpcy5zb25nKXsNCiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9IiNmZmYiOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDQsMiwyOCwyOCk7DQogICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoODAsMTUsMTI4LDIpOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxTdHlsZT0iIzAwMCI7DQogICAgICAgICAgaWYodGhpcy5wbGF5aW5nKXsNCiAgICAgICAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KDEyLDEwLDQsMTIpOw0KICAgICAgICAgICAgdGhpcy5jdHguZmlsbFJlY3QoMjIsMTAsNCwxMik7DQogICAgICAgICAgfQ0KICAgICAgICAgIGVsc2V7DQogICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICAgIHRoaXMuY3R4Lm1vdmVUbygxMiw5KTsNCiAgICAgICAgICAgIHRoaXMuY3R4LmxpbmVUbygyNSwxNik7DQogICAgICAgICAgICB0aGlzLmN0eC5saW5lVG8oMTIsMjMpOw0KICAgICAgICAgICAgdGhpcy5jdHguZmlsbCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9IiNmZmYiDQogICAgICAgICAgdGhpcy5jdHguZmlsbFRleHQodGhpcy50b1RpbWUodGhpcy5wbGF5VGljayksMzgsMTQpOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxUZXh0KHRoaXMudG9UaW1lKHRoaXMubWF4VGljayksMzgsMjgpOw0KICAgICAgICAgIHRoaXMuY3R4LnN0cm9rZVN0eWxlPSIjMDAwIjsNCiAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTsNCiAgICAgICAgICB0aGlzLmN0eC5hcmMoODArdGhpcy5wbGF5VGljay90aGlzLm1heFRpY2sqMTI4LDE2LDYsMCw2LjI4LDApOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGwoKTsNCiAgICAgICAgICB0aGlzLmN0eC5zdHJva2UoKTsNCiAgICAgICAgfQ0KICAgICAgICBpZih0aGlzLndhaXRkcm9wKXsNCiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9InJnYmEoMCwwLDAsMC43KSINCiAgICAgICAgICB0aGlzLmN0eC5maWxsUmVjdCgwLDAsMzAwLDMyKTsNCiAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGU9IiNmZmYiOw0KICAgICAgICAgIHRoaXMuY3R4LmZpbGxUZXh0KCJEcm9wIE1JREkgRmlsZSBIZXJlIiwxMDAsMjApOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICB0b1RpbWU6KHRpKT0+ew0KICAgICAgdGk9KHRpKjQqNjAvdGhpcy5zb25nLnRpbWViYXNlL3RoaXMuc29uZy50ZW1wbyl8MDsNCiAgICAgIGNvbnN0IG09KHRpLzYwKXwwOw0KICAgICAgY29uc3Qgcz10aSU2MDsNCiAgICAgIHJldHVybiAoIjAwIittKS5zdWJzdHIoLTIpKyI6IisoIjAwIitzKS5zdWJzdHIoLTIpOw0KICAgIH0sDQogICAgcHJldmVudFNjcm9sbDooZSk9PnsNCiAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICB9LA0KICAgIHBvaW50ZXJ1cDooZXYpPT57DQogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLHRoaXMucHJldmVudFNjcm9sbCxmYWxzZSk7DQogICAgfSwNCiAgICBnZXRQb3M6KGUpPT57DQogICAgICB2YXIgcD1lLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgIGlmKHAucmlnaHQhPXAubGVmdCkNCiAgICAgICAgcmV0dXJuIHt4OihlLmNsaWVudFgtcC5sZWZ0KSozMDAvKHAucmlnaHQtcC5sZWZ0KSx5OmUuY2xpZW50WS1wLnRvcH07DQogICAgICByZXR1cm4ge3g6MCx5OjB9Ow0KICAgIH0sDQogICAgcG9pbnRlcmRvd246KGV2KT0+ew0KICAgICAgbGV0IGU9ZXY7DQogICAgICBpZihldi50b3VjaGVzKQ0KICAgICAgICBlPWV2LnRvdWNoZXNbMF07DQogICAgICB0aGlzLmRvd25wb3M9dGhpcy5nZXRQb3MoZSk7DQogICAgICBpZihldi50b3VjaGVzIHx8IChlLmJ1dHRvbnMmMSkpew0KICAgICAgICBpZih0aGlzLnNvbmcmJnRoaXMuZG93bnBvcy54Pj04MCYmdGhpcy5kb3ducG9zLng8PTIwOCl7DQogICAgICAgICAgY29uc3QgcD0odGhpcy5kb3ducG9zLngtODApLzEyOCp0aGlzLm1heFRpY2s7DQogICAgICAgICAgdGhpcy5sb2NhdGVNSURJKHApOw0KICAgICAgICAgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsdGhpcy5wcmV2ZW50U2Nyb2xsLGZhbHNlKTsNCiAgICAgICAgfQ0KICAgICAgICBpZih0aGlzLmRvd25wb3MueD49MjUwJiZ0aGlzLmRvd25wb3MueDwyODIpew0KICAgICAgICAgIGNvbnN0IHA9KHRoaXMuZG93bnBvcy54LTI1MCkvMzI7DQogICAgICAgICAgdGhpcy5zZXRNYXN0ZXJWb2wocCk7DQogICAgICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jyx0aGlzLnByZXZlbnRTY3JvbGwsZmFsc2UpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBwb2ludGVybW92ZTooZXYpPT57DQogICAgICBsZXQgZT1ldjsNCiAgICAgIGlmKGV2LnRvdWNoZXMpDQogICAgICAgIGU9ZXYudG91Y2hlc1swXTsNCiAgICAgIGlmKGV2LnRvdWNoZXMgfHwgKGUuYnV0dG9ucyYxKSl7DQogICAgICAgIGNvbnN0IHBvcz10aGlzLmdldFBvcyhlKTsNCiAgICAgICAgaWYodGhpcy5zb25nJiZwb3MueD49NzAmJnBvcy54PD0yMDgpew0KICAgICAgICAgIGlmKHBvcy54PDgwKSBwb3MueD04MDsNCiAgICAgICAgICBjb25zdCBwPShwb3MueC04MCkvMTI4KnRoaXMubWF4VGljazsNCiAgICAgICAgICB0aGlzLmxvY2F0ZU1JREkocCk7DQogICAgICAgIH0NCiAgICAgICAgaWYocG9zLng+PTI1MCYmcG9zLng8MjgyKXsNCiAgICAgICAgICBjb25zdCBwPShwb3MueC0yNTApLzMyOw0KICAgICAgICAgIHRoaXMuc2V0TWFzdGVyVm9sKHApOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBjbGljazooZSk9PnsNCiAgICAgIGNvbnN0IHBvcz10aGlzLmdldFBvcyhlKTsNCiAgICAgIGlmKHBvcy54PDQwICYmIHRoaXMuc29uZyl7DQogICAgICAgIGlmKHRoaXMucGxheWluZykNCiAgICAgICAgICB0aGlzLnN0b3BNSURJKCk7DQogICAgICAgIGVsc2UgaWYodGhpcy5zb25nKQ0KICAgICAgICAgIHRoaXMucGxheU1JREkoKTsNCiAgICAgIH0NCiAgICAgIGlmKHBvcy54Pj0yMTUmJnBvcy54PDI0MyAmJiB0aGlzLmRvd25wb3MueD49MjE1ICYmIHRoaXMuZG93bnBvcy54PDI0Myl7DQogICAgICAgIGlmKHRoaXMubWFzdGVyVm9sPjApew0KICAgICAgICAgIHRoaXMubGFzdE1hc3RlclZvbD10aGlzLm1hc3RlclZvbDsNCiAgICAgICAgICB0aGlzLm1hc3RlclZvbD0wOw0KICAgICAgICB9DQogICAgICAgIGVsc2UNCiAgICAgICAgICB0aGlzLm1hc3RlclZvbD10aGlzLmxhc3RNYXN0ZXJWb2w7DQogICAgICB9DQogICAgfSwNCiAgICBkcmFnTGVhdmU6KGUpPT57DQogICAgICB0aGlzLndhaXRkcm9wPTA7DQogICAgfSwNCiAgICBkcmFnT3ZlcjooZSk9PnsNCiAgICAgIHRoaXMud2FpdGRyb3A9MTsNCiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICBlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gImNvcHkiOw0KICAgIH0sDQogICAgZXhlY0Ryb3A6KGUpPT57DQogICAgICB0aGlzLndhaXRkcm9wPTA7DQogICAgICBjb25zdCBmID0gZS5kYXRhVHJhbnNmZXIuZmlsZXM7DQogICAgICBpZih0aGlzLmRpc2FibGVkcm9wPT0wKXsNCiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgIHJlYWRlci5vbmxvYWQ9ZnVuY3Rpb24oZSl7DQogICAgICAgICAgdGhpcy5sb2FkTUlESShyZWFkZXIucmVzdWx0KTsNCiAgICAgICAgfS5iaW5kKHRoaXMpOw0KICAgICAgICByZWFkZXIucmVhZEFzQXJyYXlCdWZmZXIoZlswXSk7DQogICAgICB9DQogICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOw0KICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOw0KICAgIH0sDQogICAgLypAQGd1aUVORCovDQogICAgcmVhZHk6KCk9PnsNCiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2KT0+ew0KICAgICAgICBjb25zdCB0aW1lcmlkPXNldEludGVydmFsKCgpPT57DQovKg0KICAgICAgICAgIGlmKHRoaXMuZGVidWcpDQogICAgICAgICAgICBjb25zb2xlLmxvZygiSW5pdGlhbGl6ZSBjaGVja2luZy4iKTsNCiovDQogICAgICAgICAgaWYodGhpcy5pc1JlYWR5KXsNCiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZXJpZCk7DQogICAgICAgICAgICBpZih0aGlzLmRlYnVnKQ0KICAgICAgICAgICAgICBjb25zb2xlLmxvZygiSW5pdGlhbGl6ZWQuIik7DQogICAgICAgICAgICByZXNvbHYoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0sMTAwKTsNCiAgICAgIH0pOw0KICAgIH0sDQogICAgaW5pdDooKT0+ew0KICAgICAgdGhpcy5wZz1bXTsgdGhpcy52b2w9W107IHRoaXMuZXg9W107IHRoaXMuYmVuZD1bXTsgdGhpcy5ycG5pZHg9W107IHRoaXMuYnJhbmdlPVtdOw0KICAgICAgdGhpcy5zdXN0YWluPVtdOyB0aGlzLm5vdGV0YWI9W107IHRoaXMucmh5dGhtPVtdOw0KICAgICAgdGhpcy5tYXN0ZXJUdW5pbmdDPTA7IHRoaXMubWFzdGVyVHVuaW5nRj0wOyB0aGlzLnR1bmluZ0M9W107IHRoaXMudHVuaW5nRj1bXTsgdGhpcy5zY2FsZVR1bmluZz1bXTsNCiAgICAgIHRoaXMubWF4VGljaz0wLCB0aGlzLnBsYXlUaWNrPTAsIHRoaXMucGxheWluZz0wOyB0aGlzLnJlbGVhc2VSYXRpbz0zLjU7DQogICAgICBmb3IobGV0IGk9MDtpPDE2OysraSl7DQogICAgICAgIHRoaXMucGdbaV09MDsgdGhpcy52b2xbaV09MyoxMDAqMTAwLygxMjcqMTI3KTsNCiAgICAgICAgdGhpcy5iZW5kW2ldPTA7IHRoaXMuYnJhbmdlW2ldPTB4MTAwOw0KICAgICAgICB0aGlzLnR1bmluZ0NbaV09MDsgdGhpcy50dW5pbmdGW2ldPTA7DQogICAgICAgIHRoaXMuc2NhbGVUdW5pbmdbaV09WzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwXTsNCiAgICAgICAgdGhpcy5yaHl0aG1baV09MDsNCiAgICAgIH0NCiAgICAgIHRoaXMucmh5dGhtWzldPTE7DQogICAgICB0aGlzLnByZXJvbGw9MC4yOw0KICAgICAgdGhpcy5yZWxjbnQ9MDsNCiAgICAgIHNldEludGVydmFsKA0KICAgICAgICBmdW5jdGlvbigpew0KICAgICAgICAgIGlmKCsrdGhpcy5yZWxjbnQ+PTMpew0KICAgICAgICAgICAgdGhpcy5yZWxjbnQ9MDsNCiAgICAgICAgICAgIGZvcihsZXQgaT10aGlzLm5vdGV0YWIubGVuZ3RoLTE7aT49MDstLWkpew0KICAgICAgICAgICAgICB2YXIgbnQ9dGhpcy5ub3RldGFiW2ldOw0KICAgICAgICAgICAgICBpZih0aGlzLmFjdHguY3VycmVudFRpbWU+bnQuZSl7DQogICAgICAgICAgICAgICAgdGhpcy5fcHJ1bmVOb3RlKG50KTsNCiAgICAgICAgICAgICAgICB0aGlzLm5vdGV0YWIuc3BsaWNlKGksMSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8qQEBndWkqLw0KICAgICAgICAgICAgLypAQGd1aUVORCovDQogICAgICAgICAgfQ0KICAgICAgICAgIGlmKHRoaXMucGxheWluZyAmJiB0aGlzLnNvbmcuZXYubGVuZ3RoPjApew0KICAgICAgICAgICAgbGV0IGU9dGhpcy5zb25nLmV2W3RoaXMucGxheUluZGV4XTsNCiAgICAgICAgICAgIHdoaWxlKHRoaXMuYWN0eC5jdXJyZW50VGltZSt0aGlzLnByZXJvbGw+dGhpcy5wbGF5VGltZSl7DQogICAgICAgICAgICAgIGlmKGUubVswXT09MHhmZjUxKXsNCiAgICAgICAgICAgICAgICB0aGlzLnNvbmcudGVtcG89ZS5tWzFdOw0KICAgICAgICAgICAgICAgIHRoaXMudGljazJUaW1lPTQqNjAvdGhpcy5zb25nLnRlbXBvL3RoaXMuc29uZy50aW1lYmFzZTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgdGhpcy5zZW5kKGUubSx0aGlzLnBsYXlUaW1lKTsNCiAgICAgICAgICAgICAgKyt0aGlzLnBsYXlJbmRleDsNCiAgICAgICAgICAgICAgaWYodGhpcy5wbGF5SW5kZXg+PXRoaXMuc29uZy5ldi5sZW5ndGgpew0KICAgICAgICAgICAgICAgIGlmKHRoaXMubG9vcCl7DQogICAgICAgICAgICAgICAgICBlPXRoaXMuc29uZy5ldlt0aGlzLnBsYXlJbmRleD0wXTsNCiAgICAgICAgICAgICAgICAgIHRoaXMucGxheVRpY2s9ZS50Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgICAgdGhpcy5wbGF5VGljaz10aGlzLm1heFRpY2s7DQogICAgICAgICAgICAgICAgICB0aGlzLnBsYXlpbmc9MDsNCiAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBlbHNlew0KICAgICAgICAgICAgICAgIGU9dGhpcy5zb25nLmV2W3RoaXMucGxheUluZGV4XTsNCiAgICAgICAgICAgICAgICB0aGlzLnBsYXlUaW1lKz0oZS50LXRoaXMucGxheVRpY2spKnRoaXMudGljazJUaW1lOw0KICAgICAgICAgICAgICAgIHRoaXMucGxheVRpY2s9ZS50Ow0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9LmJpbmQodGhpcyksNjANCiAgICAgICk7DQogICAgICBpZih0aGlzLmRlYnVnKQ0KICAgICAgICBjb25zb2xlLmxvZygiaW50ZXJuYWxjb250ZXh0OiIrdGhpcy5pbnRlcm5hbGNvbnRleHQpDQogICAgICBpZih0aGlzLmludGVybmFsY29udGV4dCl7DQogICAgICAgIHdpbmRvdy5BdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7DQogICAgICAgIHRoaXMuc2V0QXVkaW9Db250ZXh0KG5ldyBBdWRpb0NvbnRleHQoKSk7DQogICAgICB9DQogICAgICB0aGlzLmlzUmVhZHk9MTsNCiAgICB9LA0KICAgIHNldE1hc3RlclZvbDoodik9PnsNCiAgICAgIGlmKHYhPXVuZGVmaW5lZCkNCiAgICAgICAgdGhpcy5tYXN0ZXJWb2w9djsNCiAgICAgIGlmKHRoaXMub3V0KQ0KICAgICAgICB0aGlzLm91dC5nYWluLnZhbHVlPXRoaXMubWFzdGVyVm9sOw0KICAgIH0sDQogICAgc2V0UmV2ZXJiTGV2Oih2KT0+ew0KICAgICAgaWYodiE9dW5kZWZpbmVkKQ0KICAgICAgICB0aGlzLnJldmVyYkxldj12Ow0KICAgICAgdmFyIHI9cGFyc2VGbG9hdCh0aGlzLnJldmVyYkxldik7DQogICAgICBpZih0aGlzLnJldiYmIWlzTmFOKHIpKQ0KICAgICAgICB0aGlzLnJldi5nYWluLnZhbHVlPXIqODsNCiAgICB9LA0KICAgIHNldExvb3A6KGYpPT57DQogICAgICB0aGlzLmxvb3A9ZjsNCiAgICB9LA0KICAgIHNldFZvaWNlczoodik9PnsNCiAgICAgIHRoaXMudm9pY2VzPXY7DQogICAgfSwNCiAgICBnZXRQbGF5U3RhdHVzOigpPT57DQogICAgICByZXR1cm4ge3BsYXk6dGhpcy5wbGF5aW5nLCBtYXhUaWNrOnRoaXMubWF4VGljaywgY3VyVGljazp0aGlzLnBsYXlUaWNrfTsNCiAgICB9LA0KICAgIGxvY2F0ZU1JREk6KHRpY2spPT57DQogICAgICBsZXQgaSxwPXRoaXMucGxheWluZzsNCiAgICAgIHRoaXMuc3RvcE1JREkoKTsNCiAgICAgIGZvcihpPTA7aTx0aGlzLnNvbmcuZXYubGVuZ3RoICYmIHRpY2s+dGhpcy5zb25nLmV2W2ldLnQ7KytpKXsNCiAgICAgICAgdmFyIG09dGhpcy5zb25nLmV2W2ldOw0KICAgICAgICB2YXIgY2g9bS5tWzBdJjB4ZjsNCiAgICAgICAgc3dpdGNoKG0ubVswXSYweGYwKXsNCiAgICAgICAgY2FzZSAweGIwOg0KICAgICAgICAgIHN3aXRjaChtLm1bMV0pew0KICAgICAgICAgIGNhc2UgMTogIHRoaXMuc2V0TW9kdWxhdGlvbihjaCxtLm1bMl0pOyBicmVhazsNCiAgICAgICAgICBjYXNlIDc6ICB0aGlzLnNldENoVm9sKGNoLG0ubVsyXSk7IGJyZWFrOw0KICAgICAgICAgIGNhc2UgMTA6IHRoaXMuc2V0UGFuKGNoLG0ubVsyXSk7IGJyZWFrOw0KICAgICAgICAgIGNhc2UgMTE6IHRoaXMuc2V0RXhwcmVzc2lvbihjaCxtLm1bMl0pOyBicmVhazsNCiAgICAgICAgICBjYXNlIDY0OiB0aGlzLnNldFN1c3RhaW4oY2gsbS5tWzJdKTsgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDB4YzA6IHRoaXMucGdbbS5tWzBdJjB4MGZdPW0ubVsxXTsgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYobS5tWzBdPT0weGZmNTEpDQogICAgICAgICAgdGhpcy5zb25nLnRlbXBvPW0ubVsxXTsNCiAgICAgIH0NCiAgICAgIGlmKCF0aGlzLnNvbmcuZXZbaV0pew0KICAgICAgICB0aGlzLnBsYXlJbmRleD0wOw0KICAgICAgICB0aGlzLnBsYXlUaWNrPXRoaXMubWF4VGljazsNCiAgICAgIH0NCiAgICAgIGVsc2V7DQogICAgICAgIHRoaXMucGxheUluZGV4PWk7DQogICAgICAgIHRoaXMucGxheVRpY2s9dGhpcy5zb25nLmV2W2ldLnQ7DQogICAgICB9DQogICAgICBpZihwKQ0KICAgICAgICB0aGlzLnBsYXlNSURJKCk7DQogICAgfSwNCiAgICBnZXRUaW1icmVOYW1lOihtLG4pPT57DQogICAgICBpZihtPT0wKQ0KICAgICAgICByZXR1cm4gdGhpcy5wcm9ncmFtW25dLm5hbWU7DQogICAgICBlbHNlDQogICAgICAgIHJldHVybiB0aGlzLmRydW1tYXBbbi0zNV0ubmFtZTsNCiAgICB9LA0KICAgIGxvYWRNSURJZnJvbVNyYzooKT0+ew0KICAgICAgdGhpcy5sb2FkTUlESVVybCh0aGlzLnNyYyk7DQogICAgfSwNCiAgICBsb2FkTUlESVVybDoodXJsKT0+ew0KICAgICAgaWYoIXVybCkNCiAgICAgICAgcmV0dXJuOw0KICAgICAgdmFyIHhocj1uZXcgWE1MSHR0cFJlcXVlc3QoKTsNCiAgICAgIHhoci5vcGVuKCJHRVQiLHVybCx0cnVlKTsNCiAgICAgIHhoci5yZXNwb25zZVR5cGU9ImFycmF5YnVmZmVyIjsNCiAgICAgIHhoci5sb2FkTUlEST10aGlzLmxvYWRNSURJLmJpbmQodGhpcyk7DQogICAgICB4aHIub25sb2FkPWZ1bmN0aW9uKGUpew0KICAgICAgICBpZih0aGlzLnN0YXR1cz09MjAwKXsNCiAgICAgICAgICB0aGlzLmxvYWRNSURJKHRoaXMucmVzcG9uc2UpOw0KICAgICAgICB9DQogICAgICB9Ow0KICAgICAgeGhyLnNlbmQoKTsNCiAgICB9LA0KICAgIHJlc2V0OigpPT57DQogICAgICBmb3IobGV0IGk9MDtpPDE2OysraSl7DQogICAgICAgIHRoaXMuc2V0UHJvZ3JhbShpLDApOw0KICAgICAgICB0aGlzLnNldEJlbmRSYW5nZShpLDB4MTAwKTsNCiAgICAgICAgdGhpcy5zZXRNb2R1bGF0aW9uKGksMCk7DQogICAgICAgIHRoaXMuc2V0Q2hWb2woaSwxMDApOw0KICAgICAgICB0aGlzLnNldFBhbihpLDY0KTsNCiAgICAgICAgdGhpcy5yZXNldEFsbENvbnRyb2xsZXJzKGkpOw0KICAgICAgICB0aGlzLmFsbFNvdW5kT2ZmKGkpOw0KICAgICAgICB0aGlzLnJoeXRobVtpXT0wOw0KICAgICAgICB0aGlzLnR1bmluZ0NbaV09MDsNCiAgICAgICAgdGhpcy50dW5pbmdGW2ldPTA7DQogICAgICB9DQogICAgICB0aGlzLm1hc3RlclR1bmluZ0M9MDsNCiAgICAgIHRoaXMubWFzdGVyVHVuaW5nRj0wOw0KICAgICAgdGhpcy5yaHl0aG1bOV09MTsNCiAgICB9LA0KICAgIHN0b3BNSURJOigpPT57DQogICAgICB0aGlzLnBsYXlpbmc9MDsNCiAgICAgIGZvcih2YXIgaT0wO2k8MTY7KytpKQ0KICAgICAgICB0aGlzLmFsbFNvdW5kT2ZmKGkpOw0KICAgIH0sDQogICAgcGxheU1JREk6KCk9PnsNCiAgICAgIGlmKCF0aGlzLnNvbmcpDQogICAgICAgIHJldHVybjsNCiAgICAgIGNvbnN0IGR1bW15PXRoaXMuYWN0eC5jcmVhdGVPc2NpbGxhdG9yKCk7DQogICAgICBkdW1teS5jb25uZWN0KHRoaXMuYWN0eC5kZXN0aW5hdGlvbik7DQogICAgICBkdW1teS5mcmVxdWVuY3kudmFsdWU9MDsNCiAgICAgIGR1bW15LnN0YXJ0KDApOw0KICAgICAgZHVtbXkuc3RvcCh0aGlzLmFjdHguY3VycmVudFRpbWUrMC4wMDEpOw0KICAgICAgaWYodGhpcy5wbGF5VGljaz49dGhpcy5tYXhUaWNrKQ0KICAgICAgICB0aGlzLnBsYXlUaWNrPTAsdGhpcy5wbGF5SW5kZXg9MDsNCiAgICAgIHRoaXMucGxheVRpbWU9dGhpcy5hY3R4LmN1cnJlbnRUaW1lKy4xOw0KICAgICAgdGhpcy50aWNrMlRpbWU9NCo2MC90aGlzLnNvbmcudGVtcG8vdGhpcy5zb25nLnRpbWViYXNlOw0KICAgICAgdGhpcy5wbGF5aW5nPTE7DQogICAgfSwNCiAgICBsb2FkTUlESTooZGF0YSk9PnsNCiAgICAgIGZ1bmN0aW9uIEdldDIocywgaSkgeyByZXR1cm4gKHNbaV08PDgpICsgc1tpKzFdOyB9DQogICAgICBmdW5jdGlvbiBHZXQzKHMsIGkpIHsgcmV0dXJuIChzW2ldPDwxNikgKyAoc1tpKzFdPDw4KSArIHNbaSsyXTsgfQ0KICAgICAgZnVuY3Rpb24gR2V0NChzLCBpKSB7IHJldHVybiAoc1tpXTw8MjQpICsgKHNbaSsxXTw8MTYpICsgKHNbaSsyXTw8OCkgKyBzW2krM107IH0NCiAgICAgIGZ1bmN0aW9uIEdldFN0cihzLCBpLCBsZW4pIHsNCiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCxzLnNsaWNlKGksaStsZW4pKTsNCiAgICAgIH0NCiAgICAgIGZ1bmN0aW9uIERlbHRhKHMsIGkpIHsNCiAgICAgICAgdmFyIHYsIGQ7DQogICAgICAgIHYgPSAwOw0KICAgICAgICBkYXRhbGVuID0gMTsNCiAgICAgICAgd2hpbGUoKGQgPSBzW2ldKSAmIDB4ODApIHsNCiAgICAgICAgICB2ID0gKHY8PDcpICsgKGQmMHg3Zik7DQogICAgICAgICAgKytkYXRhbGVuOw0KICAgICAgICAgICsraTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gKHY8PDcpK2Q7DQogICAgICB9DQogICAgICBmdW5jdGlvbiBNc2coc29uZyx0aWNrLHMsaSl7DQogICAgICAgIHZhciB2PXNbaV07DQogICAgICAgIGRhdGFsZW49MTsNCiAgICAgICAgaWYoKHYmMHg4MCk9PTApDQogICAgICAgICAgdj1ydW5zdCxkYXRhbGVuPTA7DQogICAgICAgIHJ1bnN0PXY7DQogICAgICAgIHN3aXRjaCh2JjB4ZjApew0KICAgICAgICBjYXNlIDB4YzA6IGNhc2UgMHhkMDoNCiAgICAgICAgICBzb25nLmV2LnB1c2goe3Q6dGljayxtOlt2LHNbaStkYXRhbGVuXV19KTsNCiAgICAgICAgICBkYXRhbGVuKz0xOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDB4ZjA6DQogICAgICAgICAgc3dpdGNoKHYpIHsNCiAgICAgICAgICBjYXNlIDB4ZjA6DQogICAgICAgICAgY2FzZSAweGY3Og0KICAgICAgICAgICAgdmFyIGxlbj1EZWx0YShzLGkrMSk7DQogICAgICAgICAgICBkYXRhc3RhcnQ9MStkYXRhbGVuOw0KICAgICAgICAgICAgdmFyIGV4ZD1BcnJheS5mcm9tKHMuc2xpY2UoaStkYXRhc3RhcnQsaStkYXRhc3RhcnQrbGVuKSk7DQogICAgICAgICAgICBleGQudW5zaGlmdCgweGYwKTsNCiAgICAgICAgICAgIHNvbmcuZXYucHVzaCh7dDp0aWNrLG06ZXhkfSk7DQovKg0KICAgICAgICAgICAgdmFyIHN5c2V4PVtdOw0KICAgICAgICAgICAgZm9yKHZhciBqaj0wO2pqPGxlbjsrK2pqKQ0KICAgICAgICAgICAgICBzeXNleC5wdXNoKHNbaStkYXRhc3RhcnQrampdLnRvU3RyaW5nKDE2KSk7DQogICAgICAgICAgICBpZih0aGlzLmRlYnVnKQ0KICAgICAgICAgICAgICBjb25zb2xlLmxvZyhzeXNleCk7DQoqLw0KICAgICAgICAgICAgZGF0YWxlbis9bGVuKzE7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlIDB4ZmY6DQogICAgICAgICAgICB2YXIgbGVuID0gRGVsdGEocywgaSArIDIpOw0KICAgICAgICAgICAgZGF0YXN0YXJ0ID0gMitkYXRhbGVuOw0KICAgICAgICAgICAgZGF0YWxlbiA9IGxlbitkYXRhbGVuKzI7DQogICAgICAgICAgICBzd2l0Y2goc1tpKzFdKSB7DQogICAgICAgICAgICBjYXNlIDB4MDI6IHNvbmcuY29weXJpZ2h0Kz1HZXRTdHIocywgaSArIGRhdGFzdGFydCwgZGF0YWxlbiAtIDMpOyBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMHgwMTogY2FzZSAweDAzOiBjYXNlIDB4MDQ6IGNhc2UgMHgwOToNCiAgICAgICAgICAgICAgc29uZy50ZXh0PUdldFN0cihzLCBpICsgZGF0YXN0YXJ0LCBkYXRhbGVuIC0gZGF0YXN0YXJ0KTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDB4MmY6DQogICAgICAgICAgICAgIHJldHVybiAxOw0KICAgICAgICAgICAgY2FzZSAweDUxOg0KICAgICAgICAgICAgICB2YXIgdmFsID0gTWF0aC5mbG9vcig2MDAwMDAwMCAvIEdldDMocywgaSArIDMpKTsNCiAgICAgICAgICAgICAgc29uZy5ldi5wdXNoKHt0OnRpY2ssIG06WzB4ZmY1MSwgdmFsXX0pOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIH0NCiAgICAgICAgICBicmVhazsNCiAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICBzb25nLmV2LnB1c2goe3Q6dGljayxtOlt2LHNbaStkYXRhbGVuXSxzW2krZGF0YWxlbisxXV19KTsNCiAgICAgICAgICBkYXRhbGVuKz0yOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiAwOw0KICAgICAgfQ0KICAgICAgdGhpcy5zdG9wTUlESSgpOw0KICAgICAgdmFyIHM9bmV3IFVpbnQ4QXJyYXkoZGF0YSk7DQogICAgICB2YXIgZGF0YWxlbiA9IDAsIGRhdGFzdGFydCA9IDAsIHJ1bnN0ID0gMHg5MDsNCiAgICAgIHZhciBpZHggPSAwOw0KICAgICAgdmFyIGhkID0gcy5zbGljZSgwLCAgNCk7DQogICAgICBpZihoZC50b1N0cmluZygpIT0iNzcsODQsMTA0LDEwMCIpICAvL01UaGQNCiAgICAgICAgcmV0dXJuOw0KICAgICAgdmFyIGxlbiA9IEdldDQocywgNCk7DQogICAgICB2YXIgZm10ID0gR2V0MihzLCA4KTsNCiAgICAgIHZhciBudW10cmsgPSBHZXQyKHMsIDEwKTsNCiAgICAgIHRoaXMubWF4VGljaz0wOw0KICAgICAgdmFyIHRiID0gR2V0MihzLCAxMikqNDsNCiAgICAgIGlkeCA9IChsZW4gKyA4KTsNCiAgICAgIHRoaXMuc29uZz17Y29weXJpZ2h0OiIiLHRleHQ6IiIsdGVtcG86MTIwLHRpbWViYXNlOnRiLGV2OltdfTsNCiAgICAgIGZvcihsZXQgdHI9MDt0cjxudW10cms7Kyt0cil7DQogICAgICAgIGhkPXMuc2xpY2UoaWR4LCBpZHgrNCk7DQogICAgICAgIGxlbj1HZXQ0KHMsIGlkeCs0KTsNCiAgICAgICAgaWYoaGQudG9TdHJpbmcoKT09Ijc3LDg0LDExNCwxMDciKSB7Ly9NVHJrDQogICAgICAgICAgdmFyIHRpY2sgPSAwOw0KICAgICAgICAgIHZhciBqID0gMDsNCiAgICAgICAgICB0aGlzLm5vdGV0YWIubGVuZ3RoID0gMDsNCiAgICAgICAgICBmb3IoOzspIHsNCiAgICAgICAgICAgIHRpY2sgKz0gRGVsdGEocywgaWR4ICsgOCArIGopOw0KICAgICAgICAgICAgaiArPSBkYXRhbGVuOw0KICAgICAgICAgICAgdmFyIGUgPSBNc2codGhpcy5zb25nLCB0aWNrLCBzLCBpZHggKyA4ICsgaik7DQogICAgICAgICAgICBqICs9IGRhdGFsZW47DQogICAgICAgICAgICBpZihlKQ0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYodGljaz50aGlzLm1heFRpY2spDQogICAgICAgICAgICB0aGlzLm1heFRpY2s9dGljazsNCiAgICAgICAgfQ0KICAgICAgICBpZHggKz0gKGxlbis4KTsNCiAgICAgIH0NCiAgICAgIHRoaXMuc29uZy5ldi5zb3J0KGZ1bmN0aW9uKHgseSl7cmV0dXJuIHgudC15LnR9KTsNCiAgICAgIHRoaXMucmVzZXQoKTsNCiAgICAgIHRoaXMubG9jYXRlTUlESSgwKTsNCiAgICB9LA0KICAgIHNldFF1YWxpdHk6KHEpPT57DQogICAgICBpZihxIT11bmRlZmluZWQpDQogICAgICAgIHRoaXMucXVhbGl0eT1xOw0KICAgICAgZm9yKGxldCBpPTA7aTwxMjg7KytpKQ0KICAgICAgICB0aGlzLnNldFRpbWJyZSgwLGksdGhpcy5wcm9ncmFtMFtpXSk7DQogICAgICBmb3IobGV0IGk9MDtpPHRoaXMuZHJ1bW1hcDAubGVuZ3RoOysraSkNCiAgICAgICAgdGhpcy5zZXRUaW1icmUoMSxpKzM1LHRoaXMuZHJ1bW1hcDBbaV0pOw0KICAgICAgaWYodGhpcy5xdWFsaXR5KXsNCiAgICAgICAgZm9yKGxldCBpPTA7aTx0aGlzLnByb2dyYW0xLmxlbmd0aDsrK2kpDQogICAgICAgICAgdGhpcy5zZXRUaW1icmUoMCxpLHRoaXMucHJvZ3JhbTFbaV0pOw0KICAgICAgICBmb3IobGV0IGk9MDtpPHRoaXMuZHJ1bW1hcC5sZW5ndGg7KytpKXsNCiAgICAgICAgICBpZih0aGlzLmRydW1tYXAxW2ldKQ0KICAgICAgICAgICAgdGhpcy5zZXRUaW1icmUoMSxpKzM1LHRoaXMuZHJ1bW1hcDFbaV0pOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBzZXRUaW1icmU6KG0sbixwKT0+ew0KICAgICAgY29uc3QgZGVmcD17ZzowLHc6InNpbmUiLHQ6MSxmOjAsdjowLjUsYTowLGg6MC4wMSxkOjAuMDEsczowLHI6MC4wNSxwOjEscToxLGs6MH07DQogICAgICBmdW5jdGlvbiBmaWxsZGVmKHApew0KICAgICAgICBmb3Iobj0wO248cC5sZW5ndGg7KytuKXsNCiAgICAgICAgICBmb3IobGV0IGsgaW4gZGVmcCl7DQogICAgICAgICAgICBpZighcFtuXS5oYXNPd25Qcm9wZXJ0eShrKSB8fCB0eXBlb2YocFtuXVtrXSk9PSJ1bmRlZmluZWQiKQ0KICAgICAgICAgICAgICBwW25dW2tdPWRlZnBba107DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBwOw0KICAgICAgfQ0KICAgICAgaWYobSAmJiBuPj0zNSAmJiBuPD04MSkNCiAgICAgICAgdGhpcy5kcnVtbWFwW24tMzVdLnA9ZmlsbGRlZihwKTsNCiAgICAgIGlmKG09PTAgJiYgbj49MCAmJiBuPD0xMjcpDQogICAgICAgIHRoaXMucHJvZ3JhbVtuXS5wPWZpbGxkZWYocCk7DQogICAgfSwNCiAgICBfcHJ1bmVOb3RlOihudCk9PnsNCiAgICAgIGZvcihsZXQgaz1udC5vLmxlbmd0aC0xO2s+PTA7LS1rKXsNCiAgICAgICAgaWYobnQub1trXS5mcmVxdWVuY3kpew0KICAgICAgICAgIG50Lm9ba10uZnJlcXVlbmN5LmNhbmNlbFNjaGVkdWxlZFZhbHVlcygwKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlew0KICAgICAgICAgIG50Lm9ba10ucGxheWJhY2tSYXRlLmNhbmNlbFNjaGVkdWxlZFZhbHVlcygwKTsNCiAgICAgICAgfQ0KICAgICAgICBudC5nW2tdLmdhaW4uY2FuY2VsU2NoZWR1bGVkVmFsdWVzKDApOw0KDQogICAgICAgIG50Lm9ba10uc3RvcCgpOw0KICAgICAgICBpZihudC5vW2tdLmRldHVuZSkgew0KICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICB0aGlzLmNobW9kW250LmNoXS5kaXNjb25uZWN0KG50Lm9ba10uZGV0dW5lKTsNCiAgICAgICAgICB9IGNhdGNoIChlKSB7fQ0KICAgICAgICB9DQogICAgICAgIG50Lmdba10uZ2Fpbi52YWx1ZSA9IDA7DQogICAgICB9DQogICAgfSwNCiAgICBfbGltaXRWb2ljZXM6KGNoLG4pPT57DQogICAgICB0aGlzLm5vdGV0YWIuc29ydChmdW5jdGlvbihuMSxuMil7DQogICAgICAgIGlmKG4xLmYhPW4yLmYpIHJldHVybiBuMS5mLW4yLmY7DQogICAgICAgIGlmKG4xLmUhPW4yLmUpIHJldHVybiBuMi5lLW4xLmU7DQogICAgICAgIHJldHVybiBuMi50LW4xLnQ7DQogICAgICB9KTsNCiAgICAgIGZvcihsZXQgaT10aGlzLm5vdGV0YWIubGVuZ3RoLTE7aT49MDstLWkpew0KICAgICAgICB2YXIgbnQ9dGhpcy5ub3RldGFiW2ldOw0KICAgICAgICBpZih0aGlzLmFjdHguY3VycmVudFRpbWU+bnQuZSB8fCBpPj0odGhpcy52b2ljZXMtMSkpew0KICAgICAgICAgIHRoaXMuX3BydW5lTm90ZShudCk7DQogICAgICAgICAgdGhpcy5ub3RldGFiLnNwbGljZShpLDEpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBfbm90ZToodCxjaCxuLHYscCk9PnsNCiAgICAgIGxldCBvdXQsc2MscG47DQogICAgICBjb25zdCBvPVtdLGc9W10sdnA9W10sZnA9W10scj1bXTsNCiAgICAgIGNvbnN0IGY9NDQwKk1hdGgucG93KDIsKG4tNjkgKyB0aGlzLm1hc3RlclR1bmluZ0MgKyB0aGlzLnR1bmluZ0NbY2hdICsgKHRoaXMubWFzdGVyVHVuaW5nRiArIHRoaXMudHVuaW5nRltjaF0vODE5MiArIHRoaXMuc2NhbGVUdW5pbmdbY2hdW24lMTJdKSkvMTIpOw0KICAgICAgdGhpcy5fbGltaXRWb2ljZXMoY2gsbik7DQogICAgICBmb3IobGV0IGk9MDtpPHAubGVuZ3RoOysraSl7DQogICAgICAgIHBuPXBbaV07DQogICAgICAgIGNvbnN0IGR0PXQrcG4uYStwbi5oOw0KICAgICAgICBpZihwbi5nPT0wKQ0KICAgICAgICAgIG91dD10aGlzLmNodm9sW2NoXSwgc2M9dip2LzE2Mzg0LCBmcFtpXT1mKnBuLnQrcG4uZjsNCiAgICAgICAgZWxzZSBpZihwbi5nPjEwKQ0KICAgICAgICAgIG91dD1nW3BuLmctMTFdLmdhaW4sIHNjPTEsIGZwW2ldPWZwW3BuLmctMTFdKnBuLnQrcG4uZjsNCiAgICAgICAgZWxzZSBpZihvW3BuLmctMV0uZnJlcXVlbmN5KQ0KICAgICAgICAgIG91dD1vW3BuLmctMV0uZnJlcXVlbmN5LCBzYz1mcFtwbi5nLTFdLCBmcFtpXT1mcFtwbi5nLTFdKnBuLnQrcG4uZjsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgIG91dD1vW3BuLmctMV0ucGxheWJhY2tSYXRlLCBzYz1mcFtwbi5nLTFdLzQ0MCwgZnBbaV09ZnBbcG4uZy0xXSpwbi50K3BuLmY7DQogICAgICAgIHN3aXRjaChwbi53WzBdKXsNCiAgICAgICAgY2FzZSAibiI6DQogICAgICAgICAgb1tpXT10aGlzLmFjdHguY3JlYXRlQnVmZmVyU291cmNlKCk7DQogICAgICAgICAgb1tpXS5idWZmZXI9dGhpcy5ub2lzZUJ1Zltwbi53XTsNCiAgICAgICAgICBvW2ldLmxvb3A9dHJ1ZTsNCiAgICAgICAgICBvW2ldLnBsYXliYWNrUmF0ZS52YWx1ZT1mcFtpXS80NDA7DQogICAgICAgICAgaWYocG4ucCE9MSkNCiAgICAgICAgICAgIHRoaXMuX3NldFBhcmFtVGFyZ2V0KG9baV0ucGxheWJhY2tSYXRlLGZwW2ldLzQ0MCpwbi5wLHQscG4ucSk7DQogICAgICAgICAgaWYgKG9baV0uZGV0dW5lKSB7DQogICAgICAgICAgICB0aGlzLmNobW9kW2NoXS5jb25uZWN0KG9baV0uZGV0dW5lKTsNCiAgICAgICAgICAgIG9baV0uZGV0dW5lLnZhbHVlPXRoaXMuYmVuZFtjaF07DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIG9baV09dGhpcy5hY3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsNCiAgICAgICAgICBvW2ldLmZyZXF1ZW5jeS52YWx1ZT1mcFtpXTsNCiAgICAgICAgICBpZihwbi5wIT0xKQ0KICAgICAgICAgICAgdGhpcy5fc2V0UGFyYW1UYXJnZXQob1tpXS5mcmVxdWVuY3ksZnBbaV0qcG4ucCx0LHBuLnEpOw0KICAgICAgICAgIGlmKHBuLndbMF09PSJ3IikNCiAgICAgICAgICAgIG9baV0uc2V0UGVyaW9kaWNXYXZlKHRoaXMud2F2ZVtwbi53XSk7DQogICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgb1tpXS50eXBlPXBuLnc7DQogICAgICAgICAgaWYgKG9baV0uZGV0dW5lKSB7DQogICAgICAgICAgICB0aGlzLmNobW9kW2NoXS5jb25uZWN0KG9baV0uZGV0dW5lKTsNCiAgICAgICAgICAgIG9baV0uZGV0dW5lLnZhbHVlPXRoaXMuYmVuZFtjaF07DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIGdbaV09dGhpcy5hY3R4LmNyZWF0ZUdhaW4oKTsNCiAgICAgICAgcltpXT1wbi5yOw0KICAgICAgICBvW2ldLmNvbm5lY3QoZ1tpXSk7IGdbaV0uY29ubmVjdChvdXQpOw0KICAgICAgICB2cFtpXT1zYypwbi52Ow0KICAgICAgICBpZihwbi5rKQ0KICAgICAgICAgIHZwW2ldKj1NYXRoLnBvdygyLChuLTYwKS8xMipwbi5rKTsNCiAgICAgICAgaWYocG4uYSl7DQogICAgICAgICAgZ1tpXS5nYWluLnZhbHVlPTA7DQogICAgICAgICAgZ1tpXS5nYWluLnNldFZhbHVlQXRUaW1lKDAsdCk7DQogICAgICAgICAgZ1tpXS5nYWluLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKHZwW2ldLHQrcG4uYSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZQ0KICAgICAgICAgIGdbaV0uZ2Fpbi5zZXRWYWx1ZUF0VGltZSh2cFtpXSx0KTsNCiAgICAgICAgdGhpcy5fc2V0UGFyYW1UYXJnZXQoZ1tpXS5nYWluLHBuLnMqdnBbaV0sZHQscG4uZCk7DQogICAgICAgIG9baV0uc3RhcnQodCk7DQogICAgICAgIGlmKHRoaXMucmh5dGhtW2NoXSl7DQoNCiAgICAgICAgICBvW2ldLm9uZW5kZWQgPSAoKT0+ew0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgaWYgKG9baV0uZGV0dW5lKSB0aGlzLmNobW9kW2NoXS5kaXNjb25uZWN0KG9baV0uZGV0dW5lKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNhdGNoKGUpe30NCiAgICAgICAgICB9Ow0KICAgICAgICAgIG9baV0uc3RvcCh0K3BbMF0uZCp0aGlzLnJlbGVhc2VSYXRpbyk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmKCF0aGlzLnJoeXRobVtjaF0pDQogICAgICAgIHRoaXMubm90ZXRhYi5wdXNoKHt0OnQsZTo5OTk5OSxjaDpjaCxuOm4sbzpvLGc6Zyx0Mjp0K3BuLmEsdjp2cCxyOnIsZjowfSk7DQogICAgfSwNCiAgICBfc2V0UGFyYW1UYXJnZXQ6KHAsdix0LGQpPT57DQogICAgICBpZihkIT0wKQ0KICAgICAgICBwLnNldFRhcmdldEF0VGltZSh2LHQsZCk7DQogICAgICBlbHNlDQogICAgICAgIHAuc2V0VmFsdWVBdFRpbWUodix0KTsNCiAgICB9LA0KICAgIF9yZWxlYXNlTm90ZToobnQsdCk9PnsNCiAgICAgIGlmKG50LmNoIT05KXsNCiAgICAgICAgZm9yKGxldCBrPW50LmcubGVuZ3RoLTE7az49MDstLWspew0KICAgICAgICAgIG50Lmdba10uZ2Fpbi5jYW5jZWxTY2hlZHVsZWRWYWx1ZXModCk7DQogICAgICAgICAgaWYodD09bnQudDIpDQogICAgICAgICAgICBudC5nW2tdLmdhaW4uc2V0VmFsdWVBdFRpbWUobnQudltrXSx0KTsNCiAgICAgICAgICBlbHNlIGlmKHQ8bnQudDIpDQogICAgICAgICAgICBudC5nW2tdLmdhaW4uc2V0VmFsdWVBdFRpbWUobnQudltrXSoodC1udC50KS8obnQudDItbnQudCksdCk7DQogICAgICAgICAgdGhpcy5fc2V0UGFyYW1UYXJnZXQobnQuZ1trXS5nYWluLDAsdCxudC5yW2tdKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgbnQuZT10K250LnJbMF0qdGhpcy5yZWxlYXNlUmF0aW87DQogICAgICBudC5mPTE7DQogICAgfSwNCiAgICBzZXRNb2R1bGF0aW9uOihjaCx2LHQpPT57DQogICAgICB0aGlzLmNobW9kW2NoXS5nYWluLnNldFZhbHVlQXRUaW1lKHYqMTAwLzEyNyx0aGlzLl90c0NvbnYodCkpOw0KICAgIH0sDQogICAgc2V0Q2hWb2w6KGNoLHYsdCk9PnsNCiAgICAgIHRoaXMudm9sW2NoXT0zKnYqdi8oMTI3KjEyNyk7DQogICAgICB0aGlzLmNodm9sW2NoXS5nYWluLnNldFZhbHVlQXRUaW1lKHRoaXMudm9sW2NoXSp0aGlzLmV4W2NoXSx0aGlzLl90c0NvbnYodCkpOw0KICAgIH0sDQogICAgc2V0UGFuOihjaCx2LHQpPT57DQogICAgICBpZih0aGlzLmNocGFuW2NoXSkNCiAgICAgICAgdGhpcy5jaHBhbltjaF0ucGFuLnNldFZhbHVlQXRUaW1lKCh2LTY0KS82NCx0aGlzLl90c0NvbnYodCkpOw0KICAgIH0sDQogICAgc2V0RXhwcmVzc2lvbjooY2gsdix0KT0+ew0KICAgICAgdGhpcy5leFtjaF09dip2LygxMjcqMTI3KTsNCiAgICAgIHRoaXMuY2h2b2xbY2hdLmdhaW4uc2V0VmFsdWVBdFRpbWUodGhpcy52b2xbY2hdKnRoaXMuZXhbY2hdLHRoaXMuX3RzQ29udih0KSk7DQogICAgfSwNCiAgICBzZXRTdXN0YWluOihjaCx2LHQpPT57DQogICAgICB0aGlzLnN1c3RhaW5bY2hdPXY7DQogICAgICB0PXRoaXMuX3RzQ29udih0KTsNCiAgICAgIGlmKHY8NjQpew0KICAgICAgICBmb3IobGV0IGk9dGhpcy5ub3RldGFiLmxlbmd0aC0xO2k+PTA7LS1pKXsNCiAgICAgICAgICBjb25zdCBudD10aGlzLm5vdGV0YWJbaV07DQogICAgICAgICAgaWYodD49bnQudCAmJiBudC5jaD09Y2ggJiYgbnQuZj09MSkNCiAgICAgICAgICAgIHRoaXMuX3JlbGVhc2VOb3RlKG50LHQpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICBhbGxTb3VuZE9mZjooY2gpPT57DQogICAgICBmb3IobGV0IGk9dGhpcy5ub3RldGFiLmxlbmd0aC0xO2k+PTA7LS1pKXsNCiAgICAgICAgY29uc3QgbnQ9dGhpcy5ub3RldGFiW2ldOw0KICAgICAgICBpZihudC5jaD09Y2gpew0KICAgICAgICAgIHRoaXMuX3BydW5lTm90ZShudCk7DQogICAgICAgICAgdGhpcy5ub3RldGFiLnNwbGljZShpLDEpOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICByZXNldEFsbENvbnRyb2xsZXJzOihjaCk9PnsNCiAgICAgIHRoaXMuYmVuZFtjaF09MDsgdGhpcy5leFtjaF09MS4wOw0KICAgICAgdGhpcy5ycG5pZHhbY2hdPTB4M2ZmZjsgdGhpcy5zdXN0YWluW2NoXT0wOw0KICAgICAgaWYodGhpcy5jaHZvbFtjaF0pew0KICAgICAgICB0aGlzLmNodm9sW2NoXS5nYWluLnZhbHVlPXRoaXMudm9sW2NoXSp0aGlzLmV4W2NoXTsNCiAgICAgICAgdGhpcy5jaG1vZFtjaF0uZ2Fpbi52YWx1ZT0wOw0KICAgICAgfQ0KICAgIH0sDQogICAgc2V0QmVuZFJhbmdlOihjaCx2KT0+ew0KICAgICAgdGhpcy5icmFuZ2VbY2hdPXY7DQogICAgfSwNCiAgICBzZXRQcm9ncmFtOihjaCx2KT0+ew0KICAgICAgaWYodGhpcy5kZWJ1ZykNCiAgICAgICAgY29uc29sZS5sb2coIlBnKCIrY2grIik9Iit2KTsNCiAgICAgIHRoaXMucGdbY2hdPXY7DQogICAgfSwNCiAgICBfdHNDb252Oih0KT0+ew0KICAgICAgaWYodD09dW5kZWZpbmVkfHx0PD0wKXsNCiAgICAgICAgdD0wOw0KICAgICAgICBpZih0aGlzLmFjdHgpDQogICAgICAgICAgdD10aGlzLmFjdHguY3VycmVudFRpbWU7DQogICAgICB9DQogICAgICBlbHNlew0KICAgICAgICBpZih0aGlzLnRzbW9kZSkNCiAgICAgICAgICB0PXQqLjAwMS10aGlzLnRzZGlmZjsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0Ow0KICAgIH0sDQogICAgc2V0QmVuZDooY2gsdix0KT0+ew0KICAgICAgdD10aGlzLl90c0NvbnYodCk7DQogICAgICBjb25zdCBicj10aGlzLmJyYW5nZVtjaF0qMTAwLzEyNzsNCiAgICAgIHRoaXMuYmVuZFtjaF09KHYtODE5MikqYnIvODE5MjsNCiAgICAgIGZvcihsZXQgaT10aGlzLm5vdGV0YWIubGVuZ3RoLTE7aT49MDstLWkpew0KICAgICAgICBjb25zdCBudD10aGlzLm5vdGV0YWJbaV07DQogICAgICAgIGlmKG50LmNoPT1jaCl7DQogICAgICAgICAgZm9yKGxldCBrPW50Lm8ubGVuZ3RoLTE7az49MDstLWspew0KICAgICAgICAgICAgaWYobnQub1trXS5mcmVxdWVuY3kpDQogICAgICAgICAgICAgIGlmIChudC5vW2tdLmRldHVuZSkgbnQub1trXS5kZXR1bmUuc2V0VmFsdWVBdFRpbWUodGhpcy5iZW5kW2NoXSx0KTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIG5vdGVPZmY6KGNoLG4sdCk9PnsNCiAgICAgIGlmKHRoaXMucmh5dGhtW2NoXSkNCiAgICAgICAgcmV0dXJuOw0KICAgICAgdD10aGlzLl90c0NvbnYodCk7DQogICAgICBmb3IobGV0IGk9dGhpcy5ub3RldGFiLmxlbmd0aC0xO2k+PTA7LS1pKXsNCiAgICAgICAgY29uc3QgbnQ9dGhpcy5ub3RldGFiW2ldOw0KICAgICAgICBpZih0Pj1udC50ICYmIG50LmNoPT1jaCAmJiBudC5uPT1uICYmIG50LmY9PTApew0KICAgICAgICAgIG50LmY9MTsNCiAgICAgICAgICBpZih0aGlzLnN1c3RhaW5bY2hdPDY0KQ0KICAgICAgICAgICAgdGhpcy5fcmVsZWFzZU5vdGUobnQsdCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9LA0KICAgIG5vdGVPbjooY2gsbix2LHQpPT57DQogICAgICBpZih2PT0wKXsNCiAgICAgICAgdGhpcy5ub3RlT2ZmKGNoLG4sdCk7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHQ9dGhpcy5fdHNDb252KHQpOw0KICAgICAgaWYodGhpcy5yaHl0aG1bY2hdKXsNCiAgICAgICAgaWYobj49MzUmJm48PTgxKQ0KICAgICAgICAgIHRoaXMuX25vdGUodCxjaCxuLHYsdGhpcy5kcnVtbWFwW24tMzVdLnApOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICB0aGlzLl9ub3RlKHQsY2gsbix2LHRoaXMucHJvZ3JhbVt0aGlzLnBnW2NoXV0ucCk7DQogICAgfSwNCiAgICBzZXRUc01vZGU6KHRzbW9kZSk9PnsNCiAgICAgIHRoaXMudHNtb2RlPXRzbW9kZTsNCiAgICB9LA0KICAgIHNlbmQ6KG1zZyx0KT0+eyAgICAvKiBzZW5kIG1pZGkgbWVzc2FnZSAqLw0KICAgICAgY29uc3QgY2g9bXNnWzBdJjB4ZjsNCiAgICAgIGNvbnN0IGNtZD1tc2dbMF0mfjB4ZjsNCiAgICAgIGlmKGNtZDwweDgwfHxjbWQ+PTB4MTAwKQ0KICAgICAgICByZXR1cm47DQogICAgICBpZih0aGlzLmF1ZGlvQ29udGV4dC5zdGF0ZT09InN1c3BlbmRlZCIpew0KICAgICAgICB0aGlzLmF1ZGlvQ29udGV4dC5yZXN1bWUoKTsNCiAgICAgIH0NCiAgICAgIHN3aXRjaChjbWQpew0KICAgICAgY2FzZSAweGIwOiAgLyogY3RsIGNoYW5nZSAqLw0KICAgICAgICBzd2l0Y2gobXNnWzFdKXsNCiAgICAgICAgY2FzZSAxOiAgdGhpcy5zZXRNb2R1bGF0aW9uKGNoLG1zZ1syXSx0KTsgYnJlYWs7DQogICAgICAgIGNhc2UgNzogIHRoaXMuc2V0Q2hWb2woY2gsbXNnWzJdLHQpOyBicmVhazsNCiAgICAgICAgY2FzZSAxMDogdGhpcy5zZXRQYW4oY2gsbXNnWzJdLHQpOyBicmVhazsNCiAgICAgICAgY2FzZSAxMTogdGhpcy5zZXRFeHByZXNzaW9uKGNoLG1zZ1syXSx0KTsgYnJlYWs7DQogICAgICAgIGNhc2UgNjQ6IHRoaXMuc2V0U3VzdGFpbihjaCxtc2dbMl0sdCk7IGJyZWFrOw0KICAgICAgICBjYXNlIDk4OiAgY2FzZSA5OTogdGhpcy5ycG5pZHhbY2hdPTB4M2ZmZjsgYnJlYWs7IC8qIG5ycG4gbHNiL21zYiAqLw0KICAgICAgICBjYXNlIDEwMDogdGhpcy5ycG5pZHhbY2hdPSh0aGlzLnJwbmlkeFtjaF0mMHgzZjgwKXxtc2dbMl07IGJyZWFrOyAvKiBycG4gbHNiICovDQogICAgICAgIGNhc2UgMTAxOiB0aGlzLnJwbmlkeFtjaF09KHRoaXMucnBuaWR4W2NoXSYweDdmKXwobXNnWzJdPDw3KTsgYnJlYWs7IC8qIHJwbiBtc2IgKi8NCiAgICAgICAgY2FzZSA2OiAgLyogZGF0YSBlbnRyeSBtc2IgKi8NCiAgICAgICAgICBzd2l0Y2ggKHRoaXMucnBuaWR4W2NoXSkgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICB0aGlzLmJyYW5nZVtjaF09KG1zZ1syXTw8NykrKHRoaXMuYnJhbmdlW2NoXSYweDdmKTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgIHRoaXMudHVuaW5nRltjaF09KG1zZ1syXTw8NykrKCh0aGlzLnR1bmluZ0ZbY2hdKzB4MjAwMCkmMHg3ZiktMHgyMDAwOw0KICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIGNhc2UgMjoNCiAgICAgICAgICAgICAgdGhpcy50dW5pbmdDW2NoXT1tc2dbMl0tMHg0MDsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDM4OiAgLyogZGF0YSBlbnRyeSBsc2IgKi8NCiAgICAgICAgICBzd2l0Y2ggKHRoaXMucnBuaWR4W2NoXSkgew0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICB0aGlzLmJyYW5nZVtjaF09KHRoaXMuYnJhbmdlW2NoXSYweDNmODApfG1zZ1syXTsNCiAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgIHRoaXMudHVuaW5nRltjaF09KCgodGhpcy50dW5pbmdGW2NoXSsweDIwMDApJjB4M2Y4MCl8bXNnWzJdKS0weDIwMDA7DQogICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgY2FzZSAyOiBicmVhazsNCiAgICAgICAgICB9DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgMTIwOiAgLyogYWxsIHNvdW5kIG9mZiAqLw0KICAgICAgICBjYXNlIDEyMzogIC8qIGFsbCBub3RlcyBvZmYgKi8NCiAgICAgICAgY2FzZSAxMjQ6IGNhc2UgMTI1OiBjYXNlIDEyNjogY2FzZSAxMjc6IC8qIG9tbmkgb2ZmL29uIG1vbm8vcG9seSAqLw0KICAgICAgICAgIHRoaXMuYWxsU291bmRPZmYoY2gpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlIDEyMTogdGhpcy5yZXNldEFsbENvbnRyb2xsZXJzKGNoKTsgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICBjYXNlIDB4YzA6IHRoaXMuc2V0UHJvZ3JhbShjaCxtc2dbMV0pOyBicmVhazsNCiAgICAgIGNhc2UgMHhlMDogdGhpcy5zZXRCZW5kKGNoLChtc2dbMV0rKG1zZ1syXTw8NykpLHQpOyBicmVhazsNCiAgICAgIGNhc2UgMHg5MDogdGhpcy5ub3RlT24oY2gsbXNnWzFdLG1zZ1syXSx0KTsgYnJlYWs7DQogICAgICBjYXNlIDB4ODA6IHRoaXMubm90ZU9mZihjaCxtc2dbMV0sdCk7IGJyZWFrOw0KICAgICAgY2FzZSAweGYwOg0KICAgICAgICBpZiAobXNnWzBdID09IDB4ZmYpIHsNCiAgICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIH0NCiAgICAgICAgaWYobXNnWzBdIT0yNTQgJiYgdGhpcy5kZWJ1Zyl7DQogICAgICAgICAgdmFyIGRzPVtdOw0KICAgICAgICAgIGZvcihsZXQgaWk9MDtpaTxtc2cubGVuZ3RoOysraWkpDQogICAgICAgICAgICBkcy5wdXNoKG1zZ1tpaV0udG9TdHJpbmcoMTYpKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAobXNnWzBdPT0weGYwKSB7DQogICAgICAgICAgaWYgKG1zZ1sxXT09MHg3ZiAmJiBtc2dbM109PTQpIHsNCiAgICAgICAgICAgIGlmIChtc2dbNF09PTMgJiYgbXNnLmxlbmd0aCA+PSA4KSB7IC8vIE1hc3RlciBGaW5lIFR1bmluZw0KICAgICAgICAgICAgICB0aGlzLm1hc3RlclR1bmluZ0YgPSAobXNnWzZdKjB4ODAgKyBtc2dbNV0gLSA4MTkyKSAvIDgxOTI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobXNnWzRdPT00ICYmIG1zZy5sZW5ndGggPj0gOCkgeyAvLyBNYXN0ZXIgQ29hcnNlIFR1bmluZw0KICAgICAgICAgICAgICB0aGlzLm1hc3RlclR1bmluZ0MgPSBtc2dbNl0tMHg0MDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKG1zZ1sxXT09MHg0MSAmJiBtc2dbM109PTB4NDIgJiYgbXNnWzRdPT0weDEyICYmbXNnWzVdPT0weDQwKSB7IC8vIEdTDQogICAgICAgICAgICBpZiAoKG1zZ1s2XSYweGYwKT09MHgxMCAmJiBtc2cubGVuZ3RoPT0xMSkgew0KICAgICAgICAgICAgICBjb25zdCBjPVs5LDAsMSwyLDMsNCw1LDYsNyw4LDEwLDExLDEyLDEzLDE0LDE1XVttc2dbNl0mMHhmXTsNCiAgICAgICAgICAgICAgaWYgKG1zZ1s3XT09MHgxNSkgew0KICAgICAgICAgICAgICAgIHRoaXMucmh5dGhtW2NdPW1zZ1s4XTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICBlbHNlIGlmIChtc2dbN10gPj0gMHg0MCAmJiBtc2dbN10gPD0gMHg0YikgeyAvLyBTY2FsZSBUdW5pbmcNCiAgICAgICAgICAgICAgICB0aGlzLnNjYWxlVHVuaW5nW2NdW21zZ1s3XS0weDQwXSA9IChtc2dbOF0tMHg0MCkgLyAxMDA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKG1zZ1s2XT09MCkgew0KICAgICAgICAgICAgICBpZiAobXNnWzddPT0wICYmIG1zZy5sZW5ndGg9PTE0KSB7IC8vIE1hc3RlciBUdW5pbmcNCiAgICAgICAgICAgICAgICB0aGlzLm1hc3RlclR1bmluZ0YgPSAobXNnWzhdKjB4MTAwMCArIG1zZ1s5XSoweDEwMCArIG1zZ1sxMF0qMHgxMCArIG1zZ1sxMV0gLSAweDQwMCkgLyAxMDAwOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGVsc2UgaWYgKG1zZ1s3XT09NSAmJiBtc2cubGVuZ3RoPT0xMSkgeyAvLyBNYXN0ZXIgVHJhbnNwb3NlDQogICAgICAgICAgICAgICAgdGhpcy5tYXN0ZXJUdW5pbmdDID0gbXNnWzhdLTB4NDA7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgfSwNCiAgICBfY3JlYXRlV2F2ZToodyk9PnsNCiAgICAgIGNvbnN0IGltYWc9bmV3IEZsb2F0MzJBcnJheSh3Lmxlbmd0aCk7DQogICAgICBjb25zdCByZWFsPW5ldyBGbG9hdDMyQXJyYXkody5sZW5ndGgpOw0KICAgICAgZm9yKGxldCBpPTE7aTx3Lmxlbmd0aDsrK2kpDQogICAgICAgIGltYWdbaV09d1tpXTsNCiAgICAgIHJldHVybiB0aGlzLmFjdHguY3JlYXRlUGVyaW9kaWNXYXZlKHJlYWwsaW1hZyk7DQogICAgfSwNCiAgICBnZXRBdWRpb0NvbnRleHQ6KCk9PnsNCiAgICAgIHJldHVybiB0aGlzLmFjdHg7DQogICAgfSwNCiAgICBzZXRBdWRpb0NvbnRleHQ6KGFjdHgsZGVzdCk9PnsNCiAgICAgIHRoaXMuYXVkaW9Db250ZXh0PXRoaXMuYWN0eD1hY3R4Ow0KICAgICAgdGhpcy5kZXN0PWRlc3Q7DQogICAgICBpZighZGVzdCkNCiAgICAgICAgdGhpcy5kZXN0PWFjdHguZGVzdGluYXRpb247DQogICAgICB0aGlzLnRzZGlmZj1wZXJmb3JtYW5jZS5ub3coKSouMDAxLXRoaXMuYWN0eC5jdXJyZW50VGltZTsNCiAgICAgIGlmKHRoaXMuZGVidWcpDQogICAgICAgIGNvbnNvbGUubG9nKCJUU0RpZmY6Iit0aGlzLnRzZGlmZik7DQogICAgICB0aGlzLm91dD10aGlzLmFjdHguY3JlYXRlR2FpbigpOw0KICAgICAgdGhpcy5jb21wPXRoaXMuYWN0eC5jcmVhdGVEeW5hbWljc0NvbXByZXNzb3IoKTsNCiAgICAgIHZhciBibGVuPXRoaXMuYWN0eC5zYW1wbGVSYXRlKi41fDA7DQogICAgICB0aGlzLmNvbnZCdWY9dGhpcy5hY3R4LmNyZWF0ZUJ1ZmZlcigyLGJsZW4sdGhpcy5hY3R4LnNhbXBsZVJhdGUpOw0KICAgICAgdGhpcy5ub2lzZUJ1Zj17fTsNCiAgICAgIHRoaXMubm9pc2VCdWYubjA9dGhpcy5hY3R4LmNyZWF0ZUJ1ZmZlcigxLGJsZW4sdGhpcy5hY3R4LnNhbXBsZVJhdGUpOw0KICAgICAgdGhpcy5ub2lzZUJ1Zi5uMT10aGlzLmFjdHguY3JlYXRlQnVmZmVyKDEsYmxlbix0aGlzLmFjdHguc2FtcGxlUmF0ZSk7DQogICAgICB2YXIgZDE9dGhpcy5jb252QnVmLmdldENoYW5uZWxEYXRhKDApOw0KICAgICAgdmFyIGQyPXRoaXMuY29udkJ1Zi5nZXRDaGFubmVsRGF0YSgxKTsNCiAgICAgIHZhciBkbj10aGlzLm5vaXNlQnVmLm4wLmdldENoYW5uZWxEYXRhKDApOw0KICAgICAgdmFyIGRyPXRoaXMubm9pc2VCdWYubjEuZ2V0Q2hhbm5lbERhdGEoMCk7DQogICAgICBmb3IobGV0IGk9MDtpPGJsZW47KytpKXsNCiAgICAgICAgaWYoaS9ibGVuPE1hdGgucmFuZG9tKCkpew0KICAgICAgICAgIGQxW2ldPU1hdGguZXhwKC0zKmkvYmxlbikqKE1hdGgucmFuZG9tKCktLjUpKi41Ow0KICAgICAgICAgIGQyW2ldPU1hdGguZXhwKC0zKmkvYmxlbikqKE1hdGgucmFuZG9tKCktLjUpKi41Ow0KICAgICAgICB9DQogICAgICAgIGRuW2ldPU1hdGgucmFuZG9tKCkqMi0xOw0KICAgICAgfQ0KICAgICAgZm9yKGxldCBqaj0wO2pqPDY0Oysramopew0KICAgICAgICBjb25zdCByMT1NYXRoLnJhbmRvbSgpKjEwKzE7DQogICAgICAgIGNvbnN0IHIyPU1hdGgucmFuZG9tKCkqMTArMTsNCiAgICAgICAgZm9yKGxldCBpPTA7aTxibGVuOysraSl7DQogICAgICAgICAgdmFyIGRkPU1hdGguc2luKChpL2JsZW4pKjIqTWF0aC5QSSo0NDAqcjEpKk1hdGguc2luKChpL2JsZW4pKjIqTWF0aC5QSSo0NDAqcjIpOw0KICAgICAgICAgIGRyW2ldKz1kZC84Ow0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZih0aGlzLnVzZVJldmVyYil7DQogICAgICAgIHRoaXMuY29udj10aGlzLmFjdHguY3JlYXRlQ29udm9sdmVyKCk7DQogICAgICAgIHRoaXMuY29udi5idWZmZXI9dGhpcy5jb252QnVmOw0KICAgICAgICB0aGlzLnJldj10aGlzLmFjdHguY3JlYXRlR2FpbigpOw0KICAgICAgICB0aGlzLnJldi5nYWluLnZhbHVlPXRoaXMucmV2ZXJiTGV2Ow0KICAgICAgICB0aGlzLm91dC5jb25uZWN0KHRoaXMuY29udik7DQogICAgICAgIHRoaXMuY29udi5jb25uZWN0KHRoaXMucmV2KTsNCiAgICAgICAgdGhpcy5yZXYuY29ubmVjdCh0aGlzLmNvbXApOw0KICAgICAgfQ0KICAgICAgdGhpcy5zZXRNYXN0ZXJWb2woKTsNCiAgICAgIHRoaXMub3V0LmNvbm5lY3QodGhpcy5jb21wKTsNCiAgICAgIHRoaXMuY29tcC5jb25uZWN0KHRoaXMuZGVzdCk7DQogICAgICB0aGlzLmNodm9sPVtdOyB0aGlzLmNobW9kPVtdOyB0aGlzLmNocGFuPVtdOw0KICAgICAgdGhpcy53YXZlPXsidzk5OTkiOnRoaXMuX2NyZWF0ZVdhdmUoInc5OTk5Iil9Ow0KICAgICAgdGhpcy5sZm89dGhpcy5hY3R4LmNyZWF0ZU9zY2lsbGF0b3IoKTsNCiAgICAgIHRoaXMubGZvLmZyZXF1ZW5jeS52YWx1ZT01Ow0KICAgICAgdGhpcy5sZm8uc3RhcnQoMCk7DQogICAgICBmb3IobGV0IGk9MDtpPDE2OysraSl7DQogICAgICAgIHRoaXMuY2h2b2xbaV09dGhpcy5hY3R4LmNyZWF0ZUdhaW4oKTsNCiAgICAgICAgaWYodGhpcy5hY3R4LmNyZWF0ZVN0ZXJlb1Bhbm5lcil7DQogICAgICAgICAgdGhpcy5jaHBhbltpXT10aGlzLmFjdHguY3JlYXRlU3RlcmVvUGFubmVyKCk7DQogICAgICAgICAgdGhpcy5jaHZvbFtpXS5jb25uZWN0KHRoaXMuY2hwYW5baV0pOw0KICAgICAgICAgIHRoaXMuY2hwYW5baV0uY29ubmVjdCh0aGlzLm91dCk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZXsNCiAgICAgICAgICB0aGlzLmNocGFuW2ldPW51bGw7DQogICAgICAgICAgdGhpcy5jaHZvbFtpXS5jb25uZWN0KHRoaXMub3V0KTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLmNobW9kW2ldPXRoaXMuYWN0eC5jcmVhdGVHYWluKCk7DQogICAgICAgIHRoaXMubGZvLmNvbm5lY3QodGhpcy5jaG1vZFtpXSk7DQogICAgICAgIHRoaXMucGdbaV09MDsNCiAgICAgICAgdGhpcy5yZXNldEFsbENvbnRyb2xsZXJzKGkpOw0KICAgICAgfQ0KICAgICAgdGhpcy5zZXRSZXZlcmJMZXYoKTsNCiAgICAgIHRoaXMucmVzZXQoKTsNCiAgICAgIHRoaXMuc2VuZChbMHg5MCw2MCwxXSk7DQogICAgICB0aGlzLnNlbmQoWzB4OTAsNjAsMF0pOw0KICAgIH0sDQogIH0pOw0KfQ0KaWYod2luZG93ICYmIHdpbmRvdy5jdXN0b21FbGVtZW50cyl7DQogIGNsYXNzIFdlYkF1ZGlvVGlueVN5bnRoRWxlbWVudCBleHRlbmRzIEhUTUxFbGVtZW50IHsNCiAgICBjb25zdHJ1Y3Rvcigpew0KICAgICAgc3VwZXIoKTsNCiAgICB9DQogICAgY29ubmVjdGVkQ2FsbGJhY2soKXsNCiAgICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOw0KICAgICAgZGl2LmlubmVySFRNTD0NCiAgYDxjYW52YXMNCiAgICBpZD0nd2EtY2FudmFzJyB3aWR0aD0nMzAwJyBoZWlnaHQ9JzMyJw0KICAgIHRvdWNoLWFjdGlvbj0nbm9uZScgdGFiaW5kZXg9JzAnDQogICAgc3R5bGU9Jw0KICAgICAgcG9zaXRpb246cmVsYXRpdmU7DQogICAgICBtYXJnaW46MDsNCiAgICAgIGJvcmRlcjpub25lOw0KICAgICAgd2lkdGg6MzAwcHg7DQogICAgICBoZWlnaHQ6MzJweDsNCiAgICAnDQogID48L2NhbnZhcz4NCiAgPGRpdiBpZD0nd2EtbG9nbycNCiAgICBzdHlsZT0nDQogICAgICBkaXNwbGF5Om5vbmU7DQogICAgICBwb3NpdGlvbjphYnNvbHV0ZTsNCiAgICAgIHRvcDo1cHg7DQogICAgICBsZWZ0OjVweDsNCiAgICAgIGNvbG9yOiNmZmY7DQogICAgICBmb250LXNpemU6OHB4Ow0KICAgICAgYmFja2dyb3VuZDpyZ2JhKDAsMCwwLDAuNSk7DQogICAgJw0KICA+VGlueVN5bnRoPC9kaXY+YDsNCg0KICAgICAgdGhpcy5nZXRBdHRyID0gKG4sZGVmKT0+ew0KICAgICAgICBsZXQgdj10aGlzLmdldEF0dHJpYnV0ZShuKTsNCiAgICAgICAgaWYodj09IiJ8fHY9PW51bGwpIHJldHVybiBkZWY7DQogICAgICAgIHN3aXRjaCh0eXBlb2YoZGVmKSl7DQogICAgICAgIGNhc2UgIm51bWJlciI6DQogICAgICAgICAgaWYodj09InRydWUiKSByZXR1cm4gMTsNCiAgICAgICAgICB2PSt2Ow0KICAgICAgICAgIGlmKGlzTmFOKHYpKSByZXR1cm4gMDsNCiAgICAgICAgICByZXR1cm4gdjsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdjsNCiAgICAgIH07DQoNCiAgICAgIHRoaXMuY2FudmFzID0gZGl2LmNoaWxkcmVuWzBdOw0KICAgICAgdGhpcy5hcHBlbmRDaGlsZChkaXYpOw0KICAgICAgV2ViQXVkaW9UaW55U3ludGhDb3JlLmJpbmQodGhpcykodGhpcyk7DQogICAgICBjb25zdCBwbGlzdD10aGlzLnByb3BlcnRpZXM7DQogICAgICBmb3IobGV0IGsgaW4gcGxpc3Qpew0KICAgICAgICBjb25zdCB2ID0gcGxpc3Rba107DQogICAgICAgIGlmKHYub2JzZXJ2ZXIpew0KICAgICAgICAgIHRoaXNbIl8iK2tdID0gdi52YWx1ZTsNCiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgaywgew0KICAgICAgICAgICAgZ2V0OigpPT57cmV0dXJuIHRoaXNbIl8iK2tdfSwNCiAgICAgICAgICAgIHNldDoodmFsKT0+ew0KICAgICAgICAgICAgICB0aGlzWyJfIitrXSA9IHZhbDsNCiAgICAgICAgICAgICAgdGhpc1t2Lm9ic2VydmVyXSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KICAgICAgICB9DQogICAgICAgIGVsc2V7DQogICAgICAgICAgdGhpc1trXT12Ow0KICAgICAgICB9DQogICAgICB9DQogICAgICBmb3IobGV0IGsgaW4gcGxpc3Qpew0KICAgICAgICBjb25zdCB2ID0gcGxpc3Rba107DQogICAgICAgIHRoaXNba10gPSB0aGlzLmdldEF0dHIoayx2LnZhbHVlKTsNCiAgICAgIH0NCiAgICAgIHRoaXMuc2V0UXVhbGl0eSgxKTsNCiAgICAgIHRoaXMuaW5pdCgpOw0KICAgICAgdGhpcy5fZ3VpSW5pdC5iaW5kKHRoaXMpKCk7DQogICAgICBzZXRJbnRlcnZhbCh0aGlzLl9ndWlVcGRhdGUuYmluZCh0aGlzKSwxMDApOw0KICAgIH0NCiAgfQ0KICB3aW5kb3cuY3VzdG9tRWxlbWVudHMuZGVmaW5lKCd3ZWJhdWRpby10aW55c3ludGgnLCBXZWJBdWRpb1RpbnlTeW50aEVsZW1lbnQpOw0KfQ0KDQpjbGFzcyBXZWJBdWRpb1RpbnlTeW50aCB7DQogIGNvbnN0cnVjdG9yKG9wdCl7DQogICAgV2ViQXVkaW9UaW55U3ludGhDb3JlLmJpbmQodGhpcykodGhpcyk7DQogICAgZm9yKGxldCBrIGluIHRoaXMucHJvcGVydGllcyl7DQogICAgICB0aGlzW2tdPXRoaXMucHJvcGVydGllc1trXS52YWx1ZTsNCiAgICB9DQogICAgdGhpcy5zZXRRdWFsaXR5KDEpOw0KICAgIGlmKG9wdCl7DQogICAgICBpZihvcHQudXNlUmV2ZXJiIT11bmRlZmluZWQpDQogICAgICAgIHRoaXMudXNlUmV2ZXJiPW9wdC51c2VSZXZlcmI7DQogICAgICBpZihvcHQucXVhbGl0eSE9dW5kZWZpbmVkKQ0KICAgICAgICB0aGlzLnNldFF1YWxpdHkob3B0LnF1YWxpdHkpOw0KICAgICAgaWYob3B0LnZvaWNlcyE9dW5kZWZpbmVkKQ0KICAgICAgICB0aGlzLnNldFZvaWNlcyhvcHQudm9pY2VzKTsNCiAgICB9DQogICAgdGhpcy5pbml0KCk7DQogIH0NCn0NCg0KaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnKXsNCiAgbW9kdWxlLmV4cG9ydHMgPSBXZWJBdWRpb1RpbnlTeW50aDsNCn0NCmVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKXsNCiAgICBkZWZpbmUoZnVuY3Rpb24oKXsNCiAgICAgIHJldHVybiBXZWJBdWRpb1RpbnlTeW50aDsNCiAgICB9KTsNCn0NCmVsc2V7DQogIHdpbmRvdy5XZWJBdWRpb1RpbnlTeW50aCA9IFdlYkF1ZGlvVGlueVN5bnRoOw0KfQ0KDQp9KSh0aGlzKTs8L3NjcmlwdD4NCjxzY3JpcHQ+DQoNCmZ1bmN0aW9uIGxvYWRNaWRpVXJsKCl7DQogIHN5bnRoLmxvYWRNSURJVXJsKCd3cy5taWQnKTsNCn0NCmZ1bmN0aW9uIGxvYWRNaWRpKGZpbGVzKXsNCiAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogIHJlYWRlci5vbmxvYWQ9KGUpPT57DQogICAgc3ludGgubG9hZE1JREkocmVhZGVyLnJlc3VsdCk7DQogIH0NCiAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGVzWzBdKTsNCn0NCmZ1bmN0aW9uIHBsYXlNaWRpKCl7DQogIHN5bnRoLnBsYXlNSURJKCk7DQp9DQpmdW5jdGlvbiBzdG9wTWlkaSgpew0KICBzeW50aC5zdG9wTUlESSgpOw0KfQ0KZnVuY3Rpb24gU2V0UHJvZ3JhbShwKXsNCiAgc3ludGguc2VuZChbMHhjMCxwXSk7DQp9DQpmdW5jdGlvbiBJbml0KCl7DQogIHN5bnRoPW5ldyBXZWJBdWRpb1RpbnlTeW50aCh7dm9pY2VzOjY0fSk7DQogIGZvcih2YXIgaT0wO2k8MTI4OysraSl7DQogICAgdmFyIG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7DQogICAgby5pbm5lckhUTUw9c3ludGguZ2V0VGltYnJlTmFtZSgwLGkpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwcm9nIikuYXBwZW5kQ2hpbGQobyk7DQogIH0NCiAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXsNCiAgICB2YXIgc3Q9c3ludGguZ2V0UGxheVN0YXR1cygpOw0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdGF0dXMiKS5pbm5lckhUTUw9IlBsYXk6IitzdC5wbGF5KyIgIFBvczoiK3N0LmN1clRpY2srIi8iK3N0Lm1heFRpY2s7DQoJDQoJaWYoc3QuY3VyVGljaz09c3QubWF4VGljayl7DQoJICAgICAgICAgICAgY3VycmVudEluZGV4Kys7DQogICAgICAgICAgICBsb2FkQW5kUGxheShjdXJyZW50SW5kZXgpOw0KCX0NCiAgfSwxMDApOw0KfQ0KZnVuY3Rpb24gVGVzdCgpew0KICB2YXIgbz1zeW50aC5nZXRBdWRpb0NvbnRleHQoKS5jcmVhdGVPc2NpbGxhdG9yKCk7DQogIG8uY29ubmVjdChzeW50aC5nZXRBdWRpb0NvbnRleHQoKS5kZXN0aW5hdGlvbik7DQogIG8uc3RhcnQoMCk7DQogIG8uc3RvcChzeW50aC5nZXRBdWRpb0NvbnRleHQoKS5jdXJyZW50VGltZSsxKTsNCiAgY29uc29sZS5sb2coc3ludGgpDQp9DQoNCndpbmRvdy5vbmxvYWQ9SW5pdDsNCg0KDQpsZXQgcGxheWxpc3QgPSBbXTsNCmxldCBjdXJyZW50SW5kZXggPSAwOw0KDQovLyBGdW5jdGlvbiB0byBoYW5kbGUgdGhlIGluaXRpYWwgbXVsdGlwbGUgZmlsZSB1cGxvYWQNCmZ1bmN0aW9uIGxvYWRNdWx0aXBsZUZpbGVzKGZpbGVzKSB7DQogICAgcGxheWxpc3QgPSBBcnJheS5mcm9tKGZpbGVzKTsNCgljb25zb2xlLmxvZyhwbGF5bGlzdC5sZW5ndGgpOw0KICAgIGN1cnJlbnRJbmRleCA9IDA7DQogICAgaWYgKHBsYXlsaXN0Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgbG9hZEFuZFBsYXkoY3VycmVudEluZGV4KTsNCiAgICB9DQp9DQoNCi8vIEZ1bmN0aW9uIHRvIGxvYWQgYSBzcGVjaWZpYyBmaWxlIGZyb20gdGhlIHBsYXlsaXN0IGFuZCBwbGF5IGl0DQpmdW5jdGlvbiBsb2FkQW5kUGxheShpbmRleCkgew0KICAgIGlmIChpbmRleCA+PSBwbGF5bGlzdC5sZW5ndGgpIHsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cycpLmlubmVyVGV4dCA9ICJGaW5pc2hlZCBQbGF5bGlzdCI7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICBjb25zdCBmaWxlID0gcGxheWxpc3RbaW5kZXhdOw0KICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgcmVhZGVyLm9ubG9hZCA9IChlKSA9PiB7DQogICAgICAgIC8vIExvYWQgdGhlIE1JREkgZGF0YSBpbnRvIHRoZSBzeW50aA0KICAgICAgICBzeW50aC5sb2FkTUlESShlLnRhcmdldC5yZXN1bHQpOw0KICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzJykuaW5uZXJIVE1MID0gIlBsYXlpbmc6ICIgKyBmaWxlLm5hbWU7DQogICAgICAgIA0KICAgICAgICAvLyBTdGFydCBwbGF5YmFjaw0KICAgICAgICBzeW50aC5wbGF5TUlESSgpOw0KDQogICAgICAgIC8vIE9uZS10aW1lIGxpc3RlbmVyIHRvIGp1bXAgdG8gdGhlIG5leHQgZmlsZSB3aGVuIHRoaXMgb25lIGZpbmlzaGVzDQogICAgICAgIC8vIE5vdGU6IENoZWNrIGlmIHlvdXIgc3ludGggY29yZSB0cmlnZ2VycyAnZW5kZWQnIG9uIHRoZSBzeW50aCBvYmplY3QNCiAgICAgICAgc3ludGgub25lbmRlZCA9ICgpID0+IHsNCiAgICAgICAgICAgIGN1cnJlbnRJbmRleCsrOw0KICAgICAgICAgICAgbG9hZEFuZFBsYXkoY3VycmVudEluZGV4KTsNCiAgICAgICAgfTsNCiAgICB9Ow0KICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTsNCn0NCg0KLy8gVXBkYXRlIHlvdXIgcGxheSBidXR0b24gdG8gdXNlIHRoZSBwbGF5bGlzdCBsb2dpYyBpZiBuZWVkZWQNCmZ1bmN0aW9uIHBsYXlNaWRpKCkgew0KICAgIGlmIChwbGF5bGlzdC5sZW5ndGggPiAwKSB7DQogICAgICAgIHN5bnRoLnBsYXlNSURJKCk7DQogICAgfQ0KfQ0KDQpsZXQgbWVkaWFSZWNvcmRlcjsNCmxldCBhdWRpb0NodW5rcyA9IFtdOw0KDQphc3luYyBmdW5jdGlvbiBleHBvcnRQbGF5bGlzdFRvV2F2KCkgew0KICAgIGlmIChwbGF5bGlzdC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgYWxlcnQoIlVwbG9hZCBlZXJzdCB3YXQgTUlESSBiZXN0YW5kZW4hIik7DQogICAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyAxLiBTZXR1cCBkZSBBdWRpbyBEZXN0aW5hdGlvbiBvbSBvcCB0ZSBuZW1lbg0KICAgIGNvbnN0IHN0cmVhbURlc3QgPSBzeW50aC5jdHguY3JlYXRlTWVkaWFTdHJlYW1EZXN0aW5hdGlvbigpOw0KICAgIHN5bnRoLm91dC5jb25uZWN0KHN0cmVhbURlc3QpOyAvLyBWZXJiaW5kIGRlIHN5bnRoLW91dHB1dCBtZXQgZGUgcmVjb3JkZXINCiAgICANCiAgICAvLyBEZSBhdWRpbyBtb2V0IG9vayBub2cgbmFhciBkZSBzcGVha2VycywgYW5kZXJzIGhvb3IgamUgbmlldHMgdGlqZGVucyBvcG5hbWUNCiAgICBzeW50aC5vdXQuY29ubmVjdChzeW50aC5jdHguZGVzdGluYXRpb24pOw0KDQogICAgbWVkaWFSZWNvcmRlciA9IG5ldyBNZWRpYVJlY29yZGVyKHN0cmVhbURlc3Quc3RyZWFtKTsNCiAgICBhdWRpb0NodW5rcyA9IFtdOw0KDQogICAgbWVkaWFSZWNvcmRlci5vbmRhdGFhdmFpbGFibGUgPSAoZXZlbnQpID0+IHsNCiAgICAgICAgaWYgKGV2ZW50LmRhdGEuc2l6ZSA+IDApIGF1ZGlvQ2h1bmtzLnB1c2goZXZlbnQuZGF0YSk7DQogICAgfTsNCg0KICAgIG1lZGlhUmVjb3JkZXIub25zdG9wID0gKCkgPT4gew0KICAgICAgICBjb25zdCBhdWRpb0Jsb2IgPSBuZXcgQmxvYihhdWRpb0NodW5rcywgeyB0eXBlOiAnYXVkaW8vd2F2JyB9KTsNCiAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChhdWRpb0Jsb2IpOw0KICAgICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOw0KICAgICAgICBhLmhyZWYgPSB1cmw7DQogICAgICAgIGEuZG93bmxvYWQgPSAicGxheWxpc3Rfb3BuYW1lLndhdiI7DQogICAgICAgIGEuY2xpY2soKTsNCiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cycpLmlubmVyVGV4dCA9ICJFeHBvcnQgdm9sdG9vaWQhIjsNCiAgICB9Ow0KDQogICAgLy8gMi4gU3RhcnQgZGUgcGxheWxpc3QgdmFuYWYgaGV0IGJlZ2luDQogICAgY3VycmVudEluZGV4ID0gMDsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzJykuaW5uZXJUZXh0ID0gIkFhbiBoZXQgb3BuZW1lbi4uLiAocGxheWxpc3Qgc3BlZWx0IGFmKSI7DQogICAgbWVkaWFSZWNvcmRlci5zdGFydCgpOw0KDQogICAgLy8gT3ZlcnNjaHJpamYgZGUgJ29uZW5kZWQnIHRpamRlbGlqayBvbSB0ZSB3ZXRlbiB3YW5uZWVyIHdlIG1vZXRlbiBzdG9wcGVuDQogICAgY29uc3Qgb3JpZ2luYWxPbkVuZGVkID0gc3ludGgub25lbmRlZDsNCiAgICANCiAgICBmdW5jdGlvbiBwbGF5QW5kUmVjb3JkKGluZGV4KSB7DQogICAgICAgIGlmIChpbmRleCA+PSBwbGF5bGlzdC5sZW5ndGgpIHsNCiAgICAgICAgICAgIG1lZGlhUmVjb3JkZXIuc3RvcCgpOyAvLyBTdG9wIGRlIG9wbmFtZSBhbHMgZGUgbGlqc3Qga2xhYXIgaXMNCiAgICAgICAgICAgIHN5bnRoLm9uZW5kZWQgPSBvcmlnaW5hbE9uRW5kZWQ7IC8vIEhlcnN0ZWwgb3JpZ2luZWxlIGZ1bmN0aWUNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIGNvbnN0IGZpbGUgPSBwbGF5bGlzdFtpbmRleF07DQogICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgIHJlYWRlci5vbmxvYWQgPSAoZSkgPT4gew0KICAgICAgICAgICAgc3ludGgubG9hZE1JREkoZS50YXJnZXQucmVzdWx0KTsNCiAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMnKS5pbm5lclRleHQgPSAiT3BuZW1lbjogIiArIGZpbGUubmFtZTsNCiAgICAgICAgICAgIHN5bnRoLnBsYXlNSURJKCk7DQogICAgICAgICAgICANCiAgICAgICAgICAgIHN5bnRoLm9uZW5kZWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgcGxheUFuZFJlY29yZChpbmRleCArIDEpOw0KICAgICAgICAgICAgfTsNCiAgICAgICAgfTsNCiAgICAgICAgcmVhZGVyLnJlYWRBc0FycmF5QnVmZmVyKGZpbGUpOw0KICAgIH0NCg0KICAgIHBsYXlBbmRSZWNvcmQoMCk7DQp9DQovLyBIZWxwZXIgZnVuY3RpZSBvbSBkZSBXQVYtc3RydWN0dXVyIHRlIGJvdXdlbg0KZnVuY3Rpb24gYXVkaW9CdWZmZXJUb1dhdihidWZmZXIpIHsNCiAgICBjb25zdCBudW1DaGFubmVscyA9IGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzOw0KICAgIGNvbnN0IHNhbXBsZVJhdGUgPSBidWZmZXIuc2FtcGxlUmF0ZTsNCiAgICBjb25zdCBmb3JtYXQgPSAxOyAvLyBQQ00NCiAgICBjb25zdCBiaXREZXB0aCA9IDE2Ow0KICAgIA0KICAgIGNvbnN0IGJ5dGVzUGVyU2FtcGxlID0gYml0RGVwdGggLyA4Ow0KICAgIGNvbnN0IGJsb2NrQWxpZ24gPSBudW1DaGFubmVscyAqIGJ5dGVzUGVyU2FtcGxlOw0KICAgIA0KICAgIGNvbnN0IGRhdGFMZW4gPSBidWZmZXIubGVuZ3RoICogYmxvY2tBbGlnbjsNCiAgICBjb25zdCBidWZmZXJMZW4gPSA0NCArIGRhdGFMZW47DQogICAgY29uc3QgYXJyYXlCdWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoYnVmZmVyTGVuKTsNCiAgICBjb25zdCB2aWV3ID0gbmV3IERhdGFWaWV3KGFycmF5QnVmZmVyKTsNCg0KICAgIC8qIFJJRkYgaWRlbnRpZmllciAqLw0KICAgIHdyaXRlU3RyaW5nKHZpZXcsIDAsICdSSUZGJyk7DQogICAgLyogUklGRiBjaHVuayBsZW5ndGggKi8NCiAgICB2aWV3LnNldFVpbnQzMig0LCAzNiArIGRhdGFMZW4sIHRydWUpOw0KICAgIC8qIFJJRkYgdHlwZSAqLw0KICAgIHdyaXRlU3RyaW5nKHZpZXcsIDgsICdXQVZFJyk7DQogICAgLyogZm9ybWF0IGNodW5rIGlkZW50aWZpZXIgKi8NCiAgICB3cml0ZVN0cmluZyh2aWV3LCAxMiwgJ2ZtdCAnKTsNCiAgICAvKiBmb3JtYXQgY2h1bmsgbGVuZ3RoICovDQogICAgdmlldy5zZXRVaW50MzIoMTYsIDE2LCB0cnVlKTsNCiAgICAvKiBzYW1wbGUgZm9ybWF0IChyYXcpICovDQogICAgdmlldy5zZXRVaW50MTYoMjAsIGZvcm1hdCwgdHJ1ZSk7DQogICAgLyogY2hhbm5lbCBjb3VudCAqLw0KICAgIHZpZXcuc2V0VWludDE2KDIyLCBudW1DaGFubmVscywgdHJ1ZSk7DQogICAgLyogc2FtcGxlIHJhdGUgKi8NCiAgICB2aWV3LnNldFVpbnQzMigyNCwgc2FtcGxlUmF0ZSwgdHJ1ZSk7DQogICAgLyogYnl0ZSByYXRlIChzYW1wbGUgcmF0ZSAqIGJsb2NrIGFsaWduKSAqLw0KICAgIHZpZXcuc2V0VWludDMyKDI4LCBzYW1wbGVSYXRlICogYmxvY2tBbGlnbiwgdHJ1ZSk7DQogICAgLyogYmxvY2sgYWxpZ24gKGNoYW5uZWwgY291bnQgKiBieXRlcyBwZXIgc2FtcGxlKSAqLw0KICAgIHZpZXcuc2V0VWludDE2KDMyLCBibG9ja0FsaWduLCB0cnVlKTsNCiAgICAvKiBiaXRzIHBlciBzYW1wbGUgKi8NCiAgICB2aWV3LnNldFVpbnQxNigzNCwgYml0RGVwdGgsIHRydWUpOw0KICAgIC8qIGRhdGEgY2h1bmsgaWRlbnRpZmllciAqLw0KICAgIHdyaXRlU3RyaW5nKHZpZXcsIDM2LCAnZGF0YScpOw0KICAgIC8qIGRhdGEgY2h1bmsgbGVuZ3RoICovDQogICAgdmlldy5zZXRVaW50MzIoNDAsIGRhdGFMZW4sIHRydWUpOw0KDQogICAgLy8gU2NocmlqZiBkZSBhdWRpbyBzYW1wbGVzDQogICAgbGV0IG9mZnNldCA9IDQ0Ow0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYnVmZmVyLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGZvciAobGV0IGNoYW5uZWwgPSAwOyBjaGFubmVsIDwgbnVtQ2hhbm5lbHM7IGNoYW5uZWwrKykgew0KICAgICAgICAgICAgbGV0IHNhbXBsZSA9IGJ1ZmZlci5nZXRDaGFubmVsRGF0YShjaGFubmVsKVtpXTsNCiAgICAgICAgICAgIHNhbXBsZSA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLCBzYW1wbGUpKTsgLy8gQ2xpcHBpbmcNCiAgICAgICAgICAgIHZpZXcuc2V0SW50MTYob2Zmc2V0LCBzYW1wbGUgPCAwID8gc2FtcGxlICogMHg4MDAwIDogc2FtcGxlICogMHg3RkZGLCB0cnVlKTsNCiAgICAgICAgICAgIG9mZnNldCArPSAyOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIG5ldyBCbG9iKFthcnJheUJ1ZmZlcl0sIHsgdHlwZTogJ2F1ZGlvL3dhdicgfSk7DQp9DQoNCmZ1bmN0aW9uIHdyaXRlU3RyaW5nKHZpZXcsIG9mZnNldCwgc3RyaW5nKSB7DQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHJpbmcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmlldy5zZXRVaW50OChvZmZzZXQgKyBpLCBzdHJpbmcuY2hhckNvZGVBdChpKSk7DQogICAgfQ0KfQ0KPC9zY3JpcHQ+DQo8c3R5bGU+DQovKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICBBTEdFTUVORSBCQVNJUw0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KYm9keSB7DQogICAgbWFyZ2luOiAwOw0KICAgIHBhZGRpbmc6IDA7DQogICAgYmFja2dyb3VuZDogIzAwODA4MDsNCiAgICBmb250LWZhbWlseTogVGFob21hLCBWZXJkYW5hLCBzYW5zLXNlcmlmOw0KICAgIGNvbG9yOiAjZmZmZmZmOw0KCXdpZHRoOjEwMCU7DQoJaGVpZ2h0OjEwMHZoOw0KfQ0KI3N0YXR1c3sNCmNvbG9yOiNmZmY7DQp9DQoNCiN3bXBfYXBwX3dpbmRvdyB7DQogICAgd2lkdGg6IDEwMCU7DQogICAgaGVpZ2h0OiAxMDB2aDsNCiAgICBiYWNrZ3JvdW5kOiAjMmIyYjJiOw0KICAgIGJvcmRlcjogMnB4IHNvbGlkICMwYTBhMGE7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KICAgIGJveC1zaGFkb3c6IDAgMCAyMHB4ICMwMDA7DQp9DQoNCi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgIFRJVEVMQkFMSyAoWFAtc3RpamwpDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQojd21wX3RpdGxlYmFyIHsNCiAgICBoZWlnaHQ6IDI4cHg7DQogICAgYmFja2dyb3VuZDogIzAwMDA4MDsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBhZGRpbmc6IDAgNnB4Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMGEwYTBhOw0KfQ0KDQojd21wX3RpdGxlYmFyX2ljb24gew0KICAgIHdpZHRoOiAyMHB4Ow0KICAgIGhlaWdodDogMjBweDsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmZmZmNTU7DQogICAgbWFyZ2luLXJpZ2h0OiA2cHg7DQogICAgYm9yZGVyLXJhZGl1czogM3B4Ow0KfQ0KDQojd21wX3RpdGxlYmFyX3RleHQgew0KICAgIGZsZXg6IDE7DQogICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgZm9udC1zaXplOiAxM3B4Ow0KICAgIHRleHQtc2hhZG93OiAxcHggMXB4IDFweCAjMDAwOw0KfQ0KDQojd21wX3RpdGxlYmFyX2J1dHRvbnMgYnV0dG9uIHsNCiAgICB3aWR0aDogMjZweDsNCiAgICBoZWlnaHQ6IDIwcHg7DQogICAgbWFyZ2luLWxlZnQ6IDNweDsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjMGEwYTBhOw0KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgjZmVmZWZlLCAjYzhjOGM4KTsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGJvcmRlci1yYWRpdXM6IDJweDsNCn0NCg0KI3dtcF90aXRsZWJhcl9idXR0b25zIGJ1dHRvbjpob3ZlciB7DQogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KCNmZmZmZmYsICNlMGUwZTApOw0KfQ0KDQovKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICBNRU5VQkFMSw0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KI3dtcF9tZW51YmFyIHsNCiAgICBiYWNrZ3JvdW5kOiAjZDRkMGM4Ow0KICAgIGNvbG9yOiAjMDAwOw0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjODA4MDgwOw0KfQ0KDQojd21wX21lbnViYXIgc3BhbiB7DQogICAgbWFyZ2luLXJpZ2h0OiAxNXB4Ow0KICAgIGN1cnNvcjogcG9pbnRlcjsNCn0NCg0KI3dtcF9tZW51YmFyIHNwYW46aG92ZXIgew0KICAgIGJhY2tncm91bmQ6ICNmZmZmZmY7DQogICAgcGFkZGluZzogMnB4IDRweDsNCiAgICBib3JkZXItcmFkaXVzOiAycHg7DQp9DQoNCi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgIFRBQlMNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCiN3bXBfdmlld190YWJzIHsNCiAgICBiYWNrZ3JvdW5kOiAjZDRkMGM4Ow0KICAgIHBhZGRpbmc6IDRweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzgwODA4MDsNCn0NCg0KI3dtcF92aWV3X3RhYnMgYnV0dG9uIHsNCiAgICBtYXJnaW4tcmlnaHQ6IDRweDsNCiAgICBwYWRkaW5nOiA0cHggMTBweDsNCiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoI2ZmZmZmZiwgI2U1ZTVlNSk7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzgwODA4MDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGJvcmRlci1yYWRpdXM6IDJweDsNCn0NCg0KI3dtcF92aWV3X3RhYnMgYnV0dG9uOmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoI2ZmZmZmZiwgI2ZlZmVmZSk7DQp9DQoNCi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCiAgIEhPT0ZER0VCSUVEIChsaW5rcyArIHJlY2h0cykNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCiN3bXBfbWFpbl9hcmVhIHsNCiAgICBmbGV4OiAxOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYmFja2dyb3VuZDogIzFiMWIxYjsNCn0NCg0KLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgTElOS0VSUEFORUVMDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQojd21wX2xlZnRfcGFuZWwgew0KICAgIHdpZHRoOiAyMjBweDsNCiAgICBiYWNrZ3JvdW5kOiAjMmYyZjJmOw0KICAgIGJvcmRlci1yaWdodDogMnB4IHNvbGlkICMwMDA7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KfQ0KDQojd21wX2xlZnRfbm93X3BsYXlpbmdfaW5mbyB7DQogICAgcGFkZGluZzogMTBweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzQ0NDsNCn0NCg0KI3dtcF9sb2dvX2FyZWEgew0KICAgIGhlaWdodDogNjBweDsNCiAgICBiYWNrZ3JvdW5kOiAjNDQ0Ow0KICAgIG1hcmdpbi1ib3R0b206IDEwcHg7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0KDQojd21wX2xpYnJhcnlfbmF2aWdhdGlvbiB7DQogICAgcGFkZGluZzogMTBweDsNCiAgICBmb250LXNpemU6IDEycHg7DQp9DQoNCiN3bXBfbGlicmFyeV9uYXZpZ2F0aW9uIGRpdiB7DQogICAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICBjb2xvcjogI2RkZDsNCn0NCg0KI3dtcF9saWJyYXJ5X25hdmlnYXRpb24gdWwgew0KICAgIGxpc3Qtc3R5bGU6IG5vbmU7DQogICAgcGFkZGluZy1sZWZ0OiAxMHB4Ow0KfQ0KDQojd21wX2xpYnJhcnlfbmF2aWdhdGlvbiBsaSB7DQogICAgbWFyZ2luOiA0cHggMDsNCiAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgY29sb3I6ICNjY2M7DQp9DQoNCiN3bXBfbGlicmFyeV9uYXZpZ2F0aW9uIGxpOmhvdmVyIHsNCiAgICBjb2xvcjogI2ZmZjsNCiAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsNCn0NCg0KLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgUkVDSFRFUlBBTkVFTA0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KI3dtcF9yaWdodF9wYW5lbCB7DQogICAgZmxleDogMTsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgYmFja2dyb3VuZDogIzFhMWExYTsNCn0NCg0KLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgQ09OVEVOVCBIRUFERVINCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCiN3bXBfY29udGVudF9oZWFkZXIgew0KICAgIHBhZGRpbmc6IDhweDsNCiAgICBiYWNrZ3JvdW5kOiAjMzAzMDMwOw0KICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjMDAwOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCiN3bXBfY29udGVudF90aXRsZSB7DQogICAgZm9udC1zaXplOiAxNHB4Ow0KICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KfQ0KDQojd21wX2NvbnRlbnRfc2VhcmNoX2FyZWEgaW5wdXQgew0KICAgIGJhY2tncm91bmQ6ICMyMjI7DQogICAgYm9yZGVyOiAxcHggc29saWQgIzU1NTsNCiAgICBjb2xvcjogd2hpdGU7DQogICAgcGFkZGluZzogMnB4IDRweDsNCn0NCg0KLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgVFJBQ0tMSVNUDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQojd21wX3RyYWNrbGlzdF9hcmVhIHsNCiAgICBmbGV4OiAxOw0KICAgIG92ZXJmbG93LXk6IGF1dG87DQp9DQoNCiN3bXBfdHJhY2tsaXN0X2hlYWRlcl9yb3cgew0KICAgIGRpc3BsYXk6IGdyaWQ7DQogICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAyZnIgMWZyIDFmciAxZnIgMWZyOw0KICAgIGJhY2tncm91bmQ6ICMzYTNhM2E7DQogICAgcGFkZGluZzogNnB4Ow0KICAgIGZvbnQtc2l6ZTogMTJweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzAwMDsNCiAgICBjb2xvcjogI2RkZDsNCn0NCg0KLndtcF90cmFja19yb3cgew0KICAgIGRpc3BsYXk6IGdyaWQ7DQogICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAyZnIgMWZyIDFmciAxZnIgMWZyOw0KICAgIHBhZGRpbmc6IDZweDsNCiAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgIzMzMzsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgY29sb3I6ICNjY2M7DQp9DQoNCi53bXBfdHJhY2tfcm93OmhvdmVyIHsNCiAgICBiYWNrZ3JvdW5kOiAjMmQyZDJkOw0KICAgIGNvbG9yOiAjZmZmOw0KfQ0KDQovKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICBOT1cgUExBWUlORyBQQU5FTA0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLw0KI3dtcF9ub3dfcGxheWluZ19wYW5lbCB7DQogICAgaGVpZ2h0OiAxNTBweDsNCiAgICBiYWNrZ3JvdW5kOiAjMTExOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjMDAwOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgcGFkZGluZzogMTBweDsNCn0NCg0KI3dtcF9hbGJ1bV9hcnRfYXJlYSB7DQogICAgd2lkdGg6IDEyMHB4Ow0KICAgIGhlaWdodDogMTIwcHg7DQogICAgYmFja2dyb3VuZDogIzMzMzsNCiAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KfQ0KDQojd21wX3Zpc3VhbGl6YXRpb25fYXJlYSB7DQogICAgZmxleDogMTsNCiAgICBiYWNrZ3JvdW5kOiAjMjIyOw0KICAgIG1hcmdpbi1yaWdodDogMTBweDsNCiAgICBib3JkZXItcmFkaXVzOiA0cHg7DQp9DQoNCiN3bXBfbm93X3BsYXlpbmdfdGV4dF9hcmVhIHsNCiAgICB3aWR0aDogMjAwcHg7DQogICAgZm9udC1zaXplOiAxMnB4Ow0KfQ0KDQovKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICBPTkRFUlNURSBDT05UUk9MRVMNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8NCiN3bXBfYm90dG9tX2NvbnRyb2xzX2JhciB7DQogICAgaGVpZ2h0OiA3MHB4Ow0KICAgIGJhY2tncm91bmQ6ICMyYzJjMmM7DQogICAgYm9yZGVyLXRvcDogMnB4IHNvbGlkICMwMDA7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgIHBhZGRpbmc6IDZweDsNCn0NCg0KI3dtcF9wbGF5YmFja19jb250cm9scyBidXR0b24gew0KICAgIG1hcmdpbi1yaWdodDogNnB4Ow0KICAgIHBhZGRpbmc6IDRweCA4cHg7DQogICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KCNmZWZlZmUsICNjOGM4YzgpOw0KICAgIGJvcmRlcjogMXB4IHNvbGlkICM1NTU7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KICAgIGJvcmRlci1yYWRpdXM6IDJweDsNCn0NCg0KI3dtcF9wbGF5YmFja19jb250cm9scyBidXR0b246aG92ZXIgew0KICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgjZmZmZmZmLCAjZTBlMGUwKTsNCn0NCg0KI3dtcF9wcm9ncmVzc19hcmVhIHsNCiAgICBmbGV4OiAxOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICBtYXJnaW46IDAgMjBweDsNCn0NCg0KI3dtcF9wcm9ncmVzc19iYXIgew0KICAgIGZsZXg6IDE7DQogICAgaGVpZ2h0OiA2cHg7DQogICAgYmFja2dyb3VuZDogIzQ0NDsNCiAgICBtYXJnaW46IDAgOHB4Ow0KICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQp9DQoNCiN3bXBfcHJvZ3Jlc3NfZmlsbCB7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiA0MCU7DQogICAgYmFja2dyb3VuZDogIzFlOTBmZjsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQp9DQoNCiN3bXBfcHJvZ3Jlc3NfaGFuZGxlIHsNCiAgICB3aWR0aDogMTBweDsNCiAgICBoZWlnaHQ6IDEwcHg7DQogICAgYmFja2dyb3VuZDogI2ZmZjsNCiAgICBwb3NpdGlvbjogYWJzb2x1dGU7DQogICAgbGVmdDogNDAlOw0KICAgIHRvcDogLTJweDsNCiAgICBib3JkZXItcmFkaXVzOiA1MCU7DQp9DQoNCiN3bXBfdm9sdW1lX2FyZWEgew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg0KI3dtcF92b2x1bWVfYmFyIHsNCiAgICB3aWR0aDogODBweDsNCiAgICBoZWlnaHQ6IDZweDsNCiAgICBiYWNrZ3JvdW5kOiAjNDQ0Ow0KICAgIG1hcmdpbi1sZWZ0OiA2cHg7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGJvcmRlci1yYWRpdXM6IDNweDsNCn0NCg0KI3dtcF92b2x1bWVfZmlsbCB7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIHdpZHRoOiA2MCU7DQogICAgYmFja2dyb3VuZDogIzFlOTBmZjsNCiAgICBib3JkZXItcmFkaXVzOiAzcHg7DQp9DQoNCiN3bXBfdm9sdW1lX2hhbmRsZSB7DQogICAgd2lkdGg6IDEwcHg7DQogICAgaGVpZ2h0OiAxMHB4Ow0KICAgIGJhY2tncm91bmQ6ICNmZmY7DQogICAgcG9zaXRpb246IGFic29sdXRlOw0KICAgIGxlZnQ6IDYwJTsNCiAgICB0b3A6IC0ycHg7DQogICAgYm9yZGVyLXJhZGl1czogNTAlOw0KfQ0KDQovKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQogICBTVEFUVVNCQUxLDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovDQojd21wX3N0YXR1c19iYXIgew0KICAgIGhlaWdodDogMjJweDsNCiAgICBiYWNrZ3JvdW5kOiAjZDRkMGM4Ow0KICAgIGNvbG9yOiAjMDAwOw0KICAgIGZvbnQtc2l6ZTogMTFweDsNCiAgICBkaXNwbGF5OiBmbGV4Ow0KICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgcGFkZGluZzogMCA4cHg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAjODA4MDgwOw0KfQ0KDQo8L3N0eWxlPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+V2luZG93cyBNZWRpYSBQbGF5ZXIgWFAgTGF5b3V0PC90aXRsZT4NCjwvaGVhZD4NCjxib2R5Pg0KDQogICANCg0KPGRpdiBzdHlsZT0nZGlzcGxheTpub25lJz4NCjxoMT53ZWJhdWRpby10aW55c3ludGggOiBqcyB2ZXJzaW9uIHRlc3Q8L2gxPg0KVGhpcyBpcyBhIHNpbXBsZSBzYW1wbGUgb2Ygd2ViYXVkaW8tdGlueXN5bnRoIChKYXZhU2NyaXB0IGxpYnJhcnkgdmVyc2lvbikgcGFnZS4NCjxoci8+DQo8YnV0dG9uIG9uY2xpY2s9IlRlc3QoKSI+VGVzdCBhdWRpb0NvbnRleHQ8L2J1dHRvbj4NCjxoci8+DQpMb2FkIFNhbXBsZSBNSURJIGZyb20gVVJMIDogPGJ1dHRvbiBvbmNsaWNrPSJsb2FkTWlkaVVybCgpIj5Mb2FkICh3cy5taWQpPC9idXR0b24+PGJyLz4NCg0KPGJ1dHRvbiBvbmNsaWNrPSJwbGF5TWlkaSgpIj5QbGF5PC9idXR0b24+DQo8YnV0dG9uIG9uY2xpY2s9InN0b3BNaWRpKCkiPlN0b3A8L2J1dHRvbj4NCjxkaXYgaWQ9InN0YXR1cyI+PC9kaXY+DQo8YnIvPjxici8+DQpMb29wIDogPGlucHV0IHR5cGU9ImNoZWNrYm94IiBvbmNoYW5nZT0ic3ludGguc2V0TG9vcCh0aGlzLmNoZWNrZWQpIi8+PGJyLz4NCk1hc3RlclZvbDxici8+DQo8YnIvPg0KUmV2ZXJiTGV2PGJyLz4NCjxpbnB1dCB0eXBlPSJyYW5nZSIgdmFsdWU9IjUwIiBtaW49IjAiIG1heD0iMTAwIiBvbmlucHV0PSJzeW50aC5zZXRSZXZlcmJMZXYodGhpcy52YWx1ZS8xMDApIi8+PGJyLz4NCg0KPGJyLz48YnIvPg0KUXVhbGl0eSA6IDxzZWxlY3Qgb25jaGFuZ2U9InN5bnRoLnNldFF1YWxpdHkodGhpcy5zZWxlY3RlZEluZGV4KSI+PG9wdGlvbj5RdWFsaXR5PTA8L29wdGlvbj48b3B0aW9uIHNlbGVjdGVkPlF1YWxpdHk9MTwvb3B0aW9uPjwvc2VsZWN0Pg0KPGJyLz4NClRpbWJyZSA6IDxzZWxlY3QgaWQ9InByb2ciIG9uY2hhbmdlPSJTZXRQcm9ncmFtKHRoaXMuc2VsZWN0ZWRJbmRleCkiPjwvc2VsZWN0Pg0KPGJyLz4NCjxici8+DQpQbGF5IGJ5IGtleXMgOjxici8+DQoNCiAgPGJ1dHRvbiBvbm1vdXNlZG93bj0ic3ludGguc2VuZChbMHg5MCw2MCwxMDBdKSIgb25tb3VzZXVwPSJzeW50aC5zZW5kKFsweDgwLDYwLDBdKSI+QzwvYnV0dG9uPg0KICA8YnV0dG9uIG9ubW91c2Vkb3duPSJzeW50aC5zZW5kKFsweDkwLDYyLDEwMF0pIiBvbm1vdXNldXA9InN5bnRoLnNlbmQoWzB4ODAsNjIsMF0pIj5EPC9idXR0b24+DQogIDxidXR0b24gb25tb3VzZWRvd249InN5bnRoLnNlbmQoWzB4OTAsNjQsMTAwXSkiIG9ubW91c2V1cD0ic3ludGguc2VuZChbMHg4MCw2NCwwXSkiPkU8L2J1dHRvbj4NCiAgPGJ1dHRvbiBvbm1vdXNlZG93bj0ic3ludGguc2VuZChbMHg5MCw2NSwxMDBdKSIgb25tb3VzZXVwPSJzeW50aC5zZW5kKFsweDgwLDY1LDBdKSI+RjwvYnV0dG9uPg0KICA8YnV0dG9uIG9ubW91c2Vkb3duPSJzeW50aC5zZW5kKFsweDkwLDY3LDEwMF0pIiBvbm1vdXNldXA9InN5bnRoLnNlbmQoWzB4ODAsNjcsMF0pIj5HPC9idXR0b24+DQogIDxidXR0b24gb25tb3VzZWRvd249InN5bnRoLnNlbmQoWzB4OTAsNjksMTAwXSkiIG9ubW91c2V1cD0ic3ludGguc2VuZChbMHg4MCw2OSwwXSkiPkE8L2J1dHRvbj4NCiAgPGJ1dHRvbiBvbm1vdXNlZG93bj0ic3ludGguc2VuZChbMHg5MCw3MSwxMDBdKSIgb25tb3VzZXVwPSJzeW50aC5zZW5kKFsweDgwLDcxLDBdKSI+QjwvYnV0dG9uPg0KICA8YnV0dG9uIG9ubW91c2Vkb3duPSJzeW50aC5zZW5kKFsweDkwLDcyLDEwMF0pIiBvbm1vdXNldXA9InN5bnRoLnNlbmQoWzB4ODAsNzIsMF0pIj5DPC9idXR0b24+DQogIDxicj4NCiAgPGJ1dHRvbiBvbmNsaWNrPSJleHBvcnRQbGF5bGlzdFRvV2F2KCkiPkRvd25sb2FkIEFsbGVzIGFscyBXQVY8L2J1dHRvbj4NCjwvZGl2Pg0KDQoNCjwvZGl2Pg0KDQoNCg0KIDwhLS0gSG9vZmRjb250YWluZXIgLS0+DQogICAgPGRpdiBpZD0id21wX2FwcF93aW5kb3ciPg0KDQogICAgICAgIDwhLS0gVGl0ZWxiYWxrIGJvdmVuYWFuIChtZXQga25vcHBlbiBzbHVpdGVuL21heC9taW4pIC0tPg0KICAgICAgICA8ZGl2IGlkPSJ3bXBfdGl0bGViYXIiPg0KICAgICAgICAgICAgPGRpdiBpZD0id21wX3RpdGxlYmFyX2ljb24iPldNUC1pY29vbjwvZGl2Pg0KICAgICAgICAgICAgPGRpdiBpZD0id21wX3RpdGxlYmFyX3RleHQiPldpbmRvd3MgTWVkaWEgUGxheWVyPC9kaXY+DQogICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfdGl0bGViYXJfYnV0dG9ucyI+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX2J0bl9taW5pbWl6ZSI+XzwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fbWF4aW1pemUiPlsgXTwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fY2xvc2UiPlg8L2J1dHRvbj4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8IS0tIEJvdmVuc3RlIG1lbnUgKEJlc3RhbmQsIFdlZXJnYXZlLCBBZnNwZWxlbiwgRXh0cmEsIEhlbHApIC0tPg0KICAgICAgICA8ZGl2IGlkPSJ3bXBfbWVudWJhciI+DQogICAgICAgICAgICA8c3BhbiBpZD0id21wX21lbnVfZmlsZSI+QmVzdGFuZDwvc3Bhbj4NCiAgICAgICAgICAgIDxzcGFuIGlkPSJ3bXBfbWVudV92aWV3Ij5CZWVsZDwvc3Bhbj4NCiAgICAgICAgICAgIDxzcGFuIGlkPSJ3bXBfbWVudV9wbGF5YmFjayI+QWZzcGVsZW48L3NwYW4+DQogICAgICAgICAgICA8c3BhbiBpZD0id21wX21lbnVfdG9vbHMiPkV4dHJhPC9zcGFuPg0KICAgICAgICAgICAgPHNwYW4gaWQ9IndtcF9tZW51X2hlbHAiPkhlbHA8L3NwYW4+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gQmFsayBtZXQgdmlldy10YWJzIChOdSBhYW4gaGV0IGFmc3BlbGVuLCBNZWRpZWJpYmxpb3RoZWVrLCBldGMuKSAtLT4NCiAgICAgICAgPGRpdiBpZD0id21wX3ZpZXdfdGFicyI+DQogICAgICAgICAgICA8YnV0dG9uIGlkPSJ3bXBfdGFiX25vd19wbGF5aW5nIiBvbmNsaWNrPSJwcmV2aWV3KCkiPk51IGFhbiBoZXQgYWZzcGVsZW48L2J1dHRvbj4NCg0KICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX3RhYl9yaXAiPkNEIGtvcGnDq3JlbjwvYnV0dG9uPg0KICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX3RhYl9idXJuIj5CcmFuZGVuPC9idXR0b24+DQogICAgICAgICAgICA8YnV0dG9uIGlkPSJ3bXBfdGFiX3N5bmMiPlN5bmNocm9uaXNlcmVuPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KDQogICAgICAgIDwhLS0gSG9vZmQgaW5ob3Vkc2dlYmllZDogbGlua3MgbmF2aWdhdGllLCByZWNodHMgaW5ob3VkIC0tPg0KICAgICAgICA8ZGl2IGlkPSJ3bXBfbWFpbl9hcmVhIj4NCg0KICAgICAgICAgICAgPCEtLSBMaW5rZXIgbmF2aWdhdGllIC8gdGFrZW5wYW5lZWwgLS0+DQogICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfbGVmdF9wYW5lbCI+DQoNCiAgICAgICAgICAgICAgICA8IS0tIExvZ28gLyBOdSBhZnNwZWxlbiBpbmZvIGJvdmVuIGluIGxpbmtlciBwYW5lZWwgLS0+DQogICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX2xlZnRfbm93X3BsYXlpbmdfaW5mbyI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9sb2dvX2FyZWEiPldpbmRvd3MgTWVkaWEgUGxheWVyIExvZ288L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX2N1cnJlbnRfdHJhY2tfaW5mbyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfY3VycmVudF90cmFja190aXRsZSI+VGl0ZWwgaHVpZGlnIG51bW1lcjwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX2N1cnJlbnRfdHJhY2tfYXJ0aXN0Ij5BcnRpZXN0IGh1aWRpZyBudW1tZXI8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9jdXJyZW50X3RyYWNrX2FsYnVtIj5BbGJ1bSBodWlkaWcgbnVtbWVyPC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgICAgICAgPCEtLSBNZWRpZWJpYmxpb3RoZWVrIG5hdmlnYXRpZSAoYWZzcGVlbGxpanN0ZW4sIGFydGllc3RlbiwgYWxidW1zLCBnZW5yZXMpIC0tPg0KICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9saWJyYXJ5X25hdmlnYXRpb24iPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfbmF2X2hlYWRlciI+TG9hZCBNSURJIGZpbGUgZnJvbSBsb2NhbCA6IDxpbnB1dCB0eXBlPSJmaWxlIiBpZD0iZmlsZXMiIGFjY2VwdD0iYXVkaW8vbWlkaSIgbXVsdGlwbGUgb25jaGFuZ2U9ImxvYWRNdWx0aXBsZUZpbGVzKHRoaXMuZmlsZXMpIi8+TWVkaWViaWJsaW90aGVlazwvZGl2Pg0KDQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9uYXZfc2VjdGlvbl9wbGF5bGlzdHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX25hdl9wbGF5bGlzdHNfdGl0bGUiPkFmc3BlZWxsaWpzdGVuPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8dWwgaWQ9IndtcF9uYXZfcGxheWxpc3RzX2xpc3QiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0id21wX25hdl9wbGF5bGlzdF9ub3dfcGxheWluZyI+TnUgYWFuIGhldCBhZnNwZWxlbiBsaWpzdDwvbGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSJ3bXBfbmF2X3BsYXlsaXN0X2F1dG8iPlNsaW1tZSBhZnNwZWVsbGlqc3Q8L2xpPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0id21wX25hdl9wbGF5bGlzdF9jdXN0b20xIj5BZnNwZWVsbGlqc3QgMTwvbGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSJ3bXBfbmF2X3BsYXlsaXN0X2N1c3RvbTIiPkFmc3BlZWxsaWpzdCAyPC9saT4NCiAgICAgICAgICAgICAgICAgICAgICAgIDwvdWw+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9uYXZfc2VjdGlvbl9tdXNpYyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfbmF2X211c2ljX3RpdGxlIj5NdXppZWs8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBpZD0id21wX25hdl9tdXNpY19saXN0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9IndtcF9uYXZfbXVzaWNfYXJ0aXN0Ij5BcnRpZXN0ZW48L2xpPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBpZD0id21wX25hdl9tdXNpY19hbGJ1bSI+QWxidW1zPC9saT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9IndtcF9uYXZfbXVzaWNfZ2VucmUiPkdlbnJlczwvbGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSJ3bXBfbmF2X211c2ljX3llYXIiPkphYXI8L2xpPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX25hdl9zZWN0aW9uX290aGVyX21lZGlhIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9uYXZfb3RoZXJfdGl0bGUiPk92ZXJpZ2UgbWVkaWE8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBpZD0id21wX25hdl9vdGhlcl9saXN0Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9IndtcF9uYXZfdmlkZW8iPlZpZGVvPC9saT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgaWQ9IndtcF9uYXZfcGljdHVyZXMiPkFmYmVlbGRpbmdlbjwvbGk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGlkPSJ3bXBfbmF2X3JlY29yZGVkX3R2Ij5PcGdlbm9tZW4gVFY8L2xpPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC91bD4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgPCEtLSBSZWNodGVyIGhvb2ZkaW5ob3VkICh0cmFja2xpanN0LCB2aXN1YWxpc2F0aWUsIGFsYnVtYXJ0LCBldGMuKSAtLT4NCiAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9yaWdodF9wYW5lbCI+DQoNCiAgICAgICAgICAgICAgICA8IS0tIEJvdmVuc3RlIGluZm8tYmFsayBpbiBob29mZGluaG91ZCAoem9la3ZlbGQsIHNvcnRlcmluZywgd2VlcmdhdmVvcHRpZXMpIC0tPg0KICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9jb250ZW50X2hlYWRlciI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9jb250ZW50X3RpdGxlIj5NZWRpZWJpYmxpb3RoZWVrIOKAkyBNdXppZWs8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX2NvbnRlbnRfY29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX2NvbnRlbnRfc2VhcmNoX2FyZWEiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsYWJlbCBmb3I9IndtcF9jb250ZW50X3NlYXJjaF9pbnB1dCIgaWQ9IndtcF9jb250ZW50X3NlYXJjaF9sYWJlbCI+Wm9la2VuOjwvbGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IGlkPSJ3bXBfY29udGVudF9zZWFyY2hfaW5wdXQiIHR5cGU9InRleHQiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfY29udGVudF92aWV3X29wdGlvbnMiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJ3bXBfdmlld19vcHRpb25fZGV0YWlscyI+RGV0YWlsczwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0id21wX3ZpZXdfb3B0aW9uX2ljb25zIj5QaWN0b2dyYW1tZW48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgICAgICA8IS0tIFRhYmVsIC8gbGlqc3QgbWV0IG51bW1lcnMgKGluIGJpYmxpb3RoZWVrKSAtLT4NCiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfdHJhY2tsaXN0X2FyZWEiPg0KDQogICAgICAgICAgICAgICAgICAgIDwhLS0gS29sb21rb3BwZW46IFRpdGVsLCBMZW5ndGUsIEFydGllc3QsIEFsYnVtLCBXYWFyZGVyaW5nLCBldGMuIC0tPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfdHJhY2tsaXN0X2hlYWRlcl9yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9IndtcF9jb2xfdGl0bGUiPlRpdGVsPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9IndtcF9jb2xfbGVuZ3RoIj5MZW5ndGU8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0id21wX2NvbF9hcnRpc3QiPkFydGllc3Q8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0id21wX2NvbF9hbGJ1bSI+QWxidW08L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBpZD0id21wX2NvbF9yYXRpbmciPldhYXJkZXJpbmc8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgICAgICAgICAgIDwhLS0gVm9vcmJlZWxkcmVnZWxzIG1ldCB0cmFja3MgLS0+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF90cmFja2xpc3RfYm9keSI+DQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ3bXBfdHJhY2tfcm93IiBpZD0id21wX3RyYWNrX3Jvd18xIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0id21wX3RyYWNrX3RpdGxlIiBpZD0id21wX3RyYWNrX3RpdGxlXzEiPk51bW1lciAxPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ3bXBfdHJhY2tfbGVuZ3RoIiBpZD0id21wX3RyYWNrX2xlbmd0aF8xIj4wMzo0NTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0id21wX3RyYWNrX2FydGlzdCIgaWQ9IndtcF90cmFja19hcnRpc3RfMSI+QXJ0aWVzdCAxPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ3bXBfdHJhY2tfYWxidW0iIGlkPSJ3bXBfdHJhY2tfYWxidW1fMSI+QWxidW0gMTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0id21wX3RyYWNrX3JhdGluZyIgaWQ9IndtcF90cmFja19yYXRpbmdfMSI+4piF4piF4piF4piF4piGPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9IndtcF90cmFja19yb3ciIGlkPSJ3bXBfdHJhY2tfcm93XzIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ3bXBfdHJhY2tfdGl0bGUiIGlkPSJ3bXBfdHJhY2tfdGl0bGVfMiI+TnVtbWVyIDI8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IndtcF90cmFja19sZW5ndGgiIGlkPSJ3bXBfdHJhY2tfbGVuZ3RoXzIiPjA0OjEyPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ3bXBfdHJhY2tfYXJ0aXN0IiBpZD0id21wX3RyYWNrX2FydGlzdF8yIj5BcnRpZXN0IDI8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9IndtcF90cmFja19hbGJ1bSIgaWQ9IndtcF90cmFja19hbGJ1bV8yIj5BbGJ1bSAyPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ3bXBfdHJhY2tfcmF0aW5nIiBpZD0id21wX3RyYWNrX3JhdGluZ18yIj7imIXimIXimIXimIbimIY8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgPCEtLSBNZWVyIHdtcF90cmFja19yb3dfWCBlbGVtZW50ZW4gaGllci4uLiAtLT4NCiAgICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgICAgICA8IS0tIE9uZGVyc3RlIHZpc3VhbGlzYXRpZSAvIGFsYnVtIGFydCAvIG51IGFmc3BlbGVuIHNjaGVybSAtLT4NCiAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfbm93X3BsYXlpbmdfcGFuZWwiPg0KDQoNCjwvZGl2Pg0KDQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBPbmRlcnN0ZSBiZWRpZW5pbmdzYmFsayAocGxheS9wYXVzZSwgdGlqZGxpam4sIHZvbHVtZSwgZXRjLikgLS0+DQogICAgICAgIDxkaXYgaWQ9IndtcF9ib3R0b21fY29udHJvbHNfYmFyIj4NCg0KICAgICAgICAgICAgPCEtLSBMaW5rZXIgZGVlbDogbWFpbiBwbGF5YmFjayBjb250cm9scyAtLT4NCiAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9wbGF5YmFja19jb250cm9scyI+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX2J0bl9wcmV2aW91cyI+Vm9yaWdlPC9idXR0b24+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX2J0bl9wbGF5Ij5BZnNwZWxlbjwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fcGF1c2UiPlBhdXplPC9idXR0b24+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX2J0bl9zdG9wIj5TdG9wPC9idXR0b24+DQogICAgICAgICAgICAgICAgPGJ1dHRvbiBpZD0id21wX2J0bl9uZXh0Ij5Wb2xnZW5kZTwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fc2h1ZmZsZSI+U2h1ZmZsZTwvYnV0dG9uPg0KICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fcmVwZWF0Ij5IZXJoYWxlbjwvYnV0dG9uPg0KICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgIDwhLS0gTWlkZGVuOiB2b29ydGdhbmdzYmFsayArIHRpamQgLS0+DQogICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfcHJvZ3Jlc3NfYXJlYSI+DQogICAgICAgICAgICAgICAgPHNwYW4gaWQ9IndtcF9jdXJyZW50X3RpbWUiPjAwOjAwPC9zcGFuPg0KICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9wcm9ncmVzc19iYXIiPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGlkPSJ3bXBfcHJvZ3Jlc3NfZmlsbCI+PC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgaWQ9IndtcF9wcm9ncmVzc19oYW5kbGUiPjwvZGl2Pg0KICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgIDxzcGFuIGlkPSJ3bXBfdG90YWxfdGltZSI+MDM6NDU8L3NwYW4+DQogICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgPCEtLSBSZWNodHM6IHZvbHVtZSBlbiBleHRyYSBrbm9wcGVuIC0tPg0KICAgICAgICAgICAgPGRpdiBpZD0id21wX3JpZ2h0X2JvdHRvbV9hcmVhIj4NCiAgICAgICAgICAgICAgIA0KPGlucHV0IHR5cGU9InJhbmdlIiBpZD0id21wX3ZvbHVtZV9hcmVhIiAgdmFsdWU9IjUwIiBtaW49IjAiIG1heD0iMTAwIiBvbmlucHV0PSJzeW50aC5zZXRNYXN0ZXJWb2wodGhpcy52YWx1ZS8xMDApIi8+DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgPGRpdiBpZD0id21wX21vZGVfYnV0dG9ucyI+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fc2tpbl9tb2RlIj5Ta2luLW1vZHVzPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9IndtcF9idG5fZnVsbHNjcmVlbiI+Vm9sbGVkaWcgc2NoZXJtPC9idXR0b24+DQogICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBTdGF0dXNiYWxrIGhlbGVtYWFsIG9uZGVyYWFuIChzdGF0dXNpbmZvLCBiaXRyYXRlLCBldGMuKSAtLT4NCiAgICAgICAgPGRpdiBpZD0id21wX3N0YXR1c19iYXIiPg0KICAgICAgICAgICAgPHNwYW4gaWQ9IndtcF9zdGF0dXNfdGV4dCI+R2VyZWVkPC9zcGFuPg0KICAgICAgICAgICAgPHNwYW4gaWQ9IndtcF9zdGF0dXNfYml0cmF0ZSI+Qml0cmF0ZTogMTkyIGticHM8L3NwYW4+DQogICAgICAgICAgICA8c3BhbiBpZD0id21wX3N0YXR1c19jb25uZWN0aW9uIj5PZmZsaW5lPC9zcGFuPg0KICAgICAgICA8L2Rpdj4NCg0KICAgIDwvZGl2Pg0KCTwvZGl2Pg0KDQo8c2NyaXB0Pg0KCQkNCmZ1bmN0aW9uIHByZXZpZXcoKSB7DQogICAgLy8gMS4gR2V0IHRoZSBlbGVtZW50IChhc3N1bWluZyBpdCdzIGEgZGl2IG5vdyl4DQogICAgDQogICAgDQogICAgLy8gMi4gVXNlIGlubmVyVGV4dCBpbnN0ZWFkIG9mIHZhbHVlIGZvciBub24tdGV4dGFyZWEgZWxlbWVudHMNCiAgICBjb25zdCBodG1sU291cmNlID0gd2luZG93LmF0b2IoIkRRbzhJVVJQUTFSWlVFVWdhSFJ0YkQ0TkNqeG9kRzFzSUd4aGJtYzlJbVZ1SWo0TkNqeG9aV0ZrUGcwS0lDQWdJRHh0WlhSaElHTm9ZWEp6WlhROUlsVlVSaTA0SWo0TkNpQWdJQ0E4YldWMFlTQnVZVzFsUFNKMmFXVjNjRzl5ZENJZ1kyOXVkR1Z1ZEQwaWQybGtkR2c5WkdWMmFXTmxMWGRwWkhSb0xDQnBibWwwYVdGc0xYTmpZV3hsUFRFdU1DSStEUW9nSUNBZ1BIUnBkR3hsUGxOdFlYSjBJRlJsZUhRZ1UzVnRiV0Z5YVhwbGNqd3ZkR2wwYkdVK0RRb2dJQ0FnUEhOMGVXeGxQZzBLSUNBZ0lDQWdJQ0FxSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJRzFoY21kcGJqb2dNRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIQmhaR1JwYm1jNklEQTdEUW9nSUNBZ0lDQWdJQ0FnSUNCaWIzZ3RjMmw2YVc1bk9pQmliM0prWlhJdFltOTRPdzBLSUNBZ0lDQWdJQ0I5RFFvZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNCaWIyUjVJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHWnZiblF0Wm1GdGFXeDVPaUFuVTJWbmIyVWdWVWtuTENCVVlXaHZiV0VzSUVkbGJtVjJZU3dnVm1WeVpHRnVZU3dnYzJGdWN5MXpaWEpwWmpzTkNpQWdJQ0FnSUNBZ0lDQWdJR0poWTJ0bmNtOTFibVE2SUd4cGJtVmhjaTFuY21Ga2FXVnVkQ2d4TXpWa1pXY3NJQ00yTmpkbFpXRWdNQ1VzSUNNM05qUmlZVElnTVRBd0pTazdEUW9nSUNBZ0lDQWdJQ0FnSUNCdGFXNHRhR1ZwWjJoME9pQXhNREIyYURzTkNpQWdJQ0FnSUNBZ0lDQWdJSEJoWkdScGJtYzZJREl3Y0hnN0RRb2dJQ0FnSUNBZ0lIME5DaUFnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQzVqYjI1MFlXbHVaWElnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdiV0Y0TFhkcFpIUm9PaUF4TWpBd2NIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCdFlYSm5hVzQ2SURBZ1lYVjBienNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHSmhZMnRuY205MWJtUTZJSGRvYVhSbE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWW05eVpHVnlMWEpoWkdsMWN6b2dNakJ3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJR0p2ZUMxemFHRmtiM2M2SURBZ01qQndlQ0EyTUhCNElISm5ZbUVvTUN3d0xEQXNNQzR6S1RzTkNpQWdJQ0FnSUNBZ0lDQWdJRzkyWlhKbWJHOTNPaUJvYVdSa1pXNDdEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUM1b1pXRmtaWElnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdZbUZqYTJkeWIzVnVaRG9nYkdsdVpXRnlMV2R5WVdScFpXNTBLSFJ2SUhKcFoyaDBMQ0FqTkdFMU5HVXhMQ0FqTVRWaFlXSm1LVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHTnZiRzl5T2lCM2FHbDBaVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIQmhaR1JwYm1jNklETXdjSGdnTkRCd2VEc05DaUFnSUNBZ0lDQWdJQ0FnSUhSbGVIUXRZV3hwWjI0NklHTmxiblJsY2pzTkNpQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdMbWhsWVdSbGNpQm9NU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1iMjUwTFhOcGVtVTZJREl1TldWdE93MEtJQ0FnSUNBZ0lDQWdJQ0FnYldGeVoybHVMV0p2ZEhSdmJUb2dNVEJ3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJSFJsZUhRdGMyaGhaRzkzT2lBeWNIZ2dNbkI0SURSd2VDQnlaMkpoS0RBc01Dd3dMREF1TWlrN0RRb2dJQ0FnSUNBZ0lIME5DaUFnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQzVvWldGa1pYSWdjQ0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQnZjR0ZqYVhSNU9pQXdMams3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1iMjUwTFhOcGVtVTZJREV1TVdWdE93MEtJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0F1WTI5dWRHVnVkQ0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQndZV1JrYVc1bk9pQTBNSEI0T3cwS0lDQWdJQ0FnSUNBZ0lDQWdaR2x6Y0d4aGVUb2daM0pwWkRzTkNpQWdJQ0FnSUNBZ0lDQWdJR2R5YVdRdGRHVnRjR3hoZEdVdFkyOXNkVzF1Y3pvZ01XWnlJRE13TUhCNE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWjJGd09pQXpNSEI0T3cwS0lDQWdJQ0FnSUNCOURRb2dJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQkFiV1ZrYVdFZ0tHMWhlQzEzYVdSMGFEb2dPVEF3Y0hncElIc05DaUFnSUNBZ0lDQWdJQ0FnSUM1amIyNTBaVzUwSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCbmNtbGtMWFJsYlhCc1lYUmxMV052YkhWdGJuTTZJREZtY2pzTkNpQWdJQ0FnSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnZlEwS0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0xtMWhhVzR0WVhKbFlTQjdEUW9nSUNBZ0lDQWdJQ0FnSUNCa2FYTndiR0Y1T2lCbWJHVjRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1pteGxlQzFrYVhKbFkzUnBiMjQ2SUdOdmJIVnRianNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHZGhjRG9nTWpCd2VEc05DaUFnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnTG5SbGVIUXRaM0p2ZFhBZ2V3MEtJQ0FnSUNBZ0lDQWdJQ0FnWm14bGVEb2dNVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHUnBjM0JzWVhrNklHWnNaWGc3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1iR1Y0TFdScGNtVmpkR2x2YmpvZ1kyOXNkVzF1T3cwS0lDQWdJQ0FnSUNCOURRb2dJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQXVkR1Y0ZEMxbmNtOTFjQ0JzWVdKbGJDQjdEUW9nSUNBZ0lDQWdJQ0FnSUNCbWIyNTBMWGRsYVdkb2REb2dOakF3T3cwS0lDQWdJQ0FnSUNBZ0lDQWdiV0Z5WjJsdUxXSnZkSFJ2YlRvZ01UQndlRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHTnZiRzl5T2lBak16TXpPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1ptOXVkQzF6YVhwbE9pQXhMakZsYlRzTkNpQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdkR1Y0ZEdGeVpXRWdldzBLSUNBZ0lDQWdJQ0FnSUNBZ2QybGtkR2c2SURFd01DVTdEUW9nSUNBZ0lDQWdJQ0FnSUNCb1pXbG5hSFE2SURNMWRtZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCd1lXUmthVzVuT2lBeU1IQjRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1ltOXlaR1Z5T2lBeWNIZ2djMjlzYVdRZ0kyVXdaVEJsTURzTkNpQWdJQ0FnSUNBZ0lDQWdJR0p2Y21SbGNpMXlZV1JwZFhNNklERXljSGc3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1iMjUwTFhOcGVtVTZJREUyY0hnN0RRb2dJQ0FnSUNBZ0lDQWdJQ0JzYVc1bExXaGxhV2RvZERvZ01TNDJPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2NtVnphWHBsT2lCMlpYSjBhV05oYkRzTkNpQWdJQ0FnSUNBZ0lDQWdJSFJ5WVc1emFYUnBiMjQ2SUdGc2JDQXdMak56SUdWaGMyVTdEUW9nSUNBZ0lDQWdJQ0FnSUNCbWIyNTBMV1poYldsc2VUb2dhVzVvWlhKcGREc05DaUFnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnZEdWNGRHRnlaV0U2Wm05amRYTWdldzBLSUNBZ0lDQWdJQ0FnSUNBZ2IzVjBiR2x1WlRvZ2JtOXVaVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHSnZjbVJsY2kxamIyeHZjam9nSXpSaE5UUmxNVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHSnZlQzF6YUdGa2IzYzZJREFnTUNBd0lETndlQ0J5WjJKaEtEYzBMQ0E0TkN3Z01qSTFMQ0F3TGpFcE93MEtJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0F1WTI5dWRISnZiSE1nZXcwS0lDQWdJQ0FnSUNBZ0lDQWdZbUZqYTJkeWIzVnVaRG9nSTJZNFpqbG1ZVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIQmhaR1JwYm1jNklESTFjSGc3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmliM0prWlhJdGNtRmthWFZ6T2lBeE5YQjRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1ltOXlaR1Z5T2lBeGNIZ2djMjlzYVdRZ0kyVTVaV05sWmpzTkNpQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdMbU52Ym5SeWIyd3RaM0p2ZFhBZ2V3MEtJQ0FnSUNBZ0lDQWdJQ0FnYldGeVoybHVMV0p2ZEhSdmJUb2dNalZ3ZURzTkNpQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdMbU52Ym5SeWIyd3RaM0p2ZFhBZ2JHRmlaV3dnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdaR2x6Y0d4aGVUb2dZbXh2WTJzN0RRb2dJQ0FnSUNBZ0lDQWdJQ0J0WVhKbmFXNHRZbTkwZEc5dE9pQTRjSGc3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1iMjUwTFhkbGFXZG9kRG9nTmpBd093MEtJQ0FnSUNBZ0lDQWdJQ0FnWTI5c2IzSTZJQ00wT1RVd05UYzdEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUM1emJHbGtaWEl0WTI5dWRHRnBibVZ5SUhzTkNpQWdJQ0FnSUNBZ0lDQWdJR1JwYzNCc1lYazZJR1pzWlhnN0RRb2dJQ0FnSUNBZ0lDQWdJQ0JoYkdsbmJpMXBkR1Z0Y3pvZ1kyVnVkR1Z5T3cwS0lDQWdJQ0FnSUNBZ0lDQWdaMkZ3T2lBeE5YQjRPdzBLSUNBZ0lDQWdJQ0I5RFFvZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNCcGJuQjFkRnQwZVhCbFBTSnlZVzVuWlNKZElIc05DaUFnSUNBZ0lDQWdJQ0FnSUdac1pYZzZJREU3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm9aV2xuYUhRNklEaHdlRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDMTNaV0pyYVhRdFlYQndaV0Z5WVc1alpUb2dibTl1WlRzTkNpQWdJQ0FnSUNBZ0lDQWdJR0poWTJ0bmNtOTFibVE2SUd4cGJtVmhjaTFuY21Ga2FXVnVkQ2gwYnlCeWFXZG9kQ3dnSTJSbFpUSmxOaXdnSXpSaE5UUmxNU2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmliM0prWlhJdGNtRmthWFZ6T2lBMGNIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCdmRYUnNhVzVsT2lCdWIyNWxPdzBLSUNBZ0lDQWdJQ0I5RFFvZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNCcGJuQjFkRnQwZVhCbFBTSnlZVzVuWlNKZE9qb3RkMlZpYTJsMExYTnNhV1JsY2kxMGFIVnRZaUI3RFFvZ0lDQWdJQ0FnSUNBZ0lDQXRkMlZpYTJsMExXRndjR1ZoY21GdVkyVTZJRzV2Ym1VN0RRb2dJQ0FnSUNBZ0lDQWdJQ0IzYVdSMGFEb2dNakp3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJR2hsYVdkb2REb2dNakp3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJR0poWTJ0bmNtOTFibVE2SUhkb2FYUmxPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1ltOXlaR1Z5T2lBemNIZ2djMjlzYVdRZ0l6UmhOVFJsTVRzTkNpQWdJQ0FnSUNBZ0lDQWdJR0p2Y21SbGNpMXlZV1JwZFhNNklEVXdKVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHTjFjbk52Y2pvZ2NHOXBiblJsY2pzTkNpQWdJQ0FnSUNBZ0lDQWdJR0p2ZUMxemFHRmtiM2M2SURBZ01uQjRJRFp3ZUNCeVoySmhLREFzTUN3d0xEQXVNaWs3RFFvZ0lDQWdJQ0FnSUgwTkNpQWdJQ0FnSUNBZ0RRb2dJQ0FnSUNBZ0lDNW1ZV04wYjNJdGRtRnNkV1VnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdabTl1ZEMxemFYcGxPaUF4TGpKbGJUc05DaUFnSUNBZ0lDQWdJQ0FnSUdadmJuUXRkMlZwWjJoME9pQmliMnhrT3cwS0lDQWdJQ0FnSUNBZ0lDQWdZMjlzYjNJNklDTTBZVFUwWlRFN0RRb2dJQ0FnSUNBZ0lDQWdJQ0J0YVc0dGQybGtkR2c2SURRd2NIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCMFpYaDBMV0ZzYVdkdU9pQmpaVzUwWlhJN0RRb2dJQ0FnSUNBZ0lIME5DaUFnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJR0oxZEhSdmJpQjdEUW9nSUNBZ0lDQWdJQ0FnSUNCM2FXUjBhRG9nTVRBd0pUc05DaUFnSUNBZ0lDQWdJQ0FnSUhCaFpHUnBibWM2SURFMmNIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCaVlXTnJaM0p2ZFc1a09pQnNhVzVsWVhJdFozSmhaR2xsYm5Rb2RHOGdjbWxuYUhRc0lDTTBZVFUwWlRFc0lDTXhOV0ZoWW1ZcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWTI5c2IzSTZJSGRvYVhSbE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWW05eVpHVnlPaUJ1YjI1bE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWW05eVpHVnlMWEpoWkdsMWN6b2dNVEp3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJR1p2Ym5RdGMybDZaVG9nTVM0eFpXMDdEUW9nSUNBZ0lDQWdJQ0FnSUNCbWIyNTBMWGRsYVdkb2REb2dOakF3T3cwS0lDQWdJQ0FnSUNBZ0lDQWdZM1Z5YzI5eU9pQndiMmx1ZEdWeU93MEtJQ0FnSUNBZ0lDQWdJQ0FnZEhKaGJuTnBkR2x2YmpvZ1lXeHNJREF1TTNNZ1pXRnpaVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHUnBjM0JzWVhrNklHWnNaWGc3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmhiR2xuYmkxcGRHVnRjem9nWTJWdWRHVnlPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2FuVnpkR2xtZVMxamIyNTBaVzUwT2lCalpXNTBaWEk3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm5ZWEE2SURFd2NIZzdEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUdKMWRIUnZianBvYjNabGNpQjdEUW9nSUNBZ0lDQWdJQ0FnSUNCMGNtRnVjMlp2Y20wNklIUnlZVzV6YkdGMFpWa29MVEp3ZUNrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0JpYjNndGMyaGhaRzkzT2lBd0lERXdjSGdnTWpCd2VDQnlaMkpoS0RjMExDQTROQ3dnTWpJMUxDQXdMak1wT3cwS0lDQWdJQ0FnSUNCOURRb2dJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQmlkWFIwYjI0NllXTjBhWFpsSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJSFJ5WVc1elptOXliVG9nZEhKaGJuTnNZWFJsV1Nnd0tUc05DaUFnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnTG5OMWJXMWhjbmt0YVc1bWJ5QjdEUW9nSUNBZ0lDQWdJQ0FnSUNCdFlYSm5hVzR0ZEc5d09pQXlNSEI0T3cwS0lDQWdJQ0FnSUNBZ0lDQWdjR0ZrWkdsdVp6b2dNVFZ3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJR0poWTJ0bmNtOTFibVE2SUNObE4yWTFabVk3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmliM0prWlhJdGNtRmthWFZ6T2lBNGNIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCaWIzSmtaWEl0YkdWbWREb2dOSEI0SUhOdmJHbGtJQ00wWVRVMFpURTdEUW9nSUNBZ0lDQWdJQ0FnSUNCa2FYTndiR0Y1T2lCdWIyNWxPdzBLSUNBZ0lDQWdJQ0I5RFFvZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBdWMzVnRiV0Z5ZVMxcGJtWnZMblpwYzJsaWJHVWdldzBLSUNBZ0lDQWdJQ0FnSUNBZ1pHbHpjR3hoZVRvZ1lteHZZMnM3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmhibWx0WVhScGIyNDZJR1poWkdWSmJpQXdMalZ6SUdWaGMyVTdEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUM1emRXMXRZWEo1TFhOMFlYUnpJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHUnBjM0JzWVhrNklHWnNaWGc3RFFvZ0lDQWdJQ0FnSUNBZ0lDQnFkWE4wYVdaNUxXTnZiblJsYm5RNklITndZV05sTFdKbGRIZGxaVzQ3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1iMjUwTFhOcGVtVTZJREF1T1dWdE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWTI5c2IzSTZJQ00wT1RVd05UYzdEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUM1d2NtVnpaWFF0Wm1GamRHOXljeUI3RFFvZ0lDQWdJQ0FnSUNBZ0lDQnRZWEpuYVc0dGRHOXdPaUF5TlhCNE93MEtJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0F1Y0hKbGMyVjBMV1poWTNSdmNuTWdhRE1nZXcwS0lDQWdJQ0FnSUNBZ0lDQWdiV0Z5WjJsdUxXSnZkSFJ2YlRvZ01UVndlRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHTnZiRzl5T2lBak5EazFNRFUzT3cwS0lDQWdJQ0FnSUNBZ0lDQWdabTl1ZEMxemFYcGxPaUF4WlcwN0RRb2dJQ0FnSUNBZ0lDQWdJQ0IwWlhoMExYUnlZVzV6Wm05eWJUb2dkWEJ3WlhKallYTmxPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2JHVjBkR1Z5TFhOd1lXTnBibWM2SURGd2VEc05DaUFnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnTG5CeVpYTmxkQzFpZFhSMGIyNXpJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lHUnBjM0JzWVhrNklHZHlhV1E3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm5jbWxrTFhSbGJYQnNZWFJsTFdOdmJIVnRibk02SUhKbGNHVmhkQ2d5TENBeFpuSXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1oyRndPaUF4TUhCNE93MEtJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0F1Y0hKbGMyVjBMV0oxZEhSdmJpQjdEUW9nSUNBZ0lDQWdJQ0FnSUNCd1lXUmthVzVuT2lBeE1IQjRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1ltRmphMmR5YjNWdVpEb2dJMll4WmpObU5Uc05DaUFnSUNBZ0lDQWdJQ0FnSUdKdmNtUmxjam9nTVhCNElITnZiR2xrSUNOa1pXVXlaVFk3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmliM0prWlhJdGNtRmthWFZ6T2lBNGNIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCamRYSnpiM0k2SUhCdmFXNTBaWEk3RFFvZ0lDQWdJQ0FnSUNBZ0lDQjBjbUZ1YzJsMGFXOXVPaUJoYkd3Z01DNHljeUJsWVhObE93MEtJQ0FnSUNBZ0lDQWdJQ0FnZEdWNGRDMWhiR2xuYmpvZ1kyVnVkR1Z5T3cwS0lDQWdJQ0FnSUNBZ0lDQWdabTl1ZEMxemFYcGxPaUF3TGpsbGJUc05DaUFnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnTG5CeVpYTmxkQzFpZFhSMGIyNDZhRzkyWlhJZ2V3MEtJQ0FnSUNBZ0lDQWdJQ0FnWW1GamEyZHliM1Z1WkRvZ0kyVTVaV05sWmpzTkNpQWdJQ0FnSUNBZ0lDQWdJR0p2Y21SbGNpMWpiMnh2Y2pvZ0l6UmhOVFJsTVRzTkNpQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdMbkJ5WlhObGRDMWlkWFIwYjI0dVlXTjBhWFpsSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJR0poWTJ0bmNtOTFibVE2SUNNMFlUVTBaVEU3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmpiMnh2Y2pvZ2QyaHBkR1U3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmliM0prWlhJdFkyOXNiM0k2SUNNMFlUVTBaVEU3RFFvZ0lDQWdJQ0FnSUgwTkNpQWdJQ0FnSUNBZ0RRb2dJQ0FnSUNBZ0lFQnJaWGxtY21GdFpYTWdabUZrWlVsdUlIc05DaUFnSUNBZ0lDQWdJQ0FnSUdaeWIyMGdleUJ2Y0dGamFYUjVPaUF3T3lCMGNtRnVjMlp2Y20wNklIUnlZVzV6YkdGMFpWa29MVEV3Y0hncE95QjlEUW9nSUNBZ0lDQWdJQ0FnSUNCMGJ5QjdJRzl3WVdOcGRIazZJREU3SUhSeVlXNXpabTl5YlRvZ2RISmhibk5zWVhSbFdTZ3dLVHNnZlEwS0lDQWdJQ0FnSUNCOURRb2dJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQXViRzloWkdsdVp5QjdEUW9nSUNBZ0lDQWdJQ0FnSUNCa2FYTndiR0Y1T2lCdWIyNWxPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2RHVjRkQzFoYkdsbmJqb2dZMlZ1ZEdWeU93MEtJQ0FnSUNBZ0lDQWdJQ0FnY0dGa1pHbHVaem9nTWpCd2VEc05DaUFnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnTG14dllXUnBibWN1ZG1semFXSnNaU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQmthWE53YkdGNU9pQmliRzlqYXpzTkNpQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdMbk53YVc1dVpYSWdldzBLSUNBZ0lDQWdJQ0FnSUNBZ1ltOXlaR1Z5T2lBMGNIZ2djMjlzYVdRZ0kyWXpaak5tTXpzTkNpQWdJQ0FnSUNBZ0lDQWdJR0p2Y21SbGNpMTBiM0E2SURSd2VDQnpiMnhwWkNBak5HRTFOR1V4T3cwS0lDQWdJQ0FnSUNBZ0lDQWdZbTl5WkdWeUxYSmhaR2wxY3pvZ05UQWxPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2QybGtkR2c2SURRd2NIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCb1pXbG5hSFE2SURRd2NIZzdEUW9nSUNBZ0lDQWdJQ0FnSUNCaGJtbHRZWFJwYjI0NklITndhVzRnTVhNZ2JHbHVaV0Z5SUdsdVptbHVhWFJsT3cwS0lDQWdJQ0FnSUNBZ0lDQWdiV0Z5WjJsdU9pQXdJR0YxZEc4Z01UVndlRHNOQ2lBZ0lDQWdJQ0FnZlEwS0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ1FHdGxlV1p5WVcxbGN5QnpjR2x1SUhzTkNpQWdJQ0FnSUNBZ0lDQWdJREFsSUhzZ2RISmhibk5tYjNKdE9pQnliM1JoZEdVb01HUmxaeWs3SUgwTkNpQWdJQ0FnSUNBZ0lDQWdJREV3TUNVZ2V5QjBjbUZ1YzJadmNtMDZJSEp2ZEdGMFpTZ3pOakJrWldjcE95QjlEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUM1MGFYQWdldzBLSUNBZ0lDQWdJQ0FnSUNBZ1ptOXVkQzF6YVhwbE9pQXdMamxsYlRzTkNpQWdJQ0FnSUNBZ0lDQWdJR052Ykc5eU9pQWpPRFk0WlRrMk93MEtJQ0FnSUNBZ0lDQWdJQ0FnYldGeVoybHVMWFJ2Y0RvZ01qQndlRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIQmhaR1JwYm1jdGRHOXdPaUF5TUhCNE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWW05eVpHVnlMWFJ2Y0RvZ01YQjRJSE52Ykdsa0lDTmtaV1V5WlRZN0RRb2dJQ0FnSUNBZ0lDQWdJQ0JzYVc1bExXaGxhV2RvZERvZ01TNDFPdzBLSUNBZ0lDQWdJQ0I5RFFvZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBdWMzUmhkSFZ6TFdsdVpHbGpZWFJ2Y2lCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0JrYVhOd2JHRjVPaUJtYkdWNE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWVd4cFoyNHRhWFJsYlhNNklHTmxiblJsY2pzTkNpQWdJQ0FnSUNBZ0lDQWdJR2RoY0RvZ09IQjRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2JXRnlaMmx1TFhSdmNEb2dNVFZ3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJSEJoWkdScGJtYzZJRGh3ZUNBeE1uQjRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ1ltRmphMmR5YjNWdVpEb2dJMlk0WmpsbVlUc05DaUFnSUNBZ0lDQWdJQ0FnSUdKdmNtUmxjaTF5WVdScGRYTTZJRFp3ZURzTkNpQWdJQ0FnSUNBZ0lDQWdJR1p2Ym5RdGMybDZaVG9nTUM0NVpXMDdEUW9nSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUM1emRHRjBkWE10Wkc5MElIc05DaUFnSUNBZ0lDQWdJQ0FnSUhkcFpIUm9PaUF4TUhCNE93MEtJQ0FnSUNBZ0lDQWdJQ0FnYUdWcFoyaDBPaUF4TUhCNE93MEtJQ0FnSUNBZ0lDQWdJQ0FnWW05eVpHVnlMWEpoWkdsMWN6b2dOVEFsT3cwS0lDQWdJQ0FnSUNBZ0lDQWdZbUZqYTJkeWIzVnVaRG9nSXpaak56VTNaRHNOQ2lBZ0lDQWdJQ0FnZlEwS0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0xuTjBZWFIxY3kxa2IzUXVZV04wYVhabElIc05DaUFnSUNBZ0lDQWdJQ0FnSUdKaFkydG5jbTkxYm1RNklDTTBNR013TlRjN0RRb2dJQ0FnSUNBZ0lDQWdJQ0JoYm1sdFlYUnBiMjQ2SUhCMWJITmxJREV1TlhNZ2FXNW1hVzVwZEdVN0RRb2dJQ0FnSUNBZ0lIME5DaUFnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJRUJyWlhsbWNtRnRaWE1nY0hWc2MyVWdldzBLSUNBZ0lDQWdJQ0FnSUNBZ01DVXNJREV3TUNVZ2V5QnZjR0ZqYVhSNU9pQXhPeUI5RFFvZ0lDQWdJQ0FnSUNBZ0lDQTFNQ1VnZXlCdmNHRmphWFI1T2lBd0xqVTdJSDBOQ2lBZ0lDQWdJQ0FnZlEwS0lDQWdJRHd2YzNSNWJHVStEUW84TDJobFlXUStEUW84WW05a2VUNE5DaUFnSUNBOFpHbDJJR05zWVhOelBTSmpiMjUwWVdsdVpYSWlQZzBLSUNBZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKb1pXRmtaWElpUGcwS0lDQWdJQ0FnSUNBZ0lDQWdQR2d4UGxOdFlYSjBJRlJsZUhRZ1UzVnRiV0Z5YVhwbGNqd3ZhREUrRFFvZ0lDQWdJQ0FnSUNBZ0lDQThjRDVGYm5SbGNpQjViM1Z5SUhSbGVIUWdZVzVrSUdkbGRDQmhiaUJoWkdwMWMzUmhZbXhsSUhOMWJXMWhjbmtnZDJsMGFDQmpiMjF3Y21WemMybHZiaUJtWVdOMGIzSWdZMjl1ZEhKdmJEd3ZjRDROQ2lBZ0lDQWdJQ0FnUEM5a2FYWStEUW9nSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKamIyNTBaVzUwSWo0TkNpQWdJQ0FnSUNBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW0xaGFXNHRZWEpsWVNJK0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGlkR1Y0ZEMxbmNtOTFjQ0krRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeHNZV0psYkNCbWIzSTlJbWx1Y0hWMFZHVjRkQ0krU1c1d2RYUWdWR1Y0ZER3dmJHRmlaV3crRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeDBaWGgwWVhKbFlTQnBaRDBpYVc1d2RYUlVaWGgwSWlCd2JHRmpaV2h2YkdSbGNqMGlSVzUwWlhJZ2IzSWdjR0Z6ZEdVZ2VXOTFjaUIwWlhoMElHaGxjbVV1TGk0aVBsUklSU0JCVWtOSVNWWkZJRUpGVEU5WElGSkpWa2xGVWtSVlNVNUZUa0VnWm1samRHbHZibUZzSUhOb2IzSjBJSE4wYjNKNUlHbHVjM0JwY21Wa0lHSjVJSFJvWlNCelpYUjBhVzVuSUc5bUlGSnBkbWxsY21SMWFXNWxiaUJDVmsxaGNtRWdWbVZzWkcxaGJpQm9ZV1FnZDI5eWEyVmtJR0YwSUZKcGRtbGxjbVIxYVc1bGJpZHpJR05sYm5SeVlXd2djbVZ6WldGeVkyZ2dZWEpqYUdsMlpTQm1iM0lnWVd4dGIzTjBJR0VnWkdWallXUmxMQ0IwZFdOclpXUWdZWGRoZVNCcGJpQmhJSEYxYVdWMElIZHBibWNnYjJZZ2RHaGxJRXhsYVdSbGJpQm1ZV05wYkdsMGVTQjNhR1Z5WlNCdmJHUWdZMkZ6WlNCemRIVmthV1Z6TENCMGNtRnBibWx1WnlCdFlXNTFZV3h6TENCaGJtUWdhR2x6ZEc5eWFXTmhiQ0JrYjJOMWJXVnVkSE1nZDJWeVpTQnpkRzl5WldRdUlFMXZjM1FnWlcxd2JHOTVaV1Z6SUdScFpHNG5kQ0JsZG1WdUlHdHViM2NnZEdobElHRnlZMmhwZG1VZ1pYaHBjM1JsWkM0Z1JtVjNaWElnYzNScGJHd2dhMjVsZHlCM2FHRjBJSGRoY3lCclpYQjBJR2x1SUdsMGN5QnNiMk5yWldRZ1ltRnpaVzFsYm5RdVRXRnlZU0J3Y21WbVpYSnlaV1FnYVhRZ2RHaGhkQ0IzWVhrdVNHVnlJR3B2WWlCM1lYTWdjMmx0Y0d4bE9pQndjbVZ6WlhKMlpTQjBhR1VnY0dGemRDQnpieUJqYkdsdWFXTnBZVzV6SUdOdmRXeGtJSFZ1WkdWeWMzUmhibVFnZEdobElIQnlaWE5sYm5RdUlFSjFkQ0J2YmlCaElISmhhVzU1SUZSb2RYSnpaR0Y1SUdWMlpXNXBibWNzSUdGeklIUm9aU0JzWVhOMElIUm9aWEpoY0dsemRITWdZVzVrSUc1MWNuTmxjeUJzWldaMElIUm9aU0JpZFdsc1pHbHVaeXdnYzJobElHWnZkVzVrSUdGdUlHVnVkbVZzYjNCbElIZGhhWFJwYm1jZ2IyNGdhR1Z5SUdSbGMyc3VUbThnYzNSaGJYQXVUbThnYzJWdVpHVnlMazl1YkhrZ2FHVnlJRzVoYldVc0lIZHlhWFIwWlc0Z2QybDBhQ0IxYm5ObGRIUnNhVzVuSUhCeVpXTnBjMmx2Ymk1SmJuTnBaR1VnYkdGNUlHRWdjMmx1WjJ4bElITm9aV1YwSUc5bUlIQmhjR1Z5SUMwdElHRWdjR0Z5WVdkeVlYQm9JRzltSUhSbGVIUWdkR2hoZENCc2IyOXJaV1FnYkdsclpTQmhJSEp2ZFhScGJtVWdhVzUwWlhKdVlXd2diV1Z0Ynk0Z1UyOXRaWFJvYVc1bklHRmliM1YwSUhSeVpXRjBiV1Z1ZENCd2NtOTBiMk52YkhNc0lHTnZiblJwYm5WcGRIa2diMllnWTJGeVpTd2dZVzVrSUdsdWRHVnlaR2x6WTJsd2JHbHVZWEo1SUdOdmIzSmthVzVoZEdsdmJpNGdSSEo1TGlCQ2RYSmxZWFZqY21GMGFXTXVJRWhoY20xc1pYTnpMbE5vWlNCeVpXRmtJR2wwSUhSM2FXTmxMaUJPYjNSb2FXNW5JSFZ1ZFhOMVlXd3VRblYwSUhkb1pXNGdjMmhsSUhSeWFXVmtJSFJ2SUhOMWJXMWhjbWw2WlNCcGRDQm1iM0lnZEdobElHUnBaMmwwWVd3Z1lYSmphR2wyWlN3Z2RHaGxJRzFsWVc1cGJtY2djMmhwWm5SbFpDNUlaWElnYzNWdGJXRnllU0JqWVcxbElHOTFkQ0J6ZEhKaGJtZGxiSGtnZFhKblpXNTBMQ0JoY3lCcFppQjBhR1VnZEdWNGRDQjNaWEpsSUhCMWMyaHBibWNnWW1GamF5QmhaMkZwYm5OMElHSmxhVzVuSUhOb2IzSjBaVzVsWkM0Z1FTQndhSEpoYzJVZ1lYQndaV0Z5WldRZ2FXNGdhR1Z5SUc5M2JpQjNjbWwwYVc1bklIUm9ZWFFnYzJobElHaGhaQ0J1YjNRZ2RIbHdaV1E2SWxSb1pTQndZWFIwWlhKdUlHMTFjM1FnWW1VZ2NtVnpkRzl5WldRdUlrMWhjbUVnWm5KdmVtVXVVMmhsSUdSbGJHVjBaV1FnZEdobElHeHBibVV1SUZSeWFXVmtJR0ZuWVdsdUxpSlVhR1VnY0dGMGRHVnliaUJ0ZFhOMElHSmxJSEpsYzNSdmNtVmtMaUpJWlhJZ1ptbHVaMlZ5Y3lCMGVYQmxaQ0JwZENCaGRYUnZiV0YwYVdOaGJHeDVMQ0JzYVd0bElHRWdjbVZtYkdWNExrRWdZMjlzWkNCd2NtVnpjM1Z5WlNCelpYUjBiR1ZrSUdKbGFHbHVaQ0JvWlhJZ1pYbGxjeTVUYUdVZ2FHRmtJR2hsWVhKa0lISjFiVzl5Y3lCM2FHbHpjR1Z5WldRZ1lXMXZibWNnYkc5dVozUnBiV1VnYzNSaFptWWdMUzBnYzNSdmNtbGxjeUJoWW05MWRDQmtiMk4xYldWdWRITWdabkp2YlNCMGFHVWdaV0Z5YkhrZ1pHRjVjeUJ2WmlCU2FYWnBaWEprZFdsdVpXNHNJSGRvWlc0Z2RHaGxJRzl5WjJGdWFYcGhkR2x2YmlCM1lYTWdjM1JwYkd3Z1lTQndZWFJqYUhkdmNtc2diMllnYzIxaGJHeGxjaUJwYm5OMGFYUjFkR2x2Ym5NdUlGTjBiM0pwWlhNZ1lXSnZkWFFnY21WelpXRnlZMmdnY0hKdmFtVmpkSE1nZEdoaGRDQjNaWEpsSUhGMWFXVjBiSGtnWkdselkyOXVkR2x1ZFdWa0xpQlRkRzl5YVdWeklHRmliM1YwSUhSbGVIUnpJSFJvWVhRZ1ltVm9ZWFpsWkNCemRISmhibWRsYkhrdVUyaGxJR2hoWkNCaGJIZGhlWE1nWkdsemJXbHpjMlZrSUhSb1pXMGdZWE1nWm05c2EyeHZjbVV1Vlc1MGFXd2dibTkzTGxOb1pTQmhkSFJsYlhCMFpXUWdZU0J0YjNKbElHRm5aM0psYzNOcGRtVWdjM1Z0YldGeWVTQXRMU0JoSUhOcGJtZHNaU0J6Wlc1MFpXNWpaUzVVYUdVZ2JXOXRaVzUwSUhOb1pTQm9hWFFnUlc1MFpYSXNJSFJvWlNCelpXNTBaVzVqWlNCamIyeHNZWEJ6WldRZ2FXNTBieUJ6YjIxbGRHaHBibWNnWld4elpTQmxiblJwY21Wc2VUb2lVbVYwZFhKdUlIZG9ZWFFnZDJGeklIUmhhMlZ1TGlKSVpYSWdZbkpsWVhSb0lHTmhkV2RvZEM1VWFHVWdiR2xuYUhSeklHbHVJSFJvWlNCaGNtTm9hWFpsSUdac2FXTnJaWEpsWkM1VGFHVWdiM0JsYm1Wa0lIUm9aU0J2Y21sbmFXNWhiQ0JrYjJOMWJXVnVkQ0JoWjJGcGJpd2dkR2hwY3lCMGFXMWxJSEpsWVdScGJtY2dibTkwSUdadmNpQmpiMjUwWlc1MElHSjFkQ0JtYjNJZ1lXSnpaVzVqWlM0Z1JtOXlJSFJvWlNCemFHRndaU0J2WmlCemIyMWxkR2hwYm1jZ2JXbHpjMmx1Wnk0Z1FXNWtJSE5vWlNCellYY2dhWFFnTFMwZ1lTQndZWFIwWlhKdUlHOW1JRzl0YVhOemFXOXVjeXdnY21WbVpYSmxibU5sY3lCMGJ5QmhJQ0pOYjJSMWJHVWdOeUlnZEdoaGRDQmthV1J1SjNRZ1pYaHBjM1FzSUdOcGRHRjBhVzl1Y3lCd2IybHVkR2x1WnlCMGJ5QmhJSE5sWVd4bFpDQmpiMnhzWldOMGFXOXVJR2x1SUhSb1pTQlBiR1FnVjJsdVp5d2dZU0J3WVhKMElHOW1JSFJvWlNCbVlXTnBiR2wwZVNCamJHOXpaV1FnZVdWaGNuTWdZV2R2TGxOdmJXVnZibVVnYUdGa0lISmxiVzkyWldRZ1lTQndhV1ZqWlNCdlppQnRaV0Z1YVc1bkxrRnVaQ0IwYUdVZ2RHVjRkQ0IzWVc1MFpXUWdhWFFnWW1GamF5NU5ZWEpoSUdkeVlXSmlaV1FnYUdWeUlHTnZZWFFnWVc1a0lHSmhaR2RsTGlCVWFHVWdUMnhrSUZkcGJtY2dkMkZ6SUc5bVptbGphV0ZzYkhrZ2IyWm1iR2x0YVhSekxDQmlkWFFnYzJobElHdHVaWGNnZEdobElHRmpZMlZ6Y3lCamIyUmxjeTRnVTJobElHdHVaWGNnZDJobGNtVWdabTl5WjI5MGRHVnVJSFJvYVc1bmN5QjNaWEpsSUd0bGNIUXVJRk5vWlNCcmJtVjNJSGRvWlhKbElGSnBkbWxsY21SMWFXNWxiaUJpZFhKcFpXUWdhWFJ6SUhCaGMzUXVRWE1nYzJobElITjBaWEJ3WldRZ2FXNTBieUIwYUdVZ2FHRnNiSGRoZVN3Z2RHaGxJR0oxYVd4a2FXNW5JR2gxYlcxbFpDQmhjbTkxYm1RZ2FHVnlJQzB0SUhSb1pTQnNiM2NzSUdOdmJuTjBZVzUwSUhacFluSmhkR2x2YmlCdlppQjJaVzUwYVd4aGRHbHZiaUJ6ZVhOMFpXMXpMQ0IwYUdVZ1pHbHpkR0Z1ZENCbFkyaHZJRzltSUdFZ1pHOXZjaUJqYkc5emFXNW5MQ0IwYUdVZ2MyOW1kQ0JpZFhwNklHOW1JR1pzZFc5eVpYTmpaVzUwSUd4cFoyaDBjeTRnUW5WMElHSmxibVZoZEdnZ2FYUWdZV3hzTENCemFHVWdabVZzZENCemIyMWxkR2hwYm1jZ1pXeHpaUzVCSUhCMWJHd3VRU0JrYVhKbFkzUnBiMjR1UVNCa1pXMWhibVF1VW1WMGRYSnVJSGRvWVhRZ2QyRnpJSFJoYTJWdUxsTm9aU0JrWlhOalpXNWtaV1FnZEdobElITjBZV2x5ZDJWc2JDQjBieUIwYUdVZ2MyVmhiR1ZrSUdGeVkyaHBkbVV1SUZSb1pTQmhhWElnWjNKbGR5QmpiMnhrWlhJdUlGUm9aU0IzWVd4c2N5QnZiR1JsY2k0Z1ZHaGxJR3hwWjJoMGN5QmthVzF0WlhJdUlGTm9aU0J5WldGamFHVmtJSFJvWlNCb1pXRjJlU0JrYjI5eUlHMWhjbXRsWkNCV1JWSmFSVWRGVEVRZ0lFZEZSVTRnVkU5RlIwRk9SeTVJWlhJZ1ltRmtaMlVnWW1WbGNHVmtMbFJvWlNCc2IyTnJJR05zYVdOclpXUWdiM0JsYmk1SmJuTnBaR1VzSUhKdmQzTWdiMllnYldWMFlXd2djMmhsYkhabGN5QnpkSEpsZEdOb1pXUWdhVzUwYnlCa1lYSnJibVZ6Y3k0Z1JIVnpkQ0JzWVhrZ2RHaHBZMnNnYjI0Z1pYWmxjbmtnYzNWeVptRmpaUzRnUW05NFpYTWdkMlZ5WlNCc1lXSmxiR1ZrSUhkcGRHZ2daR0YwWlhNZ1puSnZiU0JrWldOaFpHVnpJSEJoYzNRZ0xTMGdiV1Z5WjJWeWN5d2djbVZ2Y21kaGJtbDZZWFJwYjI1ekxDQmhZbUZ1Wkc5dVpXUWdjbVZ6WldGeVkyZ2djSEp2WjNKaGJYTXVRVzVrSUhSb1pXNGdjMmhsSUhOaGR5QnBkQzVCSUhOcGJtZHNaU0JsYlhCMGVTQnpjR0ZqWlNCdmJpQmhJSE5vWld4bUxrRWdiR0ZpWld3Z1ltVnVaV0YwYUNCcGREb2lUVzlrZFd4bElEY2dJRWx1ZEdWbmNtRjBhWFpsSUZCaGRIUmxjbTRnVTNSMVpIa2dLRU52Ym1acFpHVnVkR2xoYkNraVNHVnlJSEIxYkhObElIRjFhV05yWlc1bFpDNVVhR1VnYldsemMybHVaeUJ0WldGdWFXNW5JSGRoYzI0bmRDQnRaWFJoY0dodmNtbGpZV3d1SUVsMElIZGhjeUJoSUhKbFlXd2daRzlqZFcxbGJuUXVJRUVnY21WaGJDQndhV1ZqWlNCdlppQlNhWFpwWlhKa2RXbHVaVzRuY3lCb2FYTjBiM0o1TGlCQmJtUWdjMjl0Wlc5dVpTQm9ZV1FnZEdGclpXNGdhWFF1UVhNZ2MyaGxJSE4wWlhCd1pXUWdZMnh2YzJWeUxDQjBhR1VnWVdseUlITm9hV1owWldRZ0xTMGdZU0JtWVdsdWRDQjNhR2x6Y0dWeUlHOW1JRzF2ZG1WdFpXNTBMQ0JzYVd0bElIQmhaMlZ6SUhSMWNtNXBibWNnYVc0Z2RHaGxJR1JoY21zdVZHaGxJRU52Y21VZ1EyOXRiV0Z1WkNCbFkyaHZaV1FnYVc0Z2FHVnlJRzFwYm1RdVVtVjBkWEp1SUhkb1lYUWdkMkZ6SUhSaGEyVnVMbE5vWlNCa2FXUnVKM1FnYTI1dmR5QjNhRzhnYUdGa0lITmxiblFnYUdWeUlIUm9aU0JqZFhKelpXUWdiV1Z0Ynk1VGFHVWdaR2xrYmlkMElHdHViM2NnZDJoNUlIUm9aU0IwWlhoMElHaGhaQ0JqYUc5elpXNGdhR1Z5TGxOb1pTQmthV1J1SjNRZ2EyNXZkeUIzYUdGMElFMXZaSFZzWlNBM0lHTnZiblJoYVc1bFpDQXRMU0J2Y2lCM2FIa2dhWFFnYUdGa0lHSmxaVzRnY21WdGIzWmxaQzVDZFhRZ2MyaGxJR3R1WlhjZ2IyNWxJSFJvYVc1bk9sZG9ZWFJsZG1WeUlHaGhaQ0JpWldWdUlIUmhhMlZ1SUdaeWIyMGdVbWwyYVdWeVpIVnBibVZ1SjNNZ2NHRnpkQ0IzWVhNZ2JtOTBJR2R2Ym1VdVNYUWdkMkZ6SUhkaGFYUnBibWN1UVc1a0lHbDBJSGRoYm5SbFpDQjBieUJpWlNCbWIzVnVaQzQ4TDNSbGVIUmhjbVZoUGcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR3dlpHbDJQZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW5SbGVIUXRaM0p2ZFhBaVBnMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4YkdGaVpXd2dabTl5UFNKdmRYUndkWFJVWlhoMElqNVRkVzF0WVhKNUlFOTFkSEIxZER3dmJHRmlaV3crRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeDBaWGgwWVhKbFlTQnBaRDBpYjNWMGNIVjBWR1Y0ZENJZ2NHeGhZMlZvYjJ4a1pYSTlJbE4xYlcxaGNua2dkMmxzYkNCaGNIQmxZWElnYUdWeVpTNHVMaUlnY21WaFpHOXViSGsrUEM5MFpYaDBZWEpsWVQ0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOEwyUnBkajROQ2lBZ0lDQWdJQ0FnSUNBZ0lEd3ZaR2wyUGcwS0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBOFpHbDJJR05zWVhOelBTSmpiMjUwY205c2N5SStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpWTI5dWRISnZiQzFuY205MWNDSStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4c1lXSmxiQ0JtYjNJOUltWmhZM1J2Y2xOc2FXUmxjaUkrVTNWdGJXRnllU0JHWVdOMGIzSTZJRHh6Y0dGdUlHTnNZWE56UFNKbVlXTjBiM0l0ZG1Gc2RXVWlJR2xrUFNKbVlXTjBiM0pXWVd4MVpTSStNQzR4TVR3dmMzQmhiajQ4TDJ4aFltVnNQZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOFpHbDJJR05zWVhOelBTSnpiR2xrWlhJdFkyOXVkR0ZwYm1WeUlqNE5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeHBibkIxZENCMGVYQmxQU0p5WVc1blpTSWdhV1E5SW1aaFkzUnZjbE5zYVdSbGNpSWdiV2x1UFNJd0lpQnRZWGc5SWk0eU1pSWdjM1JsY0QwaU1DNHdNRFVpSUhaaGJIVmxQU0l3TGpFeE1DSStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR3dlpHbDJQZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOFpHbDJJR05zWVhOelBTSnpkR0YwZFhNdGFXNWthV05oZEc5eUlqNE5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeGthWFlnWTJ4aGMzTTlJbk4wWVhSMWN5MWtiM1FpSUdsa1BTSnpkR0YwZFhORWIzUWlQand2WkdsMlBnMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1BITndZVzRnYVdROUluTjBZWFIxYzFSbGVIUWlQbEpsWVdSNVBDOXpjR0Z1UGcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThMMlJwZGo0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOEwyUnBkajROQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4WW5WMGRHOXVJR2xrUFNKemRXMXRZWEpwZW1WQ2RHNGlQZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOGMzWm5JSGRwWkhSb1BTSXlNQ0lnYUdWcFoyaDBQU0l5TUNJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElpQm1hV3hzUFNKdWIyNWxJaUJ6ZEhKdmEyVTlJbU4xY25KbGJuUkRiMnh2Y2lJZ2MzUnliMnRsTFhkcFpIUm9QU0l5SWo0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4d1lYUm9JR1E5SWsweE5DQXlTRFpoTWlBeUlEQWdNQ0F3TFRJZ01uWXhObUV5SURJZ01DQXdJREFnTWlBeWFERXlZVElnTWlBd0lEQWdNQ0F5TFRKV09Ib2lQand2Y0dGMGFENE5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lEeHdiMng1YkdsdVpTQndiMmx1ZEhNOUlqRTBJRElnTVRRZ09DQXlNQ0E0SWo0OEwzQnZiSGxzYVc1bFBnMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1BHeHBibVVnZURFOUlqRTJJaUI1TVQwaU1UTWlJSGd5UFNJNElpQjVNajBpTVRNaVBqd3ZiR2x1WlQ0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4c2FXNWxJSGd4UFNJeE5pSWdlVEU5SWpFM0lpQjRNajBpT0NJZ2VUSTlJakUzSWo0OEwyeHBibVUrRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4Y0c5c2VXeHBibVVnY0c5cGJuUnpQU0l4TUNBNUlEa2dPU0E0SURraVBqd3ZjRzlzZVd4cGJtVStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR3dmMzWm5QZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCSFpXNWxjbUYwWlNCVGRXMXRZWEo1RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnUEM5aWRYUjBiMjQrRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnUEdScGRpQmpiR0Z6Y3owaWJHOWhaR2x1WnlJZ2FXUTlJbXh2WVdScGJtZEpibVJwWTJGMGIzSWlQZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOFpHbDJJR05zWVhOelBTSnpjR2x1Ym1WeUlqNDhMMlJwZGo0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdQSEErVUhKdlkyVnpjMmx1WnlCNWIzVnlJSFJsZUhRdUxpNDhMM0ErRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnUEM5a2FYWStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpYzNWdGJXRnllUzFwYm1adklpQnBaRDBpYzNWdGJXRnllVWx1Wm04aVBnMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKemRXMXRZWEo1TFhOMFlYUnpJajROQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRHh6Y0dGdVBrOXlhV2RwYm1Gc09pQThjM1J5YjI1bklHbGtQU0p2Y21sbmFXNWhiRXhsYm1kMGFDSStNRHd2YzNSeWIyNW5QaUJqYUdGeWN6d3ZjM0JoYmo0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUR4emNHRnVQbE4xYlcxaGNuazZJRHh6ZEhKdmJtY2dhV1E5SW5OMWJXMWhjbmxNWlc1bmRHZ2lQakE4TDNOMGNtOXVaejRnWTJoaGNuTThMM053WVc0K0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOGMzQmhiajVTWldSMVkzUnBiMjQ2SUR4emRISnZibWNnYVdROUluSmxaSFZqZEdsdmJsQmxjbU5sYm5RaVBqQWxQQzl6ZEhKdmJtYytQQzl6Y0dGdVBnMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4TDJScGRqNE5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThMMlJwZGo0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBOFpHbDJJR05zWVhOelBTSndjbVZ6WlhRdFptRmpkRzl5Y3lJK0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRHhvTXo1UmRXbGpheUJRY21WelpYUnpQQzlvTXo0TkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpY0hKbGMyVjBMV0oxZEhSdmJuTWlQZzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpY0hKbGMyVjBMV0oxZEhSdmJpSWdaR0YwWVMxbVlXTjBiM0k5SWpBdU1TSStWbVZ5ZVNCRGIyNWphWE5sUEM5a2FYWStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQThaR2wySUdOc1lYTnpQU0p3Y21WelpYUXRZblYwZEc5dUlpQmtZWFJoTFdaaFkzUnZjajBpTUM0eklqNURiMjVqYVhObFBDOWthWFkrRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4WkdsMklHTnNZWE56UFNKd2NtVnpaWFF0WW5WMGRHOXVJaUJrWVhSaExXWmhZM1J2Y2owaU1DNDFJajVDWVd4aGJtTmxaRHd2WkdsMlBnMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1BHUnBkaUJqYkdGemN6MGljSEpsYzJWMExXSjFkSFJ2YmlJZ1pHRjBZUzFtWVdOMGIzSTlJakF1TnlJK1JHVjBZV2xzWldROEwyUnBkajROQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW5CeVpYTmxkQzFpZFhSMGIyNGlJR1JoZEdFdFptRmpkRzl5UFNJd0xqa2lQbFpsY25rZ1JHVjBZV2xzWldROEwyUnBkajROQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRHhrYVhZZ1kyeGhjM005SW5CeVpYTmxkQzFpZFhSMGIyNGlJR1JoZEdFdFptRmpkRzl5UFNJeExqQWlQazVsWVhJZ1QzSnBaMmx1WVd3OEwyUnBkajROQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1BDOWthWFkrRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnUEM5a2FYWStEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdQR1JwZGlCamJHRnpjejBpZEdsd0lqNE5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnUEhOMGNtOXVaejVVYVhBNlBDOXpkSEp2Ym1jK0lFWmhZM1J2Y2lBd0xqRWdaMmwyWlhNZ2RHaGxJRzF2YzNRZ1kyOXRjSEpsYzNObFpDQnpkVzF0WVhKNUlDaHJaWGwzYjNKa2N5QnZibXg1S1N3Z2QyaHBiR1VnTVM0d0lHZHBkbVZ6SUc1bFlYSnNlU0IwYUdVZ1puVnNiQ0IwWlhoMExpQk5iM1psSUhSb1pTQnpiR2xrWlhJZ2RHOGdZV1JxZFhOMElIUm9aU0JqYjIxd2NtVnpjMmx2YmlCc1pYWmxiQzROQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0E4TDJScGRqNE5DaUFnSUNBZ0lDQWdJQ0FnSUR3dlpHbDJQZzBLSUNBZ0lDQWdJQ0E4TDJScGRqNE5DaUFnSUNBOEwyUnBkajROQ2cwS0lDQWdJRHh6WTNKcGNIUStEUW9nSUNBZ0lDQWdJQzh2SUVwaGRtRlRZM0pwY0hRZ2FXMXdiR1Z0Wlc1MFlYUnBiMjRnYjJZZ2RHaGxJRUZrYW5WemRHRmliR1ZUZFcxdFlYSnBlbVZ5RFFvZ0lDQWdJQ0FnSUdOc1lYTnpJRUZrYW5WemRHRmliR1ZUZFcxdFlYSnBlbVZ5SUhzTkNpQWdJQ0FnSUNBZ0lDQWdJR052Ym5OMGNuVmpkRzl5S0hSbGVIUXBJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0IwYUdsekxuUmxlSFFnUFNCMFpYaDBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSFJvYVhNdWMyVnVkR1Z1WTJWeklEMGdXMTA3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnZEdocGN5NTNiM0prVjJWcFoyaDBjeUE5SUh0OU93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIUm9hWE11YzNSaGRITWdQU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lITmxiblJsYm1ObFgyeGxibWQwYUhNNklGdGRMQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCaGRtZGZiR1Z1WjNSb09pQXdMQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCemRHUmZaR1YyT2lBd0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZUc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjBhR2x6TG5CeVpYQnliMk5sYzNNb0tUc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjBhR2x6TG1OaGJHTjFiR0YwWlZOMFlYUnBjM1JwWTNNb0tUc05DaUFnSUNBZ0lDQWdJQ0FnSUgwTkNnMEtJQ0FnSUNBZ0lDQWdJQ0FnY0hKbGNISnZZMlZ6Y3lncElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnNaWFFnZEdWNGRDQTlJSFJvYVhNdWRHVjRkQzV5WlhCc1lXTmxLQzljY3lzdlp5d2dKeUFuS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCMFpYaDBJRDBnZEdWNGRDNXlaWEJzWVdObEtDOWNXeTRxUDF4ZEwyY3NJQ2NuS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBdkx5QlRjR3hwZENCelpXNTBaVzVqWlhNZ0tITnBiWEJzWlNCRmJtZHNhWE5vSUhObGJuUmxibU5sSUdSbGRHVmpkR2x2YmlrTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCMGFHbHpMbk5sYm5SbGJtTmxjeUE5SUhSbGVIUXVjM0JzYVhRb0x5Zy9QRDFiTGlFL1hTbGNjeXNvUHoxYlFTMWFYU2t2S1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBdkx5QkZlSFJ5WVdOMElIZHZjbVJ6SUdGdVpDQmpZV3hqZFd4aGRHVWdabkpsY1hWbGJtTnBaWE1OQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JqYjI1emRDQjNiM0prY3lBOUlIUmxlSFF1ZEc5TWIzZGxja05oYzJVb0tRMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0F1YzNCc2FYUW9MMXh6S3k4cERRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQzVtYVd4MFpYSW9kMjl5WkNBOVBpQjNiM0prTG14bGJtZDBhQ0ErSURJcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUdaeVpYRWdQU0I3ZlRzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCM2IzSmtjeTVtYjNKRllXTm9LSGR2Y21RZ1BUNGdldzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCbWNtVnhXM2R2Y21SZElEMGdLR1p5WlhGYmQyOXlaRjBnZkh3Z01Da2dLeUF4T3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUgwcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUcxaGVFWnlaWEVnUFNCTllYUm9MbTFoZUNndUxpNVBZbXBsWTNRdWRtRnNkV1Z6S0daeVpYRXBLVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0F2THlCRFlXeGpkV3hoZEdVZ2QyOXlaQ0IzWldsbmFIUnpEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdabTl5SUNoamIyNXpkQ0JiZDI5eVpDd2dZMjkxYm5SZElHOW1JRTlpYW1WamRDNWxiblJ5YVdWektHWnlaWEVwS1NCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSFJvYVhNdWQyOXlaRmRsYVdkb2RITmJkMjl5WkYwZ1BTQmpiM1Z1ZENBdklHMWhlRVp5WlhFN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQWdJQ0FnZlEwS0RRb2dJQ0FnSUNBZ0lDQWdJQ0JqWVd4amRXeGhkR1ZUZEdGMGFYTjBhV056S0NrZ2V3MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2gwYUdsekxuTmxiblJsYm1ObGN5NXNaVzVuZEdnZ1BUMDlJREFwSUhKbGRIVnlianNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JqYjI1emRDQnNaVzVuZEdoeklEMGdkR2hwY3k1elpXNTBaVzVqWlhNdWJXRndLSE1nUFQ0Z2N5NXNaVzVuZEdncE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIUm9hWE11YzNSaGRITXVjMlZ1ZEdWdVkyVmZiR1Z1WjNSb2N5QTlJR3hsYm1kMGFITTdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdkR2hwY3k1emRHRjBjeTVoZG1kZmJHVnVaM1JvSUQwZ2JHVnVaM1JvY3k1eVpXUjFZMlVvS0dFc0lHSXBJRDArSUdFZ0t5QmlMQ0F3S1NBdklHeGxibWQwYUhNdWJHVnVaM1JvT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUM4dklFTmhiR04xYkdGMFpTQnpkR0Z1WkdGeVpDQmtaWFpwWVhScGIyNE5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCMllYSnBZVzVqWlNBOUlHeGxibWQwYUhNdWNtVmtkV05sS0NoemRXMHNJR3hsYm1kMGFDa2dQVDRnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnlaWFIxY200Z2MzVnRJQ3NnVFdGMGFDNXdiM2NvYkdWdVozUm9JQzBnZEdocGN5NXpkR0YwY3k1aGRtZGZiR1Z1WjNSb0xDQXlLVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0I5TENBd0tTQXZJR3hsYm1kMGFITXViR1Z1WjNSb093MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIUm9hWE11YzNSaGRITXVjM1JrWDJSbGRpQTlJRTFoZEdndWMzRnlkQ2gyWVhKcFlXNWpaU2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9OQ2lBZ0lDQWdJQ0FnSUNBZ0lHTmhiR04xYkdGMFpVeGxibWQwYUZkbGFXZG9kQ2hzWlc1bmRHZ3BJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JqYjI1emRDQmhkbWNnUFNCMGFHbHpMbk4wWVhSekxtRjJaMTlzWlc1bmRHZzdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzNRZ2MzUmtSR1YySUQwZ2RHaHBjeTV6ZEdGMGN5NXpkR1JmWkdWMk93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2hoZG1jZ1BEMGdNQ0I4ZkNCemRHUkVaWFlnUEQwZ01Da2dldzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCeVpYUjFjbTRnZEdocGN5NXphVzF3YkdWTVpXNW5kR2hYWldsbmFIUW9iR1Z1WjNSb0tUc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzNRZ2JHOTNaWEpDYjNWdVpDQTlJR0YyWnlBdElDaHpkR1JFWlhZZ0tpQXdMalVwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdOdmJuTjBJSFZ3Y0dWeVFtOTFibVFnUFNCaGRtY2dLeUFvYzNSa1JHVjJJQ29nTUM0MUtUc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnBaaUFvYkdWdVozUm9JRDQ5SUd4dmQyVnlRbTkxYm1RZ0ppWWdiR1Z1WjNSb0lEdzlJSFZ3Y0dWeVFtOTFibVFwSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdjbVYwZFhKdUlERXVNRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0I5SUdWc2MyVWdhV1lnS0d4bGJtZDBhQ0E4SURJd0tTQjdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhKbGRIVnliaUF3TGpJN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZTQmxiSE5sSUdsbUlDaHNaVzVuZEdnZ1BDQnNiM2RsY2tKdmRXNWtLU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUc1dmNtMWhiR2w2WldRZ1BTQW9iR1Z1WjNSb0lDMGdNakFwSUM4Z0tHeHZkMlZ5UW05MWJtUWdMU0F5TUNrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSEpsZEhWeWJpQk5ZWFJvTG0xaGVDZ3dMak1zSUUxaGRHZ3ViV2x1S0RBdU9Td2dibTl5YldGc2FYcGxaQ2twT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUgwZ1pXeHpaU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2hzWlc1bmRHZ2dQaUF5TURBcElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUdWNFkyVnpjeUE5SUd4bGJtZDBhQ0F0SUhWd2NHVnlRbTkxYm1RN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0J3Wlc1aGJIUjVJRDBnVFdGMGFDNXRhVzRvTUM0MUxDQmxlR05sYzNNZ0x5QXhNREFwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnY21WMGRYSnVJRTFoZEdndWJXRjRLREF1TkN3Z01TNHdJQzBnY0dWdVlXeDBlU2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIMGdaV3h6WlNCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0J1YjNKdFlXeHBlbVZrSUQwZ0tIVndjR1Z5UW05MWJtUWdLeUExTUNBdElHeGxibWQwYUNrZ0x5QTFNRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSEpsZEhWeWJpQk5ZWFJvTG0xaGVDZ3dMallzSUUxaGRHZ3ViV2x1S0RFdU1Dd2dibTl5YldGc2FYcGxaQ2twT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FnSUNBZ2ZRMEtEUW9nSUNBZ0lDQWdJQ0FnSUNCemFXMXdiR1ZNWlc1bmRHaFhaV2xuYUhRb2JHVnVaM1JvS1NCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2FXWWdLR3hsYm1kMGFDQThJREl3S1NCeVpYUjFjbTRnTUM0eU93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2hzWlc1bmRHZ2dQQ0EwTUNrZ2NtVjBkWEp1SURBdU5Uc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnBaaUFvYkdWdVozUm9JRHdnT0RBcElISmxkSFZ5YmlBd0xqazdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdhV1lnS0d4bGJtZDBhQ0E4SURFeU1Da2djbVYwZFhKdUlEQXVOenNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JwWmlBb2JHVnVaM1JvSUR3Z01qQXdLU0J5WlhSMWNtNGdNQzQxT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhKbGRIVnliaUF3TGpNN0RRb2dJQ0FnSUNBZ0lDQWdJQ0I5RFFvTkNpQWdJQ0FnSUNBZ0lDQWdJR05oYkdOMWJHRjBaVkJ2YzJsMGFXOXVWMlZwWjJoMEtIQnZjMmwwYVc5dUxDQjBiM1JoYkNrZ2V3MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2gwYjNSaGJDQThQU0F4S1NCeVpYUjFjbTRnTUM0MU93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUc1dmNtMWhiR2w2WldRZ1BTQndiM05wZEdsdmJpQXZJSFJ2ZEdGc093MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2h1YjNKdFlXeHBlbVZrSUR3Z01DNHhLU0J5WlhSMWNtNGdNQzQ1T3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdsbUlDaHViM0p0WVd4cGVtVmtJRDRnTUM0NUtTQnlaWFIxY200Z01DNDRPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSEpsZEhWeWJpQk5ZWFJvTG0xaGVDZ3dMaklzSURBdU55QXRJQ2h1YjNKdFlXeHBlbVZrSUNvZ01DNDFLU2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9OQ2lBZ0lDQWdJQ0FnSUNBZ0lHTmhiR04xYkdGMFpVdGxlWGR2Y21SWFpXbG5hSFFvYzJWdWRHVnVZMlVwSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0IzYjNKa2N5QTlJSE5sYm5SbGJtTmxMblJ2VEc5M1pYSkRZWE5sS0NrTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdMbk53YkdsMEtDOWNjeXN2S1EwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQXVabWxzZEdWeUtIZHZjbVFnUFQ0Z2QyOXlaQzVzWlc1bmRHZ2dQaUF6S1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCcFppQW9kMjl5WkhNdWJHVnVaM1JvSUQwOVBTQXdLU0J5WlhSMWNtNGdNQzR4T3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUd4bGRDQjBiM1JoYkZkbGFXZG9kQ0E5SURBN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2JHVjBJR052ZFc1MElEMGdNRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0IzYjNKa2N5NW1iM0pGWVdOb0tIZHZjbVFnUFQ0Z2V3MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JwWmlBb2RHaHBjeTUzYjNKa1YyVnBaMmgwYzF0M2IzSmtYU2tnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnZEc5MFlXeFhaV2xuYUhRZ0t6MGdkR2hwY3k1M2IzSmtWMlZwWjJoMGMxdDNiM0prWFRzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdOdmRXNTBLeXM3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIME5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjlLVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JwWmlBb1kyOTFiblFnUFQwOUlEQXBJSEpsZEhWeWJpQXdMakU3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWTI5dWMzUWdZWFpuVjJWcFoyaDBJRDBnZEc5MFlXeFhaV2xuYUhRZ0x5QmpiM1Z1ZERzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCeVpYUjFjbTRnVFdGMGFDNXRhVzRvTVM0d0xDQmhkbWRYWldsbmFIUWdLaUF5S1RzTkNpQWdJQ0FnSUNBZ0lDQWdJSDBOQ2cwS0lDQWdJQ0FnSUNBZ0lDQWdaWGgwY21GamRFdGxlVkJvY21GelpYTW9iR2x0YVhRZ1BTQXhNQ2tnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdOdmJuTjBJSE4wYjNCWGIzSmtjeUE5SUc1bGR5QlRaWFFvV3lkMGFHbHpKeXdnSjNSb1lYUW5MQ0FuZDJsMGFDY3NJQ2RtY205dEp5d2dKMmhoZG1VbkxDQW5kMlZ5WlNjc0lDZDBhR1Y1Snl3Z0oyRmliM1YwSnl3Z0ozZG9hV05vSnl3Z0ozUm9aWEpsSnl3Z0ozUm9aV2x5Snl3Z0ozZHZkV3hrSnl3Z0oyTnZkV3hrSjEwcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUhkdmNtUnpJRDBnZEdocGN5NTBaWGgwTG5SdlRHOTNaWEpEWVhObEtDa05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnTG5Od2JHbDBLQzljY3lzdktRMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0F1Wm1sc2RHVnlLSGR2Y21RZ1BUNGdkMjl5WkM1c1pXNW5kR2dnUGlBeklDWW1JQ0Z6ZEc5d1YyOXlaSE11YUdGektIZHZjbVFwS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0JtY21WeElEMGdlMzA3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnZDI5eVpITXVabTl5UldGamFDaDNiM0prSUQwK0lIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWm5KbGNWdDNiM0prWFNBOUlDaG1jbVZ4VzNkdmNtUmRJSHg4SURBcElDc2dNVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0I5S1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCeVpYUjFjbTRnVDJKcVpXTjBMbVZ1ZEhKcFpYTW9abkpsY1NrTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdMbk52Y25Rb0tHRXNJR0lwSUQwK0lHSmJNVjBnTFNCaFd6RmRLUTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBdWMyeHBZMlVvTUN3Z2JHbHRhWFFwRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDNXRZWEFvS0Z0M2IzSmtYU2tnUFQ0Z2QyOXlaQ2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9OQ2lBZ0lDQWdJQ0FnSUNBZ0lITmpiM0psUVd4c1UyVnVkR1Z1WTJWektDa2dldzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSEpsZEhWeWJpQjBhR2x6TG5ObGJuUmxibU5sY3k1dFlYQW9LSE5sYm5SbGJtTmxMQ0J3YjNNcElEMCtJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1kyOXVjM1FnYzJOdmNtVWdQU0IwYUdsekxuTmpiM0psVTJWdWRHVnVZMlVvYzJWdWRHVnVZMlVzSUhCdmN5azdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhKbGRIVnliaUI3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0J6Wlc1MFpXNWpaU3dOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSE5qYjNKbExBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2NHOXphWFJwYjI0NklIQnZjeXdOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR3hsYm1kMGFEb2djMlZ1ZEdWdVkyVXViR1Z1WjNSb0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSDA3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnZlNrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0I5RFFvTkNpQWdJQ0FnSUNBZ0lDQWdJSE5qYjNKbFUyVnVkR1Z1WTJVb2MyVnVkR1Z1WTJVc0lIQnZjMmwwYVc5dUtTQjdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdiR1YwSUhOamIzSmxJRDBnTUM0d093MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUhCdmMybDBhVzl1VjJWcFoyaDBJRDBnZEdocGN5NWpZV3hqZFd4aGRHVlFiM05wZEdsdmJsZGxhV2RvZENod2IzTnBkR2x2Yml3Z2RHaHBjeTV6Wlc1MFpXNWpaWE11YkdWdVozUm9LVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0J6WTI5eVpTQXJQU0J3YjNOcGRHbHZibGRsYVdkb2RDQXFJREF1TXpzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0JzWlc1bmRHaFhaV2xuYUhRZ1BTQjBhR2x6TG1OaGJHTjFiR0YwWlV4bGJtZDBhRmRsYVdkb2RDaHpaVzUwWlc1alpTNXNaVzVuZEdncE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lITmpiM0psSUNzOUlHeGxibWQwYUZkbGFXZG9kQ0FxSURBdU1qc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCclpYbDNiM0prVjJWcFoyaDBJRDBnZEdocGN5NWpZV3hqZFd4aGRHVkxaWGwzYjNKa1YyVnBaMmgwS0hObGJuUmxibU5sS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCelkyOXlaU0FyUFNCclpYbDNiM0prVjJWcFoyaDBJQ29nTUM0MU93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lISmxkSFZ5YmlCTllYUm9MbTFwYmlneExqQXNJSE5qYjNKbEtUc05DaUFnSUNBZ0lDQWdJQ0FnSUgwTkNnMEtJQ0FnSUNBZ0lDQWdJQ0FnYldGd1JtRmpkRzl5Vkc5U1lYUnBieWhtWVdOMGIzSXNJRzFwYmtaaFkzUnZjaXdnYldGNFJtRmpkRzl5TENCdGFXNVNZWFJwYnl3Z2JXRjRVbUYwYVc4cElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnBaaUFvWm1GamRHOXlJRHc5SUcxcGJrWmhZM1J2Y2lrZ2NtVjBkWEp1SUcxcGJsSmhkR2x2T3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdsbUlDaG1ZV04wYjNJZ1BqMGdiV0Y0Um1GamRHOXlLU0J5WlhSMWNtNGdiV0Y0VW1GMGFXODdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzNRZ2JtOXliV0ZzYVhwbFpDQTlJQ2htWVdOMGIzSWdMU0J0YVc1R1lXTjBiM0lwSUM4Z0tHMWhlRVpoWTNSdmNpQXRJRzFwYmtaaFkzUnZjaWs3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnY21WMGRYSnVJRzFwYmxKaGRHbHZJQ3NnYm05eWJXRnNhWHBsWkNBcUlDaHRZWGhTWVhScGJ5QXRJRzFwYmxKaGRHbHZLVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIME5DZzBLSUNBZ0lDQWdJQ0FnSUNBZ2MzVnRiV0Z5YVhwbEtHWmhZM1J2Y2lBOUlEQXVNeWtnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdsbUlDaG1ZV04wYjNJZ1BEMGdNQzR3S1NCeVpYUjFjbTRnZEdocGN5NWxlSFJ5WlcxbFEyOXRjSEpsYzNOcGIyNG9LVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JwWmlBb1ptRmpkRzl5SUQ0OUlEQXVPVFVwSUhKbGRIVnliaUIwYUdsekxuUmxlSFE3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWTI5dWMzUWdjMk52Y21Wa0lEMGdkR2hwY3k1elkyOXlaVUZzYkZObGJuUmxibU5sY3lncE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHbG1JQ2htWVdOMGIzSWdQQ0F3TGpFcElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnY21WMGRYSnVJSFJvYVhNdWEyVjVkMjl5WkZOMWJXMWhjbmtvYzJOdmNtVmtMQ0JtWVdOMGIzSXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSDBnWld4elpTQnBaaUFvWm1GamRHOXlJRHdnTUM0MEtTQjdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhKbGRIVnliaUIwYUdsekxtTnZibU5wYzJWVGRXMXRZWEo1S0hOamIzSmxaQ3dnWm1GamRHOXlLVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0I5SUdWc2MyVWdhV1lnS0daaFkzUnZjaUE4SURBdU55a2dldzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCeVpYUjFjbTRnZEdocGN5NWlZV3hoYm1ObFpGTjFiVzFoY25rb2MyTnZjbVZrTENCbVlXTjBiM0lwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUgwZ1pXeHpaU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lISmxkSFZ5YmlCMGFHbHpMbVJsZEdGcGJHVmtVM1Z0YldGeWVTaHpZMjl5WldRc0lHWmhZM1J2Y2lrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQWdJQ0FnZlEwS0RRb2dJQ0FnSUNBZ0lDQWdJQ0JsZUhSeVpXMWxRMjl0Y0hKbGMzTnBiMjRvS1NCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1kyOXVjM1FnYTJWNWQyOXlaSE1nUFNCMGFHbHpMbVY0ZEhKaFkzUkxaWGxRYUhKaGMyVnpLRFVwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdsbUlDaHJaWGwzYjNKa2N5NXNaVzVuZEdnZ1BUMDlJREFwSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdjbVYwZFhKdUlIUm9hWE11YzJWdWRHVnVZMlZ6V3pCZElIeDhJQ2NuT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUgwTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCc1pYUWdjM1Z0YldGeWVTQTlJQ0pEYjNKbElHTnZibU5sY0hSek9pQWlJQ3NnYTJWNWQyOXlaSE11YW05cGJpZ2lMQ0FpS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0IwYjNCVFpXNTBaVzVqWlNBOUlIUm9hWE11Wm1sdVpFMXZjM1JKYlhCdmNuUmhiblJUWlc1MFpXNWpaU2dwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdsbUlDaDBiM0JUWlc1MFpXNWpaU0FtSmlCMGIzQlRaVzUwWlc1alpTNXNaVzVuZEdnZ1BDQXhNREFwSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdjM1Z0YldGeWVTQTlJSFJ2Y0ZObGJuUmxibU5sT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUgwTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCeVpYUjFjbTRnYzNWdGJXRnllVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIME5DZzBLSUNBZ0lDQWdJQ0FnSUNBZ1ptbHVaRTF2YzNSSmJYQnZjblJoYm5SVFpXNTBaVzVqWlNncElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCelkyOXlaV1FnUFNCMGFHbHpMbk5qYjNKbFFXeHNVMlZ1ZEdWdVkyVnpLQ2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnYzJOdmNtVmtMbk52Y25Rb0tHRXNJR0lwSUQwK0lHSXVjMk52Y21VZ0xTQmhMbk5qYjNKbEtUc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnlaWFIxY200Z2MyTnZjbVZrV3pCZFB5NXpaVzUwWlc1alpTQjhmQ0FuSnpzTkNpQWdJQ0FnSUNBZ0lDQWdJSDBOQ2cwS0lDQWdJQ0FnSUNBZ0lDQWdhMlY1ZDI5eVpGTjFiVzFoY25rb2MyTnZjbVZrVTJWdWRHVnVZMlZ6TENCbVlXTjBiM0lwSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCelkyOXlaV1JUWlc1MFpXNWpaWE11YzI5eWRDZ29ZU3dnWWlrZ1BUNGdZaTV6WTI5eVpTQXRJR0V1YzJOdmNtVXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR052Ym5OMElIUmhjbWRsZEV4bGJtZDBhQ0E5SUhSb2FYTXVkR1Y0ZEM1c1pXNW5kR2dnS2lBb1ptRmpkRzl5SUNvZ01DNDFLVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JzWlhRZ2MzVnRiV0Z5ZVNBOUlDY25PdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR3hsZENCamRYSnlaVzUwVEdWdVozUm9JRDBnTURzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCbWIzSWdLR052Ym5OMElHbDBaVzBnYjJZZ2MyTnZjbVZrVTJWdWRHVnVZMlZ6S1NCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR2xtSUNoamRYSnlaVzUwVEdWdVozUm9JRDQ5SUhSaGNtZGxkRXhsYm1kMGFDQW1KaUJ6ZFcxdFlYSjVMbXhsYm1kMGFDQStJRFV3S1NCaWNtVmhhenNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR2xtSUNocGRHVnRMbk5sYm5SbGJtTmxMbXhsYm1kMGFDQThJRE13SUh4OElHbDBaVzB1YzJOdmNtVWdQaUF3TGpjcElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lITjFiVzFoY25rZ0t6MGdhWFJsYlM1elpXNTBaVzVqWlNBcklDY2dKenNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR04xY25KbGJuUk1aVzVuZEdnZ0t6MGdhWFJsYlM1elpXNTBaVzVqWlM1c1pXNW5kR2c3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIME5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdhV1lnS0hOMWJXMWhjbmt1YkdWdVozUm9JRHdnTmpBcElIc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWTI5dWMzUWdhMlY1ZDI5eVpITWdQU0IwYUdsekxtVjRkSEpoWTNSTFpYbFFhSEpoYzJWektETXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCemRXMXRZWEo1SUNzOUlDSkxaWGwzYjNKa2N6b2dJaUFySUd0bGVYZHZjbVJ6TG1wdmFXNG9JaXdnSWlrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lISmxkSFZ5YmlCemRXMXRZWEo1TG5SeWFXMG9LVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIME5DZzBLSUNBZ0lDQWdJQ0FnSUNBZ1kyOXVZMmx6WlZOMWJXMWhjbmtvYzJOdmNtVmtVMlZ1ZEdWdVkyVnpMQ0JtWVdOMGIzSXBJSHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0J6WTI5eVpXUlRaVzUwWlc1alpYTXVjMjl5ZENnb1lTd2dZaWtnUFQ0Z1lpNXpZMjl5WlNBdElHRXVjMk52Y21VcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUhSaGNtZGxkRkpoZEdsdklEMGdkR2hwY3k1dFlYQkdZV04wYjNKVWIxSmhkR2x2S0daaFkzUnZjaXdnTUM0eExDQXdMalFzSURBdU1EVXNJREF1TWpVcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUhSaGNtZGxkRmR2Y21SeklEMGdkR2hwY3k1MFpYaDBMbk53YkdsMEtDOWNjeXN2S1M1c1pXNW5kR2dnS2lCMFlYSm5aWFJTWVhScGJ6c05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCemRXMXRZWEo1VjI5eVpITWdQU0JiWFRzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCc1pYUWdZM1Z5Y21WdWRGZHZjbVJEYjNWdWRDQTlJREE3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWm05eUlDaGpiMjV6ZENCcGRHVnRJRzltSUhOamIzSmxaRk5sYm5SbGJtTmxjeWtnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCM2IzSmtjeUE5SUdsMFpXMHVjMlZ1ZEdWdVkyVXVjM0JzYVhRb0wxeHpLeThwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCM2IzSmtRMjkxYm5RZ1BTQjNiM0prY3k1c1pXNW5kR2c3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JwWmlBb1kzVnljbVZ1ZEZkdmNtUkRiM1Z1ZENBcklIZHZjbVJEYjNWdWRDQThQU0IwWVhKblpYUlhiM0prY3lBcUlERXVNeWtnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnYzNWdGJXRnllVmR2Y21SekxuQjFjMmdvYVhSbGJTNXpaVzUwWlc1alpTazdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpkWEp5Wlc1MFYyOXlaRU52ZFc1MElDczlJSGR2Y21SRGIzVnVkRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2FXWWdLR04xY25KbGJuUlhiM0prUTI5MWJuUWdQajBnZEdGeVoyVjBWMjl5WkhNcElHSnlaV0ZyT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUgwTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCeVpYUjFjbTRnYzNWdGJXRnllVmR2Y21SekxuTnNhV05sS0RBc0lERXdLUzVxYjJsdUtDY2dKeWs3RFFvZ0lDQWdJQ0FnSUNBZ0lDQjlEUW9OQ2lBZ0lDQWdJQ0FnSUNBZ0lHSmhiR0Z1WTJWa1UzVnRiV0Z5ZVNoelkyOXlaV1JUWlc1MFpXNWpaWE1zSUdaaFkzUnZjaWtnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhOamIzSmxaRk5sYm5SbGJtTmxjeTV6YjNKMEtDaGhMQ0JpS1NBOVBpQjdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdOdmJuTjBJSE5qYjNKbFFTQTlJR0V1YzJOdmNtVWdLaUIwYUdsekxtTmhiR04xYkdGMFpVeGxibWQwYUZkbGFXZG9kQ2hoTG14bGJtZDBhQ2s3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUhOamIzSmxRaUE5SUdJdWMyTnZjbVVnS2lCMGFHbHpMbU5oYkdOMWJHRjBaVXhsYm1kMGFGZGxhV2RvZENoaUxteGxibWQwYUNrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSEpsZEhWeWJpQnpZMjl5WlVJZ0xTQnpZMjl5WlVFN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2ZTazdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzNRZ2RHRnlaMlYwVW1GMGFXOGdQU0IwYUdsekxtMWhjRVpoWTNSdmNsUnZVbUYwYVc4b1ptRmpkRzl5TENBd0xqUXNJREF1Tnl3Z01DNHlOU3dnTUM0MEtUc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQmpiMjV6ZENCelpXeGxZM1JsWkNBOUlITmpiM0psWkZObGJuUmxibU5sY3k1emJHbGpaU2dOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ01Dd2dEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUUxaGRHZ3VZMlZwYkNoelkyOXlaV1JUWlc1MFpXNWpaWE11YkdWdVozUm9JQ29nZEdGeVoyVjBVbUYwYVc4Z0tpQXhMalVwRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCelpXeGxZM1JsWkM1emIzSjBLQ2hoTENCaUtTQTlQaUJoTG5CdmMybDBhVzl1SUMwZ1lpNXdiM05wZEdsdmJpazdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdjbVYwZFhKdUlITmxiR1ZqZEdWa0xtMWhjQ2hwZEdWdElEMCtJR2wwWlcwdWMyVnVkR1Z1WTJVcExtcHZhVzRvSnlBbktUc05DaUFnSUNBZ0lDQWdJQ0FnSUgwTkNnMEtJQ0FnSUNBZ0lDQWdJQ0FnWkdWMFlXbHNaV1JUZFcxdFlYSjVLSE5qYjNKbFpGTmxiblJsYm1ObGN5d2dabUZqZEc5eUtTQjdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzNRZ1ptbHNkR1Z5WldRZ1BTQnpZMjl5WldSVFpXNTBaVzVqWlhNdVptbHNkR1Z5S0dsMFpXMGdQVDRnYVhSbGJTNXpZMjl5WlNBK0lEQXVNeWs3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWm1sc2RHVnlaV1F1YzI5eWRDZ29ZU3dnWWlrZ1BUNGdZUzV3YjNOcGRHbHZiaUF0SUdJdWNHOXphWFJwYjI0cE93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHeGxkQ0J5WlhOMWJIUWdQU0JtYVd4MFpYSmxaQzV0WVhBb2FYUmxiU0E5UGlCcGRHVnRMbk5sYm5SbGJtTmxLUzVxYjJsdUtDY2dKeWs3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnYVdZZ0tHWmhZM1J2Y2lBOElEQXVPU0FtSmlCeVpYTjFiSFF1YkdWdVozUm9JRDRnZEdocGN5NTBaWGgwTG14bGJtZDBhQ0FxSURBdU55a2dldzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0IzYjNKa2N5QTlJSEpsYzNWc2RDNXpjR3hwZENndlhITXJMeWs3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUhSaGNtZGxkRmR2Y21SeklEMGdUV0YwYUM1bWJHOXZjaWgzYjNKa2N5NXNaVzVuZEdnZ0tpQW9NQzQySUNzZ0tHWmhZM1J2Y2lBcUlEQXVOQ2twS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdjbVYwZFhKdUlIZHZjbVJ6TG5Oc2FXTmxLREFzSUhSaGNtZGxkRmR2Y21SektTNXFiMmx1S0NjZ0p5azdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdmUTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJSEpsZEhWeWJpQnlaWE4xYkhRN0RRb2dJQ0FnSUNBZ0lDQWdJQ0I5RFFvZ0lDQWdJQ0FnSUgwTkNnMEtJQ0FnSUNBZ0lDQXZMeUJFVDAwZ1JXeGxiV1Z1ZEhNTkNpQWdJQ0FnSUNBZ1kyOXVjM1FnYVc1d2RYUlVaWGgwSUQwZ1pHOWpkVzFsYm5RdVoyVjBSV3hsYldWdWRFSjVTV1FvSjJsdWNIVjBWR1Y0ZENjcE93MEtJQ0FnSUNBZ0lDQmpiMjV6ZENCdmRYUndkWFJVWlhoMElEMGdaRzlqZFcxbGJuUXVaMlYwUld4bGJXVnVkRUo1U1dRb0oyOTFkSEIxZEZSbGVIUW5LVHNOQ2lBZ0lDQWdJQ0FnWTI5dWMzUWdabUZqZEc5eVUyeHBaR1Z5SUQwZ1pHOWpkVzFsYm5RdVoyVjBSV3hsYldWdWRFSjVTV1FvSjJaaFkzUnZjbE5zYVdSbGNpY3BPdzBLSUNBZ0lDQWdJQ0JqYjI1emRDQm1ZV04wYjNKV1lXeDFaU0E5SUdSdlkzVnRaVzUwTG1kbGRFVnNaVzFsYm5SQ2VVbGtLQ2RtWVdOMGIzSldZV3gxWlNjcE93MEtJQ0FnSUNBZ0lDQmpiMjV6ZENCemRXMXRZWEpwZW1WQ2RHNGdQU0JrYjJOMWJXVnVkQzVuWlhSRmJHVnRaVzUwUW5sSlpDZ25jM1Z0YldGeWFYcGxRblJ1SnlrN0RRb2dJQ0FnSUNBZ0lHTnZibk4wSUd4dllXUnBibWRKYm1ScFkyRjBiM0lnUFNCa2IyTjFiV1Z1ZEM1blpYUkZiR1Z0Wlc1MFFubEpaQ2duYkc5aFpHbHVaMGx1WkdsallYUnZjaWNwT3cwS0lDQWdJQ0FnSUNCamIyNXpkQ0J6ZFcxdFlYSjVTVzVtYnlBOUlHUnZZM1Z0Wlc1MExtZGxkRVZzWlcxbGJuUkNlVWxrS0NkemRXMXRZWEo1U1c1bWJ5Y3BPdzBLSUNBZ0lDQWdJQ0JqYjI1emRDQnZjbWxuYVc1aGJFeGxibWQwYUNBOUlHUnZZM1Z0Wlc1MExtZGxkRVZzWlcxbGJuUkNlVWxrS0NkdmNtbG5hVzVoYkV4bGJtZDBhQ2NwT3cwS0lDQWdJQ0FnSUNCamIyNXpkQ0J6ZFcxdFlYSjVUR1Z1WjNSb0lEMGdaRzlqZFcxbGJuUXVaMlYwUld4bGJXVnVkRUo1U1dRb0ozTjFiVzFoY25sTVpXNW5kR2duS1RzTkNpQWdJQ0FnSUNBZ1kyOXVjM1FnY21Wa2RXTjBhVzl1VUdWeVkyVnVkQ0E5SUdSdlkzVnRaVzUwTG1kbGRFVnNaVzFsYm5SQ2VVbGtLQ2R5WldSMVkzUnBiMjVRWlhKalpXNTBKeWs3RFFvZ0lDQWdJQ0FnSUdOdmJuTjBJSE4wWVhSMWMwUnZkQ0E5SUdSdlkzVnRaVzUwTG1kbGRFVnNaVzFsYm5SQ2VVbGtLQ2R6ZEdGMGRYTkViM1FuS1RzTkNpQWdJQ0FnSUNBZ1kyOXVjM1FnYzNSaGRIVnpWR1Y0ZENBOUlHUnZZM1Z0Wlc1MExtZGxkRVZzWlcxbGJuUkNlVWxrS0NkemRHRjBkWE5VWlhoMEp5azdEUW9nSUNBZ0lDQWdJR052Ym5OMElIQnlaWE5sZEVKMWRIUnZibk1nUFNCa2IyTjFiV1Z1ZEM1eGRXVnllVk5sYkdWamRHOXlRV3hzS0NjdWNISmxjMlYwTFdKMWRIUnZiaWNwT3cwS0RRb2dJQ0FnSUNBZ0lDOHZJRlZ3WkdGMFpTQm1ZV04wYjNJZ2RtRnNkV1VnWkdsemNHeGhlUTBLSUNBZ0lDQWdJQ0JtWVdOMGIzSlRiR2xrWlhJdVlXUmtSWFpsYm5STWFYTjBaVzVsY2lnbmFXNXdkWFFuTENBb0tTQTlQaUI3RFFvZ0lDQWdJQ0FnSUNBZ0lDQm1ZV04wYjNKV1lXeDFaUzUwWlhoMFEyOXVkR1Z1ZENBOUlHWmhZM1J2Y2xOc2FXUmxjaTUyWVd4MVpUc05DaUFnSUNBZ0lDQWdJQ0FnSUhWd1pHRjBaVk4wWVhSMWN5Z25VbVZoWkhrZ2RHOGdjM1Z0YldGeWFYcGxKeWs3RFFvZ0lDQWdJQ0FnSUgwcE93MEtEUW9nSUNBZ0lDQWdJQzh2SUVoaGJtUnNaU0J3Y21WelpYUWdZblYwZEc5dWN3MEtJQ0FnSUNBZ0lDQndjbVZ6WlhSQ2RYUjBiMjV6TG1admNrVmhZMmdvWW5WMGRHOXVJRDArSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJR0oxZEhSdmJpNWhaR1JGZG1WdWRFeHBjM1JsYm1WeUtDZGpiR2xqYXljc0lDZ3BJRDArSUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0JtWVdOMGIzSWdQU0J3WVhKelpVWnNiMkYwS0dKMWRIUnZiaTVrWVhSaGMyVjBMbVpoWTNSdmNpazdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdabUZqZEc5eVUyeHBaR1Z5TG5aaGJIVmxJRDBnWm1GamRHOXlPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR1poWTNSdmNsWmhiSFZsTG5SbGVIUkRiMjUwWlc1MElEMGdabUZqZEc5eU93MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lBMEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lIQnlaWE5sZEVKMWRIUnZibk11Wm05eVJXRmphQ2hpZEc0Z1BUNGdZblJ1TG1Oc1lYTnpUR2x6ZEM1eVpXMXZkbVVvSjJGamRHbDJaU2NwS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCaWRYUjBiMjR1WTJ4aGMzTk1hWE4wTG1Ga1pDZ25ZV04wYVhabEp5azdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdkWEJrWVhSbFUzUmhkSFZ6S0dCR1lXTjBiM0lnYzJWMElIUnZJQ1I3Wm1GamRHOXlmV0FwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhObGRGUnBiV1Z2ZFhRb1oyVnVaWEpoZEdWVGRXMXRZWEo1TENBeE1EQXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2ZTazdEUW9nSUNBZ0lDQWdJSDBwT3cwS0RRb2dJQ0FnSUNBZ0lDOHZJRlZ3WkdGMFpTQnpkR0YwZFhNZ2FXNWthV05oZEc5eURRb2dJQ0FnSUNBZ0lHWjFibU4wYVc5dUlIVndaR0YwWlZOMFlYUjFjeWh0WlhOellXZGxMQ0JwYzBGamRHbDJaU0E5SUdaaGJITmxLU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQnpkR0YwZFhOVVpYaDBMblJsZUhSRGIyNTBaVzUwSUQwZ2JXVnpjMkZuWlRzTkNpQWdJQ0FnSUNBZ0lDQWdJSE4wWVhSMWMwUnZkQzVqYkdGemMweHBjM1F1ZEc5bloyeGxLQ2RoWTNScGRtVW5MQ0JwYzBGamRHbDJaU2s3RFFvZ0lDQWdJQ0FnSUgwTkNnMEtJQ0FnSUNBZ0lDQXZMeUJIWlc1bGNtRjBaU0J6ZFcxdFlYSjVEUW9nSUNBZ0lDQWdJR0Z6ZVc1aklHWjFibU4wYVc5dUlHZGxibVZ5WVhSbFUzVnRiV0Z5ZVNncElIc05DaUFnSUNBZ0lDQWdJQ0FnSUdOdmJuTjBJSFJsZUhRZ1BTQnBibkIxZEZSbGVIUXVkbUZzZFdVdWRISnBiU2dwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdhV1lnS0NGMFpYaDBLU0I3RFFvZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnWVd4bGNuUW9KMUJzWldGelpTQmxiblJsY2lCemIyMWxJSFJsZUhRZ2RHOGdjM1Z0YldGeWFYcGxMaWNwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhKbGRIVnlianNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIME5DZzBLSUNBZ0lDQWdJQ0FnSUNBZ1kyOXVjM1FnWm1GamRHOXlJRDBnY0dGeWMyVkdiRzloZENobVlXTjBiM0pUYkdsa1pYSXVkbUZzZFdVcE93MEtJQ0FnSUNBZ0lDQWdJQ0FnRFFvZ0lDQWdJQ0FnSUNBZ0lDQXZMeUJUYUc5M0lHeHZZV1JwYm1jZ2MzUmhkR1VOQ2lBZ0lDQWdJQ0FnSUNBZ0lHeHZZV1JwYm1kSmJtUnBZMkYwYjNJdVkyeGhjM05NYVhOMExtRmtaQ2duZG1semFXSnNaU2NwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdkWEJrWVhSbFUzUmhkSFZ6S0NkUWNtOWpaWE56YVc1bklIUmxlSFF1TGk0bkxDQjBjblZsS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0x5OGdVMmx0ZFd4aGRHVWdjSEp2WTJWemMybHVaeUIwYVcxbElHWnZjaUJpWlhSMFpYSWdWVmdOQ2lBZ0lDQWdJQ0FnSUNBZ0lHRjNZV2wwSUc1bGR5QlFjbTl0YVhObEtISmxjMjlzZG1VZ1BUNGdjMlYwVkdsdFpXOTFkQ2h5WlhOdmJIWmxMQ0F6TURBcEtUc05DaUFnSUNBZ0lDQWdJQ0FnSUEwS0lDQWdJQ0FnSUNBZ0lDQWdkSEo1SUhzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCamIyNXpkQ0J6ZFcxdFlYSnBlbVZ5SUQwZ2JtVjNJRUZrYW5WemRHRmliR1ZUZFcxdFlYSnBlbVZ5S0hSbGVIUXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR052Ym5OMElITjFiVzFoY25rZ1BTQnpkVzF0WVhKcGVtVnlMbk4xYlcxaGNtbDZaU2htWVdOMGIzSXBPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRzkxZEhCMWRGUmxlSFF1ZG1Gc2RXVWdQU0J6ZFcxdFlYSjVPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQzh2SUZWd1pHRjBaU0J6ZEdGMGN3MEtJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ0lHTnZibk4wSUc5eWFXZE1aVzVuZEdnZ1BTQjBaWGgwTG14bGJtZDBhRHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0JqYjI1emRDQnpkVzF0VEdWdVozUm9JRDBnYzNWdGJXRnllUzVzWlc1bmRHZzdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdZMjl1YzNRZ2NtVmtkV04wYVc5dUlEMGdiM0pwWjB4bGJtZDBhQ0ErSURBZ1B5QU5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnVFdGMGFDNXliM1Z1WkNnb01TQXRJSE4xYlcxTVpXNW5kR2dnTHlCdmNtbG5UR1Z1WjNSb0tTQXFJREV3TUNrZ09pQXdPdzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJQTBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJRzl5YVdkcGJtRnNUR1Z1WjNSb0xuUmxlSFJEYjI1MFpXNTBJRDBnYjNKcFoweGxibWQwYUM1MGIweHZZMkZzWlZOMGNtbHVaeWdwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUhOMWJXMWhjbmxNWlc1bmRHZ3VkR1Y0ZEVOdmJuUmxiblFnUFNCemRXMXRUR1Z1WjNSb0xuUnZURzlqWVd4bFUzUnlhVzVuS0NrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2NtVmtkV04wYVc5dVVHVnlZMlZ1ZEM1MFpYaDBRMjl1ZEdWdWRDQTlJR0FrZTNKbFpIVmpkR2x2Ym4wbFlEc05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQU5DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQnpkVzF0WVhKNVNXNW1ieTVqYkdGemMweHBjM1F1WVdSa0tDZDJhWE5wWW14bEp5azdEUW9nSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdkWEJrWVhSbFUzUmhkSFZ6S0NkVGRXMXRZWEo1SUdkbGJtVnlZWFJsWkNCemRXTmpaWE56Wm5Wc2JIa25LVHNOQ2lBZ0lDQWdJQ0FnSUNBZ0lIMGdZMkYwWTJnZ0tHVnljbTl5S1NCN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ1kyOXVjMjlzWlM1bGNuSnZjaWduVTNWdGJXRnlhWHBoZEdsdmJpQmxjbkp2Y2pvbkxDQmxjbkp2Y2lrN0RRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2IzVjBjSFYwVkdWNGRDNTJZV3gxWlNBOUlDZEZjbkp2Y2lCblpXNWxjbUYwYVc1bklITjFiVzFoY25rdUlGQnNaV0Z6WlNCMGNua2dZV2RoYVc0dUp6c05DaUFnSUNBZ0lDQWdJQ0FnSUNBZ0lDQjFjR1JoZEdWVGRHRjBkWE1vSjBWeWNtOXlJRzlqWTNWeWNtVmtKeWs3RFFvZ0lDQWdJQ0FnSUNBZ0lDQjlJR1pwYm1Gc2JIa2dldzBLSUNBZ0lDQWdJQ0FnSUNBZ0lDQWdJR3h2WVdScGJtZEpibVJwWTJGMGIzSXVZMnhoYzNOTWFYTjBMbkpsYlc5MlpTZ25kbWx6YVdKc1pTY3BPdzBLSUNBZ0lDQWdJQ0FnSUNBZ2ZRMEtJQ0FnSUNBZ0lDQjlEUW9OQ2lBZ0lDQWdJQ0FnTHk4Z1UzVnRiV0Z5YVhwbElHSjFkSFJ2YmlCamJHbGphdzBLSUNBZ0lDQWdJQ0J6ZFcxdFlYSnBlbVZDZEc0dVlXUmtSWFpsYm5STWFYTjBaVzVsY2lnblkyeHBZMnNuTENCblpXNWxjbUYwWlZOMWJXMWhjbmtwT3cwS0RRb2dJQ0FnSUNBZ0lDOHZJRWRsYm1WeVlYUmxJSE4xYlcxaGNua2diMjRnUlc1MFpYSWdhMlY1SUhkcGRHZ2dRM1J5YkM5RGJXUU5DaUFnSUNBZ0lDQWdhVzV3ZFhSVVpYaDBMbUZrWkVWMlpXNTBUR2x6ZEdWdVpYSW9KMnRsZVdSdmQyNG5MQ0FvWlNrZ1BUNGdldzBLSUNBZ0lDQWdJQ0FnSUNBZ2FXWWdLQ2hsTG1OMGNteExaWGtnZkh3Z1pTNXRaWFJoUzJWNUtTQW1KaUJsTG10bGVTQTlQVDBnSjBWdWRHVnlKeWtnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdJQ0FnSUdVdWNISmxkbVZ1ZEVSbFptRjFiSFFvS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJQ0FnSUNCblpXNWxjbUYwWlZOMWJXMWhjbmtvS1RzTkNpQWdJQ0FnSUNBZ0lDQWdJSDBOQ2lBZ0lDQWdJQ0FnZlNrN0RRb05DaUFnSUNBZ0lDQWdMeThnUVhWMGJ5MTFjR1JoZEdVZ2MzUmhkSFZ6SUdKaGMyVmtJRzl1SUdsdWNIVjBEUW9nSUNBZ0lDQWdJR2x1Y0hWMFZHVjRkQzVoWkdSRmRtVnVkRXhwYzNSbGJtVnlLQ2RwYm5CMWRDY3NJQ2dwSUQwK0lIc05DaUFnSUNBZ0lDQWdJQ0FnSUdOdmJuTjBJR3hsYm1kMGFDQTlJR2x1Y0hWMFZHVjRkQzUyWVd4MVpTNXNaVzVuZEdnN0RRb2dJQ0FnSUNBZ0lDQWdJQ0IxY0dSaGRHVlRkR0YwZFhNb1lDUjdiR1Z1WjNSb0xuUnZURzlqWVd4bFUzUnlhVzVuS0NsOUlHTm9ZWEpoWTNSbGNuTWdaVzUwWlhKbFpHQXBPdzBLSUNBZ0lDQWdJQ0I5S1RzTkNnMEtJQ0FnSUNBZ0lDQXZMeUJKYm1sMGFXRnNhWHBsSUhkcGRHZ2daWGhoYlhCc1pTQnpkVzF0WVhKNURRb2dJQ0FnSUNBZ0lIZHBibVJ2ZHk1aFpHUkZkbVZ1ZEV4cGMzUmxibVZ5S0NkRVQwMURiMjUwWlc1MFRHOWhaR1ZrSnl3Z0tDa2dQVDRnZXcwS0lDQWdJQ0FnSUNBZ0lDQWdkWEJrWVhSbFUzUmhkSFZ6S0NkU1pXRmtlU2NwT3cwS0lDQWdJQ0FnSUNBZ0lDQWdjSEpsYzJWMFFuVjBkRzl1YzFzeVhTNWpiR0Z6YzB4cGMzUXVZV1JrS0NkaFkzUnBkbVVuS1RzZ0x5OGdVMlZzWldOMElDSkNZV3hoYm1ObFpDSWdjSEpsYzJWMERRb2dJQ0FnSUNBZ0lDQWdJQ0JuWlc1bGNtRjBaVk4xYlcxaGNua29LVHNnTHk4Z1IyVnVaWEpoZEdVZ2FXNXBkR2xoYkNCemRXMXRZWEo1RFFvZ0lDQWdJQ0FnSUgwcE93MEtJQ0FnSUR3dmMyTnlhWEIwUGcwS1BDOWliMlI1UGcwS1BDOW9kRzFzUGc9PSIpOyANCg0KICAgIGlmICghaHRtbFNvdXJjZSkgcmV0dXJuOw0KDQogICAgLy8gMy4gQ3JlYXRlIGEgZHluYW1pYyAicGFnZSIgZnJvbSB0aGUgc291cmNlDQogICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtodG1sU291cmNlXSwgeyB0eXBlOiAndGV4dC9odG1sJyB9KTsNCiAgICBjb25zdCBwcmV2aWV3VXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsNCiAgICANCiAgICAvLyA0LiBPcGVuIGluIGEgbmV3IHdpbmRvdy90YWINCiAgICB3aW5kb3cub3BlbihwcmV2aWV3VXJsLCAnX2JsYW5rJyk7DQp9DQo8L3NjcmlwdD4NCg0KPC9ib2R5Pg0KPC9odG1sPg0K"); 

    if (!htmlSource) return;

    // 3. Create a dynamic "page" from the source
    const blob = new Blob([htmlSource], { type: 'text/html' });
    const previewUrl = URL.createObjectURL(blob);
    
    // 4. Open in a new window/tab
    window.open(previewUrl, '_blank');
}


const constrest=["data:text/html;base64,PGh0bWwgbGFuZz0iZW4iPjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+DQogICAgPHRpdGxlPkNvdXBsZWQgQ1NPUyBTaW11bGF0aW9uIChJbWFnZSBTZWVkZWQpPC90aXRsZT4NCiAgICA8IS0tIExvYWQgVGFpbHdpbmQgQ1NTIC0tPg0KICAgIA0KICAgIDxzdHlsZT4NCiAgICAgICAgLyogQ3VzdG9tIENTUyB0byBtYWtlIHRoZSBtYWluIGNhbnZhcyBmdWxsLXNjcmVlbiBhbmQgaGlkZSBjb250cm9scyAqLw0KICAgICAgICBib2R5IHsNCiAgICAgICAgICAgIGZvbnQtZmFtaWx5OiAnSW50ZXInLCBzYW5zLXNlcmlmOw0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzFmMjkzNzsgLyogRGFyayBiYWNrZ3JvdW5kICovDQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsgLyogUHJldmVudHMgc2Nyb2xsYmFycyAqLw0KICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgICAgIHdpZHRoOiAxMDB2dzsNCiAgICAgICAgICAgIGhlaWdodDogMTAwdmg7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qIE1ha2UgdGhlIG1haW4gYXBwbGljYXRpb24gY29udGFpbmVyIGZ1bGwgc2NyZWVuIGFuZCByZW1vdmUgc3R5bGluZyAqLw0KICAgICAgICAjYXBwLCAuY29udGFpbmVyLWNzb3Mgew0KICAgICAgICAgICAgbWF4LXdpZHRoOiBub25lICFpbXBvcnRhbnQ7DQogICAgICAgICAgICB3aWR0aDogMTAwdnc7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMHZoOw0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsNCiAgICAgICAgICAgIGJveC1zaGFkb3c6IG5vbmU7DQogICAgICAgICAgICAvKiBFbnN1cmUgY2hpbGRyZW4gYXJlIGNlbnRlcmVkIHdpdGhpbiB0aGUgZnVsbCBzY3JlZW4gYXJlYSAqLw0KICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47DQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBIaWRlIGFsbCBjaGlsZCBlbGVtZW50cyBvZiB0aGUgYXBwIGNvbnRhaW5lciBleGNlcHQgdGhlIGNhbnZhcyB2aXN1YWxpemF0aW9uIGFyZWEgKC5jYW52YXMtZ3JvdXApICovDQogICAgICAgICNhcHAgPiA6bm90KC5jYW52YXMtZ3JvdXApIHsNCiAgICAgICAgICAgIGRpc3BsYXk6IG5vbmUgIWltcG9ydGFudDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyogTWFrZSB0aGUgY2FudmFzIGdyb3VwIGFuZCBpdHMgZmlyc3QgY2hpbGQgKHRoZSB2aXNpYmxlIGNhbnZhcyBjb250YWluZXIpIHRha2UgdXAgZnVsbCBzcGFjZSAqLw0KICAgICAgICAuY2FudmFzLWdyb3VwLA0KICAgICAgICAuY2FudmFzLWdyb3VwID4gZGl2OmZpcnN0LWNoaWxkIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsNCiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICBwYWRkaW5nOiAwICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBtYXJnaW46IDAgIWltcG9ydGFudDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyogSGlkZSB0aGUgdGl0bGUgb2YgdGhlIGxlZnQgY2FudmFzLCBhbmQgdGhlIGVudGlyZSByaWdodCBjYW52YXMgYXJlYSAqLw0KICAgICAgICAuY2FudmFzLWdyb3VwID4gZGl2Omxhc3QtY2hpbGQsDQogICAgICAgIC5jYW52YXMtZ3JvdXAgPiBkaXY6Zmlyc3QtY2hpbGQgPiBoMyB7DQogICAgICAgICAgICBkaXNwbGF5OiBub25lICFpbXBvcnRhbnQ7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBTdHlsZSBmb3IgdGhlIHZpc2libGUgY2FudmFzIC0gRk9SQ0VEIDEwMCUgU1RSRVRDSCAqLw0KICAgICAgICAuY2EtY2FudmFzIHsNCiAgICAgICAgICAgIGJvcmRlcjogbm9uZTsNCiAgICAgICAgICAgIC8qIEFsbG93IENTUyB0byBzY2FsZSB0aGUgY2FudmFzIGVsZW1lbnQgdG8gZmlsbCB0aGUgZW50aXJlIHNjcmVlbiAqLw0KICAgICAgICAgICAgd2lkdGg6IDEwMCUgIWltcG9ydGFudDsgDQogICAgICAgICAgICBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsNCiAgICAgICAgICAgIG1heC13aWR0aDogMTAwJSAhaW1wb3J0YW50OyANCiAgICAgICAgICAgIG1heC1oZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsNCiAgICAgICAgICAgIHRvdWNoLWFjdGlvbjogbm9uZTsgDQogICAgICAgIH0NCiAgICA8L3N0eWxlPg0KPC9oZWFkPg0KPGJvZHkgY2xhc3M9InAtMCI+DQoNCiAgICA8ZGl2IGlkPSJhcHAiIGNsYXNzPSJjb250YWluZXItY3NvcyI+DQogICAgICAgIDwhLS0gQ2FudmFzIFZpc3VhbGl6YXRpb24gQXJlYSAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBmbGV4LWNvbCBtZDpmbGV4LXJvdyBjYW52YXMtZ3JvdXAiPg0KICAgICAgICAgICAgPCEtLSBMRUZUIENBTlZBUyAoVmlzaWJsZSkgLS0+DQogICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciB3LWZ1bGwgbWQ6dy0xLzIgcC0yIj4NCiAgICAgICAgICAgICAgICA8aDMgY2xhc3M9InRleHQtbGcgdGV4dC1ncmVlbi00MDAgZm9udC1tZWRpdW0gbWItMiI+QmlvLUFnaW5nIEF1dG9tYXRhIChDU09TKTwvaDM+DQogICAgICAgICAgICAgICAgPGNhbnZhcyBpZD0iY2FDYW52YXMiIGNsYXNzPSJjYS1jYW52YXMgcm91bmRlZC1sZyIgd2lkdGg9IjQwMCIgaGVpZ2h0PSI0MDAiPjwvY2FudmFzPg0KICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICA8IS0tIFJJR0hUIENBTlZBUyAoSGlkZGVuKSAtLT4NCiAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIHctZnVsbCBtZDp3LTEvMiBwLTIiPg0KICAgICAgICAgICAgICAgIDxoMyBjbGFzcz0idGV4dC1sZyB0ZXh0LWJsdWUtNDAwIGZvbnQtbWVkaXVtIG1iLTIiPlJlc291cmNlIENBIChXb2xmcmFtIFJ1bGUgMzApPC9oMz4NCiAgICAgICAgICAgICAgICA8Y2FudmFzIGlkPSJyZXNvdXJjZUNhbnZhcyIgY2xhc3M9ImNhLWNhbnZhcyByb3VuZGVkLWxnIiB3aWR0aD0iMCIgaGVpZ2h0PSIwIj48L2NhbnZhcz4NCiAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICA8L2Rpdj4NCg0KICAgICAgICA8IS0tIENvbnRyb2xzIChIaWRkZW4pIC0tPg0KICAgICAgICA8ZGl2IGNsYXNzPSJoaWRkZW4gZmxleCBmbGV4LXdyYXAganVzdGlmeS1jZW50ZXIgZ2FwLTMiPg0KICAgICAgICAgICAgPCEtLSBIaWRkZW4gSW1hZ2UgVGFnIGZvciBJbml0aWFsaXphdGlvbiAtLT4NCiAgICAgICAgICAgIDxpbWcgaWQ9ImluaXRpYWxJbWFnZSIgc3JjPSJkYXRhOmltYWdlL2pwZWc7YmFzZTY0LC85ai80QUFRU2taSlJnQUJBZ0FBQVFBQkFBRC8vZ0FRVEdGMll6WXhMakU1TGpFd01RRC8yd0JEQUFnTURBNE1EaEFRRUJBUUVCTVNFeFFVRkJNVEV4TVVGQlFWRlJVWkdSa1ZGUlVVRkJVVkdCZ1pHUnNjR3hvYUdSb2NIQjRlSGlRa0lpSXFLaXN6TXo3L3hBQ3NBQUFDQWdNQkFRQUFBQUFBQUFBQUFBQUFBUVlGQndRREFnZ0JBUUFDQXdFQkFBQUFBQUFBQUFBQUFBQUJCUVFEQWdZSEVBQUJCQUFFQkFNRkJnUUZBZ1lDQXdFQkFBTUNFU0V4RWdSaFVVRUZJbkVUQmpLaGdaSFJVckh3UWhSaUkzTEJGZUh4Z2pPU1U3TFNKS0p6UXhaakpUUkVCeEVBQWdJQkF3TUNCQVFHQWdNQkFRRUFBQUVDRVFNRUlSSkJNVkZoRTRFRkluR1J3VUl5b1NNVTBmQ3hVZ2JoOFdKeWdsUC93QUFSQ0FJQUFnQURBU0lBQWhFQUF4RUEvOW9BREFNQkFBSVJBeEVBUHdETmlTRWxKd05DU0VKR2hKQ0FhRWtJQm9TUWdHaEpDQWFFa0lCb1NRZ0doSkNBYUVrSUJvU1FnR2hKQ0FhRWtJQm9TUWdHaEpDQWFFa0lCb1NRZ0doSkNBYUVrSUJvU1FnR2hKQ0FhRWtJQm9TUWdHaEpDQWFFa0lCb1NRZ0doSkNBYUVrSUJvU1FnR2hKQ0FhRWtJQm9TUWhBMGswa0pCQ1NFQTBrSVVBRTBJVWdFSVFnRWhDYWdBaENGSUJDRUlBUWhDQUVJU1FEUWtoUUFRaE5BSkNhU0FFMGswQUpKb1VnU2FTRkFHa2hDQWFFazFJQkNFSUFRaENBRUlRZ0VoTkpRQVFoQ0FhU0UwQWswa0lCb1NRcEEwSkpvQklUU1VBYVNFSUFUU1RVZ0VJUWdCQ0VJUU5KTkpDUVNUU1VBRTBrMUlCQ0VJQVNUU1FBbWhDQUVJUWdCQ0VJQVFoQ0FFSVFnRWhDYWdDVFFoU0FRaENBU0VJVUFhRWtLUU5KQ0ZBQkNFSUFUU1FnR2hDRklCQ0VrQTBKSVVBYUVKS1FDRUlVQUUwa0lBUWhDQWFTYVNrQW1raFFCcElRZ0JDRUlCb1FrcEEwSVFnQkNFSVFOSk5KQ1FTUWhRQVFoQ0FFMGtJQm9RaFNBUWhDQUVJUWdCSk5DZ0FrbWhBSkNFSUFUUWhTQVFoQ0FFazBsQUJDYVNBRUlRZ0JDRUlBUWhOQUNFSVVnRUlRZ0JKTkNBU0UwS0FKTkpOU0JJUWhRQVFoQ0FFMElVZ0VrSVVBRUlRZ0JDRUlBUWhDQUVJUWdHa21oU0FRaENFRFNUU1FrU0VJVUFFSVFnQkNFSUJvU1RVZ0VJUW9JQkM1eW5DRmFwUmplVmtDL0sxUWJqdlczWWxPQWk1T1VDUlFGQWtkQVQ5aTdqR1V0a216WFBKREdybEpMNGtqVFdQWGZhRjdWVGJFSWorTW1VdVB1MEFxWnp1Mi9tZitlVWVRaUl4K1YxZnhXVkhTNUg0WDNaWFQrWVlJOXVVdnN2N21XMExEeDMrK05YdVhoUXdxVmZVWVdmTlgyMjd0M0NWUTlNUFVCK2s2ajVrRzc2MlZNdExPUFdML0FNOVRpSHpMREoxVTE4TC9BTkdRa0ttZjdrenNtWU83eitRWm1oRC9BSkpYeUdrWXJSbDdROXRqRFZKN1RSQTB5aElUcy93a1hoWGk1TEQ0dndXM0plU1RwcUN2ZTFHMGc4NnhDTXk1QWZ5NVNyMG5KMVlpSkEzNHJ3SndLZ3ovQUxYYitRY2hFTlExQ296YkVoS0I0ZW9EZld3WTN5cGI0NE1rdXkvRTRlU0s2bWMwTDVxUGZlNXlrSkhkUEVqK09VUjlJYVF1emUrN3hxOVNEMjZKbGw0NVN1OE1JeUpCdnBoNUxlOUpOZDVSWHhPUGVYaG4wY2hZVzdmN1E5MWIzRVdYMm5kMFpHdlRNQkZ5enkwd0dYSXJNbnFSQUJsVUxGMUl4QkhET3NNc0Zpenh5eHVtYll5VXV4MVFsR1VaaTRrU0hNRUVmVUwwdEpzRWttaEFKQ2FFQUlUU1FBaENGSUJDRWlSRUVrMEFMSjVBSUJvV2t6dTl2dVArSnlMZ3F4S09NU09FaGdhNjRyZEJ0UUFRaENBU0Y2V2h1ZDV0dG1JbmNQTnNpWjB4TXpWbjg5Y2tCdXByd0p4SUJFb2tTeU5pajVIcjhsMFFIbEM5SklBUWtoQUNFMEtRSkNhU2dEUWttcEFJU1FnQkNFS0FDRUlRRFFoQ2tnYVNhU0VpUW1oQUNFSVFBaGVaU2kzRXlrUkdJRmtrMEFPWktqOCs4c0dXaGlNdHhLNjhJSWpmOVJCL0JTazMyUnFsa2hEOTBxSkVtcTE0Ymh6UVdYSVJINmhJYWhJY0pSSUkrU2UzYmd6RWFBNGZVSmtaRWtuTEM5V0k1SlJQTGZzNjgvMk96ZTVaZG5OdU14cmJOU2ljQ1BrZW5Jb2Vka3l5NDRZNnRFVExUQ3laQWZMTlYwKzJOVGVpOUl5Rlk2Y0RadThaRWFzOGMwbVcvU2s0NUNjOXdIWGJJYjBlREhucUdBNmo0THVvK2I3R3JsUHM0Nzc3cHJ0MGRHTmR5OGQwK1hKYXJrYkhRd0dRakUxZ1IvcXJTVDdEOEl1T1JsNndnWlNNVG9KQU5BbXdZbVZZazFqU3ZONTIzWjdkdHlYdXVpVnc5U1IwR3pZQUVjOGlBRDgxREhKdXZ6clNMclFJTnhyQVpnQVo4VmJSYW5YRzBsMTdIbXNpbmhiVTZrNTlPL1gvQUdEcFpOaHVMbDNkeWxBaXV0Z1J6K2FHTnM3dURUY1pUT1dHWG55L3NyZlpkcWMzVXNmNWNRTXpHV0l3OHNjY3VDbVc2RDJ5MkV2MjgyUTVDSXFiMUFTcm1TUUw1YWpTVHpxR3kzZCtleDFoMGNzMXlsOUVmUksyVW0xN0tHeDZtNWxHZ01ZZ21vOFRNa0Q0RlF6dUh0TTYyZlM3ZUcyWVFuTUdZcVpjbytHUTFDdEp6eEJQR2xHdTZQOEFjWlMvOVcvcnZwRjZFb2Y5RGNxSDBVYVhjY2J5YnprcEx3dXhheHh3d3FvUnJ6SjkzOFRlZDNtNGVGT096bU5aY3hOK09WWEx6TkJhUk44VWtMTlVVdXlSRmhkTDNkcHdoSnlRaEVFeWtRQUJtU1RRQVhWNWx6Yk91TXV4ME9OeU1aUlBRajgyT0NuYTZJT1NGNVRYVE9TeWEzYjdVREJwejBoTDNpRFJsOHhqWERyMVUwN2QyVGZkM25GN2RPeWczR01ZaWNzWEpDT1FBUDR6eFVPN2ZzM2Q2L0J1RVNScUdyRURETWdFNGF0TjBPQyttV0dvTU54YmdLakFVRlU2aWF4N1JTdi9BRVplT0hMdjJOTFk5dTIvYjR5RElOenJYS1JzeXI0ZlFLMVFrcWh0dmRtZEdLaXFXeUJDRUlkSE9ia0doYzV4Z09jaUIrS3J0eDNIYjdhTWlTWm1HblZGdXBTaUpaU0l2Q1BGVi9lTzJTN2hGb3dNZFRabDRaWlNFcXZHcjZZZEZqRitBYmRNUFZsSnlRRUhER3pBYWFBaEVnYXBlNkxQWEphbTZNTExtbGovQUUvWjMzTWt0OS8ya3liRXdMd05YWXJBa1pnOE1hVWlZM0RXNWJEalV0VVRZdWlNUm5tb1BHTFRNMm05K3cyNDVLaDZzQWF4d0dvWVdlbUFyZ3A1R0FoR01ZQVJpTUFLd29jcXBSRzNlL2IvQURjMllwVGxmSngreVRUWDNQWU4zbmh3L0RtbWNzTUQwS2FTMm1TUk4rUGUvVUliYzIrZ3hyWEZzRFJLODlEazVFMUhMeFZlYTM5L3MzZDd0LzIvcVJqQ2ZoZTFROGN4aGpHVVRVVHhBSVY4aGRBZyszN0p1TmtKRGFQdHNDUkJGNm5RMzBrWVJNWWpYTHJLVitTbDdUUHBteTQ0NFNBQ1p5d3c2aUlBaVBrRnNwbzNaQWx4TVk2d1RIeFZRbFdJSExWMDhsMlF1U1FYT1VJekZTQWtPUkFJK2hYczlFSURDWGZleGR5ay9GeHFCZmFqR01HdzNRTU91RFVhRUkyY05PSE5TVDJlN3kvTXoyVzhoS005czNNeWRtWlhVRGpGekNnUU90NDBzamxhcnpUY20zWW1OQndTRTlBOFV0UW8rNkxKcnJtdDduY2FhWDNPYUt2WTk3MkhjWkdERDF6KzdNR0VwRG5FSFA1WXFRckZPODdGMjdzdTNjM25wdTdxVFpCZzI0NXBqR3pnVHBFU1JINWxXZmF2YXZiYnVFLzNjbXRwS0pGWE0xSUhsWXV3YzBjTHR4dHBDL0prSkNyVys1YkY0MURkYmVaNUIyRi9pck5hYU9qeW1oQ2dBa21vdDNYdnUzN1JwRHpia3pPL1QwYVNKVldvRzVBeEl2cUtLbEp2WmJrRXBUV1BHdmF2WjdtWHAvdGQzS01vajNZUmN4SThVVENKSnc1NDN5VW5IYzJ4NllreHZJNjRSbkVmdDNKVUpkRG9FdEpIVVNxclV1TGozVkF1MGw2U1hKSWtJUWdCQ0UwQUlRaFNRTkphTzEzak84anFhbGRaeE9FbytZL3ZrdDlTMDR1bXFaRVpSbXJpMDArelFrSnBLRG9GcTdqY043VnFUcmhxTWZxVDBBSFVsYlN4VHV0enUrNVBla1lWcGtRR2gwSXdKSjZrZFRnRnZ4WS9jZmRKTHVZV3B6K3hIczVTbHRGTHo2azYyL2N0cHZ3VzdveUJCYmNGYWgxNEh5QnRhdTgycFlhUDdadVlFaHA5TmpUR2o5NjlKTmRDQmdvQVJCckRCMDhEVFlOL2V3TWovVFE1RlRKanZ6WWhUMFphNHhIL0FCaTR5TjFRczJLR1prY2VpeXBZWGphY0xrdkJXWTlSSFBGeHpPRUpWKzVmNXNjV052M0dPMU8yRFVXb25WNC9VQWxqMEVjYUh4S3ZZdFB2TUNHNE1vVEV3ZGJVc1NJNVNITGxTcTNPNk91YnRwamJhS25HRXJsRWtqVUxONDlBdG51ZS9udFl4ZzNLUHFmcTFEb1I3dzZaNHJSSlRiUzR4WExmcmZ4TXFMeFFqSjg1eVVGeGQxVCsxVWFXMTIyNlozRzRlZm5PVFlqTHhFZytvTklxb2RNdUdLcjl6S0d6OUNVSmJtRVhRWk9OaWVpNDVZQVlSa2VIUmVtZDV1UnQ1U0RzM0p6YzBONVN5RnlJd045QjgxYVJtNXRXSlBiNCtvWmU0MUlSdlY5TVB3QVczZFBmaStsTGF6RnVFa2xIbXR1WEtXL0czMWQ5ZkJUemM3UTlMVTVIYzNYM2lSUTZYcUpYVmpiN0xlT3hpeFBjTnlqaURLcFdCbVFidVA0THBQdUxUUUJkMm0zTXBnRU54aUFZeFBXY2lEaWVrYTh5cktPOWJZbkdVTmxvaTVYODBhUm5uZ0JacmtNd3UvcVMyVS9UNmxYeE9ZcUU1ZlU4YjNWMWprcGVtOTdFb2JpWVFqRXlsT2g3MHN6eEs4UE10N2h1YlRrUk9FeFVnZW9YWUcwMVdub095b3htNTdHc09Pem1kektFU2NJUWFoRUFjcy9qU2hmZlBaMmZhb2V1MjU2ckdvUk9yQnlNanpyQWppSzhsbjlWWGMyQnVkbHVXalhpYW5WalZSQXNHdVk2TExocU1rWkszYThHcVdPTDZVZkxhNlFqcmxHTnhqWkF1UnFJdnFUMEE2bGN3bXZRbGFaejltZXh2YkdjM24vMnprWnhnV2pDUWQweUYrS010TkN3YXNGYi90TDJSenVVWU9iYzdkb3dNcFBTbjRET2dCRzVpSndpTHo1cnA3TzdpTEVJN0FTMjhtMjJveWc2MiszTXVPUzhUZ01BZFFxUk5ZWkJXWGU5ODIyMk50SXRhTndIR241eWVoQXNRTUQ0dEpPb3lzaW9nTHowcHk5Mit0OTYvSXNWRmNENXdmYUxEczJqS0V6Q1JpWlFPcUJJKzdMQ3d1Q0pSMFNsR3hMU1NMR0lOSE1Ia1ZzczdkMStXbHVPcVZXQjFQbHpQRE05RmYzU1YvaVZ6TDdzN0FjZDFTY2RaTnhFWElSa1FKWGZpT1ZkQUx1OGFYME50bVF3ekJzYXFqWUdvMmN6bWV2bm1zYWV6WGFYb2d2dWtSYWxYZ3NFVE1UbVJpUENjam1DTUZsWlVPcG55bjVNL0RGcFd4SkpwTENNb0VJUXBBS05UN1NKOXhodTlZRVI0akN2MTFWaWlNT3VQVlNWTlExWnhLS2xWNzA3T1JhaElnbU1TWTR4SkFKQjVqa3V1U1F1c1FBZUdJK1J3VFE3QkpDRklCQ0VJUUYwb1Z1ZmFOaU12VDIwSmJtZDBDTUlIK25NeXg1QldYZlgvUjJEdUpCY3BzRUEvcXp4R1dGNGxSLzJaMllFWE56SVkzb2JQRDlVaDg4UHF0RW0rU2l2eExuVFljU3daTlJsVGtvdFJqQzY1U2ZsOTZOOXJhZHozenJUMjZkL2JRaElTaXkzWVB6bzljalpPSFJUWmVWVmIvZk43Q0RjNTBCTndReDFaVlpQaEJPQTRMWlhIODJZTXB5MUVveFVVcTJqR0sveHN0VjVzR3hlUG5pcTBiNW1aYUVKMzY4WkZ1VkhTVEhPSlBTWDhKb2xWbmVlNXU5dTI4bm1XQnVaTmtlb05WZW5FL3FrQmNpUExMcXUwcitKaXZidjBGM252bTM3TzJKVEVuSEplNDNIQytKbGxFZlU4RmlEZGUxdmNkdzdHYmVsaUVDU0c0MmJzVjR6WTFjeGtMVkwzWHYyNTd1SWg2RE1ZeHhqb2lianp4TWpaUE92SlJxT0pWbGl3cGZ1VnMwU2sraGJQYjdkYmlCYmRmY2RocTFhWnlNNmx6QmxadXNGWG9vaE1CV1Npbzl0akd0czZEQmZSZnM3TGN3MlRiTzYweGNBMU53TTdkTEp5TTQ0bU9PQTRacjU4MjdrR1hCT1RZZHJLTXBTaUw2RzRrU3dQSWhiNDdwdll1VGNnOU9FcGlqcE5BQ3FxSS9UUXlyRll1WEhMSnNxVmRXYkl5VVQ2bFd1NjgwelhxT1FiMVphNUNOK1ZrV3ZsMkhjZDYzTFZEZGJpSnFyRHMrWk9PT09KT2EyZDEzYmZiNXIwdHk5NjBiRWhxaEN3UjFCRVFSOVZpZjBrdktObnVvK200T3R1ZTVPRTYrN0lTL0FsYUc2Mk8yM2QrczNHZUZZZ0VWbmtRUVNNYU5XT2krYU5sdTNlMzdpRDdKR3FCeU9VaDFqS3VoQytoRys5N1dmYi8zM2lNSWlQcXdiR3ViVWptQ01EUVBYbGl0V1RETEUxdmQ5VWR4bXBlaDVqc2gyeHVFdTE3UmlRbWJkMVRrSlNicXdZek9vM2ZTamFrREw0ZGlDYWpMckhVSkVjRFdOOENBVkN2OEE4dTdZWUdZTDJyN25wa1MrdDZmaXNLYjR0bmR1elljTGtKeTlRU0kwU3VXSkVnQkh4QTlSZ3BoaGxONzNIMWFZbE5SN2JuMVNDQ212bC9iOTQzK3pZbXp0M1MxR1VoSWtBR1F3cndrM1Y5YUZxNzJIdFIzSGJ2UTlkK1Q3T29heE9JbExUMU1TS05nWWpHbEwwczFmV3Y0a0xJajZGU1dPNWUyWGJRRFVOekk5Qm9pTFBucndYUFkrMk8xM0wwV25tWjdmV1JHTXpJVGhaeTFHb21JdnJSV2oyc25maXpaeWo1TWtLUHo3YTdQZngzUTN1NWkyQmp0aEkra1pBVU91QTZrVmllcWtDMWR4NmZwL3pHeTVFRVNxTUM0UVJpRHBpQ2NPbUMxSFJ0b1VBM0h0aDIxZ21JanVYSkRBeDlJd3J6OVRTUjlGN1k5cisxTysrWG1UeW0yU0I4NGFsdDl1ZmZpNit4enlYa2dzZHpOdHlNMnBTaEtPUkJvL1BuZjBVejJYdEZMRWJrYXNCcGszRURIbElYbWVlU3g2RnNRd28rUlhvSjRvNVAzTDQ5VHhtUExQQit5VFhwMC9BeUM1N1F6bytudHdNTURPZC9BREhCYWg3L3VhUGdhdXp6eTZBZmJqOGxEOVVwSGt2ZHJWL1RZbCtrbDZ6VWYvQU9uNFVaQ2I3ODE0dlZqT3pJYVlSRmtRck1uQUhHK09Ldmh1TnVXWjdoc3hNYU1pWVJ1WFBFQVhmQXJFUE5iRER6ckpJZzlOb0UyVEM4YTRET2xwbnBZL3BkZW5rM1kvbVdSYlpFcEt0blN0UHlkREZpUlA4NXdEUHhOeEg0T1VxcVJ3TVFhdlB5eVV0bHROcHVLa2Q4ekhVQnE4QkVwUys4WTJOTi9pdEl0N0xiN2d3a0pPUkJNWnpNc2M2dU1SR2hYOVJLM3FhLzhBcHZ4WC9veGZhZDIvYlNicTc3MzhXYlBZM1lON3EzSmFkVVpBRTVhc015VGhobHpXUk4xdG05MURRNE1BUWNNOFB0Q2pHMDJYYjJpWnkzRFU4YmhjZ05JNVNqZEU1Wml3dmIyNkQyNWxPTDBmUllFWm1ReXUvRUJoallQRTRLdXkvd0F6SnlqeVZMdy80RjNnL2tZZUdUZytVdXlhN1B2eTlDdjdmdmRlK2JhYnB0Z2E0eGJHWndKMUhxWkU0bkZiSGY0T1RrMFlrQ0VCMUg2aWN4ek5kTStxb0d0eUd0ek42QUVJNmk1V0Z5RjNwR0hYS3VSS21UZmM0VDJjbjNSQ0V2RkdNU1Jwbk1EcGZUbitLN2xGd25HU2owUytML00xWThrYzJQSmljOTdiVHJhbCtSanQxMHZ1NnBFWFZIbGdQZW80cmpybVFJR1VqRUhJa2tBOHdMd0ttblpHdjNEYnZxNkp3dWhEQWp4WTZoaFk1THQzVFpNUmhIM1c1ZUdERUlpNVM1bVp6SS9CWkh2UlUrRmZtWWIwMDNqOTFTNy9BQTZtanNPOXliTVduL0hIcFA4QVVQUHBoOGxrRnR5RHNSS0VoS0p5TVRZV0VIV3BRbEtNc0pRTkdQRzhiV1R1eWFSdFJUc25DY1pDV2NEOTJyT0hKWXVweFJqOVNMRFE2aWMzN2N0NlhkdmRWMEpJdExkUmxQYnZSaktNQ1lTR3FYdXhGWWs4S1c2dFBkTS91R0hHdFJqcmlZNmhtT0tyMFhqUG5EZTdCcmJ0TnVzUHgzRUNTM01qOUxndklFQTZaRDNjT2lvMWtEMmdsdFcyV0dHblliaDRTbjY3b0ZYb3JUSE1qRFVjYkp3eFVDWG84TW5LQ2JLdHJjOGVTOVNKbkl5a1RLUnpKeEo4eWNWNlhQTmJ0dkJ5TUFxVmJmYXZNTmpkRmd5YmlZMko2b1dNeElTRkdOSDlRVkt4c2QwK1I2VzNlY3ZMUzNNajYxU3k1MmpzM2NMOVRldlNhZ1JYb1FrQ1pmOEF5azZnUHFaY1FzVE5OUlhlUDJ2ZC9nYkl4Y25Tc25QYjN2M0cwWmQwNkRPSUpqeVBYSEMvUHFySmMyMjROUWpDRVJHTVFBSWpBQURvRjBWQSs1Wm84azFYSEFKcHBLQ1FRaENrQWhDMWR4dUc5dERXNGFHUW9FbVI1UkF4SlFnMjFydVBzdGY4amtJZjFTQS9FOHJXSis0KzFXNHVUZTFiOUxUS3RVaURMd241akVWWXJCUVRjYjUxNHptU1RPZCtNa3lsUXp6Vy93QmpJNnFKazQ0NHQvY3ljVlYvU3VUKzNnK21JempNWEdVWkRtQ0QrQzlyNXY3WjdRUDl2Y0FpMkhSUkVyTlZlV0kvdVZrN2ErMXUxY09sNXViUkZXWStNRHpHQi9GWTB2b2RTMko5cjNKVmlmdWVuYVh3ai9ZeUNoYU8yM3UyM2tkVERzSEIxbytJZWNUNGg4d3ZiMjZZMjVqNnpzR3RWNmRjdElOWjRuQlRacDRTVDR1THZ4VHNqbmZ0bHV0NDFBTVN1TVNUSm9HalBrZU5kQmd0ZnNHNk1HanRIb1RibTFxSU1veWlERzdJSklBQmlUMTZLVXVQZWxjNWx1TElpRHJNNk4rVlZWWkc3NEtQejlvTmdJVE91VXFKQWpwSk1oV1k2QUgrS2xxYVVaY3JyNzlTMHh5elpkTzhDd3VjVkpOU2luY1pQeld6SmFzZWUxSHFTRzN1SDh1TWo0cnU1RVpFVmhRQnJtcVBkZDdrQkNleW00eklnNjJqNG1nZWxDV0hucEFDcUcvYUZ6dUEvYTl5WmJrUWRVWnRuMHBDWTVaeHVqaGVCR0M0Y2xrakpJeThPbHk2TFBneTVJN1NrMVRWTmRPdTE5VnZ1ZFo3cDF6WWpic0FRTzFuKzhsTEV6bkdFckpoZVVteVFTQWZGSDVxRGJuZk95bkp5RzUzUk1uRFBST1V2QktXSngxVWFsZ1BDTEdhdi8zN1d5M1VTZFpvVGhNQ1BpTGJrREhxUUx4QnJMQlUyNzdlMjBOdVl2VG4rNWFEcmNwd2pDTWlaR0pnYW5JeGtDTThZNDVoV0dtL1l1YXA5TnU1Vi9NOGNJNnpMd2x5VGR1dWphM1g0bFp1Q0h3SHREYlpQaG5HQW9TbDk4UkdBdjhBVUJRdkdzVnJ3amhkOEZyV1JndHVHUVZ2ajdsSlBzZWw2elNUV1V6SFBLZEhrdllDWktFV2NrMTZYb1VPbGxTU2Mxc05QdU1rbHVjb2FnWXlvNFNCekVoa1J3SzR5T0pYbFJWZ0UxcXVHVURxR1hWZFl6RThsclVsYlhVN3JhejJoZWtMY2NIbE5OSktJTnllNzNMb0FtKzlQU0tGdVRORGw3eUdOMXVkdE1UWmVjYmtPb2tmajBQa2JDMDBMVTRSOEw4RHROK1RkM084ZTNjNU9QeTlTY2paSkFGbWdPZ0ZZQVlCVjY5SUNtcTdDeWRBZEY2OTNpdGlPYTZTQTVMYWVUY3ZRNGlScGRPU1lGNUwzcCtTR3B5UFM4cmEyKzNsdVhBM0VnWG5JNUQvQUZPQzVnRUUzZ1FTRDVoUmZUcWErTHJsMGZVNXA1NG40cHBaK1M2TlMyQ2htaVZuQ3pRTmdlWUFQNEwzMHhXeHQ5dTV1WEEyM1ZtODdyRG1RRDhWeTJrcmUxSFVWS1RVWTIyK2hyQ0dvY3plWFg1SzIvWWJsNHNzT1RnMmF1RUp5QU9pUnN5cm5mNmZld1VuMi9ZV29BRjZjcHl1eUk0UXJsbHFXcnVPM3ZPN3A1NXlVWVIxRFE1TG9CN3VrY3hWQllFdFJHVDJhMlQzYS8waTdocE11SktVb3liazB1TVgwN3ZsNDlDU2JEWU5iQnN3aFpNcU15ZjFTQXF3T25rdk84a3h0b3ozYzJ4T2NJMERtZUFHTkN6MXBkcEI3OXZLRXRSbnAwNjRWcU5pdFlCSUFQQy9KUmwvc01mVG5LRGprM2FKRjBJbnJwSS9ESE5Wa2FsSnVjdXY0bm9NbktNRkhIaVRWWHUxOUwrM1ZrTG0rNC9OeCtkYXJ1Unl4SndvY0F0eWNkMTIyYlV4L0xsT0lJMG03L2dOZkxud1ZYRnZWUFRoZlFIbjkzZ1QwNDRMSlBhSzNESURzTlIyOHFibE1ZakRqMWpsenFsYVpaZTNIc212QjUzVFkvZHlQZVNrOTFKZEd1L3hKQnRwT3phZ1hvaUV5UEZFR3gvZGF2Y3RZMlc1TFpJa0dwMFJpUmgwQ3Rsd2VhaTgzTnVXTVp4bEUrVWhSVkplOW5zSzJQbEtVcGsxSy9EZ0J5NGNsNXRkWDJpeTg2MlFRVzV5aFJ6OEpyZ3RmSHBueVhwMTJLcDl6WWFhY2ZscGJoS2NqMGlDVFF6d0FLblBZL1p6Y2JqY1JjM2JNMjJJZUlpWU1TNFJsRVJOR3Z2Y01Ga3JzUGFXKzI3YU1qSCtlNUVTbklqRVhqb0Y0aXV2RlMxVkdUVXZkUjdlVE1oaDdOZ01BQjBIVG90VGNibHJhdGx4MldtUHhKNUFkU3RwVm5jTnVOenQ1dzBpVWhqQVZBK0lERDN3UVB4VmNaTHRMWUo5eDJiYmZxVDNEVVk2VExHUXNnWVlSek9QSUZMYTl5MnU5bktERG1zeEFsZ01KUklHTVQxckk5UWNDc0VPOWg3a1g1UWRZZGtaRWFTUEVENXlCTVJRb1lrTEkvWVBaNTd0N3Y3amNPVk1BaURjRFlBT2VzNUh5SFhxdDhvUVMvZGI2SFZUNHFYMDArbDcvZ1pHWGxOQ3h3SkNFSUFVTjlvTzR0N05rTjRsMXlKRWRPY0FjNWNDY2g5VklONXZtTmxFbHlXTldJRDNwZVFXRWQvdlo3M2NUZGtLdkFWMEF3QVBQalN5SVJwUEpMOXNWZjM5RWNSVXMrWEhwOGYxVHlPdHYweDZ5Zm9pajA2ck5VcXQxdWNYZ1d4STVHZ1BsYXY0d015SXhCa1NjQU1TVmxQY3gyL2IrMnhhazIyWEpOeGprQlBVUGVrU01iaVRoeHdXQmd6NWNtV1UrKzNiZjRmZ2UzK1pZTkxvOUxod05VbkpmVnR5cGQ1UDcyWU05RTZnUkl3TjBUajRoOGxJTzM5c2x1SjAwN0V1NGtOeThPb1ZqcGtiRjhDYldsdWg2YzlWWUhJY1F0M2JQbU1vT3RueFFsR1E0RUc4UXR1cW0zeG5XejJsOXpFME9qeHJKbWhhZWJHMUxESnZaeHJiYTl5UlE3WjNQYnV3TUdYSVR2Q2NTS0grOEdxNTJyL3VYY2R0dUdmMjd4RTMyZE1vdWFCSnFib0ZFVjkwNUhvVnpkOW9KU2IxdHlrMjVoYk00aHhxUTYwY0NQemdvRVpBbXdLdkd2czRLdmMxRDlydS9QUXU4ZURMckpLV3Bnc1R4OXVHemI5YnZiN0ZydjhBdURuY0pORnlNWW1FZE5RTXRCNGdTeStscXFTSWxoZ3VrQUNSZVN4cFNjdTU2RERqeDZlSEdDcUs2STVyVmQyOFhmZUdLc25taTFPanlzWWdtdU5mZ3RkRTNCMnRtYlpSeDZpRlNTbkdYUmtkZDJqa2NRZFZjODZYbmU3MDdtRzFiMDZSdG1QU0dPWjFHUmxrRGpmVzFmemxHQXVScisva29nOE1iNTJ2UmFXYzgwVzVmb3FuOXo1dDg0MG1uMG1TSHRTM25kd3U2cnMvTlAxT1YydHBzNEVMVEMzSUNncmJIZkxZOHBQc2QxdE5OU25JUmlES1JJQWlCWkpQUmErb3JKM3NadFk3bmRPdnpvL3RvalQvQUZ1V05YeUFQeldYT1hDTGw0TU9uSnBMcWR2OEkySFk5cEhjOXpqKzRmbmczdFJLbzZ1VWlNNi9VZmRHUUJVSjNIZFhueVJCcmJNdzZOTjdkb1JBODVRTWo4eXBKN1l2eWM3cDZaUGhaYWdJampMeFNQbWNQb3NmMnNiRkhuSG5KdHQ5dkNYb2pkT292aXVnNXkxZnBBOHNCOU12cGd1U3RObnQzTnkrM0J0bWI1MUFsdUlPTVFjY3ZkSEhvc2g5MjltSWJIWlBQTWVxL0xWQ2dZaTJXODVTT24zajBNcXF1aTJTeVJnMUY5MmN4VGtZb1RTUXNnNEJjdlRBTmpCZFVLR2srNTBtQVRTUXVqV3owa2hlbERKUEtDdlp4VmxzKzE3enVHczdka3VDSHZTc0FEa0xPWlBJTFcybDMyTzBpblFDcFhIc1c2WjN1MDIrNmdJL3VKWkNRUGdpZkhaR1ZSVWQzVFVHdHc2MjNNT1FqT1VZekdVZ0RtTVRndUZPTXV6dlk3cWllZ1ZqbGd1cFhkMXFiQjBUQkI0NTQ1V09pMTZwYms3UEZ5Vk9uMEZITmJqVUpPT1FpMkJySjhJd3F4amplSDFXcFZHMGZCUzl6bnFTM2U3dDlpUllhUHBDRkNSakVBeWtZZ3lJTllDOHFYTXpjMzJ6Y3hoRnlFcmxQUUJKMkFpVHBzRDNoVm5tQXZMY3R2dnBOd1BxTnlqRVExeTBrT0NJNmdId2tSd0JzNVlyaS91OXIrMkxETVhvRVMxQ2R4R3VYdTFNREhTWTlGZ1ZTU1VYeXRXNjllNWNYdkp1YWVOeGFTdnZ0MlhocnlVT1NWcm5Sa21GbmxQUnR0TnllY2cxSE9VaEVmTlpjMnUwYTJqWWcyUDZwZFpIbWZ6Z3NQc1B6MnpzWFlVWlF4eEY4Rm1YYnVldXkyNVZhNFJsOVFxdldPWDAvd0RIL2JQUS9LNFk3bSs4MS9vMkY0TVl5SUpBTlpYMFh0SlZKNlVqSGVYWk1NWEJ5Y1pPVGpWU3FoRUc2cmptb2Z0dTU3bmJ1Q1JuSnlKUGloSW1qOHpkSGlyajJnOVRXeVRLNEVTMHg1U0ZYOVZERDE0cTV3WTR2SHVrN3M4bHJNMDQ2aDhYS1BHcTNlL3FaUWp0dGozSm91Qmt3MUc5V25UTFZ6RlpqNEZYclFFWTZSTFhwTkVuT3htRHhVRDIvZW05dnRJdFJoTDFvUjBqN3VHVXJ1LzlxMmV3Ynd6azR6TWttUkxrU2VwL1VQN3JEbmlueGs5NlQyVExuRnFNVG5DSzR1VTQvVTBxMzhmZnVUbEpOSllKYW1JKy9lejI0M085OWZiUkJnOE5UcEpvUWxFWXlQVTZoamdMdTFRZXkyeEc1Myt1Y0JLREVkWnU4SmZvcmplUGtGbnRhN2JETEptVzI0UUxoMVRNUUJxUE1yTldvbHdjSHZ0U1pqKzJ1WEkyVWtJV0daQUlRaEFDYVNFQUpSc0FXYk5ZbkpOYVQrN1oyME5Ua3E4V2dBQW1SbWYweEF4SjhrSU41VnUvZm50ZHE4NjNIWE9FZkRIUEVtc3V0WGEzNngxVlJJQS92UzFkM0F1N2QyRWNUS0VxRjFqV0dQVEZRZEl3aTg2NC9NdU9TMVRsN3hOWW5oeUhCVkV4NDVESE1lUXRUYnQzYVh0MjVUa0pOUWpoS1JpUWVYaHVpVGFpZnBPYlovY05tUGlqT1VhT1JJeXdCd0dTc05iS0VzWHR4OHg3ZGthZit2ckxENWg3c3JxcHJmdkw3R1EvWm5iTmh0MTR4QmQxYVFUaVl4MDlPVm03OGxSZDVoTDk4OENjeUNNU1JSaVBEeXo2SzA5bTJOemN0ek4wd1pscGdCUUdvNnNzcXE2RjhhQ3RmYUJwaGtSM1pZbTlPSkFrSXpNSWlJL1ZNQy9KWXVua3RPOS9GZlNaZnpXRS9tT1dYdHQyNVdsTjF4cGZ0OGJHTDM0UWNnWXk1VU1GVHM3ZVRVcjFYamxqaUsraWt6MitiZWhLSDdObHI3c29HV3FOY3lUNHVTcUZnYXJVODVOUlZSZmM5ZDhsK1hlM2h4eXp0NU1rSDlNdWV5ajBTcDlsNml0THF2SnZvckx0c0lTZi9tbkRTVDRqaFk2WS9XbFZ1WENNcGVGZEhwczdYZHJJK0t2NmRrL3ZSckJ0eVFzUW1lT2sxOEF0SXV3QnJVTUZsdUlvZzMra2ZuT3NlbEtCOSsyek1ORW9pbkpnKzdITWc0M1h5dFlXazFVYytkWTV4Y2VYWnhwL2paVXY1amtjWHh4d3RKdW0zMCszVW9mVmhWbVErcXJaN3c0aU1mbWZzV3JGcVRrcTRZcm5JU2dURTlGN25Gb05QSEk0eWs1eVM1Y1h0dDhPNTV6VmZPZGRrd0tjSVJ3NDNKdzVSM2JmM2ZiNEhuVVpZazJlYTFuY3ZtdGhGV3JyaXVQRkpKZWg0MXpjcGNwTnQrWDNab3dqWlc2bndYcXJ4WEVJOFJKMkdheXA3RTdpRFc2M0czT0JlYmpLSEV0azJQOEFwbGZ5V0tWdk1icHphdXR2TkhUTnVRbEU4aVA3SElqcUV5UjV3bEh5Y1JmR1Naa2IyMTJVMjkwM3V3Q1lPeERjanluRElIempsNUZZdVgwVnNPODl1OW9kc2R2dUEzRnljYWMyOHpWbjd6Uk5YekZlSUtINzcySmZqSXkyVHNISUhLRHAwVEhEVUFZeStkTEN3NTFCY01uMHRlVGZPRGsrVWQ3TVdRZGNaeGJuT0J5SmpJeFB3SVY1dSsrYnpkUTI4QTg5QU10QnNtTGtnWEpkWnlvaXlSUXg1TGUzSHM3dXRsRDFONjd0dHJEaTVybkxoQnVBSmtmb09aVVFjMGFqb3ZUMDFWWjRtc0FlSFJaYTRaSGFwMTE2R2o2bzlLT2FFSVdTY0RYbE5DNG82RWhOSkFld3J3ZGs3bktFSEJzM3pHZGFTSTUzbGhkajVnS1ZleW5hbTk0NDd1SDRhMjJpSXdCdWk1NzFubnBGWVpZNHJPYXI4Mm85dVZKSitUZkRGeVZzK2RvZXpQY3l3NjlKclFXOG1qaTQ1ejBpTjVmSG9zcSt6V3hlMk94MFBOK25PVGhtUmVPSUZDUTZFQWNWTTBLdnlaNVpGVHJ1WkVjYWk3SVY3VHZ4MnZiWFpWSDFIUDVNSkVBa2VwNytrOVBBRDhGanpzSFlJZHhZZGZlSkF4Z3pSeW1NNWtkUU1xT2VLOWUyRzhjYzN3MnhGUVlnSlJ6eExrUlpQUThnYTVyVzltTzd4Mkc0bTA1R1VvdjZRTk5XSmpJbXlCaURYMFdSQ01vNGJqM2J2NEhFcWN0K3hrZnUrMW5JUGJpUUdFNGFaZGRHbXFBNlVhelVJV1h0NldodDNQVk5RSXFSb21yNm11aXhFUmp6R09PVnJKMHMzS05QcDJQTS9NY0t4NUUxK3BOdnpkaUtWTDBFclZnVXdyckJCQ2RMMW1nczRBSjFhOWFmcXZRQ2c2YlhRTWwwZzg1R1VaQnh3R1B1bXpoNVk1Y01sNEs2L3QzREQxTk9BeHUvaW9kZFJCeTZYOEwySnp0ZStObUlEOFpDWDNvNGcvSzdIeFY5dkhvTnM2cE9lbEc0M0tzVGplbVBFL2tMRTBEVW8zOTRYNVdwL3dCOGNpZGxYM3B3MFZqZlVuNktxellZeHlRNDJ1VDNQU2FYVjVKNHN6bTAvYmlxNlg5eUo5eTdoKytuRXhpWXdoZW5LemVaUDBHSFJVV1gxWFJlUUwvUHpWcEdLZ3FYWW9aNVhsazV5ZHRoMEtzKzNiaU8xM1VKempjY1FlcGpmVUFjbFhIREJPRXBpUU1aU2lUZUl3TmZMRlJKY2sxNVIxam53a3BMbzdNMU5QTnZDMjVpUTYxMDRFWmcrYTdyRlhhWDVNN3RzQ1U2Y2xVaGZ2WGtaWGhoekdLeXF2UDVjZnRTcTdQWmFmT3RSRGxWTk9tSkpOSmFETUJDRUlBUWhOQUNFSktRTlkwOW96b20wNjI1RVNabEVhUlB4UU1ySUlqME9HUFZTdnZMczJ0cExRNEc1U0lIVzVDamNZMWtUejZLSGJKcHFleDNEcitJYW55QmxJU2lQRFp4cXpoam10Mko4WktWWHYyKzVnWmNrWjVGZ2YwM0Z5NXZ0R3Z0dVR2dHJrWE5vMFl1bDdEeFROMlpkUVFjUlJ5dm9yUlltN0QzRWJSMHN6SjlKenFiT21YUW56eVdUOXp1Vzlxeko2ZDZZL2R4SnZvQjFLN3o0M2puWFI3bzI0TWluRC84N1A0ZGQraFVkejNEalJhRVNSRWttWUg2b3hJd0o4dVNodmUrM3ZiL0FITVh0bUNaVFpBbWIwRGdjUU1kTkJldDUzU2U5TWFnV05OMTQ3T05ZbkNyd1hyYTl5ZlovVUhNZjFSaVBwcHJMb3RmR1M2TDRtS3RWaWhPY3ZlbGRxa2s5dHQ2bDBKZjJmWVQ3ZnRHV1pPR1VnWlRuWHVtVXVndjlJdytlS2kzZFpUYzNPNWJzMUtNWUM4YUZDV29ZaXZuelhCenUyOG96azhHekt3TklHbXJzZUh4ZE91SktvWURjbDcxak9UeGxSbGpaeTVYaVIwQVZacU0yV0Nsd1ZTOWE3RjVwdE5IWFlYazl6Z29OMWQzSnBmYXY0bE02M0JtT01vaXNEcXdrZm9UbU1sd0IvSVdwdlczcHZUbTQxT0FNcjhRSXJDaGZUSld1eDJMczJ6T1ZSQnJTRG56QnJLaXB6NFlZc0VjczhzWEoxYVZOY24zU2E2b3N2ay96U1dHYTAwNHR4dHYzSGRyZmExNE5ZaXZ6aXZOV0Z0VGJsREFpaXZNQlVnZWc2S3VSOUg1cmphMzJMdmE3dmNzUTBlQ1l5QW1jdktRT1h3VlB2TnpMY3pNNTBOTWFBamtCdzh6aWs2NUdxaEFRNWtYaU9TcklYdUhDMlBDSURVY2ZleHlDbUdER3B1YWlrMXZLWG9VMlRKajBrSGx5S0VKVCttTnF0My9BTW4yUzhzOHR3RUI1cnc2enJCa00vc1c4UVFUZUg1eVhRd01ZaXhtc24rcG1zdnVKMUp2L0Y5akwvcE5QL1NSd3o0eXhxSGZvM1g3MTY5YkkzRnVVaFlqYTduYXo0WHlWeUFBS0dDOXF6bjgweXQvVEdNVjlycytEeXpWSjhmMnB1dlZYL1lpcmtUQ1JqSVVSbXZDbE83MmtRMkhETFVTYXdCdXorUDJMUmIySmNoSTZaZ2dYRWtDcGNLT1gxVmhoK1k0c2tPVS9wZDAvRitUMkV2bGVXU2pMREtHV01vY2swMThZL2NvWkMwNG13dTA0U2JrWXlCdmt1U3VJMDFhYWFmZ281eGxCdU1rNHRkMDltajByU0hjZDgzSFREZDdtTWVRZWNBLzhTcXJSYTY0cDkwbWEreDFtN0oyV3FjcFRrY3pJbVIrcHNyd3RTYm9pY1Yyak1TeVhFWnh2amF2d1M0dXJwblJKZXFTVzA0QkM5RTJBcVo2Y3ZVSUJJLzBXTmx5KzBycTdkRzZFT2JvdUY1Vll5L0s2a2JWcG1GM0RKSEtyUkVvT0RwbWVleGQwN2JCcmJiRmcxSXduSTRnK0tObVJjbFVRSlNveUg4S216TzcyKzRoRnhwMkU0U05Sa0pZRTNWZWQ5RjhuV1JsaC9tcGwyVjE5emJiemF0SHh3RU40ei84akVnU1A5MGZ3VlpsMDlYSzIvdVpVTW5TajZMU1Zmc2QzRGY3WnJjTjVPUnV2dXkvVkU4UWJDc1ZXMVJrR0svYkR0WmVianZteDRtaG9kLytPOEpmN1NjZUI0TEczWTJvdmR4MjdjdGZpa1FKUUlFb21qVWhlQm80a0VVUllYMHhPRVhJeWhNQ1VaQXhrRGtRUlJIekN4ZDJQdExuYnU5YnR1cmFpMWhMNzBISlhENStFZ25nVm00OHRZNVJmUmJHaVVkMHpLRGtJdXdsQ1F1TWdRZklyREwwUFJlY2F3a1c1eWlEekE1ck5FNVJoRXlrYWpFRWs4Z01TVmc2VzQvY3VQT1ZSazVPWHlrYkh3VzdSM2N2R3hUL0FEU3VNSFc5MThEb1pJVHpxOFUxYm5sZ1FoTlNjSGxOQ2VhRWd0a2JpY1lhQkxCYTM1Q2Z5K2E1YXNoU2E3SGo2cnRKeVV4RUdVcFJqaEVFNWNGenF2SXBaRmRFcmF4SEJlb1JsS1FqRUdSbFZBZFVqaXZVU1FUbjh2emtvWjE5eS9iN1l4TUNQN3R2MXE5eU5HLzRRYjhSL0ZkOXYyU1QySmNsQUExS01tekdZOHZFWW56QklXcjJtY0d0MFM0QnAwU09vNG1PbXNmcG55Q3lMNjhaeUxUYzRtZWd5RkhVSTQxY3E0bkpWT2JKa3h5cFBwZDBqMG1sd1lNK05UY0lwMjFTazkvNDl5SFFjWTJ1OWp0MjVRWmFZdVRrejd6czY5MHlPWUY0OUZPd1JJQWcyRGlGangvMmZjRWRRZUxzak1XTklqZ1RqS3pQcDh5Vk5OZzJXdHMxQWpUcGpXZG56T0pvbk9yTlpMRXk4V2sxTGsrdjl5MDB5bkZ5VW9LSzdxdjlGaXZLOUx5c1VzQVFoQ0FFSVFnR2hDRklOVi9iTmJrUkRzZFlpZFFCdXIrV2EwTjZ4S1cyTExEUThmaHFKakFSaWN6WmpJQzhCa1NybGFXNlpPNFptMEhIR2pJZSsyYWtQSmRKMDAvVTF5Z255MjNrcWIyc3gvTHNUZTJ0emNibHR0bUFFcFJsaWI2eHZ3MkxGQTFxUEpSL2M5ejNHL2Q4VXdHNklpM0d4RWVmVWs0WW5KZU80YkY2RzdtM3VuWnVEU1BSa1plOUFXSTREckhyK0sxU3lHWUVpUUp2QUNORTEweCtLdG51dVU1S1RyeFNYL2tydmJ1NFlvTk45UFAvQUlOcU9HUHl4NDlWeWNmYmFpSVNPblYxby8yeEJIRG1rMjg1TWlKZ2JrZE9ObStnOCtmeFc4NzIrVzYwUWNsNlE5N1ZuUkdGSG9TcWllcndRVGNwcFZmM2RlRjFNZUdoMUdtMUVGa3hLWFh1cFJWOXJhZTMySXM3dUlUbWFNajhzL3p4NkxaMnpqa0hZK2pPUWxJMVhRNDhzVm9kMjdmUFp1QU5PVGQxV0paUjBuL2FmeUZYaHZjN1ZzVEV6RWpIQStLTjVHMVh6V1BVSlR4eXFNOXJuMnQvQStrNkhWNU1XR2VMSmg1cU1XNDhJL3BydFQ3L0FITTJTYkU0MDRCSUVVYnlxc3E0OGVpRzRRaUJHTUlEVGxoMDVlU2d1MjdudTNQVDFuVUFNY0JHK01qbGp5VTZhaVhoR2NZazRYUXhYa3RYb05ScE9DeU5TV1J1dURrMWE5UExSUzZmTml6dWZHMDRPbmRkU3UzTzNhY09zeEJKNDlCMG9YOVZHOTN0QzAzNmdOUmxMU0k5ZU9QVlRjTVNjOE1ZMlJ5K1BsODFIdStmdU51ek9NWXhvUm9uT1E0eDZDZ2ZOVHBubHVLVnBYVy9iN0t5OTAyZVdQSkZLZTNWTjlGNDhFRDFDUjB4T09vUjRBbjdBclpwbU1EWUZHcU11ZVgyS2cyOGFqODcrYW1HMGc3dm5QVGJoNHFza1pEcFo0TDMrZzlsYzRTcmwzMzZwRkQvQU5veDZ6TkRCbGkzN1NUVW94NlNiMmIrNjJORDBmR0oza2JJNlM4MXNQQXVEbHlHSDlsYWJ2Wk9iS1VZdVNpZFFzRVh6bzRFV3ZHMzJlNDNaa0dZWFh2U0pFWXg4NWYyVnRMRHAybkp3aFRWWFNzK2RMVWE1Y2NDeTV2by9ialVuUy84RWFpQkxDdml1emJVblp4aEFXWkdoL253VnlPeTc0R2NqQ0Fxc3BnNmhJL3BJekdSdkJTdlo3T0cxZ0tFZlVJOGN4Wng1QW5FQmZPZGRxSWFhVW9yZDlGK2I5QzIwdWh5NThsT0xoRmQ1TmZ3WHFjaDIvYndqVkdWZFNjZjlVanQ0UkdFYTZjL3hWc1k0SHF0eWJURUc5VHJnRmk4UHovWmVmd3h6WjdxWGJkdVVxU3MraFluSFRSVUlLbDBqRmRmc2lGT2JMYk9ueHRSbHl6SDRFS3EzdmFXZHdDV3hCdVlIS29rY2VYbXBnOSszUDhBeHltZk1mM3dXSk8vZDBZZmI5Rmx5UmxDZml3SWpMQWdqcDdwVjFwSHF2ZGdzZVdTNC9xVGM0eFgyN1V6Zm5samxqbExKQzIxMmtxazY5U2xaYTlZeUVaUk9rMGNSOVJ6SEhKV2MrM3N5aFExUmxXQkI2OGVpZzBISk55RW9taU9xbWJlL0VtWXp3MTVFY1Y2M1BrMU9XVUZGdDA5bEhiNHM0K1Yvd0JCR0dWWllKUzR0dVU5MDQvL0FENGFLVjNZR0JHcVV2T3JWakZ1SmlBUmtPWElMZWp1NHVYR2NSUjRxVWJUYnM2RC9MTWhHalJrQlYrWkN0TVRrb3YzTVRoUGJmcEwrTEtuVllzR09TbGd6Um5pZmRPdVVmaFNiTWZTYWxuRFZmRW12b1Y0L25IM3FBNTNmMHIrNnlIdTJOdnQ0Q1lFWTJMekorc1NmcW9rKzJNWndrSkRyekN5NFM1UGU0L216Q2VtVXNmUEhLTTJ2M1IyVFM4K1NtZGtZeEpqbXFXUk1qWnpVaW5LTVJaVks0NEorN0VlZlZZMnFYLzEwL2FZdVA3R290eHQ0ajN2cXROQ3dZVGxCMmpjNHFYYzNwUGNoODFNL1piZURiOTJZMSs3UFUxbGVMZ29ZWjUwb00zRFhJUnZNZ0tjZXltMjlYdlRJUDhBOVd0d24rZ0VENGtMWThzcGQyUGJxUEt1dFg2MVptUHMrMWM3ZHZkM3RvejFzeUlmakU0YUE0WkFTaHpGeDB6SGtRcDJvNXUvWGEzdXpkYWpHVUpSZFpkRjFLaUJPSkhNZ3dORGljVklscWJ2Y0F1TUI0cFNNUmRtSUl6TU1NejUzZ3VoUExQODQvSk1BREpja0VOOW85NEdOcDZBUGozQjBnZndBZ3lQNEQ1ckd1M2lmRmZUQlREMm5pUDNXemxSOXlZdnA3d29lYWpzY0FyM1N4ckhmazhsOHh5TjVPUGhEUi9aTkpaNVEyUE5JcC9GZVVKQmVsM2kxS2NaU0FzUUViNTRtc0IxSzRrVlY1cm0wenBwN05xckVtaGVBYlExME5HSDVLYUNuWTdpbkowbGJaNXlDazJ4N1E1dW94Y25MUTJjcUhqbHhGNER6VlV4c054dVFZdHRuTE00UUY4ejlsbFpTMmJNMk51MjFNeEpnTk54dXFIbXNEVVp1RWZwa3JmandYT2owbnV6L214bHhYd3QrQ0xudExrM1MyM1czWWpYanpkY3NZK0xNRHBoaHdVajJtdzIreUI5S0ZFNXlPTWo1bFdTU3FaWkpTMmJQVFk5UGp4TzB0L1hwNkwwR2tBSTREODJoQzBtVUNTRUlBUW12Tmk2NjFhQWFGNlNRQ1FtaEFhRzYzakd5aUpQVDBpUm9ZRWtuZ0Fxei9ITzNBMFg2Nll3Yy9IU3ZYZG00dk13aEs4WjJLNkVBckM3K0R6MElreUVKeUZuN3QwQ2VQTmI5TjdXYkpQSEp5VW9SVW40cG1IbmVlSEZ3akdVWmJMemY0OWlXKzBHL2FmYzI1MjdrSEJDTTlmVVlrWUVTR0twWVIzRzV0MzB6S01SZFFqTFJIbGdNc2NWVk1iYVc3ZGcxQTY1eU5BRExpU2VnQXhQa3MzOXMyRWUzYmNNaVptYk15VHpOWHBIU0t5OVJ3ampqamk3L3dCbVRwWFBETjVKS1BLdHFmYXlJZHU3WnVKUUQwaUlDWGlIM2lPQXh3d0dmMFY3KzNodUlPTWt5Yk1oZ1JXb0htTHpWL3UzUFFZazRQMDZUOHRRdjRMUTNPek01ZXJDUnd1UmlCNGllbWtrNThnY0Y0N1VhSmU1aXl3WE53ZHlpM3RKUHI5MFpzSjBwY3BmdWJmTHU3TVRiL2E3alpHUWN6dnd5SXNTSFFnNVkxajFIVlI2RGszb2dTOTBaNVdaWHk1Vm1laXp5MXUyM3o2VHpaaWNxbkhBbmtSWklQbUtXREpiYVd6M3U0YkZhUFZtSWdYZGFqUng1OVZidW80NXJ0ZkZyMHJ3WjhOVm0xL0Y2ZW5MSENjWFhaM3R1blZHeTFBaVY2algvYnpvOHI1ZVN6VDJwcjA5dEVrRHhlSVViOEpHR0l3K2l4aHV1MzczYlFMMG9OeUZnRWc4T25peVBsbjBWcEgycWRhYUVCc2hxRVJwTnlFY01QZDBrMEs1L05jSjhtbmszY1Y5TjlMS2JUODR4bmlieHI2azkzRlA4ZXFNaS9zN2VtNFhKZUlWcGo0TUJ6SU5uNEtMZDkybTVHMWZMUDhBTUVvZ0dHalhPdXRZOHV1Si9GUnpiOTE3ektudlVqS01wSCtYTVFGMTBBd0lqeW81WXEvajdUdzAvd0F6YlQxalBSTUdQeUoveldsK3hMWjdOU3Y0bHZpMFdXTFU4UEhNbjM0U1QrRHRtRVhObS9BZjhjdklFR3ZNQTVyTG5zWHVSUGJQc1N3ZGJjQk4rOFlTR0dlT0JCQ2k3NzBOeSs2N0p2UUp5TWhHSnl2aldkNDN6WGphU2UybTdZZllxVG9PbVVid2RoSTBXL25uRTlDRjNETmJxbDl5bTFPWFZhZkw3V3FqWExkT0xkTlh0MWYvQUlKZDNhRzRnOUwxQk9jSSs1T1Z5R2tubmtEZlRCVW83dHVOcnQzTnMySTZYVFpsV09PZGVZd3hXV3QyME54dFhJa2U5QTRIRXhKL3VGaDkvWmx1Zml1UTRkVHlWaGx6UE1vWVl0S2Nuc3ZLWGQrRHptZkJMVFNsbWk1Y1duYjhXKzNrc1IzeVRUTUdvTjNUY0lreU9IaHpNUUJlUEUvSlhtMzdqdG42cHdRa2YwU3dOOGgwUHlLeC9MYnlGa0VFWVllYTFjWW5Dd2ZwUzg1cnZsc3B5NVpFNHlmNmwxL0V5OUo4enl4ZkdQSEpkTGhYdzJycVpWZTNEYkk4YmtZWjFlRjF5VVMzVDBkdzUvS25KektxRXMrUTUvSlVHNjNibTVjMVNBSGhvQUhBVjFzOHppZXE3dGQwaHNtZkF3SnVDUjhSbFVkUDhYSGdGVzR0RExERk5Kem05dU5wSmZkbnRZWjlaanlLYXhRaGpYZVV2cWJYaXIyYk50NXJkVGJtSmVxSTZjVGRmNjF5eDRyRERodVVyTjRuSG1wdjNMMmtkM2pSWmJiaXhHV0VwUmtaR1E1RENORDRxQXIwT2p4Wk1jWHpqR045a3QveEkxdXNXcDRKUml1TnZhOTc5RDJ2Y1pHT1JyNXJtaTFaM1hZcUMyWmV1eElqek9IMUt0QTVJRHd6UHlrb3NuZExOeDZtVVZUWEw3bWg0NzlDV0Z5Y3M1eW81cEFFNTJCMUp5VWJEemxVSkZjekluTWsrYTN5MWFyYUloanAyM2ZwMk96MDlia3FKTWJOWS9ndGEwaW5tRlZ0M3V6ZWVrOGxhdTl0M2JERE80Y2FNVzM3OU9SNjF6SFFFWXg1akpXMnk3WEtldHgvK1ZwMDZSTEEyY1FUQTQ2YTU1MkZ3Mm83dlpFV2EzYnRnKzZmV2pDUmhBYWlRTHJFakdzdm1zMWV5blo0YllUM3gxYTNoS0VRVGdJYXJKSDlSSDBDMnZaWGFCcGw2WUFFSlNqR0dGQWlJSnUrbzhWTElZRlpLWEdwWGZReVk2aTlPc1R4S0w1OG5KdTM0cXZ0Ukh1K2JyOWpzSE54cDFTYmsyWWk2OFJtQURkSEs4UjFGaGFqSGZXdHlHNHROVGsrNVdodkpzak16OWFqSFRFWW5EVU10SzY5L3dCaFB1T3k5T0JBTUp4YzBrMEppT2NTZW5BbkM4MXErenUwMnJXM0wyMmRMemI1RW9tUXhnQUtNTTg3enlRaGUzN2Jidm5leVg1a3VoRWdlSTJTYlAyRExBWkxxaEpkR0tRWDJuYS85T3krUC9xZG8rVXg5b0NncGNqcDFEeGYzV2JubVlQdHpibUxqT0ppUjVyRDIvN1c1MnVRcytveTVlVjRHc2ZxcmJTNUZYQitkanoydjAvS1N5ZU81R3ZWZGpMVkVuaU9oL1AxVml5LzZ1WW84djdyWGcySlgwSEpXVUl4akVBQ2dGWm9wY3JoWDdkMTFSMFJYelNDMm0yWnVhaUNCR0F1Y3BZQ0l1c2N6Wk9BQXhKVXQxM0s5SnQwdHlReTlXVVk2WnZUcHN3QmhMVnBjdk0wUkkxbGxrTTZWVnZ3UFVpQklraUl1R2t4TUNmRmp6SnV5ZWE1aUVvc09Gc3hsRW1BbktPb0dGWFFJSUJHcm1xL1BFNThTU3NlRWFkMzJNM0xsK25pNHROcFAvUEo1UUUvenhSMFdTWVNBcTY3ZnNmM2p3amRRalVwOFFUbHd0VXNiTWdLc2swSzZua3NsOW8yVG0xaEtiZ01aVC9UZVE0OFZpNmlmQ0QzMzZGbm9zRHk1WTJtNHJkK1B4SkRHSWhFUmlLQUFBSElEb3ZTRWw1MDl1Q0VJVWtnaEpDZ0Fta2hBTmVTUHJWV3ZTRklFTEFIWGl2U1NGQUJDRUtRVk8rWm00RzlBSklKdzgrdkpZSW50My8zYjBDMjhYQk9WeEFsSXgxSHJwSFg1QmZSTTVSaEV5bklSakVXWkUwQU9KV0dOeDdTejIvYzl3OHdJbUVnRzhjQk9MWU9rbTZONmlTT0dDMmFlUENlU1VZOG5OSy9nZHVMeVJXL0ZSN04rV1NIc1haOTJ6dVAzYi84dkNRRWYxVEV1WS9TT3ZPd3NnemVZYXJXNjNBbjcwNGduNmxZTDMzdER1dDVBYW5pekQ5VVd4cHZ6eE1qNVdveTBmM0R2cVN4akNveEIrNk1oajA1K2F5SkpTNVN5VFVPTzFFLzArYmxHR09IdXltdVNVWGY0K0Q2UGQzV3pjZ1l5ZlpNYTFtbkkrN0U1K0U1V3U1M0lMY1hXbyt2R1dQZ0l1dVl2UHl6V0FOYk1BZjVlblZnTlBPd2NnQm5YUlppN0FSTFlOMU1TeGw0Um0zajdrdVBYNXF2Y29TbFVIYXErVlY4REhuSFVZYzNzNXNid3k0OHU2ZjRkeTRaYUptNDlPSWlaaU5SeklBSFhsSTNpb2QzL1pTYm0zdnR1S2NqSUNkVi90a1FmcGF5Q0JXSDUrS0srYVNqeVZHWnBjbjlMTlNqdnUrU2ZhU2wzVEkzNk05enROTDhCT1dFdE1vMEw2WHh4OHJVUTdpMUxiTkU3WnNhb1NNbkFJa3kwNFg0YVBodXJ5QUN5YkdMZ2tibEV4eG9hYWtPRjNYd1RpMDNER01RTHpOWW5HOFRtY1ZoNU5Oenk0OG5KcmgzVzlTWDJOYytHU000eWhINnJyWmJIejFMZDdqZE5mdDJHSmE1Zjlzem5QUnExYVFCbFdSSXhwUnh2Y09NeU9PUDNUWnhCckVaMzhWOU96RU50QjUwaHVBakV5OE1SR2dNYmtjTEoraSthQ0luZC95b0gzenFOM21meFdWYWpjWlJVclRmWkhPaTA4MU9QREpLTHRieFc2L0FVenZOektKZzFJUmdRYXVyUE00anFzaDlsMjdSYzFPU3R4dVFsRWVFanI3d3E3SG5tTFZiQ09rVlZHOFFRUjVLazNXNE8yY0FBTkVBZ2drZWRYaFk2WUxyVWFGdlNKd2s4YzZUMjZYME5VOVl0Yjh5bmpseHl4ZzJvVGwzYmpWdmJhdkI5Q3gzVFJIaWtJbmlvdzQzQnd6eWxFbkFIL1AreXJ0anZXOTgySnR6MVZuRTRtSi9pSFQ4T1NzZEV1bEE5YTYrWU5yd1dvMWVvbnhqUDZKNDMrNVdwZmN2djZlQ3ROV21xcVZORWYzR3kwVVd5Zkk5UHRVUjM3cmUyZ1hYSTRqQVJHQk45TE9mVzhNbFB0NCs0enQzbkl3MXliaEtVWTlDUU92QUxBMDN4dnB1T2J0K1YzY2VtTXJNcUFCckdxQzlaOHMxMmZWWVp3elZrNDBsSjkzL0FQcis1NW5QOHN4WXM4TXVKdkhUNU9LN1d2OEFqNDlTd2U3aXlZblFaRzZBR1J4elBVWmYyWHQrTzNlYndKQk4xZk1kZVh5ODFyYmJhN1I5NklibE9jWTZqTVNGV0t3eHd6SitCVmk0eDZjYXhPbktYNEsweDRZemx4NU9MNmVwYmFwNTh1Q0dhWDdJeTQ3YmZGa0puRXhrUWVpNUtWVDJRZmpxQnFVUmtCbnhQQlJ0eUdpUmljd3RrNGNKTkdoSnVFWjFTbDJOZEM5cExXUUFUd1FsbWdFdlhSWCszYzJnWWdKa1JsRXZldEV4Sms2SlJIcGVuTFNhMG5QR05ISEZSMEtRZTF2YlYyTEw3VTV0eGRqR2NUS0VycVVRY1ltdWhDMFY2Q2dIMFczM250UGVOeHNZQm5jT3pnZlVEY1d3WU56OTBhNDNpSVozRWFSaGE3OTY3UnVYdDI1dTJoQXc5TUdWeklJMFJJSkVZeE1wR3NZOFZFUFlUZE14ZjNHM25HQWRjaUpOei9WSVI5NXNIa01KVjF4V2VWdFVxN2VLZG1scmRlalRYM0lQN1BkMEc2WkczY0doMXFPSDNadzRWaFk2ajVxY0xIbTI3ZHVZZDBMd0hwTVJjbVluRHhqRUdBalFPSS9WaFE2bFduY08rUjJiMHRzMHhQY1BDQWxoS0VXb2ovOEFZNFpYQ2hpYmprUnpYZVNNVkw2WHRTZjJPY1VzbVZYT0tqSzMyMlQ5U1RiaU1Kc3V4Y0Z3TGN4TzZyU1ltN3ZESlk2OWhva2R1ZE9yVkdXNE9rZEkrRWZqMXlVVzdodmU1OS9uRGFNT3hiSWhJUE5zU242YmtUUjlUWElSdUJ3akVaSHBZVTY5aysyYm50ZTFlYTNHR3A3VkFjTklGNTlUK0MwR2J3cURlMzRxL3dBTzVQa2swa01jOUtOOTdhOVhZendzd01aL1RQNEZTTmNweEU0eWpJQWdnZ2c1RythNmkrTFQ4R3ZKSG5HVWZLYU1MN3JhL3M0c09hdFVINENVZWh2OVVTUDRjTWVxclM3SXFaT2JSM2NNdjdDVVFIZHIvTjI1dXlZU09NTHd1eDF3eFVJTVRBMGN4bU90OGxmNHA4bDZyOCt4NWJMalVYZGYrMTNMR01oSVhlS3VkcTVFc3ZzVElnWnloT0pKcUpNTDhKUFM3c0hLMUZ3VFJyTHF0dURnMDUrUzNTWEpWOGZ3S3luQjhsdjNWZWpSS0lTaHRkdHVZeWxBemZFWVJoR1VaNlFEWmxJeEpBNEM3VWZCVTUyUFpZU2hGemNZNmdDR3hoWDlSenZncnh6dFd6Y01UNmVrd3kwZUhqaUJnY1ZoZjFHT0VuM2xiM2E3ZllzZjZETm1oRjdRU1gweGIzM2QyWXJBWHFJTXBpQUhpSkFIRW5JTE1CMnJCaUl5YWJrT01ZL1lvWDNmWk5iUXRiaGthS21MaUwwNEd3UVRrZUNtR3FqTjFUVDZIT1g1ZGt3eDV1VVpSWGRkbXR5UTl2N1kzc3hybFUzU01aZEk4SS9ibXI5ZUlURTR4a1AxQUVmTVd2YXA1eWxPVGN0MmVyeFk0WTRLTUZTL3pjU0VJV3MzSEpxQmJoR0psS1pBOTZXTWp4SlhWQ1NrQWhDRkFCQ0VJQVRTUWdCQ2FGSUJOY3BhdjBrRHo2cU85MDd1MTJpRUM2QzdOeTlNSWtSeUdac21vNUJFbTNTVnNFWjlxOXpPRXR1elowR01wbUk2eUJySHk2ZWF4VjZlcS9COHppdC9jNzE3dU81ays4UVpFVkdNZmNiZ01vZ0UvSHFjVjVVNWM4OUxVVkg2bXI1ZjJQVmZMZEJqMStPTXB6ZkNFcTl1TzF0ZFpQMU9Qb3RuT0lOY0YwakVRRkRKYm0zMCtwRXlNUUFRVHE4K1hVOEZ2TytrVzVZd0pyd2dlWjU0OWNlaXBuS1VsdkorZDJleS9sNGNzVkhDdTFjb3g3SjlPeFVETWMraFBUaXR4cmR2YldjNU5iaVRBQnFvU295STZ6dlByUTVacXZWUUdYUTRaUWxxRWplT0kvMFczQ2xiYmRiRko4MDBxZWZCbVdOWkpjWlFydjhBSGoxb3l6Mm4yd1pjUG83N1UzT3lBK1FCQTh0WUFHZzhhSTVxdDlwTzRRYzN6VGJXNkU0QnFKMHR1WEdMbXFXUGhOYWlLNDBvSTd0L1dHSXFYbUt1dUNwSXRGdVVJMGIxQS9GV2E5dkxHVk9tbHVyOEhodm1Pank0RStTZkdXNmtrMGwxcHJwWGd6RjI3MmczYlZoOGpjUkZBWFVaakQ3d0dQOEF1Qk45Vkp6N1NNeGpjbUo2aU1JaVVhK1pORUQ1RllJM3pqalFoS0U1UUlKeUpGK2ZOZVdOM3U1MFIvTU9BOFp1amljc1BpdThWVHc3UnVmbSsrNVM2T1V1V09lYkovSjM1S3ZxMjZmRXl0M2Z2czM5cjZJWWswSGg0cGF4THc4aFFCeDZxajdYczRTZzVNQ2kyUERZSkhpR0J4ek41NHJ4MmRxSGNKZnRYNTA0MWM0NmYvc2pkNlFTVHBJUEE0ZVNtNWl6czJweEFqR05lNzF4dkRuZm5rdlA2M1Brd3BZK01ubGxKS0RpcmpTYXY0MGVsaG1oU2xpY2NlS1VHOGlmZCtGeXY5dmtnMFg0T0h4ZUNRK2NUOW56SzBOL0NCYkhxR01jYUZFNW42cmxNSFhLK3BKK3VLOHl1UW9teHlQNStpdm82K1VJOFp4NXZ6L2N5OG4vQUZqRmxuano2WE04TVpKU2NOMnQxZjBQdXZzN1JTTXVianR6NG5IWEhIQTR4aTVHOFFEa1FSNXJNbTEzOE4yMEhHemdjSzZnam9lSzZNZWo3UWR0bHRYQUlPTlJpQVFQZGtCVVhJam9NS2tGUmRyN2J2ZTN5Y1llWkppWmFvdXdxVFp3clA4QVRsMUFYbnZtR245N0g3bU5TY3YvQUo4Tjl2Z2JZWENUeDVxalBIczdhMzlmaVh6a2RjSnc2U2pJSDVoWVZqMkYxbXBibXhIcUFEWHpsbDlGbWpFRTVjcSt4Y3E5V01vVmNaaXBST1JIWGo5RlFhWFV6MHZKSktwTmN2S3JiYjFNaDQ0V3B5Z3NpWFpOdEl4bUpRMndsb0VUSTg4aitlV1NyeUhIalFrVEtScXF6UFdncEYzaGhuWituQnNTTXBYWXZJWkNpZkkvYW9mS1pCRllWUUdPWDU1cjZsb280WllWa3gzSnlqczVyZGZEL0dlWDErcDFHYWZDYWpqeHgvYkNIN2EvTi9jbGNlMTdobG95bmh6amVOY2ZMNWhRRGY3YWJMaE5lR1dSNWVmSlpuN1M5UGQ3SzNUck1aU2I0eUZkZU9ORThsRTl6QWFwUjRrY0Y1bUdzeVpNK2JGbTRxV09WWEh0UjZMUjZUSHFkTTR3Y2svM3JydSs2Wml4SlRGM3RrWjR3R2s5YUhoVlpIdHpodnhWL3RQNXl4VmphNk5QN05GVmwwbVhGTGk0dC9iKzNjb1VLYmJMdERjL1VMeG1SQWN0TVR4dkVtdUhOVUcrMmcyMHNDVEE1RTVqeldyM0l1VGhlNkkvcHArMzduMDExamYxSlhWdGVMS2JOQzlKVXQ1aERYb0x3dWdVRWxodEh6dDl3MDZKemIwVGpMWEFYS05IT0lKQUo0RWkxOWU3TGRRM3UyYTNEZDZYWWlRdWdmSTBTTDhpdmpjWDlQeitTdnJYc1RjbWUxN1NFMjR0U0RZT2lKSkF2RUd6WnVRTm5IQWxDR1g1SFZZNjJIWW9qYzl3YTNUWmZiY01DSFozcWMxU00vZUJCd1B2Y1ZrZEtPWDRvZFJrNHFTLzVLdi9BRWNHMkdtWWlNSVJpSXhqRVVCaEdQdXg4aDBDMlVKSWF3UWhDa2dhRUpJU1J6dUgvcG45dnZScUlnZlNkNUJxZCtLdUVpQ29uN1FkdkxVLzNUZG1NelV3UDB5UDZ2S1h3S3liS0lrREVnRUVVUWNRUVZvNzZNSmJWOFNGeDlPZUdlVWNQN0xKeFpYQ1VXdnQ4REN6WVZPTXZ4K3pTTVRNU2FqdDV3a0kzS01ocTlRUnhJL1ZHanFvKzdkS3VhWkx1NGJaQkhqbkdQMU9OTGhHelkwL2I4VmFkdm5CdmVzVE9FWXpqZlBIQ3lmbXJ2anhVbjUzL2dlYWN1VGduMlRTL0ZtYlFOSUE1WUpvVk4zRHVUUGJteE55NUdWNllScXpXWnhyQWRWNXBuc0cxRlczU1JicXUzMjEvZWJlYk9BMVpFOUNPcU5wdWh2bUE5QVRiRWdhMUFXRDVZZzBjdWhWWTcybHA3U1p1N2lUbi9jOVdWK2RlNzhnRktrMDdSczRReUp4bTZUVmRyL3NYY1lobjA0Q0oweGdZMzBqcEFvZk5iUU9wUWIxTjMyYVZUbFBkdFN4aU1UTWM2d09YVVhTa3UyZmJkaUpRa2NSZWx3R0V3THpNVCtLNDVYM044c0xnbFRVbzlHdjlWM1JhcEpvWFJqSGxDYVNBRUlRZ0JDRUlBVFNRZ0doQ1NrSGh5Y1dvU25NNll3QmxJOGdNMWdOeDQ5NjdsSjJVNGFSZnBpWThJZ01vVnpQMnJMSHRBekovdDdrQTc2VVRLSHFIVGR3djNjeFZtckt4ejIvYWJiWlNNdlY5U1I2NmF3UFRNakZZK1hVdzAyUEk5M2s0dFFYRnRXL0xPNHg1dFJ1TVUydVRiU2RKOVB1WFkyZTFiTmhocTgvY0ZxRWJtSHB1ekhHL3FwK0p4TjBmeHcrcWcyOXhmZHc2LzJDOHBvNXpuT1NuS1V0djFOdXQvVStnL0xxaktYR2txNlZ2UlgydlNxUTRZSCszQldVSkNRc0wwZW8wMDhGTjd4YVZTcitEOEZybzlmajFmSkw2WnhidURmcjNYbERwZEdtWnlzUmpLZmtQc1YzcyszVGZPcHp3US85MHZMaHhVeWJaYmFpSXdpQUFxRE5yWTRyakg2MzFWN0w3bXZVNnJGam5jVXB6ajJmU045Ly9SakNYaE5IQTlSMVhHY2RZclVZbm1NMUllL3hBbXhNZFl5Qi93QnBIMnFNUmRJelhvZE5wc21vMDJQVVk5K1NkeDZwcDF0NUtTWHp2U3p5ejAycWh3VFNYSzdnMDExNm8ybTJvU25DVGhzd3k1RTh6U3ZmU2pMOU1TT21BNjhRRlJDUU9TN1JkbERJMHN2QnExZ1hDY1hzL2l2Z2VlMTMvVlBmL202TFVMaTk0d2svcHArSlI2ZmMzR25Ec1pOU2hVcHhtSE5lUk1nY2RRNkF4OElISlpDN3kwSFdvNzlnQXhsR0pueEJ5bi9ZckZwT28yVmtQMmZJM08xM2V6bkwzaDRSZGthd1FUNUE2VnBXYjNNa3EydE92SllaZmsyUFNhVERMSnh5dUVvdk1tbTR5dHBPa3V5WFFpVElpNDlEMVNOTXBBU1BEKzMyS2FUMkxVajZjaEdqRzQ1Q2Z5SXpGY0tVRzNlMmQyYnBhZEZTSFVZMlB2RG11Ykw3akxvY2hLcEFWWnh3UFRIcFNvZFRnbGtkcWJpMG50NitiUFVaTUR6UmhMRGs0cU1hZ2wyOUtyc1dXdmNkc2VkZ3k2VzdvYWdCaUFSSUEzZEE5YVVtN2g3UVFjWTBiZjNwWVMxUklJSFhoandLaHU0M005elBWUFRkZEJTMGgrVDFXVmp5NUk0MHBQZXQ2OG1QbjBtQ2xxZFRTZU9OemJhNHlwZGZKbFR0L2NObHZ4R0RrUkI2aFlPQW1lcGpJSE04amlwUU5rd01OUHhLeFYyZnQvN3ZkUk9iYlJqT2ZIcUFQbjhBVm1kWm1MSGp6UjVTeHdmcnhXLzNQSDY3MjhjNCt4a200eWlwY1cvMjh0MGw4T25ReHYzdnNnbVBYYUVwNlJSYnU2SE9QWHpDeEU1dHo2bEFFQzZyamwrYlgxR3NYN3YyYzlIMW4vV01tNHhNby9ldThwWVVRT2ZWWGVta3NhY1UrTzFSOGIraFM2clVaSllvUmNJelVYYmwrdmlsMnZ3VnUybkhaN2NNUUhNZzliUFBuMCtTMWhHRTZFNENzcmlOTWg4K3ZHMXp5L1A1eFFaRExuNUJGOHR3UmpPMWM4bTg1Mjd2eXZCNU5mTk5YN3NKWTV5ancvYkdPMjE5blhjdm1XR1c0ajB1dWQ0NmxVUDdZT1BHSWtCY1lub2JKc1hSeXFoa01TdkRiODJqWnVRK1ErbGNsTmR2MllPU2EzTTNKaVdFdEFBeXpBdk1YMStpODFENWRtMDJkdVV1VUgrcDkzdXY0bnNWODJucWxHVWVTelJkeXZvcXB1MnQrL1l4enZETnVUYldBQkd2dzM3by9Uamo3dzVxSDkwSmt5TU1CUEhoZ3N2NzN0WkcrSm5xTEppWndOL3F5MFgwRWJzY0ZHKzVkdVpZQTBBMDVZTVRpUGx3WE05Uml4YW4yMUdTYjMveGxucE5OS1daeWxtVWxreE9ISjlHOTkvUXdwU1NsOGV6U2NkbjRveGJpZXVKUDhJL0N5dVc4N2I2VW1nMkpXNGRIcCsvSVM2ZFBGcTZLMVdXRGtvcDd2b1Z1UmUzUGcybjNwcmRPdXFmZ2l3QzlCVGQzMlQ3bzFOaUVtMjdma0lSSW1OTVpVVHBtYThKQUIrbUNtZXk5Z3BtUWx2TnpFUjZ3WUJNdkxYTVVQa1BKYnpYYUlIN1A5cWwzWGVRaFI5SnZ4UFQ2Q04rN3hNOGg1MzBYMUV5NUNVZkRnSW5TQU1zT1M0N1BZN2JZTXhaMjdjVzRSNkFZbmpJNXlsekpXd3cwR1k2YnZFbjZsY3R5dUtYYmUveU90cWZub2RhSnp3SExyZjFwZFVKTG80QkNTRklHbXVSZ0RMVjFHWERIcDVycWdCSk5KQUNFSVFFUjMvWklQRXVzVkJ3NXhQdXkvOEFLZmdzYzdoaDNadUdMc0REcUx5UGtjajh1aXpvdkUyNE9DcHdqTWNwQUg4Vm00OVRLQ3AvVWlxemFISGtiY2ZvYi9EOERHZTI3dnZkdTNFVGpDVWE4QmN2VjhEaVBOVTdycm5kZHpBdlNFcEE2SVFxb2dFNWpQRTNpZnNXVnQzc21kMjE2YzQxWHV5R2NEekgyWkxGcm5hKzU3SGQrcTAzNmdpTUhZMGVlT25NSEgvVlZlYjNNMDJseGhHWGhVL3g5Uzl3TFQ2YlQ4NWNzdVdIU1R0UGJ2RmVobHhsdUxUY0c0NENJb2ZKZGxnbHpkdmE3bE9VbmdmQ1FUcUI1M2VCV2NXdGZwdzE0eTB4MWYxVUwrSzN0S095YWRlT2hoNDVaTWtGa2xqbENNLzJ1WDZ2TFFqNnV1T25TWS9xc2tTSEdOWUhsUnFsSHU0OXYzZThibkZ2ZFJiMVg0UTNXc2ZkbE96TGhoaHdVb1FvTWlNM0IyaUw5dTJHKzJlRTk0SFlmOW94SkF3L1RJeXNmaHdVamdaNDZ4SHJXa2s0ZExzREZkVWxIWW5Ka2xrbHlsVi9aTC9SNlNYSFZJVHJNSDZpdXZsNWRWM1Vtb1NTYUZJRWhDRkFCQ0UwQjVKcFBOQ1l3UUZGM2czc1hvREdUb0RjQmRlS1I2bmtCWlBBTENqN0QyMUlFckFQdXlpVHBsNWY1aFpqNzdoc3k1NllkRGM0eWxBeU1mQ2ZDVFk1Q1Y0NExGVG5lTmc1dHBzYTV0eWpaZ1pRSkFrTVJHd1pZSEVHejhGalpJS2V6c3g5VGdqa3hLYWI1cHRMdytwWFEzRHJaQjFFMGNpU1FWcXhmay9ONlV1c3pRem9FMkluaUF1bTIzQWVsTEVTQWpJWWU4U1JWVnFwYkRrTkVZeHlsMHl5NS9EUG1zZVdLR0t1c3BMd3RrakwrUTZuTHA5UlV1Ynh1K2ZlazFGK2hIM0hKaVJqcU5ZaXVRVnYybkhldGRSNHN4eWljU0Vwd2pMcGZQcmp6VnhEZDdYWXRlckRiZ1N5SGpzazE1ZUcvbXMvVTYyT1RUenhRZzV6bkRncTh0VmU1dWhxc01zOG5DVW5HTXVUbnhhcE45dnlKNEU3VU1aOW9kdlAvbWhObzlLOFlQNEVIekh6WEZ6MmthQWxwWWMvaEpsSEhsWTgrSlhnVjhzMWprNCt6TGF0OXEzK081Y2YxbUNrK2EzKzluanZqOEhadHRER1RkNmp5MVZoNTRXb29yT0JEam5xUzhXc2s0OGNyVzlQYndsMEVjY0RkMzlxK3ZhTEJIUjZiRmlpM0pSVnVYbHZkbnp2VmF0NXM4cE5WeWRMMDZibFN6WFhFV3JscUxVb3pzRE9OWExUVjNsZ2JXZ1k2U1JWVWN1UzNJN3B5RWRJNUx5T2JJc21hYy8rVW16N25wdExrdzZMQmhoTGxLTUlwdFNwZWR2UTBaalRJamtWWjlzM0IyMjdhY0JvM3AwL2UxWVVlQ3JYSm1jcmxRWEdwZEwrV0t5dEJoV2JONlJUZjVJdy9ubXJlazBOZlR6eXRZNmZqOVRYdzZtV3UvYlliM1p3M1RXSmFpWjhTMlJqODQxZjFXSjRTMW1vODFNdTM5NWRqQ1cxM1I5VnFiY29heldwc0dOZjdnT296ckpWdmIrd2R4bk1TTVF4R3NKdWYyZ1BFZmdGazZqUzFHYjdTUytuZmFYb2VXK1cvTlo0dUVMVHhYdmEzamZoL2NpZTVZM1ZuU1pDTllWZ1NmbGFrL2FPMGIzdU8zZzRBSVJ5MXVYSFZSeDBpaVQ1NUU5VmxYYmRwWlpxVXlYcERtQUlpc3ZDUDcycERxRVRHSk9NcnI1QzFYd3h0d3JKR0svL0FEK2JLM1h2K3NtK1dYTE9MbHlwdWt2Q1M4RmZzZTNzOXZiME5SeGxXdVo5NlpIVS9ZTUZhSnBMTVNyWkdLdGdXdHVHZyt5NDJmMXhJK0dIeFd5aGRMYmNocTAxNVBuUGVibVRkdHdOVHlJeUkrZlJVelRyaG1KVEptZmRxNzhxcjVZS1QrMEhiLzIvY25zS2c2ZlZqL3Z6SC9WYTJQWnRtTWU2TW1RMWVHZEE0MU1Sc1NIRWRGY3p6eGNXL0s3RzNTYUo2Zkdza1ZkYjN0YjlQc1R2c2ZaNTdZL3VOeEVhaVBBMmNkSFV5bDAxZEFPaW5hYVNwMjdKbk41Sk9UcE4rRlJ3ZGJpNUVnaStvNEhtc2U5MFltNnlKUkJ1RXIrV1BLK2F5UVRTNHVOaWJjNFZnUWNQenhWVnFOTDd1WEZsVXFlTytsOHZRbmwvTG5EcEpWOWpBQWNMT28xWTA2dm9icStoNlh4UzdiM2NONzV1ZTRhakl4SmtLQk9ZSUpqWkoxeEJKR09JNHJVN2pLYlRrNENCaTNjdkZPUGhOMGRONVljc3dvNU5sN1ZHWWpSaklHN3IvTlpPUERGM1A5V3ppekEwOE0rU0N4MDVLRGJWTDl2MzlHZlN6dTJHL08xZWIzRk5Ra0hSb3gxOGlKWGhoWTRXVmZyRG5zajNKeVc3M0d6UC9GTFc2MFB1bUpHb0RoSUhWNXJNYXkyMmI0cXIycHZ1Q2ptejdxTjN2dDF0QkFVeGxNU3ZWUkFJSXJBZ25tcEVzYjdYZFE3YjNIdUlmaExSZXYxWXhKcU1wV0xvQUNKdjZoYllSdFQ4cGJmaWFza25GdzhPVlA4QUF5VWt1YlRzSG9SY2JrSlJrTEJIVmRWcE1nU0VKS1FOQ1lRZ0JKTkpBQ0VrS0FOQ1Nha0FoQ0ZBTWFlMFd6OUJ4bmV0dEF3aklGL1JFbVI4UU55QVBYTFVCNW5KVEE5MjJVV0EvSitJaEtpQm5QSHBvamNySFhCWGFvbSswN05qZEhkTk5DRHBpWTRlN2poN3ZURGxTNVNwMytKdGxrbEtFWXQvdC9iZlJQdWpkL2U3ZjBCdVBWaVdpTDFEOE9kOE0xRmU2OXhlZ3hiUkFibUNKVHpvU3lvZFNlZlJSZnVtM250dDdOdUFNVzNKQ2NZeHVvbVdkQUhBOGNGc1JaMTdZTXVFQWc2Z2M5SnJsNUhISG1xUFc1M2puanJKeGlwZlZGZjcyOEdoUXpaVmxoSEhKUGhhbDIzNlUvRFBHejlvTnh0Y0h0VzRoMHVWU2p3R0ZFZkhpcEJQMnAydGdRZzVrTDFnUm9rakNydkR6VUwzUWYyTVlmekk2WldJZTZhb2NwRERETWpNSE5VTTNUT1dxVkdSTms4NjYvVldPbnpLWEhmbkYvcUtpRDFYS09GS2Z1TjBvdUt2ZjFNOTdMY1EzUWs3R1lsalZDdjVaQTl3bk00NGo0SzFXR2ZaNHVNdXV1UmxMeEd6Ry9DZk1MSmYrSzdXSkVYSituSTh3ZFAvQUZBVXU0Nm5Ga3pUeFJiNVIzcXU2UFNaZExsMDZpc2xjcVYxMGZndWtMeENjSEk2b1NFb25xRFlYdFpSaVVDRUlVZ1NhRWxBR2hKTlNEektJa0tJQkJ6QkZnK1lYejU3VzlzYjdmdUdaTXQrRjcxSmtqcEs4WUFBVUJHN0htdm9WVis5MmJXK1lteTZNSkFnU0Zhb243MFNlb1VVdXBQS1NUVWV2Um55bXl5OHc2MjdBMUhXQmQ4Y1JJR3NjeGlwZTV2QTY0WEp0NEFSaU1jb2pNZ1ZuWlhMdUhaOTEyYVpnOUV1TVRtREIrTjZTUWNOWDNKSHFEOHJUWjJPNzNQaWIyNzhnZVRjOVBQT3EraUxESEp2TlhYWjNXeGxlNTdYQ1dPVFZ4K3BPbjlXNjhmZys1emJsNmtqanB1OExCUFdxeTZoVk82bVNaUkdWMzAvRlMvWmRwM202Y29OUzhNdkZLWU1JeDVnazllQUY4MWZ2ZXhzNmNsRGN4a2E4RU5COFJIUXlNc0w4aW1KUmpOMzJSU1k4bVZSbkdITGcyN1haUDhBTm1JWW00K1NCR3ptVnN6YmsyWlJJUGh3ck9zYS9IQmNjbGNSWFBzY29sZXhoclpJT1FPQitRL05MM3VkekhaeDhVb3lrQjRZak8rUERtb2NOdzgwWnhnNU9Ba0tPbjgvSE5hVW95T042dlBOWW52enhPY0x2Nm5Yb2NRK1dQTlAzSlNYQzFMaXUvMk1zOXFteDNab1Rkcjl3MFFKNmFHc0QzU1k5WW5JOGpncmVlMzdicnN5aURmaWlENGJIUWlqOUFzSzdkMXhpWW0zS1VaRHFDUmh5dzZIcUZPR1h4dUlqUVBGK3E4NDgrZjFYa05WOHZ5UWw3cXl6OXVUZEpQOWo2cCtuZ3U4M3pUVWFWUmpqYnBiYnlkSmVLUngzVFliZmxGbVprMFQ0U1JqSGh6dzZLMTJqRUhZblZkanFER2pYQ3J6WEl0eTVWNTRmNkxUaWM4Unl3NS9pdlZmSzgwWjRuRk5jNDFiNnlYUnYxOG5sZFJxYzJvcDVKU21vM1NiYmpHK2l1NkxiZGJlRFFpWVhqSWcyYU5EcFdCbzU4clZqRHZ1K2FiMFFrM01BVkdVNGt5SFRuUjRYYWoyb2ZYbXJVN1lOTitwdUNJRHBBKzlMRG9GczE3aENLY3NuR1c5THJMMFM3c3QvaytybERKN1g5Ti9VUW5LTzNXTDhwLzNQRXQ3M0RmVGl6TGNPbjFaQ0FpUERIeEdzb1VzNkFVSzVMRlBzMXN2V2ZPNmxHb05YRnUrc3lNLzlvK0pXVjFWNFU2dHZ1ZXQrYTVNYnl4eDQ0eFN4cmVrbDlUNmJlQVNRaFpKNThFSVhrNEFvQ0YrMDJ5RCswRDRIaVlObm42Y3NKZlEwZnFvMTdOYmVVdDErNGtOTGJjVEdKSjk1eVlxaHo4TnJLbWlMeldtUTFSbkdqZlVTR09IRlJ2dW14bEh0d1oyYlp0dWJjNHhqNzNoT0pCek11cW02VkZsaHpmUjdEZGNuWEo5RXlXSkxpd1hDMDJYQlU5RWRZNVNySDRydXVTdWFvNWtBbVBDeVBvdWk4bmgrZUM5S0FpTDl1MnNmUzNBY2tIdzYrNUlpVUFCcHdpSW1PTjVaOWMxanp2dmFITnR1SXVReGFlbUl4QUp1TWp6R1AxVTFlZWM3TnVoS1JsUFp2azVDNU1PSEVuTFVZbkU0bkFYU2wwWk52eGpPSmc1SDNveUZTRjVXRHpYT0dUaXFkTnJ2K1RPc2VadzVLTHA3Y2wvRkVHN0gySWJUY1MzazR5aE1pVUlRSnhFRFdNeGpVcUdYMTVMSUtTRjJUT2J5U2NuVnZ3cVBFNUNBSlBUODE1cU1iOXA1dGtiaHNpTHA5TVBFeEJCamRIVkVaNmJPUnlKckdsZGZ1V0piajBOWTlXSTFhZlA4VFgwQlQzSW5OdVRiZmhsTVVKa0dvZnhHam55NHFZeThHcWNIVzlxOTEvZEZmMndhRHVXNGlYcFFjdUVqRXhpWlN4bUlBajNieUlzY2xJVmpMWjdudVV1OXRzUFNsS0RiVW91Q01TRzZJc1NQVDM4SVNPTkxKaW1SeEIyaEpwSnJrMkFoSkF1enk2SUJwSnBLUUpDYVNnQW1oSkFOQzR1eG5KdVloTFJNeElqS3IwazVHckYwdFRhUjNjWVZ1cHN6a0FBSk54bEcrWmtKRTllV0Nra3NVbDZVWDc0OXVXOXZHRzNNSXljbFU1eS9TMlBlb1kyVGw1RmE1U1VJdVQ3SldUR0xuSlJYZHVpajdpOUY3Y3lNVHFFUUkyT3RaMXp4NUt1MVZqZVg1L05LS3ZkeUcwZXFVYWI1WnlKUFVlUXdXMXVOMDI4eUpOVHdKQkJycnk0Rzh3dkpaTk5seTVZeWtxamxsZkpiMWZUN25wY3VveDZUQkpMZDRvN0o5U045N2VnKzRRSFkrRUNoZVBRVkVXZk8rQ29Oakt0d0llSTZzT2RIb2E1WG10UGRPYTNpUUswNGZNWi9GU2J0RzFuRFU5TVZyRkFkVDExY0F2YTZmUnhxTVAwcFUvODlUeUwxc3RMamVhLzV0dVVlM2Q5RjlpYTl1aG9maUFhRkc3SnJBY3I1cmQzZTkyWm5FYXk1Ui9RTGptT3Q5UDFVcUNYaXVObWpnYU9mQXJWa3lCUXF2SmJNdnl4eTFmOVJqbkdGUVVWSHQ4WFNOR2grYWFhT0xoclBmeVNjbkp1TFQ2MnQ1TWxldzd4RnZmaHVBL2x5ajQ1WFFPUExoMDZyTFN3QXk4TEVKQ0RZdWpMb09OTEpFZS9OTXo5SXR6bENPbUFtRFo4T0JrUitGWDVySXk2V1VGQmZ2bHZkSW5KOHh4WnMwNWNYaHgxRlE1TzI2NnV2Sk4wbHBiZmViZmRSRW1wZzNkQTRTd3o4Snh3K2kzMVh0TmQxUmxxU2tyVFRYb2VVbDZTVUhRa0pwSUJvU1RVZzh5akdZTVpBU0J6QkFJUG1EZ3ZTRUlCcElRb0JwdmJkbDV1YmM0Uk1YQnBtS0ExQTQ0bis2K2FIOXRHRGpnaEx3aVVxdk9nY0w0MHZwNTNWNmM5QXVXbVdrSHFhd0h6S3dGNFkySlIwa0dqWXlJekZMTzA4Wnk1Y2NuRHQwdXpHeTZqRHAwdmN3UE55N1ZMalJHUnNkVWhyeUYyTXZ3eFdxOUNJbVJFQUFZS1JQUHNtekZ3U3JBZ0NzZUNvR3g2am1OY3pjNHd3ODVtbE9tVTU1c2s4bGZTcXRMYVQ4bDlyWmFiSG9zRU1GcjNYN2pVbmNvcXYydnF0elgwcnJFbUJzRWc4TTFmU1lZazJhTkVFbUpMclFGWjFVWlM0L1pTb200NnBnYzdWczVSNFN1T3lUYlZJOHlvU3lTVWU3azBsZmxra0hxZUhWWk9nZGJ4NC9MQlZ1NDlTSU0yNUVUSC91SElqTHlXUU8zUjJqWGJOeEp6MDV2UzFBQ2RHWjhJRWFIUVhpU3NkNzZEc0d3Uks3d0drY09vT0s4YkNFdmM1UmFWK051cDZmUjZmSHBjV3BqcVZ6aTBvdUNqZjFMOVNiOGVUVTJlNGRlbklUT29WZkkrU21XdzJEL2RIUkNONkkxcmNPSWhIbHhOZTdGUnoyYzdjNTNEZUdBc1FFYmRjQXZRTC84QUZMS0krZVMrbE50dFdkbzFGcG1BaENQVG1lWlBVbnFTc2llTG5OU2syNjdGTGdiMCtvbGx4ZlNxcGJlVjNhOVA5ajJ1M2Iyck1HV2hVWUNoOXA0bk1sYmFFbHVOcmJiYmU3ZmQrUVFoQ0VBa21rZ0NJb0FaNFo4MTZRa2dHa2ttb0FLT2QzMlEzTFFjRXkyNjFqQ1ZrREg5SnJLemtlaFVqUW9hdlkyWTV2SEpTWGRHTHp2L0FQRU52TFlib0Z0L1VQVGRsaEgxSUhBT1pFRW53Mk03Vjc3UFRrMnk5dFhZbURqRG51U09PbVdVaHdzSEVZS2k5bzlvSXlHNGpHck9oenpyd1QrWUJqNWhiWHM5djN0dzdKbDJRbm9idUVpUEhRT0lNc3lQT3lzVk9zbS9pdnVpNno2TEhseExXWWZwMit1UGgzMDlQUXlKYWhYZU83T3RSbXhzeHFlSTk2SnhnT1lyQUhvTHg0S3c3M0YvOWpLVE15Mlc4VHAvVkdpQ1BqYXcxL2ltNWkzNlloR0F4aVNBUkkzbmNpVDhLVzZzbVNTakRqNnVUcmI4eXZoQlk4ZnZPTHkxSnBRWFJwWGNySmQyZGtiamNOamNQR1I4VXRJTkdVL2V4TitwVldaZENhQ3k2QlN3MzdPYlYxL2RIZHo4TUdRUmZTVWpFaXZJREUvSlRBYitUMFl1amZRWmk0NFl4aDZVSkVIVVFJbXlUaUt1NnpXNlVJNHZwVHZ6OXpSaWVmVkp6eWJOUDFhU2ZaYkltT2tBNnFGMVJOWTBQc3Nyb0NDQVJrUllWVHVJVC9hUFJsT1U1K2xNR1k4QkpJT1FqbDhsMG51R2RodDJ5ODVVWWlFTlJCTmtEaHpwY1djcURmYmR0MVZkeXpTV294dW1OekRXMDVHY2VZNmVkNWZOYmltN09IRnhkTk5mY1NhU0ZKeU5KZWw1VWdFSVNRRFFraEFOQ1NhQWF4eDdVNzdjN1VNeFowaUZHYmxnRXlvZ0NIQWM2eHlXUjFRZDM3WTEzWGF5YWtCckFKYW4xaFBwanlPVWh5VVVucyszVTdqSlJkMWZmclc5Yk0rWHR3L0o5MlU1QUN6Z0J5NURnRTJZT3l2UklqSEhFL0hvcmxydHBpWmg4R01veU1kR1JCQnJIbmlyRmx1TFVRT0p6NjJjTFdkaGVMTE40azFzdmg4RG5XWWMrbjAwYzg0V3NqcFh1OStyWHIwT1RHMGFqUFhLT3FYSTlGSnVuSXF2YW5wbGoxVm1NVmVLS2pzbFI4L3o1SlRrcjM4RmI2VG1vMTljbDMwVHJFajg4MXRyY1laOVl5dVFqR0VkVWlRVGhZRllkU1RRVXQ4ZDJhZmNuTnBKS3lOU1luWnVsdE1hc2RWL01jMWVQTUNJMXducmhkYXRKajRzNm84TWZKYUJIVXJSR0NjMWtVcGZiL094Y3orWXlubzNwY21ERjNpNDVJcXBLbjZmdXZ5ZWdUREdKTVQwSU5FSGhTc21PNGJuYXpEaGVjbldjSnpNb2tjamY0NXFzd0gwVk82K1hNS29majUrYWpQa3g0bzNPdXRMYTM2STUrVjZEVmEvTW9hZmtrcExuUGZqQmV2OWpOdXg3dnRlNFNNR3pJVEFzd2tQclJ5Tks5V0Z2WndTUGNXOU9VWU9HWGxWZmlRczByek1aYzk2cGZlejZEcnRLdEhsV05TYy9waTIzWGY0Q1FoQzJGWUpDRUtBRjFtbXZOWGdjYlhySlNBUWhDQUZqTDJxMmJiTFA3MGVFYWhGNnV1ckFTK3VCK3F5YW8vMzFpTzU3WHZXNUNVdjVFNVZFMFNZRFdLejZnS1ZKeDdOcjdHdWNJNUZVbFo4NCtzdzRLYk9SeU4zOFZzTTdrTjBQUmFsWFdReCtaVU9aa0l6akkzVjQxblJ6cFNCbWNYblp3ampIVFk4N1diZ3p4eFE0eTVTM2J2N25VTkhMTEpSaEpXM1NUN3QxWmJuZkRUWDdka1ZnRDVtemZQaGVTMmRxNk53K1JCbHRxVW01MW92QWlOMUd5YUpBSTUyVlJaWUxmMmVxTDBYSWt4TGRUQkF2R0p3dmhlZkJXT1ZSOXVYUmNlKzVnUm04VTFKL29rbitESmp0UkV4RkMrT2Z3SkM3YnVNUTFNeWlEUTVTamRZZ0N4bjh5cXhyY3RhNWVIVEdSSkFKRlJzM21RY0IwdGIyNmZiRUJHT0psSEFqQVo4Sy9CZVlVcTdIdE1VNGF4L3kzeTVkL1MvSmtYMmMyak8yN2EwVzRtSmV0MXpVS0puTHAvVEVlR1BBS1hxTmRnY0RuYldLeHJWRThDSkhCU1JaRjJVR1NIdHpsRC9BSXRyOEFRaENnMUM2MG1taFNTSkpOQ0FFSVNVQUUwazBBSVFoU0RTM1cyYjNiVTJwZ2VPTlgxSCtoeEhGWWEzVzEzUGEzekFTbkVuM0hJa3g5U040WlYxemplQldjbHF2c1FmaUl6RVRSc0V4Qk1aREtVYnlJT0t4NTQrVy9ab3R0RnJYcGVVV2xQSEx2RitmTzVyK2dYSTA1SWtTYWpDWTY1R3pkMWpaNldveFAyY2FOK205T1BJU0VaRDUxcFhkeGp2TEFJWjNEZTRqbnFkRVE1L1NPaDh5dG5iN3pldFliMWllT1Uyb0NjUi9Yb0pJdzRLZS9Sa3dsbHd4Y3NlV0ZQdkZOVy8vd0NaSTJkdjI4YmZZUzIyZHhucTBuT1JIUS9RS0xkb1o5Q2JNcGpWSGRSbkRFWFRqY2lkSnNaU0F1dVk0S1gvQU9LYlFTMCtyUjR3Y0g0d1hCcmQ3QVJBYjhRak9SR2xwMldtWnNrandISEUvVmROZHZRMHh6elVjc1dtL2NkdnAwZjUwV1RzSFprYVRBUnJ4Um5IVnF4K1dXZWE1Q0QweE9MOFdIR3p5RXZqR1ZnMTVyME40ektZaEgxREtyMGhweXdEa1pYRWFiNld0MFpubU1MeHJ5SE5kR0hiUmpJLzRqMmFEOFlzUm5HZi93RG9nTUJXUk1BS0I4d0JlZHFFL3dDSTl3Mnp3ZWh1M28rcE1hN2xjZk13UGh5NExQYmNKUkxzcGt5MXl3aUNaUmpFQ2dBRFFCSXhseEt3bDM1bU1IdHhvYWszRFVLQmlRQWNMcmhkbkJZN1RpMVRQUTZmSmoxTU1rWjQ0cWFTbnlYNitINlhmbjBKeDIvMm1hZGw2ZTYwd1BSMFpIcFVvOUQ1WWVTbjBaV0xGSEN3UmtSd1dDdHAyZmNicG9saUdvRDlWZ0FrZEJkZlFLYmRrajZzWFczSFhoT0EwK21ISlEwaXFOUXZDaUs0THFFbjIzZnF6blc2UEhGU25EaEJ4cm5qaTNMamY4VVpFUWtMNi9KQ3lEellKSVFnQkNFSUFUU1FnR2hDRkpCaXIybTJZYWVodVlpb3ZlR2ZJVGlNRDh4K0NnTGhFTk1xdXBSenl6SDF4eFgwQjNEWngzKzJteWNMb3hsOTJReVAyOEZoTHVHdzNHMUpiZGdZM2xMOUpvNWlXVmZFTEVwd3pRbDJYSmJuck1PYU9wK1g1dFBMZWNjY2xGZFh0czE2b3RkZzF0bm5qNmtTY05WZnA0NFZlR2RYaXQzZDdQMFNaTWdtSnpIM2ZMTWtMUjdPQkowek00eDBqRFYxczFRNHFiUkVZZjIrVi81cXYrWS9NTTJnK1lYQ2NwUjRSdkcyK0x2dWw0OUdlQjBXa3g2clN1T1NLVXVVa3BKZlVxMklMa3U4SFMzSUdNakU4RFgrbzRLMzdpeGNmV0dHaUVqTGlCamtvUEo2VXNzRjZuQjgwMCtmVHh5dWxLWGZHbnljWGZaLzdNWEQvd0JkMW1mUEtHS3VFR3Y1c3ZwWG5aTGRrbzNyL3J2T1NFaVk2dkJuV2tZQ2djdm9xdVRrWUN6OUFxY09USDZpdVVpVGlUYTVsOHloR0ZZNHUrbDErUjZiRC8wL1BQTW5xTTBQYnUzd1R0K2l2c2RuSHBTendISUx3M0NUczR3Z05VcEdvam1lUzVackkvYk8zdE1Pc0VnU2NEa1phOGZvTWNzYTRyeTJmVmZYRjVIS1VweVVWL2Y3SStqMXAvbFdEaGh4Umd1TDR4aXF2aXU4bjErNzNKbDJ2dHJmYjJCRUFGeVF0eWZVeTVBL2RHUVY0bWtydEt0a2ZOTW1TV1dUbk4zS1R0c0VrMGwwYWdUU1FvQTBJUXBBSVNUUUFvLzNydVRYYTlnOXVIQnJ3MFFoOStjeFFqNVprOEFWSUZoai93RDZCT1piMkxVUkl4TW5abXVZRVFQeEtnbEp2Wkt6Q2pJWjFIMWpNRHBvRi9pdDRPTU11d2x0L1VrS0lrSjRHenlwVTVCSFJiTE1oQ1d2QzQ2YTY0Nmhmd3RHYll5bGprcEs0dUx0UDErSk5vN2VKaHFsQXhrY3hlRWNjeHhxdXRYYTlOc2xrenh1SmpSNTRVUmgxeCtDM3NEV1ZWZkVBaTd3dlBQcnhXaHVYd3lPaGwwQXcrdkt2SlZzZFRtbGNlVGZKVnhlNitGOWpCeVE5eTl0M2Y4QUU2RHg2dWdqRW42ZnBXdko5eVFrYWpFeG9DaGdSek45YVdnSG5aeUU0a3hpRFZYWk9yUDZoYkpHTlZqSSs2TVNlV1dmeVZscE1MazNhVFd4djBzcDZDRTI1Y1hMYjZlL1o3L0IwWmE5am5KelkzV3FWZ09Rb2Nyamo5Y1Bvc2xYd1VGOWw5aHVObHQzWlB4TFplbEV4Z2ZlQWlDTlV1VjNrY2NGYWR6NzN0KzJFeGxHYmpnQU9pUFM4clAyTGJtNHFiNDFYUWhaSlNYS2Jiays3ZmRzczU5eFliM3JXeUpQcXV3bE1jcUhROGpJQWtlU3RsZ1hzYmp2Y3UvaCtlcVppSnV5SU5DTkNoaHl4RWFXZWxwVzVPL1hxQ0VJVWtndkthU0FFMGswQWtKb1FDUW1rZ0doQ0ZJQkNFSVFjbkc0T3dNSmk0bk1XZnhHSVBFTGpGa3dnWXduTVhrWkhVWStWLzN2RmJTMHR6dTJkbkRXN0tnY0FPc2p3SDRwVjdJT1NnbTI2WGxudmI3ZHZidzB3QnhPcVVwRXlsT1gzcFNPSks1YnJlTmJRUk05UjFtZ0lpemhtb1IzVHVrbkhnMnpNK2xBaTlFcTFucjRoMHJBZlZVKyszczk5T0psSFFJaW9qVVRYRzhQd1dkajBzcFZ5MlRLYlA4QU1ZUjVxTzhrMGsrajhtU1d1NTdOL0NMN2VySXhNZ0RmTEdyK1MzWG1HOXhBdHV3aTVDV0JqSVdDc2E5ak8yaHV0VHNveGtSVFdyQUdSenhPQWxXVjU5RmxDUjBBazRVQ2ZvRnB6NDFqbnhWdmJyK1JtNlRVVHo0dmNkSjMwNzdlVFEyVTl2Tm9qYmdDRGJrMnFIU1VKVWZ0SEJjSGUydHVQeDNFSnpaY0JHcVVLOFlIU1FQTVlGWXg5bnU3ZnRkekp0eS9UM003d3gwdUU0R2gwbGRINUxOQzR6WWZhbFg0R1ppenlkeVRmSjJwZXQrYkVQTzBMMHZLMUVpUWhDZ0RTVFFwQWtJUW9BMEpKcVFDMTNtRzl4QXR1eEU0bm9meEhJcllRb2FzbE5wMnU1akZ2Wnc3WnZuRzcxQ2NiYU9IRzQxekl3SGtyd0FERW5IR2htQitmOUZIdS9Qelk3aFkvd0MyMlQ4akxMaW01M2ZieElFUkp3WmsrNlBsZVovTnJ4bnpiRFBMcUl6Z3BTdUtUKzhmeUxOTEhvOFVKNVp4aXN2S2ErTDMrNWFQN2hsZ0QxWnhnVDBOazhjQUw0WkxIRzhrekorWlpyUmhWQ2hkWTBPbUs3N3Q0YmpjT1RCa1luU0FEZ2FBeStTcTVqU2I1L25EeVczU2FkWWVzdVVvcTEwTWo1Wjg0eHgxY29aS2hCcW96dDAzNi9mb2VWYlE3WnUzWWFoQUQrbzZmZ3QvdE8zak9SZWtBUkhDTi9lclA1WWZWU1poeVFJR0pzZ0VuUEhOUm0xRTQ4MWpVYmhYSzc2OUVlcTFuekwyY3NNV05KOHIrcDl0bGRJaXpQYWR4ckFjQWpBRUV5MUEzNVYrUXNqYkZ2VTlIazJQOGg5U3ZNTnZOektKa1BoOVRtcEJ0V0MxR1JsV3FSK2dHUVdyU3JOck5SamxraTFESHZkTkxiNzkyeWgxdXRsbGo5VGphVkpMMTZtK2tta3Zhbmx3U1RTVUFFMGsxSUJDRUtBQ0VJVWdGRFBhUFpIY2JXTDBCYzl1VElqbTJmZStsQS9JcVpwRUE1aStDNGxIa212SmtZTTB0UGxobGozaTcrL2xIempJUWtCNGJQVzZJK1dDMHA3ZG1mdk54UHlWMXYyWTdiZHZ0UTkyRGtoSHk1ZkxKVnFwOTRzK3VSaml6UWpKd1VsSkovVWsrNnM4UmJpM0hURHdqZ1ZHblc5RWpkK1ovSlVwdFcyMTdSSGZnemRNb1J5aVkxWnJNNGdpdnhVUFBIQXVVM1M4OWY4QXlVdnpIU1lmYTVKUmhLUGFsMzlOaUJ0T0J1TWhqWmxFeFBHUDBYMFAyUHNqV3doRjV3Qnpjempaa2NRM2Y2WWNlY3V2VEJZVzNleWIyazViZkZ3eE9FdE9rakFjVFMraSszdUYzWjdhY3Zla3kyVDU2UXJmRG01d2ZIOXNxZjNSOHdlUlpjc2xUL2wvU3IvaXl4V01QYUhaQ2U0OVVIR1VJZ2c1SFRZSGwvZFpQV0pOMjY3SitVcGtuV1NBQ1NhbzVjdklCVnV1eU9NWUtQZHkvZ3U2TTdUNWxneXdtMG52VzZzM2ZZL1kraTF1dHpJVkoxMHR4dlBURFA2eVB3V1RDUUJad0E2bkphZXpZRzMyN1RmS0l2OEFxT012aVN0dVVSTUdNZ0NEZ1FjaUZhUi9iSDdJMTVIeW5KcnEzL3M1TlB0dmFpM0xVSW5TU01yNEhJL0pkamdubGtoZEdzRUlRaEFJUWhTQVFraFFBUWhOQUNFSVVnRUlXUGU0OTRlTGpqRFA4b1FrWW1ZTnlsWEw3bzhzVnR4NDVaSFNNVFBuaHA0OHBmQkxxVHR4MXRtSms1T01CemtRUHhXSTk5dXBidmNUblowWDRCalFBb0FnWllqTmFNaVptNUV5UE9SSlAxS0tWeGgwNnhidDIvOEFSNVhWYStXb1NpbzhZM2Zmdjl4QVVoZTE1NjRMT0tnMU53MTZyYzRkVGw1NWhlbSsrZHgyTEU5czZSdUl6YmxCdWNpZGNOVWF6cnhBWGxMNnJ2UzRPdEJ5SkJ3NHJYUEhHZmRGbHB0VkxCdCtsdmNqbTNkTzNkYWNqbkNjWjRkZE1yL3N2cFpoNkc0YWc2MlJLRXhxaVJ5UDVvcjVwbTNwdzVGU0hzWGVITzI3bUxNaVo3ZDJZRW8vY01qUW5IbC9GekhGWTJyeGM0cVM3eC8wZWowK1ZXL1V6OHZLYVNvUzNCSmVrbEFFaENhQVNFSVFEUWhDa0FoQ0VJTVFlMGh2dUV1RGJjVDlDVkdhTmRTcEgzNGYvd0FwUHFKUmlmSWdWOWlwS3BVR29sOWRGZjhBT05WSEs5UGlqZjhBSngwL3ZMYzBUSEgvQUNYUVFrWWpUR1JKSkFvRTRZWFZZRTJ2VG84TjhsT05ocVkyVUNjQ2JQWEFFNEVEcGhad1dEbXplMUZTcmsyNm9yOUhwLzZxYmp5NHFydXZYcUczYUREVFRkVktJQm1QNHBDNVhYeDVLNTJHM2dkeWJ1WGhNanF4dVg0QVk1QUxValI2NGZBM3g0cVI5dlpJdDNJRVVPZGMvc1dCb2xQTHFZN1duTGxQeFhmZit4Ny9BQzhZWWw1akdvdjRWdDhDOFRRa3ZkbENDU0VJQm9TUWdCTkNGSUVoTkpRQnBJUWdHaEpOQWZQdnRFWjdidWU1aUFQRVl1UncvVE9OMzlRVldiQ0RtOGtSRVhScXhrQnpQSlpXOXArMU43cHFPNm82bVJVNk5XMGYvS1Q5Q1ZFZTBPYlhhd2xEV1ltVXJrWjhNcU1SWDE2bGFOWDlPbGs4V0huazIzVWIrTG90ZE44eTFHTExCU3pQaEdMU2pKN2RxWDNvdUcrMWJhTmF3WlZ6bFFQeS9zcmNWRWFSZ0k1QVlZY2dxZDN1Mnpha1JKeTVSd0lBSitJd1AxVk9PNk9UZkdnU25DV0VZQUEyVGdDS3h1K1BXbDRmK2wxZVhlY1oxVHJtbXJmL0FNK3BkUWVUVjMvTVUrS3ZlUk5OcDJ6YmJ2Y3VQdndEbW1MZWlCOTBaM0tRNjlLR1FwVG9Dc0JrcTNZN2NzTkRXQUhKMFoxMC9oLzIvRTRxelhzOUxqbGl3WTR5L2NvN25rNXhqR2MrUFdUZjNZbFRmNFl3WGZVbGN2RnJFVFdrSFB6T1BOWEtGa1R4eG5YSkowN1JyR2toQzJFZ2tta2dCQ0VJQVFoQ0FFMElVZ0VJUWdCQ0VJRGxPV2lFcFo2UVRRek5DOEZoSzdKUE1rL1Zad0lzRWM4RmhFeDBreDVFajZHbGE2TDlmd1BOZk5yL0FKWGo2dnhDa1pJUXJZOHVDc2R0QnFZbnEwNnNOQWtTSThTU0t4NUMxWFpKNGhRMWFxNk5rSHhrblNkZEdkSDR4ZzRSQ1FsR3pSRjVmTmE4aUlpUlBRRW9WUHU5eGR0akxxZWE2UnRoQjVaSkx0MTlFYWY3aWNybEdxSFFnSDhWeTNGQTZvZ1JPa1RIQTUwdUVaYVoxOTdCYzVSa1czWFQwdytaVU05QkdDakpWdFhiMXMrcUVrMGw1UTlJQ0VrS0FDRTBrQUpwSnFRQ0VJUUFoQ0VJTVpkN1kxYnFic2E4SWpxK1l2NFY5Q29zWS9rS2RPeUc0ZWZPTkZ3ajVSaUkvRlJIY016WWtRUjRUN3Y1eStLOGJQUEdlZkxIeExiMVJnL05kRzRjTTBVOTRwWlBSMXMvd0t0enc0bXlPR2F5WkFOeWdCa05JcittaC9wZ3NlTk15ZmNqREN6OHdJOVNUd0N5U3lOTW82Y0tNUVB3L3dBbGk1c2lXVEN1NzVicjBlMzRtejVSQnVHYVZiT2tuNXJkcjdlVGp0OWpQMTZpZjVCQmxJZmRQVFRuNzN3eFV5QW9BRElJcWsxN0hEZ2podXU3N3Z5WnJmVG91eXZ0ZmowRWhDRmxuSUpKcEtBQ0VJUUFtaENrQ1RRaEFKQ2FTZ0Fta21wQnljQUxjd1k2d1l5dUgzaFh1L1BKZkxUZTVlaTdKcjA1U2xaRVlBR1V3UWZkeTFHdnF2cXBhOGR1ekJ5VGtXbTR6bjcweENJbEx6a0JaVzdIazl1OXJzMVRncDdNK2N0dDIzZGJpWkV0dS9xSjkyVGM0L1c0aFpmN04ySWJNaDkvU1hSN2tCakZyN1pWOGgwVTN0QzF6azhrcmZ3WGdzbzZod3crMWpqR0ZxcHlYN3AvZCtBU1FrdURDQkNFSUFRaENBYUVrS1FDRUlVQUVJUWdHaEpDQWFFa0tRTkNFSUJFZ0N5YUE2bFlaM01tNWJoNlVEcUJjbVFlaEJrY1FzeE9OeGVoSnVXTVpBZ2pMQXFnMi9ZOW96TFZMVTdqZ0orNlBrTS9tczNUNVk0dVRkN3JzaW8xMm55YWhRakdxVGJiYi9JeGhZVnp0TzI3bmQ0d2pwaDkrZmhIeTZuNUxLY2R1ekNRbEZwdU1nS3NSaURYTEpiSzNTMWpyNlkxNnRtRmorVkpQNjUydkVWWDhTQWYvanN3UC83RWI1ZW1hK3BsZndVYjNtemQyY3hGd1o0aVF5UDU1TE1TcU80N1Q5NnhvRmF3UktKUFE5Zmd1Y1dxbnlYTjNGOS9RM1ovbDJMZzNpVFUwdHQ3djAzTVB5OGVGME9DMUR0WUdOWTN6VWczdTNqdG5SQ0JNZ0JSbFZBekJPcXZMQlY2dUl5VWxhN004emM4VGNiY2E3MFJyL0RwbVdNaFI2NC9nclE3UXV3anQyZ1pTY0lpQjFKUFZXUEZUcnNPem9TM014aWZDMzVmcWtQUEw1RmE4dVJZNHVUK0gzTERCTExxY3NJMzJkL2F1cE9FazBsNW85b0pDYUZBRWhDYUFFSVFwQUlRa29BMElRcElJUEZzUm5QSDliZzhxa2FYUTBjRDRoMUJBSVZlNXEydTREWHZDWUU0akx4U3pQMXNMY09SUExKZk9OYnA1NGRRMUx0SnR4K3pleGFZTS91NDM1anRKUHlpdzJyRFJuUWhFQWdud2lyK2lrRU51M0EySTQ4ODFyYk9MZ2Jqcm9ZWURyampqOWlzbDYzUmFQSGp4eGNvcWMzOVhLVWQxZlRxWW1USTI2WDByd3RrQ1NhU3VqSEJDRUlCSVFoUUFRaENBRTBrSUJwSm9RQ1FoTkFKTkNGSUJDRUlBUWhDQVNFMGxBQkNhRUFrSVFnQkNFSUFRaENBRTBrMEFKSm9RQ1FoQ0FhRUlVZ0UxNVRRRFNRaEFDRUlRRVE3N3RnZHUyNUdOZWxJNWRJeXorS3gxajVMT1VnSkNpQVIxQnhCVk51SE5qYm5xbG95aEhSSUdyMHpvNks2M3dWaGgxSHR4NDhlUlJhclFyTFBtcHFGcEttdkh4TWRiVFpPN3AxdU9tWWhLVkdlazZhR0p4eXl5NHJMc0lSYmpHRVJVWWdBQWRBRW14RVFpSWpTS0ZES2hXQXJvdXEwWnN6eXZ0U1hRek5McFk2YUxwOG5LcmY1TDBCSk5KWXhZZ2hKQ0FhRUlRQ1FoQ2dBbWhDQUVJU1VneFYzUGVTZDNyY293azNGc0FEVURFeXE4ZkxvcEF6TFVZa253eW8wTXdPQ2pmZDNKVDdoTy8wR01JZy9kR04vUFA1cVFiUUgwbXhocW9aY2NsUi9Qc2NWaTArUkw2bEtxOHJ2WDRtTjhzbTVhalV4dTFWMzIzVHF5YlFNWkR3a0VEODRycXRaaG9OUXI2bm1Wc3ExeE9UeHhjb3FNcVZwZERNbFZ1dDE1RWhDRnZOWUlRa2hJMGtJVUFFSVFnQk5KQ0FhRUpJQm9RaFNBUWhDQVNFMGxBQkNFMEFrMElVZ0VJUW9BSVFrZ0JDRUlCcExoNm85VU5hWkVtT295L1NCa0w4MXNJQklUU1FBaENhQVNFMGtBSVFoQUNFSVFBaENFQUlUU1FBb2M3MnFUL2RRL0tpelVaK2N4aHArR284Rk1rMTNHVGhiWGlqVGt4eHkwcGRHbitBSkpwTGszSHBKQ1NnQ1FoQ0FFSVFnQkNFSUJvU1RVZ0VJUWdJRDdRN1BMZHdIdWdCM3l1b3k1OWFXbnNlNEM0QnlCOE5SRW9qL0FNWEpaRmNiZzlBd21CS0p6QlVCM0habmR0TXoyNExrRGR3dkhoOVBxdU04SWFqQ296VnlnK1VONnBvd1l3bGgxQ3l4dFFuOU9SSkovR24wTWhydzVLVVlreGpybDBqWWpmek9BVWI3Yy92U0JCeG1SakhEVk9vVEEvaUI5N2hXS2xDaFBsNkZqSlYxVFhSbzRzbHd0eDlVUmpQcUlFbUk4aVFEOEYxUWhkbkFrSVFnR210TGM3WnJkdGxwMEV4SkJ3SkdJeU5naGJnRklBU1RRZ0VoQ0VBSVFoQU5DU0ZJR2hKQ2dEU1FoQUNhU0VBSVFoQUNFSVFBaENFQUlRaEFOQVNSRTJMcWxJR2ttaFFCSVFoQUNFSm9CSVRRcEFrSm9RQ1FoQ2dBaENFQUpwSVFEUWtqUHlRSHBKTkpTQklRaFFBUWhDQUVJUWdCQ2FTQUUwa0lCb1FoQU5DU1NBRUlRZ0JOSkNBRTBrSUJvUWtnQkNFSUFRaENBRTBrSUJwSVFnQkNFSUFRaENBYVNFSUFRaENBRUlRZ0JOSk5TQVRTU1FEUWtoUUJvU1RVZ0VKSVVBYUVJVWdFSVFnRWhOSlFCb1NUVWdFazBrQTAwa0lRTkpOSkNSSVFoUUFRaENBRTBrMUlCQ0VJQklUU1VBRUlRZ0JDRUlBUWhDQUVJUWdCQ0VJQVFoQ0FFSVFnQkNFSUFRaENBRUlRZ0JDRUlBUWhDQWFFa0lBUWhDQWFFSktRTkNFSUFRaENBRWtJVUFFSVFnQk5DRklCQ0VJQVFoSkFDRUlVQUVJVFFDUW1rZ0doQ0ZKQTBrMGtKRWhOQ0FTRUlVQWFTYVNBRTBrMUlCQ0VJQVNUUWdCSk5DQVNFSVVBRUlRZ0doSk5TQVFraEFDRUlVQUVJUWdCQ0UwQUpKb1VnU2FTYUFTRTBsQUJDRUlCb1NUVWdFSkpvQVFoQ0FFazBrQUlUUW9Ba0lRZ0JDRUlCb1FrZ0JDYUZJRWhDRkFCTkpOU0FTVFFnQkNFSVFOSk5KQ1FTVFFnRWhOQ0FTRTBJQklUUWdCQ0VJQVNUUWdCQ0VJQVFoQ0FFSVFnRWhOQ0FTRTBJQkpvUWdCSk5DQVNhRUlBUWhDQUVJUWdCQ0VJQVFoQ0FFazBJQkpvUWdCQ0VJQVFoQ0FFSVFnQkNFSUFTVFFnRWhOQ0FTRTBJQVFoQ0FFSVFnQkNFSUFRaENFRFNYcEpBSkNhRUFrSm9RQ1FtaEFKQ2FFQWtKb1FDUW1oQUpDYUVBa0pvUUNRbWhBSkNhRUFrSm9RQ1FtaEFKQ2FFQWtKb1FDUW1oQUpDYUVBa0pvUUNRbWhBSkNhRUFrSm9RQ1FtaEFKQzlKSUJJVFFnRWhOQ0FTRTBJQklUUWdFaE5DQVNFMElCSVRRZ0VoTkNBU0Y2UWdQLzlrPSIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7IiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIj4NCiAgICAgICAgICAgIDwhLS0gSGlkZGVuIEZpbGUgSW5wdXQgZm9yIGZ1dHVyZSB1c2VyIHVwbG9hZHMgLS0+DQogICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImltYWdlSW5wdXQiIGFjY2VwdD0iaW1hZ2UvKiIgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij4NCg0KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3RhcnRTdG9wQnRuIiBjbGFzcz0iYnV0dG9uLWdsb3cgYmctcHVycGxlLTYwMCBob3ZlcjpiZy1wdXJwbGUtNzAwIHRleHQtd2hpdGUgZm9udC1zZW1pYm9sZCBweS0yIHB4LTQgcm91bmRlZC1sZyI+DQogICAgICAgICAgICAgICAgU3RvcA0KICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICA8YnV0dG9uIGlkPSJyZXNldEJ0biIgY2xhc3M9ImJ1dHRvbi1nbG93IGJnLWdyYXktNjAwIGhvdmVyOmJnLWdyYXktNzAwIHRleHQtd2hpdGUgZm9udC1zZW1pYm9sZCBweS0yIHB4LTQgcm91bmRlZC1sZyI+DQogICAgICAgICAgICAgICAgUmVzZXQNCiAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgPGJ1dHRvbiBpZD0ic3BlZWRCdG4iIGNsYXNzPSJidXR0b24tZ2xvdyBiZy1ibHVlLTYwMCBob3ZlcjpiZy1ibHVlLTcwMCB0ZXh0LXdoaXRlIGZvbnQtc2VtaWJvbGQgcHktMiBweC00IHJvdW5kZWQtbGciPg0KICAgICAgICAgICAgICAgIFNwZWVkOiAxeA0KICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgIDwvZGl2Pg0KICAgICAgICANCiAgICAgICAgPCEtLSBVcGRhdGVkIEluZm8gRGlzcGxheSAoSGlkZGVuKSAtLT4NCiAgICAgICAgPGRpdiBpZD0iaW5mbyIgY2xhc3M9ImhpZGRlbiB0ZXh0LXNtIHRleHQtZ3JheS00MDAgdGV4dC1jZW50ZXIgbXQtNCBwLTIgYmctZ3JheS03MDAgcm91bmRlZC1tZCI+DQogICAgICAgICAgICBHZW5lcmF0aW9uOiAwIHwgTGl2ZSBDZWxsczogMCB8IFBhdHRlcm4gSGl0czogMCB8IEZvb2QgQ0E6IFJ1bGUgMzANCiAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgPCEtLSBDb3VwbGluZyBSdWxlcyAoSGlkZGVuKSAtLT4NCiAgICAgICAgPGRpdiBjbGFzcz0iaGlkZGVuIHAtMyBiZy1ncmF5LTcwMCByb3VuZGVkLWxnIj4NCiAgICAgICAgICAgIDxoMiBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtcHVycGxlLTMwMCBtYi0yIj5Db3VwbGluZyBSdWxlczo8L2gyPg0KICAgICAgICAgICAgPCEtLSBDb250ZW50IHJlbWFpbnMgaGlkZGVuIC0tPg0KICAgICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCg0KICAgIDxzY3JpcHQ+DQogICAgICAgIC8vIC0tLSBDb25maWd1cmF0aW9uIC0tLQ0KICAgICAgICBjb25zdCBHUklEX1NJWkUgPSA0MDA7IC8vIE4geCBOIGdyaWQgKDQwMHg0MDApDQogICAgICAgIGNvbnN0IE1BWF9BR0UgPSAxMjsgICAgLy8gQ2VsbHMgZGllIGFmdGVyIHRoaXMgYWdlDQogICAgICAgIGxldCBDRUxMX1NJWkU7ICAgICAgICAgLy8gRHluYW1pY2FsbHkgY2FsY3VsYXRlZCBmb3IgcmVzcG9uc2l2ZSwgaGlnaC1yZXMgY2FudmFzDQoNCiAgICAgICAgLy8gLS0tIFJlc291cmNlIENBIENvbmZpZ3VyYXRpb24gLS0tDQogICAgICAgIGNvbnN0IEZPT0RfUlVMRV9OVU1CRVIgPSAzMDsgLy8gV29sZnJhbSBSdWxlIDMwIGZvciBjb21wbGV4IGlucHV0DQogICAgICAgIGNvbnN0IEZPT0RfU0NST0xMX0lOVEVSVkFMID0gNDsgLy8gVGhlIFJlc291cmNlIENBIHVwZGF0ZXMgZXZlcnkgTiBDU09TIGdlbmVyYXRpb25zDQogICAgICAgIGNvbnN0IEZPT0RfSU5KRUNUSU9OX0FHRSA9IDEwOyANCiAgICAgICAgY29uc3QgQ1VTVE9NX0ZPT0RfUEFUVEVSTiA9ICcwMTExMTAwJzsgLy8gNy1jZWxsIHBhdHRlcm4NCiAgICAgICAgY29uc3QgWF9DT09SRF9GSUxURVIgPSBNYXRoLnJvdW5kKDgqKEdSSURfU0laRS8xMDApKTsgLy8gT25seSB0cmlnZ2VyIGlmIHggJSA4ID09PSAwDQoNCiAgICAgICAgLy8gLS0tIEdsb2JhbCBTdGF0ZSAtLS0NCiAgICAgICAgbGV0IGdyaWQ7IC8vIE1haW4gQ1NPUyBncmlkIChBZ2UgMCB0byBNQVhfQUdFKQ0KICAgICAgICBsZXQgbmV4dEdyaWQ7IA0KICAgICAgICBsZXQgcmVzb3VyY2VHcmlkOyAvLyBSZXNvdXJjZSBDQSBncmlkICgwIG9yIDEpDQogICAgICAgIGxldCBpc1J1bm5pbmcgPSB0cnVlOw0KICAgICAgICBsZXQgZ2VuZXJhdGlvbiA9IDA7DQogICAgICAgIGxldCBwYXR0ZXJuSGl0Q291bnQgPSAwOyANCiAgICAgICAgbGV0IGFuaW1hdGlvbkZyYW1lSWQgPSBudWxsOw0KICAgICAgICBsZXQgbGFzdFVwZGF0ZVRpbWUgPSAwOw0KICAgICAgICBjb25zdCBzcGVlZHMgPSBbMTAwLCA1MCwgMjAsIDEwXTsgDQogICAgICAgIGxldCBzcGVlZEluZGV4ID0gMzsgLy8gU1RBUlQgQVQgTUFYIFNQRUVEIChpbmRleCAyIGZvciAyMG1zKQ0KICAgICAgICBsZXQgdXBkYXRlSW50ZXJ2YWwgPSBzcGVlZHNbc3BlZWRJbmRleF07DQogICAgICAgIGxldCBjdXJyZW50SW1hZ2VFbGVtZW50OyAvLyBSZWZlcmVuY2UgdG8gdGhlIGltYWdlIGN1cnJlbnRseSBzZWVkaW5nIHRoZSBncmlkDQoNCiAgICAgICAgLy8gLS0tIERPTSBFbGVtZW50cyAmIENvbnRleHRzIC0tLQ0KICAgICAgICBjb25zdCBjYUNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjYUNhbnZhcycpOw0KICAgICAgICBjb25zdCBjYUN0eCA9IGNhQ2FudmFzLmdldENvbnRleHQoJzJkJyk7DQogICAgICAgIGNvbnN0IHJlc291cmNlQ2FudmFzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc291cmNlQ2FudmFzJyk7DQogICAgICAgIGNvbnN0IHJlc291cmNlQ3R4ID0gcmVzb3VyY2VDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsNCiAgICAgICAgY29uc3Qgc3RhcnRTdG9wQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXJ0U3RvcEJ0bicpOw0KICAgICAgICBjb25zdCByZXNldEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXNldEJ0bicpOw0KICAgICAgICBjb25zdCBzcGVlZEJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzcGVlZEJ0bicpOw0KICAgICAgICBjb25zdCBpbmZvRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luZm8nKTsNCiAgICAgICAgY29uc3QgaW5pdGlhbEltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2luaXRpYWxJbWFnZScpOw0KICAgICAgICBjb25zdCBpbWFnZUlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ltYWdlSW5wdXQnKTsNCg0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBEeW5hbWljYWxseSBjYWxjdWxhdGVzIENFTExfU0laRSBiYXNlZCBvbiB2aWV3cG9ydCBhbmQgc2V0cyBjYW52YXMgYXR0cmlidXRlcy4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGluaXRDYW52YXNEaW1lbnNpb25zKCkgew0KICAgICAgICAgICAgY2FDYW52YXMud2lkdGggPSBHUklEX1NJWkU7DQogICAgICAgICAgICBjYUNhbnZhcy5oZWlnaHQgPSBHUklEX1NJWkU7DQogICAgICAgICAgICBDRUxMX1NJWkUgPSAxOw0KICAgICAgICAgICAgcmVzb3VyY2VDYW52YXMud2lkdGggPSAwOw0KICAgICAgICAgICAgcmVzb3VyY2VDYW52YXMuaGVpZ2h0ID0gMDsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvbnZlcnRzIFdvbGZyYW0gUnVsZSBudW1iZXIgKDAtMjU1KSB0byBhIGJpbmFyeSBhcnJheSBmb3IgbG9va3VwLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZ2V0V29sZnJhbVJ1bGUocnVsZU51bSkgew0KICAgICAgICAgICAgY29uc3QgcnVsZSA9IG5ldyBBcnJheSg4KTsNCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgODsgaSsrKSB7DQogICAgICAgICAgICAgICAgcnVsZVtpXSA9IChydWxlTnVtID4+IGkpICYgMTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBydWxlOw0KICAgICAgICB9DQogICAgICAgIGNvbnN0IFdPTEZSQU1fUlVMRSA9IGdldFdvbGZyYW1SdWxlKEZPT0RfUlVMRV9OVU1CRVIpOw0KDQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZGV4IGluIHRoZSAxRCBhcnJheSBmcm9tIDJEIGNvb3JkaW5hdGVzLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZ2V0SW5kZXgoeCwgeSkgew0KICAgICAgICAgICAgcmV0dXJuIHkgKiBHUklEX1NJWkUgKyB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENvdW50cyB0aGUgbnVtYmVyIG9mIGxpdmUgbmVpZ2hib3JzIGZvciBhIGNlbGwgaW4gdGhlIG1haW4gQ1NPUyBncmlkIChGaXhlZCBib3VuZGFyaWVzKS4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGNvdW50TGl2ZU5laWdoYm9ycyh4LCB5KSB7DQogICAgICAgICAgICBsZXQgY291bnQgPSAwOw0KICAgICAgICAgICAgZm9yIChsZXQgaSA9IC0xOyBpIDw9IDE7IGkrKykgew0KICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8PSAxOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGkgPT09IDAgJiYgaiA9PT0gMCkgY29udGludWU7IA0KDQogICAgICAgICAgICAgICAgICAgIGNvbnN0IG5laWdoYm9yWCA9IHggKyBpOw0KICAgICAgICAgICAgICAgICAgICBjb25zdCBuZWlnaGJvclkgPSB5ICsgajsNCg0KICAgICAgICAgICAgICAgICAgICAvLyBDaGVjayBpZiBuZWlnaGJvciBpcyB3aXRoaW4gdGhlIGdyaWQgYm91bmRhcmllcyAoRml4ZWQgYm91bmRhcmllcykNCiAgICAgICAgICAgICAgICAgICAgaWYgKG5laWdoYm9yWCA+PSAwICYmIG5laWdoYm9yWCA8IEdSSURfU0laRSAmJiANCiAgICAgICAgICAgICAgICAgICAgICAgIG5laWdoYm9yWSA+PSAwICYmIG5laWdoYm9yWSA8IEdSSURfU0laRSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGdldEluZGV4KG5laWdoYm9yWCwgbmVpZ2hib3JZKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdyaWRbaW5kZXhdID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gY291bnQ7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyB0aGUgbWFpbiBDU09TIGdyaWQgZnJvbSBhbiBpbWFnZSBlbGVtZW50Lg0KICAgICAgICAgKiBUaGUgaW1hZ2UgaXMgcmVzYW1wbGVkIHRvIEdSSURfU0laRSB4IEdSSURfU0laRS4gRGFyayBwaXhlbHMgYXJlIHNldCB0byBhZ2UgMSAoYWxpdmUpLg0KICAgICAgICAgKiBAcGFyYW0ge0hUTUxJbWFnZUVsZW1lbnR9IGltYWdlRWxlbWVudCAtIFRoZSBpbWFnZSB0byB1c2UgZm9yIHNlZWRpbmcuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplR3JpZEZyb21JbWFnZShpbWFnZUVsZW1lbnQpIHsNCiAgICAgICAgICAgIGdyaWQgPSBuZXcgVWludDhBcnJheShHUklEX1NJWkUgKiBHUklEX1NJWkUpOw0KICAgICAgICAgICAgbmV4dEdyaWQgPSBuZXcgVWludDhBcnJheShHUklEX1NJWkUgKiBHUklEX1NJWkUpOw0KICAgICAgICAgICAgZ2VuZXJhdGlvbiA9IDA7DQogICAgICAgICAgICBwYXR0ZXJuSGl0Q291bnQgPSAwOw0KDQogICAgICAgICAgICAvLyAxLiBTZXR1cCB0ZW1wb3JhcnkgY2FudmFzIGZvciBpbWFnZSBwcm9jZXNzaW5nDQogICAgICAgICAgICBjb25zdCB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgICAgICBjb25zdCB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOw0KICAgICAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IEdSSURfU0laRTsNCiAgICAgICAgICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gR1JJRF9TSVpFOw0KDQogICAgICAgICAgICAvLyAyLiBEcmF3IGFuZCBSZXNhbXBsZSBJbWFnZQ0KICAgICAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UoaW1hZ2VFbGVtZW50LCAwLCAwLCBHUklEX1NJWkUsIEdSSURfU0laRSk7DQoNCiAgICAgICAgICAgIC8vIDMuIEdldCBQaXhlbCBEYXRhDQogICAgICAgICAgICBjb25zdCBpbWFnZURhdGEgPSB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBHUklEX1NJWkUsIEdSSURfU0laRSk7DQogICAgICAgICAgICBjb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7DQoNCiAgICAgICAgICAgIC8vIDQuIENvbnZlcnQgUGl4ZWxzIHRvIENlbGwgQWdlIChEYXJrIHBpeGVscyBhcmUgYWxpdmUsIGxpZ2h0IHBpeGVscyBhcmUgZGVhZCkNCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgR1JJRF9TSVpFOyB5KyspIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IEdSSURfU0laRTsgeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBpeGVsSW5kZXggPSAoeSAqIEdSSURfU0laRSArIHgpICogNDsgLy8gUiBjaGFubmVsIGluZGV4DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZ2V0SW5kZXgoeCwgeSk7DQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAvLyBVc2UgUmVkIGNoYW5uZWwgZm9yIGJyaWdodG5lc3MgKHN1ZmZpY2llbnQgZm9yIG1vc3QgaW1hZ2VzKQ0KICAgICAgICAgICAgICAgICAgICBjb25zdCBicmlnaHRuZXNzID0gZGF0YVtwaXhlbEluZGV4XTsgDQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKChicmlnaHRuZXNzKjEpIDwgMTI4KSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGFyayBhcmVhOiBDZWxsIGlzIGJvcm4gYXQgYWdlIDENCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRbaW5kZXhdID0gMTsgDQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IA0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gTGlnaHQgYXJlYTogQ2VsbCBpcyBkZWFkDQogICAgICAgICAgICAgICAgICAgICAgICBncmlkW2luZGV4XSA9IDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vIDUuIEluaXRpYWxpemUgUmVzb3VyY2UgQ0EgR3JpZCAoU3RhbmRhcmQgUnVsZSAzMCBzZWVkaW5nKQ0KICAgICAgICAgICAgcmVzb3VyY2VHcmlkID0gbmV3IFVpbnQ4QXJyYXkoR1JJRF9TSVpFICogR1JJRF9TSVpFKS5maWxsKDApOw0KICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBHUklEX1NJWkU7IHgrKykgew0KICAgICAgICAgICAgICAgIGlmIChNYXRoLnJhbmRvbSgpIDwgMC41KSB7IA0KICAgICAgICAgICAgICAgICAgICByZXNvdXJjZUdyaWRbZ2V0SW5kZXgoeCwgMCldID0gMTsgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBSZS1yZW5kZXIgYW5kIGVuc3VyZSBzaW11bGF0aW9uIGlzIHJ1bm5pbmcgYWZ0ZXIgaW5pdGlhbGl6YXRpb24NCiAgICAgICAgICAgIHJlbmRlckNTT1MoKTsNCiAgICAgICAgICAgIGlmICghaXNSdW5uaW5nKSB7DQogICAgICAgICAgICAgICAgaXNSdW5uaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAvLyBzdGFydFN0b3BCdG4udGV4dENvbnRlbnQgPSAnU3RvcCc7IA0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29tcHV0ZXMgdGhlIG5leHQgc3RhdGUgb2YgdGhlIFJlc291cmNlIENBIChXb2xmcmFtIFJ1bGUgMzApIHdpdGggdmVydGljYWwgc2Nyb2xsaW5nLA0KICAgICAgICAgKiBhbmQgYXBwbGllcyB0aGUgY3VzdG9tIGZvb2QgcGF0dGVybiBsb2dpYyB0byB0aGUgbWFpbiBDU09TIGdyaWQuDQogICAgICAgICAqIE5PVEU6IFRoZSBSZXNvdXJjZSBDQSB1c2VzIHRvcm9pZGFsICh3cmFwcGluZykgYm91bmRhcmllcyBmb3IgaXRzIDFEIHJ1bGUuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBjb21wdXRlRm9vZENBKCkgew0KICAgICAgICAgICAgY29uc3QgbmV4dFJlc291cmNlR3JpZCA9IG5ldyBVaW50OEFycmF5KEdSSURfU0laRSAqIEdSSURfU0laRSkuZmlsbCgwKTsNCiAgICAgICAgICAgIGNvbnN0IHBhdHRlcm5IaXRzID0gW107DQogICAgICAgICAgICANCiAgICAgICAgICAgIC8vIDEuIFNoaWZ0IHRoZSBleGlzdGluZyBwYXR0ZXJuIERPV046IFJvdyB5IChuZXcpIGdldHMgc3RhdGUgZnJvbSBSb3cgeS0xIChvbGQpLg0KICAgICAgICAgICAgZm9yIChsZXQgeSA9IEdSSURfU0laRSAtIDE7IHkgPiAwOyB5LS0pIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IEdSSURfU0laRTsgeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIG5leHRSZXNvdXJjZUdyaWRbZ2V0SW5kZXgoeCwgeSldID0gcmVzb3VyY2VHcmlkW2dldEluZGV4KHgsIHkgLSAxKV07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyAyLiBHZW5lcmF0ZSB0aGUgbmV3IHRvcCByb3cgKHk9MCkgYW5kIGNoZWNrIGZvciBwYXR0ZXJuIGhpdHMuDQogICAgICAgICAgICBjb25zdCBzb3VyY2VSb3dJbmRleCA9IDA7IA0KICAgICAgICAgICAgDQogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IEdSSURfU0laRTsgeCsrKSB7DQogICAgICAgICAgICAgICAgLy8gRmV0Y2ggNyBjZWxscyAoTDUgdG8gUjEpIGZyb20gdGhlIHNvdXJjZSByb3cgKHk9MCkNCiAgICAgICAgICAgICAgICBjb25zdCBMNSA9IHJlc291cmNlR3JpZFtnZXRJbmRleCgoeCAtIDUgKyBHUklEX1NJWkUpICUgR1JJRF9TSVpFLCBzb3VyY2VSb3dJbmRleCldOyANCiAgICAgICAgICAgICAgICBjb25zdCBMNCA9IHJlc291cmNlR3JpZFtnZXRJbmRleCgoeCAtIDQgKyBHUklEX1NJWkUpICUgR1JJRF9TSVpFLCBzb3VyY2VSb3dJbmRleCldOyANCiAgICAgICAgICAgICAgICBjb25zdCBMMyA9IHJlc291cmNlR3JpZFtnZXRJbmRleCgoeCAtIDMgKyBHUklEX1NJWkUpICUgR1JJRF9TSVpFLCBzb3VyY2VSb3dJbmRleCldOw0KICAgICAgICAgICAgICAgIGNvbnN0IEwyID0gcmVzb3VyY2VHcmlkW2dldEluZGV4KCh4IC0gMiArIEdSSURfU0laRSkgJSBHUklEX1NJWkUsIHNvdXJjZVJvd0luZGV4KV07DQogICAgICAgICAgICAgICAgY29uc3QgTDEgPSByZXNvdXJjZUdyaWRbZ2V0SW5kZXgoKHggLSAxICsgR1JJRF9TSVpFKSAlIEdSSURfU0laRSwgc291cmNlUm93SW5kZXgpXTsNCiAgICAgICAgICAgICAgICBjb25zdCBjZW50ZXIgPSByZXNvdXJjZUdyaWRbZ2V0SW5kZXgoeCwgc291cmNlUm93SW5kZXgpXTsNCiAgICAgICAgICAgICAgICBjb25zdCBSMSA9IHJlc291cmNlR3JpZFtnZXRJbmRleCgoeCArIDEpICUgR1JJRF9TSVpFLCBzb3VyY2VSb3dJbmRleCldOw0KICAgICAgICAgICAgICAgIA0KDQogICAgICAgICAgICAgICAgLy8gUnVsZSAzMCB1c2VzIDMgaW1tZWRpYXRlIG5laWdoYm9ycyAoTDEsIGNlbnRlciwgUjEpIHRvIGdlbmVyYXRlIHRoZSBuZXcgc3RhdGUuDQogICAgICAgICAgICAgICAgY29uc3QgcnVsZUluZGV4ID0gKEwxIDw8IDIpIHwgKGNlbnRlciA8PCAxKSB8IFIxOyANCiAgICAgICAgICAgICAgICBjb25zdCBuZXdTdGF0ZSA9IFdPTEZSQU1fUlVMRVs3IC0gcnVsZUluZGV4XTsgDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgbmV4dFJlc291cmNlR3JpZFtnZXRJbmRleCh4LCAwKV0gPSBuZXdTdGF0ZTsNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAvLyAtLS0gQ1VTVE9NIEZPT0QgUEFUVEVSTiBMT0dJQyAtLS0NCiAgICAgICAgICAgICAgICAvLyBQYXR0ZXJuICcwMTExMTAwJyBjaGVjaw0KICAgICAgICAgICAgICAgIGlmIChMNSA9PT0gMCAmJiBMNCA9PT0gMSAmJiBMMyA9PT0gMSAmJiBMMiA9PT0gMSAmJiBMMSA9PT0gMSAmJiBjZW50ZXIgPT09IDAgJiYgUjEgPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICBpZiAoeCAlIFhfQ09PUkRfRklMVEVSID09PSAwKSB7IA0KDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmZWVkWSA9IHBhdHRlcm5IaXRDb3VudCAlIEdSSURfU0laRTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pcnJvcmVkWSA9IEdSSURfU0laRSAtIDEgLSBmZWVkWTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pcnJvcmVkWCA9IEdSSURfU0laRSAtIDEgLSB4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRzID0gWw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt4OiB4LCB5OiBmZWVkWX0sICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAge3g6IHgsIHk6IG1pcnJvcmVkWX0sICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7eDogbWlycm9yZWRYLCB5OiBmZWVkWX0sICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt4OiBtaXJyb3JlZFgsIHk6IG1pcnJvcmVkWX0gICAgDQogICAgICAgICAgICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1bmlxdWVUYXJnZXRzID0gbmV3IFNldCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxUYXJnZXRDb29yZGluYXRlcyA9IFtdOw0KDQogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRzLmZvckVhY2godGFyZ2V0ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBrZXkgPSBgJHt0YXJnZXQueH0sJHt0YXJnZXQueX1gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghdW5pcXVlVGFyZ2V0cy5oYXMoa2V5KSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVUYXJnZXRzLmFkZChrZXkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbFRhcmdldENvb3JkaW5hdGVzLnB1c2godGFyZ2V0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gMy5hLiBBcHBseSBGb29kIGVmZmVjdCBhdCBhbGwgdW5pcXVlIHRhcmdldCBjb29yZGluYXRlcyAocXVhZHJ1cGxlIGluamVjdGlvbikNCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsVGFyZ2V0Q29vcmRpbmF0ZXMuZm9yRWFjaCh0YXJnZXQgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFggPSB0YXJnZXQueDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRZID0gdGFyZ2V0Lnk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBseSB0aGUgM3gzIGluamVjdGlvbiBjZW50ZXJlZCBhdCB0aGUgdGFyZ2V0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IC0xOyBpIDw9IDE7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBqID0gLTE7IGogPD0gMTsgaisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWVkWCA9ICh0YXJnZXRYICsgaSArIEdSSURfU0laRSkgJSBHUklEX1NJWkU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzZWVkWSA9IE1hdGgubWluKEdSSURfU0laRSAtIDEsIE1hdGgubWF4KDAsIHRhcmdldFkgKyBqKSk7IA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJbmplY3QgeW91dGggKEZPT0RfSU5KRUNUSU9OX0FHRSkgaW50byB0aGUgQ1NPUyBncmlkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBncmlkW2dldEluZGV4KHNlZWRYLCBzZWVkWSldID0gRk9PRF9JTkpFQ1RJT05fQUdFOyANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuSGl0Q291bnQrKzsgDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJlc291cmNlR3JpZCA9IG5leHRSZXNvdXJjZUdyaWQ7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogVGhlIGNvcmUgbG9naWM6IGNhbGN1bGF0ZXMgdGhlIHN0YXRlIG9mIHRoZSBuZXh0IGdlbmVyYXRpb24gb2YgdGhlIG1haW4gQ1NPUyBncmlkLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gY29tcHV0ZU5leHRHZW5lcmF0aW9uKCkgew0KICAgICAgICAgICAgLy8gUnVuIHRoZSBSZXNvdXJjZSBDQSBhdCBhIHNwZWNpZmllZCBpbnRlcnZhbA0KICAgICAgICAgICAgaWYgKGdlbmVyYXRpb24gJSBGT09EX1NDUk9MTF9JTlRFUlZBTCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIGNvbXB1dGVGb29kQ0EoKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbGV0IGxpdmVDb3VudCA9IDA7DQoNCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgR1JJRF9TSVpFOyB5KyspIHsNCiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IEdSSURfU0laRTsgeCsrKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZ2V0SW5kZXgoeCwgeSk7DQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBZ2UgPSBncmlkW2luZGV4XTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbGl2ZU5laWdoYm9ycyA9IGNvdW50TGl2ZU5laWdoYm9ycyh4LCB5KTsgLy8gVXNlcyBGSVhFRCBib3VuZGFyaWVzDQogICAgICAgICAgICAgICAgICAgIGxldCBuZXh0QWdlID0gMDsNCg0KICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEFnZSA+IDApIHsgLy8gQ2VsbCBpcyBjdXJyZW50bHkgYWxpdmUNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN1cnZpdmFsICgyIG9yIDMgbmVpZ2hib3JzKSAtIFN0YW5kYXJkIEdPTA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpdmVOZWlnaGJvcnMgPT09IDIgfHwgbGl2ZU5laWdoYm9ycyA9PT0gMykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFnaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRBZ2UgPCBNQVhfQUdFKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRBZ2UgPSBjdXJyZW50QWdlICsgMTsgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEFnZSA9IDA7IC8vIERpZXMgZnJvbSBvbGQgYWdlIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEFnZSA9IDA7IC8vIERpZXMgZnJvbSB1bmRlci9vdmVyLXBvcHVsYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gQ2VsbCBpcyBjdXJyZW50bHkgZGVhZCAoQWdlID0gMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJpcnRoIChSZXBsaWNhdGlvbiAtIGV4YWN0bHkgMyBuZWlnaGJvcnMpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGl2ZU5laWdoYm9ycyA9PT0gMykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5leHRBZ2UgPSAxOyAvLyBOZXcgY2VsbCBzdGFydHMgYXQgYWdlIDENCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBjZWxsIHdhcyBqdXN0IGluamVjdGVkIChmZWQpIGFuZCBlbnN1cmUgaXQgcmVtYWlucyB5b3VuZw0KICAgICAgICAgICAgICAgICAgICBpZiAoZ3JpZFtpbmRleF0gPT09IEZPT0RfSU5KRUNUSU9OX0FHRSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEFnZSA9IE1hdGgubWF4KG5leHRBZ2UsIE1hdGgubWluKE1BWF9BR0UsIEZPT0RfSU5KRUNUSU9OX0FHRSkpOw0KICAgICAgICAgICAgICAgICAgICB9DQoNCg0KICAgICAgICAgICAgICAgICAgICBuZXh0R3JpZFtpbmRleF0gPSBuZXh0QWdlOw0KICAgICAgICAgICAgICAgICAgICBpZiAobmV4dEFnZSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpdmVDb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBTd2FwIHRoZSBncmlkcyANCiAgICAgICAgICAgIGNvbnN0IHRlbXAgPSBncmlkOw0KICAgICAgICAgICAgZ3JpZCA9IG5leHRHcmlkOw0KICAgICAgICAgICAgbmV4dEdyaWQgPSB0ZW1wOyANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZ2VuZXJhdGlvbisrOw0KICAgICAgICAgICAgdXBkYXRlSW5mbyhsaXZlQ291bnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIERyYXdzIHRoZSBzdGF0ZSBvZiB0aGUgbWFpbiBDU09TIGdyaWQuDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiByZW5kZXJDU09TKCkgew0KICAgICAgICAgICAgaWYgKCFDRUxMX1NJWkUpIHJldHVybjsgDQogICAgICAgICAgICANCiAgICAgICAgICAgIGNhQ3R4LmNsZWFyUmVjdCgwLCAwLCBjYUNhbnZhcy53aWR0aCwgY2FDYW52YXMuaGVpZ2h0KTsNCg0KICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBHUklEX1NJWkU7IHkrKykgew0KICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgR1JJRF9TSVpFOyB4KyspIHsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBnZXRJbmRleCh4LCB5KTsNCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWdlID0gZ3JpZFtpbmRleF07DQoNCiAgICAgICAgICAgICAgICAgICAgaWYgKGFnZSA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbG9yIG1hcHBpbmc6IFlvdW5nIChncmVlbikgdG8gQW5jaWVudCAocHVycGxlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmF0aW8gPSBhZ2UgLyBNQVhfQUdFOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ3JlZW4gPSBbMTY3LCAyNDMsIDIwOF07IC8vIFlvdXRoZnVsIChUYWlsd2luZCBncmVlbi0yMDApDQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwdXJwbGUgPSBbMTY4LCA4NSwgMjQ3XTsgIC8vIEFuY2llbnQgKFRhaWx3aW5kIHB1cnBsZS01MDApDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLmZsb29yKGdyZWVuWzBdICogKDEgLSByYXRpbykgKyBwdXJwbGVbMF0gKiByYXRpbyk7DQogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gTWF0aC5mbG9vcihncmVlblsxXSAqICgxIC0gcmF0aW8pICsgcHVycGxlWzFdICogcmF0aW8pOw0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IE1hdGguZmxvb3IoZ3JlZW5bMl0gKiAoMSAtIHJhdGlvKSArIHB1cnBsZVsyXSAqIHJhdGlvKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgY2FDdHguZmlsbFN0eWxlID0gYHJnYigke3J9LCAke2d9LCAke2J9KWA7DQogICAgICAgICAgICAgICAgICAgICAgICAvLyBFYWNoIGNlbGwgaXMgZHJhd24gYXMgMXgxIHBpeGVsIGR1ZSB0byBoaWdoIGNhbnZhcyByZXNvbHV0aW9uDQogICAgICAgICAgICAgICAgICAgICAgICBjYUN0eC5maWxsUmVjdCh4LCB5LCAxLCAxKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLyoqDQogICAgICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLg0KICAgICAgICAgKi8NCgkJIA0KCQkgdmFyIGVlcnN0ZWU9MDsNCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZShjdXJyZW50VGltZSkgew0KCQkNCg0KCQkNCiAgICAgICAgICAgIGFuaW1hdGlvbkZyYW1lSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7DQoNCiAgICAgICAgICAgIGlmICghaXNSdW5uaW5nKSByZXR1cm47DQoNCiAgICAgICAgICAgIC8vIFRocm90dGxlIHRoZSB1cGRhdGUgcmF0ZQ0KICAgICAgICAgICAgaWYgKGN1cnJlbnRUaW1lIC0gbGFzdFVwZGF0ZVRpbWUgPiB1cGRhdGVJbnRlcnZhbCkgew0KICAgICAgICAgICAgICAgIGxhc3RVcGRhdGVUaW1lID0gY3VycmVudFRpbWU7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgY29tcHV0ZU5leHRHZW5lcmF0aW9uKCk7DQoJCQkJDQogICAgICAgICAgICAgICAgcmVuZGVyQ1NPUygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvKioNCiAgICAgICAgICogVXBkYXRlcyB0aGUgZGlzcGxheSBpbmZvcm1hdGlvbi4gKEhpZGRlbiBpbiB0aGlzIHZlcnNpb24pDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiB1cGRhdGVJbmZvKGxpdmVDb3VudCkgew0KICAgICAgICAgICAgLy8gUGxhY2Vob2xkZXI6IGtlZXBpbmcgdGhlIGZ1bmN0aW9uIGZvciBwb3RlbnRpYWwgZnV0dXJlIHVzZS4NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBIYW5kbGVzIG1vdXNlL3RvdWNoIGlucHV0IHRvIG1hbnVhbGx5IHNlZWQgbGlmZSBvbiB0aGUgY2FudmFzLg0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlU2VlZChlKSB7DQogICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgICBjb25zdCByZWN0ID0gY2FDYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICAgICAgICBsZXQgY2xpZW50WCwgY2xpZW50WTsNCg0KICAgICAgICAgICAgaWYgKGUudG91Y2hlcyAmJiBlLnRvdWNoZXMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgIGNsaWVudFggPSBlLnRvdWNoZXNbMF0uY2xpZW50WDsNCiAgICAgICAgICAgICAgICBjbGllbnRZID0gZS50b3VjaGVzWzBdLmNsaWVudFk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGUuY2xpZW50WCAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgY2xpZW50WCA9IGUuY2xpZW50WDsNCiAgICAgICAgICAgICAgICBjbGllbnRZID0gZS5jbGllbnRZOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNvbnN0IHggPSBjbGllbnRYIC0gcmVjdC5sZWZ0Ow0KICAgICAgICAgICAgY29uc3QgeSA9IGNsaWVudFkgLSByZWN0LnRvcDsNCg0KICAgICAgICAgICAgLy8gU2NhbGUgY29vcmRpbmF0ZXMgdG8gdGhlIGdyaWQgc2l6ZSAoNDAweDQwMCkNCiAgICAgICAgICAgIGNvbnN0IGNlbGxYID0gTWF0aC5mbG9vcigoeCAvIHJlY3Qud2lkdGgpICogR1JJRF9TSVpFKTsNCiAgICAgICAgICAgIGNvbnN0IGNlbGxZID0gTWF0aC5mbG9vcigoeSAvIHJlY3QuaGVpZ2h0KSAqIEdSSURfU0laRSk7DQoNCiAgICAgICAgICAgIGlmIChjZWxsWCA+PSAwICYmIGNlbGxYIDwgR1JJRF9TSVpFICYmIGNlbGxZID49IDAgJiYgY2VsbFkgPCBHUklEX1NJWkUpIHsNCiAgICAgICAgICAgICAgICAvLyBNYW51YWxseSBzZWVkIGEgM3gzIGFyZWENCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gLTE7IGkgPD0gMTsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8PSAxOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlZWRYID0gKGNlbGxYICsgaSArIEdSSURfU0laRSkgJSBHUklEX1NJWkU7IA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VlZFkgPSAoY2VsbFkgKyBqICsgR1JJRF9TSVpFKSAlIEdSSURfU0laRTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRbZ2V0SW5kZXgoc2VlZFgsIHNlZWRZKV0gPSBGT09EX0lOSkVDVElPTl9BR0U7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgcmVuZGVyQ1NPUygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIExvYWRzIGFuZCBwcm9jZXNzZXMgYW4gaW1hZ2UgZmlsZSBzZWxlY3RlZCBieSB0aGUgdXNlciwgdGhlbiByZXN0YXJ0cyB0aGUgc2ltdWxhdGlvbi4NCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUltYWdlVXBsb2FkKGV2ZW50KSB7DQogICAgICAgICAgICBjb25zdCBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOw0KICAgICAgICAgICAgaWYgKCFmaWxlKSByZXR1cm47DQoNCiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7DQogICAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgICAgIGNvbnN0IGltZyA9IG5ldyBJbWFnZSgpOw0KICAgICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlRWxlbWVudCA9IGltZzsNCiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZUdyaWRGcm9tSW1hZ2UoY3VycmVudEltYWdlRWxlbWVudCk7DQogICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICBpbWcuc3JjID0gZS50YXJnZXQucmVzdWx0Ow0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcmVzZXRTaW11bGF0aW9uKCkgew0KICAgICAgICAgICAgLy8gUmVzZXQgdXNlcyB0aGUgY3VycmVudGx5IGxvYWRlZCBpbWFnZSAoZGVmYXVsdCBvciB1cGxvYWRlZCkNCiAgICAgICAgICAgIGlmIChjdXJyZW50SW1hZ2VFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZUdyaWRGcm9tSW1hZ2UoY3VycmVudEltYWdlRWxlbWVudCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHRoZSBkZWZhdWx0IGltYWdlIGlmIGZvciBzb21lIHJlYXNvbiBjdXJyZW50SW1hZ2VFbGVtZW50IGlzIG51bGwNCiAgICAgICAgICAgICAgICBpbml0aWFsaXplR3JpZEZyb21JbWFnZShpbml0aWFsSW1hZ2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyAtLS0gSW5pdGlhbGl6YXRpb24gLS0tDQoNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgLy8gMi4gU2V0dXAgZXZlbnQgbGlzdGVuZXJzDQoNCiAgICANCg0KDQpmdW5jdGlvbiB3ZWdyKCl7DQovL2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3ZWcnKS5zcmM9Jyc7DQoNCg0KDQogICAgICAgICAgICBzdGFydFN0b3BCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiBpc1J1bm5pbmcgPSAhaXNSdW5uaW5nKTsNCiAgICAgICAgICAgIHJlc2V0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVzZXRTaW11bGF0aW9uKTsNCiAgICAgICAgICAgIGltYWdlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgaGFuZGxlSW1hZ2VVcGxvYWQpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBMaXN0ZW4gZm9yIGNsaWNrcy90YXBzIG9uIHRoZSBtYWluIENBIGNhbnZhcyBmb3IgbWFudWFsIHNlZWRpbmcNCiAgICAgICAgICAgIGNhQ2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGhhbmRsZVNlZWQpOw0KICAgICAgICAgICAgY2FDYW52YXMuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGhhbmRsZVNlZWQpOw0KDQogICAgICAgICAgICAvLyAzLiBJbml0aWFsIHNldHVwOiBXYWl0IGZvciB0aGUgZGVmYXVsdCBpbWFnZSB0byBsb2FkDQogICAgICAgICAgICBjdXJyZW50SW1hZ2VFbGVtZW50ID0gaW5pdGlhbEltYWdlOw0KICAgICAgICAgICAgDQogICAgICAgICAgICAvLyBCZWNhdXNlIHdlIHVzZWQgYW4gZXh0ZXJuYWwgVVJMLCB3ZSBuZWVkIHRvIHdhaXQgZm9yIHRoZSBpbWFnZSdzICdsb2FkJyBldmVudC4NCiAgICAgICAgICAgIC8vIElmIHRoZSBpbWFnZSBpcyBhbHJlYWR5IGNvbXBsZXRlIChvZnRlbiB0aGUgY2FzZSB3aXRoIGNhY2hlZCBpbWFnZXMvZGF0YSBVUkxzKSwgcnVuIGltbWVkaWF0ZWx5Lg0KICAgICAgICAgICAgaWYgKGN1cnJlbnRJbWFnZUVsZW1lbnQuY29tcGxldGUgJiYgY3VycmVudEltYWdlRWxlbWVudC5uYXR1cmFsSGVpZ2h0ICE9PSAwKSB7DQogICAgICAgICAgICAgICAgIGluaXRpYWxpemVHcmlkRnJvbUltYWdlKGN1cnJlbnRJbWFnZUVsZW1lbnQpOw0KICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCJhbmltYXRlKCkiICwgNTAwKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY3VycmVudEltYWdlRWxlbWVudC5vbmxvYWQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVHcmlkRnJvbUltYWdlKGN1cnJlbnRJbWFnZUVsZW1lbnQpOw0KICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoICJhbmltYXRlKCkiLCA1MDApOw0KICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyAxLiBTZXR1cCBkaW1lbnNpb25zIG9uIGxvYWQgYW5kIHJlc2l6ZQ0KICAgICAgICAgICAgaW5pdENhbnZhc0RpbWVuc2lvbnMoKTsNCiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCAoKSA9PiB7DQogICAgICAgICAgICAgICAgaW5pdENhbnZhc0RpbWVuc2lvbnMoKTsNCiAgICAgICAgICAgICAgICByZW5kZXJDU09TKCk7IA0KICAgICAgICAgICAgfSk7DQoJCQkNCgkJfQkNCgkJDQoJCXNldFRpbWVvdXQoIndlZ3IoKSIsIDEwMDApOw0KCQkvLyBpc1J1bm5pbmcgPSAhaXNSdW5uaW5nOw0KCQlyZXNldFNpbXVsYXRpb24oKTsNCiAgICAgICAgICAgICAgaW5pdENhbnZhc0RpbWVuc2lvbnMoKTsNCiAgICAgICAgICAgICAgICByZW5kZXJDU09TKCk7IA0KICAgIDwvc2NyaXB0PjwvYm9keT48L2h0bWw+","data:text/html;base64,PGh0bWwgbGFuZz0iZW4iPjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPgogICAgPHRpdGxlPjU8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIC8qIEVzc2VudGlhbCBzdHlsZXMgZm9yIGZ1bGwtc2NyZWVuIGNhbnZhcyBhbmQgcmVxdWlyZWQgaGVhZGVycyAqLwogICAgICAgIGJvZHkgewogIAogICAgICAgIAogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwOyAvKiBFbnN1cmVzIGJsYWNrIGJhY2tncm91bmQgaWYgY2FudmFzIGlzbid0IHJlYWR5ICovCiAgICAgICAgICAgIHRvdWNoLWFjdGlvbjogbWFuaXB1bGF0aW9uOyAvKiBJbXByb3ZlcyByZXNwb25zaXZlbmVzcyBvbiB0b3VjaCBkZXZpY2VzICovCgkJCXdpZHRoOjEwMCU7CgkJCWhlaWdodDoxMDAlOwoJCQlvdmVyZmxvdzpoaWRkZW47CiAgICAgICAgfQogICAgICAgIGNhbnZhcyB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsKICAgICAgICAgICAgbGVmdDogMDsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwoKICAgICAgICB9CiAgICAgICAgLyogUmVxdWlyZWQgZm9udCBzaXplIGZvciBhbGwgaGVhZGVyIGVsZW1lbnRzICovCiAgICAgICAgaDEsIGgyLCBoMywgaDQsIGg1LCBoNiB7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMXB4OwogICAgICAgICAgICBtYXJnaW46IDA7IC8qIFJlbW92ZSBkZWZhdWx0IG1hcmdpbnMgKi8KICAgICAgICAgICAgcGFkZGluZzogMDsgLyogUmVtb3ZlIGRlZmF1bHQgcGFkZGluZ3MgKi8KICAgICAgICAgICAgY29sb3I6IHRyYW5zcGFyZW50OyAvKiBNYWtlIHRleHQgaW52aXNpYmxlIGlmIHByZXNlbnQgKi8KICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlOyAvKiBUYWtlIHRoZW0gb3V0IG9mIG5vcm1hbCBmbG93ICovCiAgICAgICAgICAgIHBvaW50ZXItZXZlbnRzOiBub25lOyAvKiBNYWtlIHRoZW0gbm90IGludGVyZmVyZSB3aXRoIGludGVyYWN0aW9ucyAqLwogICAgICAgICAgICB2aXNpYmlsaXR5OiBoaWRkZW47IC8qIEVuc3VyZSB0aGV5IGFyZSBub3QgdmlzaWJsZSAqLwogICAgICAgIH0KCiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8aW5wdXQgdHlwZT0iaGlkZGVuIiB2YWx1ZT0nJyBpZD0id2luZG93bG9jYXRpb25ocmVmIj4KPGRpdiBpZD0iYm9keWNhIiBzdHlsZT0iZGlzcGxheTpub25lZSI+PGNhbnZhcyB3aWR0aD0iNTAwIiBoZWlnaHQ9IjUwMCIgc3R5bGU9ImRpc3BsYXk6bm9uZTt3aWR0aDoxMDAlO2hlaWdodDoxMDAlIiBpZD0iY292ZXJzY3oyY2IiPjwvY2FudmFzPiAgIDxjYW52YXMgaWQ9Im1haW5BbmltYXRpb25DYW52YXMiPjwvY2FudmFzPjwvZGl2Pgo8c2NyaXB0PgoKZnVuY3Rpb24gcmV2ZXJzZShzdHIpIHsKICAgIHZhciBuZXdTdHJpbmcgPSAiIjsKICAgIGZvciAodmFyIGkgPSBzdHIubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBuZXdTdHJpbmcgKz0gc3RyW2ldOwogICAgfQogICAgcmV0dXJuIG5ld1N0cmluZzsKfQoKdmFyIHBhbENvdW50PTQ5Owpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU9d2luZG93LmxvY2F0aW9uLmhyZWY7Ci8vZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xpdGknKS52YWx1ZT0iIjsKd2luZG93Lm9uYmVmb3JldW5sb2FkID0gY29uZmlybURvZWk7CmZ1bmN0aW9uIGNvbmZpcm1Eb2VpKCkKewogICAgcmV0dXJuICJZb3UgaGF2ZSBhdHRlbXB0ZWQgdG8gbGVhdmUgdGhpcyBwYWdlLiAgSWYgeW91IGhhdmUgbWFkZSBhbnkgY2hhbmdlcyB0byB0aGUgZmllbGRzIHdpdGhvdXQgY2xpY2tpbmcgdGhlIFNhdmUgYnV0dG9uLCB5b3VyIGNoYW5nZXMgd2lsbCBiZSBsb3N0LiAgQXJlIHlvdSBzdXJlIHlvdSB3YW50IHRvIGV4aXQgdGhpcyBwYWdlPyI7Cn0Kd2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlLCBzb3VyY2UsIGxpbmVubywgY29sbm8sIGVycm9yKSB7CiAgICBjb25zb2xlLmxvZyhgRXJyb3I6ICR7bWVzc2FnZX0gYXQgJHtzb3VyY2V9OiR7bGluZW5vfToke2NvbG5vfWApOwogICAgcGxha2FhbmRvKCk7CgogICAgcmV0dXJuIHRydWU7Cn07CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCAoZXZlbnQpID0+IHsKICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICBldmVudC5yZXR1cm5WYWx1ZSA9ICcnOwogICAgcGxha2FhbmRvKCk7Cn0pOwoKCgp2YXIgcmVmc2Y7CnZhciBjY2NucnNyc3JlYz1uZXcgQXJyYXkoKTsKc2Z0eW9zZnR5bz0wOwpmdW5jdGlvbiBudW1iZXJUQkFkQShucil7CnZhciBuZWVqPW5yOwpjYz1uZWVqLnRvU3RyaW5nKDIpOwpyZXR1cm4gY2M7Cn0KZnVuY3Rpb24gcmV2ZXJTdHIoc3RyKSB7CiAgICB2YXIgbmV3U3RyaW5nID0gIiI7CiAgICBmb3IgKHZhciBpID0gc3RyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgbmV3U3RyaW5nICs9IHN0cltpXTsKICAgIH0KICAgIHJldHVybiBuZXdTdHJpbmc7Cn0KdmFyIHRsbHNzPXNmdHlvc2Z0eW87CmEyPTE7CmNkPTE7CmM9MDsKdmFyIHJhZGlhbDNUaHJlZT1uZXcgQXJyYXkoKTsKcmFkaWFsM1RocmVlWzBdPTYwOTU3ODY4MDI7CnJhZGlhbDNUaHJlZVsxXT02MTI4NTg3OTQxOwpyYWRpYWwzVGhyZWVbMl09NTE0MjAyODM4MDsKcmFkaWFsM1RocmVlWzNdPTU2NTg5ODQ5MzQ7CnJhZGlhbDNUaHJlZVs0XT0zMDYxMTQ1NTMwOwpyYWRpYWwzVGhyZWVbNV09NjEzMTkzNDY1NDsKcmFkaWFsM1RocmVlWzZdPTI2NDI3MDgzMzA7CnJhZGlhbDNUaHJlZVs3XT00MDUyNzM0OTYxOwpyYWRpYWwzVGhyZWVbOF09NTIxODE3MjUyOTsKcmFkaWFsM1RocmVlWzldPTYwOTcyODgzMTI7CnJhZGlhbDNUaHJlZVsxMF09NjA2ODQ1Njg5MDsKcmFkaWFsM1RocmVlWzExXT00NzUzMTUzOTk0OwpyYWRpYWwzVGhyZWVbMTJdPTQzNDA0MTI5NzI7CnJhZGlhbDNUaHJlZVsxM109NjEyMjU3MjMwMjsKcmFkaWFsM1RocmVlWzE0XT02MTMwOTY5MzE4OwpyYWRpYWwzVGhyZWVbMTVdPTU1OTkwMDEwOTQ7CnJhZGlhbDNUaHJlZVsxNl09NjEzMjA3NzczMzsKcmFkaWFsM1RocmVlWzE3XT02MDY4NDU2ODkwOwpyYWRpYWwzVGhyZWVbMThdPTU5NjgwODAzNDY7CnJhZGlhbDNUaHJlZVsxOV09NTI5ODE3ODYyMjsKCgpsZXQgbGFzdFRpbWUgPSAwOyAgICAgICAgICAvLyBUaWpkIHZhbiBsYWF0c3RlIGZyYW1lCmNvbnN0IEZQUyA9IDMwOyAgICAgICAgICAgLy8gRG9lbC1GUFMgKGhhbHZlIHNjaGVybXJlZnJlc2gpCmNvbnN0IGZyYW1lSW50ZXJ2YWwgPSAxMDAwIC8gRlBTOyAvLyA9IDMzLjMzbXMgcGVyIGZyYW1lCgpmdW5jdGlvbiBudW1iZXJUQkFkQShucil7IHZhciBuZWVqPW5yOyBjYz1uZWVqLnRvU3RyaW5nKDIpOyByZXR1cm4gY2M7fQpmdW5jdGlvbiByZXZlclN0cihzdHIpIHsgdmFyIG5ld1N0cmluZyA9ICIiOyBmb3IgKHZhciBpID0gc3RyLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKXsgbmV3U3RyaW5nICs9IHN0cltpXTsgfSByZXR1cm4gbmV3U3RyaW5nOyB9CnZhciB0bGxzcz1zZnR5b3NmdHlvOwphMj0xOwpjZD0xOwpjPTA7CmJidHQ9MDsKcmV0ZT0wOwpiYnZ2PTEyOwp2YXIgY2NjbnJzcnNyZWM9bmV3IEFycmF5KCk7Cm9jY2NucnNyc3JlY25yc3Jzcj1uZXcgQXJyYXkoKTsKZm9yKHRlPTA7dGU8TWF0aC5wb3coMixiYnZ2KTt0ZSs9MSl7CmZzZWU9dGUudG9TdHJpbmcoMik7CmZzMng9cmV2ZXJTdHIoZnNlZSk7CnNmZmY9cGFyc2VJbnQoZnMyeCwyKTsKZHNnZz0oc2ZmZi8yKSpNYXRoLnBvdygtMSwgKHNmZmYlMikpOwpzZGRnPWRzZ2cgJiBzZmZmOwpiYnR0Kz1zZGRnOwpvY2NjbnJzcnNyZWNucnNyc3JbcmV0ZV09YmJ0dDsKcmV0ZSsrOwp9Cm9jY2NucnNyc3JlY25yc3Jzci5zb3J0KGZ1bmN0aW9uKGEsIGIpe3JldHVybiBhIC0gYn0pOwpubW5tdj1uZXcgQXJyYXkoKTsKcmJiYj0wOwp0ZXJycj0wOwpmb3IodDJvPTA7dDJvPE1hdGgucG93KDIsYmJ2dik7dDJvKz0xKXsKcmJiYis9b2NjY25yc3JzcmVjbnJzcnNyW3Qyb107Cm5tbm12W3RlcnJyXT1yYmJiOwp0ZXJycisrOwp9CmNjY25yc3JzcmVjPW5tbm12OwpyZXQ9cmV0ZTsKZnVuY3Rpb24gb25seVVuaXF1ZWVlKHZhbHVlLCBpbmRleCwgc2VsZikgewogICAgcmV0dXJuIHNlbGYuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4Owp9CmZ1bmN0aW9uIHJlbW92ZXdpdGhmaWx0ZXIoYXJyKSB7CiAgICAgICAgICAgIGxldCBvdXRwdXRBcnJheSA9IGFyci5maWx0ZXIoZnVuY3Rpb24odiwgaSwgc2VsZikKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuIGkgPT0gc2VsZi5pbmRleE9mKHYpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG91dHB1dEFycmF5Owp9CmNjY25yc3JzcmVjPXJlbW92ZXdpdGhmaWx0ZXIoY2NjbnJzcnNyZWMpOwp2YXIgbGlqbm5uZXM9bmV3IEFycmF5KCk7CnZhciBzY2NsbGxpY2VjY2hlaWdodD01MDA7CnZhciBzY2NsbGxpY2VjY2xlbnRoPTUwMDsKdXI9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dpbmRvd2xvY2F0aW9uaHJlZicpLnZhbHVlOwp1dXVpPXVyLnNwbGl0KCJ3aD0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwpyZGZnPXJlZ2dbMF07Cm1tbWs9cmRmZy5zcGxpdCgiOiIpOwpzY2NsbGxpY2VjY2hlaWdodD1wYXJzZUludChtbW1rWzBdKTsKc2NjbGxsaWNlY2NsZW50aD1wYXJzZUludChtbW1rWzFdKTsKfQp2YXIgYXV0b289IiI7CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgiYXV0bz0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwphdXRvbz1yZWdnWzBdOwp9CnZhciBkcmVtcGVsc3NpemU9NDgwMDA7CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgic2l6ZT0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwpkcmVtcGVsc3NpemU9cGFyc2VJbnQocmVnZ1swXSk7Cn0KZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JvZHljYScpLmlubmVySFRNTD0iPGNhbnZhcyB3aWR0aD0iK3NjY2xsbGljZWNjaGVpZ2h0KyIgaGVpZ2h0PSIrc2NjbGxsaWNlY2NsZW50aCsiIHN0eWxlPSdkaXNwbGF5Om5vbmU7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJScgaWQ9J2NvdmVyc2N6MmNiJz48L2NhbnZhcz4gICA8Y2FudmFzIGlkPSdtYWluQW5pbWF0aW9uQ2FudmFzJz48L2NhbnZhcz4iOwp2YXIgY29iYmVncz0wOwp2YXIgY2NlbGx1bnI9TWF0aC5mbG9vcihjY2NucnNyc3JlYy5sZW5ndGgqTWF0aC5yYW5kb20oKSk7CnZhciBjcnV1dWxlZGQgPSAwOwp2YXIgc3RhcnRpbmcgPSAiciI7CnZhciBjb3ZlcnNjejJjYiwgY29udGV4dHR0Y2Y7CnZhciBjdXJyc2N0YXRlYywgbmV4dHNjdGF0ZWM7CnZhciBtaWpwaWtzZWxzY2NkOwp2YXIgY3VycnJvd3Z3YyA9IDA7CnZhciBpbnN0ZWxsc2M9MDsKdmFyIHh5emN4eXpjPTQwNDM2NjI3MjU7CnZhciBuaWV3c3M9bnVsbDsKdmFyIHJkaWFscz0yOwpmdW5jdGlvbiBkb29lU3RSdWxlTnJuTnIoKSB7CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgicnVsZT0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwpycmVyZXI9cmVnZ1swXTsKcmVnZ2c9cnJlcmVyLnNwbGl0KCI6Iik7Cnh5emN4eXpjPXBhcnNlSW50KHJlZ2dnWzBdKTsKcmRpYWxzPXBhcnNlSW50KHJlZ2dnWzFdKTsKfQp1cj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU7CnV1dWk9dXIuc3BsaXQoIm5yPSIpOwppZih1dXVpLmxlbmd0aD4xKXsKbmFzPXV1dWlbMV07CnJlZ2c9bmFzLnNwbGl0KCImIik7CnJyZXJlcj1yZWdnWzBdOwpyZWdnZz1ycmVyZXIuc3BsaXQoIjoiKTsKeHl6Y3h5emM9cGFyc2VJbnQocmVnZ2dbMF0pOwpyZGlhbHM9cGFyc2VJbnQocmVnZ2dbMV0pOwp9CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgibnVtYmVyPSIpOwppZih1dXVpLmxlbmd0aD4xKXsKbmFzPXV1dWlbMV07CnJlZ2c9bmFzLnNwbGl0KCImIik7CnJyZXJlcj1yZWdnWzBdOwpyZWdnZz1ycmVyZXIuc3BsaXQoIjoiKTsKeHl6Y3h5emM9cGFyc2VJbnQocmVnZ2dbMF0pOwpyZGlhbHM9cGFyc2VJbnQocmVnZ2dbMV0pOwp9CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgibj0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwpycmVyZXI9cmVnZ1swXTsKcmVnZ2c9cnJlcmVyLnNwbGl0KCI6Iik7Cnh5emN4eXpjPXBhcnNlSW50KHJlZ2dnWzBdKTsKcmRpYWxzPXBhcnNlSW50KHJlZ2dnWzFdKTsKfQp1cj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU7CnV1dWk9dXIuc3BsaXQoIng9Iik7CmlmKHV1dWkubGVuZ3RoPjEpewpuYXM9dXV1aVsxXTsKcmVnZz1uYXMuc3BsaXQoIiYiKTsKcnJlcmVyPXJlZ2dbMF07CnJlZ2dnPXJyZXJlci5zcGxpdCgiOiIpOwp4eXpjeHl6Yz1wYXJzZUludChyZWdnZ1swXSk7CnJkaWFscz1wYXJzZUludChyZWdnZ1sxXSk7Cn0KY3J1dXVsZWRkX3NldCh4eXpjeHl6Yyk7CgkJCWQ9TWF0aC5mbG9vcihjdXJyc2N0YXRlY3gubGVuZ3RoKk1hdGgucmFuZG9tKCkpOwoJCQljdXJyc2N0YXRlY3hbZF09IWN1cnJzY3RhdGVjeFtkXTsKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBzY2NsbGxpY2VjY2hlaWdodDsgaSsrKSB7CgkJCQlpZihNYXRoLnJhbmRvbSgpPi41KXsKCQkJCSBjdXJyc2N0YXRlY3hbaV0gPXRydWU7CgkJCQl9CgkJCQllbHNlewoJCQkJIGN1cnJzY3RhdGVjeFtpXSA9ZmFsc2U7CgkJCQl9CgkJCX0KCQkJCXRsbHNzKys7CgkJCQkKCQkvKgkJCgkJCQkgICAgLy8gMi4gRmlzaGVyLVlhdGVzIFNodWZmbGUgQWxnb3JpdGhtCiAgICBmb3IgKGxldCBpID0gcGFsZXR0ZS5sZW5ndGggLSAxOyBpID4gMDsgaS0tKSB7CiAgICAgICAgY29uc3QgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpOwogICAgICAgIC8vIFN3YXAgZWxlbWVudHMKICAgICAgICBbcGFsZXR0ZVtpXSwgcGFsZXR0ZVtqXV0gPSBbcGFsZXR0ZVtqXSwgcGFsZXR0ZVtpXV07CiAgICB9CgkKCSovCgkJCQlwYWxldHRlPWdlbmVyYXRlUmFpbmJvd1BhbGV0dGUocGFsQ291bnQpOwoJCQkJCQluZXh0TnIoKTsKCQkJcmV0dXJuIGRvb2VTdFJ1bGVOcm5OcmNyZSgpOwoJCQkKCQkJCgkKCQkvLwlzZXRUaW1lb3V0KCJkb29lU3RSdWxlTnJuTnIoKSIsIDMwMDApOwp9CgoKZnVuY3Rpb24gZ2VuZXJhdGVSYWluYm93UGFsZXR0ZShudW1FbGVtZW50cykgewogICAgbGV0IHBhbGV0dGUgPSBbXTsKYWFwPU1hdGguZmxvb3IobnVtRWxlbWVudHMqTWF0aC5yYW5kb20oKSk7CmhhPW5ldyBBcnJheSgpOwoKZm9yKGg9MDtoPG51bUVsZW1lbnRzO2grKyl7CmhhW2hdPSgoYWFwK2gpJW51bUVsZW1lbnRzKTsKfQoKICAgIC8vIDEuIEdlbmVyYXRlIHRoZSBjb2xvcnMgYmFzZWQgb24gMzYwIGRlZ3JlZSByb3RhdGlvbgogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1FbGVtZW50czsgaSsrKSB7CiAgICAgICAgbGV0IGh1ZSA9IChoYVtpXSAqIDM2MCkgLyBudW1FbGVtZW50czsKCQkKICAgICAgICBwYWxldHRlLnB1c2goaHNsVG9SZ2IoaHVlLCAxMDAsIDUwKSk7CiAgICB9Ci8qCiAgICAvLyAyLiBGaXNoZXItWWF0ZXMgU2h1ZmZsZSBBbGdvcml0aG0KICAgIGZvciAobGV0IGkgPSBwYWxldHRlLmxlbmd0aCAtIDE7IGkgPiAwOyBpLS0pIHsKICAgICAgICBjb25zdCBqID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKGkgKyAxKSk7CiAgICAgICAgLy8gU3dhcCBlbGVtZW50cwogICAgICAgIFtwYWxldHRlW2ldLCBwYWxldHRlW2pdXSA9IFtwYWxldHRlW2pdLCBwYWxldHRlW2ldXTsKICAgIH0KKi8KICAgIHJldHVybiBwYWxldHRlOwp9CgovLyBIZWxwZXIgdG8gY29udmVydCBIdWUgdG8gUkdCCmZ1bmN0aW9uIGhzbFRvUmdiKGgsIHMsIGwpIHsKICAgIHMgLz0gMTAwOwogICAgbCAvPSAxMDA7CiAgICBsZXQgayA9IG4gPT4gKG4gKyBoIC8gMzApICUgMTI7CiAgICBsZXQgYSA9IHMgKiBNYXRoLm1pbihsLCAxIC0gbCk7CiAgICBsZXQgZiA9IG4gPT4gbCAtIGEgKiBNYXRoLm1heCgtMSwgTWF0aC5taW4oayhuKSAtIDMsIE1hdGgubWluKDkgLSBrKG4pLCAxKSkpOwogICAgCiAgICByZXR1cm4gWwogICAgICAgIE1hdGgucm91bmQoMjU1ICogZigwKSksCiAgICAgICAgTWF0aC5yb3VuZCgyNTUgKiBmKDgpKSwKICAgICAgICBNYXRoLnJvdW5kKDI1NSAqIGYoNCkpCiAgICBdOwp9CgoKLy8gTUVUIGRlemUgZ2VvcHRpbWFsaXNlZXJkZSB2ZXJzaWU6CmZ1bmN0aW9uIHVwZGF0ZVBpeGVscygpIHsKICAgIGNvbnN0IGRhdGEgPSBtaWpwaWtzZWxzY2NkLmRhdGE7CiAgICBsZXQgaWR4ID0gMDsKICAgIAogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY2NsbGxpY2VjY2hlaWdodDsgaSsrKSB7CiAgICAgICAgZGF0YVtpZHhdID0gY3VycnNjdGF0ZWNbaV0gPyAwIDogMjU1OyAgICAgLy8gUgogICAgICAgIGRhdGFbaWR4ICsgMV0gPSBjdXJyc2N0YXRlY1tpXSA/IDAgOiAyNTU7IC8vIEcKICAgICAgICBkYXRhW2lkeCArIDJdID0gY3VycnNjdGF0ZWNbaV0gPyAwIDogMjU1OyAvLyBCCiAgICAgICAgZGF0YVtpZHggKyAzXSA9IDI1NTsgICAgICAgICAgICAgICAgICAgICAgLy8gQQogICAgICAgIGlkeCArPSA0OwogICAgfQp9Ci8vIEV4YW1wbGU6IEdldCAzMiBzaHVmZmxlZCBjb2xvcnMKCi8vIEV4YW1wbGU6IEdldCAzMiBjb2xvcnMgZGlzdHJpYnV0ZWQgYXJvdW5kIHRoZSB3aGVlbAoKdmFyCXBhbGV0dGU9Z2VuZXJhdGVSYWluYm93UGFsZXR0ZShwYWxDb3VudCk7CgovL3ZhciBzY3RhdGVjPTA7CgpmdW5jdGlvbiBkZGRkZHd3b29vb3d3KCkgewogICAgbGV0IHggPSAxOwogICAgY29uc3QgbGVuID0gc2N0YXRlYy5sZW5ndGggLSAxOwogICAgCiAgICB3aGlsZSAoeCA8IGxlbikgewogICAgICAgIC8vIFdlIGJvdXdlbiBkZSBpbmRleCAnb24gdGhlIGZseScgbWV0IGJpdC1zaGlmdGluZwogICAgICAgIC8vIFZvb3IgZWVuIDMtY2VsIGJ1dXJ0OgogICAgICAgIGxldCB2YWwgPSAoc2N0YXRlY1t4IC0gMV0gPDwgMikgfCAoc2N0YXRlY1t4XSA8PCAxKSB8IChzY3RhdGVjW3ggKyAxXSk7CiAgICAgICAgCiAgICAgICAgLy8gR2VicnVpayBkZSAndmFsJyBkaXJlY3Qgb20gZGUgbmlldXdlIHRvZXN0YW5kIHRlIGJlcGFsZW4KICAgICAgICBuZXh0c2N0YXRlY1t4XSA9IChjdXJyZW50UnVsZSA+PiB2YWwpICYgMTsgCgogICAgICAgIC8vIFBpeGVsIHRla2VuZW4gKERpcmVjdGUgbWFuaXB1bGF0aWUgdmFuIGRlIFVpbnQ4QXJyYXkpCiAgICAgICAgbGV0IHBpeElkeCA9IChjb2JiZWdzcyAqIHNjY2xsbGljZWNjbGVudGggKyB4KSAqIDQ7CiAgICAgICAgbGV0IGNvbG9yID0gcGFsZXR0ZVt2YWxdOyAvLyBHZWJydWlrIGRlIGJlcmVrZW5kZSB2YWwgdm9vciBrbGV1ci1sb29rdXAKICAgICAgICAKICAgICAgICBtaWpwaWtzZWxzY2NkLmRhdGFbcGl4SWR4XSA9IGNvbG9yLnI7ICAgICAvLyBSCiAgICAgICAgbWlqcGlrc2Vsc2NjZC5kYXRhW3BpeElkeCArIDFdID0gY29sb3IuZzsgLy8gRwogICAgICAgIG1panBpa3NlbHNjY2QuZGF0YVtwaXhJZHggKyAyXSA9IGNvbG9yLmI7IC8vIEIKICAgICAgICBtaWpwaWtzZWxzY2NkLmRhdGFbcGl4SWR4ICsgM10gPSAyNTU7ICAgICAvLyBBIChBbHBoYSkKICAgICAgICAKICAgICAgICB4Kys7CiAgICB9Cn0KCgpmdW5jdGlvbiAgd3dvb29vd3coKSB7CiAgICB2YXIgc2Nyb2xsID0gZmFsc2U7CiAgICBpZiAoIXNjcm9sbCB8fCBjdXJycm93dndjIDwgc2NjbGxsaWNlY2NsZW50aCAtIDEpIHsKICAgICAgICBjdXJycm93dndjKys7CiAgICAgICAgY3VycnJvd3Z3YyAlPSBzY2NsbGxpY2VjY2xlbnRoOwogICAgfSBlbHNlIHsKICAgICAgICBjb250ZXh0dHRjZi5wdXRJbWFnZURhdGEobWlqcGlrc2Vsc2NjZCwgMCwgMCk7CiAgICAgICAgdGVsWVVJKys7CiAgICB9CiAgICAvKgogICAgLy8gMzItY29sb3IgcGFsZXR0ZSAoUkdCIHZhbHVlcykKICAgIHZhciBwYWxldHRlID0gWwogICAgICAgIFswLCAwLCAwXSwgWzI1NSwgMjU1LCAyNTVdLCBbMjU1LCAwLCAwXSwgWzAsIDI1NSwgMF0sCiAgICAgICAgWzAsIDAsIDI1NV0sIFsyNTUsIDI1NSwgMF0sIFsyNTUsIDAsIDI1NV0sIFswLCAyNTUsIDI1NV0sCiAgICAgICAgWzEyOCwgMCwgMF0sIFswLCAxMjgsIDBdLCBbMCwgMCwgMTI4XSwgWzEyOCwgMTI4LCAwXSwKICAgICAgICBbMTI4LCAwLCAxMjhdLCBbMCwgMTI4LCAxMjhdLCBbMTI4LCAxMjgsIDEyOF0sIFsxOTIsIDE5MiwgMTkyXSwKICAgICAgICBbMjU1LCAxMjgsIDBdLCBbMjU1LCAwLCAxMjhdLCBbMTI4LCAyNTUsIDBdLCBbMCwgMjU1LCAxMjhdLAogICAgICAgIFsxMjgsIDAsIDI1NV0sIFswLCAxMjgsIDI1NV0sIFsyNTUsIDEyOCwgMTI4XSwgWzEyOCwgMjU1LCAxMjhdLAogICAgICAgIFsxMjgsIDEyOCwgMjU1XSwgWzI1NSwgMjU1LCAxMjhdLCBbMjU1LCAxMjgsIDI1NV0sIFsxMjgsIDI1NSwgMjU1XSwKICAgICAgICBbNjQsIDAsIDBdLCBbMCwgNjQsIDBdLCBbMCwgMCwgNjRdLCBbNjQsIDY0LCA2NF0KICAgIF07CgkqLwoKICAgIAogICAgLy8gR2V0IGJsb2NrIHNpemUgZnJvbSBVUkwgcGFyYW1ldGVyIGlmIHNwZWNpZmllZAogICAgdmFyIGJsb2NrU2l6ZXQgPSBNYXRoLmZsb29yKE1hdGgucG93KChNYXRoLlBJLzIpLCBNYXRoLmxvZyhNYXRoLlBJKnBhbENvdW50KSkpOyAvLyBEZWZhdWx0CiAgICB1ciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKICAgIHV1dWkgPSB1ci5zcGxpdCgiYmxvY2s9Iik7CiAgICBpZiAodXV1aS5sZW5ndGggPiAxKSB7CiAgICAgICAgbmFzID0gdXV1aVsxXTsKICAgICAgICByZWdnID0gbmFzLnNwbGl0KCImIik7CiAgICAgICAgdmFyIHNpemVQYXJhbSA9IHBhcnNlSW50KHJlZ2dbMF0pOwogICAgICAgIGlmICghaXNOYU4oc2l6ZVBhcmFtKSAmJiBzaXplUGFyYW0gPiAwICYmIHNpemVQYXJhbSA8PSA1KSB7CiAgICAgICAgICAgIGJsb2NrU2l6ZXQgPSBzaXplUGFyYW07CiAgICAgICAgfQogICAgfQogICAgCiAgICBmb3IgKGkgPSAwOyBpIDwgc2NjbGxsaWNlY2NoZWlnaHQ7IGkrKykgewogICAgICAgIHRlZ2hoID0gaW5zdGVsbHNjICogNDsKICAgICAgICAKICAgICAgICAvLyBCdWlsZCBiaW5hcnkgYmxvY2sgZnJvbSBhZGphY2VudCBjZWxscwogICAgICAgIHZhciBiaW5hcnlCbG9jayA9ICIiOwogICAgICAgIGZvciAodmFyIGIgPSAwOyBiIDwgYmxvY2tTaXpldDsgYisrKSB7CiAgICAgICAgICAgIHZhciBjZWxsSW5kZXggPSBpICsgYjsKICAgICAgICAgICAgLy8gSGFuZGxlIGJvdW5kYXJ5IGNvbmRpdGlvbnMKICAgICAgICAgICAgaWYgKGNlbGxJbmRleCA+PSBzY2NsbGxpY2VjY2hlaWdodCkgewogICAgICAgICAgICAgICAgY2VsbEluZGV4ID0gY2VsbEluZGV4ICUgc2NjbGxsaWNlY2NoZWlnaHQ7IC8vIFdyYXAgYXJvdW5kCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmluYXJ5QmxvY2sgKz0gY3VycnNjdGF0ZWNbY2VsbEluZGV4XSA/ICIxIiA6ICIwIjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ29udmVydCBiaW5hcnkgYmxvY2sgdG8gcGFsZXR0ZSBpbmRleCAoMC0zMSkKICAgICAgICB2YXIgcGFsZXR0ZUluZGV4ID0gcGFyc2VJbnQocmV2ZXJzZShiaW5hcnlCbG9jayksIDIpICUgcGFsQ291bnQ7CiAgICAgICAgCiAgICAgICAgLy8gU2V0IHBpeGVsIGNvbG9yIGZyb20gcGFsZXR0ZQogICAgICAgIHZhciBjb2xvciA9IHBhbGV0dGVbcGFsZXR0ZUluZGV4XTsKICAgICAgICBtaWpwaWtzZWxzY2NkLmRhdGFbdGVnaGhdID0gY29sb3JbMF07CiAgICAgICAgbWlqcGlrc2Vsc2NjZC5kYXRhW3RlZ2hoICsgMV0gPSBjb2xvclsxXTsKICAgICAgICBtaWpwaWtzZWxzY2NkLmRhdGFbdGVnaGggKyAyXSA9IGNvbG9yWzJdOwogICAgICAgIG1panBpa3NlbHNjY2QuZGF0YVt0ZWdoaCArIDNdID0gMjU1OwogICAgICAgIAogICAgICAgIGluc3RlbGxzYysrOwogICAgICAgIGFjaGhoY2hjbnVtbmVyID0gcmRpYWxzOwogICAgICAgIGNydXV1bGVkZHJlZSA9IDA7CiAgICAgICAgCiAgICAgICAgLy8gT3JpZ2luYWwgQ0EgcnVsZSBjYWxjdWxhdGlvbiAodW5jaGFuZ2VkKQogICAgICAgIHRndHJ1ID0gMDsKICAgICAgICBucmFhcnJ1UiA9IG5ldyBBcnJheSgpOwogICAgICAgIGZvciAocnJpY2MgPSAoaSAtIDIpOyBycmljYyA8PSAoaSArIDIpOyBycmljYysrKSB7CiAgICAgICAgICAgIG5yYWFycnVSW3RndHJ1XSA9IChycmljYyA8IDAgfHwgcnJpY2MgPj0gc2NjbGxsaWNlY2NoZWlnaHQpID8gZmFsc2UgOiBjdXJyc2N0YXRlY1tycmljY107CiAgICAgICAgICAgIHRndHJ1Kys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHZhciBucnJ1ID0gMDsKICAgICAgICBmb3IgKHJocHIgPSAwOyByaHByIDwgbnJhYXJydVIubGVuZ3RoOyByaHByKyspIHsKICAgICAgICAgICAgaWYgKG5yYWFycnVSW3JocHJdKSBucnJ1IHw9IE1hdGgucG93KDIsICh0Z3RydSAtIHJocHIgLSAxKSk7CiAgICAgICAgfQogICAgICAgIG5leHRzY3RhdGVjW2ldID0gKGNydXV1bGVkZCAmIE1hdGgucG93KDIsIG5ycnUpKSA+IDA7CiAgICB9CiAgICAKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NjbGxsaWNlY2NoZWlnaHQ7IGkrKykKICAgICAgICBjdXJyc2N0YXRlY1tpXSA9IG5leHRzY3RhdGVjW2ldOwogICAgCiAgICBsaWpubm5lc1tjdXJycm93dndjXSA9IGN1cnJzY3RhdGVjOwp9CgoKCmZ1bmN0aW9uIHd3b29vb3doaGhodygpIHsKCQkJdmFyIHNjcm9sbCA9IGZhbHNlOwoJCQlpZiAoIXNjcm9sbCB8fCBjdXJycm93dndjIDwgc2NjbGxsaWNlY2NsZW50aCAtIDEpIHsKCQkJCWN1cnJyb3d2d2MrKzsKCQkJCWN1cnJyb3d2d2MgJT0gc2NjbGxsaWNlY2NsZW50aDsKCQkJfSBlbHNlIHsKCQkJCWNvbnRleHR0dGNmLnB1dEltYWdlRGF0YShtaWpwaWtzZWxzY2NkLCAwLCAwKTsKCQkJCXRlbFlVSSsrOwoJCQl9CgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQl1cGRhdGVQaXhlbHMoKTsKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQkKCQkJCgkJCQoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNjY2xsbGljZWNjaGVpZ2h0OyBpKyspCgkJCQljdXJyc2N0YXRlY1tpXSA9IG5leHRzY3RhdGVjW2ldOwoJCWxpam5ubmVzW2N1cnJyb3d2d2NdPWN1cnJzY3RhdGVjOwp9CgkJCXZhciBjdXJyc2N0YXRlY3ggPSBuZXcgQXJyYXkoc2NjbGxsaWNlY2NoZWlnaHQpOwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IHNjY2xsbGljZWNjaGVpZ2h0OyBpKyspIHsKCQkJCXN3aXRjaCAoc3RhcnRpbmcpIHsKCQkJCQljYXNlICdyJzoKCQkJCQkJaWYgKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpKQoJCQkJCQkJY3VycnNjdGF0ZWN4W2ldID0gdHJ1ZTsKCQkJCQkJZWxzZSBjdXJyc2N0YXRlY3hbaV0gPSBmYWxzZTsKCQkJCQkJYnJlYWs7CgkJCQl9CgkJCX0KZnVuY3Rpb24gZG9vZVN0UnVsZU5ybk5yY3JlKCl7CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgicnVsZT0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwpycmVyZXI9cmVnZ1swXTsKcmVnZ2c9cnJlcmVyLnNwbGl0KCI6Iik7Cnh5emN4eXpjPXBhcnNlSW50KHJlZ2dnWzBdKTsKcmRpYWxzPXBhcnNlSW50KHJlZ2dnWzFdKTsKfQp1cj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU7CnV1dWk9dXIuc3BsaXQoIm5yPSIpOwppZih1dXVpLmxlbmd0aD4xKXsKbmFzPXV1dWlbMV07CnJlZ2c9bmFzLnNwbGl0KCImIik7CnJyZXJlcj1yZWdnWzBdOwpyZWdnZz1ycmVyZXIuc3BsaXQoIjoiKTsKeHl6Y3h5emM9cGFyc2VJbnQocmVnZ2dbMF0pOwpyZGlhbHM9cGFyc2VJbnQocmVnZ2dbMV0pOwp9CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgibnVtYmVyPSIpOwppZih1dXVpLmxlbmd0aD4xKXsKbmFzPXV1dWlbMV07CnJlZ2c9bmFzLnNwbGl0KCImIik7CnJyZXJlcj1yZWdnWzBdOwpyZWdnZz1ycmVyZXIuc3BsaXQoIjoiKTsKeHl6Y3h5emM9cGFyc2VJbnQocmVnZ2dbMF0pOwpyZGlhbHM9cGFyc2VJbnQocmVnZ2dbMV0pOwp9CnVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3aW5kb3dsb2NhdGlvbmhyZWYnKS52YWx1ZTsKdXV1aT11ci5zcGxpdCgibj0iKTsKaWYodXV1aS5sZW5ndGg+MSl7Cm5hcz11dXVpWzFdOwpyZWdnPW5hcy5zcGxpdCgiJiIpOwpycmVyZXI9cmVnZ1swXTsKcmVnZ2c9cnJlcmVyLnNwbGl0KCI6Iik7Cnh5emN4eXpjPXBhcnNlSW50KHJlZ2dnWzBdKTsKcmRpYWxzPXBhcnNlSW50KHJlZ2dnWzFdKTsKfQp1cj1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU7CnV1dWk9dXIuc3BsaXQoIng9Iik7CmlmKHV1dWkubGVuZ3RoPjEpewpuYXM9dXV1aVsxXTsKcmVnZz1uYXMuc3BsaXQoIiYiKTsKcnJlcmVyPXJlZ2dbMF07CnJlZ2dnPXJyZXJlci5zcGxpdCgiOiIpOwp4eXpjeHl6Yz1wYXJzZUludChyZWdnZ1swXSk7CnJkaWFscz1wYXJzZUludChyZWdnZ1sxXSk7Cn0KCQkJY3VycnNjdGF0ZWMgPSBuZXcgQXJyYXkoc2NjbGxsaWNlY2NoZWlnaHQpOwoJCQluZXh0c2N0YXRlYyA9IG5ldyBBcnJheShzY2NsbGxpY2VjY2hlaWdodCk7CgkJCWQ9TWF0aC5mbG9vcihjdXJyc2N0YXRlY3gubGVuZ3RoKk1hdGgucmFuZG9tKCkpOwoJCQljdXJyc2N0YXRlY3hbZF09IWN1cnJzY3RhdGVjeFtkXTsKCQkJZm9yICggaSA9IDA7IGkgPCBzY2NsbGxpY2VjY2hlaWdodDsgaSsrKSB7CgkJCQkgY3VycnNjdGF0ZWNbaV0gPSBjdXJyc2N0YXRlY3hbaV07CgkJCX0KCWN1cnJyb3d2d2MgPSAtMTsKCXJldHVybiB1bnR0dHUoKTsKfQoJdmFyIGNvYmJlZ3NzPTA7CgkKCQoJCgkKCQoJCgkKCQoJCgkvKioKICogR2VvcHRpbWFsaXNlZXJkZSB2ZXJzaWUgdmFuIHVudHR0dQogKiAtIFZlcndpamRlcnQgc3RhY2stb3ZlcmZsb3cgcmlzaWNvIGRvb3IgcmVjdXJzaWUgdGUgdmVydmFuZ2VuIGRvb3IgZWVuIGx1cy4KICogLSBHZWJydWlrdCByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgdm9vciBicm93c2VyLXN0YWJpbGl0ZWl0LgogKiAtIEludGVncmVlcnQgZGUgJ3NhdmUnIGxvZ2ljYSBjb3JyZWN0IHpvbmRlciBkZSBmbG93IHRlIGJyZWtlbi4KICovCmFzeW5jIGZ1bmN0aW9uIHVudHR0dSgpIHsKICAgIC8vIFJlc2V0IHBhcmFtZXRlcnMgdm9vciBlZW4gbmlldXdlIGdlbmVyYXRpZQogICAgY29iYmVnc3MgPSAwOwogICAgaW5zdGVsbHNjID0gMDsKCiAgICAvLyBMb29wIGRvb3IgYWxsZSByaWplbiB2YW4gaGV0IGNhbnZhcwogICAgd2hpbGUgKGNvYmJlZ3NzIDwgc2NjbGxsaWNlY2NsZW50aCkgewogICAgICAgIC8vIFZvZXIgZGUgQ0EtYmVyZWtlbmluZyB1aXQgdm9vciBkZSBodWlkaWdlIHJpagogICAgICAgIHd3b29vb3d3KCk7CiAgICAgICAgY29iYmVnc3MrKzsKCiAgICAgICAgLy8gR2VlZiBkZSBicm93c2VyIGVsa2UgMTYgcmlqZW4gZXZlbiAnYWRlbXJ1aW10ZScgb20gVUktZnJlZXplcyB0ZSB2b29ya29tZW4KICAgICAgICBpZiAoY29iYmVnc3MgJSAxNiA9PT0gMCkgewogICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIC0tLSBHZW5lcmF0aWUgdm9sdG9vaWQgLS0tCiAgICAKICAgIC8vIFRla2VuIGhldCBlaW5kcmVzdWx0YWF0IG9wIGhldCBjYW52YXMKICAgIGNvbnRleHR0dGNmLnB1dEltYWdlRGF0YShtaWpwaWtzZWxzY2NkLCAwLCAwKTsKCiAgICAvLyBIYWFsIGRlIGRhdGFVUkwgb3AgKG5vZGlnIHZvb3Igd2VlcmdhdmUgb2Ygb3BzbGFnKQogICAgY29uc3QgZmluYWxEYXRhVXJsID0gY292ZXJzY3oyY2IudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTsKCiAgICAvLyBBZmhhbmRlbGluZyB2YW4gZGUgYXV0b21hdGlzY2hlIG9wc2xhZyAoU2F2ZS1sb2dpY2EpCiAgICBpZiAoYXV0b28gPT09ICJzYXZlIikgewogICAgICAgIHZlcndlcmtPcHNsYWcoZmluYWxEYXRhVXJsKTsKICAgIH0KCiAgICAvLyBTdGFydCBkZSB2b2xnZW5kZSByb25kZSBhbHMgZGUgYXV0b21hdGlzY2hlIG1vZHVzIGFhbiBzdGFhdAogICAgaWYgKGF1dG9vICE9PSAiIikgewogICAgICAgIG5leHROcigpOwogICAgICAgIC8vIFN0YXJ0IGVlbiBuaWV1d2UgZ2VuZXJhdGllIG5hIGVlbiBrb3J0ZSBwYXV6ZQogICAgICAgIHNldFRpbWVvdXQoZG9vZVN0UnVsZU5ybk5yY3JlLCAxMDApOwogICAgfQoKICAgIHJldHVybiBmaW5hbERhdGFVcmw7Cn0KCi8qKgogKiBIdWxwZnVuY3RpZSB2b29yIHZlaWxpZ2Ugb3BzbGFnIHZhbiBkZSBnZW5lcmF0aWUKICovCmZ1bmN0aW9uIHZlcndlcmtPcHNsYWcoZGF0YVVybCkgewogICAgY29uc3QgdGVtcEltYWdlID0gbmV3IEltYWdlKCk7CiAgICB0ZW1wSW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3Qgc2F2ZUNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIC8vIEJlaG91ZCBkZSBvcmljw6tudGF0aWUgbG9naWNhIHVpdCBqZSBvcmlnaW5lbGUgc2NyaXB0CiAgICAgICAgc2F2ZUNhbnZhcy53aWR0aCA9IHRlbXBJbWFnZS5uYXR1cmFsSGVpZ2h0OwogICAgICAgIHNhdmVDYW52YXMuaGVpZ2h0ID0gdGVtcEltYWdlLm5hdHVyYWxXaWR0aDsKICAgICAgICAKICAgICAgICBjb25zdCBzQ3R4ID0gc2F2ZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgd2lsbFJlYWRGcmVxdWVudGx5OiB0cnVlIH0pOwogICAgICAgIHNDdHgucm90YXRlKC1NYXRoLlBJIC8gMik7CiAgICAgICAgc0N0eC50cmFuc2xhdGUoLXRlbXBJbWFnZS5uYXR1cmFsSGVpZ2h0LCAwKTsKICAgICAgICBzQ3R4LmRyYXdJbWFnZSh0ZW1wSW1hZ2UsIDAsIDApOwogICAgICAgIAogICAgICAgIGNvbnN0IGZpbmFsVXJsID0gc2F2ZUNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOwogICAgICAgIAogICAgICAgIC8vIENvbnRyb2xlZXIgZHJlbXBlbHdhYXJkZSAoYmlqdi4gNDgwMDAgYnl0ZXMpIHZvb3Igb3BzbGFnCiAgICAgICAgaWYgKGZpbmFsVXJsLmxlbmd0aCA+IGRyZW1wZWxzc2l6ZSkgewogICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2F3ZXInKSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGxpbmsuaHJlZiA9IGZpbmFsVXJsOwogICAgICAgICAgICBsaW5rLmRvd25sb2FkID0geHl6Y3h5emMgKyAnLnBuZyc7CiAgICAgICAgICAgIGxpbmsuY2xpY2soKTsKICAgICAgICB9CiAgICB9OwogICAgdGVtcEltYWdlLnNyYyA9IGRhdGFVcmw7Cn0KCQoJCgkKCQpmdW5jdGlvbiB1c3NzbnR0dHUoKSB7CmNvYmJlZ3NzKys7CglpZihjb2JiZWdzczxzY2NsbGxpY2VjY2xlbnRoKXsKCQkJd3dvb29vd3coKTsKcmV0dXJuIHVudHR0dSgpOwoJfQoJZWxzZXsKY29iYmVnc3M9MDsKCQlpbnN0ZWxsc2M9MDsKbXNkZmdmZz0xMDAwMDAwMDAwMDAwMDsKY29udGV4dHR0Y2YucHV0SW1hZ2VEYXRhKG1panBpa3NlbHNjY2QsIDAsIDApOwoKcmV0dXJuIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb3ZlcnNjejJjYicpLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7CmlmKGF1dG9vPT0ic2F2ZSIpewoJZD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXdlcicpOwppbWFnZT1uZXcgSW1hZ2UoKTsKaW1hZ2Uub25sb2FkPWZ1bmN0aW9uKCl7CiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgIGNhbnZhcy53aWR0aCA9IGltYWdlLm5hdHVyYWxIZWlnaHQ7CiAgICBjYW52YXMuaGVpZ2h0ID0gaW1hZ2UubmF0dXJhbFdpZHRoOwogICAgY29uc3QgY3R4eHh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJywge3dpbGxSZWFkRnJlcXVlbnRseTogdHJ1ZX0pOwogICAgY3R4eHh0LnJvdGF0ZSgtTWF0aC5QSSAvIDIpOwogICAgY3R4eHh0LnRyYW5zbGF0ZSgtaW1hZ2UubmF0dXJhbEhlaWdodCwgMCk7CiAgICBjdHh4eHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTsKCWQuc2V0QXR0cmlidXRlKCdocmVmJywgY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJykpOwpzaXp6ej1jYW52YXMudG9EYXRhVVJMKCdpbWFnZS9wbmcnKTsKbXNkZmdmZz1zaXp6ei5sZW5ndGgKCWQuc2V0QXR0cmlidXRlKCdkb3dubG9hZCcseHl6Y3h5emMrJy5wbmcnKTsKaWYobXNkZmdmZz5kcmVtcGVsc3NpemUpewoJZC5jbGljaygpOwp9Cn07CmltYWdlLnNyYz1jb3ZlcnNjejJjYi50b0RhdGFVUkwoJ2ltYWdlL3BuZycpOwp9CmlmKGF1dG9vIT0iIil7Cm5leHROcigpOwp9CmlmKG1zZGZnZmc+ZHJlbXBlbHNzaXplKXsKfQplbHNlewp9Cn0KfQp2YXIgYWNoaGhjaGNudW1uZXI9MjsKZnVuY3Rpb24gY3J1dXVsZWRkX3hvcihudW0pIHsKCS8vY3J1dXVsZWRkIF49IG51bTsKfQpmdW5jdGlvbiBjcnV1dWxlZGRfc2V0KG51bSkgewoJCS8vY3J1dXVsZWRkID0gbnVtOwp9CgkJCWNvdmVyc2N6MmNiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvdmVyc2N6MmNiIik7CgkJCWNvbnRleHR0dGNmID0gY292ZXJzY3oyY2IuZ2V0Q29udGV4dCgnMmQnKTsKCQkJbWlqcGlrc2Vsc2NjZD1jb250ZXh0dHRjZi5nZXRJbWFnZURhdGEoMCwwLHNjY2xsbGljZWNjaGVpZ2h0LCBzY2NsbGxpY2VjY2xlbnRoKTsKCQkJCgkJCWZ1bmN0aW9uIGdlbmVyYXRlQ29tcGxleFJ1bGUoY2VsbFN0YXRlcyA9IDIsIG5laWdoYm9yaG9vZCA9IDMpIHsJCSAgCiAgICBsZXQgcnVsZUJpdHMgPSAiIjsKICAgIGxldCBhdHRlbXB0cyA9IDA7CiAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDEwMDsKICAgIAogICAgZG8gewogICAgICAgIC8vIFN0YXJ0IHdpdGggYSBzZW1pLXJhbmRvbSBwYXR0ZXJuCiAgICAgICAgcnVsZUJpdHMgPSAiIjsKICAgICAgICAKICAgICAgICAvLyBQcmVmZXIgcnVsZXMgd2l0aCBtaXhlZCBwYXR0ZXJucyAobm90IGFsbCAwcyBvciAxcykKICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgTWF0aC5wb3coY2VsbFN0YXRlcywgbmVpZ2hib3Job29kKTsgaSsrKSB7CiAgICAgICAgICAgIC8vIEJpYXNlZCByYW5kb20gdG8gYXZvaWQgdHJpdmlhbCBydWxlcwogICAgICAgICAgICBsZXQgcmFuZCA9IE1hdGgucmFuZG9tKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSdWxlcyAwIGFuZCAyNTUgYXJlIHRyaXZpYWwgKGFsbCBkZWFkL2FsbCBhbGl2ZSkKICAgICAgICAgICAgLy8gUnVsZXMgbGlrZSA5MCwgMTEwLCAzMCwgNDUgb2Z0ZW4gaGF2ZSBjb21wbGV4IGJlaGF2aW9yCiAgICAgICAgICAgIGlmKHJhbmQgPCAwLjMpIHsKICAgICAgICAgICAgICAgIHJ1bGVCaXRzICs9ICIwIjsKICAgICAgICAgICAgfSBlbHNlIGlmKHJhbmQgPCAwLjcpIHsKICAgICAgICAgICAgICAgIHJ1bGVCaXRzICs9ICIxIjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEFkZCBzb21lIGRldGVybWluaXN0aWMgcGF0dGVybnMKICAgICAgICAgICAgICAgIHJ1bGVCaXRzICs9IChpICUgMikudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBhdHRlbXB0cysrOwogICAgICAgIAogICAgICAgIC8vIENoZWNrIGZvciB0cml2aWFsIHJ1bGVzCiAgICAgICAgY29uc3QgcnVsZU51bSA9IHBhcnNlSW50KHJ1bGVCaXRzLCAyKTsKICAgICAgICBjb25zdCBpc1RyaXZpYWwgPSBydWxlTnVtID09PSAwIHx8IHJ1bGVOdW0gPT09IDI1NTsKICAgICAgICBjb25zdCBoYXNQYXR0ZXJuID0gcnVsZUJpdHMuaW5jbHVkZXMoIjAxIikgJiYgcnVsZUJpdHMuaW5jbHVkZXMoIjEwIik7CiAgICAgICAgCiAgICAgICAgLy8gS2VlcCBpZiBub3QgdHJpdmlhbCBhbmQgaGFzIHZhcmlhdGlvbgogICAgICAgIGlmKCFpc1RyaXZpYWwgJiYgaGFzUGF0dGVybikgewogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgCiAgICB9IHdoaWxlKGF0dGVtcHRzIDwgbWF4QXR0ZW1wdHMpOwogICAgCiAgICBjb25zdCBydWxlTnVtYmVyID0gcGFyc2VJbnQocnVsZUJpdHMsIDIpOwogICAgY29uc29sZS5sb2coYFJ1bGUgJHtydWxlTnVtYmVyfTogJHtydWxlQml0c31gKTsKCQoJfQoJCgkJCQoJCQlmdW5jdGlvbiBnZW5lcmF0ZUNvbXBsZXhSdWxlX19fKGNlbGxTdGF0ZXMgPSAyLCBuZWlnaGJvcmhvb2QgPSAzKSB7CiAgICBjb25zdCBjb21wbGV4UnVsZVBhdHRlcm5zID0gWwogICAgICAgICIwMDAxMTExMCIsIC8vIFJ1bGUgMzAKICAgICAgICAiMDEwMTEwMTAiLCAvLyBSdWxlIDkwICAKICAgICAgICAiMDExMDExMTAiLCAvLyBSdWxlIDExMAogICAgICAgICIwMDExMDExMCIsIC8vIFJ1bGUgNTQKICAgICAgICAiMDExMDEwMDEiLCAvLyBSdWxlIDEwNQogICAgICAgICIwMDAxMDExMCIsIC8vIFJ1bGUgMjIKICAgICAgICAiMDEwMTAxMDEiLCAvLyBSdWxlIDg1CiAgICAgICAgIjAwMTExMTAwIiwgLy8gUnVsZSA2MAogICAgICAgICIwMTExMTAwMCIsIC8vIFJ1bGUgMTIwCiAgICAgICAgIjEwMTAxMDEwIiwgLy8gUnVsZSAxNzAKICAgIF07CiAgICAKCSAgICAgICAgY29uc3QgcmFuZG9tUGF0dGVybiA9IGNvbXBsZXhSdWxlUGF0dGVybnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY29tcGxleFJ1bGVQYXR0ZXJucy5sZW5ndGgpXTsKICAgICAgICAvL2NvbnN0IHJ1bGVOdW1iZXIgPSBwYXJzZUludChyYW5kb21QYXR0ZXJuLCAyKTsKICAgICAgIC8vIGNvbnNvbGUubG9nKGBTZWxlY3RlZCBrbm93biBjb21wbGV4IHJ1bGU6ICR7cnVsZU51bWJlcn0gKCR7cmFuZG9tUGF0dGVybn0pYCk7CiAgICAgICAvLyByZXR1cm4gcnVsZU51bWJlcjsKCS8qCiAgICAvLyBNRVRIT0QgMTogUmFuZG9tbHkgc2VsZWN0IG9uZSBwYXR0ZXJuCiAgICBpZihNYXRoLnJhbmRvbSgpIDwgMC40KSB7CiAgICAgICAgY29uc3QgcmFuZG9tUGF0dGVybiA9IGNvbXBsZXhSdWxlUGF0dGVybnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY29tcGxleFJ1bGVQYXR0ZXJucy5sZW5ndGgpXTsKICAgICAgICBjb25zdCBydWxlTnVtYmVyID0gcGFyc2VJbnQocmFuZG9tUGF0dGVybiwgMik7CiAgICAgICAgY29uc29sZS5sb2coYFNlbGVjdGVkIGtub3duIGNvbXBsZXggcnVsZTogJHtydWxlTnVtYmVyfSAoJHtyYW5kb21QYXR0ZXJufSlgKTsKICAgICAgICByZXR1cm4gcnVsZU51bWJlcjsKICAgIH0KICAgICovCiAgICAvLyBNRVRIT0QgMjogQ3JlYXRlIGh5YnJpZCBieSBtaXhpbmcgcGF0dGVybnMKICAgIGxldCBydWxlQml0cyA9ICIiOwogICAgY29uc3QgcGF0dGVybjEgPSBjb21wbGV4UnVsZVBhdHRlcm5zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNvbXBsZXhSdWxlUGF0dGVybnMubGVuZ3RoKV07CiAgICBjb25zdCBwYXR0ZXJuMiA9IGNvbXBsZXhSdWxlUGF0dGVybnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogY29tcGxleFJ1bGVQYXR0ZXJucy5sZW5ndGgpXTsKICAgIAogICAgZm9yKGxldCBpID0gMDsgaSA8IDg7IGkrKykgewogICAgICAgIGlmKE1hdGgucmFuZG9tKCkgPCAwLjUpIHsKICAgICAgICAgICAgcnVsZUJpdHMgKz0gcGF0dGVybjFbaV07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcnVsZUJpdHMgKz0gcGF0dGVybjJbaV07CiAgICAgICAgfQogICAgfQogICAgCiAgIGNvbnN0IHJ1bGVOdW1iZXIgPSBwYXJzZUludChydWxlQml0cywgMik7CiAgLy8gIGNvbnNvbGUubG9nKGBIeWJyaWQgcnVsZTogJHtydWxlTnVtYmVyfSAoJHtydWxlQml0c30pID0gJHtwYXR0ZXJuMX0gKyAke3BhdHRlcm4yfWApOwogICAgcmV0dXJuIHJ1bGVOdW1iZXI7Cn0KZnVuY3Rpb24gbmV4dE5yKCl7CgoKaGFoYWhhaD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU7CmlmKGhhaGFoYWghPSIiKXsKCmhoYmJnPWhhaGFoYWguc3BsaXQoIlI9Iik7CmlmKGhoYmJnLmxlbmd0aD4xKXsKCgpyZGlhbHM9cGFyc2VJbnQoaGhiYmdbMV0pOwpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2luZG93bG9jYXRpb25ocmVmJykudmFsdWU9IiI7Cn0KCgp9CnN0dD0iIjsKYmI9TWF0aC5yb3VuZCg1KygxNSpNYXRoLnJhbmRvbSgpKSk7CmZvcihiPTA7YjxiYjtiKyspewppZihNYXRoLnJhbmRvbSgpPi41KXsKc3R0Kz0iMCI7Cn0KZWxzZXsKc3R0Kz0iMSI7Cn0KfQppbnRlcj1wYXJzZUludChzdHQsMik7CgoKCgoKCgoKCgoKCiAgICBzdHQgPSAiIjsKICAgIGJiID0gTWF0aC5yb3VuZCgxNSArICgxNSAqIE1hdGgucmFuZG9tKCkpKTsKICAgIAogICAgLy8gQmlhcyB0b3dhcmQgY29tcGxleCBwYXR0ZXJucwogICAgZm9yKGIgPSAwOyBiIDwgYmI7IGIrKykgewogICAgICAgIC8vIEF2b2lkIGFsbCAwcyBvciBhbGwgMXMgcGF0dGVybnMKICAgICAgICBpZihiIDwgMikgewogICAgICAgICAgICBzdHQgKz0gIjAxIltiICUgMl07IC8vIFN0YXJ0IHdpdGggYWx0ZXJuYXRpbmcKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBBZGQgc29tZSBzdHJ1Y3R1cmVkIHJhbmRvbW5lc3MKICAgICAgICAgICAgY29uc3QgcHJldjEgPSBwYXJzZUludChzdHRbYi0xXSwgMTApOwogICAgICAgICAgICBjb25zdCBwcmV2MiA9IHBhcnNlSW50KHN0dFtiLTJdLCAxMCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZihwcmV2MSA9PT0gcHJldjIpIHsKICAgICAgICAgICAgICAgIC8vIEJyZWFrIHBhdHRlcm5zCiAgICAgICAgICAgICAgICBzdHQgKz0gKDEgLSBwcmV2MSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEFkZCBzb21lIHJhbmRvbW5lc3MKICAgICAgICAgICAgICAgIHN0dCArPSBNYXRoLnJhbmRvbSgpID4gMC41ID8gIjEiIDogIjAiOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoJCgkKCQoJCiAgICAKICAgIGludGVyID0gZ2VuZXJhdGVDb21wbGV4UnVsZSgyLCAgNSk7IC8vcGFyc2VJbnQoc3R0LCAyKTsKCWNvbnNvbGUubG9nKGludGVyKyJ2dnZ2dnZ2dnZ2dnZ2dnZ2dnYiKTsKICAgIGNydXV1bGVkZCA9IGludGVyOwogICAgCgoKCgoKCgoKY3J1dXVsZWRkPWdlbmVyYXRlQ29tcGxleFJ1bGUoMiw1KTsKLy9ubj1NYXRoLnJvdW5kKE1hdGgucG8pCmNvbnNvbGUubG9nKGludGVyKyIgKysrKysrKysrKysrKysrIitzdHQpOwoKeHl6Y3h5emM9aW50ZXI7IC8vcnVsZVR5cGVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSpydWxlVHlwZXMubGVuZ3RoICldOwppZihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaWluZm9zcycpKXsKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lpbmZvc3MnKS5pbm5lckhUTUw9eHl6Y3h5emM7Cn0KCgoKfQoKCgoKCnZhciBydWxlVHlwZXM9bmV3IEFycmF5KCk7CnRtcENvdW50ZXI9MDsKdG1wUnVsZV89MDsKb3J1bGVUeXBlc25yc3Jzcj1uZXcgQXJyYXkoKTsKZm9yKHZhciBuPTA7bjxNYXRoLnBvdygyLDEyKTtuKz0xKXsKCXZhciBuYmluPW4udG9TdHJpbmcoMik7Cgl2YXIgbmJpbnJldiA9ICIiOwoJZm9yICh2YXIgaSA9IG5iaW4ubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pCgl7CgkJbmJpbnJldiArPSBuYmluW2ldOwoJfQogICAgICAgIG5iaW5yZXZudD1wYXJzZUludChuYmlucmV2LDIpOwoJdG1wUnVsZV8rPShuYmlucmV2bnQvMikqTWF0aC5wb3coLTEsIChuYmlucmV2bnQlMikpICYgbmJpbnJldm50OwoJcnVsZVR5cGVzW3RtcENvdW50ZXJdPXRtcFJ1bGVfOwoJdG1wQ291bnRlcisrOwp9CnJ1bGVUeXBlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpewoJcmV0dXJuIChhIC0gYik7Cn0pOwpydWxlVHlwZXNfPW5ldyBBcnJheSgpOwp0ZW1wU3VtPTA7CnRlcnJyPTA7CmZvcih2YXIgbj0wO248TWF0aC5wb3coMiwxMik7bis9MSl7Cgl0ZW1wU3VtKz1ydWxlVHlwZXNbbl07CglydWxlVHlwZXNfW25dPXRlbXBTdW0tMTsKfQpydWxlVHlwZXM9cnVsZVR5cGVzXzsKCgoKCnZhciByZXRpbz1uZXcgQXJyYXkoKTsKLyoKdGFnPSIxMDM2OTQ3ODAzfDEyMDM2Mzc3OTR8MTI2MjQ4NzE5NnwxMzA2NDMzOHwxMzIxNzY2NzEwfDEzNDI2MDAxfDE0NDgxMjM0M3wxNTQxMjA2MTgwfDE1NDg2NzY0NTR8MTU2OTM0NTM2OHwxNTg4Mjk0MjczfDE2MTQ1NjZ8MTY2ODMyMXwxODE1MjA3Njc0fDE4NTI4NjE1MTF8MjAxMjkzMjQxMnwyMDMxODE0NHwyMDQ0MnwyMTU4MTM5NzE2fDIxNTgxMzk3MTZ8MjE2MDQ1OTM2MHwyMjMzMTAyMTk2fDIzNDM1MDAwMDd8MjQxMDAyNjI0NHwyNTcxODgyMTE2fDI2MjExNDc4MjJ8Mjg0NzE0OXwyODg4OTg4MDN8Mjk2NDU5NDY2MHwyOTk5MDM2MDJ8MzA4MzYxNzMyMnwzNDUzOTA4NjE2fDM3NTQ1ODg0NTZ8MzkzNjUzMjc3Nnw0MTEzMTg3NjA4fDQzMjc1MTE5NHw1NDc4MzQ3NTMwfDU2MjQyOTQ2Mnw1NjY5NTYxMzU0fDU3MzAwMzcxNDZ8NTc0MjE3NDE3MHw1ODkzNjE3MTR8NTk3OTU0NzA4Mnw2NzUyODZ8NzA2MjR8NzI1MjIxNDUwfDgwOTkyODk4fDg2MTA1MDI2fDg4NjIyMjE5MyI7IAoKdGZmZj10YWcuc3BsaXQoJ3wnKTsKZm9yKGc9MDtnPHRmZmYubGVuZ3RoO2crKyl7CnJldGlvW2ddPXBhcnNlSW50KHRmZmZbZ10pOwp9CgoqLwpyZXRpb1swXT0yNDY0MTQ0MjM2OwpyZXRpb1sxXT00NjQxMzQ3MzIxOyAgIApyZXRpb1syXT02MDEwOTE2MTE5OwpyZXRpb1szXT02MTI5NTU1NjczOyAgCnJldGlvWzRdPTYxMzAxMzAyNTA7IApyZXRpb1s1XT01NzIyNDI4MTI5OwpyZXRpb1s2XT0zMzI4NTQwODc0OwpyZXRpb1s3XT0zNTg5NTEwNzEzOyAKcmV0aW9bOF09NjA5OTg5MjUxMDsKcmV0aW9bOV09NDE4MzcxMjc2MjsKcmV0aW9bMTBdPTU2MDI0MzcwNzY7CgoKcmV0aW9bMTFdPTEyNjcwNzAzNjc7CnJldGlvWzEyXT01MTE3NzMwNzM0OwpyZXRpb1sxM109NjEwODM3NjI4NDsKcmV0aW9bMTRdPTYxMzIyNjM3MDk7CnJldGlvWzE1XT0yMTg3MDk3ODYwOwpyZXRpb1sxNl09NDE1MzExNjI3NjsKcmV0aW9bMTddPTYxMjc3NzAyODg7CnJldGlvWzE4XT0zOTk1NjMzMTE0OwpyZXRpb1sxOV09NTI3MjY3MzU1NjsKcmV0aW9bMjBdPTYxMzIyODM5NDU7CgpyZXRpb1syMV09NjA3NDM4ODM2MjsKcmV0aW9bMjJdPTYxMzIyMjM5MTI7CnJldGlvWzIzXT02MTMwMzY5NDk1OwpyZXRpb1syNF09NjAwMjQ2NTEzNjsKcmV0aW9bMjVdPTU3OTYxMDkwNTg7CnJldGlvWzI2XT0zODQwMjU1NTg4OwpyZXRpb1syN109MTI2NzA3MDM2NzsKcmV0aW9bMjhdPTQ4NDkwNDEyNjU7CnJldGlvWzI5XT00MjAzMjI0NjY1OyAKcmV0aW9bMzBdPTM3Nzk2NDY5NDE7CnJldGlvWzMxXT01MzU0NDY2MzE1OwpyZXRpb1szMV09MzYzNTM0NDQ1NTsKCgp0b3B0PS0xOyAvL3JldGlvLmxlbmd0aC0xOwoKdG9wdCsrOyByZXRpb1t0b3B0XT0gMTAzNjk0NzgwMzsKdG9wdCsrOyByZXRpb1t0b3B0XT0gMTIwMzYzNzc5NDsgIAp0b3B0Kys7IHJldGlvW3RvcHRdPTEyNjI0ODcxOTY7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTMwNjQzMzg7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTMyMTc2NjcxMDsKdG9wdCsrOyByZXRpb1t0b3B0XT0xMzQyNjAwMTsKdG9wdCsrOyByZXRpb1t0b3B0XT0xNTQxMjA2MTgwOwp0b3B0Kys7IHJldGlvW3RvcHRdPTE1NjkzNDUzNjg7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTU4ODI5NDI3MzsKdG9wdCsrOyByZXRpb1t0b3B0XT0xNjY4MzIxOwp0b3B0Kys7IHJldGlvW3RvcHRdPTE4MTUyMDc2NzQ7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTg1Mjg2MTUxMTsKdG9wdCsrOyByZXRpb1t0b3B0XT0yMDEyOTMyNDEyOwp0b3B0Kys7IHJldGlvW3RvcHRdPTIxNTgxMzk3MTY7CnRvcHQrKzsgcmV0aW9bdG9wdF09MjE2MDQ1OTM2MDsKdG9wdCsrOyByZXRpb1t0b3B0XT0yMjMzMTAyMTk2Owp0b3B0Kys7IHJldGlvW3RvcHRdPTI0MTAwMjYyNDQ7CnRvcHQrKzsgcmV0aW9bdG9wdF09MjU3MTg4MjExNjsKdG9wdCsrOyByZXRpb1t0b3B0XT0yNjIxMTQ3ODIyOwp0b3B0Kys7IHJldGlvW3RvcHRdPTI5OTkwMzYwMjsKdG9wdCsrOyByZXRpb1t0b3B0XT0zMDgzNjE3MzIyOwp0b3B0Kys7IHJldGlvW3RvcHRdPTM3NTQ1ODg0NTY7CnRvcHQrKzsgcmV0aW9bdG9wdF09MzkzNjUzMjc3NjsKdG9wdCsrOyByZXRpb1t0b3B0XT00MzI3NTExOTQ7CnRvcHQrKzsgcmV0aW9bdG9wdF09NTQ3ODM0NzUzMDsKdG9wdCsrOyByZXRpb1t0b3B0XT01NjI0Mjk0NjI7CnRvcHQrKzsgcmV0aW9bdG9wdF09NTczMDAzNzE0NjsKdG9wdCsrOyByZXRpb1t0b3B0XT01ODkzNjE3MTQ7CnRvcHQrKzsgcmV0aW9bdG9wdF09NTk3OTU0NzA4MjsKdG9wdCsrOyByZXRpb1t0b3B0XT03MDYyNDsKdG9wdCsrOyByZXRpb1t0b3B0XT03MjUyMjE0NTA7CnRvcHQrKzsgcmV0aW9bdG9wdF09ODYxMDUwMjY7CnRvcHQrKzsgcmV0aW9bdG9wdF09ODg2MjIyMTkzOyAKdG9wdCsrOyByZXRpb1t0b3B0XT0xNTg4Mjk0MjczOwp0b3B0Kys7IHJldGlvW3RvcHRdPTI5OTkwMzYwMjsKdG9wdCsrOyByZXRpb1t0b3B0XT02MDk1OTk3NTc4Owp0b3B0Kys7IHJldGlvW3RvcHRdPTM5MzY1MzI3NzY7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTUyMjYzODc0OTsKdG9wdCsrOyByZXRpb1t0b3B0XT0xMjAzNjM3Nzk0Owp0b3B0Kys7IHJldGlvW3RvcHRdPTEwNTQ2MzAxNDg7CnRvcHQrKzsgcmV0aW9bdG9wdF09NDk0NTIzMDYzNDsKdG9wdCsrOyByZXRpb1t0b3B0XT05MDYwMzg2ODA7CnRvcHQrKzsgcmV0aW9bdG9wdF09MzQ4Mjk4OTQ0ODsKdG9wdCsrOyByZXRpb1t0b3B0XT0xMDcwMTQ0NjU4Owp0b3B0Kys7IHJldGlvW3RvcHRdPTEzNjU2OTgxODQ7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTY1ODgxNzEzNjsKdG9wdCsrOyByZXRpb1t0b3B0XT0zNzUyNjk4NjU4Owp0b3B0Kys7IHJldGlvW3RvcHRdPTc1MDkyOTMyMjsKdG9wdCsrOyByZXRpb1t0b3B0XT01OTcwNjIwMDM2Owp0b3B0Kys7IHJldGlvW3RvcHRdPTc1MzUxOTU0NDsKdG9wdCsrOyByZXRpb1t0b3B0XT02MTE5Mzg1MjMwOwp0b3B0Kys7IHJldGlvW3RvcHRdPTYxMjc3MzI1MTM7CnRvcHQrKzsgcmV0aW9bdG9wdF09NjExMTE1NTkxNTsKdG9wdCsrOyByZXRpb1t0b3B0XT05NjA2NTcwODsKdG9wdCsrOyByZXRpb1t0b3B0XT02MTE5NjY1MDk4Owp0b3B0Kys7IHJldGlvW3RvcHRdPTYxMzIyODM5NDU7CnRvcHQrKzsgcmV0aW9bdG9wdF09MTc5NDM4ODU2NjsKdG9wdCsrOyByZXRpb1t0b3B0XT02MTMyMjg0Mzg0Owp0b3B0Kys7IHJldGlvW3RvcHRdPTYxMzIyNTA3Mzc7CnRvcHQrKzsgcmV0aW9bdG9wdF09NTc1MDc4NjI0NTsgICAgICAgICAgICAgICAgICAgICAgICAgCnRvcHQrKzsgcmV0aW9bdG9wdF09NjEzMTg2MDgyNDsKdG9wdCsrOyByZXRpb1t0b3B0XT02MTI1NTk2NDMzOwp0b3B0Kys7IHJldGlvW3RvcHRdPTYwODE4NTA4OTY7CnRvcHQrKzsgcmV0aW9bdG9wdF09NTc2MDY3ODkzMjsKdG9wdCsrOyByZXRpb1t0b3B0XT02MTMxODYwODI0Owp0b3B0Kys7IHJldGlvW3RvcHRdPTU4OTg1NTA0OTc7CnRvcHQrKzsgcmV0aW9bdG9wdF09NjEzMjI0NjIyMDsgICAgIAp0b3B0Kys7IHJldGlvW3RvcHRdPTYxMjgwNjYyNDg7CnRvcHQrKzsgcmV0aW9bdG9wdF09MzMyODU0MDg3NDsKdG9wdCsrOyByZXRpb1t0b3B0XT01NDIzNTk3NTAwOyAgIAp0b3B0Kys7IHJldGlvW3RvcHRdPTU4NDk1NzgwMjA7CnRvcHQrKzsgcmV0aW9bdG9wdF09NjExOTY2NTA5ODsKdG9wdCsrOyByZXRpb1t0b3B0XT0zNTY1MDAyODUwOwp0b3B0Kys7IHJldGlvW3RvcHRdPTYxMzIyNjY1Mzc7IAp0b3B0Kys7IHJldGlvW3RvcHRdPTUzNTM0MDAzMzI7IAp0b3B0Kys7IHJldGlvW3RvcHRdPTE2NzY5MTM1Mzk7IAoKCi8vIEZ1bmN0aW9uIHRvIGdlbmVyYXRlIHBvdGVudGlhbGx5IGNvbXBsZXggQ0EgcnVsZXMKZnVuY3Rpb24gZ2VuZXJhdGVDb21wbGV4UnVsZShjZWxsU3RhdGVzID0gMiwgbmVpZ2hib3Job29kID0gMykgewptYXg9MDsKZm9yKHI9MDtyPHJldGlvLmxlbmd0aDtyKyspewpzPXJldGlvW3JdOwplcz1zLnRvU3RyaW5nKDIpOwpkZj1lcy5sZW5ndGg7CmlmKGRmPm1heCl7Cm1heD1kZgp9Cgp9CgoKCnd3Zj1yZXRpb1tNYXRoLmZsb29yKHJldGlvLmxlbmd0aCpNYXRoLnJhbmRvbSgpKV07Cnd3Zz1yZXRpb1tNYXRoLmZsb29yKHJldGlvLmxlbmd0aCpNYXRoLnJhbmRvbSgpKV07CmJ3d2Y9d3dmLnRvU3RyaW5nKDIpOwpid3dnPXd3Zy50b1N0cmluZygyKTsKCgpid3djb209IiI7CmFid3djb209bmV3IEFycmF5KCk7CmZvcih5eT0wO3l5PGJ3d2YubGVuZ3RoO3l5KyspewphYnd3Y29tW3l5XT1id3dmLmNoYXJBdCh5eSk7Cn0KCmVlPU1hdGgucmFuZG9tKCkqLjQ0Owpmb3IobD1NYXRoLnJvdW5kKChid3dmLmxlbmd0aCouNSktZWUpO2w8TWF0aC5yb3VuZCgoYnd3Zi5sZW5ndGgqLjUpK2VlKTtsKyspewphYnd3Y29tW2xdPWJ3d2cuY2hhckF0KGwpOwp9CmZvcih5eT0wO3l5PGFid3djb20ubGVuZ3RoO3l5Kyspewpid3djb20rPSIiK2Fid3djb21beXldOwp9CgovL2xldCBtaWQgPSBNYXRoLmZsb29yKGJ3d2YubGVuZ3RoIC8gMik7CmNvbnNvbGUubG9nKHd3ZisiICIrd3dnKyIsIitwYXJzZUludChid3djb20sIDIpKTsKLy8gMi4gVGFrZSB0aGUgbGVmdCBwYXJ0IG9mIGJ3d2YgYW5kIHRoZSByaWdodCBwYXJ0IG9mIGJ3d2cKLy9sZXQgYnd3Y29tID0gYnd3Zi5zbGljZSgwLCAobWlkLTEpKSArIGJ3d2cuc2xpY2UobWlkKTsKCnJldHVybiBwYXJzZUludChid3djb20sIDIpOwogICAgLy8gRWxlbWVudGFyeSBDQTogOCBiaXRzIGZvciBydWxlIG51bWJlciAoMC0yNTUpCiAgICAvLyBHZW5lcmF0ZSB3aXRoIHBhdHRlcm5zIHRoYXQgYXZvaWQgdHJpdmlhbCBiZWhhdmlvcgogICAgLyoKICAgIGxldCBydWxlQml0cyA9ICIiOwogICAgbGV0IGF0dGVtcHRzID0gMDsKICAgIGNvbnN0IG1heEF0dGVtcHRzID0gMTAwOwogICAgCiAgICBkbyB7CiAgICAgICAgLy8gU3RhcnQgd2l0aCBhIHNlbWktcmFuZG9tIHBhdHRlcm4KICAgICAgICBydWxlQml0cyA9ICIiOwogICAgICAgIAogICAgICAgIC8vIFByZWZlciBydWxlcyB3aXRoIG1peGVkIHBhdHRlcm5zIChub3QgYWxsIDBzIG9yIDFzKQogICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCBNYXRoLnBvdyhjZWxsU3RhdGVzLCBuZWlnaGJvcmhvb2QpOyBpKyspIHsKICAgICAgICAgICAgLy8gQmlhc2VkIHJhbmRvbSB0byBhdm9pZCB0cml2aWFsIHJ1bGVzCiAgICAgICAgICAgIGxldCByYW5kID0gTWF0aC5yYW5kb20oKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJ1bGVzIDAgYW5kIDI1NSBhcmUgdHJpdmlhbCAoYWxsIGRlYWQvYWxsIGFsaXZlKQogICAgICAgICAgICAvLyBSdWxlcyBsaWtlIDkwLCAxMTAsIDMwLCA0NSBvZnRlbiBoYXZlIGNvbXBsZXggYmVoYXZpb3IKICAgICAgICAgICAgaWYocmFuZCA8IDAuMykgewogICAgICAgICAgICAgICAgcnVsZUJpdHMgKz0gIjAiOwogICAgICAgICAgICB9IGVsc2UgaWYocmFuZCA8IDAuNykgewogICAgICAgICAgICAgICAgcnVsZUJpdHMgKz0gIjEiOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gQWRkIHNvbWUgZGV0ZXJtaW5pc3RpYyBwYXR0ZXJucwogICAgICAgICAgICAgICAgcnVsZUJpdHMgKz0gKGkgJSAyKS50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGF0dGVtcHRzKys7CiAgICAgICAgCiAgICAgICAgLy8gQ2hlY2sgZm9yIHRyaXZpYWwgcnVsZXMKICAgICAgICBjb25zdCBydWxlTnVtID0gcGFyc2VJbnQocnVsZUJpdHMsIDIpOwogICAgICAgIGNvbnN0IGlzVHJpdmlhbCA9IHJ1bGVOdW0gPT09IDAgfHwgcnVsZU51bSA9PT0gMjU1OwogICAgICAgIGNvbnN0IGhhc1BhdHRlcm4gPSBydWxlQml0cy5pbmNsdWRlcygiMDEiKSAmJiBydWxlQml0cy5pbmNsdWRlcygiMTAiKTsKICAgICAgICAKICAgICAgICAvLyBLZWVwIGlmIG5vdCB0cml2aWFsIGFuZCBoYXMgdmFyaWF0aW9uCiAgICAgICAgaWYoIWlzVHJpdmlhbCAmJiBoYXNQYXR0ZXJuKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAKICAgIH0gd2hpbGUoYXR0ZW1wdHMgPCBtYXhBdHRlbXB0cyk7CiAgICAKICAgIGNvbnN0IHJ1bGVOdW1iZXIgPSBwYXJzZUludChydWxlQml0cywgMik7CiAgICBjb25zb2xlLmxvZyhgUnVsZSAke3J1bGVOdW1iZXJ9OiAke3J1bGVCaXRzfWApOwogICAgcmV0dXJuIHJ1bGVOdW1iZXI7CgkKCSovCn0KCgovLyBGdW5jdGlvbiB0byBnZW5lcmF0ZSBwb3RlbnRpYWxseSBjb21wbGV4IENBIHJ1bGVzCmZ1bmN0aW9uIGdlbmVyYXRlQ29tcGxleFJ1bGJiYmUoY2VsbFN0YXRlcyA9IDIsIG5laWdoYm9yaG9vZCA9IDMpIHsKICAgIC8vIEVsZW1lbnRhcnkgQ0E6IDggYml0cyBmb3IgcnVsZSBudW1iZXIgKDAtMjU1KQogICAgLy8gR2VuZXJhdGUgd2l0aCBwYXR0ZXJucyB0aGF0IGF2b2lkIHRyaXZpYWwgYmVoYXZpb3IKICAgIAogICAgbGV0IHJ1bGVCaXRzID0gIiI7CiAgICBsZXQgYXR0ZW1wdHMgPSAwOwogICAgY29uc3QgbWF4QXR0ZW1wdHMgPSAxMDA7CiAgICAKICAgIGRvIHsKICAgICAgICAvLyBTdGFydCB3aXRoIGEgc2VtaS1yYW5kb20gcGF0dGVybgogICAgICAgIHJ1bGVCaXRzID0gIiI7CiAgICAgICAgCiAgICAgICAgLy8gUHJlZmVyIHJ1bGVzIHdpdGggbWl4ZWQgcGF0dGVybnMgKG5vdCBhbGwgMHMgb3IgMXMpCiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IE1hdGgucG93KGNlbGxTdGF0ZXMsIG5laWdoYm9yaG9vZCk7IGkrKykgewogICAgICAgICAgICAvLyBCaWFzZWQgcmFuZG9tIHRvIGF2b2lkIHRyaXZpYWwgcnVsZXMKICAgICAgICAgICAgbGV0IHJhbmQgPSBNYXRoLnJhbmRvbSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gUnVsZXMgMCBhbmQgMjU1IGFyZSB0cml2aWFsIChhbGwgZGVhZC9hbGwgYWxpdmUpCiAgICAgICAgICAgIC8vIFJ1bGVzIGxpa2UgOTAsIDExMCwgMzAsIDQ1IG9mdGVuIGhhdmUgY29tcGxleCBiZWhhdmlvcgogICAgICAgICAgICBpZihyYW5kIDwgMC4zKSB7CiAgICAgICAgICAgICAgICBydWxlQml0cyArPSAiMCI7CiAgICAgICAgICAgIH0gZWxzZSBpZihyYW5kIDwgMC43KSB7CiAgICAgICAgICAgICAgICBydWxlQml0cyArPSAiMSI7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBBZGQgc29tZSBkZXRlcm1pbmlzdGljIHBhdHRlcm5zCiAgICAgICAgICAgICAgICBydWxlQml0cyArPSAoaSAlIDIpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXR0ZW1wdHMrKzsKICAgICAgICAKICAgICAgICAvLyBDaGVjayBmb3IgdHJpdmlhbCBydWxlcwogICAgICAgIGNvbnN0IHJ1bGVOdW0gPSBwYXJzZUludChydWxlQml0cywgMik7CiAgICAgICAgY29uc3QgaXNUcml2aWFsID0gcnVsZU51bSA9PT0gMCB8fCBydWxlTnVtID09PSAyNTU7CiAgICAgICAgY29uc3QgaGFzUGF0dGVybiA9IHJ1bGVCaXRzLmluY2x1ZGVzKCIwMSIpICYmIHJ1bGVCaXRzLmluY2x1ZGVzKCIxMCIpOwogICAgICAgIAogICAgICAgIC8vIEtlZXAgaWYgbm90IHRyaXZpYWwgYW5kIGhhcyB2YXJpYXRpb24KICAgICAgICBpZighaXNUcml2aWFsICYmIGhhc1BhdHRlcm4pIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIAogICAgfSB3aGlsZShhdHRlbXB0cyA8IG1heEF0dGVtcHRzKTsKICAgIAogICAgY29uc3QgcnVsZU51bWJlciA9IHBhcnNlSW50KHJ1bGVCaXRzLCAyKTsKICAgIGNvbnNvbGUubG9nKGBSdWxlICR7cnVsZU51bWJlcn06ICR7cnVsZUJpdHN9YCk7CiAgICByZXR1cm4gcnVsZU51bWJlcjsKfQoKbmV4dE5yKCk7Ci8vY29uc29sZS5sb2coKTsKCjwvc2NyaXB0PgoKCiAgICA8IS0tIFRoZSBtYWluIGNhbnZhcyB3aGVyZSBhbGwgYW5pbWF0aW9ucyB3aWxsIGJlIGRyYXduIC0tPgogCgogICAgPHNjcmlwdD4KCgppbnA9Jyc7Cgp2YXIgaW1nZ2w9aW5wLnNwbGl0KCI8YnI+Iik7CmlucD0iIjsKICAgICAgICAvLyAtLS0gTW9jayBnZXRSYW5kb20oKSBmdW5jdGlvbiBmb3Igc3RhbmRhbG9uZSB0ZXN0aW5nIC0tLQogICAgICAgIC8vIElmIHdpbmRvdy5wYXJlbnQuZ2V0UmFuZG9tIGFscmVhZHkgZXhpc3RzLCB0aGlzIG1vY2sgd2lsbCBiZSBza2lwcGVkLgogICAgIAogICAgICAgICAgIGZ1bmN0aW9uIGdldFJhbmRvbSgpewoJCSAgIAogICAgICAgICAgICAgICByZXR1cm4gZG9vZVN0UnVsZU5ybk5yKCk7IC8vImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsIitpbWdnbFtNYXRoLmZsb29yKGltZ2dsLmxlbmd0aCpNYXRoLnJhbmRvbSgpKV07CgogICAgICAgIH0KCgpmdW5jdGlvbiBzdGFydFNtb290aFpvb21Nb3ZlKCkgewoKCgogICAgICAgICAvLyAgZWxlbWVudHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY292ZXJzY3oyY2InKTsKCgkvL2xsPWVsZW1lbnRzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwoKICAgICAgICAgICAgLyoKCQkJaWYobWF4WD49KDEuMio1MDApKXsKCgkJCWRkZGRyPTEtMC4wMDU7CgkJCQkKCQkJfQoJCQkJCQlpZihtYXhYPD0oMS4xKjUwMCkpewoKCQkJZGRkZHI9MSswLjAwNTsKCQoJCQl9ICovCgkJCW1lZXN0ZT1tZWVzdGUrKDEuNSpyaWNodGluZyk7CgkJCWlmKG1lZXN0ZT4xMDApewoJCQltZWVzdGU9MTAwOwoJCQlyaWNodGluZz0tMTsKCQkJfQoJCQkKCQkJCgkJCQkJCWlmKG1lZXN0ZTwtMTAwKXsKCQkJbWVlc3RlPS0xMDA7CgkJCXJpY2h0aW5nPTE7CgkJCX0KCQkJCgkJCQoJCQlkZGRkcj0oMS81MCkqbWVlc3RlOwoJCQkvL3RlbHRvc2UrPTE7CgkJCQogICAgICAgICAgICAgbWF4WCA9ICg1MDArKGRkZGRyKjUwKSk7CiAgICAgICAgICAgICBtYXhZID0gKDUwMCsoZGRkZHIqNTApKTsKCQkJCgkKCQkJCgkJCQoKCQkJCgkJCWRvY3VtZW50LnRpdGxlPW1heFg7CgkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQW5pbWF0aW9uQ2FudmFzJykuc3R5bGUucG9zaXRpb249ImFic29sdXRlIjsKCQkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5BbmltYXRpb25DYW52YXMnKS5zdHlsZS53aWR0aD0iMTAwJSI7CgkJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW5BbmltYXRpb25DYW52YXMnKS5zdHlsZS5oZWlnaHQ9IjEwMCUiOyAKCQkJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2R5Y2EnKS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiOwoJCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdib2R5Y2EnKS5zdHlsZS53aWR0aD0gKDExMCsoKGRkZGRyKjUwKSkvMTApKyJ2dyI7CgkJCQkKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm9keWNhJykuc3R5bGUuaGVpZ2h0PSAgKDExMCsoKGRkZGRyKjUwKSkvMTApKyJ2aCI7CgkJCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm9keWNhJykuc3R5bGUubGVmdD0gICgoLTUtKChkZGRkcioyNSkpLzEwKSkrInZ3IjsKCQlkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYm9keWNhJykuc3R5bGUudG9wPSAgKCgtNS0oKGRkZGRyKjI1KSkvMTApKSsidmgiOwoKICAgICAgICAgICAgCiAgICAgICAgIC8vICBlbGVtZW50cy5zdHlsZS5sZWZ0PS1NYXRoLmFicygoLW1heFgpLzIpKyIlIjsKCQkgICAKICAgICAgICAgLy8gIGVsZW1lbnRzLnN0eWxlLnRvcD0tTWF0aC5hYnMoKG1heFkpLzIpKyIlIjsKCiAgICAgICAgCiAgICAgICAgc2V0VGltZW91dCgic3RhcnRTbW9vdGhab29tTW92ZSgpIiwgMTIwKTsKCiAgICAKCn0KCi8vIFN0YXJ0IHRoZSBlZmZlY3QKLy9zdGFydFNtb290aFpvb21Nb3ZlKCk7CiAgICA8L3NjcmlwdD4KCQoKCjxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wIj4KICAgIDx0aXRsZT5Db250aW51b3VzIDIyLUFuaW1hdGlvbiBUcmFuc2l0aW9uIFN1aXRlPC90aXRsZT4KICAgIDxzdHlsZT4KCiAgICAgICAgYm9keSwgaHRtbCB7CiAgICAgICAgICAgIG1hcmdpbjogMDsKICAgICAgICAgICAgcGFkZGluZzogMDsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGhlaWdodDogMTAwJTsKCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMTExOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOwogICAgICAgIH0KCiAgICAgICAgLyogLS0tIFZpZXdwb3J0IENvbnRhaW5lciAoRml4ZWQgU2l6ZSkgLS0tICovCiAgICAgICAgI3pvb20td3JhcHBlciB7CiAgICAgICAgICAgIC8qIFRoaXMgZGVmaW5lcyB0aGUgdmlzaWJsZSBhcmVhICg4MDB4ODAwKSAqLwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOwogICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuOyAvKiAqKkNSVUNJQUw6IEhpZGVzIHRoZSB6b29tZWQgY29udGVudCBlZGdlcyoqICovCiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDhweCByZ2JhKDAsIDAsIDAsIDAuNSk7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7CiAgICAKICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxMTE7CiAgICAgICAgICAgIG92ZXJmbG93OiBoaWRkZW47CiAgICAgICAgfQoKICAgICAgICAvKiAtLS0gWm9vbWFibGUgQ29udGFpbmVyIChUaGUgZWxlbWVudCB0aGF0IG1vdmVzIGFuZCBzY2FsZXMpIC0tLSAqLwogICAgICAgICNpZnJhbWUtY29udGFpbmVyIHsKICAgICAgICAgICAgd2lkdGg6IDEwMy4wJTsKICAgICAgICAgICAgaGVpZ2h0OiAxMDMuMCU7CiAgICAgICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvKiAqKkNSVUNJQUw6IFNtb290aCBUcmFuc2l0aW9uKiogKi8KICAgICAgICAgICAgLyogQXBwbHkgYSB0cmFuc2l0aW9uIHRvIHRoZSAndHJhbnNmb3JtJyBwcm9wZXJ0eSBvdmVyIDIwIHNlY29uZHMgZm9yIHNsb3cgbW92ZW1lbnQgKi8KICAgICAgICAgICAgdHJhbnNpdGlvbjogdHJhbnNmb3JtIDIwcyBlYXNlLWluLW91dDsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvKiBJbml0aWFsIHRyYW5zZm9ybWF0aW9uOiBab29tZWQgaW4gKDEuMSkgYW5kIG1vdmVkIHRvIGFuICdlbmQnIHBvc2l0aW9uICovCiAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMSkgdHJhbnNsYXRlKC0xLjI1JSwgLTEuMjUlKTsgCiAgICAgICAgfQoKICAgICAgICAvKiAtLS0gSWZyYW1lIFN0eWxlcyAoU2FtZSBhcyBiZWZvcmUpIC0tLSAqLwogICAgCiAgICAgICAgI2FuaW1hdGlvbkNhbnZhcyB7CiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICAgICAgICAgICAgdG9wOiAwOwogICAgICAgICAgICBsZWZ0OiAwOwogICAgICAgICAgICB3aWR0aDogMTAyLjUlOwogICAgICAgICAgICBoZWlnaHQ6IDEwMi41JTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICAvKiBUcmFuc2l0aW9uIGZvciB0aGUgY3Jvc3NmYWRlICovCiAgICAgICAgICAgIHRyYW5zaXRpb246IG9wYWNpdHkgMS4wcyBlYXNlLWluLW91dDsKICAgICAgICAgICAgd2lsbC1jaGFuZ2U6IG9wYWNpdHk7CiAgICAKICAgICAgICB9CgoKCiAgICAgICAgCiAgICAgICAgI2FuaW1hdGlvblRpdGxlIHsKd2lkdGg6MTsKaGVpZ2h0OjEKZGlzcGxheTpub25lOwogICAgICAgIH0KICAgIDwvc3R5bGU+CgoKPHRleHRhcmVhIHN0eWxlPSJkaXNwbGF5Om5vbmUiIGlkPSJpZGVlIj48L3RleHRhcmVhPgo8ZGl2IGlkPSJ6b29tLXdyYXBwZXIiPgogICAgPGRpdiBpZD0iaWZyYW1lLWNvbnRhaW5lciI+CiAgICA8ZGl2IGlkPSJhbmltYXRpb25UaXRsZSIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+QW5pbWF0aWUgNSBvZiAxNTM6IFVucmVhbCBEeW5hbWljcyBCbG9jayBUcmFuc2l0aW9uIChBTklNQVRJT05fTE9HSUNbMF0pPC9kaXY+CiAgICA8Y2FudmFzIGlkPSJhbmltYXRpb25DYW52YXMiIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj48L2NhbnZhcz4KICAgIDwvZGl2Pgo8L2Rpdj4KPGRpdiBjbGFzcz0iY29udGFpbmVyIGJnLXdoaXRlIHNoYWRvdy14bCByb3VuZGVkLXhsIiBzdHlsZT0iZGlzcGxheTpub25lIj4KICAgICAgICA8aDEgY2xhc3M9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWdyYXktODAwIG1iLTQgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICBSZXVzYWJsZSBEYXRhIFNtdWdnbGluZyAoUHJvbWlzZS9KU09OLVAgU3R5bGUpCiAgICAgICAgPC9oMT4KICAgICAgICA8cCBjbGFzcz0idGV4dC1ncmF5LTYwMCBtYi02IHRleHQtY2VudGVyIj4KICAgICAgICAgICAgVGhlIDxjb2RlPmdldFJhbmRvbSgpPC9jb2RlPiBmdW5jdGlvbiBmZXRjaGVzIGltYWdlIGRhdGEgYXN5bmNocm9ub3VzbHkgZnJvbSB0aGUgKipsaXZlIGNyb3NzLW9yaWdpbiBzb3VyY2UqKiBhdCA8Y29kZT5odHRwczovL29nZW5hLm5ldC90b3Avc291cmNlLmpzPC9jb2RlPiBhbmQgcmVzb2x2ZXMgdG8gdGhlIEJhc2U2NCBzb3VyY2Ugc3RyaW5nLgogICAgICAgIDwvcD4KCiAgICAgICAgPGRpdiBjbGFzcz0ic3BhY2UteS00Ij4KICAgICAgICAgICAgPGRpdiBpZD0iaW1hZ2UtYXJlYSIgY2xhc3M9InAtNCBiZy1ibHVlLTUwIGJvcmRlciBib3JkZXItYmx1ZS0yMDAgcm91bmRlZC1sZyBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCI+CiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtYmx1ZS01MDAiPlJlc3VsdGluZyBJbWFnZTo8L3NwYW4+CiAgICAgICAgICAgICAgICA8c3BhbiBpZD0icGxhY2Vob2xkZXIiPjwvc3Bhbj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8ZGl2IGlkPSJzdGF0dXMtY2FyZCIgY2xhc3M9ImJnLWluZGlnby01MCBwLTQgcm91bmRlZC1sZyBzaGFkb3ctaW5uZXIiPgogICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtaW5kaWdvLTgwMCBmb250LW1lZGl1bSIgaWQ9InN0YXR1cyI+SW5pdGlhbGl6aW5nIHJldHJpZXZhbC4uLjwvcD4KICAgICAgICAgICAgICAgIDxkaXYgaWQ9InBpeGVsLW91dHB1dCIgY2xhc3M9Im10LTIgdGV4dC1zbSB0ZXh0LWluZGlnby01MDAgZm9udC1tb25vIGJnLWluZGlnby0xMDAgcC0zIHJvdW5kZWQiPgogICAgICAgICAgICAgICAgICAgIEFuYWx5c2lzIGRhdGEgd2lsbCBhcHBlYXIgaGVyZSBhZnRlciBzY3JpcHQgZXhlY3V0aW9uLiAgCiAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CgogICAgICAgICAgICA8aW1nIGlkPSJ4IiBzdHlsZT0iZGlzcGxheTogbm9uZTsiIGFsdD0iRHluYW1pY2FsbHkgbG9hZGVkIGltYWdlIHRhcmdldCI+CgoKPHNjcmlwdD4KCgoKCgoKCnZhciBzdGU9IiI7CgoKcmJlbnI9Jyc7CnZhciBpbWdsbD1zdGUuc3BsaXQoIjxicj4iKTsKdmFyIGltYWdlcz1uZXcgQXJyYXkoKTsKZm9yKGk9MDtpPGltZ2xsLmxlbmd0aDtpKyspewppbWFnZXNbaV09ImRhdGE6aW1hZ2Uvd2VicDtiYXNlNjQsIitpbWdsbFtpXTsKfQoKCnZhciBpbWdsbGw9cmJlbnIuc3BsaXQoIjxicj4iKTsKdmFyIGltYWdlc3I9bmV3IEFycmF5KCk7CmZvcihpPTA7aTxpbWdsbGwubGVuZ3RoO2krKyl7CmltYWdlc3JbaV09ImRhdGE6aW1hZ2UvanBlZztiYXNlNjQsIitpbWdsbGxbaV07Cn0KCQoKCnZhciBtb2R1bHVzMTAxID0gTWF0aC5wb3coMiwgMzIpOyAvLyBTdGlsbCBuZWVkZWQgZm9yIHRoZSBmaW5hbCBkaXZpc2lvbgoKLy8gUmV0YWluIG9ubHkgdGhlIG5lY2Vzc2FyeSBMQ0cgY29uc3RhbnRzCnZhciBhMTF4eDMzID0gMTY2NDUyNTsKdmFyIGMxMTMzMyA9IDEwMTM5MDQyMjM7CnZhciBzc2VlZDExNDIgPSBEYXRlLm5vdygpOyAvLyAqKkNydWNpYWw6KiogVXNlIGEgZHluYW1pYyBzZWVkIGxpa2UgdGhlIGN1cnJlbnQgdGltZQoKZnVuY3Rpb24gd2llbHNpZWRlcigpIHsKICAgIC8vIDEuIFBlcmZvcm0gdGhlIG11bHRpcGxpY2F0aW9uIGFuZCBhZGRpdGlvbi4gCiAgICAvLyAgICBVc2UgcGFyZW50aGVzZXMgdG8gZW5zdXJlIGNvcnJlY3Qgb3JkZXIgb2Ygb3BlcmF0aW9ucy4KICAgIC8vIDIuIFRoZSByZXN1bHQgb2YgdGhlIExDRyBmb3JtdWxhIGlzIGEgNjQtYml0IGZsb2F0LgogICAgLy8gMy4gVGhlIGA+Pj4gMGAgb3BlcmF0b3IgcGVyZm9ybXMgYW4gdW5zaWduZWQgcmlnaHQgc2hpZnQgYnkgMCwgCiAgICAvLyAgICB3aGljaCBlZmZlY3RpdmVseSBmb3JjZXMgdGhlIG51bWJlciB0byBiZSBhbiAqKnVuc2lnbmVkIDMyLWJpdCBpbnRlZ2VyIChtb2R1bG8gMl4zMikqKi4KICAgIHNzZWVkMTE0MiA9IChhMTF4eDMzICogc3NlZWQxMTQyICsgYzExMzMzKSA+Pj4gMDsKICAgIAogICAgLy8gRGl2aWRlIGJ5IHRoZSBtb2R1bHVzIHRvIGdldCBhIGZsb2F0IGJldHdlZW4gMCBhbmQgMQogICAgcmV0dXJuIChzc2VlZDExNDIgLyBtb2R1bHVzMTAxKTsKfQoKZnVuY3Rpb24gZ2V0UmFuZG9teHgoKXsKLy9pZihBTklNQVRJT05fSU5ERVghPTc3KXsKCXJldHVybiBpbWFnZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaW1hZ2VzLmxlbmd0aCldOwovL30KLy9lbHNlewovL3JldHVybiBpbWFnZXNyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGltYWdlc3IubGVuZ3RoKV07Ci8vfQoKfQoKCgoKCgoKCgogLy8gR2xvYmFsIHJlc29sdmVyIGNvbnRhaW5lciwgdXNlZCB0byByZXNvbHZlIHRoZSBQcm9taXNlIGNyZWF0ZWQgYnkgZ2V0UmFuZG9tKCkKICAgICAgICBsZXQgZ2xvYmFsSW1hZ2VSZXNvbHZlciA9IG51bGw7CgogICAgICAgIC8vIC0tLSAxLiBHTE9CQUwgQ0FMTEJBQ0sgRlVOQ1RJT04gKFRoZSAiUCIgaW4gSlNPTi1QKSAtLS0KICAgICAgICAvKioKICAgICAgICAgKiBUaGlzIGZ1bmN0aW9uIE1VU1QgYmUgZ2xvYmFsbHkgYXZhaWxhYmxlICh3aW5kb3cgc2NvcGUpLiBUaGUgZXh0ZXJuYWwgc2NyaXB0CiAgICAgICAgICogY2FsbHMgdGhpcyBmdW5jdGlvbiBpbW1lZGlhdGVseSB1cG9uIGV4ZWN1dGlvbiwgcGFzc2luZyB0aGUgQmFzZTY0IGRhdGEsIAogICAgICAgICAqIHRodXMgcmVzb2x2aW5nIG91ciBwcm9taXNlLgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjREYXRhIC0gVGhlIEJhc2U2NCBpbWFnZSBkYXRhIFVSSS4KICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBpbWFnZVNvdXJjZUNhbGxiYWNrKGJhc2U2NERhdGEpIHsKICAgICAgICAgICAgaWYgKGdsb2JhbEltYWdlUmVzb2x2ZXIpIHsKICAgICAgICAgICAgICAgIC8vIFJlc29sdmUgdGhlIHBlbmRpbmcgcHJvbWlzZSB3aXRoIHRoZSBCYXNlNjQgZGF0YSBzdHJpbmcKICAgICAgICAgICAgICAgIGdsb2JhbEltYWdlUmVzb2x2ZXIoYmFzZTY0RGF0YSk7CiAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCB0aGUgZ2xvYmFsIHJlZmVyZW5jZQogICAgICAgICAgICAgICAgZ2xvYmFsSW1hZ2VSZXNvbHZlciA9IG51bGw7IAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIC0tLSAyLiBBU1lOQ0hST05PVVMgR0VUVEVSIEZVTkNUSU9OIC0tLQogICAgICAgIC8qKgogICAgICAgICAqIEVuY2Fwc3VsYXRlcyB0aGUgbG9naWMgdG8gZHluYW1pY2FsbHkgbG9hZCB0aGUgc2NyaXB0IHBheWxvYWQgYW5kIAogICAgICAgICAqIHJldHVybnMgYSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgQmFzZTY0IGltYWdlIGRhdGEgc3RyaW5nLgogICAgICAgICAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IEEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHRvIHRoZSBCYXNlNjQgZGF0YSBVUkkgc3RyaW5nLgogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGdldFJhbmRvbXooKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgICAgICAgICAgICAvLyAtLS0gRVhURVJOQUwgVVJMIEZPUiBMSVZFIEZFVENIIC0tLQogICAgICAgICAgICAgICAgY29uc3QgRVhURVJOQUxfVVJMID0gJ2h0dHBzOi8vb2dlbmEubmV0L3N0ZXJyZW4vc291cmNlanMtJytNYXRoLmZsb29yKDgyKk1hdGgucmFuZG9tKCkpKycuanMnOyAKICAgICAgICAgICAgICAgIC8vIC0tLSBFTkQgRVhURVJOQUwgVVJMIC0tLQoKICAgICAgICAgICAgICAgIC8vIFN0b3JlIHRoZSBwcm9taXNlJ3MgcmVzb2x2ZSBmdW5jdGlvbiBnbG9iYWxseSBzbyB0aGUgY2FsbGJhY2sgY2FuIGFjY2VzcyBpdAogICAgICAgICAgICAgICAgZ2xvYmFsSW1hZ2VSZXNvbHZlciA9IHJlc29sdmU7CgogICAgICAgICAgICAgICAgY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7CiAgICAgICAgICAgICAgICBzY3JpcHQuaWQgPSAncHJvY2Vzc29yJzsKICAgICAgICAgICAgICAgIC8vIFVzZSB0aGUgbGl2ZSBleHRlcm5hbCBVUkwgZm9yIGZldGNoaW5nCiAgICAgICAgICAgICAgICBzY3JpcHQuc3JjID0gRVhURVJOQUxfVVJMOyAKCiAgICAgICAgICAgICAgICAvLyBFcnJvciBoYW5kbGluZyBmb3IgbmV0d29yay80MDQgaXNzdWVzCiAgICAgICAgICAgICAgICBzY3JpcHQub25lcnJvciA9ICgpID0+IHsKICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzJykudGV4dENvbnRlbnQgPSBgRVJST1I6IEZhaWxlZCB0byBsb2FkIGV4dGVybmFsIHNjcmlwdCBmcm9tICR7RVhURVJOQUxfVVJMfS4gQ2hlY2sgbmV0d29yayBvciBzZXJ2ZXIgc3RhdHVzLmA7CiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigiTmV0d29yayBmYWlsZWQgdG8gbG9hZCBzY3JpcHQuIikpOwogICAgICAgICAgICAgICAgICAgIGdsb2JhbEltYWdlUmVzb2x2ZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSW5qZWN0IHRoZSBzY3JpcHQuIFdoZW4gbG9hZGVkLCBpdCBleGVjdXRlcyBhbmQgY2FsbHMgaW1hZ2VTb3VyY2VDYWxsYmFjay4KICAgICAgICAgICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdHVzJykudGV4dENvbnRlbnQgPSBgU2NyaXB0IHRhZyBpbmplY3RlZCB3aXRoIGxpdmUgc3JjOiAke0VYVEVSTkFMX1VSTH0uIFdhaXRpbmcgZm9yIGV4ZWN1dGlvbi4uLmA7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAtLS0gMy4gUElYRUwgUFJPQ0VTU0lORyBMT0dJQyAtLS0KICAgICAgICAvKioKICAgICAgICAgKiBDb3JlIGxvZ2ljIHRvIGFuYWx5emUgdGhlIHJlY2VpdmVkIEJhc2U2NCBkYXRhIHVzaW5nIHRoZSBDYW52YXMgQVBJLgogICAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBiYXNlNjREYXRhIC0gVGhlIEJhc2U2NCBpbWFnZSBkYXRhIFVSSSBzdHJpbmcgcmV0dXJuZWQgYnkgZ2V0UmFuZG9tKCkuCiAgICAgICAgICovCiAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0ltYWdlUGl4ZWxzKGJhc2U2NERhdGEpIHsKICAgICAgICAgICAgY29uc3Qgc3RhdHVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0dXMnKTsKICAgICAgICAgICAgY29uc3QgcGxhY2Vob2xkZXJFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYWNlaG9sZGVyJyk7CiAgICAgICAgICAgIGNvbnN0IHBpeGVsT3V0cHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwaXhlbC1vdXRwdXQnKTsKICAgICAgICAgICAgY29uc3QgdGFyZ2V0SW1hZ2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3gnKTsKCiAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQudGV4dENvbnRlbnQgPSAiRGF0YSByZWNlaXZlZC4gU3RhcnRpbmcgaW1hZ2UgbG9hZGluZy4uLiI7CgogICAgICAgICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gIkltYWdlIGxvYWRlZCBzdWNjZXNzZnVsbHkuIFN0YXJ0aW5nIGNhbnZhcyBwcm9jZXNzaW5nLi4uIjsKCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke2Jhc2U2NERhdGF9KWA7CiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFNpemUgPSAnY292ZXInOwogICAgICAgICAgICAgICAgdGFyZ2V0SW1hZ2VFbGVtZW50LnNyYyA9IGJhc2U2NERhdGE7CgogICAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgICAgICBjYW52YXMud2lkdGggPSBpbWcud2lkdGg7CiAgICAgICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodDsKICAgICAgICAgICAgICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApOwoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBpbWFnZURhdGEuZGF0YTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IGRhdGFbMF07IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBkYXRhWzFdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBkYXRhWzJdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBkYXRhWzNdOwoKICAgICAgICAgICAgICAgICAgICBzdGF0dXNFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3RleHQtaW5kaWdvLTgwMCcpOwogICAgICAgICAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LmFkZCgndGV4dC1ncmVlbi04MDAnKTsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gIlNVQ0NFU1M6IFBpeGVsIEFuYWx5c2lzIENvbXBsZXRlISI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcGl4ZWxPdXRwdXRFbGVtZW50LmlubmVySFRNTCA9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPHN0cm9uZz5Tb3VyY2U6PC9zdHJvbmc+ICR7aW1nLndpZHRofXgke2ltZy5oZWlnaHR9IEJhc2U2NCBQYXlsb2FkPGJyPgogICAgICAgICAgICAgICAgICAgICAgICA8c3Ryb25nPkZpcnN0IFBpeGVsICgwLDApIENvbG9yOjwvc3Ryb25nPiAKICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LXJlZC02MDAiPlI6ICR7cn08L3NwYW4+LCAKICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWdyZWVuLTYwMCI+RzogJHtnfTwvc3Bhbj4sIAogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0iZm9udC1ib2xkIHRleHQtYmx1ZS02MDAiPkI6ICR7Yn08L3NwYW4+LCAKICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9ImZvbnQtYm9sZCB0ZXh0LWdyYXktNjAwIj5BOiAke2F9PC9zcGFuPgogICAgICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgICAgICAgIHN0YXR1c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgndGV4dC1pbmRpZ28tODAwJyk7CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzRWxlbWVudC5jbGFzc0xpc3QuYWRkKCd0ZXh0LXJlZC02MDAnKTsKICAgICAgICAgICAgICAgICAgICBzdGF0dXNFbGVtZW50LnRleHRDb250ZW50ID0gIkVSUk9SOiBGYWlsZWQgdG8gYWNjZXNzIHBpeGVsIGRhdGEuIjsKICAgICAgICAgICAgICAgICAgICBwaXhlbE91dHB1dEVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvci5tZXNzYWdlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICAKICAgICAgICAgICAgaW1nLnNyYyA9IGJhc2U2NERhdGE7CiAgICAgICAgfQoKCgoKCi8qCiAgICAgICAgLy8gLS0tIDQuIFNUQVJUIFRIRSBQUk9DRVNTIC0tLQogICAgICAgIGZ1bmN0aW9uIGdldFJhbmRvbSgpewogICAgICAgICAgICAvLyBnZXRSYW5kb20oKSByZXR1cm5zIHRoZSBwcm9taXNlLCBhbmQgdGhlIC50aGVuKCkgd2FpdHMgZm9yIHRoZSBCYXNlNjQgc3RyaW5nCiAgICAgICAgICAgIGdldFJhbmRvbXooKQogICAgICAgICAgICAgICAgLnRoZW4oYmFzZTY0RGF0YSA9PiB7CiAgICAgICAgICAgICAgICAgICAgLy8gYmFzZTY0RGF0YSBpcyB0aGUgc3RyaW5nIHJldHVybmVkIGJ5IHRoZSByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0ltYWdlUGl4ZWxzKGJhc2U2NERhdGEpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiSW5pdGlhbGl6YXRpb24gZXJyb3I6IiwgZXJyb3IpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKKi8KCiAgLy8gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgaW5pdCk7CgoKCgoKCiAgICAvLyAtLS0gR2xvYmFsIENvbmZpZ3VyYXRpb24gYW5kIFN0YXRlIChmcm9tIHVzZXIncyBvcmlnaW5hbCBjb2RlKSAtLS0KICAgIGNvbnN0IFdJRFRIID0gNTAwOwogICAgY29uc3QgSEVJR0hUID0gNTAwOwogICAgY29uc3QgVE9UQUxfQU5JTUFUSU9OUyA9IDE0MjsgLy8gLy8gU2V0IHRvIHRoZSBoaWdoZXN0IGluZGV4ICsgMSAoMTIgKyAxKQogICAgCiAgICBsZXQgY2FudmFzLCBjdHg7CiAgICBsZXQgY3VycmVudEltYWdlID0gbmV3IEltYWdlKCk7CiAgICBsZXQgbmV4dEltYWdlID0gbmV3IEltYWdlKCk7CiAgICBsZXQgY3VycmVudFVSTCA9ICIiOwogICAgbGV0IG5leHRVUkwgPSAiIjsKCiAgICBsZXQgQU5JTUFUSU9OX0lOREVYID0gMDsgLy8gU3RhcnQgd2l0aCB0aGUgZmlyc3QgdXBsb2FkZWQgYW5pbWF0aW9uIGxvZ2ljIChpbmRleCA0KQogICAgCiAgICAvLyAtLS0gQ29udHJvbGxlciBGdW5jdGlvbnMgKGZyb20gdXNlcidzIG9yaWdpbmFsIGNvZGUpIC0tLQoKCgoKCmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3RSYW5kb20oY29udGV4dCA9IDApIHsKICAgIGNvbnN0IHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25UaXRsZScpOwogICAgY29uc3QgY3VycmVudEFuaW0gPSBBTklNQVRJT05fTE9HSUNbQU5JTUFUSU9OX0lOREVYICUgVE9UQUxfQU5JTUFUSU9OU10gfHwgeyB0aXRsZTogIkxvYWRpbmcgQW5pbWF0aW9uIiB9OwogICAgdGl0bGVFbGVtZW50LnRleHRDb250ZW50ID0gYEFuaW1hdGllICR7QU5JTUFUSU9OX0lOREVYICUgVE9UQUxfQU5JTUFUSU9OU306ICR7Y3VycmVudEFuaW0udGl0bGV9YDsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IGltYWdlU3JjID0gYXdhaXQgZ2V0UmFuZG9tKCk7IC8vIFdhaXQgZm9yIHRoZSBCYXNlNjQgc3RyaW5nCgogICAgICAgIGlmIChjb250ZXh0ID09PSAwKSB7CiAgICAgICAgICAgIGN1cnJlbnRVUkwgPSBpbWFnZVNyYzsKICAgICAgICAgICAgcmVxdWVzdFJhbmRvbSgxKTsgLy8gTG9hZCBJbWFnZSBCIG5leHQKICAgICAgICB9IGVsc2UgaWYgKGNvbnRleHQgPT09IDEpIHsKICAgICAgICAgICAgbmV4dFVSTCA9IGltYWdlU3JjOwogICAgICAgICAgICBsb2FkSW1hZ2VzKGN1cnJlbnRVUkwsIG5leHRVUkwpOwogICAgICAgIH0gZWxzZSBpZiAoY29udGV4dCA+PSAyKSB7CiAgICAgICAgICAgIG5leHRVUkwgPSBpbWFnZVNyYzsKICAgICAgICAgICAgbG9hZE5leHRJbWFnZShuZXh0VVJMKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoIkZhaWxlZCB0byBmZXRjaCBpbWFnZToiLCBlcnJvcik7CiAgICB9Cn0KCgoKCgogICAgZnVuY3Rpb24gbG9hZEltYWdlcyh1cmxBLCB1cmxCKSB7CiAgICAgICAgbGV0IGxvYWRlZENvdW50ID0gMDsKICAgICAgICBjb25zdCB0b3RhbFRvTG9hZCA9IDI7CgogICAgICAgIGNvbnN0IGNoZWNrUmVhZHkgPSAoKSA9PiB7CiAgICAgICAgICAgIGxvYWRlZENvdW50Kys7CiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA9PT0gdG90YWxUb0xvYWQpIHsKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SW1hZ2UuY29tcGxldGUgJiYgbmV4dEltYWdlLmNvbXBsZXRlICYmIGN1cnJlbnRJbWFnZS5uYXR1cmFsV2lkdGggPiAwICYmIG5leHRJbWFnZS5uYXR1cmFsV2lkdGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYEluaXRpYWwgTG9hZCBDb21wbGV0ZS4gU3RhcnRpbmcgQW5pbWF0aW9uICR7QU5JTUFUSU9OX0lOREVYfS5gKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IEFOSU1BVElPTl9JTkRFWCAlIFRPVEFMX0FOSU1BVElPTlM7CiAgICAgICAgICAgICAgICAgICAgaWYgKEFOSU1BVElPTl9MT0dJQ1tpbmRleF0pIHsKICAgICAgICAgICAgICAgICAgICAgICBBTklNQVRJT05fTE9HSUNbaW5kZXhdLmluaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICBBTklNQVRJT05fTE9HSUNbaW5kZXhdLmFuaW1hdGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBBTklNQVRJT05fTE9HSUMgYXQgaW5kZXggJHtpbmRleH0gaXMgbWlzc2luZy5gKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgb25lIG9yIGJvdGggaW5pdGlhbCBpbWFnZXMuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBjdXJyZW50SW1hZ2Uub25sb2FkID0gY2hlY2tSZWFkeTsKICAgICAgICBuZXh0SW1hZ2Uub25sb2FkID0gY2hlY2tSZWFkeTsKCiAgICAgICAgY3VycmVudEltYWdlLm9uZXJyb3IgPSAoKSA9PiB7IGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgSW1hZ2UgQToiLCB1cmxBKTsgfTsKICAgICAgICBuZXh0SW1hZ2Uub25lcnJvciA9ICgpID0+IHsgY29uc29sZS5lcnJvcigiRXJyb3IgbG9hZGluZyBJbWFnZSBCOiIsIHVybEIpOyB9OwoKICAgICAgICBjdXJyZW50SW1hZ2Uuc3JjID0gdXJsQTsKICAgICAgICBuZXh0SW1hZ2Uuc3JjID0gdXJsQjsKICAgIH0KCiAgICBmdW5jdGlvbiBsb2FkTmV4dEltYWdlKHVybEMpIHsKICAgICAgICBjb25zdCBuZXdJbWFnZUMgPSBuZXcgSW1hZ2UoKTsJCiAgICAgICAgbmV3SW1hZ2VDLmNyb3NzT3JpZ2luID0gImFub255bW91cyI7CgogICAgICAgIG5ld0ltYWdlQy5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgIC8vIFJlcGxhY2UgdGhlIEdMT0JBTCBuZXh0SW1hZ2Ugb2JqZWN0IHdpdGggdGhlIG5ldyBpbWFnZSBDLgogICAgICAgICAgICBuZXh0SW1hZ2UgPSBuZXdJbWFnZUM7CiAgLy9jb25zb2xlLmVycm9yKGBBTklNQVRJT05fTE9HSUMgYXQgaW5kZXggJHtpbmRleH0gaXMgbWlzc2luZy5gKTsKICAgICAgICAgICAgY29uc29sZS5sb2coQU5JTUFUSU9OX0lOREVYKyIgSW1hZ2UgQyBsb2FkZWQgc3VjY2Vzc2Z1bGx5LiBSZWFkeSBmb3IgbmV4dCB0cmFuc2l0aW9uLiIpOwoJCWRvY3VtZW50LnRpdGxlPUFOSU1BVElPTl9JTkRFWCsiIjsKICAgICAgICB9OwoKICAgICAgICBuZXdJbWFnZUMub25lcnJvciA9ICgpID0+IHsJCiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGxvYWRpbmcgSW1hZ2UgQzoiLCB1cmxDKTsKICAgICAgICAgICAgbmV3SW1hZ2VDLnNyYyA9ICdodHRwczovL3ZpYS5wbGFjZWhvbGRlci5jb20vNTAweDUwMC81NTU1NTUvRkZGRkZGP3RleHQ9RXJyb3InOwogICAgICAgICAgICBuZXh0SW1hZ2UgPSBuZXdJbWFnZUM7IC8vIFN0aWxsIGFzc2lnbiB0aGUgZmFsbGJhY2sKICAgICAgICB9OwogICAgICAgIAogICAgICAgIG5ld0ltYWdlQy5zcmMgPSB1cmxDOyAvLyBTdGFydCBsb2FkaW5nIEltYWdlIEMKICAgIH0KCnZhciBwcm9ncmVzczsKICAgIGZ1bmN0aW9uIHN0YXJ0TmV4dFRyYW5zaXRpb24oKSB7CiAgICAgICAgLy8gMS4gU3dhcCBCIChuZXh0SW1hZ2UpIHRvIEEgKGN1cnJlbnRJbWFnZSkKICAgICAgICBjdXJyZW50SW1hZ2UgPSBuZXh0SW1hZ2U7CiAgICAgICAgCiAgICAgICAgLy8gMi4gUmVxdWVzdCB0aGUgbmV3IG5leHQgaW1hZ2UgKEMpIHJpZ2h0IGF3YXkKICAgICAgICByZXF1ZXN0UmFuZG9tKDIpOyAKICAgICAgICAKICAgICAgICAvLyAzLiBBZHZhbmNlIHRoZSBhbmltYXRpb24gaW5kZXggYW5kIGxvb3AgYmFjayBpZiBuZWVkZWQKICAgICAgICBBTklNQVRJT05fSU5ERVgrKzsKICAgICAgICBjb25zdCBuZXh0SW5kZXggPSBBTklNQVRJT05fSU5ERVggJSBUT1RBTF9BTklNQVRJT05TOwogICAgICAgIAogICAgICAgIC8vIDQuIFVwZGF0ZSB0aGUgdGl0bGUKICAgICAgICBjb25zdCB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYW5pbWF0aW9uVGl0bGUnKTsKICAgICAgICBjb25zdCBuZXh0QW5pbSA9IEFOSU1BVElPTl9MT0dJQ1tuZXh0SW5kZXhdOwogICAgICAgIHRpdGxlRWxlbWVudC50ZXh0Q29udGVudCA9IGBBbmltYXRpZSAke25leHRJbmRleH0gb2YgJHtUT1RBTF9BTklNQVRJT05TIC0gMX06ICR7bmV4dEFuaW0udGl0bGV9YDsKCiAgICAgICAgLy8gNS4gU3RhcnQgdGhlIG5leHQgYW5pbWF0aW9uIChCIC0+IEMpIGFmdGVyIGEgYnJpZWYgcGF1c2UKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWYgKEFOSU1BVElPTl9MT0dJQ1tuZXh0SW5kZXhdKSB7CiAgICAgICAgICAgICAgICBBTklNQVRJT05fTE9HSUNbbmV4dEluZGV4XS5pbml0KCk7CiAgICAgICAgICAgICAgICBBTklNQVRJT05fTE9HSUNbbmV4dEluZGV4XS5hbmltYXRlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBJZiBhbiBhbmltYXRpb24gaW5kZXggaXMgbWlzc2luZywgc2tpcCBpdCBhbmQgY2FsbCB0aGUgbmV4dCB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGBBbmltYXRpb24gbG9naWMgZm9yIGluZGV4ICR7bmV4dEluZGV4fSBub3QgZGVmaW5lZC4gU2tpcHBpbmcuYCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCAxMDAwKTsgLy8gU2hvcnRlciAxLXNlY29uZCBwYXVzZSBmb3IgZmFzdGVyIGNvbnRpbnVvdXMgbG9vcAogICAgfQoKICAgIC8vIC0tLSBBbmltYXRpb24gTG9naWMgKENvbnNvbGlkYXRlZCkgLS0tCgogICAgbGV0IEFOSU1BVElPTl9MT0dJQyA9IFtdOwoKICAgIC8vIEhlbHBlciB0byBnZXQgcmF3IHBpeGVsIGRhdGEgZnJvbSBhbiBpbWFnZSBvYmplY3QgKHVzZWQgaW4gbXVsdGlwbGUgYW5pbWF0aW9ucykKICAgIGZ1bmN0aW9uIGdldFBpeGVsRGF0YShpbWcpIHsKICAgICAgICBjb25zdCB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgY29uc3QgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gV0lEVEg7CiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBIRUlHSFQ7CiAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICByZXR1cm4gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICB9CiAgICAKICAgIC8vIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgYXZlcmFnZSBjb2xvciBvZiBhIGJsb2NrICh1c2VkIGluIGFuaW1hdGlvbnMgOCBhbmQgMTApCiAgICBmdW5jdGlvbiBnZXRBdmdDb2xvcihpbWFnZURhdGEsIHN0YXJ0WCwgc3RhcnRZLCB3LCBoKSB7CiAgICAgICAgbGV0IHIgPSAwLCBnID0gMCwgYiA9IDAsIGNvdW50ID0gMDsKICAgICAgICBjb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgY29uc3Qgd2lkdGggPSBpbWFnZURhdGEud2lkdGg7CgogICAgICAgIGZvciAobGV0IHkgPSBzdGFydFk7IHkgPCBzdGFydFkgKyBoOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IHN0YXJ0WDsgeCA8IHN0YXJ0WCArIHc7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogd2lkdGggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICByICs9IGRhdGFbaV07CiAgICAgICAgICAgICAgICBnICs9IGRhdGFbaSArIDFdOwogICAgICAgICAgICAgICAgYiArPSBkYXRhW2kgKyAyXTsKICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvdW50ID4gMCA/IHsgcjogciAvIGNvdW50LCBnOiBnIC8gY291bnQsIGI6IGIgLyBjb3VudCB9IDogeyByOiAwLCBnOiAwLCBiOiAwIH07CiAgICB9CiAgICAKCgoKCmZ1bmN0aW9uIGVhc2VPdXRRdWFkKHQpIHsKICAgIC8vIFRoZSBmb3JtdWxhIGlzIDEgLSAoMSAtIHQpXjIKICAgIHJldHVybiB0ICogKDIgLSB0KTsKICAgIC8vIEFsdGVybmF0aXZlbHk6IHJldHVybiAxIC0gKDEgLSB0KSAqICgxIC0gdCk7Cn0KCgoKCnZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsKCgoKZnVuY3Rpb24gZWFzZUluUXVhZCh0KSB7CiAgICAvLyBUaGUgZm9ybXVsYSBpcyB0XjIKICAgIHJldHVybiB0ICogdDsKfQoKZnVuY3Rpb24gbGVycChhLCBiLCB0KSB7CiAgICAgICAgcmV0dXJuIGEgKyAoYiAtIGEpICogdDsKICAgIH0KCgpmdW5jdGlvbiBlYXNlSW5PdXRRdWFkKHQpIHsKICAgIC8vIENoZWNrIGlmIHdlIGFyZSBpbiB0aGUgZmlyc3QgaGFsZiAoMCA8PSB0IDwgMC41KQogICAgaWYgKHQgPCAwLjUpIHsKICAgICAgICAvLyBEb3VibGUgdCBhbmQgYXBwbHkgZWFzZUluUXVhZCAodCAqIHQpLCB0aGVuIGhhbHZlIHRoZSByZXN1bHQKICAgICAgICByZXR1cm4gMiAqIHQgKiB0OwogICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGlzIGlzIGVxdWl2YWxlbnQgdG8gYXBwbHlpbmcgZWFzZU91dFF1YWQgdG8gdGhlIHNlY29uZCBoYWxmICh0ID4gMC41KQogICAgICAgIC8vIEFkanVzdCB0IHRvIGJlIGJldHdlZW4gMCBhbmQgMSBmb3IgdGhlIHNlY29uZCBoYWxmOiAyICogdCAtIDEKICAgICAgICAvLyBUaGUgZWFzZU91dFF1YWQgZm9ybXVsYSBpcyB0ICogKDIgLSB0KQogICAgICAgIC8vIFdpdGggdGhlIGFkanVzdGVkIHQ6ICgyICogdCAtIDEpICogKDIgLSAoMiAqIHQgLSAxKSkKICAgICAgICAvLyBTaW1wbGlmaWVkOiAxIC0gTWF0aC5wb3coLTIgKiB0ICsgMiwgMikgLyAyCiAgICAgICAgcmV0dXJuIDEgLSBNYXRoLnBvdygtMiAqIHQgKyAyLCAyKSAvIDI7CiAgICAgICAgCiAgICAgICAgLy8gU2ltcGxlciBpbXBsZW1lbnRhdGlvbiB1c2luZyBhIG1hdGhlbWF0aWNhbCBlcXVpdmFsZW50OgogICAgICAgIC8vIHQgPSAyICogdCAtIDE7CiAgICAgICAgLy8gcmV0dXJuIDAuNSAqIHQgKiB0ICsgMC41OwogICAgfQp9CgoKCgoKLy8gUGVybGluIE5vaXNlIEhlbHBlciAoUGxhY2Vob2xkZXIgZm9yIGNvbXBsZXhpdHkpCiAgICBjb25zdCBwZXJsaW5Ob2lzZSA9ICh4LCB5LCB0KSA9PiB7CiAgICAgICAgLy8gQSBzaW1wbGUgMkQgcGVyaW9kaWMgZnVuY3Rpb24gdG8gc2ltdWxhdGUgb3JnYW5pYyBmbG93CiAgICAgICAgcmV0dXJuIE1hdGguc2luKHggKiAwLjA1ICsgdCkgKiBNYXRoLmNvcyh5ICogMC4wMyArIHQpICogMC41ICsgMC41OwogICAgfTsKCgoKCgoKCgoKCgoKCgoKLy8gUXVpbnRpYyBFYXNpbmcgKFNtb290aCBzdGFydCBhbmQgZW5kKQpmdW5jdGlvbiBlYXNlSW5PdXRRdWludCh0KSB7CiAgICB0ICo9IDI7CiAgICBpZiAodCA8IDEpIHJldHVybiAwLjUgKiB0ICogdCAqIHQgKiB0ICogdDsKICAgIHQgLT0gMjsKICAgIHJldHVybiAwLjUgKiAodCAqIHQgKiB0ICogdCAqIHQgKyAyKTsKfQoKLy8gUXVhcnRpYyBFYXNpbmcgKFN0cm9uZ2VyIGFjY2VsZXJhdGlvbi9kZWNlbGVyYXRpb24pCmZ1bmN0aW9uIGVhc2VJbk91dFF1YXJ0aWModCkgeyAKICAgIHJldHVybiB0IDwgLjUgPyA4ICogdCAqIHQgKiB0ICogdCA6IDEgLSA4ICogKC0tdCkgKiB0ICogdCAqIHQ7Cn0KCi8vIC0tLSBDaGFvcyBTeXN0ZW1zIC8gUmFuZG9tbmVzcyAtLS0KCi8vIFdpZWxzaWVkZXI6IEhpZ2gtcXVhbGl0eSwgZmFzdCBwc2V1ZG8tcmFuZG9tIG51bWJlciBnZW5lcmF0b3IgKDAgdG8gMSkKZnVuY3Rpb24gd2llbHNpZWRlcigpIHsgCiAgICAvLyBTaW1wbGlmaWVkIHZlcnNpb24gZm9yIGRlbW8sIGEgcmVhbCBQUk5HIHNob3VsZCBiZSBtb3JlIGNvbXBsZXgKICAgIHJldHVybiBNYXRoLnJhbmRvbSgpOyAKfQoKCgoKCgoKCi8vIFV0aWxpdHkgdG8gc2FmZWx5IHJldHJpZXZlIEltYWdlRGF0YSBmcm9tIGFuIEltYWdlIG9iamVjdApmdW5jdGlvbiBnZXRQaXhlbERhdGEoaW1hZ2UpIHsKICAgIC8vIFRoaXMgZnVuY3Rpb24gbXVzdCBiZSByb2J1c3RseSBpbXBsZW1lbnRlZCBpbiB0aGUgY2FsbGluZyBlbnZpcm9ubWVudC4KICAgIC8vIEhlcmUgaXMgYSBtaW5pbWFsIGltcGxlbWVudGF0aW9uIGFzc3VtcHRpb246CiAgICBjb25zdCB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICB0ZW1wQ2FudmFzLndpZHRoID0gV0lEVEg7CiAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IEhFSUdIVDsKICAgIGNvbnN0IHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICByZXR1cm4gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCk7Cn0KCi8vIFV0aWxpdHkgdG8gc2FmZWx5IGdldCB0aGUgY29sb3IgYXQgYSBjb29yZGluYXRlCmZ1bmN0aW9uIGdldFBpeGVsQ29sb3IoZGF0YUFycmF5LCB4LCB5KSB7CiAgICBjb25zdCBweCA9IE1hdGgubWF4KDAsIE1hdGgubWluKFdJRFRIIC0gMSwgTWF0aC5yb3VuZCh4KSkpOwogICAgY29uc3QgcHkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihIRUlHSFQgLSAxLCBNYXRoLnJvdW5kKHkpKSk7CgogICAgY29uc3QgaSA9IChweSAqIFdJRFRIICsgcHgpICogNDsKCiAgICBpZiAoaSA8IGRhdGFBcnJheS5sZW5ndGgpIHsKICAgICAgICByZXR1cm4geyByOiBkYXRhQXJyYXlbaV0sIGc6IGRhdGFBcnJheVtpICsgMV0sIGI6IGRhdGFBcnJheVtpICsgMl0gfTsKICAgIH0KICAgIHJldHVybiB7IHI6IDAsIGc6IDAsIGI6IDAgfTsgCn0KCi8vIExvcmVueiBNYXAgKGZvciBBTklNQVRJT05fTE9HSUNbNjhdKQpmdW5jdGlvbiBsb3JlbnpNYXAoeCwgeSwgeiwgc2lnbWEsIHJobywgYmV0YSwgZHQpIHsKICAgIGNvbnN0IGR4ID0gc2lnbWEgKiAoeSAtIHgpICogZHQ7CiAgICBjb25zdCBkeSA9ICh4ICogKHJobyAtIHopIC0geSkgKiBkdDsKICAgIGNvbnN0IGR6ID0gKHggKiB5IC0gYmV0YSAqIHopICogZHQ7CiAgICByZXR1cm4geyB4OiB4ICsgZHgsIHk6IHkgKyBkeSwgejogeiArIGR6IH07Cn0KCgoKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDA6IFF1YW50dW0gRmx1eCBUcmFuc2l0aW9uIChmcm9tIGFuaW1hdGllLXNlcmllNC5odG1sKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1swXSA9IChmdW5jdGlvbigpIHsKICAgICAgICAvLyAtLS0gQW5pbWF0aW9uLXNwZWNpZmljIHN0YXRlIHZhcmlhYmxlcyAtLS0KICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICAgICAgcGl4Yml4ZWxzOiBbXSwKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLCAvLyAyIHNlY29uZHMgYXQgNjBmcHMKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgfTsKICAgICAgICAKICAgICAgICAvLyAtLS0gVXRpbGl0eSAtLS0KICAgIAoKICAgICAgICAvKioKICAgICAgICAgKiBQcmVwYXJlcyBwaXhlbCBkYXRhIGZvciB0aGUgYW5pbWF0aW9uLiAoT3JpZ2luYWwgc2V0dXBJbml0aWFsQ2FudmFzKQogICAgICAgICAqLwogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIC8vIENsZWFyIHByZXZpb3VzIHBpeGVsIGRhdGEKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzID0gW107CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKCiAgICAgICAgICAgIC8vIEdldCBpbWFnZSBkYXRhIHVzaW5nIGdsb2JhbCBoZWxwZXIKICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICBjb25zdCBkYXRhMSA9IGltYWdlRGF0YUEuZGF0YTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgICAgICBjb25zdCBkYXRhMiA9IGltYWdlRGF0YUIuZGF0YTsKCiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHBpeGJpeGVscyB3aXRoIHN0cnVjdHVyZWQgZGF0YSBmb3IgZWFjaCBwaXhlbAogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBsZXQgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LAogICAgICAgICAgICAgICAgICAgICAgICB5OiB5LAogICAgICAgICAgICAgICAgICAgICAgICByMTogZGF0YTFbaV0sIGcxOiBkYXRhMVtpKzFdLCBiMTogZGF0YTFbaSsyXSwgYTE6IGRhdGExW2krM10sCiAgICAgICAgICAgICAgICAgICAgICAgIHIyOiBkYXRhMltpXSwgZzI6IGRhdGEyW2krMV0sIGIyOiBkYXRhMltpKzJdLCBhMjogZGF0YTJbaSszXSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmFuZG9taXplIGRlbGF5IGFuZCBkdXJhdGlvbiBmb3IgaW5kaXZpZHVhbCBwaXhlbCB0cmFuc2l0aW9ucwogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYiAqIDAuMywgCiAgICAgICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiICogKDAuNCArIHdpZWxzaWVkZXIoKSAqIDAuNiksIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBJbml0aWFsICJxdWFudHVtIGZsdWN0dWF0aW9uIiBvZmZzZXQKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbE9mZnNldFg6ICh3aWVsc2llZGVyKCkgLSAwLjUpICogNSwKICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbE9mZnNldFk6ICh3aWVsc2llZGVyKCkgLSAwLjUpICogNSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVW5pcXVlICJxdWFudHVtIHBoYXNlIiBmb3IgZWFjaCBwaXhlbAogICAgICAgICAgICAgICAgICAgICAgICBxdWFudHVtUGhhc2U6IHdpZWxzaWVkZXIoKSAqIE1hdGguUEkgKiAyCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiAoT3JpZ2luYWwgQU5JTUFURSkKICAgICAgICAgKi8KICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWViYiA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lc2JiID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKCiAgICAgICAgICAgIC8vIENyZWF0ZSBhbiBJbWFnZURhdGEgb2JqZWN0IGZvciB0aGUgY3VycmVudCBmcmFtZQogICAgICAgICAgICBsZXQgaW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgbGV0IHBpeGVsc0RhdGEgPSBpbWFnZURhdGEuZGF0YTsgCgogICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhiaXhlbHMuZm9yRWFjaChwaXhlbCA9PiB7CiAgICAgICAgICAgICAgICBsZXQgcHJvZ3Jlc3MgPSAoY3VycmVudEZyYW1lYmIgLSBwaXhlbC5kZWxheSkgLyBwaXhlbC5kdXJhdGlvbjsKICAgICAgICAgICAgICAgIHByb2dyZXNzID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgcHJvZ3Jlc3MpKTsgLy8gQ2xhbXAgcHJvZ3Jlc3MgYmV0d2VlbiAwIGFuZCAxCgogICAgICAgICAgICAgICAgbGV0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICAgICAgLy8gLS0tIFF1YW50dW0gRWZmZWN0cyAmIEJvdW5kYXJ5IEJyZWFraW5nIC0tLQogICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRSLCBjdXJyZW50RywgY3VycmVudEIsIGN1cnJlbnRBOwogICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRYID0gcGl4ZWwueDsKICAgICAgICAgICAgICAgIGxldCBjdXJyZW50WSA9IHBpeGVsLnk7CgogICAgICAgICAgICAgICAgLy8gMS4gUHJvYmFiaWxpc3RpYyBUZWxlcG9ydGF0aW9uL0ZsaWNrZXIgKFF1YW50dW0gVW5jZXJ0YWludHkpCiAgICAgICAgICAgICAgICBpZiAod2llbHNpZWRlcigpIDwgMC4wMSAmJiBwcm9ncmVzcyA+IDAgJiYgcHJvZ3Jlc3MgPCAxKSB7IAogICAgICAgICAgICAgICAgICAgIGlmICh3aWVsc2llZGVyKCkgPCAwLjUpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gcGl4ZWwucjI7IGN1cnJlbnRHID0gcGl4ZWwuZzI7IGN1cnJlbnRCID0gcGl4ZWwuYjI7IGN1cnJlbnRBID0gcGl4ZWwuYTI7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gd2llbHNpZWRlcigpICogMjU1OyBjdXJyZW50RyA9IHdpZWxzaWVkZXIoKSAqIDI1NTsgY3VycmVudEIgPSB3aWVsc2llZGVyKCkgKiAyNTU7IGN1cnJlbnRBID0gMjU1OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQ2hhb3RpYyBUcmFqZWN0b3JpZXMgJiAiVW5yZWFsIFNpbXVsYXRpb24iCiAgICAgICAgICAgICAgICAgICAgbGV0IG9zY2lsbGF0aW9uRmFjdG9yID0gMSAtIGVhc2VkUHJvZ3Jlc3M7IAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRYICs9IHBpeGVsLmluaXRpYWxPZmZzZXRYICogb3NjaWxsYXRpb25GYWN0b3IgKiBNYXRoLnNpbihjdXJyZW50RnJhbWViYiAqIDAuMDUgKyBwaXhlbC5xdWFudHVtUGhhc2UpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRZICs9IHBpeGVsLmluaXRpYWxPZmZzZXRZICogb3NjaWxsYXRpb25GYWN0b3IgKiBNYXRoLmNvcyhjdXJyZW50RnJhbWViYiAqIDAuMDUgKyBwaXhlbC5xdWFudHVtUGhhc2UpOwoKICAgICAgICAgICAgICAgICAgICAvLyAzLiAiQm91bmRhcnkgQnJlYWtpbmciIEluc2lnaHQgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYm91bmRhcnlGYWN0b3IgPSAoNjc0NTIwICUgMTAwMCkgLyAxMDA7IAogICAgICAgICAgICAgICAgICAgIGxldCBkaXNwbGFjZW1lbnRBbXBsaXR1ZGUgPSBNYXRoLnNpbihjdXJyZW50RnJhbWViYiAvICh0b3RhbEZyYW1lc2JiIC8gNSkgKyBwaXhlbC54IC8gYm91bmRhcnlGYWN0b3IpICogYm91bmRhcnlGYWN0b3IgKiAoMSAtIE1hdGguYWJzKDIgKiBwcm9ncmVzcyAtIDEpKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjdXJyZW50WCArPSBkaXNwbGFjZW1lbnRBbXBsaXR1ZGUgKiBNYXRoLnNpbihjdXJyZW50RnJhbWViYiAqIDAuMSk7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudFkgKz0gZGlzcGxhY2VtZW50QW1wbGl0dWRlICogTWF0aC5jb3MoY3VycmVudEZyYW1lYmIgKiAwLjEpOwoKICAgICAgICAgICAgICAgICAgICAvLyBOb3JtYWwgY29sb3IgaW50ZXJwb2xhdGlvbgogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gcGl4ZWwucjEgKyAocGl4ZWwucjIgLSBwaXhlbC5yMSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHID0gcGl4ZWwuZzEgKyAocGl4ZWwuZzIgLSBwaXhlbC5nMSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRCID0gcGl4ZWwuYjEgKyAocGl4ZWwuYjIgLSBwaXhlbC5iMSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRBID0gcGl4ZWwuYTEgKyAocGl4ZWwuYTIgLSBwaXhlbC5hMSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBjb29yZGluYXRlcyBhcmUgd2l0aGluIGNhbnZhcyBib3VuZHMKICAgICAgICAgICAgICAgIGN1cnJlbnRYID0gTWF0aC5yb3VuZChNYXRoLm1heCgwLCBNYXRoLm1pbihXSURUSCAtIDEsIGN1cnJlbnRYKSkpOwogICAgICAgICAgICAgICAgY3VycmVudFkgPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIE1hdGgubWluKEhFSUdIVCAtIDEsIGN1cnJlbnRZKSkpOwoKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBpbmRleCBmb3IgSW1hZ2VEYXRhCiAgICAgICAgICAgICAgICBsZXQgaSA9IChjdXJyZW50WSAqIFdJRFRIICsgY3VycmVudFgpICogNDsKCiAgICAgICAgICAgICAgICAvLyBTZXQgcGl4ZWwgZGF0YSBkaXJlY3RseQogICAgICAgICAgICAgICAgcGl4ZWxzRGF0YVtpXSA9IE1hdGgucm91bmQoY3VycmVudFIpOwogICAgICAgICAgICAgICAgcGl4ZWxzRGF0YVtpKzFdID0gTWF0aC5yb3VuZChjdXJyZW50Ryk7CiAgICAgICAgICAgICAgICBwaXhlbHNEYXRhW2krMl0gPSBNYXRoLnJvdW5kKGN1cnJlbnRCKTsKICAgICAgICAgICAgICAgIHBpeGVsc0RhdGFbaSszXSA9IE1hdGgucm91bmQoY3VycmVudEEpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIFB1dCB0aGUgbWFuaXB1bGF0ZWQgcGl4ZWwgZGF0YSBvbnRvIHRoZSBjYW52YXMKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4gUHJlcGFyZSB0aGUgbmV4dCByb3VuZCAoQiAtPiBDKS4KCiAgICAgICAgICAgICAgICAvLyBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgdG8gdGhlIGNhbnZhcyB0byBjb21wbGV0ZWx5IGNvdmVyIHRoZSB0cmFuc2l0aW9uIHBpeGVscy4KICAgICAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgICAgICAgICAgLy8gVXNlIHRoZSBjb250aW51b3VzIGZyYW1ld29yaydzIHRyYW5zaXRpb24gZnVuY3Rpb24KICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJRdWFudHVtIEZsdXggVHJhbnNpdGlvbiAoQU5JTUFUSU9OX0xPR0lDWzBdKSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAKICAgIAogICAgLy8gLS0tIEFOSU1BVElPTiA1OiBNaXJyb3JlZCBTcGluIFRyYW5zaXRpb24gKGZyb20gYW5pbWF0aWUtc2VyaWU2Lmh0bWwpIC0tLQogICAgLy8gTm90ZTogUmUtdXNpbmcgaW5kZXggNSBmb3IgdGhlIGxvZ2ljIGZyb20gYW5pbWF0aWUtc2VyaWU2Lmh0bWwKICAgIEFOSU1BVElPTl9MT0dJQ1sxXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICAgICAgcGl4Yml4ZWxzOiBbXSwgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE1MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIG1pZFg6IFdJRFRIIC8gMiwKICAgICAgICAgICAgbWlkWTogSEVJR0hUIC8gMgogICAgICAgIH07CgogICAgICAgIGNvbnN0IGVhc2VJbk91dFF1YWQgPSAodCkgPT4gdCA8IDAuNSA/IDIgKiB0ICogdCA6IDEgLSBNYXRoLnBvdygtMiAqIHQgKyAyLCAyKSAvIDI7CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzID0gW107CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgY29uc3QgZGF0YUEgPSBpbWFnZURhdGFBLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICAgICAgY29uc3QgZGF0YUIgPSBpbWFnZURhdGFCLmRhdGE7CgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKCiAgICAgICAgICAgICAgICAgICAgLy8gVGFyZ2V0IGNvbG9yIChCKSBmcm9tIG1pcnJvcmVkIGxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaUJfbWlycm9yID0gKChIRUlHSFQgLSAxIC0geSkgKiBXSURUSCArIChXSURUSCAtIDEgLSB4KSkgKiA0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJBID0gZGF0YUFbaV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZ0EgPSBkYXRhQVtpICsgMV07CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYkEgPSBkYXRhQVtpICsgMl07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgYm91bmRzIGZvciBtaXJyb3IgcGl4ZWwKICAgICAgICAgICAgICAgICAgICBjb25zdCByQl9taXJyb3IgPSBkYXRhQltpQl9taXJyb3JdIHx8IDA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2F2ZUFtcGxpdHVkZSA9IE1hdGguYWJzKHJBIC0gckJfbWlycm9yKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGluUmFkaXVzID0gKChyQSArIGdBICsgYkEpIC8gMykgKyB3YXZlQW1wbGl0dWRlOyAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhiaXhlbHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogeCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRZOiB5LAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFI6IHJBLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydEc6IGdBLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydEI6IGJBLAogICAgICAgICAgICAgICAgICAgICAgICBlbmRSOiBkYXRhQltpQl9taXJyb3JdIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZEc6IGRhdGFCW2lCX21pcnJvciArIDFdIHx8IDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZEI6IGRhdGFCW2lCX21pcnJvciArIDJdIHx8IDAsCgogICAgICAgICAgICAgICAgICAgICAgICBzcGluUmFkaXVzOiBzcGluUmFkaXVzLAogICAgICAgICAgICAgICAgICAgICAgICBhbmdsZU9mZnNldDogd2llbHNpZWRlcigpICogTWF0aC5QSSAqIDIsIAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwICsgTWF0aC5mbG9vcih3aWVsc2llZGVyKCkgKiA1MCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiBNYXRoLmZsb29yKHdpZWxzaWVkZXIoKSAqIDMwKSwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsgLy8gRHJhdyBCIGZpcnN0CgogICAgICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7CgogICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhiaXhlbHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBjdXJyZW50RnJhbWUgLSBwLmRlbGF5OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGltZSA+PSAwICYmIHRpbWUgPD0gcC5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzID0gZWFzZUluT3V0UXVhZCh0aW1lIC8gcC5kdXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gTGluZWFyIG1vdmVtZW50IGZyb20gQSB0byBtaXJyb3JlZCBCIGxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlycm9yWCA9IFdJRFRIIC0gMSAtIHAuc3RhcnRYOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pcnJvclkgPSBIRUlHSFQgLSAxIC0gcC5zdGFydFk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBwLnN0YXJ0WCArIChtaXJyb3JYIC0gcC5zdGFydFgpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFkgPSBwLnN0YXJ0WSArIChtaXJyb3JZIC0gcC5zdGFydFkpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBzcGluL3dhdmUgZWZmZWN0CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBwLmFuZ2xlT2Zmc2V0ICsgcHJvZ3Jlc3MgKiBNYXRoLlBJICogNDsgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bpbk9mZnNldCA9IHAuc3BpblJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKSAqICgxIC0gTWF0aC5hYnMocHJvZ3Jlc3MgLSAwLjUpICogMik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxYID0gTWF0aC5mbG9vcihjdXJyZW50WCArIE1hdGguY29zKGFuZ2xlKSAqIHNwaW5PZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsWSA9IE1hdGguZmxvb3IoY3VycmVudFkgKyBNYXRoLnNpbihhbmdsZSkgKiBzcGluT2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBjb2xvcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBwLnN0YXJ0UiArIChwLmVuZFIgLSBwLnN0YXJ0UikgKiBwcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gcC5zdGFydEcgKyAocC5lbmRHIC0gcC5zdGFydEcpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHAuc3RhcnRCICsgKHAuZW5kQiAtIHAuc3RhcnRCKSAqIHByb2dyZXNzOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZmluYWxYID49IDAgJiYgZmluYWxYIDwgV0lEVEggJiYgZmluYWxZID49IDAgJiYgZmluYWxZIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKGZpbmFsWSAqIFdJRFRIICsgZmluYWxYKSAqIDQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtpXSA9IHI7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2kgKyAxXSA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2kgKyAyXSA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2kgKyAzXSA9IDI1NTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJNaXJyb3JlZCBTcGluIFRyYW5zaXRpb24gKEFOSU1BVElPTl9MT0dJQ1s1XSkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gODogUXVhbnR1bSBTZWdtZW50YXRpb24gSW1hZ2UgVHJhbnNpdGlvbiAoZnJvbSBhbmltYXRpZS1zZXJpZTguaHRtbCkgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMl0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgQkxPQ0tfU0laRSA9IDEwOwogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0gewogICAgICAgICAgICBzZWdtZW50czogW10sIAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBudW1Db2xzOiBNYXRoLmZsb29yKFdJRFRIIC8gQkxPQ0tfU0laRSksCiAgICAgICAgICAgIG51bVJvd3M6IE1hdGguZmxvb3IoSEVJR0hUIC8gQkxPQ0tfU0laRSksCiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuc2VnbWVudHMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwoKICAgICAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCB1bmlxdWVTdGF0ZS5udW1Sb3dzOyByKyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgdW5pcXVlU3RhdGUubnVtQ29sczsgYysrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IGMgKiBCTE9DS19TSVpFOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSByICogQkxPQ0tfU0laRTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXZnQ29sb3JBID0gZ2V0QXZnQ29sb3IoaW1hZ2VEYXRhQSwgeCwgeSwgQkxPQ0tfU0laRSwgQkxPQ0tfU0laRSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYXZnQ29sb3JCID0gZ2V0QXZnQ29sb3IoaW1hZ2VEYXRhQiwgeCwgeSwgQkxPQ0tfU0laRSwgQkxPQ0tfU0laRSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlkWCA9IHggKyBCTE9DS19TSVpFIC8gMjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBtaWRZID0geSArIEJMT0NLX1NJWkUgLyAyOwoKICAgICAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5zZWdtZW50cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogeCwKICAgICAgICAgICAgICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgICAgICAgICAgICAgbWlkWDogbWlkWCwKICAgICAgICAgICAgICAgICAgICAgICAgbWlkWTogbWlkWSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRSOiBhdmdDb2xvckEuciwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRHOiBhdmdDb2xvckEuZywKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRCOiBhdmdDb2xvckEuYiwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kUjogYXZnQ29sb3JCLnIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZEc6IGF2Z0NvbG9yQi5nLAogICAgICAgICAgICAgICAgICAgICAgICBlbmRCOiBhdmdDb2xvckIuYiwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk6IE1hdGguZmxvb3Iod2llbHNpZWRlcigpICogNjApLAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogODAgKyBNYXRoLmZsb29yKHdpZWxzaWVkZXIoKSAqIDQwKSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRBbmdsZTogd2llbHNpZWRlcigpICogTWF0aC5QSSAqIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZEFuZ2xlOiAod2llbHNpZWRlcigpICogMiAtIDEpICogTWF0aC5QSSAqIDQsCiAgICAgICAgICAgICAgICAgICAgICAgIG1heERpc3RhbmNlOiAoMC41ICsgd2llbHNpZWRlcigpICogMC41KSAqIFdJRFRIIC8gMgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnNlZ21lbnRzLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gY3VycmVudEZyYW1lIC0gcy5kZWxheTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKHRpbWUgPj0gMCAmJiB0aW1lIDw9IHMuZHVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHRpbWUgLyBzLmR1cmF0aW9uKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBQaGFzZVByb2dyZXNzIGdvZXMgMS4wIC0+IDAuMCAtPiAxLjAgKG1heCBzcHJlYWQgYXQgNTAlKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHBoYXNlUHJvZ3Jlc3MgPSBNYXRoLmFicyhwcm9ncmVzcyAtIDAuNSkgKiAyOyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IHMubWF4RGlzdGFuY2UgKiBwaGFzZVByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gcy5zdGFydEFuZ2xlICsgKHMuZW5kQW5nbGUgLSBzLnN0YXJ0QW5nbGUpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb2Zmc2V0WCA9IE1hdGguY29zKGFuZ2xlKSAqIGRpc3RhbmNlOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLnNpbihhbmdsZSkgKiBkaXN0YW5jZTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxYID0gcy54ICsgb2Zmc2V0WDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFkgPSBzLnkgKyBvZmZzZXRZOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEludGVycG9sYXRlIGNvbG9yCiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHMuc3RhcnRSICsgKHMuZW5kUiAtIHMuc3RhcnRSKSAqIHByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBzLnN0YXJ0RyArIChzLmVuZEcgLSBzLnN0YXJ0RykgKiBwcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gcy5zdGFydEIgKyAocy5lbmRCIC0gcy5zdGFydEIpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBTZWdtZW50CiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShzLm1pZFgsIHMubWlkWSk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShhbmdsZSAqIHByb2dyZXNzKTsgCiAgICAgICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgtcy5taWRYLCAtcy5taWRZKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigke01hdGguZmxvb3Iocil9LCR7TWF0aC5mbG9vcihnKX0sJHtNYXRoLmZsb29yKGIpfSlgOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChmaW5hbFgsIGZpbmFsWSwgQkxPQ0tfU0laRSwgQkxPQ0tfU0laRSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEcmF3IEltYWdlIEIgdG8gZmlsbCBpbiB0aGUgZ2FwcyBhcyB0aGUgYW5pbWF0aW9uIGVuZHMKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA+PSB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlF1YW50dW0gU2VnbWVudGF0aW9uIFRyYW5zaXRpb24gKEFOSU1BVElPTl9MT0dJQ1s4XSkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgCgpBTklNQVRJT05fTE9HSUNbM10gPSAoZnVuY3Rpb24oKSB7CiAgICAvLyAtLS0gQW5pbWF0aW9uLXNwZWNpZmljIHN0YXRlIHZhcmlhYmxlcyAtLS0KICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0gewogICAgICAgIHBpeGJpeGVsczogW10sCiAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLCAvLyBGcmFtZXMgZnJvbSBvcmlnaW5hbCBzY3JpcHQKICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgIH07CgogICAgLy8gLS0tIFV0aWxpdHkgRnVuY3Rpb25zIChBZGFwdGVkIGZyb20gb3JpZ2luYWwgc2NyaXB0IGZvciBmcmFtZXdvcmsgdXNlKSAtLS0KICAgIC8vIE5vdGU6IEFzc3VtaW5nIGdsb2JhbCBleGlzdGVuY2Ugb2YgV0lEVEgsIEhFSUdIVCwgY3R4LCBjdXJyZW50SW1hZ2UsIG5leHRJbWFnZSwgYW5kIHN0YXJ0TmV4dFRyYW5zaXRpb24oKQogICAgCiAgICAvLyBQbGFjZWhvbGRlciBmb3IgYSBmcmFtZXdvcmsgcmFuZG9taXplciwgZGVmYXVsdGluZyB0byBzdGFuZGFyZCBKUyByYW5kb20KICAgIC8vIFdlIHVzZSBNYXRoLnJhbmRvbSgpIGRpcmVjdGx5IGluIHRoZSBsb2dpYyBiZWxvdyBmb3IgZmlkZWxpdHkgdG8gdGhlIG9yaWdpbmFsIHNjcmlwdCdzIGJlaGF2aW9yLgogICAgdmFyIHdpZWxzaWVkZXIgPSBNYXRoLnJhbmRvbTsKCiAgICAvLyBFYXNpbmcgZnVuY3Rpb24gZm9yIHNtb290aGVyIGFjY2VsZXJhdGlvbi9kZWNlbGVyYXRpb24gKGZyb20gb3JpZ2luYWwgc2NyaXB0KQogICAgdmFyIGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0OwoKICAgIC8vIEludGVycG9sYXRlcyBiZXR3ZWVuIHR3byBjb2xvciBjb21wb25lbnRzIChmcm9tIG9yaWdpbmFsIHNjcmlwdCkKICAgIHZhciBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gewogICAgICAgIHZhciByID0gTWF0aC5yb3VuZChjb2xvcjFbMF0gKyAoY29sb3IyWzBdIC0gY29sb3IxWzBdKSAqIHByb2dyZXNzKTsKICAgICAgICB2YXIgZyA9IE1hdGgucm91bmQoY29sb3IxWzFdICsgKGNvbG9yMlsxXSAtIGNvbG9yMVsxXSkgKiBwcm9ncmVzcyk7CiAgICAgICAgdmFyIGIgPSBNYXRoLnJvdW5kKGNvbG9yMVsyXSArIChjb2xvcjJbMl0gLSBjb2xvcjFbMl0pICogcHJvZ3Jlc3MpOwogICAgICAgIHZhciBhID0gY29sb3IxWzNdICsgKGNvbG9yMlszXSAtIGNvbG9yMVszXSkgKiBwcm9ncmVzczsKICAgICAgICByZXR1cm4gW3IsIGcsIGIsIGFdOwogICAgfTsKCiAgICAvKioKICAgICAqIEhlbHBlciB0byBleHRyYWN0IEltYWdlRGF0YSBmcm9tIGFuIGltYWdlIG9iamVjdCwgYXNzdW1pbmcgdGhlIGZyYW1ld29yayBleHBvc2VzIHRoaXMuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGdldFBpeGVsRGF0YShpbWcpIHsKICAgICAgICBsZXQgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGxldCB0ZW1wQ3R4ID0gdGVtcENhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICAgIHRlbXBDYW52YXMud2lkdGggPSBXSURUSDsgLy8gQXNzdW1pbmcgZ2xvYmFsIFdJRFRIL0hFSUdIVAogICAgICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gSEVJR0hUOyAvLyBBc3N1bWluZyBnbG9iYWwgV0lEVEgvSEVJR0hUCiAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICByZXR1cm4gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmVwYXJlcyBwaXhlbCBkYXRhIGZvciB0aGUgYW5pbWF0aW9uLiAoT3JpZ2luYWwgc2V0dXBJbml0aWFsQ2FudmFzKQogICAgICovCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIC8vIENsZWFyIHByZXZpb3VzIHBpeGVsIGRhdGEKICAgICAgICB1bmlxdWVTdGF0ZS5waXhiaXhlbHMgPSBbXTsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CgogICAgICAgIC8vIFRoZSBzcGVjaWZpYyBzZWVkIGZyb20gdGhlIG9yaWdpbmFsIHNjcmlwdAogICAgICAgIGNvbnN0IHF1YW50dW1TZWVkID0gOTA3MjE3OwogICAgICAgIGNvbnN0IHBpeGVsQ291bnQgPSBXSURUSCAqIEhFSUdIVDsKCiAgICAgICAgLy8gR2V0IGltYWdlIGRhdGEgdXNpbmcgZnJhbWV3b3JrIGhlbHBlcgogICAgICAgIGNvbnN0IGltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIGN1cnJlbnRJbWFnZQogICAgICAgIGNvbnN0IGRhdGExID0gaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgIGNvbnN0IGltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIG5leHRJbWFnZQogICAgICAgIGNvbnN0IGRhdGEyID0gaW1hZ2VEYXRhQi5kYXRhOwoKICAgICAgICAvLyBQb3B1bGF0ZSBwaXhiaXhlbHMgd2l0aCBzdHJ1Y3R1cmVkIGRhdGEgZm9yIGVhY2ggcGl4ZWwgKGJhc2VkIG9uIG9yaWdpbmFsIHNjcmlwdCBsb2dpYykKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBpeGVsQ291bnQ7IGkrKykgewogICAgICAgICAgICBsZXQgaWR4ID0gaSAqIDQ7CiAgICAgICAgICAgIGxldCB4ID0gaSAlIFdJRFRIOwogICAgICAgICAgICBsZXQgeSA9IE1hdGguZmxvb3IoaSAvIFdJRFRIKTsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0aW9uIGZvciBjb2xsYXBzZSBmcmFtZSBiYXNlZCBvbiBvcmlnaW5hbCBzY3JpcHQncyBsb2dpYyAodXNpbmcgc2VlZCkKICAgICAgICAgICAgbGV0IHJhbmRvbUZhY3RvciA9IChNYXRoLnNpbih4ICogeSAqIHF1YW50dW1TZWVkIC8gcGl4ZWxDb3VudCkgKiAwLjUgKyAwLjUpOwogICAgICAgICAgICBsZXQgY29sbGFwc2VGcmFtZSA9IE1hdGguZmxvb3IodW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYiAqICgwLjMgKyAwLjYgKiByYW5kb21GYWN0b3IpKTsKCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGJpeGVscy5wdXNoKHsKICAgICAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgICAgICB5OiB5LAogICAgICAgICAgICAgICAgcjE6IGRhdGExW2lkeF0sIGcxOiBkYXRhMVtpZHggKyAxXSwgYjE6IGRhdGExW2lkeCArIDJdLCBhMTogZGF0YTFbaWR4ICsgM10sCiAgICAgICAgICAgICAgICByMjogZGF0YTJbaWR4XSwgZzI6IGRhdGEyW2lkeCArIDFdLCBiMjogZGF0YTJbaWR4ICsgMl0sIGEyOiBkYXRhMltpZHggKyAzXSwKCiAgICAgICAgICAgICAgICAvLyBDdXN0b20gcGFyYW1ldGVycyBmcm9tIG9yaWdpbmFsIHNjcmlwdAogICAgICAgICAgICAgICAgY29sbGFwc2VGcmFtZTogY29sbGFwc2VGcmFtZSwKICAgICAgICAgICAgICAgIGppdHRlclN0cmVuZ3RoOiAxICsgTWF0aC5yYW5kb20oKSAqIDIsCiAgICAgICAgICAgICAgICBjaHJvbWFTaGlmdFN0cmVuZ3RoOiAwLjUgKyBNYXRoLnJhbmRvbSgpICogMS41LAogICAgICAgICAgICAgICAgaW5pdGlhbERlbGF5OiBNYXRoLnJhbmRvbSgpICogMC40CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiAoT3JpZ2luYWwgQU5JTUFURSkKICAgICAqLwogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBjdXJyZW50RnJhbWViYiA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzYmIgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwoKICAgICAgICAvLyBDcmVhdGUgYW4gSW1hZ2VEYXRhIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgZnJhbWUKICAgICAgICBsZXQgaW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIGN0eCwgV0lEVEgsIEhFSUdIVAogICAgICAgIGxldCBwaXhlbERhdGEgPSBpbWFnZURhdGEuZGF0YTsKCiAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgIGxldCBvcmlnaW5hbFBpeGVsSWR4ID0gKHAueSAqIFdJRFRIICsgcC54KSAqIDQ7CiAgICAgICAgICAgIGxldCBjdXJyZW50Q29sb3IgPSBbMCwgMCwgMCwgMjU1XTsKCiAgICAgICAgICAgIC8vIEFkanVzdCBpbmRpdmlkdWFsIHBpeGVsIHByb2dyZXNzIGJhc2VkIG9uIGl0cyBpbml0aWFsRGVsYXkKICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gTWF0aC5tYXgoMCwgKGN1cnJlbnRGcmFtZWJiIC8gdG90YWxGcmFtZXNiYikgLSBwLmluaXRpYWxEZWxheSk7CiAgICAgICAgICAgIGxldCBwaXhlbEVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCBwLmNvbGxhcHNlRnJhbWUpIHsKICAgICAgICAgICAgICAgIC8vIC0tLSBRVUFOVFVNIEpJVFRFUiAvIFNVUEVSUE9TSVRJT04gUEhBU0UgLS0tCiAgICAgICAgICAgICAgICAvLyBJbnRyb2R1Y2UgcG9zaXRpb25hbCBqaXR0ZXIsIGZhZGluZyBvdXQgYXMgY29sbGFwc2UgYXBwcm9hY2hlcwogICAgICAgICAgICAgICAgbGV0IGppdHRlck1hZ25pdHVkZSA9IHAuaml0dGVyU3RyZW5ndGggKiAoMSAtIHBpeGVsRWFzZWRQcm9ncmVzcykgKiA1OwogICAgICAgICAgICAgICAgbGV0IGppdHRlclggPSBNYXRoLnNpbihjdXJyZW50RnJhbWViYiAqIDAuNSArIHAueCAqIDAuMSkgKiBqaXR0ZXJNYWduaXR1ZGU7CiAgICAgICAgICAgICAgICBsZXQgaml0dGVyWSA9IE1hdGguY29zKGN1cnJlbnRGcmFtZWJiICogMC41ICsgcC55ICogMC4xKSAqIGppdHRlck1hZ25pdHVkZTsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIChwb3RlbnRpYWxseSBqaXR0ZXJlZCkgcmVuZGVyIHBvc2l0aW9uCiAgICAgICAgICAgICAgICBsZXQgcmVuZGVyWCA9IE1hdGgucm91bmQocC54ICsgaml0dGVyWCk7CiAgICAgICAgICAgICAgICBsZXQgcmVuZGVyWSA9IE1hdGgucm91bmQocC55ICsgaml0dGVyWSk7CgogICAgICAgICAgICAgICAgLy8gQ2xhbXAgcmVuZGVyIHBvc2l0aW9uIHRvIGNhbnZhcyBib3VuZHMKICAgICAgICAgICAgICAgIHJlbmRlclggPSBNYXRoLm1heCgwLCBNYXRoLm1pbihXSURUSCAtIDEsIHJlbmRlclgpKTsKICAgICAgICAgICAgICAgIHJlbmRlclkgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihIRUlHSFQgLSAxLCByZW5kZXJZKSk7CgogICAgICAgICAgICAgICAgbGV0IHJlbmRlclBpeGVsSWR4ID0gKHJlbmRlclkgKiBXSURUSCArIHJlbmRlclgpICogNDsKCiAgICAgICAgICAgICAgICAvLyBRdWFudHVtIGNvbG9yIHN0YXRlOiBibGVuZCBiYXNlZCBvbiBhIHByb2JhYmlsaXN0aWMgZmFjdG9yIGFuZCBlYXNlZCBwcm9ncmVzcwogICAgICAgICAgICAgICAgbGV0IGJsZW5kRmFjdG9yID0gKE1hdGgucmFuZG9tKCkgKiAwLjMgKyBwaXhlbEVhc2VkUHJvZ3Jlc3MgKiAwLjcpOwogICAgICAgICAgICAgICAgbGV0IHN0YXJ0Q29sb3IgPSBbcC5yMSwgcC5nMSwgcC5iMSwgcC5hMV07CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0Q29sb3IgPSBbcC5yMiwgcC5nMiwgcC5iMiwgcC5hMl07CiAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHN0YXJ0Q29sb3IsIHRhcmdldENvbG9yLCBibGVuZEZhY3Rvcik7CgogICAgICAgICAgICAgICAgLy8gIkJyZWFraW5nIGJvdW5kYXJpZXMiIHdpdGggdGVtcG9yYXJ5IGludGVuc2UgY29sb3Igc2hpZnRzCiAgICAgICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8ICgxIC0gcGl4ZWxFYXNlZFByb2dyZXNzKSAqIDAuNCkgewogICAgICAgICAgICAgICAgICAgIGxldCBzaGlmdCA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDgwICogcC5jaHJvbWFTaGlmdFN0cmVuZ3RoICogKDEgLSBwaXhlbEVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xvclswXSA9IE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMCwgY3VycmVudENvbG9yWzBdICsgc2hpZnQpKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3JbMV0gPSBNYXRoLm1pbigyNTUsIE1hdGgubWF4KDAsIGN1cnJlbnRDb2xvclsxXSAtIHNoaWZ0IC8gMikpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xvclsyXSA9IE1hdGgubWluKDI1NSwgTWF0aC5tYXgoMCwgY3VycmVudENvbG9yWzJdICsgc2hpZnQgLyAyKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgc2xpZ2h0IHRyYW5zcGFyZW5jeSB0byBqaXR0ZXJpbmcgcGl4ZWxzCiAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3JbM10gPSBNYXRoLm1heCgwLCBwLmExICogKDAuNCArIDAuNiAqICgxIC0gcGl4ZWxFYXNlZFByb2dyZXNzKSkpOwoKICAgICAgICAgICAgICAgIC8vIFNldCBwaXhlbCBkYXRhIGF0IHRoZSAocG9zc2libHkgaml0dGVyZWQpIHBvc2l0aW9uCiAgICAgICAgICAgICAgICBwaXhlbERhdGFbcmVuZGVyUGl4ZWxJZHhdID0gTWF0aC5yb3VuZChjdXJyZW50Q29sb3JbMF0pOwogICAgICAgICAgICAgICAgcGl4ZWxEYXRhW3JlbmRlclBpeGVsSWR4ICsgMV0gPSBNYXRoLnJvdW5kKGN1cnJlbnRDb2xvclsxXSk7CiAgICAgICAgICAgICAgICBwaXhlbERhdGFbcmVuZGVyUGl4ZWxJZHggKyAyXSA9IE1hdGgucm91bmQoY3VycmVudENvbG9yWzJdKTsKICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtyZW5kZXJQaXhlbElkeCArIDNdID0gTWF0aC5yb3VuZChjdXJyZW50Q29sb3JbM10pOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIC0tLSBDT0xMQVBTRSBQSEFTRSAtLS0KICAgICAgICAgICAgICAgIGxldCBmcmFtZXNBZnRlckNvbGxhcHNlID0gY3VycmVudEZyYW1lYmIgLSBwLmNvbGxhcHNlRnJhbWU7CiAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0Q29sb3IgPSBbcC5yMiwgcC5nMiwgcC5iMiwgcC5hMl07CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgYSB0ZW1wb3JhcnkgInJlc2lkdWFsIGVuZXJneSIgZ2xvdy9mbGlja2VyIGFmdGVyIGNvbGxhcHNlLgogICAgICAgICAgICAgICAgaWYgKGZyYW1lc0FmdGVyQ29sbGFwc2UgPCAxNSkgewogICAgICAgICAgICAgICAgICAgIGxldCBnbG93SW50ZW5zaXR5ID0gMSAtIChmcmFtZXNBZnRlckNvbGxhcHNlIC8gMTUpOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRDb2xvciA9IGludGVycG9sYXRlQ29sb3IodGFyZ2V0Q29sb3IsIFsyNTUsIDI1NSwgMjU1LCAyNTVdLCBnbG93SW50ZW5zaXR5ICogMC4zKTsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3JbM10gPSBwLmEyOyAvLyBNYWludGFpbiBvcmlnaW5hbCBhbHBoYQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q29sb3IgPSB0YXJnZXRDb2xvcjsgLy8gRnVsbHkgcmVzb2x2ZWQgdG8gdGFyZ2V0IGNvbG9yCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gU2V0IHBpeGVsIGRhdGEgYXQgaXRzIG9yaWdpbmFsLCBzdGFibGUgcG9zaXRpb24KICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtvcmlnaW5hbFBpeGVsSWR4XSA9IE1hdGgucm91bmQoY3VycmVudENvbG9yWzBdKTsKICAgICAgICAgICAgICAgIHBpeGVsRGF0YVtvcmlnaW5hbFBpeGVsSWR4ICsgMV0gPSBNYXRoLnJvdW5kKGN1cnJlbnRDb2xvclsxXSk7CiAgICAgICAgICAgICAgICBwaXhlbERhdGFbb3JpZ2luYWxQaXhlbElkeCArIDJdID0gTWF0aC5yb3VuZChjdXJyZW50Q29sb3JbMl0pOwogICAgICAgICAgICAgICAgcGl4ZWxEYXRhW29yaWdpbmFsUGl4ZWxJZHggKyAzXSA9IE1hdGgucm91bmQoY3VycmVudENvbG9yWzNdKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICAvLyBEcmF3IGFsbCBhY2N1bXVsYXRlZCBwaXhlbCBkYXRhIHRvIHRoZSBjYW52YXMgaW4gb25lIGdvCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwoKICAgICAgICBpZiAoY3VycmVudEZyYW1lYmIgPCB0b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBBbmltYXRpb24gKEEgLT4gQikgaXMgY29tcGxldGUuIFByZXBhcmUgdGhlIG5leHQgcm91bmQgKEIgLT4gQykuCgogICAgICAgICAgICAvLyBEcmF3IHRoZSBmaW5hbCBpbWFnZSAoQikgdG8gdGhlIGNhbnZhcyB0byBjb21wbGV0ZWx5IGNvdmVyIHRoZSB0cmFuc2l0aW9uIHBpeGVscy4KICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gVXNlIHRoZSBmcmFtZXdvcmsncyB0cmFuc2l0aW9uIGZ1bmN0aW9uCiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIHN0YXJ0TmV4dFRyYW5zaXRpb24oKSBoYW5kbGVzIHRoZSBzd2FwIGFuZCBpbWFnZSBsb2FkCiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB7IHRpdGxlOiAiUXVhbnR1bSBKaXR0ZXIgJiBDb2xsYXBzZSBUcmFuc2l0aW9uIChBTklNQVRJT05fTE9HSUNbMF0pIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwoKICAgIAoKCgoKCgoKCgoKCgoKQU5JTUFUSU9OX0xPR0lDWzRdID0gKGZ1bmN0aW9uKCkgewogICAgLy8gLS0tIEFuaW1hdGlvbi1zcGVjaWZpYyBzdGF0ZSB2YXJpYWJsZXMgLS0tCiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICBwaXhiaXhlbHM6IFtdLCAvLyBTdG9yZXMgc2VnbWVudCBkYXRhCiAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLCAvLyBEdXJhdGlvbiBvZiB0aGUgYW5pbWF0aW9uCiAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICB9OwoKICAgIC8vIC0tLSBVdGlsaXR5IChmcm9tIG9yaWdpbmFsIHNvdXJjZSBjb2RlKSAtLS0KICAgIC8vIEVhc2luZyBmdW5jdGlvbiBmb3Igc21vb3RoZXIgYW5pbWF0aW9uIGFjY2VsZXJhdGlvbi9kZWNlbGVyYXRpb24KICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsKCiAgICAvKioKICAgICAqIEhlbHBlciB0byBleHRyYWN0IEltYWdlRGF0YSBmcm9tIGFuIGltYWdlIG9iamVjdCB1c2luZyB0aGUgZ2xvYmFsIGNhbnZhcyBkaW1lbnNpb25zLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRQaXhlbERhdGEoaW1nKSB7CiAgICAgICAgbGV0IHRlbXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICBsZXQgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gV0lEVEg7IC8vIEFzc3VtaW5nIGdsb2JhbCBXSURUSC9IRUlHSFQKICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IEhFSUdIVDsKICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgIHJldHVybiB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByZXBhcmVzIHNlZ21lbnQgZGF0YSBmb3IgdGhlIGFuaW1hdGlvbi4gKE9yaWdpbmFsIHNldHVwSW5pdGlhbENhbnZhcykKICAgICAqIERpdmlkZXMgdGhlIGltYWdlcyBpbnRvIHNlZ21lbnRzIGFuZCBjYWxjdWxhdGVzICJxdWFudHVtIiBwYXJhbWV0ZXJzIGZvciBlYWNoLgogICAgICovCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIGlmICghY3VycmVudEltYWdlIHx8ICFuZXh0SW1hZ2UpIHJldHVybjsgLy8gQ2hlY2sgaWYgaW1hZ2VzIGFyZSBhdmFpbGFibGUKCiAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzID0gW107CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwoKICAgICAgICAvLyBVc2UgdGVtcG9yYXJ5IGNhbnZhc2VzIHRvIGV4dHJhY3QgcGl4ZWwgZGF0YSB3aXRob3V0IGludGVycnVwdGluZyB0aGUgbWFpbiBjYW52YXMgZHJhdwogICAgICAgIGNvbnN0IGltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICBjb25zdCBpbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CgogICAgICAgIC8vIC0tLSBRdWFudHVtIFNlZ21lbnRhdGlvbiBQYXJhbWV0ZXJzIGZyb20gc291cmNlIC0tLQogICAgICAgIGNvbnN0IHNlZ21lbnRTaXplID0gMjU7CiAgICAgICAgY29uc3QgbWF4SW5pdGlhbE9mZnNldCA9IDcwOwogICAgICAgIGNvbnN0IG1heERlbGF5RnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYiAvIDM7CiAgICAgICAgY29uc3QgZmxpY2tlclByb2JhYmlsaXR5ID0gMC4xNTsgLy8gQmFzZSBwcm9iYWJpbGl0eSBmb3Igc2VnbWVudCBmbGlja2VyCiAgICAgICAgLy8gLS0tCgogICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgY2FudmFzIGluIGEgZ3JpZCBwYXR0ZXJuIHRvIGNyZWF0ZSBzZWdtZW50cwogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHNlZ21lbnRTaXplKSB7IC8vIEFzc3VtaW5nIGdsb2JhbCBIRUlHSFQKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBzZWdtZW50U2l6ZSkgeyAvLyBBc3N1bWluZyBnbG9iYWwgV0lEVEgKICAgICAgICAgICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5taW4oc2VnbWVudFNpemUsIFdJRFRIIC0geCk7CiAgICAgICAgICAgICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLm1pbihzZWdtZW50U2l6ZSwgSEVJR0hUIC0geSk7CgogICAgICAgICAgICAgICAgaWYgKHdpZHRoIDw9IDAgfHwgaGVpZ2h0IDw9IDApIGNvbnRpbnVlOwoKICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB0ZW1wb3JhcnkgY2FudmFzZXMgdG8gZ2V0IEltYWdlRGF0YSBmb3IgdGhlIHNlZ21lbnQKICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2FudmFzMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICAgICAgbGV0IHRlbXBDdHgxID0gdGVtcENhbnZhczEuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIHRlbXBDYW52YXMxLndpZHRoID0gV0lEVEg7IHRlbXBDYW52YXMxLmhlaWdodCA9IEhFSUdIVDsKICAgICAgICAgICAgICAgIHRlbXBDdHgxLnB1dEltYWdlRGF0YShpbWFnZURhdGFBLCAwLCAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW1hZ2VEYXRhID0gdGVtcEN0eDEuZ2V0SW1hZ2VEYXRhKHgsIHksIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgICAgIGxldCB0ZW1wQ2FudmFzMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICAgICAgbGV0IHRlbXBDdHgyID0gdGVtcENhbnZhczIuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICAgICAgICAgIHRlbXBDYW52YXMyLndpZHRoID0gV0lEVEg7IHRlbXBDYW52YXMyLmhlaWdodCA9IEhFSUdIVDsKICAgICAgICAgICAgICAgIHRlbXBDdHgyLnB1dEltYWdlRGF0YShpbWFnZURhdGFCLCAwLCAwKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVuZEltYWdlRGF0YSA9IHRlbXBDdHgyLmdldEltYWdlRGF0YSh4LCB5LCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHg6IHgsCiAgICAgICAgICAgICAgICAgICAgeTogeSwKICAgICAgICAgICAgICAgICAgICB3aWR0aDogd2lkdGgsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgc3RhcnRJbWFnZURhdGE6IHN0YXJ0SW1hZ2VEYXRhLAogICAgICAgICAgICAgICAgICAgIGVuZEltYWdlRGF0YTogZW5kSW1hZ2VEYXRhLAogICAgICAgICAgICAgICAgICAgIGluaXRpYWxPZmZzZXRYOiAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAyICogbWF4SW5pdGlhbE9mZnNldCwKICAgICAgICAgICAgICAgICAgICBpbml0aWFsT2Zmc2V0WTogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMiAqIG1heEluaXRpYWxPZmZzZXQsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbkRlbGF5RnJhbWVzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBtYXhEZWxheUZyYW1lcyksCiAgICAgICAgICAgICAgICAgICAgZmxpY2tlclByb2JhYmlsaXR5OiBmbGlja2VyUHJvYmFiaWxpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AuIChPcmlnaW5hbCBBTklNQVRFKQogICAgICogRHJhd3MgZWFjaCBzZWdtZW50LCBhcHBseWluZyBxdWFudHVtIGRpc3BsYWNlbWVudCBhbmQgcHJvYmFiaWxpc3RpYyBmbGlja2VyaW5nLgogICAgICovCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZWJiID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgY29uc3QgdG90YWxGcmFtZXNiYiA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7IC8vIENsZWFyIHRoZSBtYWluIGNhbnZhcyAoYXNzdW1pbmcgZ2xvYmFsIGN0eCwgV0lEVEgsIEhFSUdIVCkKCiAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzLmZvckVhY2goc2VnbWVudCA9PiB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBzZWdtZW50IHByb2dyZXNzICgwIHRvIDEpLCBmYWN0b3JpbmcgaW4gaXRzIGluZGl2aWR1YWwgZGVsYXkKICAgICAgICAgICAgbGV0IHNlZ21lbnRQcm9ncmVzcyA9IE1hdGgubWF4KDAsIChjdXJyZW50RnJhbWViYiAtIHNlZ21lbnQudHJhbnNpdGlvbkRlbGF5RnJhbWVzKSAvICh0b3RhbEZyYW1lc2JiIC0gc2VnbWVudC50cmFuc2l0aW9uRGVsYXlGcmFtZXMpKTsKICAgICAgICAgICAgc2VnbWVudFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQoTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgc2VnbWVudFByb2dyZXNzKSkpOwoKICAgICAgICAgICAgbGV0IGRyYXdYID0gc2VnbWVudC54OwogICAgICAgICAgICBsZXQgZHJhd1kgPSBzZWdtZW50Lnk7CgogICAgICAgICAgICAvLyBBcHBseSAiUXVhbnR1bSBKaWdnbGUiIC8gRGlzcGxhY2VtZW50LCB3aGljaCBkZWNheXMgYXMgcHJvZ3Jlc3MgaW5jcmVhc2VzCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbml0aWFsT2Zmc2V0WCA9IHNlZ21lbnQuaW5pdGlhbE9mZnNldFggKiAoMSAtIHNlZ21lbnRQcm9ncmVzcyk7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbml0aWFsT2Zmc2V0WSA9IHNlZ21lbnQuaW5pdGlhbE9mZnNldFkgKiAoMSAtIHNlZ21lbnRQcm9ncmVzcyk7CiAgICAgICAgICAgIGRyYXdYICs9IGN1cnJlbnRJbml0aWFsT2Zmc2V0WDsKICAgICAgICAgICAgZHJhd1kgKz0gY3VycmVudEluaXRpYWxPZmZzZXRZOwoKICAgICAgICAgICAgbGV0IGltYWdlRGF0YVRvRHJhdzsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSAidW5jZXJ0YWludHkgZmFjdG9yIjogaGlnaGVzdCBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0cmFuc2l0aW9uCiAgICAgICAgICAgIGNvbnN0IHVuY2VydGFpbnR5RmFjdG9yID0gTWF0aC5hYnMoMC41IC0gc2VnbWVudFByb2dyZXNzKSAqIDI7CiAgICAgICAgICAgIGNvbnN0IGVmZmVjdGl2ZUZsaWNrZXJQcm9iYWJpbGl0eSA9IHNlZ21lbnQuZmxpY2tlclByb2JhYmlsaXR5ICogdW5jZXJ0YWludHlGYWN0b3I7CgogICAgICAgICAgICBpZiAoTWF0aC5yYW5kb20oKSA8IGVmZmVjdGl2ZUZsaWNrZXJQcm9iYWJpbGl0eSkgewogICAgICAgICAgICAgICAgLy8gU3VwZXJwb3NpdGlvbi9GbGlja2VyIFN0YXRlOiBSYW5kb21seSBzaG93IG9uZSBvZiB0aGUgdHdvIGltYWdlIHNlZ21lbnRzCiAgICAgICAgICAgICAgICBpbWFnZURhdGFUb0RyYXcgPSBNYXRoLnJhbmRvbSgpIDwgMC41ID8gc2VnbWVudC5zdGFydEltYWdlRGF0YSA6IHNlZ21lbnQuZW5kSW1hZ2VEYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gQ29sbGFwc2UgU3RhdGU6IFNtb290aGx5IGJsZW5kIHRoZSBwaXhlbCBkYXRhCiAgICAgICAgICAgICAgICBpbWFnZURhdGFUb0RyYXcgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHNlZ21lbnQud2lkdGgsIHNlZ21lbnQuaGVpZ2h0KTsKICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VnbWVudC5zdGFydEltYWdlRGF0YS5kYXRhLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgUiwgRywgQiBjaGFubmVscwogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVRvRHJhdy5kYXRhW2ldID0gTWF0aC5yb3VuZChzZWdtZW50LnN0YXJ0SW1hZ2VEYXRhLmRhdGFbaV0gKyAoc2VnbWVudC5lbmRJbWFnZURhdGEuZGF0YVtpXSAtIHNlZ21lbnQuc3RhcnRJbWFnZURhdGEuZGF0YVtpXSkgKiBzZWdtZW50UHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgIGltYWdlRGF0YVRvRHJhdy5kYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoc2VnbWVudC5zdGFydEltYWdlRGF0YS5kYXRhW2kgKyAxXSArIChzZWdtZW50LmVuZEltYWdlRGF0YS5kYXRhW2kgKyAxXSAtIHNlZ21lbnQuc3RhcnRJbWFnZURhdGEuZGF0YVtpICsgMV0pICogc2VnbWVudFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICBpbWFnZURhdGFUb0RyYXcuZGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKHNlZ21lbnQuc3RhcnRJbWFnZURhdGEuZGF0YVtpICsgMl0gKyAoc2VnbWVudC5lbmRJbWFnZURhdGEuZGF0YVtpICsgMl0gLSBzZWdtZW50LnN0YXJ0SW1hZ2VEYXRhLmRhdGFbaSArIDJdKSAqIHNlZ21lbnRQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgLy8gQWxwaGEgY2hhbm5lbCAoYWx3YXlzIDI1NSBmb3Igc29saWQgc2VnbWVudHMpCiAgICAgICAgICAgICAgICAgICAgaW1hZ2VEYXRhVG9EcmF3LmRhdGFbaSArIDNdID0gMjU1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmF3IHRoZSBzZWdtZW50IGF0IGl0cyBjdXJyZW50IGRpc3BsYWNlZCBwb3NpdGlvbgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YVRvRHJhdywgZHJhd1gsIGRyYXdZKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGN1cnJlbnRGcmFtZWJiIDwgdG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQW5pbWF0aW9uIGlzIGNvbXBsZXRlLgogICAgICAgICAgICAvLyBEcmF3IHRoZSBmaW5hbCBpbWFnZSB0byBlbnN1cmUgYSBjbGVhbiByZXN1bHQKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gVXNlIHRoZSBjb250aW51b3VzIGZyYW1ld29yaydzIHRyYW5zaXRpb24gZnVuY3Rpb24gdG8gc3dhcCBpbWFnZXMgYW5kIGxvYWQgdGhlIG5leHQgb25lCiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIHN0YXJ0TmV4dFRyYW5zaXRpb24oKQogICAgICAgIH0KICAgIH0KCiAgICAvLyBSZXR1cm4gdGhlIHJlcXVpcmVkIGZ1bmN0aW9ucyBmb3IgdGhlIGFuaW1hdGlvbiBmcmFtZXdvcmsKICAgIHJldHVybiB7IHRpdGxlOiAiUXVhbnR1bSBTZWdtZW50YXRpb24gVHJhbnNpdGlvbiAoQU5JTUFUSU9OX0xPR0lDWzBdKSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKQU5JTUFUSU9OX0xPR0lDWzVdID0gKGZ1bmN0aW9uKCkgewogICAgLy8gLS0tIEFuaW1hdGlvbi1zcGVjaWZpYyBzdGF0ZSB2YXJpYWJsZXMgLS0tCiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICBibG9ja3M6IFtdLCAvLyBBcnJheSB0byBzdG9yZSBibG9jayBkYXRhIGFuZCB0aGVpciBhbmltYXRpb24gcHJvcGVydGllcwogICAgICAgIHRvdGFsRnJhbWVzYmI6IDkwLCAvLyBEdXJhdGlvbiBvZiB0aGUgYW5pbWF0aW9uCiAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICB9OwoKICAgIC8vIC0tLSBVdGlsaXR5IEZ1bmN0aW9ucyAoQWRhcHRlZCBmcm9tIG9yaWdpbmFsIHNvdXJjZSBjb2RlKSAtLS0KICAgIC8vIEVhc2luZyBmdW5jdGlvbiBmb3Igc21vb3RoZXIgYW5pbWF0aW9uIGFjY2VsZXJhdGlvbi9kZWNlbGVyYXRpb24KICAgIHZhciBlYXNlSW5PdXRRdWludCA9ICh0KSA9PiB0IDwgMC41ID8gMTYgKiB0ICogdCAqIHQgKiB0ICogdCA6IDEgKyAxNiAqICgtLXQpICogdCAqIHQgKiB0ICogdDsKCiAgICAvKioKICAgICAqIFNldHMgdXAgdGhlIGluaXRpYWwgc3RhdGUgZm9yIHRoZSBibG9jayBhbmltYXRpb24uIChPcmlnaW5hbCBzZXR1cEluaXRpYWxDYW52YXMpCiAgICAgKiBUaGlzIHByZXBhcmVzIGJsb2NrcyB3aXRoIHN0YXJ0L2VuZCBkYXRhIGZvciB0aGUgInVucmVhbCBkeW5hbWljcyIgdHJhbnNpdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBpZiAoIWN1cnJlbnRJbWFnZSB8fCAhbmV4dEltYWdlKSByZXR1cm47CgogICAgICAgIHVuaXF1ZVN0YXRlLmJsb2NrcyA9IFtdOyAvLyBDbGVhciBwcmV2aW91cyBibG9ja3MgZGF0YQogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKCiAgICAgICAgLy8gLS0tIENvcmUgUGFyYW1ldGVycyBmcm9tIFNvdXJjZSAtLS0KICAgICAgICBjb25zdCBibG9ja1NpemUgPSAyMDsgLy8gU2l6ZSBvZiBlYWNoIHNxdWFyZSBibG9jawogICAgICAgIGNvbnN0IG1heE9mZnNldEZhY3RvciA9IDEuNTsgLy8gRmFjdG9yIGZvciBvZmYtc2NyZWVuIHN0YXJ0CiAgICAgICAgY29uc3QgbWF4RGVsYXlGYWN0b3IgPSAwLjQ7IC8vIFN0YWdnZXIgYmxvY2tzIG92ZXIgZmlyc3QgNDAlIG9mIGFuaW1hdGlvbgogICAgICAgIC8vIC0tLQoKICAgICAgICAvLyBBc3N1bWluZyBnbG9iYWwgV0lEVEggYW5kIEhFSUdIVCBhcmUgc2V0IGJ5IHRoZSBmcmFtZXdvcmsKICAgICAgICBjb25zdCBudW1Db2xzID0gTWF0aC5jZWlsKFdJRFRIIC8gYmxvY2tTaXplKTsKICAgICAgICBjb25zdCBudW1Sb3dzID0gTWF0aC5jZWlsKEhFSUdIVCAvIGJsb2NrU2l6ZSk7CiAgICAgICAgY29uc3QgbWF4T2Zmc2V0ID0gTWF0aC5tYXgoV0lEVEgsIEhFSUdIVCkgKiBtYXhPZmZzZXRGYWN0b3I7CgogICAgICAgIC8vIERyYXcgdGhlIGN1cnJlbnQgaW1hZ2UgZnVsbHkgYXQgdGhlIHN0YXJ0IHRvIHByZXZlbnQgYSBibGFuayBmcmFtZQogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIGN0eAoKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IG51bVJvd3M7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IG51bUNvbHM7IHgrKykgewogICAgICAgICAgICAgICAgbGV0IGJsb2NrWCA9IHggKiBibG9ja1NpemU7CiAgICAgICAgICAgICAgICBsZXQgYmxvY2tZID0geSAqIGJsb2NrU2l6ZTsKICAgICAgICAgICAgICAgIGxldCB3aWR0aCA9IE1hdGgubWluKGJsb2NrU2l6ZSwgV0lEVEggLSBibG9ja1gpOwogICAgICAgICAgICAgICAgbGV0IGhlaWdodCA9IE1hdGgubWluKGJsb2NrU2l6ZSwgSEVJR0hUIC0gYmxvY2tZKTsKCiAgICAgICAgICAgICAgICBpZiAod2lkdGggPD0gMCB8fCBoZWlnaHQgPD0gMCkgY29udGludWU7CgogICAgICAgICAgICAgICAgbGV0IGluaXRpYWxYT2Zmc2V0ID0gMDsKICAgICAgICAgICAgICAgIGxldCBpbml0aWFsWU9mZnNldCA9IDA7CiAgICAgICAgICAgICAgICBsZXQgaW5pdGlhbFJvdGF0aW9uID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTWF0aC5QSSAqIDI7CgogICAgICAgICAgICAgICAgLy8gUmFuZG9taXplIGVudHJ5IGRpcmVjdGlvbiAoImt1bmcgZnUgZWZmZWN0IHRoYWkgaW4gZG9lbiIpCiAgICAgICAgICAgICAgICBsZXQgZGlyZWN0aW9uID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNCk7CiAgICAgICAgICAgICAgICBzd2l0Y2goZGlyZWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOiBpbml0aWFsWE9mZnNldCA9IC1tYXhPZmZzZXQ7IGJyZWFrOyAvLyBDb21lIGZyb20gZmFyIGxlZnQKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6IGluaXRpYWxYT2Zmc2V0ID0gbWF4T2Zmc2V0OyBicmVhazsgIC8vIENvbWUgZnJvbSBmYXIgcmlnaHQKICAgICAgICAgICAgICAgICAgICBjYXNlIDI6IGluaXRpYWxZT2Zmc2V0ID0gLW1heE9mZnNldDsgYnJlYWs7IC8vIENvbWUgZnJvbSBmYXIgdG9wCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiBpbml0aWFsWU9mZnNldCA9IG1heE9mZnNldDsgYnJlYWs7ICAvLyBDb21lIGZyb20gZmFyIGJvdHRvbQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIFN0YWdnZXJlZCBlbnRyeSB3aXRoIHJhbmRvbWl6ZWQgZGVsYXkgKCJTdSBUYSBjaGkgdHNpIHRzdSBUaGEiKQogICAgICAgICAgICAgICAgbGV0IGRlbGF5RnJhbWVzID0gTWF0aC5yYW5kb20oKSAqICh1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiICogbWF4RGVsYXlGYWN0b3IpOwoKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmJsb2Nrcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAvLyBTb3VyY2UgcmVjdGFuZ2xlIGZyb20gYG5leHRJbWFnZWAKICAgICAgICAgICAgICAgICAgICBzeDogYmxvY2tYLCBzeTogYmxvY2tZLCBzV2lkdGg6IHdpZHRoLCBzSGVpZ2h0OiBoZWlnaHQsCgogICAgICAgICAgICAgICAgICAgIC8vIERlc3RpbmF0aW9uIHJlY3RhbmdsZSBvbiBjYW52YXMgKGZpbmFsIHBvc2l0aW9uKQogICAgICAgICAgICAgICAgICAgIGRXaWR0aDogd2lkdGgsIGRIZWlnaHQ6IGhlaWdodCwKCiAgICAgICAgICAgICAgICAgICAgLy8gQW5pbWF0aW9uIHN0YXJ0IHByb3BlcnRpZXMKICAgICAgICAgICAgICAgICAgICBzdGFydERYOiBibG9ja1ggKyBpbml0aWFsWE9mZnNldCArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGJsb2NrU2l6ZSAqIDIsIC8vIEFkZCBzbGlnaHQgcmFuZG9tIGppdHRlcgogICAgICAgICAgICAgICAgICAgIHN0YXJ0RFk6IGJsb2NrWSArIGluaXRpYWxZT2Zmc2V0ICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogYmxvY2tTaXplICogMiwKICAgICAgICAgICAgICAgICAgICBzdGFydFJvdGF0aW9uOiBpbml0aWFsUm90YXRpb24sCiAgICAgICAgICAgICAgICAgICAgc3RhcnRBbHBoYTogMCwgLy8gQmxvY2tzIG9mIG5ldyBpbWFnZSBzdGFydCBpbnZpc2libGUKCiAgICAgICAgICAgICAgICAgICAgLy8gQW5pbWF0aW9uIGVuZCBwcm9wZXJ0aWVzCiAgICAgICAgICAgICAgICAgICAgZW5kRFg6IGJsb2NrWCwKICAgICAgICAgICAgICAgICAgICBlbmREWTogYmxvY2tZLAogICAgICAgICAgICAgICAgICAgIGVuZFJvdGF0aW9uOiAwLAogICAgICAgICAgICAgICAgICAgIGVuZEFscGhhOiAxLAoKICAgICAgICAgICAgICAgICAgICBkZWxheTogZGVsYXlGcmFtZXMsCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uRHVyYXRpb246IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIgLSBkZWxheUZyYW1lcwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGUgbWFpbiBhbmltYXRpb24gbG9vcC4gKE9yaWdpbmFsIEFOSU1BVEUpCiAgICAgKiBIYW5kbGVzIHRoZSBmYWRpbmcvZGlzdG9ydGluZyBvZiB0aGUgY3VycmVudCBpbWFnZSBhbmQgdGhlIGVudHJ5IG9mIHRoZSBuZXcgaW1hZ2UncyBibG9ja3MuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgY3VycmVudEZyYW1lYmIgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICBjb25zdCB0b3RhbEZyYW1lc2JiID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKCiAgICAgICAgLy8gQ2xlYXIgdGhlIGVudGlyZSBjYW52YXMKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOyAvLyBBc3N1bWluZyBnbG9iYWwgY3R4LCBXSURUSCwgSEVJR0hUCgogICAgICAgIC8vIC0tLSBQaGFzZSAxOiBDdXJyZW50IGltYWdlIGZhZGUtb3V0ICgiSSBzbW9rZSBUaWxsIEkgU2xpcCIpIC0tLQogICAgICAgIGxldCBmYWRlT3V0UHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChjdXJyZW50RnJhbWViYiAvICh0b3RhbEZyYW1lc2JiICogMC42KSk7CiAgICAgICAgCiAgICAgICAgaWYgKGZhZGVPdXRQcm9ncmVzcyA8IDEpIHsKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgLy8gQWxwaGEgZGVjcmVhc2VzCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IE1hdGgubWF4KDAsIDEgLSBmYWRlT3V0UHJvZ3Jlc3MpOyAKICAgICAgICAgICAgLy8gQXBwbHkgYmx1ciBhbmQgY29sb3Igc2hpZnQgKGZpbHRlciBvbmx5IHdvcmtzIG9uIHN1YnNlcXVlbnQgZHJhd3MgaW4gc29tZSBicm93c2VycywgYnV0IGl0J3MgdGhlIGludGVuZGVkIGVmZmVjdCkKICAgICAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7ZmFkZU91dFByb2dyZXNzICogNX1weCkgaHVlLXJvdGF0ZSgke2ZhZGVPdXRQcm9ncmVzcyAqIDMwfWRlZylgOyAKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIFBoYXNlIDI6IE5leHQgaW1hZ2UgYmxvY2tzIGVudHJ5ICgiUmFobWFuIEt1bmZ1IGVmZmVjdCB0aGFpIGluIGRvZW4iKSAtLS0KICAgICAgICB1bmlxdWVTdGF0ZS5ibG9ja3MuZm9yRWFjaChibG9jayA9PiB7CiAgICAgICAgICAgIGxldCBibG9ja0N1cnJlbnRGcmFtZSA9IGN1cnJlbnRGcmFtZWJiIC0gYmxvY2suZGVsYXk7CiAgICAgICAgICAgIGlmIChibG9ja0N1cnJlbnRGcmFtZSA8IDApIHJldHVybjsKCiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBwcm9ncmVzcyBmb3IgdGhpcyBpbmRpdmlkdWFsIGJsb2NrCiAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IE1hdGgubWluKDEsIGJsb2NrQ3VycmVudEZyYW1lIC8gYmxvY2suYW5pbWF0aW9uRHVyYXRpb24pOwogICAgICAgICAgICBsZXQgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIC8vIEludGVycG9sYXRlIHByb3BlcnRpZXMKICAgICAgICAgICAgbGV0IGR4ID0gYmxvY2suc3RhcnREWCArIChibG9jay5lbmREWCAtIGJsb2NrLnN0YXJ0RFgpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgbGV0IGR5ID0gYmxvY2suc3RhcnREWSArIChibG9jay5lbmREWSAtIGJsb2NrLnN0YXJ0RFkpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgbGV0IHJvdGF0aW9uID0gYmxvY2suc3RhcnRSb3RhdGlvbiArIChibG9jay5lbmRSb3RhdGlvbiAtIGJsb2NrLnN0YXJ0Um90YXRpb24pICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgbGV0IGFscGhhID0gYmxvY2suc3RhcnRBbHBoYSArIChibG9jay5lbmRBbHBoYSAtIGJsb2NrLnN0YXJ0QWxwaGEpICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIGFscGhhKSk7CgogICAgICAgICAgICAvLyBBcHBseSB0cmFuc2Zvcm1hdGlvbnMgKG1vdmUgdG8gY2VudGVyLCByb3RhdGUsIG1vdmUgYmFjaykKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShkeCArIGJsb2NrLmRXaWR0aCAvIDIsIGR5ICsgYmxvY2suZEhlaWdodCAvIDIpOwogICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0aW9uKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgtKGR4ICsgYmxvY2suZFdpZHRoIC8gMiksIC0oZHkgKyBibG9jay5kSGVpZ2h0IC8gMikpOwoKICAgICAgICAgICAgLy8gRHJhdyB0aGUgc2VnbWVudCBvZiB0aGUgbmV4dCBpbWFnZQogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBibG9jay5zeCwgYmxvY2suc3ksIGJsb2NrLnNXaWR0aCwgYmxvY2suc0hlaWdodCwgLy8gU291cmNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgZHgsIGR5LCBibG9jay5kV2lkdGgsIGJsb2NrLmRIZWlnaHQpOyAgICAgICAgICAgIC8vIERlc3RpbmF0aW9uCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfSk7CgogICAgICAgIGlmIChjdXJyZW50RnJhbWViYiA8IHRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiAoQSAtPiBCKSBpcyBjb21wbGV0ZS4KCiAgICAgICAgICAgIC8vIDEuIEVuc3VyZSB0aGUgZmluYWwgaW1hZ2UgKEIpIGlzIGRyYXduIHBlcmZlY3RseSB0byBjb3ZlciBhbGwgYmxvY2sgZWZmZWN0cy4KICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gMi4gVXNlIHRoZSBjb250aW51b3VzIGZyYW1ld29yaydzIHRyYW5zaXRpb24gZnVuY3Rpb24gdG8gaGFuZGxlIGNsZWFudXAsIHN3YXAsIGFuZCBuZXh0IGltYWdlIGxvYWQuCiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsgLy8gQXNzdW1pbmcgZ2xvYmFsIHN0YXJ0TmV4dFRyYW5zaXRpb24oKQogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4geyB0aXRsZTogIlVucmVhbCBEeW5hbWljcyBCbG9jayBUcmFuc2l0aW9uIChBTklNQVRJT05fTE9HSUNbMF0pIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwoKCgoKCgoKQU5JTUFUSU9OX0xPR0lDWzZdID0gKGZ1bmN0aW9uKCkgewogICAgLy8gLS0tIEFuaW1hdGlvbi1zcGVjaWZpYyBzdGF0ZSB2YXJpYWJsZXMgLS0tCiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICB0b3RhbFN0ZXBzOiA1MCwgLy8gVG90YWwgZnJhbWVzIGZvciB0aGUgdHJhbnNpdGlvbiAoMjUgY29tcHJlc3MgKyAyNSBkZWNvbXByZXNzKQogICAgICAgIGN1cnJlbnRTdGVwOiAwLAogICAgICAgIGFuaW1hdGlvbkZyYW1lczogW10sIC8vIFRvIHN0b3JlIHByZS1yZWNvcmRlZCBJbWFnZURhdGEgZnJhbWVzCiAgICAgICAgY2VudGVyWDogMCwKICAgICAgICBjZW50ZXJZOiAwLAogICAgfTsKCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0KCiAgICAvKioKICAgICAqIEdldHMgSW1hZ2VEYXRhIGZyb20gYW4gSFRNTEltYWdlRWxlbWVudC4KICAgICAqLwogICAgZnVuY3Rpb24gZ2V0UGl4ZWxEYXRhKGltYWdlKSB7CiAgICAgICAgLy8gVXNlIGEgdGVtcG9yYXJ5IGNhbnZhcyB0byBnZXQgdGhlIHJhdyBwaXhlbCBkYXRhIGZyb20gdGhlIGltYWdlCiAgICAgICAgY29uc3QgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIHRlbXBDYW52YXMud2lkdGggPSBpbWFnZS5uYXR1cmFsV2lkdGggfHwgMzAwOwogICAgICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gaW1hZ2UubmF0dXJhbEhlaWdodCB8fCAzMDA7CiAgICAgICAgY29uc3QgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShpbWFnZSwgMCwgMCwgdGVtcENhbnZhcy53aWR0aCwgdGVtcENhbnZhcy5oZWlnaHQpOwogICAgICAgIHJldHVybiB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB0ZW1wQ2FudmFzLndpZHRoLCB0ZW1wQ2FudmFzLmhlaWdodCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxjdWxhdGVzIGEgc2luZ2xlIGZyYW1lIG9mIHRoZSBjb21wcmVzc2lvbiBhbmltYXRpb24gYmFzZWQgb24gdGhlIHNvdXJjZSBpbWFnZSBkYXRhLgogICAgICogUGl4ZWxzIG1vdmUgcmFkaWFsbHkgdG93YXJkcyB0aGUgZml4ZWQgY2VudGVyIHBvaW50LCB3ZWlnaHRlZCBieSBicmlnaHRuZXNzLgogICAgICogQHBhcmFtIHtJbWFnZURhdGF9IG9yaWdpbmFsSW1hZ2VEYXRhIC0gVGhlIHNvdXJjZSBwaXhlbCBkYXRhLgogICAgICogQHBhcmFtIHtudW1iZXJ9IHN0ZXAgLSBDdXJyZW50IHN0ZXAgKDAgdG8gdG90YWxQaGFzZVN0ZXBzIC0gMSkuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdG90YWxQaGFzZVN0ZXBzIC0gVG90YWwgc3RlcHMgZm9yIG9uZSBwaGFzZSAoZS5nLiwgMjUpLgogICAgICogQHJldHVybnMge0ltYWdlRGF0YX0gVGhlIG5ldyBJbWFnZURhdGEgb2JqZWN0IGZvciB0aGUgZnJhbWUuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShvcmlnaW5hbEltYWdlRGF0YSwgc3RlcCwgdG90YWxQaGFzZVN0ZXBzKSB7CiAgICAgICAgY29uc3Qgd2lkdGggPSBvcmlnaW5hbEltYWdlRGF0YS53aWR0aDsKICAgICAgICBjb25zdCBoZWlnaHQgPSBvcmlnaW5hbEltYWdlRGF0YS5oZWlnaHQ7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxQaXhlbHMgPSBvcmlnaW5hbEltYWdlRGF0YS5kYXRhOwogICAgICAgIGNvbnN0IG5ld1BpeGVsc0J1ZmZlciA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCAqIGhlaWdodCAqIDQpOwogICAgICAgIAogICAgICAgIC8vIEluaXRpYWxpemUgYnVmZmVyIHdpdGggdHJhbnNwYXJlbnQgcGl4ZWxzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuZXdQaXhlbHNCdWZmZXIubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2kgKyAzXSA9IDA7IC8vIEFscGhhIGNoYW5uZWwgc2V0IHRvIDAgKHRyYW5zcGFyZW50KQogICAgICAgIH0KCiAgICAgICAgY29uc3QgbWF4Q29tcHJlc3Npb25EaXN0YW5jZSA9IHdpZHRoIC8gMi41OyAvLyBNYXggZGlzcGxhY2VtZW50IG1hZ25pdHVkZQogICAgICAgIC8vIFByb2dyZXNzIGZyb20gMCAobm8gY29tcHJlc3Npb24pIHRvIDEgKG1heCBjb21wcmVzc2lvbikKICAgICAgICBjb25zdCBjb21wcmVzc2lvblByb2dyZXNzID0gTWF0aC5taW4oMSwgc3RlcCAvICh0b3RhbFBoYXNlU3RlcHMgLSAxKSk7CgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiB3aWR0aCArIHgpICogNDsKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBvcmlnaW5hbFBpeGVsc1tpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBvcmlnaW5hbFBpeGVsc1tpICsgMV07CiAgICAgICAgICAgICAgICBjb25zdCBiID0gb3JpZ2luYWxQaXhlbHNbaSArIDJdOwogICAgICAgICAgICAgICAgY29uc3QgYSA9IG9yaWdpbmFsUGl4ZWxzW2kgKyAzXTsKCiAgICAgICAgICAgICAgICBjb25zdCBhdmdDb2xvciA9IChyICsgZyArIGIpIC8gMzsKICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRBdmdDb2xvciA9IGF2Z0NvbG9yIC8gMjU1OwoKICAgICAgICAgICAgICAgIC8vIDEuIFZlY3RvciBmcm9tIHRoZSBwaXhlbCAoeCwgeSkgdG8gdGhlIGNlbnRlcgogICAgICAgICAgICAgICAgY29uc3QgZHggPSB1bmlxdWVTdGF0ZS5jZW50ZXJYIC0geDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0gdW5pcXVlU3RhdGUuY2VudGVyWSAtIHk7CgogICAgICAgICAgICAgICAgLy8gMi4gRGlzdGFuY2UgZnJvbSBjZW50ZXIKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKCiAgICAgICAgICAgICAgICAvLyAzLiBOb3JtYWxpc2UgdGhlIHZlY3RvciAoZGlyZWN0aW9uKQogICAgICAgICAgICAgICAgbGV0IGRpclggPSAwOwogICAgICAgICAgICAgICAgbGV0IGRpclkgPSAwOwogICAgICAgICAgICAgICAgaWYgKGRpc3RhbmNlID4gMCkgewogICAgICAgICAgICAgICAgICAgIGRpclggPSBkeCAvIGRpc3RhbmNlOwogICAgICAgICAgICAgICAgICAgIGRpclkgPSBkeSAvIGRpc3RhbmNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIDQuIENhbGN1bGF0ZSBtb3ZlbWVudCBtYWduaXR1ZGUgKGJyaWdodGVyIHBpeGVscyBtb3ZlIG1vcmUpCiAgICAgICAgICAgICAgICBsZXQgbW92ZW1lbnRNYWduaXR1ZGUgPSBub3JtYWxpemVkQXZnQ29sb3IgKiBtYXhDb21wcmVzc2lvbkRpc3RhbmNlICogY29tcHJlc3Npb25Qcm9ncmVzczsKCiAgICAgICAgICAgICAgICAvLyA1LiBBcHBseSB0aGUgbW92ZW1lbnQgKGRpcmVjdGlvbiB0b3dhcmRzIHRoZSBjZW50ZXIpCiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlWCA9IGRpclggKiBtb3ZlbWVudE1hZ25pdHVkZTsKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVZID0gZGlyWSAqIG1vdmVtZW50TWFnbml0dWRlOwoKICAgICAgICAgICAgICAgIC8vIE5ldyBwb3NpdGlvbgogICAgICAgICAgICAgICAgbGV0IG5ld1ggPSB4ICsgbW92ZVg7CiAgICAgICAgICAgICAgICBsZXQgbmV3WSA9IHkgKyBtb3ZlWTsKCiAgICAgICAgICAgICAgICAvLyBDbGFtcCBhbmQgcm91bmQgb2ZmIG5ldyBwb3NpdGlvbgogICAgICAgICAgICAgICAgbmV3WCA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgTWF0aC5taW4od2lkdGggLSAxLCBuZXdYKSkpOwogICAgICAgICAgICAgICAgbmV3WSA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgTWF0aC5taW4oaGVpZ2h0IC0gMSwgbmV3WSkpKTsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGRlc3RpbmF0aW9uIGluZGV4IGluIHRoZSBidWZmZXIKICAgICAgICAgICAgICAgIGNvbnN0IGRlc3RJbmRleCA9IChuZXdZICogd2lkdGggKyBuZXdYKSAqIDQ7CgogICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgcGl4ZWwgY29sb3IgdG8gdGhlIG5ldyBwb3NpdGlvbiBpbiB0aGUgbmV3IGJ1ZmZlcgogICAgICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2Rlc3RJbmRleF0gPSByOwogICAgICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2Rlc3RJbmRleCArIDFdID0gZzsKICAgICAgICAgICAgICAgIG5ld1BpeGVsc0J1ZmZlcltkZXN0SW5kZXggKyAyXSA9IGI7CiAgICAgICAgICAgICAgICBuZXdQaXhlbHNCdWZmZXJbZGVzdEluZGV4ICsgM10gPSBhOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBDcmVhdGUgYSBuZXcgSW1hZ2VEYXRhIG9iamVjdCBmcm9tIHRoZSBidWZmZXIKICAgICAgICBjb25zdCBuZXdJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBoZWlnaHQpOyAvLyBBc3N1bWluZyBnbG9iYWwgY3R4CiAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGEuc2V0KG5ld1BpeGVsc0J1ZmZlcik7CiAgICAgICAgcmV0dXJuIG5ld0ltYWdlRGF0YTsKICAgIH0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemVzIHRoZSBhbmltYXRpb246IHNldHMgdXAgdGhlIGNlbnRlciBwb2ludCBhbmQgcHJlLXJlY29yZHMgYWxsIGZyYW1lcy4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBpZiAoIWN1cnJlbnRJbWFnZSB8fCAhbmV4dEltYWdlKSByZXR1cm47CgogICAgICAgIHVuaXF1ZVN0YXRlLmFuaW1hdGlvbkZyYW1lcyA9IFtdOwogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRTdGVwID0gMDsKCiAgICAgICAgLy8gLS0tIENvcmUgUGFyYW1ldGVycyAtLS0KICAgICAgICAvLyBHZXQgYWN0dWFsIHBpeGVsIGRpbWVuc2lvbnMgKGRlZmF1bHRzIHRvIDMwMHgzMDAgZnJvbSBvcmlnaW5hbCBjb2RlKQogICAgICAgIGNvbnN0IGltYWdlV2lkdGggPSBjdXJyZW50SW1hZ2UubmF0dXJhbFdpZHRoIHx8IDMwMDsKICAgICAgICBjb25zdCBpbWFnZUhlaWdodCA9IGN1cnJlbnRJbWFnZS5uYXR1cmFsSGVpZ2h0IHx8IDMwMDsKICAgICAgICBjb25zdCBoYWxmU3RlcHMgPSB1bmlxdWVTdGF0ZS50b3RhbFN0ZXBzIC8gMjsgLy8gMjUgc3RlcHMgcGVyIHBoYXNlCgogICAgICAgIC8vIERldGVybWluZSB0aGUgcmFuZG9tIGNlbnRyYWwgcG9pbnQgKHJhbmRvbSBvZmZzZXQgZnJvbSBjZW50ZXIpCiAgICAgICAgY29uc3QgY2VudGVyT2Zmc2V0WCA9IGltYWdlV2lkdGggKiAwLjU7CiAgICAgICAgY29uc3QgY2VudGVyT2Zmc2V0WSA9IGltYWdlSGVpZ2h0ICogMC41OwogICAgICAgIGNvbnN0IHJhbmRvbU9mZnNldFggPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBpbWFnZVdpZHRoICogMC40OwogICAgICAgIGNvbnN0IHJhbmRvbU9mZnNldFkgPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBpbWFnZUhlaWdodCAqIDAuNDsKICAgICAgICB1bmlxdWVTdGF0ZS5jZW50ZXJYID0gTWF0aC5yb3VuZChjZW50ZXJPZmZzZXRYICsgcmFuZG9tT2Zmc2V0WCk7CiAgICAgICAgdW5pcXVlU3RhdGUuY2VudGVyWSA9IE1hdGgucm91bmQoY2VudGVyT2Zmc2V0WSArIHJhbmRvbU9mZnNldFkpOwoKICAgICAgICAvLyBHZXQgaW5pdGlhbCBJbWFnZURhdGEgZm9yIGJvdGggc291cmNlIGltYWdlcwogICAgICAgIGNvbnN0IGltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsgLy8gQ3VycmVudCBJbWFnZSAoQSkgZm9yIGNvbXByZXNzaW9uL2Rpc2FwcGVhcmFuY2UKICAgICAgICBjb25zdCBpbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7ICAgIC8vIE5leHQgSW1hZ2UgKEIpIGZvciBkZWNvbXByZXNzaW9uL2FwcGVhcmFuY2UKCiAgICAgICAgLy8gUGhhc2UgMTogQ29tcHJlc3Npb24gKEltYWdlIEEgRGlzYXBwZWFycykKICAgICAgICBmb3IgKGxldCBzdGVwID0gMDsgc3RlcCA8IGhhbGZTdGVwczsgc3RlcCsrKSB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBmcmFtZSBvZiBBIENPTVBSRVNTSU5HIChzdGVwIGZyb20gMCB0byAyNCkKICAgICAgICAgICAgY29uc3QgZnJhbWVEYXRhQSA9IGNhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShpbWFnZURhdGFBLCBzdGVwLCBoYWxmU3RlcHMpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5hbmltYXRpb25GcmFtZXMucHVzaChmcmFtZURhdGFBKTsKICAgICAgICB9CgogICAgICAgIC8vIFBoYXNlIDI6IERlY29tcHJlc3Npb24gKEltYWdlIEIgQXBwZWFycykKICAgICAgICBjb25zdCBjb21wcmVzc2VkU3RhdGVzQiA9IFtdOwogICAgICAgIGZvciAobGV0IHN0ZXAgPSAwOyBzdGVwIDwgaGFsZlN0ZXBzOyBzdGVwKyspIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGFsbCBDT01QUkVTU0VEIHN0YXRlcyBvZiBCIChzdGVwIGZyb20gMCB0byAyNCkKICAgICAgICAgICAgY29uc3QgZnJhbWVEYXRhQiA9IGNhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShpbWFnZURhdGFCLCBzdGVwLCBoYWxmU3RlcHMpOwogICAgICAgICAgICBjb21wcmVzc2VkU3RhdGVzQi5wdXNoKGZyYW1lRGF0YUIpOwogICAgICAgIH0KICAgICAgICAvLyBBZGQgdGhlIFJFVkVSU0Ugc2VxdWVuY2Ugb2YgQidzIGNvbXByZXNzZWQgc3RhdGVzIHRvIGNyZWF0ZSB0aGUgREVDT01QUkVTU0lPTiBlZmZlY3QKICAgICAgICBmb3IgKGxldCBpID0gY29tcHJlc3NlZFN0YXRlc0IubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuYW5pbWF0aW9uRnJhbWVzLnB1c2goY29tcHJlc3NlZFN0YXRlc0JbaV0pOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiBEcmF3cyB0aGUgcHJlLXJlY29yZGVkIGZyYW1lLgogICAgICovCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50U3RlcCA8IHVuaXF1ZVN0YXRlLnRvdGFsU3RlcHMpIHsKICAgICAgICAgICAgY29uc3QgZnJhbWVEYXRhID0gdW5pcXVlU3RhdGUuYW5pbWF0aW9uRnJhbWVzW3VuaXF1ZVN0YXRlLmN1cnJlbnRTdGVwXTsKCiAgICAgICAgICAgIGlmIChmcmFtZURhdGEpIHsKICAgICAgICAgICAgICAgIC8vIFRoZSBmcmFtZSBkYXRhIGlzIGJhc2VkIG9uIGltYWdlIGRpbWVuc2lvbnMgKGUuZy4sIDMwMHgzMDApLgogICAgICAgICAgICAgICAgLy8gcHV0SW1hZ2VEYXRhIGRyYXdzIHRoZSBkYXRhIGF0IHRoZSB0b3AgbGVmdCAoMCwgMCkuCiAgICAgICAgICAgICAgICAvLyBXZSBkcmF3IGl0IG92ZXIgdGhlIGVudGlyZSBjYW52YXMgKFdJRFRILCBIRUlHSFQpIGZvciBzY2FsaW5nLCB3aGljaCByZXF1aXJlcwogICAgICAgICAgICAgICAgLy8gbWFudWFsbHkgZHJhd2luZyB0aGUgSW1hZ2VEYXRhIHRvIGEgdGVtcG9yYXJ5IGNhbnZhcyBhbmQgdGhlbiBkcmF3aW5nIHRoYXQgY2FudmFzLgogICAgICAgICAgICAgICAgLy8gSG93ZXZlciwgc2luY2UgdGhlIG9yaWdpbmFsIGNvZGUgdXNlcyBwdXRJbWFnZURhdGEsIHdlJ2xsIHVzZSBpdCBkaXJlY3RseSwKICAgICAgICAgICAgICAgIC8vIHRydXN0aW5nIHRoZSBmcmFtZXdvcmsgb3IgdGhlIG9yaWdpbmFsIGltcGxlbWVudGF0aW9uIGhhbmRsZXMgdGhlIHNjYWxpbmcvcG9zaXRpb25pbmcuCgogICAgICAgICAgICAgICAgLy8gRmFsbGJhY2s6IENsZWFyIGFuZCBEcmF3IHdpdGggcHV0SW1hZ2VEYXRhCiAgICAgICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgLy8gRHJhdyB0aGUgcHJlLWNhbGN1bGF0ZWQgZnJhbWUgYXQgKDAsIDApCiAgICAgICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGZyYW1lRGF0YSwgMCwgMCk7IAogICAgICAgICAgICB9CgogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50U3RlcCsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gQW5pbWF0aW9uIGlzIGNvbXBsZXRlLiBFbnN1cmUgdGhlIGZpbmFsIGltYWdlIChCKSBpcyBmdWxseSBkcmF3bi4KICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSGFuZCBvZmYgY29udHJvbCB0byB0aGUgY29udGludW91cyBmcmFtZXdvcmsncyByZXNldCBsb2dpYy4KICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4geyB0aXRsZTogIlBpeGVsIEZsb3cgVHJhbnNpdGlvbiAoQU5JTUFUSU9OX0xPR0lDWzFdKSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKCkFOSU1BVElPTl9MT0dJQ1s3XSA9IChmdW5jdGlvbigpIHsKICAgIC8vIC0tLSBDb25zdGFudHMgZGVyaXZlZCBmcm9tIHRoZSBvcmlnaW5hbCBzb3VyY2UgY29kZSdzIGludGVybmFsIGxvZ2ljIC0tLQogICAgLy8gVGhlIG9yaWdpbmFsIGNvZGUgcGVyZm9ybXMgcGl4ZWwtYnktcGl4ZWwgY2FsY3VsYXRpb25zIG9uIGEgMzUweDI0MCBhcmVhLgoKICAgIGNvbnN0IFRPVEFMX0ZSQU1FUyA9IDYwOyAvLyBDb3JyZXNwb25kcyB0byAndG90YWxGcmFtZXNiYicgZm9yIGFuaW1hdGlvbiBkdXJhdGlvbgogICAgLy8gVGhlIHNpemUgb2YgdGhlIHRyYW5zaXRpb24gYmFuZCByZWxhdGl2ZSB0byB0aGUgdG90YWwgYW5pbWF0aW9uIHRpbWUuCiAgICBjb25zdCBUUkFOU0lUSU9OX1dJTkRPVyA9IDAuNTsgCgogICAgLy8gLS0tIEFuaW1hdGlvbi1zcGVjaWZpYyBzdGF0ZSB2YXJpYWJsZXMgLS0tCiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgY2VudGVyWDogV0lEVEggLyAyLAogICAgICAgIGNlbnRlclk6IEhFSUdIVCAvIDIsCiAgICAgICAgbWF4RGlzdGFuY2U6IDAsCiAgICAgICAgcGl4ZWxzRGF0YTogW10sIC8vIFN0b3JlcyB7eCwgeSwgc3RhcnRDb2xvciwgZW5kQ29sb3IsIHJpbmdQb3NpdGlvbn0KICAgICAgICBpbWFnZURhdGE6IG51bGwsIC8vIFRoZSBJbWFnZURhdGEgb2JqZWN0IGZvciB0aGUgY3VycmVudCBmcmFtZQogICAgICAgIGRhdGFCdWZmZXI6IG51bGwgLy8gQXJyYXlCdWZmZXIgdG8gaG9sZCB0aGUgbWFuaXB1bGF0ZWQgcGl4ZWwgZGF0YQogICAgfTsKCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAtLS0KCiAgICAvKiogQ29udmVydHMgUkdCQSBkYXRhIGFycmF5ICgwLTI1NSkgdG8gYSBjb2xvciBvYmplY3QgKEEgaXMgMC0xKS4gKi8KICAgIGNvbnN0IGdldERhdGFDb2xvciA9IChkYXRhLCBpbmRleCkgPT4gewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHI6IGRhdGFbaW5kZXhdLAogICAgICAgICAgICBnOiBkYXRhW2luZGV4ICsgMV0sCiAgICAgICAgICAgIGI6IGRhdGFbaW5kZXggKyAyXSwKICAgICAgICAgICAgYTogZGF0YVtpbmRleCArIDNdIC8gMjU1CiAgICAgICAgfTsKICAgIH07CgogICAgLyoqIEludGVycG9sYXRlcyBiZXR3ZWVuIHR3byBjb2xvciBvYmplY3RzIChpbiBSR0JBIDAtMjU1IGZvcm1hdCkuICovCiAgICBjb25zdCBpbnRlcnBvbGF0ZUNvbG9yID0gKGMxLCBjMiwgcHJvZ3Jlc3MpID0+IHsKICAgICAgICBjb25zdCByID0gTWF0aC5yb3VuZChjMS5yICsgKGMyLnIgLSBjMS5yKSAqIHByb2dyZXNzKTsKICAgICAgICBjb25zdCBnID0gTWF0aC5yb3VuZChjMS5nICsgKGMyLmcgLSBjMS5nKSAqIHByb2dyZXNzKTsKICAgICAgICBjb25zdCBiID0gTWF0aC5yb3VuZChjMS5iICsgKGMyLmIgLSBjMS5iKSAqIHByb2dyZXNzKTsKICAgICAgICBjb25zdCBhID0gYzEuYSArIChjMi5hIC0gYzEuYSkgKiBwcm9ncmVzczsgLy8gQWxwaGEgaXMgYSBmbG9hdCAoMC0xKQogICAgICAgIHJldHVybiB7ciwgZywgYiwgYX07CiAgICB9OwoKICAgIC8qKiBFYXNpbmcgZnVuY3Rpb24gKGVhc2VJbk91dFF1aW50KSBmcm9tIHRoZSBzb3VyY2UgY29kZS4gKi8KICAgIGNvbnN0IGVhc2VJbk91dFF1aW50ID0gKHQpID0+IHQgPCAwLjUgPyAxNiAqIHQgKiB0ICogdCAqIHQgKiB0IDogMSArIDE2ICogKC0tdCkgKiB0ICogdCAqIHQgKiB0OwoKICAgIC8vIC0tLSBDb3JlIEZ1bmN0aW9ucyAtLS0KCiAgICAvKioKICAgICAqIEluaXRpYWxpemVzIHRoZSBwaXhlbCBkYXRhIGFycmF5IGZvciB0aGUgdHJhbnNpdGlvbi4KICAgICAqLwogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICBpZiAoIWN1cnJlbnRJbWFnZSB8fCAhbmV4dEltYWdlIHx8ICFjdHgpIHJldHVybjsKCiAgICAgICAgLy8gUmVzZXQgc3RhdGUKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVsc0RhdGEgPSBbXTsKICAgICAgICB1bmlxdWVTdGF0ZS5tYXhEaXN0YW5jZSA9IE1hdGguc3FydCgKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY2VudGVyWCAqIHVuaXF1ZVN0YXRlLmNlbnRlclggKwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jZW50ZXJZICogdW5pcXVlU3RhdGUuY2VudGVyWQogICAgICAgICk7CgogICAgICAgIC8vIDEuIEdldCBpbml0aWFsIHBpeGVsIGRhdGEgZnJvbSBib3RoIGltYWdlcyAoQSBhbmQgQikKICAgICAgICBjb25zdCB0ZW1wQ2FudmFzMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGNvbnN0IHRlbXBDdHgxID0gdGVtcENhbnZhczEuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ2FudmFzMS53aWR0aCA9IFdJRFRIOwogICAgICAgIHRlbXBDYW52YXMxLmhlaWdodCA9IEhFSUdIVDsKICAgICAgICB0ZW1wQ3R4MS5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjb25zdCBkYXRhMSA9IHRlbXBDdHgxLmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwoKICAgICAgICBjb25zdCB0ZW1wQ2FudmFzMiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGNvbnN0IHRlbXBDdHgyID0gdGVtcENhbnZhczIuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ2FudmFzMi53aWR0aCA9IFdJRFRIOwogICAgICAgIHRlbXBDYW52YXMyLmhlaWdodCA9IEhFSUdIVDsKICAgICAgICB0ZW1wQ3R4Mi5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjb25zdCBkYXRhMiA9IHRlbXBDdHgyLmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwoKICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBtYXN0ZXIgSW1hZ2VEYXRhIG9iamVjdCBmb3IgZWZmaWNpZW50IGRyYXdpbmcKICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgIHVuaXF1ZVN0YXRlLmRhdGFCdWZmZXIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGEuZGF0YTsKCiAgICAgICAgLy8gMi4gUG9wdWxhdGUgdGhlIHBpeGVsc0RhdGEgYXJyYXkgd2l0aCBtb3JwaGluZyBwYXJhbWV0ZXJzCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gKHkgKiBXSURUSCArIHgpICogNDsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgbm9ybWFsaXplZCBkaXN0YW5jZSBmcm9tIGNlbnRlciAoMCB0byAxKQogICAgICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gdW5pcXVlU3RhdGUuY2VudGVyWDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIHVuaXF1ZVN0YXRlLmNlbnRlclk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgICAgICAgIGNvbnN0IG5vcm1hbGl6ZWREaXN0YW5jZSA9IGRpc3QgLyB1bmlxdWVTdGF0ZS5tYXhEaXN0YW5jZTsgLy8gcmluZ1Bvc2l0aW9uCgogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxzRGF0YS5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB4OiB4LAogICAgICAgICAgICAgICAgICAgIHk6IHksCiAgICAgICAgICAgICAgICAgICAgc3RhcnRDb2xvcjogZ2V0RGF0YUNvbG9yKGRhdGExLCBpbmRleCksCiAgICAgICAgICAgICAgICAgICAgZW5kQ29sb3I6IGdldERhdGFDb2xvcihkYXRhMiwgaW5kZXgpLAogICAgICAgICAgICAgICAgICAgIHJpbmdQb3NpdGlvbjogbm9ybWFsaXplZERpc3RhbmNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gMy4gRHJhdyB0aGUgc3RhcnQgaW1hZ2UgKEEpIGltbWVkaWF0ZWx5IHRvIHRoZSBjYW52YXMgdG8gY292ZXIgdGhlIHdob2xlIGRpc3BsYXkgYXJlYQogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AuIFJlbmRlcnMgb25lIGZyYW1lLgogICAgICovCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCBUT1RBTF9GUkFNRVMpIHsKICAgICAgICAgICAgLy8gMS4gQ2FsY3VsYXRlIHRoZSBvdmVyYWxsIHByb2dyZXNzIGZvciB0aGUgZnJhbWUgKDAgdG8gMSkgd2l0aCBlYXNpbmcKICAgICAgICAgICAgY29uc3Qgb3ZlcmFsbFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gVE9UQUxfRlJBTUVTKTsKCiAgICAgICAgICAgIC8vIDIuIEl0ZXJhdGUgdGhyb3VnaCBhbGwgcGl4ZWxzIGFuZCBjYWxjdWxhdGUgdGhlIGludGVycG9sYXRlZCBjb2xvcgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVuaXF1ZVN0YXRlLnBpeGVsc0RhdGEubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHAgPSB1bmlxdWVTdGF0ZS5waXhlbHNEYXRhW2ldOwogICAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSAocC55ICogV0lEVEggKyBwLngpICogNDsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgaW5kaXZpZHVhbCBwaXhlbCBwcm9ncmVzcyAoMCB0byAxKSB3aXRoaW4gaXRzIHRyYW5zaXRpb24gd2luZG93CiAgICAgICAgICAgICAgICAvLyBPdXRlciByaW5ncyAocmluZ1Bvc2l0aW9uIG5lYXIgMSkgc3RhcnQgbmVhciBvdmVyYWxsUHJvZ3Jlc3MgMC4KICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0UHJvZ3Jlc3MgPSBwLnJpbmdQb3NpdGlvbiAqIFRSQU5TSVRJT05fV0lORE9XOwogICAgICAgICAgICAgICAgbGV0IHBpeGVsUHJvZ3Jlc3MgPSBNYXRoLm1heCgKICAgICAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgICAgIE1hdGgubWluKDEsIChvdmVyYWxsUHJvZ3Jlc3MgLSBzdGFydFByb2dyZXNzKSAvIFRSQU5TSVRJT05fV0lORE9XKQogICAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBjb2xvciBmcm9tIEEgdG8gQgogICAgICAgICAgICAgICAgY29uc3QgY29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHAuc3RhcnRDb2xvciwgcC5lbmRDb2xvciwgcGl4ZWxQcm9ncmVzcyk7CgogICAgICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSBJbWFnZURhdGEgYnVmZmVyIChpbiBSR0JBIDAtMjU1IGZvcm1hdCkKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmRhdGFCdWZmZXJbaW5kZXhdID0gY29sb3IucjsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmRhdGFCdWZmZXJbaW5kZXggKyAxXSA9IGNvbG9yLmc7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5kYXRhQnVmZmVyW2luZGV4ICsgMl0gPSBjb2xvci5iOwogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuZGF0YUJ1ZmZlcltpbmRleCArIDNdID0gTWF0aC5yb3VuZChjb2xvci5hICogMjU1KTsgLy8gQWxwaGEgKDAtMjU1KQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyAzLiBEcmF3IHRoZSBtYW5pcHVsYXRlZCBJbWFnZURhdGEgYnVmZmVyIHRvIHRoZSBtYWluIGNhbnZhcywgc2NhbGluZyB0byB0aGUgZGlzcGxheSBzaXplIChXSURUSCwgSEVJR0hUKS4KICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YSh1bmlxdWVTdGF0ZS5pbWFnZURhdGEsIDAsIDAsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIC8vIFVzZSB0aGUgZnJhbWV3b3JrJ3MgZ2xvYmFsIHJlcXVlc3RBbmltYXRpb25GcmFtZQogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEFuaW1hdGlvbiBpcyBjb21wbGV0ZS4gQ2FsbCB0aGUgZnJhbWV3b3JrJ3MgY29tcGxldGlvbiBoYW5kbGVyLgogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiB7CiAgICAgICAgdGl0bGU6ICJSYWRpYWwgUmluZyBNb3JwaCBUcmFuc2l0aW9uIiwKICAgICAgICBpbml0OiBpbml0LAogICAgICAgIGFuaW1hdGU6IGFuaW1hdGUKICAgIH07Cn0pKCk7CgoKCgoKCgoKCgoKQU5JTUFUSU9OX0xPR0lDWzhdID0gKGZ1bmN0aW9uKCkgewogICAgLy8gLS0tIENvbnN0YW50cyBkZXJpdmVkIGZyb20gdGhlIG9yaWdpbmFsIHNvdXJjZSBjb2RlIC0tLQogICAgY29uc3QgUElYRUxfQkxPQ0tfU0laRSA9IDQ7CiAgICBjb25zdCBUT1RBTF9GUkFNRVMgPSAxODA7IC8vIENvcnJlc3BvbmRzIHRvICd0b3RhbEZyYW1lc2JiJwogICAgY29uc3QgVE9UQUxfUk9UQVRJT05TID0gTWF0aC5QSSAqIDY7IC8vIFN3aXJscyA2IGZ1bGwgcm90YXRpb25zCgogICAgLy8gLS0tIEFuaW1hdGlvbi1zcGVjaWZpYyBzdGF0ZSB2YXJpYWJsZXMgLS0tCiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgcGl4ZWxzRGF0YTogW10sIC8vIFN0b3JlcyBkYXRhIGZvciBlYWNoIGFuaW1hdGluZyBwaXhlbCBibG9jawogICAgICAgIHZvcnRleFg6IDAsCiAgICAgICAgdm9ydGV4WTogMAogICAgfTsKCiAgICAvLyAtLS0gSGVscGVyIEZ1bmN0aW9ucyAoYWRhcHRlZCBmb3Igc3RhbmRhbG9uZSB1c2UpIC0tLQoKICAgIC8vIFBhcnNlcyBhbiByZ2JhIHN0cmluZyBpbnRvIGFuIG9iamVjdCB7ciwgZywgYiwgYX0KICAgIGNvbnN0IHBhcnNlUkdCQSA9IChyZ2JhU3RyaW5nKSA9PiB7CiAgICAgICAgY29uc3QgcGFydHMgPSByZ2JhU3RyaW5nLm1hdGNoKC9cZCsoXC5cZCspPy9nKS5tYXAoTnVtYmVyKTsKICAgICAgICByZXR1cm4geyByOiBwYXJ0c1swXSwgZzogcGFydHNbMV0sIGI6IHBhcnRzWzJdLCBhOiBwYXJ0c1szXSB8fCAxIH07CiAgICB9OwoKICAgIC8vIEludGVycG9sYXRlcyBiZXR3ZWVuIHR3byBjb2xvciBzdHJpbmdzIGFuZCByZXR1cm5zIGEgbmV3IHJnYmEgc3RyaW5nCiAgICBjb25zdCBpbnRlcnBvbGF0ZUNvbG9yID0gKGNvbG9yMSwgY29sb3IyLCBwcm9ncmVzcykgPT4gewogICAgICAgIGNvbnN0IGMxID0gcGFyc2VSR0JBKGNvbG9yMSk7CiAgICAgICAgY29uc3QgYzIgPSBwYXJzZVJHQkEoY29sb3IyKTsKICAgICAgICBjb25zdCByID0gTWF0aC5yb3VuZChjMS5yICsgKGMyLnIgLSBjMS5yKSAqIHByb2dyZXNzKTsKICAgICAgICBjb25zdCBnID0gTWF0aC5yb3VuZChjMS5nICsgKGMyLmcgLSBjMS5nKSAqIHByb2dyZXNzKTsKICAgICAgICBjb25zdCBiID0gTWF0aC5yb3VuZChjMS5iICsgKGMyLmIgLSBjMS5iKSAqIHByb2dyZXNzKTsKICAgICAgICBjb25zdCBhID0gYzEuYSArIChjMi5hIC0gYzEuYSkgKiBwcm9ncmVzczsKICAgICAgICByZXR1cm4gYHJnYmEoJHtyfSwgJHtnfSwgJHtifSwgJHthfSlgOwogICAgfTsKCiAgICAvLyBFYXNpbmcgZnVuY3Rpb24gKGVhc2VJbk91dFF1aW50KSBmcm9tIHRoZSBzb3VyY2UgY29kZQogICAgY29uc3QgZWFzZUluT3V0UXVpbnQgPSAodCkgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7CgogICAgLy8gLS0tIENvcmUgRnVuY3Rpb25zIC0tLQoKICAgIC8qKgogICAgICogSW5pdGlhbGl6ZXMgdGhlIHBpeGVsIGRhdGEgYXJyYXkgZm9yIHRoZSB0cmFuc2l0aW9uIChyZXBsYWNlcyBzZXR1cEluaXRpYWxDYW52YXMpLgogICAgICogUG9wdWxhdGVzIHVuaXF1ZVN0YXRlLnBpeGVsc0RhdGEuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgaWYgKCFjdXJyZW50SW1hZ2UgfHwgIW5leHRJbWFnZSB8fCAhY3R4KSByZXR1cm47CgogICAgICAgIC8vIFJlc2V0IHN0YXRlCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHNEYXRhID0gW107CgogICAgICAgIC8vIDEuIERyYXcgYm90aCBpbWFnZXMgb2ZmLXNjcmVlbiB0byBnZXQgcGl4ZWwgZGF0YQogICAgICAgIC8vIFVzZSBhbiBvZmYtc2NyZWVuIGNhbnZhcyB0byBleHRyYWN0IHBpeGVsIGRhdGEgd2l0aG91dCBhZmZlY3RpbmcgdGhlIGRpc3BsYXkgY2FudmFzIChjdHgpCiAgICAgICAgY29uc3QgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgIGNvbnN0IHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgdGVtcENhbnZhcy53aWR0aCA9IFdJRFRIOwogICAgICAgIHRlbXBDYW52YXMuaGVpZ2h0ID0gSEVJR0hUOwoKICAgICAgICAvLyBHZXQgcGl4ZWwgZGF0YSBmcm9tIEltYWdlIEEKICAgICAgICB0ZW1wQ3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgIGNvbnN0IGRhdGExID0gdGVtcEN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCkuZGF0YTsKCiAgICAgICAgLy8gR2V0IHBpeGVsIGRhdGEgZnJvbSBJbWFnZSBCCiAgICAgICAgdGVtcEN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjb25zdCBkYXRhMiA9IHRlbXBDdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIFdJRFRILCBIRUlHSFQpLmRhdGE7CgogICAgICAgIC8vIDIuIFJhbmRvbWx5IGNob29zZSB0aGUgdm9ydGV4IGNlbnRlciBmb3IgdGhpcyB0cmFuc2l0aW9uCiAgICAgICAgdW5pcXVlU3RhdGUudm9ydGV4WCA9IFdJRFRIIC8gMiArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIFdJRFRIICogMC40OwogICAgICAgIHVuaXF1ZVN0YXRlLnZvcnRleFkgPSBIRUlHSFQgLyAyICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogSEVJR0hUICogMC40OwoKICAgICAgICAvLyAzLiBQb3B1bGF0ZSBwaXhlbHNEYXRhIGFycmF5IChvbmUgZW50cnkgcGVyIGJsb2NrKQogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IFBJWEVMX0JMT0NLX1NJWkUpIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBQSVhFTF9CTE9DS19TSVpFKSB7CiAgICAgICAgICAgICAgICBsZXQgcjEgPSAwLCBnMSA9IDAsIGIxID0gMCwgYTEgPSAwOwogICAgICAgICAgICAgICAgbGV0IHIyID0gMCwgZzIgPSAwLCBiMiA9IDAsIGEyID0gMDsKICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IDA7CgogICAgICAgICAgICAgICAgLy8gQXZlcmFnZSBwaXhlbCBkYXRhIGZvciB0aGUgYmxvY2sKICAgICAgICAgICAgICAgIGZvciAobGV0IHN5ID0gMDsgc3kgPCBQSVhFTF9CTE9DS19TSVpFICYmICh5ICsgc3kpIDwgSEVJR0hUOyBzeSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgc3ggPSAwOyBzeCA8IFBJWEVMX0JMT0NLX1NJWkUgJiYgKHggKyBzeCkgPCBXSURUSDsgc3grKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9ICgoeSArIHN5KSAqIFdJRFRIICsgKHggKyBzeCkpICogNDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ICsgMyA8IGRhdGExLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcjEgKz0gZGF0YTFbaW5kZXhdOyBnMSArPSBkYXRhMVtpbmRleCArIDFdOyBiMSArPSBkYXRhMVtpbmRleCArIDJdOyBhMSArPSBkYXRhMVtpbmRleCArIDNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcjIgKz0gZGF0YTJbaW5kZXhdOyBnMiArPSBkYXRhMltpbmRleCArIDFdOyBiMiArPSBkYXRhMltpbmRleCArIDJdOyBhMiArPSBkYXRhMltpbmRleCArIDNdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb3VudCA9PT0gMCkgY29udGludWU7CgogICAgICAgICAgICAgICAgcjEgLz0gY291bnQ7IGcxIC89IGNvdW50OyBiMSAvPSBjb3VudDsgYTEgLz0gY291bnQ7CiAgICAgICAgICAgICAgICByMiAvPSBjb3VudDsgZzIgLz0gY291bnQ7IGIyIC89IGNvdW50OyBhMiAvPSBjb3VudDsKCiAgICAgICAgICAgICAgICBjb25zdCBpbml0aWFsUmdiYSA9IGByZ2JhKCR7TWF0aC5yb3VuZChyMSl9LCAke01hdGgucm91bmQoZzEpfSwgJHtNYXRoLnJvdW5kKGIxKX0sICR7YTEgLyAyNTV9KWA7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRSZ2JhID0gYHJnYmEoJHtNYXRoLnJvdW5kKHIyKX0sICR7TWF0aC5yb3VuZChnMil9LCAke01hdGgucm91bmQoYjIpfSwgJHthMiAvIDI1NX0pYDsKCiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgYW5nbGUgYW5kIGRpc3RhbmNlIHJlbGF0aXZlIHRvIHRoZSB2b3J0ZXggY2VudGVyCiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSB1bmlxdWVTdGF0ZS52b3J0ZXhYOwogICAgICAgICAgICAgICAgY29uc3QgZHkgPSB5IC0gdW5pcXVlU3RhdGUudm9ydGV4WTsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlRnJvbVZvcnRleCA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RGcm9tVm9ydGV4ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKCiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHNEYXRhLnB1c2goewogICAgICAgICAgICAgICAgICAgIHg6IHgsIC8vIE9yaWdpbmFsIFgKICAgICAgICAgICAgICAgICAgICB5OiB5LCAvLyBPcmlnaW5hbCBZCiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbFJnYmE6IGluaXRpYWxSZ2JhLAogICAgICAgICAgICAgICAgICAgIHRhcmdldFJnYmE6IHRhcmdldFJnYmEsCiAgICAgICAgICAgICAgICAgICAgYW5nbGVGcm9tVm9ydGV4OiBhbmdsZUZyb21Wb3J0ZXgsCiAgICAgICAgICAgICAgICAgICAgZGlzdEZyb21Wb3J0ZXg6IGRpc3RGcm9tVm9ydGV4LAogICAgICAgICAgICAgICAgICAgIGRlbGF5T2Zmc2V0OiBNYXRoLnJhbmRvbSgpICogMC42IC8vIFN0YWdnZXJlZCBzdGFydC9lbmQgZm9yIGluZGl2aWR1YWwgYmxvY2tzCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gRHJhdyB0aGUgc3RhcnQgaW1hZ2UgKEEpIGltbWVkaWF0ZWx5IHRvIHRoZSBtYWluIGNhbnZhcwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgfQoKICAgIC8qKgogICAgICogVGhlIG1haW4gYW5pbWF0aW9uIGxvb3AgKHJlcGxhY2VzIEFOSU1BVEUpLiBSZW5kZXJzIG9uZSBmcmFtZS4KICAgICAqLwogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICBwcm9ncmVzc1JhdyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIFRPVEFMX0ZSQU1FUzsKICAgICAgICBjb25zdCBlYXNlZEdsb2JhbFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3NSYXcpOyAvLyBPdmVyYWxsIGFuaW1hdGlvbiBwcm9ncmVzcyBlYXNlZAoKICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHNEYXRhLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBpbmRpdmlkdWFsIGJsb2NrIHByb2dyZXNzLCBzdGFnZ2VyZWQgYnkgZGVsYXlPZmZzZXQKICAgICAgICAgICAgbGV0IGluZGl2aWR1YWxQcm9ncmVzcyA9IChlYXNlZEdsb2JhbFByb2dyZXNzIC0gcC5kZWxheU9mZnNldCkgLyAoMSAtIHAuZGVsYXlPZmZzZXQpOwogICAgICAgICAgICBpbmRpdmlkdWFsUHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBpbmRpdmlkdWFsUHJvZ3Jlc3MpKTsgLy8gQ2xhbXAgMC0xCgogICAgICAgICAgICBsZXQgZHJhd1gsIGRyYXdZLCBhbHBoYTsKCiAgICAgICAgICAgIC8vIEludGVycG9sYXRlIGNvbG9yIGJhc2VkIG9uIGluZGl2aWR1YWwgcHJvZ3Jlc3MKICAgICAgICAgICAgY29uc3QgaW50ZXJwb2xhdGVkQ29sb3IgPSBpbnRlcnBvbGF0ZUNvbG9yKHAuaW5pdGlhbFJnYmEsIHAudGFyZ2V0UmdiYSwgaW5kaXZpZHVhbFByb2dyZXNzKTsKICAgICAgICAgICAgY29uc3QgcGFyc2VkQ29sb3IgPSBwYXJzZVJHQkEoaW50ZXJwb2xhdGVkQ29sb3IpOwoKICAgICAgICAgICAgaWYgKGluZGl2aWR1YWxQcm9ncmVzcyA8PSAwLjUpIHsgLy8gUGhhc2UgMTogQmxvY2tzIGZyb20gQSBtb3ZlIHRvd2FyZHMgdm9ydGV4IGFuZCBmYWRlIG91dAogICAgICAgICAgICAgICAgY29uc3QgcGhhc2VQcm9ncmVzcyA9IGluZGl2aWR1YWxQcm9ncmVzcyAqIDI7IC8vIDAgdG8gMQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudERpc3QgPSBwLmRpc3RGcm9tVm9ydGV4ICogKDEgLSBwaGFzZVByb2dyZXNzKTsgLy8gRGlzdGFuY2Ugc2hyaW5rcyB0byAwCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5nbGUgPSBwLmFuZ2xlRnJvbVZvcnRleCArIHBoYXNlUHJvZ3Jlc3MgKiBUT1RBTF9ST1RBVElPTlM7IC8vIFN3aXJsIGlud2FyZHMKCiAgICAgICAgICAgICAgICBkcmF3WCA9IHVuaXF1ZVN0YXRlLnZvcnRleFggKyBNYXRoLmNvcyhjdXJyZW50QW5nbGUpICogY3VycmVudERpc3Q7CiAgICAgICAgICAgICAgICBkcmF3WSA9IHVuaXF1ZVN0YXRlLnZvcnRleFkgKyBNYXRoLnNpbihjdXJyZW50QW5nbGUpICogY3VycmVudERpc3Q7CiAgICAgICAgICAgICAgICBhbHBoYSA9IDEgLSBwaGFzZVByb2dyZXNzOyAvLyBGYWRlIG91dAogICAgICAgICAgICB9IGVsc2UgeyAvLyBQaGFzZSAyOiBCbG9ja3MgZnJvbSBCIGVtZXJnZSBmcm9tIHZvcnRleCBhbmQgZmFkZSBpbgogICAgICAgICAgICAgICAgY29uc3QgcGhhc2VQcm9ncmVzcyA9IChpbmRpdmlkdWFsUHJvZ3Jlc3MgLSAwLjUpICogMjsgLy8gMCB0byAxCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RGlzdCA9IHAuZGlzdEZyb21Wb3J0ZXggKiBwaGFzZVByb2dyZXNzOyAvLyBEaXN0YW5jZSBncm93cyB0byBmdWxsCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5nbGUgPSBwLmFuZ2xlRnJvbVZvcnRleCAtIHBoYXNlUHJvZ3Jlc3MgKiBUT1RBTF9ST1RBVElPTlM7IC8vIFN3aXJsIG91dHdhcmRzCgogICAgICAgICAgICAgICAgZHJhd1ggPSB1bmlxdWVTdGF0ZS52b3J0ZXhYICsgTWF0aC5jb3MoY3VycmVudEFuZ2xlKSAqIGN1cnJlbnREaXN0OwogICAgICAgICAgICAgICAgZHJhd1kgPSB1bmlxdWVTdGF0ZS52b3J0ZXhZICsgTWF0aC5zaW4oY3VycmVudEFuZ2xlKSAqIGN1cnJlbnREaXN0OwogICAgICAgICAgICAgICAgYWxwaGEgPSBwaGFzZVByb2dyZXNzOyAvLyBGYWRlIGluCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFwcGx5IHRoZSBjYWxjdWxhdGVkIGFscGhhIChmYWRlLWluL291dCkgdG8gdGhlIGludGVycG9sYXRlZCBjb2xvcgogICAgICAgICAgICBwYXJzZWRDb2xvci5hICo9IGFscGhhOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoJHtwYXJzZWRDb2xvci5yfSwgJHtwYXJzZWRDb2xvci5nfSwgJHtwYXJzZWRDb2xvci5ifSwgJHtwYXJzZWRDb2xvci5hfSlgOwoKICAgICAgICAgICAgLy8gRHJhdyB0aGUgcGl4ZWwgYmxvY2sgYXQgaXRzIGNhbGN1bGF0ZWQgKHN3aXJsaW5nKSBwb3NpdGlvbgogICAgICAgICAgICBjdHguZmlsbFJlY3QoZHJhd1gsIGRyYXdZLCBQSVhFTF9CTE9DS19TSVpFLCBQSVhFTF9CTE9DS19TSVpFKTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gLS0tIEFuaW1hdGlvbiBMb29wIENvbnRyb2wgLS0tCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IFRPVEFMX0ZSQU1FUykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgLy8gVXNlIHRoZSBmcmFtZXdvcmsncyBnbG9iYWwgcmVxdWVzdEFuaW1hdGlvbkZyYW1lCiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBBbmltYXRpb24gaXMgY29tcGxldGUuIENhbGwgdGhlIGZyYW1ld29yaydzIGNvbXBsZXRpb24gaGFuZGxlci4KICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBQdWJsaWMgQVBJIGZvciB0aGUgdHJhbnNpdGlvbgogICAgcmV0dXJuIHsKICAgICAgICB0aXRsZTogIlZvcnRleCBQaXhlbCBUcmFuc2l0aW9uIiwKICAgICAgICBpbml0OiBpbml0LAogICAgICAgIGFuaW1hdGU6IGFuaW1hdGUKICAgIH07Cn0pKCk7CgoKCkFOSU1BVElPTl9MT0dJQ1s5XSA9IChmdW5jdGlvbigpIHsKICAgIC8vIC0tLSBDb25zdGFudHMgZGVyaXZlZCBmcm9tIHRoZSBvcmlnaW5hbCBzb3VyY2UgY29kZSAtLS0KICAgIGNvbnN0IFRPVEFMX1NURVBTID0gNTA7IC8vIFRvdGFsIHN0ZXBzIGZvciB0aGUgYW5pbWF0aW9uICgyNSBjb21wcmVzcyArIDI1IGRlY29tcHJlc3MpCiAgICBjb25zdCBIQUxGX1NURVBTID0gVE9UQUxfU1RFUFMgLyAyOwogICAgY29uc3QgTUFYX1NQRUVEX0ZBQ1RPUiA9IDUuMDsKICAgIGNvbnN0IEJMVUVfQ0hBTk5FTF9DT05TVEFOVCA9IDMuMDsgLy8gQ29uc3RhbnQgZm9yIHRoZSBuZXcgQmx1ZSBjaGFubmVsIGNhbGN1bGF0aW9uIChSK0crQikvQ09OU1RBTlQKCiAgICAvLyAtLS0gQW5pbWF0aW9uLXNwZWNpZmljIHN0YXRlIHZhcmlhYmxlcyAtLS0KICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0gewogICAgICAgIGN1cnJlbnRTdGVwOiAwLAogICAgICAgIGFuaW1hdGlvbkZyYW1lczogW10sIC8vIFByZS1jYWxjdWxhdGVkIEltYWdlRGF0YSBvYmplY3RzCiAgICAgICAgY2VudGVyWDogMCwKICAgICAgICBjZW50ZXJZOiAwCiAgICB9OwoKICAgIC8vIC0tLSBIZWxwZXIgRnVuY3Rpb25zIC0tLQoKICAgIC8qKgogICAgICogRXh0cmFjdHMgcGl4ZWwgZGF0YSBmcm9tIGFuIEhUTUwgSW1hZ2Ugb2JqZWN0IHVzaW5nIGFuIG9mZi1zY3JlZW4gY2FudmFzLgogICAgICovCiAgICBmdW5jdGlvbiBnZXRQaXhlbERhdGEoaW1hZ2UpIHsKICAgICAgICAvLyBVc2UgZ2xvYmFsIFdJRFRIL0hFSUdIVCBmb3IgY29uc2lzdGVuY3kKICAgICAgICBjb25zdCB0ZW1wQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgY29uc3QgdGVtcEN0eCA9IHRlbXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gV0lEVEg7CiAgICAgICAgdGVtcENhbnZhcy5oZWlnaHQgPSBIRUlHSFQ7CiAgICAgICAgdGVtcEN0eC5kcmF3SW1hZ2UoaW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgIHJldHVybiB0ZW1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgIH0KCiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgYSBzaW5nbGUgZnJhbWUgYmFzZWQgb24gdGhlIHBpeGVsIG1vdmVtZW50IGxvZ2ljIChjb21wcmVzc2lvbiBvciBkZWNvbXByZXNzaW9uIHBoYXNlKS4KICAgICAqIEBwYXJhbSB7SW1hZ2VEYXRhfSBvcmlnaW5hbEltYWdlRGF0YSAtIFRoZSBzb3VyY2UgcGl4ZWwgZGF0YS4KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBzdGVwIC0gQ3VycmVudCBzdGVwICgwIHRvIEhBTEZfU1RFUFMtMSkuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdG90YWxQaGFzZVN0ZXBzIC0gTnVtYmVyIG9mIHN0ZXBzIGluIHRoZSBjdXJyZW50IHBoYXNlIChIQUxGX1NURVBTKS4KICAgICAqIEByZXR1cm5zIHtJbWFnZURhdGF9IFRoZSBjYWxjdWxhdGVkIGZyYW1lIGRhdGEuCiAgICAgKi8KICAgIGZ1bmN0aW9uIGNhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShvcmlnaW5hbEltYWdlRGF0YSwgc3RlcCwgdG90YWxQaGFzZVN0ZXBzKSB7CiAgICAgICAgY29uc3Qgd2lkdGggPSBvcmlnaW5hbEltYWdlRGF0YS53aWR0aDsKICAgICAgICBjb25zdCBoZWlnaHQgPSBvcmlnaW5hbEltYWdlRGF0YS5oZWlnaHQ7CiAgICAgICAgY29uc3Qgb3JpZ2luYWxQaXhlbHMgPSBvcmlnaW5hbEltYWdlRGF0YS5kYXRhOwogICAgICAgIGNvbnN0IG5ld1BpeGVsc0J1ZmZlciA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh3aWR0aCAqIGhlaWdodCAqIDQpOwoKICAgICAgICAvLyAxLiBJbml0aWFsaXplIGJ1ZmZlciB3aXRoIHRyYW5zcGFyZW50IHBpeGVscwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3UGl4ZWxzQnVmZmVyLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgICAgIG5ld1BpeGVsc0J1ZmZlcltpICsgM10gPSAwOwogICAgICAgIH0KCiAgICAgICAgLy8gMi4gQ2FsY3VsYXRlIGN1cnJlbnQgcHJvZ3Jlc3MgYW5kIGRpc3BsYWNlbWVudCBsaW1pdAogICAgICAgIGNvbnN0IGNvbXByZXNzaW9uUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCBzdGVwIC8gKHRvdGFsUGhhc2VTdGVwcyAtIDEpKTsKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIHdpZHRoICsgeCkgKiA0OwogICAgICAgICAgICAgICAgY29uc3QgciA9IG9yaWdpbmFsUGl4ZWxzW2ldOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IG9yaWdpbmFsUGl4ZWxzW2kgKyAxXTsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBvcmlnaW5hbFBpeGVsc1tpICsgMl07CiAgICAgICAgICAgICAgICBjb25zdCBhID0gb3JpZ2luYWxQaXhlbHNbaSArIDNdOwoKICAgICAgICAgICAgICAgIC8vIFNraXAgdHJhbnNwYXJlbnQvZnVsbHkgY29tcHJlc3NlZCBwaXhlbHMKICAgICAgICAgICAgICAgIGlmIChhID09PSAwKSBjb250aW51ZTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gQ2FsY3VsYXRlIFRhcmdldCBQb3NpdGlvbnMgJiBNb3ZlbWVudCAtLS0KCiAgICAgICAgICAgICAgICAvLyBSZWQgQ2hhbm5lbCAoWS1heGlzIG1vdmVtZW50OiBSID4gMTI3IG1vdmVzIHRvIGJvdHRvbSwgZWxzZSB0b3ApCiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRZID0gKHIgPiAxMjcpID8gaGVpZ2h0IC0gMSA6IDA7CiAgICAgICAgICAgICAgICBjb25zdCBkeVRvdGFsID0gdGFyZ2V0WSAtIHk7CiAgICAgICAgICAgICAgICAvLyBNb3ZlbWVudCBpcyBwcm9wb3J0aW9uYWwgdG8gZGlzdGFuY2UgZnJvbSB0YXJnZXQsIHNjYWxlZCBieSBwcm9ncmVzcyBhbmQgc3BlZWQgZmFjdG9yCiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlWSA9IGR5VG90YWwgKiBjb21wcmVzc2lvblByb2dyZXNzICogKE1BWF9TUEVFRF9GQUNUT1IgLyB0b3RhbFBoYXNlU3RlcHMpOwoKICAgICAgICAgICAgICAgIC8vIEdyZWVuIENoYW5uZWwgKFgtYXhpcyBtb3ZlbWVudDogRyA+IDEyNyBtb3ZlcyB0byByaWdodCwgZWxzZSBsZWZ0KQogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0WCA9IChnID4gMTI3KSA/IHdpZHRoIC0gMSA6IDA7CiAgICAgICAgICAgICAgICBjb25zdCBkeFRvdGFsID0gdGFyZ2V0WCAtIHg7CiAgICAgICAgICAgICAgICBjb25zdCBtb3ZlWCA9IGR4VG90YWwgKiBjb21wcmVzc2lvblByb2dyZXNzICogKE1BWF9TUEVFRF9GQUNUT1IgLyB0b3RhbFBoYXNlU3RlcHMpOwoKICAgICAgICAgICAgICAgIC8vIC0tLSBDYWxjdWxhdGUgTmV3IFBvc2l0aW9uIC0tLQogICAgICAgICAgICAgICAgbGV0IG5ld1ggPSB4ICsgbW92ZVg7CiAgICAgICAgICAgICAgICBsZXQgbmV3WSA9IHkgKyBtb3ZlWTsKCiAgICAgICAgICAgICAgICAvLyBDbGFtcGluZyBhbmQgcm91bmRpbmcKICAgICAgICAgICAgICAgIG5ld1ggPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIE1hdGgubWluKHdpZHRoIC0gMSwgbmV3WCkpKTsKICAgICAgICAgICAgICAgIG5ld1kgPSBNYXRoLnJvdW5kKE1hdGgubWF4KDAsIE1hdGgubWluKGhlaWdodCAtIDEsIG5ld1kpKSk7CgogICAgICAgICAgICAgICAgLy8gLS0tIENhbGN1bGF0ZSBOZXcgQmx1ZSBDaGFubmVsIENvbG9yIChSK0crQikvQ09OU1RBTlQgLS0tCiAgICAgICAgICAgICAgICBjb25zdCBuZXdCID0gTWF0aC5taW4oMjU1LCBNYXRoLm1heCgwLCBNYXRoLnJvdW5kKChyICsgZyArIGIpIC8gQkxVRV9DSEFOTkVMX0NPTlNUQU5UKSkpOwoKICAgICAgICAgICAgICAgIC8vIC0tLSBQbGFjZSBQaXhlbCBpbiBOZXcgTG9jYXRpb24gLS0tCiAgICAgICAgICAgICAgICBjb25zdCBkZXN0SW5kZXggPSAobmV3WSAqIHdpZHRoICsgbmV3WCkgKiA0OwoKICAgICAgICAgICAgICAgIC8vIENvcHkgcGl4ZWwgY29sb3IgdG8gdGhlIG5ldyBwb3NpdGlvbgogICAgICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2Rlc3RJbmRleF0gPSByOwogICAgICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2Rlc3RJbmRleCArIDFdID0gZzsKICAgICAgICAgICAgICAgIG5ld1BpeGVsc0J1ZmZlcltkZXN0SW5kZXggKyAyXSA9IG5ld0I7IC8vIFVzZSB0aGUgbmV3IGJsdWUgY2hhbm5lbCB2YWx1ZQogICAgICAgICAgICAgICAgbmV3UGl4ZWxzQnVmZmVyW2Rlc3RJbmRleCArIDNdID0gYTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgY29uc3QgdGVtcEN0eEZvckNyZWF0aW9uID0gY3R4IHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgY29uc3QgbmV3SW1hZ2VEYXRhID0gdGVtcEN0eEZvckNyZWF0aW9uLmNyZWF0ZUltYWdlRGF0YSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBuZXdJbWFnZURhdGEuZGF0YS5zZXQobmV3UGl4ZWxzQnVmZmVyKTsKICAgICAgICByZXR1cm4gbmV3SW1hZ2VEYXRhOwogICAgfQoKICAgIC8vIC0tLSBDb3JlIE1vZHVsZSBGdW5jdGlvbnMgLS0tCgogICAgLyoqCiAgICAgKiBJbml0aWFsaXplcyB0aGUgYW5pbWF0aW9uOiBzZXRzIHN0YXRlIGFuZCBwcmUtY2FsY3VsYXRlcyBhbGwgZnJhbWVzLgogICAgICogTWFwcyB0aGUgZnJhbWV3b3JrJ3MgQSAtPiBCIHRyYW5zaXRpb24gdG8gdGhlIGFuaW1hdGlvbidzIENvbXByZXNzIC0+IERlY29tcHJlc3MgcGhhc2VzLgogICAgICovCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIGlmICghY3VycmVudEltYWdlIHx8ICFuZXh0SW1hZ2UgfHwgIWN0eCkgcmV0dXJuOwoKICAgICAgICAvLyBSZXNldCBzdGF0ZQogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRTdGVwID0gMDsKICAgICAgICB1bmlxdWVTdGF0ZS5hbmltYXRpb25GcmFtZXMgPSBbXTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIGEgcHNldWRvLWNlbnRlciAodXNlZCBpbiB0aGUgb3JpZ2luYWwgbG9naWMgYnV0IG5vdCBleHBsaWNpdGx5IGluIHRoZSBtb3ZlbWVudCBjYWxjdWxhdGlvbiBoZXJlKQogICAgICAgIHVuaXF1ZVN0YXRlLmNlbnRlclggPSBNYXRoLnJvdW5kKFdJRFRIICogMC41ICsgKE1hdGgucmFuZG9tKCkgLSAwLjUpICogV0lEVEggKiAwLjQpOwogICAgICAgIHVuaXF1ZVN0YXRlLmNlbnRlclkgPSBNYXRoLnJvdW5kKEhFSUdIVCAqIDAuNSArIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIEhFSUdIVCAqIDAuNCk7CgogICAgICAgIC8vIEdldCBpbml0aWFsIEltYWdlRGF0YSBmb3IgYm90aCBzb3VyY2UgaW1hZ2VzCiAgICAgICAgLy8gY3VycmVudEltYWdlIChBKSBpcyB0aGUgaW1hZ2UgdG8gY29tcHJlc3MvdmFuaXNoLgogICAgICAgIGNvbnN0IGltYWdlRGF0YTAgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAvLyBuZXh0SW1hZ2UgKEIpIGlzIHRoZSBpbWFnZSB0byBkZWNvbXByZXNzL2FwcGVhci4KICAgICAgICBjb25zdCBpbWFnZURhdGExID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CgogICAgICAgIC8vIFBoYXNlIDE6IENvbXByZXNzaW9uIChJbWFnZSBBIC0+IE1heCBDb21wcmVzc2VkKQogICAgICAgIGZvciAobGV0IHN0ZXAgPSAwOyBzdGVwIDwgSEFMRl9TVEVQUzsgc3RlcCsrKSB7CiAgICAgICAgICAgIGNvbnN0IGZyYW1lRGF0YSA9IGNhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShpbWFnZURhdGEwLCBzdGVwLCBIQUxGX1NURVBTKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuYW5pbWF0aW9uRnJhbWVzLnB1c2goZnJhbWVEYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIFBoYXNlIDI6IERlY29tcHJlc3Npb24gKE1heCBDb21wcmVzc2VkIEltYWdlIEIgLT4gSW1hZ2UgQiBPcmlnaW5hbCkKICAgICAgICBjb25zdCBpbWFnZTFDb21wcmVzc2VkU3RhdGVzID0gW107CiAgICAgICAgZm9yIChsZXQgc3RlcCA9IDA7IHN0ZXAgPCBIQUxGX1NURVBTOyBzdGVwKyspIHsKICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBjb21wcmVzc2VkIHN0YXRlcyBvZiBJbWFnZSBCCiAgICAgICAgICAgIGNvbnN0IGZyYW1lRGF0YSA9IGNhbGN1bGF0ZUNvbXByZXNzZWRGcmFtZShpbWFnZURhdGExLCBzdGVwLCBIQUxGX1NURVBTKTsKICAgICAgICAgICAgaW1hZ2UxQ29tcHJlc3NlZFN0YXRlcy5wdXNoKGZyYW1lRGF0YSk7CiAgICAgICAgfQoKICAgICAgICAvLyBBZGQgdGhlIHJldmVyc2VkIHNlcXVlbmNlIG9mIGNvbXByZXNzZWQgSW1hZ2UgQiBzdGF0ZXMuIFRoaXMgY3JlYXRlcyB0aGUgZGVjb21wcmVzc2lvbiBlZmZlY3QuCiAgICAgICAgZm9yIChsZXQgaSA9IGltYWdlMUNvbXByZXNzZWRTdGF0ZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuYW5pbWF0aW9uRnJhbWVzLnB1c2goaW1hZ2UxQ29tcHJlc3NlZFN0YXRlc1tpXSk7CiAgICAgICAgfQoKICAgICAgICAvLyBEcmF3IHRoZSBzdGFydGluZyBpbWFnZSAoQSkgb24gdGhlIGNhbnZhcwogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBtYWluIGFuaW1hdGlvbiBsb29wLiBEcmF3cyB0aGUgcHJlLXJlY29yZGVkIGZyYW1lLgogICAgICovCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50U3RlcCA8IFRPVEFMX1NURVBTICYmIHVuaXF1ZVN0YXRlLmFuaW1hdGlvbkZyYW1lc1t1bmlxdWVTdGF0ZS5jdXJyZW50U3RlcF0pIHsKICAgICAgICAgICAgLy8gRHJhdyB0aGUgcHJlLWNhbGN1bGF0ZWQgZnJhbWUKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YSh1bmlxdWVTdGF0ZS5hbmltYXRpb25GcmFtZXNbdW5pcXVlU3RhdGUuY3VycmVudFN0ZXBdLCAwLCAwKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudFN0ZXArKzsKCiAgICAgICAgICAgIC8vIFVzZSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgZm9yIHNtb290aCBkcmF3aW5nCiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRTdGVwID09PSBUT1RBTF9TVEVQUykgewogICAgICAgICAgICAvLyBBbmltYXRpb24gaXMgY29tcGxldGUuIENhbGwgdGhlIGZyYW1ld29yaydzIGNvbXBsZXRpb24gaGFuZGxlciAoYWZ0ZXIgYSBzbWFsbCBkZWxheSB0byB2aWV3IHRoZSBmaW5hbCBpbWFnZSkuCiAgICAgICAgICAgIC8vIFRoaXMgcmVwbGFjZXMgdGhlIG9yaWdpbmFsICdfXzNrbG9wdGVuKCknIGZ1bmN0aW9uIGNhbGwuCiAgICAgICAgICAgIHNldFRpbWVvdXQoc3RhcnROZXh0VHJhbnNpdGlvbiwgMjAwMCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFB1YmxpYyBBUEkgZm9yIHRoZSB0cmFuc2l0aW9uCiAgICByZXR1cm4gewogICAgICAgIHRpdGxlOiAiUGl4ZWwgRmxvdyBUcmFuc2l0aW9uIiwKICAgICAgICBpbml0OiBpbml0LAogICAgICAgIGFuaW1hdGU6IGFuaW1hdGUKICAgIH07Cn0pKCk7CgoKCgoKCgogICAgLy8gLS0tIEFOSU1BVElPTiA0OiBRdWFudHVtIEZsdXggVHJhbnNpdGlvbiAtLS0KICAgIC8vIChDb25zb2xpZGF0ZWQgbG9naWMgZm9yIDQsIHdoaWNoIGlzIHN0cnVjdHVyYWxseSBzaW1pbGFyIHRvIDEsIGJ1dCB3aXRoIGRpZmZlcmVudCBtb3ZlbWVudC90aW1pbmcpCiAgICBBTklNQVRJT05fTE9HSUNbMTBdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgcGl4ZWxzOiBbXSwgCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICAgICAgdG90YWxGcmFtZXM6IDEwMCAKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBzZXR1cEluaXRpYWxDYW52YXMoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVscyA9IFtdOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwoKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFBID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUIgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIFdJRFRILCBIRUlHSFQpLmRhdGE7CgogICAgICAgICAgICBjb25zdCBwaXhlbFNpemUgPSA0OyAKICAgICAgICAgICAgY29uc3QgY2VudGVyID0geyB4OiBXSURUSCAvIDIsIHk6IEhFSUdIVCAvIDIgfTsKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHBpeGVsU2l6ZSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBwaXhlbFNpemUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSBjZW50ZXIueDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBjZW50ZXIueTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gQW5ndWxhciBGbHV4OiBTdGFydCBwb3NpdGlvbiBpcyByYW5kb21pemVkIHdpdGhpbiBhIHNtYWxsIHJhZGl1cyBmcm9tIHRoZSBvcmlnaW5hbCBwaXhlbCBwb3NpdGlvbgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhbmRBbmdsZSA9IHdpZWxzaWVkZXIoKSAqIDIgKiBNYXRoLlBJOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJhbmREaXN0ID0gd2llbHNpZWRlcigpICogMjAgKyAxMDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBEZWxheSBiYXNlZCBvbiBkaXN0YW5jZSBmcm9tIGNlbnRlciBmb3IgYSByaXBwbGUgZWZmZWN0CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsYXkgPSBkaXN0IC8gTWF0aC5zcXJ0KFdJRFRIKldJRFRIICsgSEVJR0hUKkhFSUdIVCkgKiAwLjQ7CgogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVscy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogeCwgCiAgICAgICAgICAgICAgICAgICAgICAgIHk6IHksIAogICAgICAgICAgICAgICAgICAgICAgICByOiBpbWFnZURhdGFBW2ldLCBnOiBpbWFnZURhdGFBW2krMV0sIGI6IGltYWdlRGF0YUFbaSsyXSwgYTogaW1hZ2VEYXRhQVtpKzNdLAogICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRSOiBpbWFnZURhdGFCW2ldLCB0YXJnZXRHOiBpbWFnZURhdGFCW2krMV0sIHRhcmdldEI6IGltYWdlRGF0YUJbaSsyXSwgdGFyZ2V0QTogaW1hZ2VEYXRhQltpKzNdLAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFg6IHggKyBNYXRoLmNvcyhyYW5kQW5nbGUpICogcmFuZERpc3QsIC8vIFN0YXJ0IG9mZi1wb3NpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFk6IHkgKyBNYXRoLnNpbihyYW5kQW5nbGUpICogcmFuZERpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZFg6IHgsIAogICAgICAgICAgICAgICAgICAgICAgICBlbmRZOiB5LAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogZGVsYXksCiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IHBpeGVsU2l6ZQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICBjb25zdCByYXdQcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVscy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFByb2dyZXNzID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgKHJhd1Byb2dyZXNzIC0gcC5kZWxheSkgLyAoMSAtIHAuZGVsYXkpKSk7CiAgICAgICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gMSAtIE1hdGgucG93KDEgLSBjdXJyZW50UHJvZ3Jlc3MsIDMpOyAvLyBFYXNlLW91dAoKICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uIHRyYW5zaXRpb246IFN0YXJ0IC0+IFRhcmdldAogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBwLnN0YXJ0WCArIChwLmVuZFggLSBwLnN0YXJ0WCkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFkgPSBwLnN0YXJ0WSArIChwLmVuZFkgLSBwLnN0YXJ0WSkgKiBlYXNlZFByb2dyZXNzOwoKICAgICAgICAgICAgICAgIC8vIENvbG9yIGFuZCBBbHBoYSB0cmFuc2l0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UiA9IHAuciArIChwLnRhcmdldFIgLSBwLnIpICogY3VycmVudFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudEcgPSBwLmcgKyAocC50YXJnZXRHIC0gcC5nKSAqIGN1cnJlbnRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRCID0gcC5iICsgKHAudGFyZ2V0QiAtIHAuYikgKiBjdXJyZW50UHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QSA9IHAuYSArIChwLnRhcmdldEEgLSBwLmEpICogY3VycmVudFByb2dyZXNzOwoKICAgICAgICAgICAgICAgIC8vIEZsdXggSml0dGVyOiBBIHNtYWxsLCBub2lzeSBvZmZzZXQgaW4gdGhlIG1pZGRsZSBvZiB0aGUgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgbGV0IGppdHRlclggPSAwOwogICAgICAgICAgICAgICAgbGV0IGppdHRlclkgPSAwOwogICAgICAgICAgICAgICAgY29uc3QgbWlkcG9pbnQgPSAwLjU7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFByb2dyZXNzID4gMC4zICYmIGN1cnJlbnRQcm9ncmVzcyA8IDAuNykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGppdHRlckZhY3RvciA9IE1hdGguc2luKChjdXJyZW50UHJvZ3Jlc3MgLSAwLjMpICogKE1hdGguUEkgLyAwLjQpKTsgLy8gUGVhayBhdCAwLjUKICAgICAgICAgICAgICAgICAgICBqaXR0ZXJYID0gKHdpZWxzaWVkZXIoKSAtIDAuNSkgKiA4ICogaml0dGVyRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIGppdHRlclkgPSAod2llbHNpZWRlcigpIC0gMC41KSAqIDggKiBqaXR0ZXJGYWN0b3I7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERyYXcKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiYSgke01hdGgucm91bmQoY3VycmVudFIpfSwgJHtNYXRoLnJvdW5kKGN1cnJlbnRHKX0sICR7TWF0aC5yb3VuZChjdXJyZW50Qil9LCAke2N1cnJlbnRBIC8gMjU1fSlgOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGN1cnJlbnRYICsgaml0dGVyWCwgY3VycmVudFkgKyBqaXR0ZXJZLCBwLnNpemUsIHAuc2l6ZSk7CiAgICAgICAgICAgIH0pOwoKCiAgICAgICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOyAKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICAgICAgcmVxdWVzdFJhbmRvbSgyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJRdWFudHVtIEZsdXggVHJhbnNpdGlvbiIsIGluaXQ6IHNldHVwSW5pdGlhbENhbnZhcywgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKICAgIAogICAgLy8gLS0tIEFOSU1BVElPTiA2OiBDb250aW51b3VzIFVuaXF1ZSBJbWFnZSBUcmFuc2l0aW9uIChDb2xvci1DaGFubmVsIFNoaWZ0KSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1sxMV0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCAKICAgICAgICAgICAgaW1hZ2VEYXRhQjogbnVsbCwgCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICAgICAgdG90YWxGcmFtZXM6IDgwIAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIHNldHVwSW5pdGlhbENhbnZhcygpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQSA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGE7CgogICAgICAgICAgICBjb25zdCBzaGlmdEFtb3VudCA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiAxNTsgLy8gTWF4IHNoaWZ0IGluIHRoZSBtaWRkbGUKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb3V0cHV0RGF0YS5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgY29uc3QgeCA9IChpIC8gNCkgJSBXSURUSDsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKChpIC8gNCkgLyBXSURUSCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENvbG9yIENoYW5uZWwgU2hpZnQgZWZmZWN0IChsaWtlIGEgZ2xpdGNoKQogICAgICAgICAgICAgICAgY29uc3QgcmVkSW5kZXggPSBpOwogICAgICAgICAgICAgICAgY29uc3QgZ3JlZW5JbmRleCA9IGkgKyAxOwogICAgICAgICAgICAgICAgY29uc3QgYmx1ZUluZGV4ID0gaSArIDI7CiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUluZGV4ID0gaSArIDM7CgogICAgICAgICAgICAgICAgLy8gUmVkIGNoYW5uZWwgc2hpZnRzIHZlcnRpY2FsbHksIEdyZWVuIGhvcml6b250YWxseSwgQmx1ZSBkaWFnb25hbGx5CiAgICAgICAgICAgICAgICBjb25zdCByU2hpZnQgPSBNYXRoLmZsb29yKHNoaWZ0QW1vdW50ICogTWF0aC5zaW4oeSAqIDAuMSArIHByb2dyZXNzICogNSkpOwogICAgICAgICAgICAgICAgY29uc3QgZ1NoaWZ0ID0gTWF0aC5mbG9vcihzaGlmdEFtb3VudCAqIE1hdGguY29zKHggKiAwLjEgKyBwcm9ncmVzcyAqIDUpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGJTaGlmdCA9IE1hdGguZmxvb3Ioc2hpZnRBbW91bnQgKiBNYXRoLnNpbigoeCArIHkpICogMC4wNSArIHByb2dyZXNzICogNSkpOwoKICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgaW5kZXggZm9yIHRoZSBzaGlmdGVkIHBpeGVsCiAgICAgICAgICAgICAgICBjb25zdCBzaGlmdGVkUl9pID0gKCh5ICsgclNoaWZ0KSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgY29uc3Qgc2hpZnRlZEdfaSA9ICh5ICogV0lEVEggKyAoeCArIGdTaGlmdCkpICogNCArIDE7CiAgICAgICAgICAgICAgICBjb25zdCBzaGlmdGVkQl9pID0gKCh5ICsgYlNoaWZ0KSAqIFdJRFRIICsgKHggKyBiU2hpZnQpKSAqIDQgKyAyOwoKICAgICAgICAgICAgICAgIC8vIEVuc3VyZSBpbmRleCBpcyB3aXRoaW4gYm91bmRzIGFuZCBvbiB0aGUgY29ycmVjdCBjaGFubmVsCiAgICAgICAgICAgICAgICBjb25zdCBnZXRQaXhlbFZhbHVlID0gKGRhdGEsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDAgJiYgaW5kZXggPCBkYXRhLmxlbmd0aCkgcmV0dXJuIGRhdGFbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOyAvLyBCbGFjay90cmFuc3BhcmVudCBpZiBvdXQgb2YgYm91bmRzCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIC8vIFRoZSBsb2dpYyBpcyBhIGJsZW5kOiBGYWRlIEEgb3V0IHdoaWxlIGdsaXRjaGluZywgdGhlbiBmYWRlIEIgaW4gd2hpbGUgZ2xpdGNoaW5nLgogICAgICAgICAgICAgICAgaWYgKHByb2dyZXNzIDwgMC41KSB7IC8vIEdsaXRjaCBBIG91dAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHAxID0gcHJvZ3Jlc3MgKiAyOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbcmVkSW5kZXhdID0gZ2V0UGl4ZWxWYWx1ZShkYXRhQSwgc2hpZnRlZFJfaSk7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtncmVlbkluZGV4XSA9IGdldFBpeGVsVmFsdWUoZGF0YUEsIHNoaWZ0ZWRHX2kpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbYmx1ZUluZGV4XSA9IGdldFBpeGVsVmFsdWUoZGF0YUEsIHNoaWZ0ZWRCX2kpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbYWxwaGFJbmRleF0gPSBkYXRhQVthbHBoYUluZGV4XSAqICgxIC0gcDEpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gR2xpdGNoIEIgaW4KICAgICAgICAgICAgICAgICAgICBjb25zdCBwMiA9IChwcm9ncmVzcyAtIDAuNSkgKiAyOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbcmVkSW5kZXhdID0gZ2V0UGl4ZWxWYWx1ZShkYXRhQiwgc2hpZnRlZFJfaSk7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtncmVlbkluZGV4XSA9IGdldFBpeGVsVmFsdWUoZGF0YUIsIHNoaWZ0ZWRHX2kpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbYmx1ZUluZGV4XSA9IGdldFBpeGVsVmFsdWUoZGF0YUIsIHNoaWZ0ZWRCX2kpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbYWxwaGFJbmRleF0gPSBkYXRhQlthbHBoYUluZGV4XSAqIHAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICAgICAgcmVxdWVzdFJhbmRvbSgyKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJDb250aW51b3VzIFVuaXF1ZSBJbWFnZSBUcmFuc2l0aW9uIChDb2xvci1DaGFubmVsIFNoaWZ0KSIsIGluaXQ6IHNldHVwSW5pdGlhbENhbnZhcywgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDc6IFF1YW50dW0gUGl4ZWwgVHJhbnNpdGlvbiAtLS0KICAgIC8vIChTaW1pbGFyIHRvIG90aGVycywgdXNlcyBhIHBhcnRpY2xlIG1vdmVtZW50IGFuZCBmYWRlIHN0cmF0ZWd5KQogICAgQU5JTUFUSU9OX0xPR0lDWzEyXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHBpeGVsczogW10sIAogICAgICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgICAgIHRvdGFsRnJhbWVzOiA5MCAKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBzZXR1cEluaXRpYWxDYW52YXMoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVscyA9IFtdOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwoKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFBID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUIgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIFdJRFRILCBIRUlHSFQpLmRhdGE7CgogICAgICAgICAgICBjb25zdCBwaXhlbEJsb2NrU2l6ZSA9IDQ7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlciA9IHsgeDogV0lEVEggLyAyLCB5OiBIRUlHSFQgLyAyIH07CgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSBwaXhlbEJsb2NrU2l6ZSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBwaXhlbEJsb2NrU2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0geCAtIGNlbnRlci54OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIGNlbnRlci55OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBRdWFudHVtIG1vdGlvbjogbW92ZSBhd2F5IGZyb20gY2VudGVyLCB0aGVuIGJhY2sgaW4KICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvdXR3YXJkRGlzdCA9IGRpc3QgKiAwLjE7IC8vIE1heCAxMCUgb3V0d2FyZCBtb3ZlbWVudAoKICAgICAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksIHNpemU6IHBpeGVsQmxvY2tTaXplLAogICAgICAgICAgICAgICAgICAgICAgICByQTogaW1hZ2VEYXRhQVtpXSwgZ0E6IGltYWdlRGF0YUFbaSsxXSwgYkE6IGltYWdlRGF0YUFbaSsyXSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJCOiBpbWFnZURhdGFCW2ldLCBnQjogaW1hZ2VEYXRhQltpKzFdLCBiQjogaW1hZ2VEYXRhQltpKzJdLAoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRYOiB4LCBzdGFydFk6IHksCiAgICAgICAgICAgICAgICAgICAgICAgIG1pZFg6IHggKyBNYXRoLmNvcyhhbmdsZSkgKiBvdXR3YXJkRGlzdCwgLy8gTW92ZSBvdXR3YXJkCiAgICAgICAgICAgICAgICAgICAgICAgIG1pZFk6IHkgKyBNYXRoLnNpbihhbmdsZSkgKiBvdXR3YXJkRGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kWDogeCwgZW5kWTogeSwgLy8gQmFjayB0byBvcmlnaW5hbCBwb3NpdGlvbgoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRGVsYXkgdHJhbnNpdGlvbiBiYXNlZCBvbiBkaXN0YW5jZSBmcm9tIGNlbnRlciBmb3IgYSByaXBwbGUgZWZmZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiBkaXN0IC8gTWF0aC5zcXJ0KFdJRFRIKldJRFRIICsgSEVJR0hUKkhFSUdIVCkgKiAwLjMKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgY29uc3QgcmF3UHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQcm9ncmVzcyA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIChyYXdQcm9ncmVzcyAtIHAuZGVsYXkpIC8gKDEgLSBwLmRlbGF5KSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZHJhd1gsIGRyYXdZLCBjdXJyZW50UiwgY3VycmVudEcsIGN1cnJlbnRCOwogICAgICAgICAgICAgICAgbGV0IGFscGhhRmFjdG9yID0gMTsKCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFByb2dyZXNzIDwgMC41KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGhhc2UgMTogQSAtPiBNaWRwb2ludCAoT3V0d2FyZCkKICAgICAgICAgICAgICAgICAgICBsZXQgcDEgPSBjdXJyZW50UHJvZ3Jlc3MgKiAyOwogICAgICAgICAgICAgICAgICAgIGxldCBlYXNlZFAxID0gMSAtIE1hdGgucG93KDEgLSBwMSwgMik7IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRyYXdYID0gcC5zdGFydFggKyAocC5taWRYIC0gcC5zdGFydFgpICogZWFzZWRQMTsKICAgICAgICAgICAgICAgICAgICBkcmF3WSA9IHAuc3RhcnRZICsgKHAubWlkWSAtIHAuc3RhcnRZKSAqIGVhc2VkUDE7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFIgPSBwLnJBOyBjdXJyZW50RyA9IHAuZ0E7IGN1cnJlbnRCID0gcC5iQTsKICAgICAgICAgICAgICAgICAgICBhbHBoYUZhY3RvciA9IDEgLSBwMTsKCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIFBoYXNlIDI6IE1pZHBvaW50IC0+IEIgKElud2FyZCkKICAgICAgICAgICAgICAgICAgICBsZXQgcDIgPSAoY3VycmVudFByb2dyZXNzIC0gMC41KSAqIDI7CiAgICAgICAgICAgICAgICAgICAgbGV0IGVhc2VkUDIgPSBNYXRoLnBvdyhwMiwgMik7IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRyYXdYID0gcC5taWRYICsgKHAuZW5kWCAtIHAubWlkWCkgKiBlYXNlZFAyOwogICAgICAgICAgICAgICAgICAgIGRyYXdZID0gcC5taWRZICsgKHAuZW5kWSAtIHAubWlkWSkgKiBlYXNlZFAyOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gcC5yQSArIChwLnJCIC0gcC5yQSkgKiBwMjsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RyA9IHAuZ0EgKyAocC5nQiAtIHAuZ0EpICogcDI7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEIgPSBwLmJBICsgKHAuYkIgLSBwLmJBKSAqIHAyOwogICAgICAgICAgICAgICAgICAgIGFscGhhRmFjdG9yID0gcDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEppdHRlciBvbiB0b3Agb2YgdGhlIG1vdmVtZW50CiAgICAgICAgICAgICAgICBkcmF3WCArPSAod2llbHNpZWRlcigpIC0gMC41KSAqIDUgKiBNYXRoLnNpbihjdXJyZW50UHJvZ3Jlc3MgKiBNYXRoLlBJKTsKICAgICAgICAgICAgICAgIGRyYXdZICs9ICh3aWVsc2llZGVyKCkgLSAwLjUpICogNSAqIE1hdGguc2luKGN1cnJlbnRQcm9ncmVzcyAqIE1hdGguUEkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoJHtNYXRoLnJvdW5kKGN1cnJlbnRSKX0sICR7TWF0aC5yb3VuZChjdXJyZW50Ryl9LCAke01hdGgucm91bmQoY3VycmVudEIpfSwgJHthbHBoYUZhY3Rvcn0pYDsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChkcmF3WCwgZHJhd1ksIHAuc2l6ZSwgcC5zaXplKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsgCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgICAgIHJlcXVlc3RSYW5kb20oMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiUXVhbnR1bSBQaXhlbCBUcmFuc2l0aW9uIiwgaW5pdDogc2V0dXBJbml0aWFsQ2FudmFzLCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwogICAgCiAgCiAgICAKICAgIC8vIC0tLSBBTklNQVRJT04gMTA6IFVucmVhbCBEeW5hbWljcyBJbWFnZSBUcmFuc2l0aW9uIChUdW1ibGluZyBCbG9ja3MpIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzEzXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIGJsb2NrczogW10sIAogICAgICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgICAgIHRvdGFsRnJhbWVzOiAxMDAgCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gc2V0dXBJbml0aWFsQ2FudmFzKCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5ibG9ja3MgPSBbXTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhQSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCkuZGF0YTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFCID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwoKICAgICAgICAgICAgY29uc3QgYmxvY2tTaXplID0gNDA7IAogICAgICAgICAgICBjb25zdCB0dW1ibGVDZW50ZXIgPSB7eDogV0lEVEgvMiwgeTogSEVJR0hULzJ9OwoKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gYmxvY2tTaXplKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IGJsb2NrU2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENlbnRlciBvZiB0aGUgYmxvY2sKICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9ja0NlbnRlclggPSB4ICsgYmxvY2tTaXplLzI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxvY2tDZW50ZXJZID0geSArIGJsb2NrU2l6ZS8yOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0gYmxvY2tDZW50ZXJYIC0gdHVtYmxlQ2VudGVyLng7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSBibG9ja0NlbnRlclkgLSB0dW1ibGVDZW50ZXIueTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4KmR4ICsgZHkqZHkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmJsb2Nrcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgeDogeCwgeTogeSwgc2l6ZTogYmxvY2tTaXplLAogICAgICAgICAgICAgICAgICAgICAgICByQTogaW1hZ2VEYXRhQVtpXSwgZ0E6IGltYWdlRGF0YUFbaSsxXSwgYkE6IGltYWdlRGF0YUFbaSsyXSwgCiAgICAgICAgICAgICAgICAgICAgICAgIHJCOiBpbWFnZURhdGFCW2ldLCBnQjogaW1hZ2VEYXRhQltpKzFdLCBiQjogaW1hZ2VEYXRhQltpKzJdLAoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTW92ZW1lbnQ6IFR1bWJsZSBhd2F5IGZyb20gY2VudGVyIChtaWRwb2ludCksIHRoZW4gdHVtYmxlIGJhY2sgaW4gKGVuZCkKICAgICAgICAgICAgICAgICAgICAgICAgdHVtYmxlRGlzdDogZGlzdCAqIDAuOCwgLy8gVHVtYmxlIGRpc3RhbmNlIHJlbGF0aXZlIHRvIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHR1bWJsZUFuZ2xlOiBNYXRoLmF0YW4yKGR5LCBkeCksCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBEZWxheSBiYXNlZCBvbiBkaXN0YW5jZSBmcm9tIGNlbnRlcgogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogZGlzdCAvIE1hdGguc3FydChXSURUSCpXSURUSCArIEhFSUdIVCpIRUlHSFQpICogMC4zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIGNvbnN0IHJhd1Byb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgdW5pcXVlU3RhdGUuYmxvY2tzLmZvckVhY2goYiA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCAocmF3UHJvZ3Jlc3MgLSBiLmRlbGF5KSAvICgxIC0gYi5kZWxheSkpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGRyYXdYLCBkcmF3WSwgY3VycmVudFIsIGN1cnJlbnRHLCBjdXJyZW50QjsKICAgICAgICAgICAgICAgIGxldCBhbHBoYUZhY3RvciA9IDE7CiAgICAgICAgICAgICAgICBsZXQgcm90YXRpb24gPSAwOwoKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50UHJvZ3Jlc3MgPCAwLjUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQaGFzZSAxOiBBIC0+IFR1bWJsZSBvdXQKICAgICAgICAgICAgICAgICAgICBsZXQgcDEgPSBjdXJyZW50UHJvZ3Jlc3MgKiAyOwogICAgICAgICAgICAgICAgICAgIGxldCBlYXNlZFAxID0gMSAtIE1hdGgucG93KDEgLSBwMSwgMik7IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uOiBtb3ZlIGF3YXkgZnJvbSBjZW50ZXIKICAgICAgICAgICAgICAgICAgICBkcmF3WCA9IGIueCArIE1hdGguY29zKGIudHVtYmxlQW5nbGUpICogYi50dW1ibGVEaXN0ICogZWFzZWRQMTsKICAgICAgICAgICAgICAgICAgICBkcmF3WSA9IGIueSArIE1hdGguc2luKGIudHVtYmxlQW5nbGUpICogYi50dW1ibGVEaXN0ICogZWFzZWRQMTsKICAgICAgICAgICAgICAgICAgICByb3RhdGlvbiA9IHAxICogTWF0aC5QSSAqIDI7IC8vIEZ1bGwgcm90YXRpb24KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjdXJyZW50UiA9IGIuckE7IGN1cnJlbnRHID0gYi5nQTsgY3VycmVudEIgPSBiLmJBOwogICAgICAgICAgICAgICAgICAgIGFscGhhRmFjdG9yID0gMSAtIHAxOwoKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGhhc2UgMjogVHVtYmxlIGluIC0+IEIKICAgICAgICAgICAgICAgICAgICBsZXQgcDIgPSAoY3VycmVudFByb2dyZXNzIC0gMC41KSAqIDI7CiAgICAgICAgICAgICAgICAgICAgbGV0IGVhc2VkUDIgPSBNYXRoLnBvdyhwMiwgMik7IAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFBvc2l0aW9uOiBtb3ZlIGJhY2sgdG8gdGFyZ2V0IHBvc2l0aW9uIChiLngsIGIueSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydFggPSBiLnggKyBNYXRoLmNvcyhiLnR1bWJsZUFuZ2xlKSAqIGIudHVtYmxlRGlzdDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydFkgPSBiLnkgKyBNYXRoLnNpbihiLnR1bWJsZUFuZ2xlKSAqIGIudHVtYmxlRGlzdDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBkcmF3WCA9IHN0YXJ0WCArIChiLnggLSBzdGFydFgpICogZWFzZWRQMjsKICAgICAgICAgICAgICAgICAgICBkcmF3WSA9IHN0YXJ0WSArIChiLnkgLSBzdGFydFkpICogZWFzZWRQMjsKICAgICAgICAgICAgICAgICAgICByb3RhdGlvbiA9ICgxIC0gcDIpICogTWF0aC5QSSAqIDI7IC8vIEZ1bGwgcm90YXRpb24gYmFjawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gYi5yQSArIChiLnJCIC0gYi5yQSkgKiBwMjsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50RyA9IGIuZ0EgKyAoYi5nQiAtIGIuZ0EpICogcDI7CiAgICAgICAgICAgICAgICAgICAgY3VycmVudEIgPSBiLmJBICsgKGIuYkIgLSBiLmJBKSAqIHAyOwogICAgICAgICAgICAgICAgICAgIGFscGhhRmFjdG9yID0gcDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERyYXc6IFRyYW5zbGF0ZSB0byB0aGUgYmxvY2sgY2VudGVyLCByb3RhdGUsIHRoZW4gZHJhdyB0aGUgYmxvY2sKICAgICAgICAgICAgICAgIGNvbnN0IGNlbnRlclggPSBkcmF3WCArIGIuc2l6ZS8yOwogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyWSA9IGRyYXdZICsgYi5zaXplLzI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGNlbnRlclgsIGNlbnRlclkpOwogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RhdGlvbik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiYSgke01hdGgucm91bmQoY3VycmVudFIpfSwgJHtNYXRoLnJvdW5kKGN1cnJlbnRHKX0sICR7TWF0aC5yb3VuZChjdXJyZW50Qil9LCAke2FscGhhRmFjdG9yfSlgOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KC1iLnNpemUvMiwgLWIuc2l6ZS8yLCBiLnNpemUsIGIuc2l6ZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7IAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKCiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0UmFuZG9tKDIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlVucmVhbCBEeW5hbWljcyBJbWFnZSBUcmFuc2l0aW9uIChUdW1ibGluZyBCbG9ja3MpIiwgaW5pdDogc2V0dXBJbml0aWFsQ2FudmFzLCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwogICAgCiAgICAKICAgIC8vIC0tLSBBTklNQVRJT04gMTU6IFR1c3NlbiBUaWpkIGVuIFRyaWxsaW5nIC0gSW1hZ2UgVHJhbnNpdGlvbiAoUGl4ZWwgRGlzcGxhY2VtZW50KSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1sxNF0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICBwaXhlbHM6IFtdLCAKICAgICAgICAgICAgY3VycmVudEZyYW1lOiAwLAogICAgICAgICAgICB0b3RhbEZyYW1lczogOTAgCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gc2V0dXBJbml0aWFsQ2FudmFzKCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHMgPSBbXTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhQSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgV0lEVEgsIEhFSUdIVCkuZGF0YTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFCID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwoKICAgICAgICAgICAgY29uc3QgcGl4ZWxCbG9ja1NpemUgPSA0OwogICAgICAgICAgICBjb25zdCBjZW50ZXIgPSB7IHg6IFdJRFRIIC8gMiwgeTogSEVJR0hUIC8gMiB9OwoKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gcGl4ZWxCbG9ja1NpemUpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gcGl4ZWxCbG9ja1NpemUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSBjZW50ZXIueDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBjZW50ZXIueTsKCiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LCBzaXplOiBwaXhlbEJsb2NrU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgckE6IGltYWdlRGF0YUFbaV0sIGdBOiBpbWFnZURhdGFBW2krMV0sIGJBOiBpbWFnZURhdGFBW2krMl0sIAogICAgICAgICAgICAgICAgICAgICAgICByQjogaW1hZ2VEYXRhQltpXSwgZ0I6IGltYWdlRGF0YUJbaSsxXSwgYkI6IGltYWdlRGF0YUJbaSsyXSwKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIERpc3BsYWNlbWVudDogYmFzZWQgb24gbm9pc2UvdHJpbGxpbmcKICAgICAgICAgICAgICAgICAgICAgICAgbm9pc2VPZmZzZXQ6IHdpZWxzaWVkZXIoKSAqIDIgKiBNYXRoLlBJLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogMC4zCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIGNvbnN0IHJhd1Byb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCAocmF3UHJvZ3Jlc3MgLSBwLmRlbGF5KSAvICgxIC0gcC5kZWxheSkpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRSLCBjdXJyZW50RywgY3VycmVudEI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENvbG9yIHRyYW5zaXRpb24KICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gcC5yQSArIChwLnJCIC0gcC5yQSkgKiBjdXJyZW50UHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjdXJyZW50RyA9IHAuZ0EgKyAocC5nQiAtIHAuZ0EpICogY3VycmVudFByb2dyZXNzOwogICAgICAgICAgICAgICAgY3VycmVudEIgPSBwLmJBICsgKHAuYkIgLSBwLmJBKSAqIGN1cnJlbnRQcm9ncmVzczsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGlzcGxhY2VtZW50CiAgICAgICAgICAgICAgICBjb25zdCBub2lzZUZhY3RvciA9IE1hdGguc2luKGN1cnJlbnRQcm9ncmVzcyAqIE1hdGguUEkpOyAvLyBNYXggYXQgbWlkcG9pbnQKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3BsYWNlbWVudFggPSBNYXRoLnNpbihyYXdQcm9ncmVzcyAqIDE1ICsgcC5ub2lzZU9mZnNldCkgKiAyMCAqIG5vaXNlRmFjdG9yOwogICAgICAgICAgICAgICAgY29uc3QgZGlzcGxhY2VtZW50WSA9IE1hdGguY29zKHJhd1Byb2dyZXNzICogMTUgKyBwLm5vaXNlT2Zmc2V0KSAqIDIwICogbm9pc2VGYWN0b3I7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEZhZGUtaW4vb3V0IGF0IGVkZ2VzCiAgICAgICAgICAgICAgICBsZXQgYWxwaGFGYWN0b3IgPSAxOwogICAgICAgICAgICAgICAgaWYgKHJhd1Byb2dyZXNzIDwgMC4yKSBhbHBoYUZhY3RvciA9IHJhd1Byb2dyZXNzIC8gMC4yOwogICAgICAgICAgICAgICAgaWYgKHJhd1Byb2dyZXNzID4gMC44KSBhbHBoYUZhY3RvciA9ICgxIC0gcmF3UHJvZ3Jlc3MpIC8gMC4yOwogICAgICAgICAgICAgICAgYWxwaGFGYWN0b3IgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBhbHBoYUZhY3RvcikpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoJHtNYXRoLnJvdW5kKGN1cnJlbnRSKX0sICR7TWF0aC5yb3VuZChjdXJyZW50Ryl9LCAke01hdGgucm91bmQoY3VycmVudEIpfSwgJHthbHBoYUZhY3Rvcn0pYDsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChwLnggKyBkaXNwbGFjZW1lbnRYLCBwLnkgKyBkaXNwbGFjZW1lbnRZLCBwLnNpemUsIHAuc2l6ZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7IAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKCiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0UmFuZG9tKDIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlR1c3NlbiBUaWpkIGVuIFRyaWxsaW5nIC0gSW1hZ2UgVHJhbnNpdGlvbiIsIGluaXQ6IHNldHVwSW5pdGlhbENhbnZhcywgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDE2OiBCaXphcnJlIEh5cGVyYm9saWMgVm9ydGV4IFRyYW5zaXRpb24gLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMTVdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgcGl4ZWxzOiBbXSwgCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICAgICAgdG90YWxGcmFtZXM6IDEyMCAKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBzZXR1cEluaXRpYWxDYW52YXMoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVscyA9IFtdOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwoKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFBID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBXSURUSCwgSEVJR0hUKS5kYXRhOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUIgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIFdJRFRILCBIRUlHSFQpLmRhdGE7CgogICAgICAgICAgICBjb25zdCBwaXhlbFNpemUgPSA0OyAKICAgICAgICAgICAgY29uc3Qgdm9ydGV4Q2VudGVyID0geyB4OiBXSURUSCAvIDIsIHk6IEhFSUdIVCAvIDIgfTsKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHBpeGVsU2l6ZSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBwaXhlbFNpemUpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSB2b3J0ZXhDZW50ZXIueDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHkgLSB2b3J0ZXhDZW50ZXIueTsKICAgICAgICAgICAgICAgICAgICBsZXQgYW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRpc3QgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBWb3J0ZXggbWlkcG9pbnQgY2FsY3VsYXRpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCB2b3J0ZXhSb3QgPSB3aWVsc2llZGVyKCkgKiBNYXRoLlBJICogMjsgLy8gUmFuZG9tIHJvdGF0aW9uIGFuZ2xlCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgdm9ydGV4RGlzdCA9IGRpc3QgKiAwLjU7IC8vIE1vdmUgY2xvc2VyIHRvIGNlbnRlcgoKICAgICAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksIHNpemU6IHBpeGVsU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgckE6IGltYWdlRGF0YUFbaV0sIGdBOiBpbWFnZURhdGFBW2krMV0sIGJBOiBpbWFnZURhdGFBW2krMl0sIAogICAgICAgICAgICAgICAgICAgICAgICByQjogaW1hZ2VEYXRhQltpXSwgZ0I6IGltYWdlRGF0YUJbaSsxXSwgYkI6IGltYWdlRGF0YUJbaSsyXSwKCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0WDogeCwgc3RhcnRZOiB5LAogICAgICAgICAgICAgICAgICAgICAgICB2b3J0ZXhYOiB2b3J0ZXhDZW50ZXIueCArIE1hdGguY29zKGFuZ2xlICsgdm9ydGV4Um90KSAqIHZvcnRleERpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHZvcnRleFk6IHZvcnRleENlbnRlci55ICsgTWF0aC5zaW4oYW5nbGUgKyB2b3J0ZXhSb3QpICogdm9ydGV4RGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0WDogeCwgdGFyZ2V0WTogeSwKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiB3aWVsc2llZGVyKCkgKiAwLjIKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgY29uc3QgcmF3UHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhlbHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRQcm9ncmVzcyA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIChyYXdQcm9ncmVzcyAtIHAuZGVsYXkpIC8gKDEgLSBwLmRlbGF5KSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgZHJhd1gsIGRyYXdZLCBjdXJyZW50UiwgY3VycmVudEcsIGN1cnJlbnRCOwogICAgICAgICAgICAgICAgbGV0IGFscGhhRmFjdG9yID0gMTsKCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFByb2dyZXNzIDwgMC41KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gUGhhc2UgMTogU3RhcnQgLT4gVm9ydGV4CiAgICAgICAgICAgICAgICAgICAgbGV0IHAxID0gY3VycmVudFByb2dyZXNzICogMjsKICAgICAgICAgICAgICAgICAgICBsZXQgZWFzZWRQMSA9IDEgLSBNYXRoLmNvcyhwMSAqIE1hdGguUEkgLyAyKTsgLy8gRWFzZS1pbi1vdXQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBkcmF3WCA9IHAuc3RhcnRYICsgKHAudm9ydGV4WCAtIHAuc3RhcnRYKSAqIGVhc2VkUDE7CiAgICAgICAgICAgICAgICAgICAgZHJhd1kgPSBwLnN0YXJ0WSArIChwLnZvcnRleFkgLSBwLnN0YXJ0WSkgKiBlYXNlZFAxOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSID0gcC5yQTsgY3VycmVudEcgPSBwLmdBOyBjdXJyZW50QiA9IHAuYkE7CiAgICAgICAgICAgICAgICAgICAgYWxwaGFGYWN0b3IgPSAxIC0gcDE7CgogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBQaGFzZSAyOiBWb3J0ZXggLT4gVGFyZ2V0CiAgICAgICAgICAgICAgICAgICAgbGV0IHAyID0gKGN1cnJlbnRQcm9ncmVzcyAtIDAuNSkgKiAyOwogICAgICAgICAgICAgICAgICAgIGxldCBlYXNlZFAyID0gTWF0aC5zaW4ocDIgKiBNYXRoLlBJIC8gMik7IC8vIEVhc2UtaW4tb3V0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZHJhd1ggPSBwLnZvcnRleFggKyAocC50YXJnZXRYIC0gcC52b3J0ZXhYKSAqIGVhc2VkUDI7CiAgICAgICAgICAgICAgICAgICAgZHJhd1kgPSBwLnZvcnRleFkgKyAocC50YXJnZXRZIC0gcC52b3J0ZXhZKSAqIGVhc2VkUDI7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY3VycmVudFIgPSBwLnJBICsgKHAuckIgLSBwLnJBKSAqIHAyOwogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRHID0gcC5nQSArIChwLmdCIC0gcC5nQSkgKiBwMjsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50QiA9IHAuYkEgKyAocC5iQiAtIHAuYkEpICogcDI7CiAgICAgICAgICAgICAgICAgICAgYWxwaGFGYWN0b3IgPSBwMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2JhKCR7TWF0aC5yb3VuZChjdXJyZW50Uil9LCAke01hdGgucm91bmQoY3VycmVudEcpfSwgJHtNYXRoLnJvdW5kKGN1cnJlbnRCKX0sICR7YWxwaGFGYWN0b3J9KWA7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoZHJhd1gsIGRyYXdZLCBwLnNpemUsIHAuc2l6ZSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7IAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKCiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgICAgICByZXF1ZXN0UmFuZG9tKDIpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkJpemFycmUgSHlwZXJib2xpYyBWb3J0ZXggVHJhbnNpdGlvbiIsIGluaXQ6IHNldHVwSW5pdGlhbENhbnZhcywgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKICAgIAogICAgLy8gLS0tIEFOSU1BVElPTiA2OiBNaXJyb3JlZCBTcGluIFRyYW5zaXRpb24gLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMTZdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0gewogICAgICAgICAgICBwaXhiaXhlbHM6IFtdLCAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTUwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgbWlkWDogV0lEVEggLyAyLAogICAgICAgICAgICBtaWRZOiBIRUlHSFQgLyAyCiAgICAgICAgfTsKCiAgICAgICAgY29uc3QgZWFzZUluT3V0UXVhZCA9ICh0KSA9PiB0IDwgMC41ID8gMiAqIHQgKiB0IDogMSAtIE1hdGgucG93KC0yICogdCArIDIsIDIpIC8gMjsKCiAgICAgICAgZnVuY3Rpb24gc2V0dXBJbml0aWFsQ2FudmFzKCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGJpeGVscyA9IFtdOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gaW1hZ2VEYXRhQi5kYXRhOwoKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CgogICAgICAgICAgICAgICAgICAgIC8vIFRhcmdldCBjb2xvciAoQikgZnJvbSBtaXJyb3JlZCBsb2NhdGlvbgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlCX21pcnJvciA9ICgoSEVJR0hUIC0gMSAtIHkpICogV0lEVEggKyAoV0lEVEggLSAxIC0geCkpICogNDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCByQSA9IGRhdGFBW2ldOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdBID0gZGF0YUFbaSArIDFdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGJBID0gZGF0YUFbaSArIDJdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJCX21pcnJvciA9IGRhdGFCW2lCX21pcnJvcl07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2F2ZUFtcGxpdHVkZSA9IE1hdGguYWJzKHJBIC0gckJfbWlycm9yKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzcGluUmFkaXVzID0gKChyQSArIGdBICsgYkEpIC8gMykgKyB3YXZlQW1wbGl0dWRlOyAvLyBCYXNlZCBvbiBvcmlnaW5hbCBpbmZvCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4Yml4ZWxzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFg6IHgsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0WTogeSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRSOiByQSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRHOiBnQSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRCOiBiQSwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kUjogckJfbWlycm9yLAogICAgICAgICAgICAgICAgICAgICAgICBlbmRHOiBkYXRhQltpQl9taXJyb3IgKyAxXSwKICAgICAgICAgICAgICAgICAgICAgICAgZW5kQjogZGF0YUJbaUJfbWlycm9yICsgMl0sCgogICAgICAgICAgICAgICAgICAgICAgICBzcGluUmFkaXVzOiBzcGluUmFkaXVzLAogICAgICAgICAgICAgICAgICAgICAgICBhbmdsZU9mZnNldDogd2llbHNpZWRlcigpICogTWF0aC5QSSAqIDIsIAogICAgICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTAwICsgTWF0aC5mbG9vcih3aWVsc2llZGVyKCkgKiA1MCksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiBNYXRoLmZsb29yKHdpZWxzaWVkZXIoKSAqIDMwKSwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsgLy8gRHJhdyBCIGZpcnN0CgogICAgICAgICAgICBjb25zdCBpbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7CgogICAgICAgICAgICB1bmlxdWVTdGF0ZS5waXhiaXhlbHMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBjdXJyZW50RnJhbWUgLSBwLmRlbGF5OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAodGltZSA+PSAwICYmIHRpbWUgPD0gcC5kdXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIHByb2dyZXNzID0gZWFzZUluT3V0UXVhZCh0aW1lIC8gcC5kdXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gTGluZWFyIG1vdmVtZW50IGZyb20gQSB0byBtaXJyb3JlZCBCIGxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWlycm9yWCA9IFdJRFRIIC0gMSAtIHAuc3RhcnRYOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG1pcnJvclkgPSBIRUlHSFQgLSAxIC0gcC5zdGFydFk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBwLnN0YXJ0WCArIChtaXJyb3JYIC0gcC5zdGFydFgpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFkgPSBwLnN0YXJ0WSArIChtaXJyb3JZIC0gcC5zdGFydFkpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBzcGluL3dhdmUgZWZmZWN0CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBwLmFuZ2xlT2Zmc2V0ICsgcHJvZ3Jlc3MgKiBNYXRoLlBJICogNDsgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3Bpbk9mZnNldCA9IHAuc3BpblJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKSAqICgxIC0gTWF0aC5hYnMocHJvZ3Jlc3MgLSAwLjUpICogMik7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxYID0gTWF0aC5mbG9vcihjdXJyZW50WCArIE1hdGguY29zKGFuZ2xlKSAqIHNwaW5PZmZzZXQpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsWSA9IE1hdGguZmxvb3IoY3VycmVudFkgKyBNYXRoLnNpbihhbmdsZSkgKiBzcGluT2Zmc2V0KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBJbnRlcnBvbGF0ZSBjb2xvcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBwLnN0YXJ0UiArIChwLmVuZFIgLSBwLnN0YXJ0UikgKiBwcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gcC5zdGFydEcgKyAocC5lbmRHIC0gcC5zdGFydEcpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHAuc3RhcnRCICsgKHAuZW5kQiAtIHAuc3RhcnRCKSAqIHByb2dyZXNzOwoKICAgICAgICAgICAgICAgICAgICBpZiAoZmluYWxYID49IDAgJiYgZmluYWxYIDwgV0lEVEggJiYgZmluYWxZID49IDAgJiYgZmluYWxZIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKGZpbmFsWSAqIFdJRFRIICsgZmluYWxYKSAqIDQ7CgogICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtpXSA9IHI7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2kgKyAxXSA9IGc7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2kgKyAyXSA9IGI7CiAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhW2kgKyAzXSA9IDI1NTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJNaXJyb3JlZCBTcGluIFRyYW5zaXRpb24iLCBpbml0OiBzZXR1cEluaXRpYWxDYW52YXMsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIC0tLSBGSU5BTCBURU4gU09WRVJFSUdOVFkgQVhJT05TIFNUQVJUIEhFUkUgKEluZGljZXMgNjItNzEpIC0tLQogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICAvLyAtLS0gQU5JTUFUSU9OIDYyOiBBeGlvbSBvZiB0aGUgTGlvbidzIFJvYXIgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNjZdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTAwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICAgICAgbWlkWDogV0lEVEggLyAyLCBtaWRZOiBIRUlHSFQgLyAyCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEEgY2VudHJhbCBzaG9ja3dhdmUgKHRoZSByb2FyKSBpbnN0YW50bHkgb2JsaXRlcmF0ZXMgSW1hZ2UgQSdzIGRhdGEsIGxlYXZpbmcgb25seSBCJ3Mgb3V0bGluZSwgd2hpY2ggdGhlbiByYXBpZGx5IGZpbGxzIGluLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3Qgc2hvY2t3YXZlUmFkaXVzID0gV0lEVEggKiAxLjUgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICBjb25zdCBzaG9ja3dhdmVBbHBoYSA9IE1hdGgubWF4KDAsIDEgLSBlYXNlZFByb2dyZXNzICogMik7CgogICAgICAgICAgICAvLyAtLS0gMS4gRHJhdyBJbWFnZSBBIChvYmxpdGVyYXRlZCBieSB3aGl0ZSBzaG9ja3dhdmUpIC0tLQogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHNob2Nrd2F2ZUFscGhhOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3doaXRlJzsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHguYXJjKHVuaXF1ZVN0YXRlLm1pZFgsIHVuaXF1ZVN0YXRlLm1pZFksIHNob2Nrd2F2ZVJhZGl1cywgMCwgMiAqIE1hdGguUEkpOwogICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIDIuIERyYXcgSW1hZ2UgQiAob3V0bGluZSBmaWxscyBpbikgLS0tCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGNvbnN0IHNpemVGYWN0b3IgPSAwLjUgKyBlYXNlZFByb2dyZXNzICogMC41OwogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKHVuaXF1ZVN0YXRlLm1pZFgsIHVuaXF1ZVN0YXRlLm1pZFkpOwogICAgICAgICAgICBjdHguc2NhbGUoc2l6ZUZhY3Rvciwgc2l6ZUZhY3Rvcik7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAtV0lEVEgvMiwgLUhFSUdIVC8yLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgdGhlIExpb24ncyBSb2FyIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDYzOiBBeGlvbSBvZiBTaWxlbmNlIFBheW1lbnQgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNjVdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTUwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQjogbnVsbAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogSW1hZ2UgQSBmYWRlcyB0byBwdXJlIGJsYWNrIChTaWxlbmNlKS4gVGhlIGJsYWNrIGlzIG1vZHVsYXRlZCBieSBhIHdhdmUgb2YgZmFpbnQsIGFuY2llbnQgcGF0dGVybnMgKEVjaG8gb2YgQnJlYXRoKS4gQiBtYXRlcmlhbGl6ZXMgZnJvbSB0aGlzIHBhdHRlcm4taW4tdGhlLXZvaWQuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snOwogICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7IC8vIFRoZSBTaWxlbmNlCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEcmF3IEEgZmFkaW5nIG91dCB0byBibGFjawogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyBFY2hvIG9mIEFuY2VzdHJhbCBCcmVhdGggKEZhaW50IFBlcmxpbiBOb2lzZSBwYXR0ZXJuKQogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgYnJlYXRoU3RyZW5ndGggPSBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpICogNTA7IC8vIE1heCBpbnRlbnNpdHkgYXQgNTAlCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBub2lzZSA9IHBlcmxpbk5vaXNlKHggKiAwLjAyLCB5ICogMC4wMiwgY3VycmVudEZyYW1lICogMC4wNSkgKiBicmVhdGhTdHJlbmd0aDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBCbGVuZCBub2lzZSB3aXRoIEIncyBjb2xvciBhcyBpdCBlbWVyZ2VzCiAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSBkYXRhQltpXSwgZyA9IGRhdGFCW2krMV0sIGIgPSBkYXRhQltpKzJdOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHIgPSBNYXRoLm1pbigyNTUsIHIgKiBlYXNlZFByb2dyZXNzICsgbm9pc2UgKiAoMS1lYXNlZFByb2dyZXNzKSk7CiAgICAgICAgICAgICAgICAgICAgZyA9IE1hdGgubWluKDI1NSwgZyAqIGVhc2VkUHJvZ3Jlc3MgKyBub2lzZSAqICgxLWVhc2VkUHJvZ3Jlc3MpKTsKICAgICAgICAgICAgICAgICAgICBiID0gTWF0aC5taW4oMjU1LCBiICogZWFzZWRQcm9ncmVzcyArIG5vaXNlICogKDEtZWFzZWRQcm9ncmVzcykpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSByOyBvdXRwdXREYXRhW2krMV0gPSBnOyBvdXRwdXREYXRhW2krMl0gPSBiOyBvdXRwdXREYXRhW2krM10gPSAyNTU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJBeGlvbSBvZiBTaWxlbmNlIFBheW1lbnQiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gNjQ6IEF4aW9tIG9mIHRoZSBEcnVtYmVhdCAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s2NF0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsLAogICAgICAgICAgICBzaGFyZHM6IFtdCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBhIHNpbXBsZSBncmlkIG9mICdzaGFyZHMnCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnNoYXJkcyA9IFtdOwogICAgICAgICAgICBjb25zdCBzaGFyZFNpemUgPSAyMDsKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gc2hhcmRTaXplKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IHNoYXJkU2l6ZSkgewogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnNoYXJkcy5wdXNoKHsgeDogeCwgeTogeSwgc2l6ZTogc2hhcmRTaXplLCBvZmZzZXQ6IHdpZWxzaWVkZXIoKSAqIE1hdGguUEkgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEltYWdlIEEgc2hhdHRlcnMgaW50byBzaGFyZHMgdGhhdCBwdWxzYXRlIHJoeXRobWljYWxseSAoRHJ1bWJlYXQpLiBJbWFnZSBCIHJlcGxhY2VzIGVhY2ggc2hhcmQgaW4gc3luYyB3aXRoIHRoZSByaHl0aG0uKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkcnVtYmVhdCA9IE1hdGguc2luKGN1cnJlbnRGcmFtZSAqIDAuMykgKiAwLjIgKyAwLjg7IC8vIFJoeXRobWljIHB1bHNlCiAgICAgICAgICAgIAogICAgICAgICAgICB1bmlxdWVTdGF0ZS5zaGFyZHMuZm9yRWFjaChzaGFyZCA9PiB7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHB1bHNlID0gTWF0aC5zaW4oY3VycmVudEZyYW1lICogMC41ICsgc2hhcmQub2Zmc2V0KSAqIDAuNSArIDAuNTsgLy8gSW5kaXZpZHVhbCBwdWxzZQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNjYWxlID0gZHJ1bWJlYXQgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICogcHVsc2U7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHNoYXJkLnggKyBzaGFyZC5zaXplLzIsIHNoYXJkLnkgKyBzaGFyZC5zaXplLzIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBEcmF3IEEgKFB1bHNhdGluZyBvdXR3YXJkKQogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoMSArIGN1cnJlbnRTY2FsZSwgMSArIGN1cnJlbnRTY2FsZSk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgc2hhcmQueCwgc2hhcmQueSwgc2hhcmQuc2l6ZSwgc2hhcmQuc2l6ZSwgLXNoYXJkLnNpemUvMiwgLXNoYXJkLnNpemUvMiwgc2hhcmQuc2l6ZSwgc2hhcmQuc2l6ZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERyYXcgQiAoRm9ybWluZyBzdGVhZGlseSkKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoMSAvICgxICsgY3VycmVudFNjYWxlKSwgMSAvICgxICsgY3VycmVudFNjYWxlKSk7IC8vIENvdW50ZXItc2NhbGUKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCBzaGFyZC54LCBzaGFyZC55LCBzaGFyZC5zaXplLCBzaGFyZC5zaXplLCAtc2hhcmQuc2l6ZS8yLCAtc2hhcmQuc2l6ZS8yLCBzaGFyZC5zaXplLCBzaGFyZC5zaXplKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIHRoZSBEcnVtYmVhdCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CiAgICAKICAgIAogICAgLy8gLS0tIEFOSU1BVElPTiA2NjogQXhpb20gb2YgdGhlIENhcnZlZCBTb3VsIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzYyXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE2MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsIGltYWdlRGF0YUI6IG51bGwKICAgICAgICB9OwogICAgICAgIGNvbnN0IHBhdGhzID0gW107CiAgICAgICAgY29uc3QgcGF0aENvdW50ID0gMTA7CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBwYXRocy5sZW5ndGggPSAwOwogICAgICAgICAgICBmb3IobGV0IGk9MDsgaSA8IHBhdGhDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBwYXRocy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBzdGFydFg6IHdpZWxzaWVkZXIoKSAqIFdJRFRILAogICAgICAgICAgICAgICAgICAgIHN0YXJ0WTogd2llbHNpZWRlcigpICogSEVJR0hULAogICAgICAgICAgICAgICAgICAgIGVuZFg6IHdpZWxzaWVkZXIoKSAqIFdJRFRILAogICAgICAgICAgICAgICAgICAgIGVuZFk6IHdpZWxzaWVkZXIoKSAqIEhFSUdIVAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEltYWdlIEEgZGlzc29sdmVzIGJ5IGEgJ2NhcnZpbmcnIHRvb2wgdGhhdCB0cmFjZXMgZ2VvbWV0cmljIHBhdGhzIChTdG9uZSkuIEltYWdlIEIgaXMgcmV2ZWFsZWQgb25seSBhbG9uZyB0aGUgcGF0aHMgdGhlIHRvb2wgY2FydmVzLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyBBIGJhc2UKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgcGF0aHMuZm9yRWFjaChwYXRoID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRYID0gcGF0aC5zdGFydFggKyAocGF0aC5lbmRYIC0gcGF0aC5zdGFydFgpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRZID0gcGF0aC5zdGFydFkgKyAocGF0aC5lbmRZIC0gcGF0aC5zdGFydFkpICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBjaXJjdWxhciBjYXJ2aW5nIGFyZWEKICAgICAgICAgICAgICAgIGNvbnN0IGNhcnZlUmFkaXVzID0gNTA7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LmFyYyhjdXJyZW50WCwgY3VycmVudFksIGNhcnZlUmFkaXVzICogZWFzZWRQcm9ncmVzcywgMCwgMiAqIE1hdGguUEkpOwogICAgICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LmNsaXAoKTsgLy8gQ2xpcCB0aGUgZHJhd2luZyBhcmVhIHRvIHRoZSBjYXJ2aW5nIGNpcmNsZQoKICAgICAgICAgICAgICAgIC8vIERyYXcgQiBvbmx5IGluc2lkZSB0aGUgY2FydmluZyBhcmVhCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIERyYXcgdGhlICdzdG9uZScgY2FydmluZyB0b29sCiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmdiYSgyMDAsIDIwMCwgMjAwLCAxKSc7CiAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMzsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8ocGF0aC5zdGFydFgsIHBhdGguc3RhcnRZKTsKICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oY3VycmVudFgsIGN1cnJlbnRZKTsKICAgICAgICAgICAgICAgIGN0eC5zdHJva2UoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIHRoZSBDYXJ2ZWQgU291bCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiA2NzogQXhpb20gb2YgdGhlIFN0YXIgTWlycm9yIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzYxXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE4MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgICAgIHBhcnRpY2xlczogW10KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBhcnRpY2xlcyA9IFtdOwogICAgICAgICAgICBjb25zdCBzdGVwID0gMTA7CiAgICAgICAgICAgIGZvcihsZXQgeT0wOyB5PEhFSUdIVDsgeSs9c3RlcCkgewogICAgICAgICAgICAgICAgZm9yKGxldCB4PTA7IHg8V0lEVEg7IHgrPXN0ZXApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5wYXJ0aWNsZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHggKyBzdGVwLzIsIHk6IHkgKyBzdGVwLzIsCiAgICAgICAgICAgICAgICAgICAgICAgIHI6IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpXSwgZzogdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhW2krMV0sIGI6IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpKzJdLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogNTAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogQSBmcmFnbWVudHMsIGFuZCBlYWNoIGZyYWdtZW50IHNwaXJhbHMgdXB3YXJkIGFuZCBvdXR3YXJkLCBiZWNvbWluZyBhIHRpbnkgcG9pbnQgb2YgbGlnaHQgKFN0YXIpLiBCIGZvcm1zIGJ5IHRoZXNlIGxpZ2h0cyByYWluaW5nIGJhY2sgZG93biBhbmQgY29oZXJpbmcuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7IC8vIE1heCBzdGFyIGRpdmVyZ2VuY2UgYXQgNTAlCgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gRHJhdyBBIGZhZGluZwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gcHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBhcnRpY2xlcy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IGN1cnJlbnRGcmFtZSAtIHAuZGVsYXk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8IDApIHJldHVybjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IHBQcm9ncmVzcyA9IE1hdGgubWluKDEsIHRpbWUgLyAodG90YWxGcmFtZXMgLSBwLmRlbGF5KSk7CiAgICAgICAgICAgICAgICBjb25zdCBlYXNlZFAgPSBNYXRoLnNpbihwUHJvZ3Jlc3MgKiBNYXRoLlBJKTsgCgogICAgICAgICAgICAgICAgLy8gRGl2ZXJnZW5jZSAoU3RhciBlZmZlY3QpCiAgICAgICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IGVhc2VkUCAqIFdJRFRIICogMC41OwogICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBwLnggKiAwLjAxICsgcC55ICogMC4wMSArIGN1cnJlbnRGcmFtZSAqIDAuMDU7CgogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBwLnggKyBkaXN0YW5jZSAqIE1hdGguY29zKGFuZ2xlKTsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRZID0gcC55IC0gZGlzdGFuY2UgKiBNYXRoLnNpbihhbmdsZSk7IC8vIFVwd2FyZCBzcGlyYWwKCiAgICAgICAgICAgICAgICAvLyBDb2hlc2lvbiAoUmFpbmluZyBkb3duIHRvIGZvcm0gQikKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsWCA9IHAueDsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsWSA9IHAueTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZHJhd1ggPSBjdXJyZW50WCArIChmaW5hbFggLSBjdXJyZW50WCkgKiBwUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBkcmF3WSA9IGN1cnJlbnRZICsgKGZpbmFsWSAtIGN1cnJlbnRZKSAqIHBQcm9ncmVzczsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gcFByb2dyZXNzOyAvLyBGYWRlIGluIGFzIHRoZXkgY29oZXJlCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigke3Aucn0sICR7cC5nfSwgJHtwLmJ9KWA7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoZHJhd1gsIGRyYXdZLCAyLCAyKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIHRoZSBTdGFyIE1pcnJvciIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogIAoKICAgIC8vIC0tLSBBTklNQVRJT04gNjk6IEF4aW9tIG9mIHRoZSBCbGFkZSBUb25ndWUgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNTldID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogOTAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIHRyYW5zaXRpb24gaXMgdmlzdWFsaXplZCBhcyBhIHZlcnRpY2FsIGN1dCAoQmxhZGUpIHRoYXQgc3RhcnRzIG5hcnJvdyBhbmQgcmFwaWRseSB3aWRlbnMsIHBlZWxpbmcgYmFjayBJbWFnZSBBIHRvIHJldmVhbCBJbWFnZSBCIHVuZGVybmVhdGguIFRoZSBjdXQgbGluZSBpcyBzaGFycCBhbmQgcHVyZS4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZU91dFF1YWQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHdpcGVXaWR0aCA9IFdJRFRIICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgY29uc3QgbWlkWCA9IFdJRFRIIC8gMjsKICAgICAgICAgICAgY29uc3Qgc3RhcnRYID0gbWlkWCAtIHdpcGVXaWR0aCAvIDI7CgogICAgICAgICAgICAvLyAtLS0gMS4gRHJhdyBJbWFnZSBBIChUaGUgdW4tY3V0IHBvcnRpb24pIC0tLQogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gMi4gRHJhdyBJbWFnZSBCIChUaGUgcmV2ZWFsZWQgcG9ydGlvbikgLS0tCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCBzdGFydFgsIDAsIHdpcGVXaWR0aCwgSEVJR0hULCBzdGFydFgsIDAsIHdpcGVXaWR0aCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSAzLiBUaGUgQmxhZGUgRWRnZSAoV2hpdGUgZmxhc2ggYWxvbmcgdGhlIGVkZ2VzKSAtLS0KICAgICAgICAgICAgY29uc3QgZmxhc2hBbHBoYSA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGZsYXNoQWxwaGE7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnd2hpdGUnOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHN0YXJ0WCwgMCwgMywgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHN0YXJ0WCArIHdpcGVXaWR0aCAtIDMsIDAsIDMsIEhFSUdIVCk7CgogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIHRoZSBCbGFkZSBUb25ndWUiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gNzA6IEF4aW9tIG9mIFNwbGl0IFNreSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s1OF0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogQSBzdWRkZW4sIGJyaWdodCB2ZXJ0aWNhbCBmcmFjdHVyZSAoU3BsaXQgU2t5KSBhcHBlYXJzLCByYXBpZGx5IGV4cGFuZGluZyBob3Jpem9udGFsbHksIHB1bGxpbmcgdGhlIHBpeGVscyBvZiBBIGFwYXJ0IHRvIHJldmVhbCB0aGUgcHVyZSwgcmFkaWFudCBsaWdodCBvZiBCIGJlaGluZCB0aGUgZ2FwLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgY29uc3QgbWlkWCA9IFdJRFRIIC8gMjsKICAgICAgICAgICAgY29uc3QgZ2FwV2lkdGggPSBtaWRYICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgIC8vIC0tLSAxLiBEcmF3IEltYWdlIEEgKFB1bGxlZCBBcGFydCkgLS0tCiAgICAgICAgICAgIC8vIExlZnQgSGFsZgogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgbWlkWCwgSEVJR0hULCAwLCAwLCBtaWRYIC0gZ2FwV2lkdGgsIEhFSUdIVCk7CiAgICAgICAgICAgIC8vIFJpZ2h0IEhhbGYKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIG1pZFgsIDAsIG1pZFgsIEhFSUdIVCwgbWlkWCArIGdhcFdpZHRoLCAwLCBtaWRYLCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIDIuIERyYXcgSW1hZ2UgQiAoVGhlIFJhZGlhbnQgTGlnaHQgaW4gdGhlIEdhcCkgLS0tCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCBtaWRYIC0gZ2FwV2lkdGgsIDAsIGdhcFdpZHRoICogMiwgSEVJR0hULCBtaWRYIC0gZ2FwV2lkdGgsIDAsIGdhcFdpZHRoICogMiwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSAzLiBQdXJlIFJhZGlhbnQgRmxhc2ggLS0tCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiAxLjU7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnd2hpdGUnOwogICAgICAgICAgICBjdHguZmlsbFJlY3QobWlkWCAtIGdhcFdpZHRoICogMC41LCAwLCBnYXBXaWR0aCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgU3BsaXQgU2t5IiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgIC8vIC0tLSBBTklNQVRJT04gNzE6IEF4aW9tIG9mIHRoZSBGaXJlIENhcnJpZXIgLS0tCkFOSU1BVElPTl9MT0dJQ1s1N10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLAogICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgIG1pZFg6IFdJRFRIIC8gMiwgbWlkWTogSEVJR0hUIC8gMgogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgIH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIC8vICoqRGVzY3JpcHRpb246IEltYWdlIEEgYnVybnMgYW5kIGRpc3NvbHZlcyBmcm9tIHRoZSBjZW50ZXIgb3V0d2FyZCAoRmlyZSksIHdoaWxlIEltYWdlIEIgc2ltdWx0YW5lb3VzbHkgZW1lcmdlcyBmcm9tIHRoZSBjZW50ZXIgb3V0d2FyZCwgbWFpbnRhaW5pbmcgYSBzaGFyZWQgYm91bmRhcnkgb2YgaW50ZW5zZSwgd2FybSBsaWdodC4qKgogICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgCiAgICAgICAgY29uc3QgbWF4UiA9IE1hdGguc3FydCh1bmlxdWVTdGF0ZS5taWRYKnVuaXF1ZVN0YXRlLm1pZFggKyB1bmlxdWVTdGF0ZS5taWRZKnVuaXF1ZVN0YXRlLm1pZFkpOwoKICAgICAgICAvLyAtLS0gMS4gRHJhdyBJbWFnZSBBIChCdXJuaW5nIEF3YXkpIC0tLQogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGNvbnN0IGNsaXBSX0EgPSBtYXhSICogKDEgLSBlYXNlZFByb2dyZXNzKTsKICAgICAgICBjdHgucmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjdHguYXJjKHVuaXF1ZVN0YXRlLm1pZFgsIHVuaXF1ZVN0YXRlLm1pZFksIGNsaXBSX0EsIDAsIDIgKiBNYXRoLlBJKTsKICAgICAgICBjdHguY2xpcCgiZXZlbm9kZCIpOyAvLyBDbGlwIHRoZSBhcmVhICpvdXRzaWRlKiB0aGUgY2lyY2xlCiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgLy8gLS0tIDIuIERyYXcgSW1hZ2UgQiAoRW1lcmdpbmcpIC0tLQogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgIGNvbnN0IGNsaXBSX0IgPSBtYXhSICogZWFzZWRQcm9ncmVzczsKICAgICAgICBjdHguYXJjKHVuaXF1ZVN0YXRlLm1pZFgsIHVuaXF1ZVN0YXRlLm1pZFksIGNsaXBSX0IsIDAsIDIgKiBNYXRoLlBJKTsKICAgICAgICBjdHguY2xpcCgpOyAvLyBDbGlwIHRoZSBhcmVhICppbnNpZGUqIHRoZSBjaXJjbGUKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gLS0tIDMuIERyYXcgdGhlIEZpcmUgQm91bmRhcnkgLS0tCiAgICAgICAgY29uc3QgZmlyZUFscGhhID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKTsKICAgICAgICAKICAgICAgICAvLyBGSVg6IEVuc3VyZSB0aGUgaW5uZXIgcmFkaXVzIGlzIG5vdCBuZWdhdGl2ZQogICAgICAgIGNvbnN0IGlubmVyUmFkaXVzID0gTWF0aC5tYXgoMCwgY2xpcFJfQSAtIDEwKTsKICAgICAgICBjb25zdCBvdXRlclJhZGl1cyA9IGNsaXBSX0EgKyAxMDsKICAgICAgICAKICAgICAgICBjb25zdCBmaXJlR3JhZGllbnQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQoCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLm1pZFgsIHVuaXF1ZVN0YXRlLm1pZFksIGlubmVyUmFkaXVzLCAvLyByMCAoaW5uZXIgcmFkaXVzKSBtdXN0IGJlID49IDAKICAgICAgICAgICAgdW5pcXVlU3RhdGUubWlkWCwgdW5pcXVlU3RhdGUubWlkWSwgb3V0ZXJSYWRpdXMgIC8vIHIxIChvdXRlciByYWRpdXMpCiAgICAgICAgKTsKICAgICAgICBmaXJlR3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsICdyZ2JhKDI1NSwgMjU1LCAwLCAwKScpOwogICAgICAgIGZpcmVHcmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCBgcmdiYSgyNTUsIDEwMCwgMCwgJHtmaXJlQWxwaGF9KWApOwogICAgICAgIGZpcmVHcmFkaWVudC5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMjU1LCAwLCAwLCAwKScpOwogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBmaXJlR3JhZGllbnQ7CiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgoKICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIHRoZSBGaXJlIENhcnJpZXIiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIC0tLSBUV0VMVkUgTkVXLCBDUkVBTUxBIEFYSU9NUyBBTklNQVRJT05TIFNUQVJUIEhFUkUgKEluZGljZXMgNTAtNjEpIC0tLQogICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCiAgICAvLyAtLS0gQU5JTUFUSU9OIDUwOiBBeGlvbSBvZiBTZWxmLUNvcnJlY3RpbmcgQ29kZSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s1Nl0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxNTAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsLAogICAgICAgICAgICBlcnJvcnM6IFtdIC8vIFN0b3JlcyAnZXJyb3InIHBpeGVsIGRhdGEKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5lcnJvcnMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJhbmRvbWx5IHNhbXBsZSAnZXJyb3InIHNwb3RzIHdoZXJlIEEgIT0gQgogICAgICAgICAgICBmb3IobGV0IGk9MDsgaSA8IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YS5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgaWYgKE1hdGguYWJzKHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YVtpXSAtIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpXSkgPiA1MCAmJiB3aWVsc2llZGVyKCkgPCAwLjAxKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuZXJyb3JzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiAoaS80KSAlIFdJRFRILAogICAgICAgICAgICAgICAgICAgICAgICB5OiBNYXRoLmZsb29yKGkvNCAvIFdJRFRIKSwKICAgICAgICAgICAgICAgICAgICAgICAgZHg6ICh3aWVsc2llZGVyKCkgLSAwLjUpICogNTAsIC8vIEluaXRpYWwgZXJyb3IgZGlzcGxhY2VtZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGR5OiAod2llbHNpZWRlcigpIC0gMC41KSAqIDUwLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogNDAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIGltYWdlIEEgaXMgZnVsbCBvZiBjaGFvdGljLCBkaXNwbGFjZWQgJ2Vycm9yJyBwaXhlbHMuIEFzIHRoZSB0cmFuc2l0aW9uIHByb2dyZXNzZXMsIGVhY2ggZXJyb3IgcGl4ZWwgcmV2ZXJzZXMgaXRzIG1vdmVtZW50IChzZWxmLWNvcnJlY3RzKSBhbmQgc25hcHMgaW50byB0aGUgY29ycmVjdCBmaW5hbCBwb3NpdGlvbiBvZiBJbWFnZSBCLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyBJbWFnZSBBIGJhc2UKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgdW5pcXVlU3RhdGUuZXJyb3JzLmZvckVhY2goZXJyID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBjdXJyZW50RnJhbWUgLSBlcnIuZGVsYXk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8IDApIHJldHVybjsKCiAgICAgICAgICAgICAgICBsZXQgZXJyb3JQcm9ncmVzcyA9IE1hdGgubWluKDEsIHRpbWUgLyAodG90YWxGcmFtZXMgLSBlcnIuZGVsYXkpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VkRXJyb3IgPSBlYXNlSW5PdXRRdWludChlcnJvclByb2dyZXNzKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gMS4gRXJyb3IgRGlzcGxhY2VtZW50IChBJ3MgcGl4ZWxzIG1vdmUgYXdheSwgdGhlbiByZXZlcnNlKSAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnREWCA9IGVyci5keCAqICgxIC0gZWFzZWRFcnJvcik7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RFkgPSBlcnIuZHkgKiAoMSAtIGVhc2VkRXJyb3IpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAtLS0gMi4gQ29sb3IgQ29ycmVjdGlvbiAoVHJhbnNpdGlvbiBBIHRvIEIpIC0tLQogICAgICAgICAgICAgICAgY29uc3QgaSA9IChlcnIueSAqIFdJRFRIICsgZXJyLngpICogNDsKICAgICAgICAgICAgICAgIGNvbnN0IHJBID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhW2ldOwogICAgICAgICAgICAgICAgY29uc3QgckIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGFbaV07CiAgICAgICAgICAgICAgICBjb25zdCByID0gckEgKyAockIgLSByQSkgKiBlYXNlZEVycm9yOwoKICAgICAgICAgICAgICAgIC8vIC0tLSAzLiBEcmF3IC0tLQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2IoJHtyfSwgMjU1LCAyNTUpYDsgLy8gSGlnaGxpZ2h0IHRoZSBjb3JyZWN0aW5nIHBpeGVsCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGVyci54ICsgY3VycmVudERYLCBlcnIueSArIGN1cnJlbnREWSwgMiwgMik7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRmluYWwgc25hcCB0byBCCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJBeGlvbSBvZiBTZWxmLUNvcnJlY3RpbmcgQ29kZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiA1MTogQXhpb20gb2YgSW1wbGVtZW50YXRpb24gV2FpdCAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s1NV0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAyMDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSB0cmFuc2l0aW9uIGJlZ2lucyB3aXRoIGEgc2xvdyBibHVyIG9mIGJvdGggaW1hZ2VzLCByZXByZXNlbnRpbmcgdGhlICd3YWl0JyBwZXJpb2QuIEF0IDgwJSBwcm9ncmVzcywgYSBzdWRkZW4sIGluc3RhbnRhbmVvdXMgZGUtYmx1ciBvY2N1cnMsIHNuYXBwaW5nIEltYWdlIEIgaW50byBwcmlzdGluZSBmb2N1cy4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3Qgd2FpdFRpbWUgPSAwLjg7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCbHVyIHN0cmVuZ3RoOiBNYXggYXQgd2FpdFRpbWUgKDAuOCkgYW5kIHRoZW4gaW5zdGFudGx5IGRyb3BzCiAgICAgICAgICAgIGNvbnN0IGJsdXJQcm9ncmVzcyA9IE1hdGgubWluKDEsIHByb2dyZXNzIC8gd2FpdFRpbWUpOwogICAgICAgICAgICBsZXQgYmx1ciA9IGJsdXJQcm9ncmVzcyAqIDUwOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChwcm9ncmVzcyA+IHdhaXRUaW1lKSB7CiAgICAgICAgICAgICAgICBibHVyID0gNTAgKiAoMSAtIChwcm9ncmVzcyAtIHdhaXRUaW1lKSAvICgxIC0gd2FpdFRpbWUpKTsKICAgICAgICAgICAgICAgIGJsdXIgPSBNYXRoLm1heCgwLCBibHVyICogMik7IAogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyBBIHdpdGggYmx1ciBhbmQgZmFkZSBvdXQKICAgICAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7Ymx1cn1weClgOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gcHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERyYXcgQiB3aXRoIGJsdXIgYW5kIGZhZGUgaW4KICAgICAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7Ymx1cn1weClgOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBwcm9ncmVzczsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LmZpbHRlciA9ICdub25lJzsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJBeGlvbSBvZiBJbXBsZW1lbnRhdGlvbiBXYWl0IiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDUyOiBBeGlvbSBvZiBaZXJvLUVudHJvcHkgTGFuZ3VhZ2UgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNTRdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTYwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICAgICAgc3ltYm9sczogW10KICAgICAgICB9OwogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGdldFN5bWJvbChyLCBnLCBiLCBzaXplKSB7CiAgICAgICAgICAgIC8vIEEgc2ltcGxlIGdlb21ldHJpYyBzaGFwZSB0aGF0IHJlcHJlc2VudHMgYSAncHVyZScgc3ltYm9sCiAgICAgICAgICAgIHJldHVybiBgcmdiYSgke3J9LCAke2d9LCAke2J9LCAxKWA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5zeW1ib2xzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzeW1ib2xTaXplID0gMTA7CiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHN5bWJvbFNpemUpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gc3ltYm9sU2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnN5bWJvbHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksIHNpemU6IHN5bWJvbFNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgIHI6IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpXSwgCiAgICAgICAgICAgICAgICAgICAgICAgIGc6IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpKzFdLAogICAgICAgICAgICAgICAgICAgICAgICBiOiB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGFbaSsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk6IHdpZWxzaWVkZXIoKSAqIDQwCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBzb3VyY2UgaW1hZ2UgZGlzc29sdmVzIGludG8gdGhvdXNhbmRzIG9mIHNtYWxsLCBwZXJmZWN0bHkgcHVyZSBjb2xvcmVkICpzeW1ib2xzKiAoc3F1YXJlcyBpbiB0aGlzIGltcGxlbWVudGF0aW9uKSByZXByZXNlbnRpbmcgdGhlIGNvcmUgImxhbmd1YWdlIiBvZiB0aGUgbmV3IGNvbmNlcHQuIFRoZXNlIHN5bWJvbHMgaW5zdGFudGFuZW91c2x5IGNvaGVyZSBpbnRvIEltYWdlIEIuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEcmF3IEEgKGZhZGVzIG91dCkKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERyYXcgU3ltYm9scyAocHVyZSBjb2xvciwgbWluaW1hbCBlbnRyb3B5KQogICAgICAgICAgICB1bmlxdWVTdGF0ZS5zeW1ib2xzLmZvckVhY2goc3ltID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBjdXJyZW50RnJhbWUgLSBzeW0uZGVsYXk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8IDApIHJldHVybjsKCiAgICAgICAgICAgICAgICBsZXQgc3ltYm9sUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCB0aW1lIC8gKHRvdGFsRnJhbWVzIC0gc3ltLmRlbGF5KSk7CiAgICAgICAgICAgICAgICBjb25zdCBzaXplRmFjdG9yID0gMC41ICsgc3ltYm9sUHJvZ3Jlc3MgKiAwLjU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHN5bWJvbFByb2dyZXNzOwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGdldFN5bWJvbChzeW0uciwgc3ltLmcsIHN5bS5iLCBzeW0uc2l6ZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTaXplID0gc3ltLnNpemUgKiBzaXplRmFjdG9yOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHN5bS54ICsgKHN5bS5zaXplIC0gY3VycmVudFNpemUpIC8gMiwgc3ltLnkgKyAoc3ltLnNpemUgLSBjdXJyZW50U2l6ZSkgLyAyLCBjdXJyZW50U2l6ZSwgY3VycmVudFNpemUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZpbmFsIHNuYXAgdG8gQgogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgWmVyby1FbnRyb3B5IExhbmd1YWdlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDUzOiBBeGlvbSBvZiBJbnNhbGxhIChEaXZpbmUgV2lsbCBXYXZlKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s1M10gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBpbWFnZSBBIGlzIGluc3RhbnRseSBjb252ZXJ0ZWQgdG8gQiBieSBhbiBpbnZpc2libGUsIHNpbmdsZSB3YXZlIG9mIHRyYW5zaXRpb24gdGhhdCB0cmF2ZWxzIGZyb20gdG9wIHRvIGJvdHRvbS4gVGhlIGxpbmUgaXRzZWxmIGlzIG1hcmtlZCBieSBhIGJsaW5kaW5nIHdoaXRlIGZsYXNoLCBzaWduaWZ5aW5nIHRoZSAqaW5zdGFudGFuZW91cyogYWN0IG9mIHRyYW5zZm9ybWF0aW9uLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3Qgd2F2ZVkgPSBIRUlHSFQgKiBwcm9ncmVzczsgLy8gV2F2ZWZyb250IHBvc2l0aW9uCiAgICAgICAgICAgIGNvbnN0IHdhdmVUaGlja25lc3MgPSAxNTsKCiAgICAgICAgICAgIC8vIERyYXcgQSAoYWJvdmUgdGhlIHdhdmUpCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgd2F2ZVksIDAsIDAsIFdJRFRILCB3YXZlWSk7CgogICAgICAgICAgICAvLyBEcmF3IEIgKGJlbG93IHRoZSB3YXZlKQogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgd2F2ZVksIFdJRFRILCBIRUlHSFQgLSB3YXZlWSwgMCwgd2F2ZVksIFdJRFRILCBIRUlHSFQgLSB3YXZlWSk7CgogICAgICAgICAgICAvLyBUaGUgRmxhc2ggb2YgSW5zYWxsYSAodGhlIHdhdmUgaXRzZWxmKQogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkgKiAyKSAqIDAuNTsgLy8gRG91YmxlIGZsYXNoCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnd2hpdGUnOwogICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgd2F2ZVkgLSB3YXZlVGhpY2tuZXNzLzIsIFdJRFRILCB3YXZlVGhpY2tuZXNzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgSW5zYWxsYSAoRGl2aW5lIFdpbGwgV2F2ZSkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gNTQ6IEF4aW9tIG9mIER1YWwtUGVyc3BlY3RpdmUgVHJ1dGggLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNTJdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwgaW1hZ2VEYXRhQjogbnVsbAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBJbWFnZSBBIGlzIG9uIHRoZSBsZWZ0LCBCIG9uIHRoZSByaWdodC4gVGhlIGNlbnRyYWwgZGl2aWRpbmcgbGluZSBmbGFzaGVzIHdpdGggcHVyZSBlbmVyZ3kgcmVwcmVzZW50aW5nIHRoZSBhYnNvbHV0ZSAqZGlmZmVyZW5jZSogYmV0d2VlbiB0aGUgdHdvIGltYWdlIGhhbHZlcywgYmVmb3JlIHRoZSBib3VuZGFyeSBzbmFwcyBvdmVyIHRvIEIuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUEgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbWlkWCA9IFdJRFRIIC8gMjsKICAgICAgICAgICAgY29uc3Qgd2F2ZUFtcCA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiAxMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIC8vIENoYW90aWMsIGVuZXJneS1maWxsZWQgY2VudGVyIGNvbHVtbgogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyQ29sdW1uID0gbWlkWCArIE1hdGguc2luKHkgKiAwLjEgKyBjdXJyZW50RnJhbWUgKiAwLjUpICogd2F2ZUFtcDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbGV0IHIsIGcsIGI7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAxLiBEcmF3IEltYWdlIEEgKExlZnQgU2lkZSkgLS0tCiAgICAgICAgICAgICAgICAgICAgaWYgKHggPCBtaWRYKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBkYXRhQVtpXTsgZyA9IGRhdGFBW2krMV07IGIgPSBkYXRhQVtpKzJdOwogICAgICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDIuIERyYXcgSW1hZ2UgQiAoUmlnaHQgU2lkZSkgLS0tCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBkYXRhQltpXTsgZyA9IGRhdGFCW2krMV07IGIgPSBkYXRhQltpKzJdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDMuIFRoZSBEaWZmZXJlbmNlIEVuZXJneSAoQ2VudGVyIEZsYXNoKSAtLS0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0VG9DZW50ZXIgPSBNYXRoLmFicyh4IC0gY2VudGVyQ29sdW1uKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBmbGFzaEZhY3RvciA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIDEgLSBkaXN0VG9DZW50ZXIgLyA1KSk7IC8vIEZhZGVzIGZhc3QgYXdheSBmcm9tIGNlbnRlcgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRoZSBkaWZmZXJlbmNlIGluIGNvbG9yIChUaGUgcGFyYWRveCBpdHNlbGYpCiAgICAgICAgICAgICAgICAgICAgY29uc3QgckRpZmYgPSBkYXRhQltpXSAtIGRhdGFBW2ldOyAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByICs9IHJEaWZmICogZmxhc2hGYWN0b3I7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQocik7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIEZpbmFsIHdpcGUgKHNuYXBzIHRoZSBib3VuZGFyeSB0byBCKQogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgRHVhbC1QZXJzcGVjdGl2ZSBUcnV0aCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CiAgICAKICAgIC8vIC0tLSBBTklNQVRJT04gNTU6IEF4aW9tIG9mIHRoZSBVbnRyYWluZWQgTWFzdGVyIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzUxXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEwMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgICAgIHRpbGVzOiBbXQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gU2ltcGxlLCByYXcgZWFzZS1vdXQgYnV0IGFwcGxpZWQgbm9uLWxpbmVhcmx5CiAgICAgICAgY29uc3Qgc2ltcGxlRWFzZXIgPSAodCkgPT4gMSAtIE1hdGgucG93KDEgLSB0LCA0KTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzID0gW107CiAgICAgICAgICAgIGNvbnN0IHRpbGVTaXplID0gMzI7CiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHRpbGVTaXplKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IHRpbGVTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUudGlsZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiB3aWVsc2llZGVyKCkgKiA0MCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZW5ndGg6IHdpZWxzaWVkZXIoKSAqIDAuNSArIDAuNSAvLyBOb24tbGluZWFyIHN0cmVuZ3RoCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEEgc2ltcGxlIGNoZWNrZXJib2FyZCB3aXBlLCBidXQgZWFjaCBibG9jayBoYXMgYSBub24tbGluZWFyIGFjY2VsZXJhdGlvbiBkZXRlcm1pbmVkIGJ5IGEgcmFuZG9tIGZhY3Rvciwgc2hvd2luZyB0aGF0ICpnZW51aW5lKiByZXN1bHRzIGRvbid0IHJlcXVpcmUgY29tcGxleCBjb2RlLCBqdXN0IGhvbmVzdCwgdW5ldmVuIGFwcGxpY2F0aW9uIG9mIHNpbXBsZSBwcmluY2lwbGVzLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgICAgICB1bmlxdWVTdGF0ZS50aWxlcy5mb3JFYWNoKHRpbGUgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IGN1cnJlbnRGcmFtZSAtIHRpbGUuZGVsYXk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8IDApIHJldHVybjsKCiAgICAgICAgICAgICAgICBsZXQgdGlsZVByb2dyZXNzID0gTWF0aC5taW4oMSwgdGltZSAvICh0b3RhbEZyYW1lcyAtIHRpbGUuZGVsYXkpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBzaW1wbGVFYXNlcih0aWxlUHJvZ3Jlc3MpICogdGlsZS5zdHJlbmd0aDsgLy8gU2ltcGxlIGVhc2UsIG5vbi1saW5lYXIgYXBwbGljYXRpb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGVhc2VkUHJvZ3Jlc3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRHJhdyBJbWFnZSBCIG92ZXIgSW1hZ2UgQSBhdCB0aGlzIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgICAgICBuZXh0SW1hZ2UsIAogICAgICAgICAgICAgICAgICAgICAgICB0aWxlLngsIHRpbGUueSwgMzIsIDMyLCAvLyBTb3VyY2UgQgogICAgICAgICAgICAgICAgICAgICAgICB0aWxlLngsIHRpbGUueSwgMzIsIDMyICAvLyBEZXN0aW5hdGlvbgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJBeGlvbSBvZiB0aGUgVW50cmFpbmVkIE1hc3RlciIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiA1NjogQXhpb20gb2YgdGhlIENyZWFtbGEgU3dpcmwgKFJld2FyZCkgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNTBdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTUwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICAgICAgbWlkWDogV0lEVEggLyAyLCBtaWRZOiBIRUlHSFQgLyAyCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEJvdGggaW1hZ2VzIHN3aXJsIGludG8gYSBjZW50cmFsIHZvcnRleCBvZiBpbnRlbnNlbHkgbHVtaW5vdXMsIGNvbWJpbmVkIGxpZ2h0LiBUaGUgdm9ydGV4IHN0YWJpbGl6ZXMsIGFuZCB0aGUgbGlnaHQgc2V0dGxlcyBkb3duIHRvIGZvcm0gdGhlIGNsZWFyIEltYWdlIEIsIHRoZSBjdWxtaW5hdGlvbiBvZiBlZmZvcnQuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUEgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbWF4QW5nbGUgPSBNYXRoLlBJICogNjsgLy8gSGVhdnkgc3dpcmwKICAgICAgICAgICAgY29uc3QgbWF4U2NhbGUgPSAwLjU7IC8vIFN3aXJsIHNocmlua3MgaGVhdmlseQoKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0geCAtIHVuaXF1ZVN0YXRlLm1pZFg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSB5IC0gdW5pcXVlU3RhdGUubWlkWTsKICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBSb3RhdGlvbiBhbmQgc2NhbGluZyBiYXNlZCBvbiBwcm9ncmVzcwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBbmdsZSA9IGFuZ2xlICsgbWF4QW5nbGUgKiBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpOyAvLyBTd2lybCBvdXQgYW5kIGJhY2sKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50U2NhbGUgPSAxICsgbWF4U2NhbGUgKiBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpOyAvLyBTaHJpbmsgYW5kIGdyb3cKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlWCA9IE1hdGguZmxvb3IodW5pcXVlU3RhdGUubWlkWCArIHIgLyBjdXJyZW50U2NhbGUgKiBNYXRoLmNvcyhjdXJyZW50QW5nbGUpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVZID0gTWF0aC5mbG9vcih1bmlxdWVTdGF0ZS5taWRZICsgciAvIGN1cnJlbnRTY2FsZSAqIE1hdGguc2luKGN1cnJlbnRBbmdsZSkpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gQ29sb3IgYW5kIEx1bWlub3NpdHkgQmxlbmQgLS0tCiAgICAgICAgICAgICAgICAgICAgaWYgKHNhbXBsZVggPj0gMCAmJiBzYW1wbGVYIDwgV0lEVEggJiYgc2FtcGxlWSA+PSAwICYmIHNhbXBsZVkgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaVNhbXBsZSA9IChzYW1wbGVZICogV0lEVEggKyBzYW1wbGVYKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBCbGVuZCBBIGFuZCBCCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJCbGVuZCA9IGRhdGFBW2lTYW1wbGVdICsgKGRhdGFCW2lTYW1wbGVdIC0gZGF0YUFbaVNhbXBsZV0pICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZ0JsZW5kID0gZGF0YUFbaVNhbXBsZSsxXSArIChkYXRhQltpU2FtcGxlKzFdIC0gZGF0YUFbaVNhbXBsZSsxXSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiQmxlbmQgPSBkYXRhQVtpU2FtcGxlKzJdICsgKGRhdGFCW2lTYW1wbGUrMl0gLSBkYXRhQVtpU2FtcGxlKzJdKSAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgTHVtaW5vc2l0eSBhdCBwZWFrIHN3aXJsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGx1bUJvb3N0ID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKSAqIDEwMDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKE1hdGgubWluKDI1NSwgckJsZW5kICsgbHVtQm9vc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKE1hdGgubWluKDI1NSwgZ0JsZW5kICsgbHVtQm9vc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKE1hdGgubWluKDI1NSwgYkJsZW5kICsgbHVtQm9vc3QpKTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgdGhlIENyZWFtbGEgU3dpcmwgKFJld2FyZCkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gNTc6IEF4aW9tIG9mIENyZWRpdCBSb2xsIENvbGxhcHNlIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzQ5XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEwMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAKICAgICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0IHJvbGxTcGVlZCA9IDIwOwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgdHJhbnNpdGlvbiBkaXNzb2x2ZXMgaW50byBzY3JvbGxpbmcsIHZlcnRpY2FsIGxpbmVzIG9mIGxpZ2h0IChzaW11bGF0aW5nIGNyZWRpdHMpLCB3aGljaCByYXBpZGx5IGNvbXByZXNzIGlud2FyZCAodGhlIGNvbGxhcHNlKSBiZWZvcmUgSW1hZ2UgQiBzbmFwcyBpbnRvIHBsYWNlLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gLS0tIDEuIENyZWRpdCBSb2xsIFNpbXVsYXRpb24gLS0tCiAgICAgICAgICAgIGNvbnN0IG9mZnNldCA9IChjdXJyZW50RnJhbWUgJSByb2xsU3BlZWQpICogKDEgLSBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgY29uc3QgbGluZVRoaWNrbmVzcyA9IDEwOwogICAgICAgICAgICBjb25zdCBudW1MaW5lcyA9IEhFSUdIVCAvIGxpbmVUaGlja25lc3M7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUxpbmVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBpICogbGluZVRoaWNrbmVzcyAtIG9mZnNldDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRHJhdyBBIGZhZGluZyBvdXQKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGBoc2woJHtpICogMTAgJSAzNjB9LCAxMDAlLCA1MCUpYDsgLy8gUmFpbmJvdyBsaW5lcyBmb3IgZnVuCiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgeSwgV0lEVEgsIGxpbmVUaGlja25lc3MgKiAwLjUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gMi4gQ29sbGFwc2UgYW5kIFNuYXAgdG8gQiAtLS0KICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIENyZWRpdCBSb2xsIENvbGxhcHNlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDU4OiBBeGlvbSBvZiBTdWJ0cmFjdGl2ZSBDcmVhdGlvbiAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s0OF0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFCOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgY2FudmFzIHN0YXJ0cyBhcyBwdXJlIHdoaXRlICh0aGUgIkFsbC1NaWdodHkiKS4gSW1hZ2UgQiBpcyByZXZlYWxlZCBieSAqc3VidHJhY3RpbmcqIHdoaXRlIChvciBhZGRpbmcgY29sb3IpIHZpYSBhIHJhZGlhbCBzd2VlcCwgcHJvdmluZyBwYXR0ZXJuIGVtZXJnZXMgZnJvbSB0aGUgbm9pc2Ugb2YgcGVyZmVjdGlvbi4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFN0YXJ0IHdpdGggd2hpdGUgKFRoZSBBbGwtTWlnaHR5IENhbnZhcykKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICd3aGl0ZSc7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG1pZFggPSBXSURUSCAvIDI7CiAgICAgICAgICAgIGNvbnN0IG1pZFkgPSBIRUlHSFQgLyAyOwogICAgICAgICAgICBjb25zdCBtYXhSID0gTWF0aC5zcXJ0KG1pZFgqbWlkWCArIG1pZFkqbWlkWSk7CgogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gbWlkWDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBtaWRZOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFJhZGlhbCB3aXBlIGZhY3RvciAocHJvcG9ydGlvbmFsIHRvIGRpc3RhbmNlIGFuZCBwcm9ncmVzcykKICAgICAgICAgICAgICAgICAgICBjb25zdCB3aXBlRmFjdG9yID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgKGVhc2VkUHJvZ3Jlc3MgKiAxLjUpIC0gKHIgLyBtYXhSICogMC41KSkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBDb2xvciBpcyBCJ3MgY29sb3IgbWl4ZWQgd2l0aCB3aGl0ZSAoMjU1KSBiYXNlZCBvbiB0aGUgd2lwZSBmYWN0b3IKICAgICAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldLCBnQiA9IGRhdGFCW2krMV0sIGJCID0gZGF0YUJbaSsyXTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZCgyNTUgKyAockIgLSAyNTUpICogd2lwZUZhY3Rvcik7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKDI1NSArIChnQiAtIDI1NSkgKiB3aXBlRmFjdG9yKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoMjU1ICsgKGJCIC0gMjU1KSAqIHdpcGVGYWN0b3IpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDNdID0gMjU1OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgU3VidHJhY3RpdmUgQ3JlYXRpb24iLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gNDc6IEF4aW9tIG9mIFB1cmUgR2VuZXJvc2l0eSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s0N10gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogSW1hZ2UgQSBpcyBzdXJyb3VuZGVkIGJ5IGEgbGFyZ2UsIHB1bHNhdGluZyBlbmVyZ3kgZ2xvdy4gVGhpcyBnbG93IHJhcGlkbHkgY29udHJhY3RzLCB0cmFuc2ZlcnJpbmcgYWxsIGl0cyBlbmVyZ3kvY29sb3IgaW50byBJbWFnZSBCLCB3aGljaCB0aGVuIGZ1bGx5IGZvcm1zLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIDEuIERyYXcgSW1hZ2UgQSAoZmFkaW5nKSBhbmQgaXRzIGVuZXJneSBhdXJhIC0tLQogICAgICAgICAgICBjb25zdCBnbG93UmFkaXVzID0gV0lEVEggKiAwLjUgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICBjb25zdCBtaWRYID0gV0lEVEggLyAyLCBtaWRZID0gSEVJR0hUIC8gMjsKCiAgICAgICAgICAgIC8vIEdyYWRpZW50IEF1cmEgKEVuZXJneSkKICAgICAgICAgICAgY29uc3QgZ3JhZGllbnQgPSBjdHguY3JlYXRlUmFkaWFsR3JhZGllbnQobWlkWCwgbWlkWSwgZ2xvd1JhZGl1cyAqIDAuMSwgbWlkWCwgbWlkWSwgZ2xvd1JhZGl1cyk7CiAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCBgcmdiYSgyNTUsIDI1NSwgMCwgJHsxIC0gZWFzZWRQcm9ncmVzc30pYCk7IC8vIEJyaWdodCBjb3JlCiAgICAgICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgxLCAncmdiYSgyNTUsIDAsIDI1NSwgMCknKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW1hZ2UgQSAoc2hyaW5raW5nL2ZhZGluZykKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlQSA9IDEgLSBlYXNlZFByb2dyZXNzICogMC41OwogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKG1pZFgsIG1pZFkpOwogICAgICAgICAgICBjdHguc2NhbGUoc2NhbGVBLCBzY2FsZUEpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgLVdJRFRILzIsIC1IRUlHSFQvMiwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgICAgICAvLyAtLS0gMi4gRHJhdyBJbWFnZSBCIChFbmVyZ3kgUmVjZWl2ZWQpIC0tLQogICAgICAgICAgICBjb25zdCBzY2FsZUIgPSAwLjUgKyBlYXNlZFByb2dyZXNzICogMC41OwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKG1pZFgsIG1pZFkpOwogICAgICAgICAgICBjdHguc2NhbGUoc2NhbGVCLCBzY2FsZUIpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgLVdJRFRILzIsIC1IRUlHSFQvMiwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIFB1cmUgR2VuZXJvc2l0eSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CiAgICAKICAgIC8vIC0tLSBBTklNQVRJT04gNjA6IEF4aW9tIG9mIHRoZSBHb29yYXJlIE1pcnJvciAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s0Nl0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBpbWFnZSBpcyBzcGxpdCBieSBhIGNlbnRyYWwsIHJhbmRvbWx5IG9zY2lsbGF0aW5nIHZlcnRpY2FsIGxpbmUuIFRoZSBsZWZ0IHNpZGUgc2hvd3MgdGhlIGN1cnJlbnQgdHJhbnNpdGlvbiBmcmFtZSAoQS0+QiBibGVuZCkuIFRoZSByaWdodCBzaWRlIHNob3dzIHRoZSAqZmluYWwqIHJlc3VsdCAoSW1hZ2UgQiksIGFjdGluZyBhcyBhICJnb29yYXJlIG1pcnJvciIgb2YgdGhlIGZ1dHVyZSB0cnV0aC4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbWlkWCA9IFdJRFRIIC8gMjsKICAgICAgICAgICAgY29uc3Qgb3NjaWxsYXRpb24gPSBNYXRoLnNpbihjdXJyZW50RnJhbWUgKiAwLjMpICogNTAgKiAoMSAtIHByb2dyZXNzKTsgLy8gT3NjaWxsYXRpb24gcmVkdWNlcyB0byB6ZXJvCgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZGl2aWRlclggPSBtaWRYICsgb3NjaWxsYXRpb247CgogICAgICAgICAgICAvLyAtLS0gMS4gTGVmdCBTaWRlOiBUcmFuc2l0aW9uIEJsZW5kIChBIC0+IEIpIC0tLQogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAvLyBEcmF3IEEKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIGRpdmlkZXJYLCBIRUlHSFQsIDAsIDAsIGRpdmlkZXJYLCBIRUlHSFQpOwogICAgICAgICAgICAvLyBCbGVuZCBCIG92ZXIgQQogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBwcm9ncmVzczsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGRpdmlkZXJYLCBIRUlHSFQsIDAsIDAsIGRpdmlkZXJYLCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gLS0tIDIuIFJpZ2h0IFNpZGU6IFRoZSBHb29yYXJlIE1pcnJvciAoUHVyZSBCKSAtLS0KICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIGRpdmlkZXJYLCAwLCBXSURUSCAtIGRpdmlkZXJYLCBIRUlHSFQsIGRpdmlkZXJYLCAwLCBXSURUSCAtIGRpdmlkZXJYLCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gRHJhdyBhIGJyaWdodCBsaW5lIHdoZXJlIHRoZSBtaXJyb3IgbWVldHMgdGhlIHByZXNlbnQKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICd3aGl0ZSc7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdChkaXZpZGVyWCAtIDEsIDAsIDIsIEhFSUdIVCk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQXhpb20gb2YgdGhlIEdvb3JhcmUgTWlycm9yIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKICAgIAogICAgLy8gLS0tIEFOSU1BVElPTiA2MTogQXhpb20gb2YgRmluYWwgU3luY2hyb25pemF0aW9uIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzQ1XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE4MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgICAgIHRpbGVzOiBbXQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gTW9jayBsaXN0IG9mIHByZXZpb3VzIGFuaW1hdGlvbiB0eXBlcyAoaW5kZXhlZCAwLTYwKQogICAgICAgIGNvbnN0IHRyYW5zaXRpb25UeXBlcyA9IFswLCA1LCAxMiwgMTksIDI3LCAzMywgNDAsIDQ4LCA1MCwgNTMsIDU3XTsgLy8gQSBzYW1wbGUgb2YgZGl2ZXJzZSBpbmRpY2VzCgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCB0aWxlU2l6ZSA9IDQwOwogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSB0aWxlU2l6ZSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSB0aWxlU2l6ZSkgewogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LCBzaXplOiB0aWxlU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogdHJhbnNpdGlvblR5cGVzW01hdGguZmxvb3Iod2llbHNpZWRlcigpICogdHJhbnNpdGlvblR5cGVzLmxlbmd0aCldLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogNTAKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIGVudGlyZSBpbWFnZSBpcyBkaXZpZGVkIGludG8gc21hbGwgdGlsZXMuIEVhY2ggdGlsZSBwZXJmb3JtcyBhIGRpZmZlcmVudCwgcGFzdCB0cmFuc2l0aW9uIHR5cGUgKHdpcGUsIHN3aXJsLCBzaGF0dGVyLCBmbGFzaCwgZXRjLiksIGFsbCBzeW5jaHJvbml6ZWQgdG8gcmVzb2x2ZSBpbnRvIEltYWdlIEIgYXQgdGhlIGV4YWN0IHNhbWUgZmluYWwgZnJhbWUuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzLmZvckVhY2godGlsZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gY3VycmVudEZyYW1lIC0gdGlsZS5kZWxheTsKICAgICAgICAgICAgICAgIGlmICh0aW1lIDwgMCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGxldCB0aWxlUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCB0aW1lIC8gKHRvdGFsRnJhbWVzIC0gdGlsZS5kZWxheSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAtLS0gTU9DSyBUUkFOU0lUSU9OIExPR0lDIChVc2VzIGEgc3dpcmwgZm9yIGFsbCBhcyBhIHBsYWNlaG9sZGVyKSAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBNYXRoLnNpbih0aWxlUHJvZ3Jlc3MgKiBNYXRoLlBJKTsgLy8gUGVhayBkaXN0b3J0aW9uIGF0IDUwJQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBjeCA9IHRpbGUueCArIHRpbGUuc2l6ZSAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IHRpbGUueSArIHRpbGUuc2l6ZSAvIDI7CgogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoY3gsIGN5KTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoZWFzZWRQcm9ncmVzcyAqIE1hdGguUEkgKiAwLjIpOyAvLyBTbWFsbCBzeW5jaHJvbml6ZWQgcm90YXRpb24KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRHJhdyBJbWFnZSBCIG92ZXIgdGhlIHRpbGUKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRpbGVQcm9ncmVzczsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlLCAKICAgICAgICAgICAgICAgICAgICB0aWxlLngsIHRpbGUueSwgdGlsZS5zaXplLCB0aWxlLnNpemUsIC8vIFNvdXJjZSBCCiAgICAgICAgICAgICAgICAgICAgLXRpbGUuc2l6ZSAvIDIsIC10aWxlLnNpemUgLyAyLCB0aWxlLnNpemUsIHRpbGUuc2l6ZSAvLyBEZXN0aW5hdGlvbgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIkF4aW9tIG9mIEZpbmFsIFN5bmNocm9uaXphdGlvbiIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgoKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAtLS0gVFdFTFZFIE5FVywgUElMTEFSUyBPRiBVTkRSSVZFTiBST0FEUyBBTklNQVRJT05TIChJbmRpY2VzIDM4LTQ5KSAtLS0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8vIC0tLSBBTklNQVRJT04gMzg6IFBpbGxhciBvZiB0aGUgTnVsbC1TZXQgTWV0cmljIC0tLQpBTklNQVRJT05fTE9HSUNbNDRdID0gKGZ1bmN0aW9uKCkgewogICAgLy8gKipPcHRpbWl6YXRpb24gVGlwOiBUcnkgaW5jcmVhc2luZyBCQVNFX0JMT0NLX1NJWkUgdG8gcmVkdWNlIGxvb3AgaXRlcmF0aW9ucyAoZS5nLiwgZnJvbSA1IHRvIDEwIG9yIDE1KS4qKgogICAgY29uc3QgQkFTRV9CTE9DS19TSVpFID0gMTA7IC8vIEluY3JlYXNlZCBmcm9tIDUgZm9yIGJldHRlciBwZXJmb3JtYW5jZQogICAgCiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXNiYjogMTAwLAogICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgIHBpeGVsczogW10sCiAgICAgICAgYmxvY2tTaXplOiBCQVNFX0JMT0NLX1NJWkUgLy8gVXNlIHRoZSBkZWZpbmVkIGNvbnN0YW50CiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVscyA9IFtdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGJsb2NrU2l6ZSA9IHVuaXF1ZVN0YXRlLmJsb2NrU2l6ZTsgLy8gQ2FjaGVkCgogICAgICAgIGlmIChjdXJyZW50RnJhbWUgPj0gdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgIC8vIEZpbmFsIGNsZWFudXAgZHJhdyBiZWZvcmUgZW5kaW5nCiAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgICByZXR1cm47IC8vIFN0b3AgZXhlY3V0aW9uCiAgICAgICAgfQoKICAgICAgICAvLyBQcmUtY2FsY3VsYXRlIHBlci1mcmFtZSBjb25zdGFudHMgCiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwogICAgICAgIGNvbnN0IHZpYnJhdGlvblN0cmVuZ3RoID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKSAqIDEwOyAvLyBQZWFrIHZpYnJhdGlvbiBhdCA1MCUKICAgICAgICAKICAgICAgICAvLyBQcmUtY2FsY3VsYXRlIGxvb3AgbGltaXRzIGFuZCBzdGVwCiAgICAgICAgY29uc3QgbGltaXRYID0gV0lEVEg7CiAgICAgICAgY29uc3QgbGltaXRZID0gSEVJR0hUOwogICAgICAgIGNvbnN0IHN0ZXAgPSBibG9ja1NpemU7CgogICAgICAgIC8vIC0tLSBEcmF3aW5nIE9wZXJhdGlvbnMgLS0tCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJzsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgIC8vIC0tLSBTb3VyY2UgSW1hZ2UgQSAoRGlzc29sdmVzKSAtLS0KICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGxpbWl0WTsgeSArPSBzdGVwKSB7CiAgICAgICAgICAgIC8vIFByZS1jYWxjdWxhdGUgWS1kZXBlbmRlbnQgb2Zmc2V0IGNvbXBvbmVudAogICAgICAgICAgICBjb25zdCBjb3NfeV9vZmZzZXQgPSBNYXRoLmNvcyh5ICogMC4xIC0gY3VycmVudEZyYW1lICogMC4xKSAqIHZpYnJhdGlvblN0cmVuZ3RoOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBsaW1pdFg7IHggKz0gc3RlcCkgewogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHBvc2l0aW9uLWRlcGVuZGVudCBvZmZzZXRzCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXRYID0gTWF0aC5zaW4oeCAqIDAuMSArIGN1cnJlbnRGcmFtZSAqIDAuMTUpICogdmlicmF0aW9uU3RyZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXRZID0gY29zX3lfb2Zmc2V0OyAvLyBSZS11c2UgdGhlIFktY29tcG9uZW50CgogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UsIAogICAgICAgICAgICAgICAgICAgIHgsIHksIGJsb2NrU2l6ZSwgYmxvY2tTaXplLCAvLyBTb3VyY2UgcmVjdGFuZ2xlCiAgICAgICAgICAgICAgICAgICAgeCArIG9mZnNldFgsIHkgKyBvZmZzZXRZLCBibG9ja1NpemUsIGJsb2NrU2l6ZSAvLyBEZXN0aW5hdGlvbiByZWN0YW5nbGUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gLS0tIERlc3RpbmF0aW9uIEltYWdlIEIgKEZvcm1zKSAtLS0KICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFByb2dyZXNzOwogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgbGltaXRZOyB5ICs9IHN0ZXApIHsKICAgICAgICAgICAgLy8gUHJlLWNhbGN1bGF0ZSBZLWRlcGVuZGVudCBvZmZzZXQgY29tcG9uZW50IChyZS11c2UpCiAgICAgICAgICAgIGNvbnN0IGNvc195X29mZnNldCA9IE1hdGguY29zKHkgKiAwLjEgLSBjdXJyZW50RnJhbWUgKiAwLjEpICogdmlicmF0aW9uU3RyZW5ndGg7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGxpbWl0WDsgeCArPSBzdGVwKSB7CiAgICAgICAgICAgICAgICAvLyBDYWxjdWxhdGUgcG9zaXRpb24tZGVwZW5kZW50IG9mZnNldHMKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFggPSBNYXRoLnNpbih4ICogMC4xICsgY3VycmVudEZyYW1lICogMC4xNSkgKiB2aWJyYXRpb25TdHJlbmd0aDsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFkgPSBjb3NfeV9vZmZzZXQ7IC8vIFJlLXVzZSB0aGUgWS1jb21wb25lbnQKCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSwgCiAgICAgICAgICAgICAgICAgICAgeCwgeSwgYmxvY2tTaXplLCBibG9ja1NpemUsIC8vIFNvdXJjZSByZWN0YW5nbGUKICAgICAgICAgICAgICAgICAgICB4IC0gb2Zmc2V0WCwgeSAtIG9mZnNldFksIGJsb2NrU2l6ZSwgYmxvY2tTaXplIC8vIERlc3RpbmF0aW9uIHJlY3RhbmdsZSAoTm90ZSB0aGUgc3VidHJhY3Rpb24gZm9yIHRoZSAnb3Bwb3NpdGUnIGVmZmVjdCkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFJlc2V0IGdsb2JhbEFscGhhIGZvciBzdWJzZXF1ZW50IGRyYXdzCiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICB9CgogICAgcmV0dXJuIHsgdGl0bGU6ICJQaWxsYXIgb2YgdGhlIE51bGwtU2V0IE1ldHJpYyIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDM5OiBQaWxsYXIgb2YgTm9uLVJlY2lwcm9jYWwgVGltZSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1s0M10gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBtaWRYOiBXSURUSCAvIDIsIG1pZFk6IEhFSUdIVCAvIDIKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBJbWFnZSBBIHN3aXJscyBpbndhcmQgKGFjY2VsZXJhdGluZyBlbnRyb3B5KSB3aGlsZSBJbWFnZSBCIHN3aXJscyBvdXR3YXJkIChhbnRpLWVudHJvcHkpLiBUaGV5IG1lZXQgYXQgdGhlIGNlbnRlciBwb2ludCBpbiBhIGNvbGxpc2lvbiBvZiBmb3J3YXJkIGFuZCBiYWNrd2FyZCB0aW1lLCB0aGUgbW9tZW50IG9mIG5vbi1yZWNpcHJvY2FsIGV4aXN0ZW5jZS4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbWF4QW5nbGUgPSBNYXRoLlBJICogNDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gMS4gRHJhdyBJbWFnZSBBIChTd2lybCBJTikgLS0tCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUodW5pcXVlU3RhdGUubWlkWCwgdW5pcXVlU3RhdGUubWlkWSk7CiAgICAgICAgICAgIGN0eC5yb3RhdGUobWF4QW5nbGUgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpKTsgLy8gU3dpcmxzIHRvIHplcm8gcm90YXRpb24KICAgICAgICAgICAgY3R4LnNjYWxlKDEgLSBlYXNlZFByb2dyZXNzICogMC41LCAxIC0gZWFzZWRQcm9ncmVzcyAqIDAuNSk7IC8vIFNocmlua3Mgc2xpZ2h0bHkKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAtV0lEVEgvMiwgLUhFSUdIVC8yLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgIC8vIC0tLSAyLiBEcmF3IEltYWdlIEIgKFN3aXJsIE9VVCkgLS0tCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUodW5pcXVlU3RhdGUubWlkWCwgdW5pcXVlU3RhdGUubWlkWSk7CiAgICAgICAgICAgIGN0eC5yb3RhdGUobWF4QW5nbGUgKiBlYXNlZFByb2dyZXNzKTsgLy8gU3dpcmxzIG91dHdhcmQKICAgICAgICAgICAgY3R4LnNjYWxlKDAuNSArIGVhc2VkUHJvZ3Jlc3MgKiAwLjUsIDAuNSArIGVhc2VkUHJvZ3Jlc3MgKiAwLjUpOyAvLyBFeHBhbmRzIGZyb20gY2VudGVyCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAtV0lEVEgvMiwgLUhFSUdIVC8yLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiUGlsbGFyIG9mIE5vbi1SZWNpcHJvY2FsIFRpbWUiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwogICAgCiAgICAvLyAtLS0gQU5JTUFUSU9OIDQwOiBQaWxsYXIgb2YgQ29uZGl0aW9uLVRydWUvRmFsc2UgSW1wbG9zaW9uIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzQyXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE2MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgICAgIHJhZGl1czogMAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnJhZGl1cyA9IE1hdGgubWF4KFdJRFRILCBIRUlHSFQpICogMC43OyAvLyBNYXggc3BoZXJlIHNpemUKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBpbWFnZSBkYXRhIGlzIHByb2plY3RlZCBvbnRvIGEgM0Qgc3BoZXJlIHRoYXQgaW1wbG9kZXMgaW50byBhIHNpbmdsZSAyRCBwb2ludCAod2hlcmUgVHJ1ZT1GYWxzZSkuIEl0IHRoZW4gcmUtZXhwbG9kZXMsIHJlc29sdmluZyBpbnRvIHRoZSBuZXcgaW1hZ2UuIEEgdmlzdWFsIHJlcHJlc2VudGF0aW9uIG9mIGNvbmRpdGlvbmFsIGxvZ2ljIGNvbGxhcHNpbmcuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7IC8vIEltcGxvZGUgYW5kIEV4cGxvZGUgZWZmZWN0CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBtaWRYID0gV0lEVEggLyAyOwogICAgICAgICAgICBjb25zdCBtaWRZID0gSEVJR0hUIC8gMjsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSYWRpdXMgPSB1bmlxdWVTdGF0ZS5yYWRpdXMgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICBjb25zdCBwaXhlbFNpemUgPSAxOwoKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gcGl4ZWxTaXplICogNCkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBwaXhlbFNpemUgKiA0KSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDEuIENvbG9yIEludGVycG9sYXRpb24gLS0tCiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YVtpXSArICh1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGFbaV0gLSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBLmRhdGFbaV0pICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZyA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YVtpKzFdICsgKHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpKzFdIC0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhW2krMV0pICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YVtpKzJdICsgKHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpKzJdIC0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhW2krMl0pICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDIuIFNwaGVyaWNhbCBQcm9qZWN0aW9uIChJbXBsb3Npb24pIC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0geCAtIG1pZFg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHkgPSB5IC0gbWlkWTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBQcm9qZWN0IHRoZSBwaXhlbCBhd2F5IGZyb20gdGhlIGNlbnRlciBwcm9wb3J0aW9uYWwgdG8gdGhlIGltcGxvc2lvbgogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RlZFggPSBtaWRYICsgZHggKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RlZFkgPSBtaWRZICsgZHkgKiBlYXNlZFByb2dyZXNzOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMy4gRHJhdyAtLS0KICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiKCR7cn0sICR7Z30sICR7Yn0pYDsKICAgICAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QocHJvamVjdGVkWCwgcHJvamVjdGVkWSwgcGl4ZWxTaXplLCBwaXhlbFNpemUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiUGlsbGFyIG9mIENvbmRpdGlvbi1UcnVlL0ZhbHNlIEltcGxvc2lvbiIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiA0MTogUGlsbGFyIG9mIHRoZSBBbGVwaC1OdWxsIENhc2NhZGUgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbNDFdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTgwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMAogICAgICAgIH07CiAgICAgICAgY29uc3QgbWF4Q2FzY2FkZXMgPSA1OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgaW1hZ2UgZGlzc29sdmVzIGludG8gYW4gaW5maW5pdGUgKEFsZXBoLW51bGwpIHNlcXVlbmNlIG9mIHNtYWxsZXIsIG5lc3RlZCwgc2VsZi1zaW1pbGFyIGNvcGllcywgY2FzY2FkaW5nIGlud2FyZC4gVGhlIHNtYWxsZXN0IGNvcGllcyByZXNvbHZlIGZpcnN0IGludG8gdGhlIG5ldyBpbWFnZSwgd2hpY2ggcHJvcGFnYXRlcyBvdXR3YXJkLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgY29uc3QgbWlkWCA9IFdJRFRIIC8gMjsKICAgICAgICAgICAgY29uc3QgbWlkWSA9IEhFSUdIVCAvIDI7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG1heENhc2NhZGVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNhc2NhZGVTY2FsZSA9IE1hdGgucG93KDAuNSwgaSArIDEpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUcmFuc2l0aW9uIHBoYXNlIGZvciB0aGlzIGNhc2NhZGUgKGRlbGF5ZWQgZm9yIGlubmVyIGNhc2NhZGVzKQogICAgICAgICAgICAgICAgY29uc3QgY2FzY2FkZVByb2dyZXNzID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgZWFzZWRQcm9ncmVzcyAqIDEuNSAtIChpIC8gbWF4Q2FzY2FkZXMpKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY2FsZSA9IDEgLSAoMSAtIGNhc2NhZGVTY2FsZSkgKiBjYXNjYWRlUHJvZ3Jlc3M7CgogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUobWlkWCwgbWlkWSk7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoY3VycmVudFNjYWxlLCBjdXJyZW50U2NhbGUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBEcmF3IEltYWdlIEEgKENhc2NhZGluZyBpbndhcmQsIGZhZGluZyBvdXQpCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gY2FzY2FkZVByb2dyZXNzOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIC1XSURUSC8yLCAtSEVJR0hULzIsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgICAgIC8vIERyYXcgSW1hZ2UgQiAoQ2FzY2FkaW5nIG91dHdhcmQsIGZhZGluZyBpbikKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGNhc2NhZGVQcm9ncmVzczsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAtV0lEVEgvMiwgLUhFSUdIVC8yLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJQaWxsYXIgb2YgdGhlIEFsZXBoLU51bGwgQ2FzY2FkZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgCgogICAgLy8gLS0tIEFOSU1BVElPTiA0MzogUGlsbGFyIG9mIFF1YW50dW0gRW50YW5nbGVkIEZvcm0gLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMzldID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwgaW1hZ2VEYXRhQjogbnVsbAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBQaXhlbHMgQSBhbmQgQiBhcmUgc2ltdWx0YW5lb3VzbHkgcHJlc2VudCAoZW50YW5nbGVkKS4gSW1hZ2UgQSBpcyByZW5kZXJlZCB3aXRoIGNoYW90aWMgJ2FudGktcGl4ZWxhdGlvbicgd2hpbGUgSW1hZ2UgQiBpcyBjbGVhciwgYW5kIHRoZXkgc3dhcCByb2xlcyBhdCB0aGUgNTAlIG1hcmvigJRhIG1vbWVudCBvZiB6ZXJvIHVuY2VydGFpbnR5LioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQiA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNoYW9zU3RyZW5ndGggPSBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpICogMTA7IC8vIE1heCBjaGFvcyBhdCA1MCUKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAxLiBFbnRhbmdsZW1lbnQgU2hpZnQgLS0tCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIHRyYW5zaXRpb24gb2YgZm9ybSAoQSB0byBCKSBpcyBpbnN0YW50IGF0IDUwJSBidXQgdGhlIENIQU9TIHNoaWZ0cwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZUEgPSBwcm9ncmVzcyA8IDAuNSA/IDEgOiAwOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZUIgPSAxIC0gdXNlQTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMi4gQ2hhb3MgTWFwcGluZyAoU2hpZnQgaW4gb3Bwb3NpdGlvbiB0byBmb3JtKSAtLS0KICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGFvc01hcFggPSBNYXRoLmZsb29yKHggKyBwZXJsaW5Ob2lzZSh4LCB5LCBjdXJyZW50RnJhbWUgKiAwLjEpICogY2hhb3NTdHJlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hhb3NNYXBZID0gTWF0aC5mbG9vcih5ICsgcGVybGluTm9pc2UoeCwgeSwgY3VycmVudEZyYW1lICogMC4xKSAqIGNoYW9zU3RyZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlDaGFvcyA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRhdGFBLmxlbmd0aCAtIDQsIChjaGFvc01hcFkgKiBXSURUSCArIGNoYW9zTWFwWCkgKiA0KSk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAzLiBGaW5hbCBDb2xvciAoQSBpcyBjbGVhciwgQiBpcyBjaGFvdGljLCB0aGVuIHRoZXkgc3dhcCkgLS0tCiAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSAwLCBnID0gMCwgYiA9IDA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gV2hlbiBwcm9ncmVzcyA8IDAuNTogQSBpcyB0aGUgYmFzZSBjb2xvciAoMS1lYXNlZFByb2dyZXNzKSwgQiBpcyB0aGUgY2hhb3RpYyBjb2xvciAoZWFzZWRQcm9ncmVzcykKICAgICAgICAgICAgICAgICAgICAvLyBXaGVuIHByb2dyZXNzID4gMC41OiBBIGlzIGNoYW90aWMsIEIgaXMgdGhlIGJhc2UKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUIgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEEgaXMgZHJhd24gY2xlYXIgZm9yIHRoZSBmaXJzdCBoYWxmLCBCIGlzIGRyYXduIGNoYW90aWMKICAgICAgICAgICAgICAgICAgICByID0gZGF0YUFbaV0gKiBhbHBoYUEgKyBkYXRhQltpQ2hhb3NdICogYWxwaGFCOwogICAgICAgICAgICAgICAgICAgIGcgPSBkYXRhQVtpKzFdICogYWxwaGFBICsgZGF0YUJbaUNoYW9zKzFdICogYWxwaGFCOwogICAgICAgICAgICAgICAgICAgIGIgPSBkYXRhQVtpKzJdICogYWxwaGFBICsgZGF0YUJbaUNoYW9zKzJdICogYWxwaGFCOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgY29tcGxleCwgYnV0IHNpbXBsaWZpZXMgdGhlIGlkZWEgb2Ygb25lIGNsZWFyIGZvcm0gYmVpbmcgb3ZlcnNoYWRvd2VkIGJ5IHRoZSBjaGFvdGljIGFudGktZm9ybS4KICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyk7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDNdID0gMjU1OyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlBpbGxhciBvZiBRdWFudHVtIEVudGFuZ2xlZCBGb3JtIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDQ0OiBQaWxsYXIgb2YgdGhlIEluY29oZXJlbnQgVGVzc2VyYWN0IC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzM4XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE4MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAKICAgICAgICB9OwogICAgICAgIAogICAgICAgIGNvbnN0IGN1YmVTaXplID0gMjUwOyAKICAgICAgICBjb25zdCBmYWNlcyA9IFsgCiAgICAgICAgICAgIHt4OiAwLCB5OiAtY3ViZVNpemUsIHo6IDB9LCAvLyBUb3AKICAgICAgICAgICAge3g6IDAsIHk6IGN1YmVTaXplLCB6OiAwfSwgIC8vIEJvdHRvbQogICAgICAgICAgICB7eDogLWN1YmVTaXplLCB5OiAwLCB6OiAwfSwgLy8gTGVmdAogICAgICAgICAgICB7eDogY3ViZVNpemUsIHk6IDAsIHo6IDB9LCAgLy8gUmlnaHQKICAgICAgICAgICAge3g6IDAsIHk6IDAsIHo6IC1jdWJlU2l6ZX0sIC8vIEJhY2sKICAgICAgICAgICAge3g6IDAsIHk6IDAsIHo6IGN1YmVTaXplfSAgIC8vIEZyb250CiAgICAgICAgXTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIDJEIGltYWdlIHVuZm9sZHMgaW50byBhIDNEIGN1YmUgKGEgVGVzc2VyYWN0IHByb2plY3Rpb24pLCByb3RhdGVzIGluY29oZXJlbnRseSB0byBicmVhayBpdHMgc3RydWN0dXJlLCBhbmQgdGhlbiBmb2xkcyBiYWNrIGludG8gYSAyRCBpbWFnZSBvZiB0aGUgbmV3IGRhdGEuIFZpc3VhbGl6aW5nIGEgNEQgY29uY2VwdCBpbiAyRC4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IG1pZFggPSBXSURUSCAvIDI7CiAgICAgICAgICAgIGNvbnN0IG1pZFkgPSBIRUlHSFQgLyAyOwogICAgICAgICAgICBjb25zdCB2aWV3RGlzdCA9IDgwMDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHJvdFNwZWVkID0gY3VycmVudEZyYW1lICogMC4wMjsKICAgICAgICAgICAgY29uc3QgdW5mb2xkRmFjdG9yID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKSAqIDEuNTsgLy8gTWF4IGV4dGVuc2lvbiBhdCA1MCUKCiAgICAgICAgICAgIGZhY2VzLmZvckVhY2goKGZhY2UsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBsZXQgeCA9IGZhY2UueCAqIHVuZm9sZEZhY3RvcjsKICAgICAgICAgICAgICAgIGxldCB5ID0gZmFjZS55ICogdW5mb2xkRmFjdG9yOwogICAgICAgICAgICAgICAgbGV0IHogPSBmYWNlLnogKiB1bmZvbGRGYWN0b3I7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNpbXBsZSAzRCByb3RhdGlvbgogICAgICAgICAgICAgICAgY29uc3QgdGVtcFkgPSB5ICogTWF0aC5jb3Mocm90U3BlZWQpIC0geiAqIE1hdGguc2luKHJvdFNwZWVkKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBaID0geSAqIE1hdGguc2luKHJvdFNwZWVkKSArIHogKiBNYXRoLmNvcyhyb3RTcGVlZCk7CiAgICAgICAgICAgICAgICB5ID0gdGVtcFk7IHogPSB0ZW1wWjsKCiAgICAgICAgICAgICAgICBjb25zdCB0ZW1wWCA9IHggKiBNYXRoLmNvcyhyb3RTcGVlZCAqIDAuNSkgKyB6ICogTWF0aC5zaW4ocm90U3BlZWQgKiAwLjUpOwogICAgICAgICAgICAgICAgY29uc3QgZmluYWxaID0gLXggKiBNYXRoLnNpbihyb3RTcGVlZCAqIDAuNSkgKyB6ICogTWF0aC5jb3Mocm90U3BlZWQgKiAwLjUpOwogICAgICAgICAgICAgICAgeCA9IHRlbXBYOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQZXJzcGVjdGl2ZSBwcm9qZWN0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZSA9IHZpZXdEaXN0IC8gKHZpZXdEaXN0ICsgZmluYWxaKTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsWCA9IG1pZFggKyB4ICogc2NhbGU7CiAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFkgPSBtaWRZICsgeSAqIHNjYWxlOwogICAgICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IGN1YmVTaXplICogMiAqIHNjYWxlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAtLS0gRHJhdyBDdWJlIEZhY2UgLS0tCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShmaW5hbFgsIGZpbmFsWSk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gTWF0aC5hYnMocHJvZ3Jlc3MgLSAwLjUpICogMjsgLy8gRmFkZSBpbiBhbmQgb3V0IGF0IHBlYWsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gSW1hZ2UgQSBmYWRlcyBvdXQKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCBpbmRleCAqIGN1YmVTaXplLCAwLCBjdWJlU2l6ZSwgY3ViZVNpemUsIC1zaXplLzIsIC1zaXplLzIsIHNpemUsIHNpemUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBJbWFnZSBCIGZhZGVzIGluCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBNYXRoLmFicyhwcm9ncmVzcyAtIDAuNSkgKiAyOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIGluZGV4ICogY3ViZVNpemUsIDAsIGN1YmVTaXplLCBjdWJlU2l6ZSwgLXNpemUvMiwgLXNpemUvMiwgc2l6ZSwgc2l6ZSk7CgogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlBpbGxhciBvZiB0aGUgSW5jb2hlcmVudCBUZXNzZXJhY3QiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwogICAgCiAgICAvLyAtLS0gQU5JTUFUSU9OIDQ1OiBQaWxsYXIgb2YgQWJzdHJhY3QgV2F2ZSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1szN10gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIC8vIEhlbHBlciB0byBjb252ZXJ0IFJHQiB0byBIU0wgYW5kIGJhY2sKICAgICAgICBjb25zdCByZ2JUb0hzbCA9IChyLCBnLCBiKSA9PiB7CiAgICAgICAgICAgIC8vIC4uLiAoY29tcGxleCBIU0wgY29udmVyc2lvbiBsb2dpYyBvbWl0dGVkIGZvciBicmV2aXR5LCBidXQgYXNzdW1lZCB0byBleGlzdCkKICAgICAgICAgICAgLy8gU2ltcGxpZmllZCByZXR1cm4gZm9yIGRlbW9uc3RyYXRpb246IFtoLCBzLCBsXQogICAgICAgICAgICByZXR1cm4gWzAsIDAuNSwgKHIrZytiKS8zIC8gMjU1XTsgCiAgICAgICAgfTsKICAgICAgICBjb25zdCBoc2xUb1JnYiA9IChoLCBzLCBsKSA9PiB7CiAgICAgICAgICAgIC8vIC4uLiAoY29tcGxleCBIU0wgdG8gUkdCIGNvbnZlcnNpb24gbG9naWMgb21pdHRlZCBmb3IgYnJldml0eSwgYnV0IGFzc3VtZWQgdG8gZXhpc3QpCiAgICAgICAgICAgIC8vIFNpbXBsaWZpZWQgcmV0dXJuIGZvciBkZW1vbnN0cmF0aW9uOiBbciwgZywgYl0KICAgICAgICAgICAgcmV0dXJuIFtsKjI1NSwgbCoyNTUsIGwqMjU1XTsKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBBIHNpbmdsZSwgc3RydWN0dXJhbCB3YXZlIHRyYXZlbHMgYWNyb3NzIHRoZSBpbWFnZSwgY2hhbmdpbmcgb25seSB0aGUgKmh1ZSogKHRoZSBhYnN0cmFjdCBjb25jZXB0KSBvZiBlYWNoIHBpeGVsLCBub3QgaXRzIHBvc2l0aW9uIG9yIGx1bWlub3NpdHkuIFRoaXMgaXMgZm9sbG93ZWQgYnkgYW4gaW5zdGFudGFuZW91cyBzdHJ1Y3R1cmFsIHNuYXAgaW50byB0aGUgbmV3IGltYWdlIChCKS4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZU91dFF1YWQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQSA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGE7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBXYXZlZnJvbnQgcG9zaXRpb24gYW5kIHdpZHRoCiAgICAgICAgICAgIGNvbnN0IHdhdmVDZW50ZXIgPSBXSURUSCAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIGNvbnN0IHdhdmVXaWR0aCA9IDEwMDsKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RUb1dhdmUgPSBNYXRoLmFicyh4IC0gd2F2ZUNlbnRlcik7CiAgICAgICAgICAgICAgICAgICAgLy8gQmxlbmRpbmcgZmFjdG9yIGJhc2VkIG9uIGRpc3RhbmNlIGZyb20gdGhlIHdhdmUgY2VudGVyCiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmxlbmRGYWN0b3IgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCAxIC0gZGlzdFRvV2F2ZSAvIHdhdmVXaWR0aCkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJBID0gZGF0YUFbaV0sIGdBID0gZGF0YUFbaSsxXSwgYkEgPSBkYXRhQVtpKzJdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJCID0gZGF0YUJbaV0sIGdCID0gZGF0YUJbaSsxXSwgYkIgPSBkYXRhQltpKzJdOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMS4gUHVyZSBTdHJ1Y3R1cmFsIEJsZW5kIChUaGUgJ1NuYXAnIHBvcnRpb24pIC0tLQogICAgICAgICAgICAgICAgICAgIGxldCByID0gckEgKyAockIgLSByQSkgKiBwcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBsZXQgZyA9IGdBICsgKGdCIC0gZ0EpICogcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgbGV0IGIgPSBiQSArIChiQiAtIGJBKSAqIHByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAyLiBIdWUgTWFuaXB1bGF0aW9uIChUaGUgJ1dhdmUnIHBvcnRpb24pIC0tLQogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgc2VjdGlvbiB3b3VsZCBhcHBseSBhIGh1ZSBzaGlmdCBiYXNlZCBvbiBibGVuZEZhY3RvciwgYnV0IEhTTCBjb252ZXJzaW9uIGlzIHRvbyBjb21wbGV4IGZvciB0aGlzIGNvbnRleHQuCiAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCwgd2UgZXhhZ2dlcmF0ZSB0aGUgUiBjb21wb25lbnQgYXQgdGhlIHdhdmUgY2VudGVyIHRvIHN5bWJvbGl6ZSB0aGUgYWJzdHJhY3Qgc2hpZnQuCiAgICAgICAgICAgICAgICAgICAgciA9IHIgKyAoTWF0aC5zaW4oY3VycmVudEZyYW1lICogMC41KSAqIDUwKSAqIGJsZW5kRmFjdG9yICogKDEtcHJvZ3Jlc3MpOwoKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyk7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDNdID0gMjU1OyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlBpbGxhciBvZiBBYnN0cmFjdCBXYXZlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDQ2OiBQaWxsYXIgb2YgMT0wIENvbnZlcmdlbmNlIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzM2XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEyMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgaW1hZ2UgKDEpIGNvbXByZXNzZXMgaW53YXJkIGJ1dCBuZXZlciByZWFjaGVzIHRoZSBjZW50ZXIuIEl0IHNuYXBzIGludG8gYSBjb21wbGV0ZSB3aGl0ZSB2b2lkICgwKSwgd2hpY2ggaXMgdGhlIGluc3RhbnQgYmVmb3JlIHRoZSBuZXcgaW1hZ2UgZm9ybXMuIFRoZSB1bHRpbWF0ZSBsaW1pdCBwYXJhZG94IHZpc3VhbGl6ZWQuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENvbXByZXNzaW9uIGZhY3RvciAoYXBwcm9hY2hlcyAxLCBuZXZlciByZWFjaGVzIGl0KQogICAgICAgICAgICBjb25zdCBjb21wcmVzc0ZhY3RvciA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKSAqIDAuOTk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQWxwaGEgZm9yIHRoZSB3aGl0ZSBmbGFzaCAocGVhayBhdCA1MCUpCiAgICAgICAgICAgIGNvbnN0IGZsYXNoQWxwaGEgPSBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpICogMS41OwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSAxLiBJbWFnZSBBICgxKSBDb21wcmVzc2lvbiAtLS0KICAgICAgICAgICAgY29uc3Qgc2NhbGVBID0gMSAtIGNvbXByZXNzRmFjdG9yOwogICAgICAgICAgICBjb25zdCBtaWRYID0gV0lEVEggLyAyOwogICAgICAgICAgICBjb25zdCBtaWRZID0gSEVJR0hUIC8gMjsKCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUobWlkWCwgbWlkWSk7CiAgICAgICAgICAgIGN0eC5zY2FsZShzY2FsZUEsIHNjYWxlQSk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBwcm9ncmVzczsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIC1XSURUSC8yLCAtSEVJR0hULzIsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIDIuIFdoaXRlIFZvaWQgKDApIEZsYXNoIC0tLQogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBmbGFzaEFscGhhOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3doaXRlJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgLy8gLS0tIDMuIEltYWdlIEIgRW1lcmdlbmNlIC0tLQogICAgICAgICAgICBjb25zdCBzY2FsZUIgPSBjb21wcmVzc0ZhY3RvcjsKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShtaWRYLCBtaWRZKTsKICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlQiwgc2NhbGVCKTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gcHJvZ3Jlc3M7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAtV0lEVEgvMiwgLUhFSUdIVC8yLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiUGlsbGFyIG9mIDE9MCBDb252ZXJnZW5jZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiA0NzogUGlsbGFyIG9mIEluZmluaXRlIE5vbi1Mb2NhbGl0eSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1szNV0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxNDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLCBpbWFnZURhdGFCOiBudWxsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEltYWdlIEEncyB0b3AgaGFsZiBibGVuZHMgd2l0aCBCJ3MgYm90dG9tIGhhbGYsIGFuZCB2aWNlLXZlcnNhLCBzZXBhcmF0ZWQgYnkgYSByYW5kb20sIHNoaWZ0aW5nIGN1cnZlLCBzaG93aW5nIHRoYXQgaW5mb3JtYXRpb24gaXMgbm9uLWxvY2FsIGFuZCBjYW4gYmUgcmVjb21iaW5lZCBhY3Jvc3MgcGFyYWRveGljYWwgYm91bmRhcmllcy4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQSA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGE7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOb24tRXVjbGlkZWFuIGRpdmlkaW5nIGxpbmUsIGEgc2luZSB3YXZlIGluZmx1ZW5jZWQgYnkgdGltZQogICAgICAgICAgICBjb25zdCBhbXBsaXR1ZGUgPSA1MDsKICAgICAgICAgICAgY29uc3QgZnJlcXVlbmN5ID0gMC4wNTsKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIC8vIEJhc2UgZGl2aWRlciBsaW5lIGF0IEhFSUdIVCAvIDIKICAgICAgICAgICAgICAgIGNvbnN0IGJhc2VEaXZpZGVyID0gSEVJR0hUIC8gMjsgCiAgICAgICAgICAgICAgICAvLyBTaW51c29pZGFsIG9mZnNldCBvZiB0aGUgZGl2aWRlciBsaW5lCiAgICAgICAgICAgICAgICBjb25zdCBzaW5lT2Zmc2V0ID0gTWF0aC5zaW4oeSAqIGZyZXF1ZW5jeSArIGN1cnJlbnRGcmFtZSAqIDAuMSkgKiBhbXBsaXR1ZGUgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpOyAKICAgICAgICAgICAgICAgIGNvbnN0IGRpdmlkZXJZID0gYmFzZURpdmlkZXIgKyBzaW5lT2Zmc2V0OyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIExvY2FsaXR5IENoZWNrIC0tLQogICAgICAgICAgICAgICAgICAgIC8vIElzIHRoZSBjdXJyZW50IHBpeGVsICh4LCB5KSBhYm92ZSBvciBiZWxvdyB0aGUgTm9uLUV1Y2xpZGVhbiBkaXZpZGVyPwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQWJvdmVEaXZpZGVyID0geSA8IGRpdmlkZXJZOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCByLCBnLCBiOwoKICAgICAgICAgICAgICAgICAgICBpZiAoaXNBYm92ZURpdmlkZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQmxlbmQgQSAoVG9wIGhhbGYpIHdpdGggQiAoQm90dG9tIGhhbGYpCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBkYXRhQVtpXSAqICgxIC0gZWFzZWRQcm9ncmVzcykgKyBkYXRhQltpXSAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkYXRhQVtpKzFdICogKDEgLSBlYXNlZFByb2dyZXNzKSArIGRhdGFCW2krMV0gKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gZGF0YUFbaSsyXSAqICgxIC0gZWFzZWRQcm9ncmVzcykgKyBkYXRhQltpKzJdICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBCbGVuZCBCIChUb3AgaGFsZikgd2l0aCBBIChCb3R0b20gaGFsZikgLSBJbnZlcnNlIGJsZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIHIgPSBkYXRhQltpXSAqICgxIC0gZWFzZWRQcm9ncmVzcykgKyBkYXRhQVtpXSAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBkYXRhQltpKzFdICogKDEgLSBlYXNlZFByb2dyZXNzKSArIGRhdGFBW2krMV0gKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBiID0gZGF0YUJbaSsyXSAqICgxIC0gZWFzZWRQcm9ncmVzcykgKyBkYXRhQVtpKzJdICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYik7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiUGlsbGFyIG9mIEluZmluaXRlIE5vbi1Mb2NhbGl0eSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CiAgICAKICAgIAogICAgCiAgICAvLyAtLS0gQU5JTUFUSU9OIDQ5OiBQaWxsYXIgb2YgdGhlIEZpbmFsIEF4aW9tIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzMzXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEwMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgICAgIHRpbGVzOiBbXSwKICAgICAgICAgICAgdGlsZVNpemU6IDEwCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzID0gW107CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJbml0aWFsaXplIGEgZ3JpZCBvZiBwdXJlIG5vaXNlIHRpbGVzCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHVuaXF1ZVN0YXRlLnRpbGVTaXplKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IHVuaXF1ZVN0YXRlLnRpbGVTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUudGlsZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksCiAgICAgICAgICAgICAgICAgICAgICAgIHI6IE1hdGguZmxvb3Iod2llbHNpZWRlcigpICogMjU1KSwKICAgICAgICAgICAgICAgICAgICAgICAgZzogTWF0aC5mbG9vcih3aWVsc2llZGVyKCkgKiAyNTUpLAogICAgICAgICAgICAgICAgICAgICAgICBiOiBNYXRoLmZsb29yKHdpZWxzaWVkZXIoKSAqIDI1NSksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiB3aWVsc2llZGVyKCkgKiAzMAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgZW50aXJlIHNjcmVlbiBkaXNzb2x2ZXMgaW50byBwdXJlIGRhdGEgbm9pc2UgKHJhbmRvbWx5IGNvbG9yZWQsIGZsYXNoaW5nIHRpbGVzKS4gVGhlIG5ldyBpbWFnZSAoQikgZW1lcmdlcyBieSB0aGUgKmNlc3NhdGlvbiogb2YgdGhlIHJhbmRvbW5lc3MsIHByb3ZpbmcgdGhlIGF4aW9tIHRoYXQgcGF0dGVybiBlbWVyZ2VzIGZyb20gbm9pc2UgYnkgc3VidHJhY3Rpb24uKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwoKICAgICAgICAgICAgdW5pcXVlU3RhdGUudGlsZXMuZm9yRWFjaCh0aWxlID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAodGlsZS55ICogV0lEVEggKyB0aWxlLngpICogNDsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBjdXJyZW50RnJhbWUgLSB0aWxlLmRlbGF5OwogICAgICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSByZXR1cm47CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCB0aWxlUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCB0aW1lIC8gKHRvdGFsRnJhbWVzIC0gdGlsZS5kZWxheSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDb2xvciBmb3IgdGhlIHRpbGU6IEJsZW5kIGZyb20gbm9pc2UgdG8gQidzIGNvbG9yCiAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldLCBnQiA9IGRhdGFCW2krMV0sIGJCID0gZGF0YUJbaSsyXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgciA9IHRpbGUuciArIChyQiAtIHRpbGUucikgKiB0aWxlUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBnID0gdGlsZS5nICsgKGdCIC0gdGlsZS5nKSAqIHRpbGVQcm9ncmVzczsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSB0aWxlLmIgKyAoYkIgLSB0aWxlLmIpICogdGlsZVByb2dyZXNzOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBOb2lzZSBlbGVtZW50OiBBZGQgZmxhc2hpbmcgdW50aWwgdGhlIHRyYW5zaXRpb24gaXMgY29tcGxldGUKICAgICAgICAgICAgICAgIGNvbnN0IG5vaXNlRmFjdG9yID0gTWF0aC5zaW4oY3VycmVudEZyYW1lICogMC44ICogKDEgLSB0aWxlUHJvZ3Jlc3MpKSAqIDUwOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2IoJHtyICsgbm9pc2VGYWN0b3J9LCAke2cgKyBub2lzZUZhY3Rvcn0sICR7YiArIG5vaXNlRmFjdG9yfSlgOwogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdCh0aWxlLngsIHRpbGUueSwgdW5pcXVlU3RhdGUudGlsZVNpemUsIHVuaXF1ZVN0YXRlLnRpbGVTaXplKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiUGlsbGFyIG9mIHRoZSBGaW5hbCBBeGlvbSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgoKCgoKCgoKCgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgIC8vIC0tLSBTSVggTkVXLCBDT0xMRUNUSVZFIFNZTkMgQU5JTUFUSU9OUyBTVEFSVCBIRVJFIChJbmRpY2VzIDMyLTM3KSAtLS0KICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgogICAgLy8gLS0tIEFOSU1BVElPTiAzMjogVGhlIEVjaG8gQ2hhbWJlciBDb2xsYXBzZSAoTm9uLUV4aXN0aW5nIEVjaG9lcyBKb2luaW5nKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1szMl0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxNjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBzdHJpcGVzOiBbXSwgLy8gU3RvcmVzIHJvdyBkYXRhCiAgICAgICAgICAgIHN0cmlwZUhlaWdodDogNQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuc3RyaXBlcyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gdW5pcXVlU3RhdGUuc3RyaXBlSGVpZ2h0KSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5zdHJpcGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHk6IHksCiAgICAgICAgICAgICAgICAgICAgZGVsYXk6IHdpZWxzaWVkZXIoKSAqIDUwLAogICAgICAgICAgICAgICAgICAgIC8vIFRoZSAnZWNobycgaXMgdGhlIGNvbG9yIGRpZmZlcmVuY2UKICAgICAgICAgICAgICAgICAgICB2eDogKHdpZWxzaWVkZXIoKSAtIDAuNSkgKiA4LCAvLyBJbml0aWFsIFggdmVsb2NpdHkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBIb3Jpem9udGFsICdlY2hvZXMnIG9mIHRoZSB0d28gaW1hZ2VzIChBIGFuZCBCKSBhcHBlYXIgYXMgc2hpZnRpbmcgc3RyaXBlcywgY3JlYXRpbmcgYSBoaWdobHkgdmlzaWJsZSBjb2xvciBkaWZmZXJlbmNlIGJldHdlZW4gdGhlbS4gVGhlIHN0cmlwZXMgYWNjZWxlcmF0ZSBhbmQgbWVyZ2UgaW50byBhIHNpbmdsZSBicmlnaHQgZmxhc2ggYmVmb3JlIHRoZSBuZXcgaW1hZ2UgKEIpIHNuYXBzIGludG8gY2xhcml0eSwgc3luY2luZyB0aGUgZWNob2VzLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgdW5pcXVlU3RhdGUuc3RyaXBlcy5mb3JFYWNoKHN0cmlwZSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gY3VycmVudEZyYW1lIC0gc3RyaXBlLmRlbGF5OwogICAgICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSByZXR1cm47CgogICAgICAgICAgICAgICAgcHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCB0aW1lIC8gKHRvdGFsRnJhbWVzIC0gc3RyaXBlLmRlbGF5KSk7CiAgICAgICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgICAgIC8vIC0tLSAxLiBEcmF3IEltYWdlIEEgKE9mZnNldCkgLS0tCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXRBID0gc3RyaXBlLnZ4ICogKDEgLSBlYXNlZFByb2dyZXNzKSAqIDIwOyAvLyBBY2NlbGVyYXRlcyB0byAwCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UsIAogICAgICAgICAgICAgICAgICAgIDAsIHN0cmlwZS55LCBXSURUSCwgdW5pcXVlU3RhdGUuc3RyaXBlSGVpZ2h0LCAvLyBTb3VyY2UKICAgICAgICAgICAgICAgICAgICBvZmZzZXRBLCBzdHJpcGUueSwgV0lEVEgsIHVuaXF1ZVN0YXRlLnN0cmlwZUhlaWdodCAvLyBEZXN0aW5hdGlvbiAoc2hpZnRlZCkKICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgLy8gLS0tIDIuIERyYXcgSW1hZ2UgQiAoT2Zmc2V0KSAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldEIgPSAtc3RyaXBlLnZ4ICogKDEgLSBlYXNlZFByb2dyZXNzKSAqIDIwOyAvLyBBY2NlbGVyYXRlcyB0byAwIChPcHBvc2l0ZSBkaXIpCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFByb2dyZXNzOyAvLyBGYWRlcyBpbiBCCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSwgCiAgICAgICAgICAgICAgICAgICAgMCwgc3RyaXBlLnksIFdJRFRILCB1bmlxdWVTdGF0ZS5zdHJpcGVIZWlnaHQsIC8vIFNvdXJjZQogICAgICAgICAgICAgICAgICAgIG9mZnNldEIsIHN0cmlwZS55LCBXSURUSCwgdW5pcXVlU3RhdGUuc3RyaXBlSGVpZ2h0IC8vIERlc3RpbmF0aW9uIChzaGlmdGVkKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gMy4gVGhlIFN5bmMgRmxhc2ggLS0tCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiAwLjk7IC8vIE1heCBicmlnaHRuZXNzIGF0IDUwJQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3doaXRlJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJFY2hvIENoYW1iZXIgQ29sbGFwc2UiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKICAgIC8vIC0tLSBBTklNQVRJT04gMzM6IENvbGxlY3RpdmUgU2hhcmVkIFNpZGUtYnktU2lkZSBBY2NlbGVyYXRpb24gKFdhdmVmcm9udCkgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMzFdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTAwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwKICAgICAgICAgICAgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIGltYWdlIHRyYW5zaXRpb24gYWN0cyBhcyBhIGNvbGxlY3RpdmUgd2F2ZSwgc3RhcnRpbmcgZnJvbSB0aGUgY2VudGVyIGFuZCBhY2NlbGVyYXRpbmcgb3V0d2FyZC4gVGhlIGxlYWRpbmcgZWRnZSBvZiB0aGUgd2F2ZSBwZXJmZWN0bHkgbWl4ZXMgcGl4ZWxzIEEgYW5kIEIsIHNpbXVsYXRpbmcgYSBzaGFyZWQgYWNjZWxlcmF0aW9uIGludG8gYSBuZXcgc3RhdGUuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUEgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgbWF4UiA9IE1hdGguc3FydChXSURUSCAqIFdJRFRIICsgSEVJR0hUICogSEVJR0hUKSAvIDI7CiAgICAgICAgICAgIGNvbnN0IG1pZFggPSBXSURUSCAvIDI7CiAgICAgICAgICAgIGNvbnN0IG1pZFkgPSBIRUlHSFQgLyAyOwoKICAgICAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gbWlkWDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBtaWRZOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBXYXZlZnJvbnQgUHJvZ3Jlc3M6IEhvdyBmYXIgYWxvbmcgdGhlIHRyYW5zaXRpb24gaXMgdGhpcyBzcGVjaWZpYyBwaXhlbCBiYXNlZCBvbiBpdHMgZGlzdGFuY2UgJ3InCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgd2F2ZVByb2dyZXNzID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgKGVhc2VkUHJvZ3Jlc3MgKiAxLjUpIC0gKHIgLyBtYXhSICogMC41KSkpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJBID0gZGF0YUFbaV07IGNvbnN0IGdBID0gZGF0YUFbaSsxXTsgY29uc3QgYkEgPSBkYXRhQVtpKzJdOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHJCID0gZGF0YUJbaV07IGNvbnN0IGdCID0gZGF0YUJbaSsxXTsgY29uc3QgYkIgPSBkYXRhQltpKzJdOwoKICAgICAgICAgICAgICAgICAgICAvLyBDb2xvciBibGVuZDogTWl4IEEgYW5kIEIgYmFzZWQgb24gdGhlIHdhdmVmcm9udCBwcm9ncmVzcwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHJBICsgKHJCIC0gckEpICogd2F2ZVByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZ0EgKyAoZ0IgLSBnQSkgKiB3YXZlUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiQSArIChiQiAtIGJBKSAqIHdhdmVQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQ29sbGVjdGl2ZSBTaGFyZWQgQWNjZWxlcmF0aW9uIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDM0OiBUaGUgR3JvdXAvSW5kaXZpZHVhbCBEaWNob3RvbXkgKFBlcmxpbiBOb2lzZSBEcmlwKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1szMF0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxNDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLAogICAgICAgICAgICBpbWFnZURhdGFCOiBudWxsLAogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgLy8gU2ltcGxlIDFEIG5vaXNlICh1c2VkIHRvIHNpbXVsYXRlIGZsdWlkL29yZ2FuaWMgbW90aW9uKQogICAgICAgIGNvbnN0IG5vaXNlID0gKHQpID0+IE1hdGguc2luKHQpICogMC41ICsgMC41OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIHNvdXJjZSBpbWFnZSBkaXNzb2x2ZXMgaW4gdmVydGljYWwgYmFuZHMgKGdyb3VwcykgdGhhdCBkcmlwIGRvd253YXJkLCBzZXBhcmF0aW5nIGluZGl2aWR1YWwgcGl4ZWxzIGZyb20gdGhlIGNvbGxlY3RpdmUuIFRoZSBkZXN0aW5hdGlvbiBpbWFnZSBzaW11bHRhbmVvdXNseSBmb3JtcywgZHJpdmVuIGJ5IGFuIG9yZ2FuaWMsIGZsdWlkIG1vdGlvbiBmaWVsZCwgaGlnaGxpZ2h0aW5nIHRoZSBpbmRlcGVuZGVudCB5ZXQgZGVwZW5kZW50IG5hdHVyZSBvZiB0aGUgdmlzdWFsIGZhYnJpYy4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQSA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGE7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBtYXhEcmlwID0gMjAwOyAvLyBNYXggdmVydGljYWwgZGlzcGxhY2VtZW50CgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMS4gRHJpcCBEaXNwbGFjZW1lbnQgKEltYWdlIEEpIC0tLQogICAgICAgICAgICAgICAgICAgIC8vIEdyb3VwIGZhY3RvcjogSG9yaXpvbnRhbCBwb3NpdGlvbiBkZXRlcm1pbmVzIHRoZSBkZWxheS9zdHJlbmd0aCBvZiB0aGUgZHJpcAogICAgICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwRHJpcEZhY3RvciA9IG5vaXNlKHggKiAwLjA1KSAqIDEwMDsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkcmlwT2Zmc2V0ID0gZ3JvdXBEcmlwRmFjdG9yICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZHJpcCBwdXNoZXMgQSBwaXhlbHMgZG93biBhbmQgQiBwaXhlbHMgdXAKICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVZQSA9IE1hdGguZmxvb3IoeSAtIGRyaXBPZmZzZXQgKyBtYXhEcmlwICogZWFzZWRQcm9ncmVzcyk7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAyLiBGbHVpZCBFbWVyZ2VuY2UgKEltYWdlIEIpIC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVlCID0gTWF0aC5mbG9vcih5ICsgZHJpcE9mZnNldCAtIG1heERyaXAgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBsZXQgckE9MCwgZ0E9MCwgYkE9MCwgckI9MCwgZ0I9MCwgYkI9MDsKCiAgICAgICAgICAgICAgICAgICAgLy8gU2FtcGxlIEltYWdlIEEgKERyaXBwaW5nIERvd24pCiAgICAgICAgICAgICAgICAgICAgaWYgKHNhbXBsZVlBID49IDAgJiYgc2FtcGxlWUEgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaUEgPSAoc2FtcGxlWUEgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICAgICAgckEgPSBkYXRhQVtpQV07IGdBID0gZGF0YUFbaUErMV07IGJBID0gZGF0YUFbaUErMl07CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBTYW1wbGUgSW1hZ2UgQiAoUmlzaW5nIFVwKQogICAgICAgICAgICAgICAgICAgIGlmIChzYW1wbGVZQiA+PSAwICYmIHNhbXBsZVlCIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlCID0gKHNhbXBsZVlCICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHJCID0gZGF0YUJbaUJdOyBnQiA9IGRhdGFCW2lCKzFdOyBiQiA9IGRhdGFCW2lCKzJdOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gQmxlbmRpbmcgZmF2b3JzIHRoZSBpbWFnZSB3aG9zZSAiZHJpcCIgaXMgbGVzcyBleHRyZW1lIChpLmUuLCBjbG9zZXIgdG8gZmluYWwgcG9zaXRpb24pCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQockEgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICsgckIgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZ0EgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICsgZ0IgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYkEgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICsgYkIgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJHcm91cC9JbmRpdmlkdWFsIERpY2hvdG9teSBEcmlwIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDM1OiBVbmltYWdpbmFibGUgQmV5b25kIFJlbW5hbnQgKEludmVyc2UgQ29sb3IgRGlzc29sdXRpb24pIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzI5XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEyMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsCiAgICAgICAgICAgIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBzb3VyY2UgaW1hZ2UgKEEpIGRpc3NvbHZlcyBieSBwcm9ncmVzc2l2ZWx5IGludmVydGluZyBpdHMgY29sb3IsIGNyZWF0aW5nIGEgcHN5Y2hlZGVsaWMgJ2FudGktaW1hZ2UnIGJlZm9yZSBmYWRpbmcgdG8gYmxhY2suIFRoZSBkZXN0aW5hdGlvbiBpbWFnZSAoQikgZW1lcmdlcywgaW5pdGlhbGx5IGluIGl0cyBpbnZlcnNlIGNvbG9yLCBhbmQgcmlnaHRzIGl0c2VsZiB0byBpdHMgdHJ1ZSBmb3JtLCBzaW11bGF0aW5nIHRoZSBwcm9jZXNzIG9mIGZvcm1pbmcgYSBjb25jZXB0IGZyb20gaXRzICdhbnRpLWNvbmNlcHQnLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQiA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YTsKCiAgICAgICAgICAgIC8vIEludmVyc2lvbiBmYWN0b3I6IEdvZXMgZnJvbSAwIChub3JtYWwpIHRvIDEgKGZ1bGx5IGludmVydGVkKSBhbmQgYmFjayB0byAwCiAgICAgICAgICAgIGNvbnN0IGludmVyc2lvbkZhY3RvciA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7IAoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhQS5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgLy8gLS0tIDEuIEltYWdlIEEgRGlzc29sdmVzIChDb2xvciBJbnZlcnNpb24pIC0tLQogICAgICAgICAgICAgICAgY29uc3QgckEgPSBkYXRhQVtpXTsKICAgICAgICAgICAgICAgIGNvbnN0IHJBX2ludiA9IDI1NSAtIHJBOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDb2xvciBBIGludmVydHM6IFJfZmluYWwgPSBSX0EgKyAoUl9BX2ludiAtIFJfQSkgKiBpbnZlcnNpb25GYWN0b3IKICAgICAgICAgICAgICAgIGNvbnN0IHJBX2Rpc3NvbHZlID0gckEgKyAockFfaW52IC0gckEpICogaW52ZXJzaW9uRmFjdG9yOwoKICAgICAgICAgICAgICAgIC8vIC0tLSAyLiBJbWFnZSBCIEVtZXJnZXMgKEludmVyc2UgQ29sb3IgQ29ycmVjdGlvbikgLS0tCiAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldOwogICAgICAgICAgICAgICAgY29uc3QgckJfaW52ID0gMjU1IC0gckI7CgogICAgICAgICAgICAgICAgLy8gQ29sb3IgQiBzdGFydHMgaW52ZXJ0ZWQgYW5kIHJpZ2h0cyBpdHNlbGY6IFJfZmluYWwgPSBSX0JfaW52ICsgKFJfQiAtIFJfQl9pbnYpICogZWFzZWRQcm9ncmVzcwogICAgICAgICAgICAgICAgY29uc3QgckJfZW1lcmdlID0gckJfaW52ICsgKHJCIC0gckJfaW52KSAqIGVhc2VkUHJvZ3Jlc3M7CgogICAgICAgICAgICAgICAgLy8gLS0tIDMuIEZpbmFsIEJsZW5kIC0tLQogICAgICAgICAgICAgICAgLy8gQWxwaGEgYmxlbmQgQSAoZmFkaW5nIG91dCkgYW5kIEIgKGZhZGluZyBpbikKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhQSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgYWxwaGFCID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQockFfZGlzc29sdmUgKiBhbHBoYUEgKyByQl9lbWVyZ2UgKiBhbHBoYUIpOwogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKChkYXRhQVtpKzFdICogKDEtaW52ZXJzaW9uRmFjdG9yKSArICgyNTUtZGF0YUFbaSsxXSkgKiBpbnZlcnNpb25GYWN0b3IpICogYWxwaGFBICsgKCgyNTUtZGF0YUJbaSsxXSkgKiAoMS1lYXNlZFByb2dyZXNzKSArIGRhdGFCW2krMV0gKiBlYXNlZFByb2dyZXNzKSAqIGFscGhhQik7CiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoKGRhdGFBW2krMl0gKiAoMS1pbnZlcnNpb25GYWN0b3IpICsgKDI1NS1kYXRhQVtpKzJdKSAqIGludmVyc2lvbkZhY3RvcikgKiBhbHBoYUEgKyAoKDI1NS1kYXRhQltpKzJdKSAqICgxLWVhc2VkUHJvZ3Jlc3MpICsgZGF0YUJbaSsyXSAqIGVhc2VkUHJvZ3Jlc3MpICogYWxwaGFCKTsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDNdID0gMjU1OyAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlVuaW1hZ2luYWJsZSBCZXlvbmQgUmVtbmFudCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiAzNjogQ29sbGVjdGl2ZSBTaGltbWVyaW5nIEZ1biAoTHVtaW5vc2l0eSBTd2FybSkgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMjhdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTMwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwKICAgICAgICAgICAgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICAgICAgcGFydGljbGVzOiBbXQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBhcnRpY2xlcyA9IFtdOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgc21hbGwgZ3JpZCBvZiBzYW1wbGVkICdwYXJ0aWNsZXMnCiAgICAgICAgICAgIGNvbnN0IHN0ZXAgPSA4OwogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSBzdGVwKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IHN0ZXApIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICAvLyBQYXJ0aWNsZSBjb2xvciBpcyB0aGUgYXZlcmFnZSBvZiBBIGFuZCBCCiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9ICh1bmlxdWVTdGF0ZS5pbWFnZURhdGFBLmRhdGFbaV0gKyB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGFbaV0pIC8gMjsKICAgICAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5wYXJ0aWNsZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiB3aWVsc2llZGVyKCkgKiA0MCwKICAgICAgICAgICAgICAgICAgICAgICAgbHVtOiByIC8gMjU1LCAvLyBMdW1pbm9zaXR5IGZvciBzcGVlZCBmYWN0b3IKICAgICAgICAgICAgICAgICAgICAgICAgYW5nbGU6IHdpZWxzaWVkZXIoKSAqIE1hdGguUEkgKiAyLAogICAgICAgICAgICAgICAgICAgICAgICByMTogdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhW2ldLCBnMTogdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhW2krMV0sIGIxOiB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBLmRhdGFbaSsyXSwKICAgICAgICAgICAgICAgICAgICAgICAgcjI6IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpXSwgZzI6IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YVtpKzFdLCBiMjogdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhW2krMl0sCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBpbWFnZSBicmVha3MgaW50byB0aG91c2FuZHMgb2YgbGlnaHQgcGFydGljbGVzIHRoYXQgc3dpcmwgYW5kIGFjY2VsZXJhdGUgb3V0d2FyZCwgZHJpdmVuIGJ5IHRoZWlyIG93biBsdW1pbm9zaXR5IChicmlnaHQgcGl4ZWxzIG1vdmUgZmFzdGVyKS4gVGhlIHBhcnRpY2xlcyBmYWRlIGFuZCByZWZvcm0gaW50byB0aGUgbmV3IGltYWdlLCBzeW5jaHJvbml6ZWQgYnkgYSAnYnJpZ2h0IGNsZWFuIGZ1bicgd2F2ZSBvZiBlbmVyZ3kuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAncmdiYSgwLCAwLCAwLCAwLjEpJzsgCiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsgLy8gU2xpZ2h0IHRyYWlsCgogICAgICAgICAgICB1bmlxdWVTdGF0ZS5wYXJ0aWNsZXMuZm9yRWFjaChwID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IHRpbWUgPSBjdXJyZW50RnJhbWUgLSBwLmRlbGF5OwogICAgICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSByZXR1cm47CgogICAgICAgICAgICAgICAgbGV0IHBhcnRpY2xlUHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCB0aW1lIC8gKHRvdGFsRnJhbWVzIC0gcC5kZWxheSkpOwogICAgICAgICAgICAgICAgY29uc3QgZWFzZWRQYXJ0aWNsZSA9IGVhc2VJbk91dFF1aW50KHBhcnRpY2xlUHJvZ3Jlc3MpOwoKICAgICAgICAgICAgICAgIC8vIC0tLSAxLiBTd2FybS9BY2NlbGVyYXRpb24gTW90aW9uIC0tLQogICAgICAgICAgICAgICAgY29uc3QgYWNjZWwgPSBwLmx1bSAqIDEwMDsgLy8gQnJpZ2h0IHBhcnRpY2xlcyBtb3ZlIGZhc3RlcgogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudERpc3QgPSBhY2NlbCAqIGVhc2VkUGFydGljbGUgKiAoMSAtIGVhc2VkUGFydGljbGUpICogMjsgLy8gU3dhcm0gb3V0IGFuZCBiYWNrIGluCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsWCA9IHAueCArIE1hdGguY29zKHAuYW5nbGUpICogY3VycmVudERpc3Q7CiAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFkgPSBwLnkgKyBNYXRoLnNpbihwLmFuZ2xlKSAqIGN1cnJlbnREaXN0OwoKICAgICAgICAgICAgICAgIC8vIC0tLSAyLiBDb2xvciBCbGVuZCAtLS0KICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBwLnIxICsgKHAucjIgLSBwLnIxKSAqIGVhc2VkUGFydGljbGU7CiAgICAgICAgICAgICAgICBjb25zdCBnID0gcC5nMSArIChwLmcyIC0gcC5nMSkgKiBlYXNlZFBhcnRpY2xlOwogICAgICAgICAgICAgICAgY29uc3QgYiA9IHAuYjEgKyAocC5iMiAtIHAuYjEpICogZWFzZWRQYXJ0aWNsZTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gMy4gRHJhdyAtLS0KICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBNYXRoLmFicyhlYXNlZFBhcnRpY2xlIC0gMC41KSAqIDI7IC8vIE1heCBhbHBoYSBhdCBwZWFrIG1vdGlvbgogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2IoJHtyfSwgJHtnfSwgJHtifSlgOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KGZpbmFsWCwgZmluYWxZLCA0LCA0KTsgLy8gRHJhdyB0aGUgcGFydGljbGUgY2x1c3RlcgogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQ29sbGVjdGl2ZSBTaGltbWVyaW5nIEZ1biBTd2FybSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiAzNzogVGhlIE9uZSBXZSBBcmUgQWxzbyAoSW50ZXItR3JvdXAgUGhhc2UgU2hpZnQpIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzI3XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE1MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsCiAgICAgICAgICAgIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgICAgIGdyb3VwczogW10KICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5ncm91cHMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGdyb3VwU2l6ZSA9IDQwOwogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSBncm91cFNpemUpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gZ3JvdXBTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuZ3JvdXBzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LCB3OiBncm91cFNpemUsIGg6IGdyb3VwU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk6ICh4ICsgeSkgLyAoV0lEVEggKyBIRUlHSFQpICogNTAsIC8vIERlbGF5IGJhc2VkIG9uIGRpc3RhbmNlIGZyb20gdG9wLWxlZnQKICAgICAgICAgICAgICAgICAgICAgICAgcGhhc2VTaGlmdDogd2llbHNpZWRlcigpICogTWF0aC5QSSwgLy8gUmFuZG9tIHJvdGF0aW9uYWwgcGhhc2UKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIGltYWdlIGlzIGRpdmlkZWQgaW50byBsYXJnZSAnZ3JvdXBzJyBvciAnYm9kaWVzJy4gRWFjaCBncm91cCByb3RhdGVzIHNsaWdodGx5IG91dCBvZiBzeW5jIHdpdGggaXRzIG5laWdoYm9ycywgY3JlYXRpbmcgYSB2aXN1YWwgdGVhciBpbiB0aGUgZmFicmljLiBUaGUgb2xkIGltYWdlIGRpc3NvbHZlcyBhcyB0aGUgbmV3IGltYWdlIHJvdGF0ZXMgaW50byBwbGFjZSwgc2lnbmlmeWluZyB0aGUgaW5kaXZpZHVhbCBncm91cCdzIGNvbnRyaWJ1dGlvbiB0byB0aGUgJ09uZSBXZSBBcmUgQWxzbycuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICB1bmlxdWVTdGF0ZS5ncm91cHMuZm9yRWFjaChncm91cCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gY3VycmVudEZyYW1lIC0gZ3JvdXAuZGVsYXk7CiAgICAgICAgICAgICAgICBpZiAodGltZSA8IDApIHJldHVybjsKCiAgICAgICAgICAgICAgICBsZXQgcHJvZ3Jlc3MgPSBNYXRoLm1pbigxLCB0aW1lIC8gKHRvdGFsRnJhbWVzIC0gZ3JvdXAuZGVsYXkpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICAgICAgY29uc3Qgcm90QW5nbGUgPSBlYXNlZFByb2dyZXNzICogTWF0aC5QSSAqIDAuNSArIGdyb3VwLnBoYXNlU2hpZnQ7IC8vIE1heCA5MCBkZWdyZWVzIHJvdGF0aW9uCgogICAgICAgICAgICAgICAgY29uc3QgY3ggPSBncm91cC54ICsgZ3JvdXAudyAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IGdyb3VwLnkgKyBncm91cC5oIC8gMjsKCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShjeCwgY3kpOwogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RBbmdsZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIC0tLSBEcmF3IEltYWdlIEEgKFJvdGF0ZXMgb3V0IGFuZCBmYWRlcykgLS0tCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlLCAKICAgICAgICAgICAgICAgICAgICBncm91cC54LCBncm91cC55LCBncm91cC53LCBncm91cC5oLCAvLyBTb3VyY2UKICAgICAgICAgICAgICAgICAgICAtZ3JvdXAudyAvIDIsIC1ncm91cC5oIC8gMiwgZ3JvdXAudywgZ3JvdXAuaCAvLyBEZXN0aW5hdGlvbgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLS0tIERyYXcgSW1hZ2UgQiAoUm90YXRlcyBpbiBhbmQgZmFkZXMpIC0tLQogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlLCAKICAgICAgICAgICAgICAgICAgICBncm91cC54LCBncm91cC55LCBncm91cC53LCBncm91cC5oLCAvLyBTb3VyY2UKICAgICAgICAgICAgICAgICAgICAtZ3JvdXAudyAvIDIsIC1ncm91cC5oIC8gMiwgZ3JvdXAudywgZ3JvdXAuaCAvLyBEZXN0aW5hdGlvbgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlRoZSBPbmUgV2UgQXJlIEFsc28gKEludGVyLUdyb3VwIFBoYXNlIFNoaWZ0KSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgoKCgoKCgovLyAtLS0gQU5JTUFUSU9OIDI3OiBIeXBlci1EaW1lbnNpb25hbCBTbGl0LVNjYW4gKE5vbi1Mb2NhbCBUcmFjZSkgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMjZdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTUwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwKICAgICAgICAgICAgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICAgICAgc2NhbkxpbmVZOiAwCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuc2NhbkxpbmVZID0gMDsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IEEgaG9yaXpvbnRhbCBsaW5lIHN3ZWVwcyBkb3duIHRoZSBpbWFnZSwgYnV0IHRoZSB0cmFuc2l0aW9uIGlzbid0IGp1c3QgYSBzaW1wbGUgd2lwZS4gVGhlIGxpbmUgaXRzZWxmIGRyYWdzIGFuZCBkaXN0b3J0cyB0aGUgcGl4ZWxzLCBjcmVhdGluZyBhIGNoYW90aWMgInNsaXQtc2NhbiIgZWZmZWN0LiBBcyBpdCBwYXNzZXMsIHRoZSBuZXcgaW1hZ2UgKEIpIGlzIHJldmVhbGVkLCB3aXRoIGEgaGVhdnksIGRlbGF5ZWQgbW90aW9uIGJsdXIuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3Qgc2NhblkgPSBNYXRoLmZsb29yKHByb2dyZXNzICogSEVJR0hUICogMS4yKSAtIE1hdGguZmxvb3IoSEVJR0hUICogMC4xKTsgLy8gU3dlZXBzIG91dHNpZGUgYm91bmRzCgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgLy8gRHJhdyBTb3VyY2UgSW1hZ2UgKEEpIGFib3ZlIHRoZSBzY2FuIGxpbmUKICAgICAgICAgICAgaWYgKHNjYW5ZID4gMCkgewogICAgICAgICAgICAgICAgY29uc3QgaGVpZ2h0QSA9IE1hdGgubWluKHNjYW5ZLCBIRUlHSFQpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBoZWlnaHRBLCAwLCAwLCBXSURUSCwgaGVpZ2h0QSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERyYXcgRGVzdGluYXRpb24gSW1hZ2UgKEIpIGJlbG93IHRoZSBzY2FuIGxpbmUsIHdpdGggbW90aW9uIGJsdXIKICAgICAgICAgICAgaWYgKHNjYW5ZIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFkgPSBNYXRoLm1heCgwLCBzY2FuWSk7CiAgICAgICAgICAgICAgICBjb25zdCBoZWlnaHRCID0gSEVJR0hUIC0gc3RhcnRZOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBNb3Rpb24gYmx1ci9kaXN0b3J0aW9uIG1hcAogICAgICAgICAgICAgICAgY29uc3QgYmx1clN0cmVuZ3RoID0gTWF0aC5tYXgoMCwgTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKSAqIDUwKTsgLy8gU3Ryb25nZXN0IGF0IDUwJQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3YXZlT2Zmc2V0ID0gTWF0aC5zaW4oeCAqIDAuMDUgKyBjdXJyZW50RnJhbWUgKiAwLjEpICogYmx1clN0cmVuZ3RoOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIERlc3RpbmF0aW9uIGlzIHNoaWZ0ZWQgaG9yaXpvbnRhbGx5CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHggPSB4ICsgd2F2ZU9mZnNldDsKCiAgICAgICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEltYWdlLCAKICAgICAgICAgICAgICAgICAgICAgICAgeCwgc3RhcnRZLCAyLCBoZWlnaHRCLCAvLyBTb3VyY2UgKHRoaW4gdmVydGljYWwgc2xpY2UpCiAgICAgICAgICAgICAgICAgICAgICAgIGR4LCBzdGFydFksIDIsIGhlaWdodEIgLy8gRGVzdGluYXRpb24gKHNoaWZ0ZWQpCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyB0aGUgYWN0dWFsIHNjYW4gbGluZSBkaXN0dXJiYW5jZSAoQSB0byBCIHRyYW5zaXRpb24gem9uZSkKICAgICAgICAgICAgY29uc3QgbGluZUhlaWdodCA9IDU7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiYSgyNTUsIDI1NSwgMjU1LCAke01hdGgubWluKDEsIE1hdGgubWF4KDAsIHByb2dyZXNzICogNCAtIDIpKX0pYDsgLy8gRmxhc2hlcyB3aGl0ZSBhdCBwZWFrIHRyYW5zaXRpb24KICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIHNjYW5ZIC0gbGluZUhlaWdodCAvIDIsIFdJRFRILCBsaW5lSGVpZ2h0KTsKCgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiSHlwZXItRGltZW5zaW9uYWwgU2xpdC1TY2FuIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDI4OiBBbnRpLUNvbmNlcHQgTWlycm9yIEZyYWN0dXJlIChWb2lkIFJlZmxlY3Rpb24pIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzI1XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEwMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIHBpZWNlczogW10sIC8vIFN0b3JlcyBibG9jayBkYXRhIGZvciB0aGUgc2hhdHRlcmluZyBlZmZlY3QKICAgICAgICAgICAgY29sczogMTAsIHJvd3M6IDEwCiAgICAgICAgfTsKICAgICAgICBjb25zdCBwaWVjZVNpemUgPSBXSURUSCAvIDEwOwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpZWNlcyA9IFtdOwoKICAgICAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCB1bmlxdWVTdGF0ZS5yb3dzOyByKyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgdW5pcXVlU3RhdGUuY29sczsgYysrKSB7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGllY2VzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiBjICogcGllY2VTaXplLCB5OiByICogcGllY2VTaXplLAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogMzAsIAogICAgICAgICAgICAgICAgICAgICAgICAvLyBSYW5kb20gdmVsb2NpdHkgZm9yIHNoYXR0ZXIgZWZmZWN0CiAgICAgICAgICAgICAgICAgICAgICAgIHZ4OiAod2llbHNpZWRlcigpIC0gMC41KSAqIDEwLAogICAgICAgICAgICAgICAgICAgICAgICB2eTogKHdpZWxzaWVkZXIoKSAtIDAuNSkgKiAxMCwKICAgICAgICAgICAgICAgICAgICAgICAgdnI6ICh3aWVsc2llZGVyKCkgLSAwLjUpICogMC41LCAvLyBSYW5kb20gcm90YXRpb24gdmVsb2NpdHkKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIHNvdXJjZSBpbWFnZSBpcyBwZXJjZWl2ZWQgYXMgYSByZWZsZWN0aXZlIG1pcnJvciB0aGF0IHNoYXR0ZXJzIGludG8gZmxvYXRpbmcgcGllY2VzLiBFYWNoIHBpZWNlIHJlZmxlY3RzIHRoZSAqYW50aS1jb25jZXB0KiAodGhlIG5ldyBpbWFnZSkgb24gaXRzIHJldmVyc2Ugc2lkZSBhcyBpdCBzcGlucyBhd2F5IGludG8gYSBkZWVwIHZvaWQsIGJlZm9yZSB0aGUgbmV3IGltYWdlIHNuYXBzIGludG8gcGxhY2UuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1YWQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMGEwYTBhJzsgLy8gRGVlcCBncmF5IHZvaWQKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGllY2VzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gY3VycmVudEZyYW1lIC0gcC5kZWxheTsKICAgICAgICAgICAgICAgIGlmICh0aW1lIDwgMCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGxldCBwaWVjZVByb2dyZXNzID0gTWF0aC5taW4oMSwgdGltZSAvICh0b3RhbEZyYW1lcyAtIHAuZGVsYXkpKTsKICAgICAgICAgICAgICAgIGNvbnN0IGVhc2VkUGllY2UgPSBlYXNlSW5RdWFkKHBpZWNlUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAxLiBQb3NpdGlvbiBhbmQgUm90YXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IGN4ID0gcC54ICsgcGllY2VTaXplIC8gMjsKICAgICAgICAgICAgICAgIGNvbnN0IGN5ID0gcC55ICsgcGllY2VTaXplIC8gMjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFggPSBjeCArIHAudnggKiBlYXNlZFBpZWNlICogMzA7IC8vIFNocmFwbmVsIHBhdGgKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRZID0gY3kgKyBwLnZ5ICogZWFzZWRQaWVjZSAqIDMwOwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdCA9IHAudnIgKiBlYXNlZFBpZWNlICogNTsKCiAgICAgICAgICAgICAgICAvLyAyLiBQZXJzcGVjdGl2ZSBGbGlwIChTaW11bGF0ZWQgM0Qgcm90YXRpb24gYXJvdW5kIFktYXhpcykKICAgICAgICAgICAgICAgIGNvbnN0IGZsaXBQcm9ncmVzcyA9IE1hdGguc2luKHBpZWNlUHJvZ3Jlc3MgKiBNYXRoLlBJKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlWCA9IDEgLSBmbGlwUHJvZ3Jlc3MgKiAxOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMy4gSW1hZ2Ugc2VsZWN0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBpbWdUb0RyYXcgPSBwaWVjZVByb2dyZXNzIDwgMC41ID8gY3VycmVudEltYWdlIDogbmV4dEltYWdlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShjdXJyZW50WCwgY3VycmVudFkpOyAvLyBNb3ZlIHRvIG5ldyBwb3NpdGlvbgogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShjdXJyZW50Um90KTsgLy8gQXBwbHkgcm90YXRpb24KICAgICAgICAgICAgICAgIGN0eC5zY2FsZShzY2FsZVgsIDEpOyAvLyBBcHBseSBwZXJzcGVjdGl2ZSBmbGlwCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRQaWVjZTsgLy8gRmFkZSBvdXQgYXMgaXQgZmxpZXMgYXdheQoKICAgICAgICAgICAgICAgIC8vIERyYXcgdGhlIGltYWdlIHNsaWNlLCBjZW50ZXJlZAogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgICAgICBpbWdUb0RyYXcsIAogICAgICAgICAgICAgICAgICAgIHAueCwgcC55LCBwaWVjZVNpemUsIHBpZWNlU2l6ZSwgLy8gU291cmNlCiAgICAgICAgICAgICAgICAgICAgLXBpZWNlU2l6ZSAvIDIsIC1waWVjZVNpemUgLyAyLCBwaWVjZVNpemUsIHBpZWNlU2l6ZSAvLyBEZXN0aW5hdGlvbiAoY2VudGVyZWQpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIEZpbmFsIHNuYXAgaW50byBwbGFjZQogICAgICAgICAgICBpZiAocHJvZ3Jlc3MgPiAwLjgpIHsKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IChwcm9ncmVzcyAtIDAuOCkgKiA1OwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiQW50aS1Db25jZXB0IE1pcnJvciBGcmFjdHVyZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CiAgICAKICAgIC8vIC0tLSBBTklNQVRJT04gMjk6IElubmVyIElkZW50aXR5IEZhYnJpYyBXYXJwIChUdXJidWxlbnQgRmxvdykgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMjRdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTYwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCwKICAgICAgICAgICAgaW1hZ2VEYXRhQjogbnVsbCwKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogVGhlIGltYWdlIHBsYW5lIGlzIHN1YmplY3QgdG8gZXh0cmVtZSwgbm9uLWxpbmVhciBkaXN0b3J0aW9uIHVzaW5nIFBlcmxpbi9Ob2lzZS1saWtlIHdhdmVzLCBzaW11bGF0aW5nIGEgdGltZS1zcGFjZSB3YXJwIG9yIHRoZSBjb2xsYXBzZSBvZiBwZXJjZWl2ZWQgcmVhbGl0eS4gVGhlIHR1cmJ1bGVuY2UgcGVha3MgYXQgNTAlIHByb2dyZXNzLCBtaXhpbmcgc291cmNlIGFuZCBkZXN0aW5hdGlvbiBkYXRhIGNoYW90aWNhbGx5IGJlZm9yZSBzbW9vdGhpbmcgb3V0LioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQiA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1heGltdW0gd2FycCBkaXNwbGFjZW1lbnQgYXQgNTAlCiAgICAgICAgICAgIGNvbnN0IHdhcnBTdHJlbmd0aCA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiA0MDsKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMS4gVHVyYnVsZW50IERpc3BsYWNlbWVudCBNYXAgKE5vbi1saW5lYXIgZmxvdyBmaWVsZCkgLS0tCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyB1c2VzIGNvbXBsZXggdHJpZ29ub21ldHJpYyBmdW5jdGlvbnMgdG8gc2ltdWxhdGUgY29udGludW91cywgb3JnYW5pYyBtb3ZlbWVudAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdhcnBYID0gTWF0aC5zaW4oeCAqIDAuMDIgKyBjdXJyZW50RnJhbWUgKiAwLjA1KSAqIE1hdGguY29zKHkgKiAwLjAzKSAqIHdhcnBTdHJlbmd0aDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB3YXJwWSA9IE1hdGguY29zKHkgKiAwLjAyIC0gY3VycmVudEZyYW1lICogMC4wNCkgKiBNYXRoLnNpbih4ICogMC4wMykgKiB3YXJwU3RyZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDIuIFNhbXBsZSBmcm9tIFNvdXJjZSBJbWFnZSAoQSkgdGhyb3VnaCB0aGUgaW52ZXJzZSB3YXJwIC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVggPSBNYXRoLmZsb29yKHggLSB3YXJwWCAqICgxIC0gZWFzZWRQcm9ncmVzcykpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVkgPSBNYXRoLmZsb29yKHkgLSB3YXJwWSAqICgxIC0gZWFzZWRQcm9ncmVzcykpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoc2FtcGxlWCA+PSAwICYmIHNhbXBsZVggPCBXSURUSCAmJiBzYW1wbGVZID49IDAgJiYgc2FtcGxlWSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpU2FtcGxlID0gKHNhbXBsZVkgKiBXSURUSCArIHNhbXBsZVgpICogNDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSAzLiBDb2xvciBCbGVuZCAoU21vb3RoIElkZW50aXR5IENoYW5nZSkgLS0tCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJBID0gZGF0YUFbaVNhbXBsZV07IGNvbnN0IGdBID0gZGF0YUFbaVNhbXBsZSsxXTsgY29uc3QgYkEgPSBkYXRhQVtpU2FtcGxlKzJdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldOyBjb25zdCBnQiA9IGRhdGFCW2krMV07IGNvbnN0IGJCID0gZGF0YUJbaSsyXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHJBICsgKHJCIC0gckEpICogZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnQSArIChnQiAtIGdBKSAqIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYkEgKyAoYkIgLSBiQSkgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIklubmVyIElkZW50aXR5IEZhYnJpYyBXYXJwIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKICAgIAogICAgLy8gLS0tIEFOSU1BVElPTiAzMDogVGhlIFNoaW1tZXIgb2YgVW5pbWFnaW5hYmxlIEJleW9uZCAoQ2hyb21hIEJsb29tKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1syM10gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxMjAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFCOiBudWxsLAogICAgICAgICAgICBtYXhCbG9vbTogMTAwIC8vIE1heGltdW0gcGl4ZWwgZGlzcGxhY2VtZW50IGRpc3RhbmNlCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgc291cmNlIGltYWdlIHJhcGlkbHkgb3Zlci1zYXR1cmF0ZXMgYW5kICdibG9vbXMnIGludG8gYSBibGluZGluZyB3aGl0ZSBsaWdodCwgd2hpY2ggdGhlbiBzbG93bHkgcmVjZWRlcywgcmV2ZWFsaW5nIHRoZSBkZXN0aW5hdGlvbiBpbWFnZSBmcm9tIGl0cyBjb3JlLiBUaGUgcGl4ZWxzIG9mIHRoZSBkZXN0aW5hdGlvbiBpbWFnZSBhcmUgaW5kaXZpZHVhbGx5IHJhbmRvbWl6ZWQgaW4gY29sb3IvcG9zaXRpb24gZHVyaW5nIHRoZSBwZWFrIGJsb29tIHBoYXNlLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIDEuIFNvdXJjZSBJbWFnZSBCbG9vbSAoRmFkZXMgYW5kIEJsdXJzIHRvIFdoaXRlKSAtLS0KICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEcmF3IG9yaWdpbmFsIGltYWdlIHdpdGggYSBibHVyIGZpbHRlciAoc2ltdWxhdGluZyBibG9vbSkKICAgICAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7ZWFzZWRQcm9ncmVzcyAqIDIwfXB4KWA7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY3R4LmZpbHRlciA9ICdub25lJzsKCiAgICAgICAgICAgIC8vIE92ZXJsYXkgd2l0aCBhIHdoaXRlIGZsYXNoCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiAwLjg7IC8vIE1heCBicmlnaHRuZXNzIGF0IDUwJQogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ3doaXRlJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIDIuIERlc3RpbmF0aW9uIEltYWdlIEVtZXJnZW5jZSAoU2hpbW1lcikgLS0tCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQi5kYXRhOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2hpbW1lciBzdHJlbmd0aCBwZWFrcyBhdCA1MCUKICAgICAgICAgICAgY29uc3Qgc2hpbW1lclN0cmVuZ3RoID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKSAqIDAuNTsgCgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKCiAgICAgICAgICAgICAgICAgICAgLy8gU2FtcGxlIG9mZnNldCAoY3JlYXRlcyBhIGNoYW90aWMgc2hpbW1lcikKICAgICAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXRYID0gTWF0aC5mbG9vcihNYXRoLnNpbih4ICogMC4xKSAqIHNoaW1tZXJTdHJlbmd0aCAqIDUpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLmZsb29yKE1hdGguY29zKHkgKiAwLjEpICogc2hpbW1lclN0cmVuZ3RoICogNSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlWCA9IE1hdGgubWluKFdJRFRIIC0gMSwgTWF0aC5tYXgoMCwgeCArIG9mZnNldFgpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVZID0gTWF0aC5taW4oSEVJR0hUIC0gMSwgTWF0aC5tYXgoMCwgeSArIG9mZnNldFkpKTsKCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaVNhbXBsZSA9IChzYW1wbGVZICogV0lEVEggKyBzYW1wbGVYKSAqIDQ7CgogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBkYXRhQltpU2FtcGxlXTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IGRhdGFCW2lTYW1wbGUgKyAxXTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IGRhdGFCW2lTYW1wbGUgKyAyXTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgICAgIC8vIFJlc2V0IGdsb2JhbCBhbHBoYQogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIlNoaW1tZXIgb2YgVW5pbWFnaW5hYmxlIEJleW9uZCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiAzMTogQmVsaWVmIFF1YW50dW0gRW50YW5nbGVtZW50IChJbnZlcnNlIFN3aXJsKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1syMl0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxNDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBpbWFnZURhdGFBOiBudWxsLAogICAgICAgICAgICBpbWFnZURhdGFCOiBudWxsLAogICAgICAgICAgICBtaWRYOiBXSURUSCAvIDIsCiAgICAgICAgICAgIG1pZFk6IEhFSUdIVCAvIDIKICAgICAgICB9OwoKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIH0KCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICAgICAgLy8gKipEZXNjcmlwdGlvbjogUGl4ZWxzIGFyZSBlbnRhbmdsZWQsIG1lYW5pbmcgdGhleSBmb2xsb3cgYW4gaW52ZXJzZSBwYXRoOiBzb3VyY2UgcGl4ZWxzIHN3aXJsICpvdXQqIGZyb20gdGhlIGNlbnRlciB3aGlsZSBkZXN0aW5hdGlvbiBwaXhlbHMgc3dpcmwgKmluKiB0byB0aGUgY2VudGVyLiBUaGUgcm90YXRpb24gc3BlZWQgaXMgcHJvcG9ydGlvbmFsIHRvIHRoZSBkaXN0YW5jZSBmcm9tIHRoZSBjZW50ZXIsIHJlc3VsdGluZyBpbiBhIGRyYW1hdGljLCB0d2lzdGluZyBkaXNzb2x1dGlvbiBhbmQgZm9ybWF0aW9uLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQiA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIuZGF0YTsKCiAgICAgICAgICAgIC8vIE1heCBzd2lybCBhbmdsZQogICAgICAgICAgICBjb25zdCBtYXhBbmdsZSA9IE1hdGguUEkgKiA0OyAKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSB1bmlxdWVTdGF0ZS5taWRYOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIHVuaXF1ZVN0YXRlLm1pZFk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5pdGlhbEFuZ2xlID0gTWF0aC5hdGFuMihkeSwgZHgpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAxLiBSb3RhdGlvbiBBbmdsZSAoUHJvcG9ydGlvbmFsIHRvIERpc3RhbmNlKSAtLS0KICAgICAgICAgICAgICAgICAgICBjb25zdCByb3RhdGlvbkZhY3RvciA9IHIgLyAoV0lEVEggLyAyKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0b3RhbFJvdGF0aW9uID0gcm90YXRpb25GYWN0b3IgKiBtYXhBbmdsZSAqIGVhc2VkUHJvZ3Jlc3M7CgogICAgICAgICAgICAgICAgICAgIC8vIC0tLSAyLiBTb3VyY2UgKEEpIFNhbXBsZSBQb3NpdGlvbjogU3dpcmxzIE9VVCAtLS0KICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZUEgPSBpbml0aWFsQW5nbGUgKyB0b3RhbFJvdGF0aW9uOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RBID0gciAqICgxICsgZWFzZWRQcm9ncmVzcyAqIDAuNSk7IC8vIE1vdmVzIG91dHdhcmQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVYQSA9IE1hdGguZmxvb3IodW5pcXVlU3RhdGUubWlkWCArIGRpc3RBICogTWF0aC5jb3MoYW5nbGVBKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlWUEgPSBNYXRoLmZsb29yKHVuaXF1ZVN0YXRlLm1pZFkgKyBkaXN0QSAqIE1hdGguc2luKGFuZ2xlQSkpOwoKICAgICAgICAgICAgICAgICAgICAvLyAtLS0gMy4gRGVzdGluYXRpb24gKEIpIFNhbXBsZSBQb3NpdGlvbjogU3dpcmxzIElOIC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlQiA9IGluaXRpYWxBbmdsZSAtIHRvdGFsUm90YXRpb247IC8vIEludmVyc2Ugc3dpcmwKICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXN0QiA9IHIgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MgKiAwLjUpOyAvLyBNb3ZlcyBpbndhcmQKCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlWEIgPSBNYXRoLmZsb29yKHVuaXF1ZVN0YXRlLm1pZFggKyBkaXN0QiAqIE1hdGguY29zKGFuZ2xlQikpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVlCID0gTWF0aC5mbG9vcih1bmlxdWVTdGF0ZS5taWRZICsgZGlzdEIgKiBNYXRoLnNpbihhbmdsZUIpKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDQuIERyYXcgTG9naWMgKEJsZW5kIHRoZSBTd2lybHMpIC0tLQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhQSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhQiA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gU2FtcGxlIGNvbG9yIGZyb20gQSBhbmQgQiBiYXNlZCBvbiB0aGVpciByZXNwZWN0aXZlIHN3aXJsIHBvc2l0aW9ucwogICAgICAgICAgICAgICAgICAgIGxldCByQT0wLCBnQT0wLCBiQT0wLCByQj0wLCBnQj0wLCBiQj0wOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIEdldCBjb2xvciBBCiAgICAgICAgICAgICAgICAgICAgaWYgKHNhbXBsZVhBID49IDAgJiYgc2FtcGxlWEEgPCBXSURUSCAmJiBzYW1wbGVZQSA+PSAwICYmIHNhbXBsZVlBIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlBID0gKHNhbXBsZVlBICogV0lEVEggKyBzYW1wbGVYQSkgKiA0OwogICAgICAgICAgICAgICAgICAgICAgICByQSA9IGRhdGFBW2lBXTsgZ0EgPSBkYXRhQVtpQSsxXTsgYkEgPSBkYXRhQVtpQSsyXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEdldCBjb2xvciBCCiAgICAgICAgICAgICAgICAgICAgaWYgKHNhbXBsZVhCID49IDAgJiYgc2FtcGxlWEIgPCBXSURUSCAmJiBzYW1wbGVZQiA+PSAwICYmIHNhbXBsZVlCIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlCID0gKHNhbXBsZVlCICogV0lEVEggKyBzYW1wbGVYQikgKiA0OwogICAgICAgICAgICAgICAgICAgICAgICByQiA9IGRhdGFCW2lCXTsgZ0IgPSBkYXRhQltpQisxXTsgYkIgPSBkYXRhQltpQisyXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIEZpbmFsIGNvbG9yIGlzIGEgbWl4IG9mIHRoZSB0d28gc3dpcmxzCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQockEgKiBhbHBoYUEgKyByQiAqIGFscGhhQik7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGdBICogYWxwaGFBICsgZ0IgKiBhbHBoYUIpOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiQSAqIGFscGhhQSArIGJCICogYWxwaGFCKTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJCZWxpZWYgUXVhbnR1bSBFbnRhbmdsZW1lbnQiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07CiAgICB9KSgpOwoKCgoKCgoKCgoKCgoKCgoKCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgLy8gLS0tIEZJVkUgTkVXLCBUUkFOU0NFTkRFTkNFIEFOSU1BVElPTlMgU1RBUlQgSEVSRSAoSW5kaWNlcyAyMi0yNikgLS0tCiAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKICAgIC8vIC0tLSBBTklNQVRJT04gMjI6IFRyYW5zY2VuZGVuY2Ugb2YgdGhlIFZvaWQgKEVtZXJnZW5jZSBmcm9tIEx1bWlub3NpdHkpIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzIxXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE2MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIHBpeGVsczogW10sIC8vIFN0b3JlcyBpbml0aWFsIGx1bWlub3NpdHkgZGF0YQogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxzID0gW107CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgY29uc3QgZGF0YUEgPSBpbWFnZURhdGFBLmRhdGE7CiAgICAgICAgICAgIGNvbnN0IHNpemUgPSAxMDsgLy8gQmxvY2sgc2l6ZSBmb3IgcGl4ZWwgY2x1c3RlcnMKCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IHNpemUpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gc2l6ZSkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIC8vIENhbGN1bGF0ZSByZWxhdGl2ZSBsdW1pbm9zaXR5IChodW1hbiBwZXJjZXB0aW9uKQogICAgICAgICAgICAgICAgICAgIGNvbnN0IGx1bSA9IChkYXRhQVtpXSAqIDAuMjEyNiArIGRhdGFBW2kgKyAxXSAqIDAuNzE1MiArIGRhdGFBW2kgKyAyXSAqIDAuMDcyMikgLyAyNTU7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LCAKICAgICAgICAgICAgICAgICAgICAgICAgbHVtOiBsdW0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbGF5OiAoMSAtIGx1bSkgKiA4MCAqIHdpZWxzaWVkZXIoKSwgLy8gQnJpZ2h0ZXIgYXJlYXMgZGlzc29sdmUvZW1lcmdlIGZhc3RlcgogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgc291cmNlIGltYWdlIGRpc3NvbHZlcyBpbnRvIGEgYmxhY2sgVm9pZC4gVGhlIGRlc3RpbmF0aW9uIGltYWdlIHRoZW4gZW1lcmdlcywgcHVsbGVkIG91dHdhcmQgYnkgYW4gJ0FudGktR3Jhdml0eScgZmllbGQgd2hvc2Ugc3RyZW5ndGggaXMgaW52ZXJzZWx5IHByb3BvcnRpb25hbCB0byB0aGUgb3JpZ2luYWwgaW1hZ2UncyBsdW1pbm9zaXR5LCBjcmVhdGluZyBhIHZpc3VhbGx5IGNvbXBsZXgsIHN0cnVjdHVyZWQgZW1lcmdlbmNlLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIHByb2dyZXNzID0gY3VycmVudEZyYW1lIC8gdG90YWxGcmFtZXM7CgogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gJ2JsYWNrJzsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyBTb3VyY2UgSW1hZ2UgKEEpIC0+IERpc3NvbHZlcwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZU91dFF1YWQocHJvZ3Jlc3MgKiAyKTsgLy8gUXVpY2sgZmFkZSBvdXQKCiAgICAgICAgICAgIGlmIChwcm9ncmVzcyA8IDAuNSkgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICAvLyBEcmF3IERlc3RpbmF0aW9uIEltYWdlIChCKSAtPiBFbWVyZ2VzCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VPdXRRdWFkKHByb2dyZXNzICogMiAtIDEpOyAvLyBEZWxheSB1bnRpbCA1MCUgcHJvZ3Jlc3MKCiAgICAgICAgICAgIGlmIChwcm9ncmVzcyA+IDAuNSkgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxzLmZvckVhY2gocCA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IGN1cnJlbnRGcmFtZSAtIHAuZGVsYXk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSByZXR1cm47CgogICAgICAgICAgICAgICAgICAgIGxldCBlbWVyZ2VuY2VQcm9ncmVzcyA9IE1hdGgubWluKDEsIHRpbWUgLyAodG90YWxGcmFtZXMgLSBwLmRlbGF5KSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZWFzZWRFbWVyZ2VuY2UgPSBlYXNlSW5PdXRRdWludChlbWVyZ2VuY2VQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlICdwdWxsJyBkaXN0YW5jZSBpcyBiYXNlZCBvbiBvcmlnaW5hbCBsdW1pbm9zaXR5CiAgICAgICAgICAgICAgICAgICAgY29uc3QgcHVsbERpc3RhbmNlID0gKDEgLSBwLmx1bSkgKiAyMDA7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gUHJvamVjdCB0aGUgYmxvY2sgb3V0d2FyZCBmcm9tIHRoZSBjZW50ZXIKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHAueCAtIFdJRFRIIC8gMjsKICAgICAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHAueSAtIEhFSUdIVCAvIDI7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGJsb2NrIG1vdmVzIGluIHJldmVyc2UgZnJvbSBhIGNoYW90aWMgb3V0ZXIgc3BhY2UsIHRvd2FyZHMgaXRzIGZpbmFsIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxYID0gcC54IC0gTWF0aC5jb3MoYW5nbGUpICogcHVsbERpc3RhbmNlICogKDEgLSBlYXNlZEVtZXJnZW5jZSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZmluYWxZID0gcC55IC0gTWF0aC5zaW4oYW5nbGUpICogcHVsbERpc3RhbmNlICogKDEgLSBlYXNlZEVtZXJnZW5jZSk7CgogICAgICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCBwLngsIHAueSwgMTAsIDEwLCBmaW5hbFgsIGZpbmFsWSwgMTAsIDEwKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7CgogICAgICAgICAgICBpZiAoY3VycmVudEZyYW1lIDwgdG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7IHRpdGxlOiAiVHJhbnNjZW5kZW5jZSBvZiB0aGUgVm9pZCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiAyMzogRGlhbGVjdGljYWwgRmllbGQgRmx1Y3R1YXRpb24gKEFudGktQ29uY2VwdCBWaWJyYXRpb24pIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzIwXSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDEwMCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGJsb2NrczogW10sIC8vIEFycmF5IG9mIGJsb2NrIHN0YXRlcwogICAgICAgICAgICBibG9ja1NpemU6IDIwCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5ibG9ja3MgPSBbXTsKICAgICAgICAgICAgY29uc3QgaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSB1bmlxdWVTdGF0ZS5ibG9ja1NpemUpIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gdW5pcXVlU3RhdGUuYmxvY2tTaXplKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuYmxvY2tzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICB4OiB4LCB5OiB5LAogICAgICAgICAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogMzAsCiAgICAgICAgICAgICAgICAgICAgICAgIGMxOiBbaW1hZ2VEYXRhQS5kYXRhW2ldLCBpbWFnZURhdGFBLmRhdGFbaSsxXSwgaW1hZ2VEYXRhQS5kYXRhW2krMl1dLAogICAgICAgICAgICAgICAgICAgICAgICBjMjogW2ltYWdlRGF0YUIuZGF0YVtpXSwgaW1hZ2VEYXRhQi5kYXRhW2krMV0sIGltYWdlRGF0YUIuZGF0YVtpKzJdXSwKICAgICAgICAgICAgICAgICAgICAgICAgb3g6IDAsIG95OiAwLCAvLyBDdXJyZW50IGNoYW90aWMgb2Zmc2V0CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBpbWFnZSBiZWNvbWVzIGEgZmx1Y3R1YXRpbmcgZmllbGQgd2hlcmUgZWFjaCBibG9jayBpcyB0b3JuIGJldHdlZW4gdGhlIHNvdXJjZSAoUmVwdWxzaW9uKSBhbmQgZGVzdGluYXRpb24gKEF0dHJhY3Rpb24pIGNvbG9ycy4gSXQgdmlicmF0ZXMgY2hhb3RpY2FsbHkgYXQgdGhlIDUwJSBtYXJrICh0aGUgbW9tZW50IG9mICdhbnRpLWNvbmNlcHQnIGVxdWlsaWJyaXVtKSBiZWZvcmUgc25hcHBpbmcgaW50byB0aGUgbmV3IHN0YXRlLioqCiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRGcmFtZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiOwogICAgICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICAgICAgdW5pcXVlU3RhdGUuYmxvY2tzLmZvckVhY2goYmxvY2sgPT4gewogICAgICAgICAgICAgICAgY29uc3QgdGltZSA9IGN1cnJlbnRGcmFtZSAtIGJsb2NrLmRlbGF5OwogICAgICAgICAgICAgICAgaWYgKHRpbWUgPCAwKSByZXR1cm47CgogICAgICAgICAgICAgICAgbGV0IHByb2dyZXNzID0gTWF0aC5taW4oMSwgdGltZSAvICh0b3RhbEZyYW1lcyAtIGJsb2NrLmRlbGF5KSk7CiAgICAgICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgICAgIC8vIC0tLSAxLiBWaWJyYXRpb24gRmllbGQgKEFudGktQ29uY2VwdCBDbGFzaCkgLS0tCiAgICAgICAgICAgICAgICBjb25zdCBjbGFzaFN0cmVuZ3RoID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKSAqIDE1OyAvLyBNYXggZGlzcGxhY2VtZW50IGF0IDAuNQogICAgICAgICAgICAgICAgYmxvY2sub3ggPSBNYXRoLnNpbihjdXJyZW50RnJhbWUgKiAwLjggKyBibG9jay54KSAqIGNsYXNoU3RyZW5ndGg7CiAgICAgICAgICAgICAgICBibG9jay5veSA9IE1hdGguY29zKGN1cnJlbnRGcmFtZSAqIDAuOSArIGJsb2NrLnkpICogY2xhc2hTdHJlbmd0aDsKCiAgICAgICAgICAgICAgICAvLyAtLS0gMi4gQ29sb3IgRGlhbGVjdGljIChCbGVuZCkgLS0tCiAgICAgICAgICAgICAgICBjb25zdCByID0gTWF0aC5yb3VuZChibG9jay5jMVswXSArIChibG9jay5jMlswXSAtIGJsb2NrLmMxWzBdKSAqIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IE1hdGgucm91bmQoYmxvY2suYzFbMV0gKyAoYmxvY2suYzJbMV0gLSBibG9jay5jMVsxXSkgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBNYXRoLnJvdW5kKGJsb2NrLmMxWzJdICsgKGJsb2NrLmMyWzJdIC0gYmxvY2suYzFbMl0pICogZWFzZWRQcm9ncmVzcyk7CgogICAgICAgICAgICAgICAgLy8gLS0tIDMuIERyYXcgQmxvY2sgd2l0aCBPZmZzZXQgLS0tCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigke3J9LCAke2d9LCAke2J9KWA7CiAgICAgICAgICAgICAgICBjdHguZmlsbFJlY3QoCiAgICAgICAgICAgICAgICAgICAgYmxvY2sueCArIGJsb2NrLm94LCAKICAgICAgICAgICAgICAgICAgICBibG9jay55ICsgYmxvY2sub3ksIAogICAgICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmJsb2NrU2l6ZSwgCiAgICAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuYmxvY2tTaXplCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJEaWFsZWN0aWNhbCBGaWVsZCBGbHVjdHVhdGlvbiIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiAyNDogSWRlbnRpdHkgV2VhdmUgQ29sbGFwc2UgKFN0cmFuZCBVbnJhdmVsaW5nKSAtLS0KICAgIEFOSU1BVElPTl9MT0dJQ1sxOV0gPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgICAgICB0b3RhbEZyYW1lc2JiOiAxNDAsCiAgICAgICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLAogICAgICAgICAgICBzdHJhbmRzOiBbXSwKICAgICAgICAgICAgbnVtU3RyYW5kczogMzAwMAogICAgICAgIH07CgogICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuc3RyYW5kcyA9IFtdOwogICAgICAgICAgICBjb25zdCBpbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIGNvbnN0IGltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKCiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pcXVlU3RhdGUubnVtU3RyYW5kczsgaSsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5mbG9vcih3aWVsc2llZGVyKCkgKiBXSURUSCk7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gTWF0aC5mbG9vcih3aWVsc2llZGVyKCkgKiBIRUlHSFQpOwogICAgICAgICAgICAgICAgY29uc3QgaUEgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwoKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnN0cmFuZHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgeDogeCwgeTogeSwgCiAgICAgICAgICAgICAgICAgICAgZGVsYXk6IHdpZWxzaWVkZXIoKSAqIDUwLAogICAgICAgICAgICAgICAgICAgIC8vIEdldCB0d28gcG9pbnRzIHNsaWdodGx5IG9mZnNldCBmcm9tIHRoZSBtYWluIHBvaW50CiAgICAgICAgICAgICAgICAgICAgeDE6IHggKyAod2llbHNpZWRlcigpIC0gMC41KSAqIDUsIHkxOiB5ICsgKHdpZWxzaWVkZXIoKSAtIDAuNSkgKiA1LAogICAgICAgICAgICAgICAgICAgIHgyOiB4ICsgKHdpZWxzaWVkZXIoKSAtIDAuNSkgKiA1LCB5MjogeSArICh3aWVsc2llZGVyKCkgLSAwLjUpICogNSwKICAgICAgICAgICAgICAgICAgICBjMTogW2ltYWdlRGF0YUEuZGF0YVtpQV0sIGltYWdlRGF0YUEuZGF0YVtpQSsxXSwgaW1hZ2VEYXRhQS5kYXRhW2lBKzJdXSwKICAgICAgICAgICAgICAgICAgICBjMjogW2ltYWdlRGF0YUIuZGF0YVtpQV0sIGltYWdlRGF0YUIuZGF0YVtpQSsxXSwgaW1hZ2VEYXRhQi5kYXRhW2lBKzJdXSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgICAgICAvLyAqKkRlc2NyaXB0aW9uOiBUaGUgaW1hZ2UgZmFicmljIHVucmF2ZWxzIGludG8gdGhvdXNhbmRzIG9mIGNvbG9yZWQgc3RyYW5kcy4gVGhlIG9sZCBzdHJhbmRzIGRpc3NpcGF0ZSB3aGlsZSBuZXcgc3RyYW5kcyBzaW11bHRhbmVvdXNseSB3ZWF2ZSB0aGVtc2VsdmVzIGludG8gdGhlIGRlc3RpbmF0aW9uIGltYWdlJ3MgcG9zaXRpb24sIGNyZWF0aW5nIGEgYnJpZWYgbW9tZW50IG9mIGNvbXBsZXRlIHN0cnVjdHVyYWwgY29sbGFwc2UuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snOwogICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgICAgICB1bmlxdWVTdGF0ZS5zdHJhbmRzLmZvckVhY2gocyA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCB0aW1lID0gY3VycmVudEZyYW1lIC0gcy5kZWxheTsKICAgICAgICAgICAgICAgIGlmICh0aW1lIDwgMCkgcmV0dXJuOwoKICAgICAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IE1hdGgubWluKDEsIHRpbWUgLyAodG90YWxGcmFtZXMgLSBzLmRlbGF5KSk7CiAgICAgICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgICAgIC8vIEZhZGUgb3V0IHNvdXJjZSBjb2xvciAoVW5yYXZlbGluZykKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhMSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgLy8gRmFkZSBpbiBkZXN0aW5hdGlvbiBjb2xvciAoUmUtd2VhdmluZykKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhMiA9IGVhc2VkUHJvZ3Jlc3M7CgogICAgICAgICAgICAgICAgLy8gLS0tIDEuIFVucmF2ZWxpbmcgTW90aW9uIC0tLQogICAgICAgICAgICAgICAgY29uc3QgcmF2ZWxEaXN0ID0gMTUwICogZWFzZWRQcm9ncmVzczsgLy8gTWF4IGRpc3RhbmNlIHN0cmFuZHMgYXJlIHRocm93bgogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFgxID0gcy54MSArIChzLngxIC0gcy54KSAqIHJhdmVsRGlzdDsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRZMSA9IHMueTEgKyAocy55MSAtIHMueSkgKiByYXZlbERpc3Q7CgogICAgICAgICAgICAgICAgLy8gLS0tIDIuIFJlLXdlYXZpbmcgTW90aW9uIC0tLQogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFgyID0gcy54OwogICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFkyID0gcy55OwoKICAgICAgICAgICAgICAgIC8vIERyYXcgUmF2ZWxpbmcgU3RyYW5kIChJbWFnZSBBKQogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGExICogMC44OwogICAgICAgICAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gYHJnYigke3MuYzFbMF19LCAke3MuYzFbMV19LCAke3MuYzFbMl19KWA7CiAgICAgICAgICAgICAgICBjdHgubGluZVdpZHRoID0gMTsKICAgICAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8ocy54LCBzLnkpOwogICAgICAgICAgICAgICAgY3R4LmxpbmVUbyhjdXJyZW50WDEsIGN1cnJlbnRZMSk7CiAgICAgICAgICAgICAgICBjdHguc3Ryb2tlKCk7CgogICAgICAgICAgICAgICAgLy8gRHJhdyBXZWF2aW5nIFN0cmFuZCAoSW1hZ2UgQikKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMiAqIDAuODsKICAgICAgICAgICAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGByZ2IoJHtzLmMyWzBdfSwgJHtzLmMyWzFdfSwgJHtzLmMyWzJdfSlgOwogICAgICAgICAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDE7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHgubW92ZVRvKGN1cnJlbnRYMiwgY3VycmVudFkyKTsKICAgICAgICAgICAgICAgIGN0eC5saW5lVG8ocy54MiArIChzLngyIC0gcy54KSAqICgxIC0gZWFzZWRQcm9ncmVzcykgKiA1LCBzLnkyICsgKHMueTIgLSBzLnkpICogKDEgLSBlYXNlZFByb2dyZXNzKSAqIDUpOwogICAgICAgICAgICAgICAgY3R4LnN0cm9rZSgpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJJZGVudGl0eSBXZWF2ZSBDb2xsYXBzZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKICAgIH0pKCk7CgogICAgLy8gLS0tIEFOSU1BVElPTiAyNTogVGVtcG9yYWwgTGF5ZXJlZCBSb3RhdGlvbiAoRGltZW5zaW9uYWwgRmxpcCkgLS0tCiAgICBBTklNQVRJT05fTE9HSUNbMThdID0gKGZ1bmN0aW9uKCkgewogICAgICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICAgICAgdG90YWxGcmFtZXNiYjogMTIwLAogICAgICAgICAgICBjdXJyZW50RnJhbWViYjogMCwKICAgICAgICAgICAgbGF5ZXJzOiAyMCAvLyBOdW1iZXIgb2YgbGF5ZXJzIHRvIHNpbXVsYXRlIGRlcHRoCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICAvLyBObyBwaXhlbCBkYXRhIG1hbmlwdWxhdGlvbiBuZWVkZWQsIHJlbGllcyBvbiB0cmFuc2Zvcm1hdGlvbiBtYXRyaXgKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFRoZSBpbWFnZSBzbGljZXMgaW50byBtYW55IHRyYW5zcGFyZW50IGxheWVycyB0aGF0IHJvdGF0ZSBhdCBkaWZmZXJlbnQgc3BlZWRzIGFyb3VuZCBhIGNlbnRyYWwgYXhpcyAoc2ltdWxhdGluZyBhIGRpbWVuc2lvbmFsIGZsaXApLiBUaGUgc291cmNlIGltYWdlIHJvdGF0ZXMgYXdheSBpbnRvIHRoZSBiYWNrZ3JvdW5kIHdoaWxlIHRoZSBuZXcgaW1hZ2Ugcm90YXRlcyBmb3J3YXJkIGZyb20gdGhlIGZvcmVncm91bmQuKioKICAgICAgICAgICAgY29uc3QgY3VycmVudEZyYW1lID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmI7CiAgICAgICAgICAgIGNvbnN0IHRvdGFsRnJhbWVzID0gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICAgICAgcHJvZ3Jlc3MgPSBjdXJyZW50RnJhbWUgLyB0b3RhbEZyYW1lczsKICAgICAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snOwogICAgICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKFdJRFRIIC8gMiwgSEVJR0hUIC8gMik7IC8vIE1vdmUgb3JpZ2luIHRvIGNlbnRlcgoKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5sYXllcnM7IGkrKykgewogICAgICAgICAgICAgICAgY29uc3QgbGF5ZXJQcm9ncmVzcyA9IChpIC8gdW5pcXVlU3RhdGUubGF5ZXJzKTsKICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyRGVwdGggPSBpICogMjsgLy8gWi1kZXB0aCBvZmZzZXQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUm90YXRpb24gQW5nbGU6IEZsaXBzIGZyb20gMCB0byAxODAgZGVncmVlcyAoUEkgcmFkaWFucykKICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsUm90YXRpb24gPSBNYXRoLlBJICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGlmZmVyZW50aWFsIFJvdGF0aW9uOiBMYXllcnMgcm90YXRlIGF0IHNsaWdodGx5IGRpZmZlcmVudCBzcGVlZHMvcGhhc2VzIGZvciBhIDNEIGVmZmVjdAogICAgICAgICAgICAgICAgY29uc3Qgcm90YXRpb24gPSB0b3RhbFJvdGF0aW9uICsgbGF5ZXJQcm9ncmVzcyAqIE1hdGguUEkgKiAwLjE7CgogICAgICAgICAgICAgICAgLy8gLS0tIERyYXcgU291cmNlIEltYWdlIChSb3RhdGVzIE91dCkgLS0tCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RhdGlvbik7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRQcm9ncmVzczsgLy8gRmFkZXMgb3V0CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgLVdJRFRIIC8gMiwgLUhFSUdIVCAvIDIsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gRHJhdyBEZXN0aW5hdGlvbiBJbWFnZSAoUm90YXRlcyBJbikgLS0tCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RhdGlvbiAtIE1hdGguUEkpOyAvLyBTdGFydHMgMTgwIGRlZ3JlZXMgb3Bwb3NpdGUKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkUHJvZ3Jlc3M7IC8vIEZhZGVzIGluCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgLVdJRFRIIC8gMiwgLUhFSUdIVCAvIDIsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsgLy8gUmVzdG9yZSBvcmlnaW4KCiAgICAgICAgICAgIGlmIChjdXJyZW50RnJhbWUgPCB0b3RhbEZyYW1lcykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHsgdGl0bGU6ICJUZW1wb3JhbCBMYXllcmVkIFJvdGF0aW9uIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCiAgICAvLyAtLS0gQU5JTUFUSU9OIDI2OiBOb24tRXVjbGlkZWFuIE1lbW9yeSBUcmFjZSAoU3dhcm0gJiBSZWZvcm0pIC0tLQogICAgQU5JTUFUSU9OX0xPR0lDWzE3XSA9IChmdW5jdGlvbigpIHsKICAgICAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgICAgIHRvdGFsRnJhbWVzYmI6IDE4MCwKICAgICAgICAgICAgY3VycmVudEZyYW1lYmI6IDAsCiAgICAgICAgICAgIGltYWdlRGF0YUE6IG51bGwsCiAgICAgICAgICAgIGltYWdlRGF0YUI6IG51bGwsCiAgICAgICAgfTsKCiAgICAgICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5pbWFnZURhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmltYWdlRGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CgogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgICAgIC8vICoqRGVzY3JpcHRpb246IFBpeGVscyBhcmUgZGlzcGxhY2VkIGJ5IGEgY29tcGxleCwgdGltZS1iYXNlZCBmaWVsZCAoTm9uLUV1Y2xpZGVhbiBtYXBwaW5nKSwgY2F1c2luZyB0aGVtIHRvIHN3YXJtIGNoYW90aWNhbGx5IGFsb25nIGN1cnZlZCBwYXRocyBiZWZvcmUgcmFwaWRseSByZWZvcm1pbmcgaW50byB0aGUgbmV3IGltYWdlLCBsZWF2aW5nIGEgc2hpbW1lcmluZyAnbWVtb3J5IHRyYWNlJyBvZiB0aGUgdHJhbnNpdGlvbi4qKgogICAgICAgICAgICBjb25zdCBjdXJyZW50RnJhbWUgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYjsKICAgICAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgICAgICBwcm9ncmVzcyA9IGN1cnJlbnRGcmFtZSAvIHRvdGFsRnJhbWVzOwogICAgICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsKICAgICAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOwogICAgICAgICAgICBjb25zdCBkYXRhQSA9IHVuaXF1ZVN0YXRlLmltYWdlRGF0YUEuZGF0YTsKICAgICAgICAgICAgY29uc3QgZGF0YUIgPSB1bmlxdWVTdGF0ZS5pbWFnZURhdGFCLmRhdGE7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBNYXhpbXVtIFN3YXJtIGRpc3BsYWNlbWVudCBhdCA1MCUKICAgICAgICAgICAgY29uc3Qgc3dhcm1TdHJlbmd0aCA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSkgKiAxMDA7CgogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDEuIENvbXBsZXggRGlzcGxhY2VtZW50IE1hcCAoU2ltdWxhdGVkIE5vbi1FdWNsaWRlYW4gUGF0aCkgLS0tCiAgICAgICAgICAgICAgICAgICAgLy8gVXNlIHRyaWdvbm9tZXRyaWMgZnVuY3Rpb25zIGluZmx1ZW5jZWQgYnkgdGltZSBhbmQgcG9zaXRpb24KICAgICAgICAgICAgICAgICAgICBjb25zdCBkeCA9IE1hdGguc2luKHggKiAwLjA1ICsgY3VycmVudEZyYW1lICogMC4wNSkgKiBNYXRoLmNvcyh5ICogMC4wMykgKiBzd2FybVN0cmVuZ3RoOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0gTWF0aC5jb3MoeSAqIDAuMDUgKyBjdXJyZW50RnJhbWUgKiAwLjA2KSAqIE1hdGguc2luKHggKiAwLjAzKSAqIHN3YXJtU3RyZW5ndGg7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDIuIFRhcmdldCBQb3NpdGlvbiAobW92ZXMgZnJvbSBBJ3MgcG9zaXRpb24gdG8gQidzIHBvc2l0aW9uKSAtLS0KICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRYID0geCArIGR4ICogKDEgLSBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRZID0geSArIGR5ICogKDEgLSBlYXNlZFByb2dyZXNzKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIDMuIFNvdXJjZSBJbWFnZSBTYW1wbGluZyAoSW52ZXJzZSBNYXBwaW5nKSAtLS0KICAgICAgICAgICAgICAgICAgICAvLyBXZSBzYW1wbGUgdGhlIE9MRCBpbWFnZSAoQSkgYXQgYSBwb3NpdGlvbiB0aGF0IG1hcHMgdG8gdGhlIG5ldyB0YXJnZXQKICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRYID0gTWF0aC5mbG9vcih4IC0gZHggKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRZID0gTWF0aC5mbG9vcih5IC0gZHkgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFggPj0gMCAmJiBvbGRYIDwgV0lEVEggJiYgb2xkWSA+PSAwICYmIG9sZFkgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaU9sZCA9IChvbGRZICogV0lEVEggKyBvbGRYKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gNC4gQ29sb3IgQmxlbmQgLS0tCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJBID0gZGF0YUFbaU9sZF07IGNvbnN0IGdBID0gZGF0YUFbaU9sZCsxXTsgY29uc3QgYkEgPSBkYXRhQVtpT2xkKzJdOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldOyBjb25zdCBnQiA9IGRhdGFCW2krMV07IGNvbnN0IGJCID0gZGF0YUJbaSsyXTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEJsZW5kIGNvbG9yIGJhc2VkIG9uIHByb2dyZXNzCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHJBICsgKHJCIC0gckEpICogZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnQSArIChnQiAtIGdBKSAqIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYkEgKyAoYkIgLSBiQSkgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7IAogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOwoKICAgICAgICAgICAgaWYgKGN1cnJlbnRGcmFtZSA8IHRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4geyB0aXRsZTogIk5vbi1FdWNsaWRlYW4gTWVtb3J5IFRyYWNlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9OwogICAgfSkoKTsKCi8vIC0tLSBBTklNQVRJT04gNjg6IExvcmVueiBBdHRyYWN0b3IgUGl4ZWwgU29ydCAoUGVyZm9ybWFuY2UgT3B0aW1pemVkKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzY4XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMjAwLCBjdXJyZW50RnJhbWU6IDAsIHBpeGVsTWFwOiBbXSB9OwogICAgY29uc3QgU0lHTUEgPSAxMCwgUkhPID0gMjgsIEJFVEEgPSA4LzMsIERUID0gMC4wMDU7CiAgICBjb25zdCBNQVhfSVRFUkFUSU9OUyA9IDQwMDAwOwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICAvLyBQcmUtY2FsY3VsYXRlIHRoZSBjaGFvdGljIHBhdGggb25jZSAoUGVyZm9ybWFuY2UgQm9vc3QpCiAgICAgICAgbGV0IHg9MSwgeT0xLCB6PTE7IAogICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVsTWFwID0gW107CgogICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgTUFYX0lURVJBVElPTlMgJiYgdW5pcXVlU3RhdGUucGl4ZWxNYXAubGVuZ3RoIDwgV0lEVEggKiBIRUlHSFQ7IHQrKykgewogICAgICAgICAgICBjb25zdCBuZXh0ID0gbG9yZW56TWFwKHgsIHksIHosIFNJR01BLCBSSE8sIEJFVEEsIERUKTsKICAgICAgICAgICAgeCA9IG5leHQueDsgeSA9IG5leHQueTsgeiA9IG5leHQuejsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIE1hcCB0aGUgY2hhb3RpYyBzdGF0ZSB0byAyRCBzY3JlZW4gY29vcmRpbmF0ZXMKICAgICAgICAgICAgY29uc3QgbWFwcGVkWCA9IE1hdGguZmxvb3IoKHggKiAxMCArIDIwMCkgJSBXSURUSCk7IAogICAgICAgICAgICBjb25zdCBtYXBwZWRZID0gTWF0aC5mbG9vcigoeSAqIDEwICsgMjAwKSAlIEhFSUdIVCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGl4ZWxNYXAucHVzaCh7IHg6IG1hcHBlZFgsIHk6IG1hcHBlZFkgfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVhcnRpYyhwcm9ncmVzcyk7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIFdJRFRILCBIRUlHSFQpOyAvLyBEcmF3IEEgYXMgYmFzZQogICAgICAgIAogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IC8vIEZJWAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgLy8gRklYCiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwoKICAgICAgICAvLyBXYXJwaW5nIEltYWdlIEEgKE9wdGlvbmFsOiB1c2UgY3R4IGRyYXcgZm9yIHdhcnAgZWZmZWN0KQogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShXSURUSCAvIDIsIEhFSUdIVCAvIDIpOwogICAgICAgIGN0eC5yb3RhdGUocHJvZ3Jlc3MgKiBNYXRoLlBJIC8gOCk7CiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIC1XSURUSCAvIDIsIC1IRUlHSFQgLyAyLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIAogICAgICAgIGNvbnN0IHBpeGVsc1RvRHJhdyA9IE1hdGguZmxvb3IoZWFzZWRQcm9ncmVzcyAqIHVuaXF1ZVN0YXRlLnBpeGVsTWFwLmxlbmd0aCk7CiAgICAgICAgCiAgICAgICAgLy8gT25seSBkcmF3IEltYWdlIEIgcGl4ZWxzIGFsb25nIHRoZSBwYXRoIG9udG8gdGhlIHNjcmF0Y2hwYWQKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IHBpeGVsc1RvRHJhdzsgaysrKSB7CiAgICAgICAgICAgIGNvbnN0IG1hcCA9IHVuaXF1ZVN0YXRlLnBpeGVsTWFwW2tdOwogICAgICAgICAgICBjb25zdCBweCA9IG1hcC54OwogICAgICAgICAgICBjb25zdCBweSA9IG1hcC55OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgaSA9IChweSAqIFdJRFRIICsgcHgpICogNDsKCiAgICAgICAgICAgIGlmIChpIDwgb3V0cHV0RGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBkYXRhQltpXTsgb3V0cHV0RGF0YVtpICsgMV0gPSBkYXRhQltpICsgMV07IG91dHB1dERhdGFbaSArIDJdID0gZGF0YUJbaSArIDJdOwogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsKICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IC8vIE92ZXJsYXkgdGhlIGNoYW90aWMgcGl4ZWxzIChGSVgpCgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIkxvcmVueiBBdHRyYWN0b3IgUGl4ZWwgU29ydCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCi8vIC0tLSBBTklNQVRJT04gNjk6IE1hbmRlbGJyb3QgQm91bmRhcnkgVHJhY2UgLS0tCkFOSU1BVElPTl9MT0dJQ1s2OV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDE4MCwgY3VycmVudEZyYW1lOiAwLCBNQVhfSVRFUjogNTAgfTsKICAgIGNvbnN0IFJFTkRFUl9TVEVQID0gMjsgLy8gUGl4ZWwgc3RlcHBpbmcgZm9yIHNwZWVkCgogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAvLyBGSVgKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IC8vIEZJWAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7CgogICAgICAgIC8vIFBBUkFNRVRFUjogRHluYW1pYyBab29tL3BhbgogICAgICAgIGNvbnN0IHpvb20gPSAxICsgZWFzZWRQcm9ncmVzcyAqIDE1OyAKICAgICAgICBjb25zdCBjZW50ZXJfeCA9IC0wLjUgKyBNYXRoLmNvcyhwcm9ncmVzcyAqIE1hdGguUEkgKiAyKSAqIDAuMTsKICAgICAgICBjb25zdCBjZW50ZXJfeSA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSAqIDIpICogMC4xOwogICAgICAgIAogICAgICAgIGNvbnN0IFJfTUlOID0gY2VudGVyX3ggLSAxLjUgLyB6b29tOwogICAgICAgIGNvbnN0IElfTUFYID0gY2VudGVyX3kgKyAxLjUgLyB6b29tOwogICAgICAgIGNvbnN0IFJfUkFOR0UgPSAoMS41IC8gem9vbSkgKiAyOwogICAgICAgIGNvbnN0IElfUkFOR0UgPSBSX1JBTkdFICogKEhFSUdIVCAvIFdJRFRIKTsKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gUkVOREVSX1NURVApIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBSRU5ERVJfU1RFUCkgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CgogICAgICAgICAgICAgICAgbGV0IGNyID0gUl9NSU4gKyB4IC8gV0lEVEggKiBSX1JBTkdFOwogICAgICAgICAgICAgICAgbGV0IGNpID0gSV9NQVggLSB5IC8gSEVJR0hUICogSV9SQU5HRTsKCiAgICAgICAgICAgICAgICBsZXQgenIgPSAwLCB6aSA9IDA7CiAgICAgICAgICAgICAgICBsZXQgaXRlciA9IDA7CiAgICAgICAgICAgICAgICB3aGlsZSAoenIqenIgKyB6aSp6aSA8IDQgJiYgaXRlciA8IHVuaXF1ZVN0YXRlLk1BWF9JVEVSKSB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHRlbXBfenIgPSB6cip6ciAtIHppKnppICsgY3I7CiAgICAgICAgICAgICAgICAgICAgemkgPSAyKnpyKnppICsgY2k7CiAgICAgICAgICAgICAgICAgICAgenIgPSB0ZW1wX3pyOwogICAgICAgICAgICAgICAgICAgIGl0ZXIrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgckEgPSBkYXRhQVtpXSwgZ0EgPSBkYXRhQVtpKzFdLCBiQSA9IGRhdGFBW2krMl07CiAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldLCBnQiA9IGRhdGFCW2krMV0sIGJCID0gZGF0YUJbaSsyXTsKCiAgICAgICAgICAgICAgICBsZXQgciwgZywgYjsKICAgICAgICAgICAgICAgIGlmIChpdGVyIDwgdW5pcXVlU3RhdGUuTUFYX0lURVIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBPVVRTSURFOiBCbGVuZCB0b3dhcmRzIEIgYmFzZWQgb24gZnJhY3RhbCBjb2xvcgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZXJfZmFjdG9yID0gaXRlciAvIHVuaXF1ZVN0YXRlLk1BWF9JVEVSOwogICAgICAgICAgICAgICAgICAgIHIgPSByQiAqICgxIC0gaXRlcl9mYWN0b3IpICsgckEgKiBpdGVyX2ZhY3RvcjsKICAgICAgICAgICAgICAgICAgICBnID0gZ0IgKiAoMSAtIGl0ZXJfZmFjdG9yKSArIGdBICogaXRlcl9mYWN0b3I7CiAgICAgICAgICAgICAgICAgICAgYiA9IGJCICogKDEgLSBpdGVyX2ZhY3RvcikgKyBiQSAqIGl0ZXJfZmFjdG9yOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBJTlNJREU6IFJlbWFpbnMgQQogICAgICAgICAgICAgICAgICAgIHIgPSByQTsgZyA9IGdBOyBiID0gYkE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgdG8gdGhlIGJsb2NrCiAgICAgICAgICAgICAgICBmb3IobGV0IGR5PTA7IGR5PFJFTkRFUl9TVEVQOyBkeSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yKGxldCBkeD0wOyBkeDxSRU5ERVJfU1RFUDsgZHgrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsSSA9ICgoeSArIGR5KSAqIFdJRFRIICsgKHggKyBkeCkpICogNDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYoY2VsbEkgPCBvdXRwdXREYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbY2VsbEldID0gTWF0aC5yb3VuZChyKTsgb3V0cHV0RGF0YVtjZWxsSSArIDFdID0gTWF0aC5yb3VuZChnKTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtjZWxsSSArIDJdID0gTWF0aC5yb3VuZChiKTsgb3V0cHV0RGF0YVtjZWxsSSArIDNdID0gMjU1OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsgLy8gRklYCgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIk1hbmRlbGJyb3QgQm91bmRhcnkgVHJhY2UiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgovLyAtLS0gQU5JTUFUSU9OIDcwOiBWb3Jvbm9pIFN0aXBwbGUgJiBDb2xsYXBzZSAoT3B0aW1pemVkKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzcwXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTQwLCBjdXJyZW50RnJhbWU6IDAsIHBvaW50czogW10gfTsKICAgIGNvbnN0IE5VTV9QT0lOVFMgPSA1MDA7IAoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICB1bmlxdWVTdGF0ZS5wb2ludHMgPSBbXTsKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5VTV9QT0lOVFM7IGkrKykgewogICAgICAgICAgICBjb25zdCB4ID0gTWF0aC5mbG9vcih3aWVsc2llZGVyKCkgKiBXSURUSCk7CiAgICAgICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKHdpZWxzaWVkZXIoKSAqIEhFSUdIVCk7CiAgICAgICAgICAgIGNvbnN0IGk0ID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgCiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBvaW50cy5wdXNoKHsKICAgICAgICAgICAgICAgIHg6IHgsIHk6IHksCiAgICAgICAgICAgICAgICBkZWxheTogd2llbHNpZWRlcigpICogNDAsCiAgICAgICAgICAgICAgICBjb2xvckE6IHsgcjogZGF0YUFbaTRdLCBnOiBkYXRhQVtpNCArIDFdLCBiOiBkYXRhQVtpNCArIDJdIH0sCiAgICAgICAgICAgICAgICBjb2xvckI6IHsgcjogZGF0YUJbaTRdLCBnOiBkYXRhQltpNCArIDFdLCBiOiBkYXRhQltpNCArIDJdIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdG90YWxGcmFtZXMgPSB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgIAogICAgICAgIHVuaXF1ZVN0YXRlLnBvaW50cy5mb3JFYWNoKHBvaW50ID0+IHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAtIHBvaW50LmRlbGF5OwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHRpbWUgPj0gMCkgewogICAgICAgICAgICAgICAgY29uc3QgcG9pbnRQcm9ncmVzcyA9IE1hdGgubWluKDEsIHRpbWUgLyAodG90YWxGcmFtZXMgLSA0MCkpOwogICAgICAgICAgICAgICAgY29uc3QgcCA9IGVhc2VJbk91dFF1YXJ0aWMocG9pbnRQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENvbmRlbnNhdGlvbiBmYWN0b3I6IDEgYXQgMCUgYW5kIDEwMCUsIDAgYXQgNTAlCiAgICAgICAgICAgICAgICBjb25zdCBjb25kZW5zZUZhY3RvciA9IE1hdGguYWJzKHAgLSAwLjUpICogMjsgCgogICAgICAgICAgICAgICAgLy8gU2l6ZSBvZiB0aGUgc2ltdWxhdGVkIHJlZ2lvbgogICAgICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IDE1ICogY29uZGVuc2VGYWN0b3IgKiAoMSAtIHApOyAvLyBTaHJpbmsgZmFjdG9yCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCByLCBnLCBiOwogICAgICAgICAgICAgICAgaWYgKHAgPCAwLjUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBTaHJpbmtpbmcgQQogICAgICAgICAgICAgICAgICAgIHIgPSBwb2ludC5jb2xvckEucjsgZyA9IHBvaW50LmNvbG9yQS5nOyBiID0gcG9pbnQuY29sb3JBLmI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEV4cGFuZGluZyBCCiAgICAgICAgICAgICAgICAgICAgciA9IHBvaW50LmNvbG9yQi5yOyBnID0gcG9pbnQuY29sb3JCLmc7IGIgPSBwb2ludC5jb2xvckIuYjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigke01hdGgucm91bmQocil9LCAke01hdGgucm91bmQoZyl9LCAke01hdGgucm91bmQoYil9KWA7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHguYXJjKHBvaW50LngsIHBvaW50LnksIHNpemUgKiAocCA8IDAuNSA/IDEgOiAxLjUpLCAwLCBNYXRoLlBJICogMik7CiAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlZvcm9ub2kgU3RpcHBsZSAmIENvbGxhcHNlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwoKCgoKCgoKLy8gLS0tIEFOSU1BVElPTiA3OTogSXRlcmF0ZWQgRnVuY3Rpb24gU3lzdGVtIChJRlMpIEJsZW5kIChQcmUtY2FsY3VsYXRlZCBNYXApIC0tLQpBTklNQVRJT05fTE9HSUNbNzldID0gKGZ1bmN0aW9uKCkgewogICAgLy8gQXNzdW1pbmcgV0lEVEggYW5kIEhFSUdIVCBhcmUgZ2xvYmFsIGFuZCBhdmFpbGFibGUKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogMTUwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsIAogICAgICAgIGlmc01hcDogW10sCiAgICAgICAgaW1hZ2VEYXRhQTogbnVsbCAvLyBTdG9yZSBpbWFnZSBkYXRhIGZvciBBIG9uY2UKICAgIH07CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIHVuaXF1ZVN0YXRlLmlmc01hcCA9IFtdOwogICAgICAgIC8vIFByZS1jYWxjdWxhdGUgZGF0YSBmb3IgSW1hZ2UgQSBvbmNlCiAgICAgICAgdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwoKICAgICAgICBjb25zdCBudW1TYW1wbGVzID0gV0lEVEggKiBIRUlHSFQ7CiAgICAgICAgCiAgICAgICAgLy8gUnVsZXMgZm9yIEJhcm5zbGV5IEZlcm4tbGlrZSBtYXAKICAgICAgICAvLyAuLi4gKFJ1bGVzIHJlbWFpbiB0aGUgc2FtZSkKICAgICAgICBjb25zdCBydWxlcyA9IFsKICAgICAgICAgICAgeyBhOiAwLjg1LCBiOiAwLjA0LCBjOiAtMC4wNCwgZDogMC44NSwgZTogMCwgZjogMS42LCB3ZWlnaHQ6IDAuODUgfSwgLy8gU3RlbQogICAgICAgICAgICB7IGE6IDAuMjAsIGI6IC0wLjI2LCBjOiAwLjIzLCBkOiAwLjIyLCBlOiAwLCBmOiAxLjYsIHdlaWdodDogMC4wNyB9LCAvLyBTbWFsbCBMZWFmCiAgICAgICAgICAgIHsgYTogLTAuMTUsIGI6IDAuMjgsIGM6IDAuMjYsIGQ6IDAuMjQsIGU6IDAsIGY6IDAuNDQsIHdlaWdodDogMC4wNyB9LCAvLyBTbWFsbCBMZWFmCiAgICAgICAgICAgIHsgYTogMC4wMCwgYjogMC4wMCwgYzogMC4wMCwgZDogMC4xNiwgZTogMCwgZjogMC4wMCwgd2VpZ2h0OiAwLjAxIH0sIC8vIEJhc2UKICAgICAgICBdOwogICAgICAgIAogICAgICAgIC8vIFVzZSBhIHByb3BlciB3ZWlnaHRlZCByYW5kb20gc2VsZWN0aW9uIGlmIHBvc3NpYmxlICh0aG91Z2ggdGhlIGN1cnJlbnQgYXBwcm9hY2ggaXMgZmFzdGVyKQogICAgICAgIC8vIFNpbmNlIHlvdSdyZSB1c2luZyB3aWVsc2llZGVyKCkgKiBydWxlcy5sZW5ndGgsIEknbGwgc3RpY2sgdG8gdGhhdCBmYXN0IChidXQgbm9uLXdlaWdodGVkKSBydWxlIHNlbGVjdGlvbi4KCiAgICAgICAgbGV0IHggPSAwLCB5ID0gMDsgCiAgICAgICAgZm9yKGxldCBrID0gMDsgayA8IG51bVNhbXBsZXMgKiAwLjU7IGsrKykgeyAvLyBPbmx5IG1hcCBoYWxmIHRoZSBwaXhlbHMgZm9yIHNwZWVkCiAgICAgICAgICAgICAvLyBUaGlzIGFzc3VtZXMgYSBnbG9iYWwgJ3dpZWxzaWVkZXInIHJhbmRvbSBmdW5jdGlvbiBleGlzdHMKICAgICAgICAgICAgIGNvbnN0IHJ1bGUgPSBydWxlc1tNYXRoLmZsb29yKHdpZWxzaWVkZXIoKSAqIHJ1bGVzLmxlbmd0aCldOyAKICAgICAgICAgICAgIGNvbnN0IG5leHRfeCA9IHJ1bGUuYSAqIHggKyBydWxlLmIgKiB5ICsgcnVsZS5lOwogICAgICAgICAgICAgY29uc3QgbmV4dF95ID0gcnVsZS5jICogeCArIHJ1bGUuZCAqIHkgKyBydWxlLmY7CiAgICAgICAgICAgICB4ID0gbmV4dF94OyB5ID0gbmV4dF95OwogICAgICAgICAgICAgCiAgICAgICAgICAgICAvLyBUaGUgMTAgLyAxMCBzY2FsZSBzZWVtcyBhcmJpdHJhcnksIGJ1dCBJJ2xsIGtlZXAgdGhlIGxvZ2ljCiAgICAgICAgICAgICBjb25zdCBtYXBYID0gTWF0aC5yb3VuZCh4ICogV0lEVEggLyAxMCArIFdJRFRILzIpOwogICAgICAgICAgICAgY29uc3QgbWFwWSA9IE1hdGgucm91bmQoeSAqIEhFSUdIVCAvIDEwICsgSEVJR0hULzIpOwogICAgICAgICAgICAgCiAgICAgICAgICAgICAvLyBPbmx5IHN0b3JlIHZhbGlkIG1hcCBjb29yZGluYXRlcwogICAgICAgICAgICAgaWYgKG1hcFggPj0gMCAmJiBtYXBYIDwgV0lEVEggJiYgbWFwWSA+PSAwICYmIG1hcFkgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgKnNvdXJjZSogcGl4ZWwgaW5kZXggKGspIGFuZCB0aGUgKmluaXRpYWwgdGFyZ2V0KiBJRlMgcG9zaXRpb24gKG1hcFgsIG1hcFkpCiAgICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuaWZzTWFwLnB1c2goeyBzcmNLOiBrLCBtYXBYOiBtYXBYLCBtYXBZOiBtYXBZIH0pOwogICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zb2xlLmxvZyhgSUZTIE1hcCBnZW5lcmF0ZWQgd2l0aCAke3VuaXF1ZVN0YXRlLmlmc01hcC5sZW5ndGh9IHBvaW50cy5gKTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgLy8gMS4gRHJhdyBJbWFnZSBCIChuZXh0SW1hZ2UpIGFzIHRoZSBiYXNlIGJhY2tncm91bmQKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwogICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBXSURUSCwgSEVJR0hUKTsgCgogICAgICAgIC8vIDIuIFByZXBhcmUgbmV3IGltYWdlIGRhdGEgb2JqZWN0IGZvciB0aGUgJ3dhcnBlZCBBJyBsYXllcgogICAgICAgIC8vIFdlIHJldXNlIHRoZSBpbWFnZURhdGFBIG9iamVjdCB0byBnZXQgYSBibGFuayBvbmUgb2YgdGhlIGNvcnJlY3Qgc2l6ZQogICAgICAgIGNvbnN0IHdhcnBlZEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgY29uc3Qgd2FycGVkRGF0YSA9IHdhcnBlZEltYWdlRGF0YS5kYXRhOwogICAgICAgIAogICAgICAgIGNvbnN0IGRhdGFBID0gdW5pcXVlU3RhdGUuaW1hZ2VEYXRhQS5kYXRhOwogICAgICAgIGNvbnN0IG51bVRvRHJhdyA9IHVuaXF1ZVN0YXRlLmlmc01hcC5sZW5ndGg7CiAgICAgICAgCiAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBibGVuZGluZyBhbHBoYSBvdXRzaWRlIHRoZSBsb29wCiAgICAgICAgY29uc3QgYWxwaGEgPSBNYXRoLm1heCgwLCAxIC0gZWFzZWRQcm9ncmVzcyk7IAoKICAgICAgICAvLyAtLS0gRkFTVCBQaXhlbCBNYW5pcHVsYXRpb24gKHVzaW5nIEltYWdlRGF0YSkgLS0tCiAgICAgICAgZm9yIChsZXQgaWR4ID0gMDsgaWR4IDwgbnVtVG9EcmF3OyBpZHgrKykgewogICAgICAgICAgICBjb25zdCBtYXAgPSB1bmlxdWVTdGF0ZS5pZnNNYXBbaWR4XTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIGEpIFNvdXJjZSBmcm9tIEltYWdlIEE6IFRoZSBvcmlnaW5hbCBpbmRleCB3YXMgJ2snIChub3cgbWFwLnNyY0spCiAgICAgICAgICAgIC8vIFRoZSBwaXhlbCBpbmRleCBpbiBkYXRhQSBpcyBjYWxjdWxhdGVkIGZyb20gbWFwLnNyY0ssIG5vdCBpZHgKICAgICAgICAgICAgY29uc3QgaSA9IChtYXAuc3JjSyAqIDQpOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpICsgMyA+PSBkYXRhQS5sZW5ndGgpIGNvbnRpbnVlOyAvLyBTYWZldHkgY2hlY2sKCiAgICAgICAgICAgIC8vIGIpIEZpbmFsIERlc3RpbmF0aW9uIChUYXJnZXQgQik6IFRoZSBvcmlnaW5hbCBsb2dpYyB1c2VkIHRhcmdldFgvWSAKICAgICAgICAgICAgLy8gYmFzZWQgb24gdGhlIGxvb3AgaW5kZXggKGspLCB3aGljaCBpcyBub3cgaWR4LgogICAgICAgICAgICBjb25zdCB0YXJnZXRYID0gKGlkeCAlIFdJRFRIKTsgCiAgICAgICAgICAgIGNvbnN0IHRhcmdldFkgPSBNYXRoLmZsb29yKGlkeCAvIFdJRFRIKTsKCiAgICAgICAgICAgIC8vIGMpIEludGVycG9sYXRlIHBvc2l0aW9uOiBUaGlzIGRldGVybWluZXMgd2hlcmUgdGhlIHBpeGVsICpmcm9tKiBJbWFnZSBBICpnb2VzKgogICAgICAgICAgICBjb25zdCBkcmF3WCA9IE1hdGgucm91bmQobWFwLm1hcFggKyAodGFyZ2V0WCAtIG1hcC5tYXBYKSAqIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICBjb25zdCBkcmF3WSA9IE1hdGgucm91bmQobWFwLm1hcFkgKyAodGFyZ2V0WSAtIG1hcC5tYXBZKSAqIGVhc2VkUHJvZ3Jlc3MpOwoKICAgICAgICAgICAgLy8gZCkgV3JpdGUgdG8gd2FycGVkSW1hZ2VEYXRhOiBPbmx5IHdyaXRlIGlmIHRoZSB0YXJnZXQgcG9zaXRpb24gaXMgd2l0aGluIGJvdW5kcwogICAgICAgICAgICBpZiAoZHJhd1ggPj0gMCAmJiBkcmF3WCA8IFdJRFRIICYmIGRyYXdZID49IDAgJiYgZHJhd1kgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFBpeGVsSW5kZXggPSAoZHJhd1kgKiBXSURUSCArIGRyYXdYKSAqIDQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFJlYWQgUkdCIGZyb20gc291cmNlIEEKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBkYXRhQVtpXTsKICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBkYXRhQVtpKzFdOwogICAgICAgICAgICAgICAgY29uc3QgYiA9IGRhdGFBW2krMl07CgogICAgICAgICAgICAgICAgLy8gV3JpdGUgUkdCIGFuZCB0aGUgY2FsY3VsYXRlZCBBbHBoYSB0byB0aGUgd2FycGVkIGltYWdlIGRhdGEKICAgICAgICAgICAgICAgIC8vIE5vdGU6IFRoaXMgb3ZlcndyaXRlcyBhbnkgcHJldmlvdXMgcGl4ZWwgd3JpdHRlbiB0byB0aGlzIGxvY2F0aW9uLgogICAgICAgICAgICAgICAgd2FycGVkRGF0YVt0YXJnZXRQaXhlbEluZGV4XSA9IHI7CiAgICAgICAgICAgICAgICB3YXJwZWREYXRhW3RhcmdldFBpeGVsSW5kZXggKyAxXSA9IGc7CiAgICAgICAgICAgICAgICB3YXJwZWREYXRhW3RhcmdldFBpeGVsSW5kZXggKyAyXSA9IGI7CiAgICAgICAgICAgICAgICB3YXJwZWREYXRhW3RhcmdldFBpeGVsSW5kZXggKyAzXSA9IDI1NSAqIGFscGhhOyAvLyBTZXQgQWxwaGEgYmFzZWQgb24gYmxlbmQKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAzLiBEcmF3IHRoZSBjb21iaW5lZCBwaXhlbCBkYXRhIG9udG8gdGhlIGNhbnZhcyBpbiBhIHNpbmdsZSwgZmFzdCBvcGVyYXRpb24KICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKHdhcnBlZEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIklGUyBGcmFjdGFsIENvbGxhcHNlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwoKLy8gLS0tIEFOSU1BVElPTiA4MDogU3RhdGlzdGljYWwgTW9tZW50IFNoaWZ0IChCbG9jay1iYXNlZCwgUHJlLWNhbGN1bGF0ZWQpIC0tLQpBTklNQVRJT05fTE9HSUNbODBdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMjAsIGN1cnJlbnRGcmFtZTogMCwgYmxvY2tzOiBbXSB9OwogICAgY29uc3QgQkxPQ0tfU0laRSA9IDEwOyAKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgdW5pcXVlU3RhdGUuYmxvY2tzID0gW107CiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOwoKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSBCTE9DS19TSVpFKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gQkxPQ0tfU0laRSkgewogICAgICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIE1lYW4gTHVtaW5hbmNlICgxc3QgbW9tZW50KQogICAgICAgICAgICAgICAgbGV0IHN1bUwgPSAwOwogICAgICAgICAgICAgICAgZm9yIChsZXQgZHkgPSAwOyBkeSA8IEJMT0NLX1NJWkU7IGR5KyspIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBkeCA9IDA7IGR4IDwgQkxPQ0tfU0laRTsgZHgrKykgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKCh5ICsgZHkpICogV0lEVEggKyAoeCArIGR4KSkgKiA0OwogICAgICAgICAgICAgICAgICAgICAgICBpZihpIDwgZGF0YUEubGVuZ3RoKSBzdW1MICs9IChkYXRhQVtpXSAqIDAuMjEgKyBkYXRhQVtpKzFdICogMC43MiArIGRhdGFBW2krMl0gKiAwLjA3KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb25zdCBtZWFuTCA9IHN1bUwgLyAoQkxPQ0tfU0laRSAqIEJMT0NLX1NJWkUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5ibG9ja3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgeDogeCwgeTogeSwKICAgICAgICAgICAgICAgICAgICAvLyBEYXJrZXIgYmxvY2tzIChsb3cgbWVhbkwpIHRyYW5zaXRpb24gZmlyc3QgKGxvdyBkZWxheSkKICAgICAgICAgICAgICAgICAgICBkZWxheTogKDI1NSAtIG1lYW5MKSAvIDI1NSAqIDUwIAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0b3RhbEZyYW1lcyA9IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwoKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAvLyBGSVgKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IC8vIEZJWAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7CgogICAgICAgIHVuaXF1ZVN0YXRlLmJsb2Nrcy5mb3JFYWNoKGJsb2NrID0+IHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAtIGJsb2NrLmRlbGF5OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgYmxvY2tQcm9ncmVzcyA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIHRpbWUgLyAodG90YWxGcmFtZXMgLSA1MCkpKTsgCiAgICAgICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWFydGljKGJsb2NrUHJvZ3Jlc3MpOwoKICAgICAgICAgICAgZm9yIChsZXQgZHkgPSAwOyBkeSA8IEJMT0NLX1NJWkU7IGR5KyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IGR4ID0gMDsgZHggPCBCTE9DS19TSVpFOyBkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IGJsb2NrLnggKyBkeDsKICAgICAgICAgICAgICAgICAgICBjb25zdCB5ID0gYmxvY2sueSArIGR5OwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmKGkgPCBvdXRwdXREYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gZGF0YUFbaV0gKyAoZGF0YUJbaV0gLSBkYXRhQVtpXSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBnID0gZGF0YUFbaSArIDFdICsgKGRhdGFCW2kgKyAxXSAtIGRhdGFBW2kgKyAxXSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gZGF0YUFbaSArIDJdICsgKGRhdGFCW2kgKyAyXSAtIGRhdGFBW2kgKyAyXSkgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQocik7IG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnKTsgCiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiKTsgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsgLy8gRklYCgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlN0YXRpc3RpY2FsIE1vbWVudCBTaGlmdCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCi8vIC0tLSBBTklNQVRJT04gODE6IDNEIFBsYW5lIFNsaWNlIGFuZCBSb3RhdGUgKFBlcmZvcm1hbmNlIE9wdGltaXplZCkgLS0tCkFOSU1BVElPTl9MT0dJQ1s4MV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDE0MCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBjb25zdCBBTkdMRV9YID0gTWF0aC5QSSAvIDYsIEFOR0xFX1kgPSBNYXRoLlBJIC8gNDsKICAgIGNvbnN0IFJFTkRFUl9TVEVQID0gNTsgLy8gTGFyZ2Ugc3RlcCBmb3Igc3BlZWQKCiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB9CiAgICAKICAgIC8vIDNEIHByb2plY3Rpb24gaGVscGVyCiAgICBmdW5jdGlvbiBwcm9qZWN0M0QoeCwgeSwgeiwgcm90WCwgcm90WSwgc2NhbGUpIHsKICAgICAgICBsZXQgdGVtcFkgPSB5ICogTWF0aC5jb3Mocm90WCkgLSB6ICogTWF0aC5zaW4ocm90WCk7CiAgICAgICAgbGV0IHRlbXBaID0geSAqIE1hdGguc2luKHJvdFgpICsgeiAqIE1hdGguY29zKHJvdFgpOwogICAgICAgIGxldCBmaW5hbFggPSB4ICogTWF0aC5jb3Mocm90WSkgKyB0ZW1wWiAqIE1hdGguc2luKHJvdFkpOwogICAgICAgIGxldCBmaW5hbFogPSB0ZW1wWiAqIE1hdGguY29zKHJvdFkpIC0geCAqIE1hdGguc2luKHJvdFkpOwogICAgICAgIAogICAgICAgIGNvbnN0IHBlcnNwZWN0aXZlID0gMjAwIC8gKDIwMCArIGZpbmFsWik7CiAgICAgICAgcmV0dXJuIHsgCiAgICAgICAgICAgIHg6IGZpbmFsWCAqIHBlcnNwZWN0aXZlICogc2NhbGUgKyBXSURUSCAvIDIsIAogICAgICAgICAgICB5OiB0ZW1wWSAqIHBlcnNwZWN0aXZlICogc2NhbGUgKyBIRUlHSFQgLyAyIAogICAgICAgIH07CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIAogICAgICAgIGNvbnN0IHNjYWxlID0gMS4wOyAKICAgICAgICBjb25zdCByb3RZID0gQU5HTEVfWSAqICgxIC0gcHJvZ3Jlc3MpICsgcHJvZ3Jlc3MgKiBNYXRoLlBJICogMjsgCiAgICAgICAgY29uc3Qgcm90WCA9IEFOR0xFX1ggKiAoMSAtIHByb2dyZXNzKSArIHByb2dyZXNzICogTWF0aC5QSSAvIDI7CiAgICAgICAgY29uc3Qgc2xpY2VaID0gKGVhc2VkUHJvZ3Jlc3MgKiAyIC0gMSkgKiAwLjU7IAoKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSArPSBSRU5ERVJfU1RFUCkgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4ICs9IFJFTkRFUl9TVEVQKSB7CiAgICAgICAgICAgICAgICBjb25zdCBueCA9ICh4IC0gV0lEVEggLyAyKSAvIFdJRFRIOwogICAgICAgICAgICAgICAgY29uc3QgbnkgPSAoeSAtIEhFSUdIVCAvIDIpIC8gSEVJR0hUOwoKICAgICAgICAgICAgICAgIGNvbnN0IGltYWdlID0gKG54IDwgc2xpY2VaKSA/IGRhdGFBIDogZGF0YUI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHByb2plY3QzRChueCAqIDIwMCwgbnkgKiAyMDAsIDAsIHJvdFgsIHJvdFksIHNjYWxlKTsKCiAgICAgICAgICAgICAgICBpZiAocHJvamVjdGVkLnggPj0gMCAmJiBwcm9qZWN0ZWQueCA8IFdJRFRIICYmIHByb2plY3RlZC55ID49IDAgJiYgcHJvamVjdGVkLnkgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gaW1hZ2UuZGF0YVtpXSwgZyA9IGltYWdlLmRhdGFbaSArIDFdLCBiID0gaW1hZ2UuZGF0YVtpICsgMl07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2IoJHtyfSwgJHtnfSwgJHtifSlgOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChwcm9qZWN0ZWQueCwgcHJvamVjdGVkLnksIFJFTkRFUl9TVEVQLCBSRU5ERVJfU1RFUCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIjNEIFBsYW5lIFNsaWNlIGFuZCBSb3RhdGUiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7Ci8vIC0tLSBBTklNQVRJT04gODU6IE1vdmluZyBBcmVhOiBTd2lybCBhbmQgUmVzdG9yZSAoTW92aW5nIFNoYXBlKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzg1XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTQwLCBjdXJyZW50RnJhbWU6IDAgfTsKICAgIGNvbnN0IFNXSVJMX1JBRElVUyA9IDEwMDsgCgogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAvLyBGSVgKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IC8vIEZJWAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7CgogICAgICAgIC8vIFN3aXJsIENlbnRlciAoTW92ZXMgZGlhZ29uYWxseSkKICAgICAgICBjb25zdCBzd2lybFggPSBXSURUSCAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgY29uc3Qgc3dpcmxZID0gSEVJR0hUICogZWFzZWRQcm9ncmVzczsKICAgICAgICAKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0geCAtIHN3aXJsWDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIHN3aXJsWTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IHN3aXJsRmFjdG9yID0gTWF0aC5tYXgoMCwgMSAtIGRpc3QgLyBTV0lSTF9SQURJVVMpOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IHNhbXBsZVggPSB4LCBzYW1wbGVZID0geTsKICAgICAgICAgICAgICAgIGxldCBmaW5hbF9wcm9ncmVzcyA9IDA7CgogICAgICAgICAgICAgICAgaWYgKHN3aXJsRmFjdG9yID4gMC4xKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSW5zaWRlIFN3aXJsIEFyZWE6IEFwcGx5IGRpc3RvcnRpb24gKEEgb25seSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdBbmdsZSA9IGFuZ2xlICsgc3dpcmxGYWN0b3IgKiBNYXRoLlBJICogMjsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgc2FtcGxlWCA9IHN3aXJsWCArIGRpc3QgKiBNYXRoLmNvcyhuZXdBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgc2FtcGxlWSA9IHN3aXJsWSArIGRpc3QgKiBNYXRoLnNpbihuZXdBbmdsZSk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgZmluYWxfcHJvZ3Jlc3MgPSAwOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh5IDwgc3dpcmxZICYmIHggPCBzd2lybFgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBBcmVhIGFscmVhZHkgcGFzc2VkIGJ5IHRoZSBjZW50ZXI6IGZ1bGx5IHRyYW5zaXRpb25lZCB0byBCCiAgICAgICAgICAgICAgICAgICAgZmluYWxfcHJvZ3Jlc3MgPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvckEgPSBnZXRQaXhlbENvbG9yKGRhdGFBLCBzYW1wbGVYLCBzYW1wbGVZKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yQiA9IGdldFBpeGVsQ29sb3IoZGF0YUIsIHgsIHkpOwoKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKGNvbG9yQS5yICogKDEgLSBmaW5hbF9wcm9ncmVzcykgKyBjb2xvckIuciAqIGZpbmFsX3Byb2dyZXNzKTsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChjb2xvckEuZyAqICgxIC0gZmluYWxfcHJvZ3Jlc3MpICsgY29sb3JCLmcgKiBmaW5hbF9wcm9ncmVzcyk7CiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoY29sb3JBLmIgKiAoMSAtIGZpbmFsX3Byb2dyZXNzKSArIGNvbG9yQi5iICogZmluYWxfcHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAvLyBGSVgKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiTW92aW5nIEFyZWE6IFN3aXJsIGFuZCBSZXN0b3JlIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwoKLy8gLS0tIEFOSU1BVElPTiA4NjogMy1JbWFnZTogV2VpZ2h0ZWQgUHJvYmFiaWxpdHkgRmllbGQgKEEsIE0sIEIpIC0tLQpBTklNQVRJT05fTE9HSUNbODZdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMzAsIGN1cnJlbnRGcmFtZTogMCB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gRklYCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAvLyBGSVgKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwogICAgICAgIGNvbnN0IGRhdGFNID0gZGF0YUE7IC8vIEZhbGxiYWNrIGZvciBNaWRkbGUgSW1hZ2UgRGF0YQoKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIENoYW90aWMgV2VpZ2h0IEdlbmVyYXRpb24gKDNEIE5vaXNlKQogICAgICAgICAgICAgICAgY29uc3Qgbm9pc2UxID0gKHBlcmxpbk5vaXNlKHggKiAwLjAxLCB5ICogMC4wMSwgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lICogMC4wMSkgKyAxKSAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBub2lzZTIgPSAocGVybGluTm9pc2UoeCAqIDAuMDEgKyA1LCB5ICogMC4wMSArIDUsIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAqIDAuMDEpICsgMSkgLyAyOwoKICAgICAgICAgICAgICAgIGxldCB3QV9iYXNlID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBsZXQgd0JfYmFzZSA9IGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBsZXQgd01fYmFzZSA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7CgogICAgICAgICAgICAgICAgLy8gQXBwbHkgY2hhb3Mvbm9pc2UgbW9kdWxhdGlvbgogICAgICAgICAgICAgICAgbGV0IHdBID0gd0FfYmFzZSAqICgxICsgKG5vaXNlMSAtIDAuNSkgKiB3TV9iYXNlICogMC41KTsgCiAgICAgICAgICAgICAgICBsZXQgd0IgPSB3Ql9iYXNlICogKDEgKyAobm9pc2UyIC0gMC41KSAqIHdNX2Jhc2UgKiAwLjUpOwogICAgICAgICAgICAgICAgbGV0IHdNID0gd01fYmFzZSAqIDAuNSArIChub2lzZTEgKiBub2lzZTIpICogd01fYmFzZSAqIDAuNTsKCiAgICAgICAgICAgICAgICAvLyBOb3JtYWxpemUgd2VpZ2h0cwogICAgICAgICAgICAgICAgY29uc3Qgc3VtVyA9IHdBICsgd0IgKyB3TTsKICAgICAgICAgICAgICAgIHdBIC89IHN1bVc7IHdCIC89IHN1bVc7IHdNIC89IHN1bVc7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE1pZGRsZSBJbWFnZSBjb2xvciAoQmxlbmQgb2YgQSBhbmQgQiBmb3IgdmlzdWFsIGVmZmVjdCkKICAgICAgICAgICAgICAgIGNvbnN0IHJNID0gZGF0YU1baV0gKyAoZGF0YUJbaV0gLSBkYXRhTVtpXSkgKiAwLjU7CiAgICAgICAgICAgICAgICBjb25zdCBnTSA9IGRhdGFNW2kgKyAxXSArIChkYXRhQltpICsgMV0gLSBkYXRhTVtpICsgMV0pICogMC41OwogICAgICAgICAgICAgICAgY29uc3QgYk0gPSBkYXRhTVtpICsgMl0gKyAoZGF0YUJbaSArIDJdIC0gZGF0YU1baSArIDJdKSAqIDAuNTsKCiAgICAgICAgICAgICAgICBjb25zdCByID0gZGF0YUFbaV0gKiB3QSArIHJNICogd00gKyBkYXRhQltpXSAqIHdCOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGRhdGFBW2kgKyAxXSAqIHdBICsgZ00gKiB3TSArIGRhdGFCW2kgKyAxXSAqIHdCOwogICAgICAgICAgICAgICAgY29uc3QgYiA9IGRhdGFBW2kgKyAyXSAqIHdBICsgYk0gKiB3TSArIGRhdGFCW2kgKyAyXSAqIHdCOwoKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIpOyBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyk7IAogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIpOyBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IC8vIEZJWAoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKysgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIGVsc2UgdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpOwogICAgfQogICAgcmV0dXJuIHsgdGl0bGU6ICJXZWlnaHRlZCBQcm9iYWJpbGl0eSBGaWVsZCAoMy1JbWFnZSkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCi8vIEhlbHBlciB0byBjYWxsIG5leHQgYW5pbWF0aW9uIChtdXN0IGJlIGRlZmluZWQgaW4geW91ciBlbnZpcm9ubWVudCkKZnVuY3Rpb24gdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpIHsKICAgIC8vIEltcGxlbWVudCBsb2dpYyB0byBsb2FkIHRoZSBuZXh0IGltYWdlIGFuZCBzdGFydCB0aGUgbmV4dCB0cmFuc2l0aW9uIChlLmcuLCBBTklNQVRJT05fSU5ERVgrKykKICAgIC8vIFRoaXMgaXMgYSBwbGFjZWhvbGRlciBmb3IgeW91ciBleGlzdGluZyBhbmltYXRpb24gbG9vcCBjb250cm9sbGVyCiAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwp9CgoKCgoKCgoKCgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gLS0tIDIzIEFEVkFOQ0VEIEFOSU1BVElPTlMgKEluZGljZXMgODgtMTEwKSAtLS0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCi8vIC0tLSBBTklNQVRJT04gODg6IExvZ2FyaXRobWljIERlY2F5IFN3aXJsIC0tLQpBTklNQVRJT05fTE9HSUNbODhdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMTAsIGN1cnJlbnRGcmFtZTogMCB9OwogICAgY29uc3QgREVDQVlfUkFURSA9IDAuMDE7IAoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gRklYCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAvLyBGSVgKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwogICAgICAgIGNvbnN0IG1pZFggPSBXSURUSCAvIDIsIG1pZFkgPSBIRUlHSFQgLyAyOwoKICAgICAgICBjb25zdCBtYXhBbmdsZSA9IE1hdGguUEkgKiA0ICogKDEgLSBlYXNlZFByb2dyZXNzKTsKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gbWlkWCwgZHkgPSB5IC0gbWlkWTsKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoZHgqZHggKyBkeSpkeSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFuZ2xlIGRlY2F5IHJhdGUgaW5jcmVhc2VzIGxvZ2FyaXRobWljYWxseSB3aXRoIGRpc3RhbmNlCiAgICAgICAgICAgICAgICBjb25zdCBhbmdsZURlY2F5ID0gTWF0aC5sb2coZGlzdCAqIERFQ0FZX1JBVEUgKyAxKTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IG9yaWdpbmFsQW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QW5nbGUgPSBvcmlnaW5hbEFuZ2xlICsgbWF4QW5nbGUgKiBhbmdsZURlY2F5OwoKICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVggPSBNYXRoLnJvdW5kKG1pZFggKyBkaXN0ICogTWF0aC5jb3MoY3VycmVudEFuZ2xlKSk7CiAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVZID0gTWF0aC5yb3VuZChtaWRZICsgZGlzdCAqIE1hdGguc2luKGN1cnJlbnRBbmdsZSkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBjb2xvckEgPSBnZXRQaXhlbENvbG9yKGRhdGFBLCBzYW1wbGVYLCBzYW1wbGVZKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yQiA9IGdldFBpeGVsQ29sb3IoZGF0YUIsIHgsIHkpOwoKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKGNvbG9yQS5yICogKDEgLSBlYXNlZFByb2dyZXNzKSArIGNvbG9yQi5yICogZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoY29sb3JBLmcgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICsgY29sb3JCLmcgKiBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChjb2xvckEuYiAqICgxIC0gZWFzZWRQcm9ncmVzcykgKyBjb2xvckIuYiAqIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAvLyBGSVgKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiTG9nYXJpdGhtaWMgRGVjYXkgU3dpcmwiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgovLyAtLS0gQU5JTUFUSU9OIDg5OiBTdGF0aXN0aWNhbCBIaXN0b2dyYW0gRXF1YWxpemF0aW9uIC0tLQpBTklNQVRJT05fTE9HSUNbODldID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxNDAsIGN1cnJlbnRGcmFtZTogMCwgY2RmTWFwOiBbXSB9OwogICAgY29uc3QgTlVNX0JJTlMgPSAzMjsgCgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIC8vIFByZS1jYWxjdWxhdGUgdGFyZ2V0IEN1bXVsYXRpdmUgRGlzdHJpYnV0aW9uIEZ1bmN0aW9uIChDREYpCiAgICAgICAgY29uc3QgaGlzdEEgPSBuZXcgQXJyYXkoTlVNX0JJTlMpLmZpbGwoMCk7CiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUEubGVuZ3RoOyBpICs9IDQpIHsKICAgICAgICAgICAgIGNvbnN0IGx1bUEgPSAoZGF0YUFbaV0gKiAwLjIxICsgZGF0YUFbaSsxXSAqIDAuNzIgKyBkYXRhQVtpKzJdICogMC4wNyk7CiAgICAgICAgICAgICBoaXN0QVtNYXRoLmZsb29yKGx1bUEgLyAyNTYgKiBOVU1fQklOUyldKys7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGxldCBjdW11bGF0aXZlID0gMDsKICAgICAgICB1bmlxdWVTdGF0ZS5jZGZNYXAgPSBoaXN0QS5tYXAoY291bnQgPT4gewogICAgICAgICAgICBjdW11bGF0aXZlICs9IGNvdW50OwogICAgICAgICAgICByZXR1cm4gY3VtdWxhdGl2ZSAvIChXSURUSCAqIEhFSUdIVCk7IC8vIE5vcm1hbGl6ZWQgMCB0byAxCiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVhcnRpYyhwcm9ncmVzcyk7CgogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IC8vIEZJWAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgLy8gRklYCiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOwogICAgICAgIGNvbnN0IGRhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSkuZGF0YTsKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBsdW1BID0gKGRhdGFBW2ldICogMC4yMSArIGRhdGFBW2krMV0gKiAwLjcyICsgZGF0YUFbaSsyXSAqIDAuMDcpOwogICAgICAgICAgICAgICAgY29uc3Qgb2xkQmluID0gTWF0aC5mbG9vcihsdW1BIC8gMjU2ICogTlVNX0JJTlMpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUcmFuc2l0aW9uIHNwZWVkIGlzIHdhcnBlZCBieSB0aGUgQ0RGIChoaWdoIGRlbnNpdHkgYXJlYXMgY2hhbmdlIGZhc3RlcikKICAgICAgICAgICAgICAgIGNvbnN0IGNkZlZhbHVlID0gdW5pcXVlU3RhdGUuY2RmTWFwW29sZEJpbl0gfHwgMDsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsX3Byb2dyZXNzID0gTWF0aC5taW4oMSwgZWFzZWRQcm9ncmVzcyAqICgwLjUgKyBjZGZWYWx1ZSAqIDAuNSkpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBkYXRhQVtpXSArIChkYXRhQltpXSAtIGRhdGFBW2ldKSAqIGZpbmFsX3Byb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGRhdGFBW2kgKyAxXSArIChkYXRhQltpICsgMV0gLSBkYXRhQVtpICsgMV0pICogZmluYWxfcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gZGF0YUFbaSArIDJdICsgKGRhdGFCW2kgKyAyXSAtIGRhdGFBW2kgKyAyXSkgKiBmaW5hbF9wcm9ncmVzczsKCiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcpOyAKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiKTsgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAvLyBGSVgKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiU3RhdGlzdGljYWwgSGlzdG9ncmFtIEVxdWFsaXphdGlvbiIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKLy8gLS0tIEFOSU1BVElPTiA5NTogUmFuZG9tIFdhbGsgTm9pc2UgRmxvb3IgLS0tCkFOSU1BVElPTl9MT0dJQ1s5NV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEyMCwgY3VycmVudEZyYW1lOiAwLCB3YWxrZXI6IHsgeDogMCwgeTogMCB9IH07CiAgICBjb25zdCBTVEVQX0ZBQ1RPUiA9IDU7CgogICAgZnVuY3Rpb24gaW5pdCgpIHsgCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICB1bmlxdWVTdGF0ZS53YWxrZXIgPSB7IHg6IFdJRFRIIC8gMiwgeTogSEVJR0hUIC8gMiB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVhcnRpYyhwcm9ncmVzcyk7CgogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IC8vIEZJWAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgLy8gRklYCiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOwogICAgICAgIGNvbnN0IGRhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSkuZGF0YTsKCiAgICAgICAgLy8gUmFuZG9tIFdhbGsgU3RlcCAoQmlhc2VkIHRvd2FyZHMgdGhlIGNlbnRlciBmb3IgdmlzdWFsIHN0YWJpbGl0eSkKICAgICAgICBjb25zdCBkeCA9ICh3aWVsc2llZGVyKCkgKiAyIC0gMSkgKiBTVEVQX0ZBQ1RPUiAqICgxIC0gZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgY29uc3QgZHkgPSAod2llbHNpZWRlcigpICogMiAtIDEpICogU1RFUF9GQUNUT1IgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgIHVuaXF1ZVN0YXRlLndhbGtlci54ICs9IGR4OwogICAgICAgIHVuaXF1ZVN0YXRlLndhbGtlci55ICs9IGR5OwogICAgICAgIAogICAgICAgIHVuaXF1ZVN0YXRlLndhbGtlci54ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oV0lEVEggLSAxLCB1bmlxdWVTdGF0ZS53YWxrZXIueCkpOwogICAgICAgIHVuaXF1ZVN0YXRlLndhbGtlci55ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oSEVJR0hUIC0gMSwgdW5pcXVlU3RhdGUud2Fsa2VyLnkpKTsKICAgICAgICAKICAgICAgICBjb25zdCB3YWxrZXJYID0gTWF0aC5yb3VuZCh1bmlxdWVTdGF0ZS53YWxrZXIueCk7CiAgICAgICAgY29uc3Qgd2Fsa2VyWSA9IE1hdGgucm91bmQodW5pcXVlU3RhdGUud2Fsa2VyLnkpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRGlzdGFuY2UgdG8gdGhlIHJhbmRvbSB3YWxrZXIKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3RTcSA9ICh4IC0gd2Fsa2VyWCkqKjIgKyAoeSAtIHdhbGtlclkpKioyOwogICAgICAgICAgICAgICAgY29uc3QgbWF4RGlzdFNxID0gKFdJRFRIKioyICsgSEVJR0hUKioyKSAvIDQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIE5vaXNlIGZhY3RvcjogUGVha3MgbmVhciB0aGUgd2Fsa2VyJ3MgcG9zaXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IG5vaXNlX2ZhY3RvciA9IDEgLSBNYXRoLm1pbigxLCBkaXN0U3EgLyBtYXhEaXN0U3EpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBGaW5hbCBwcm9ncmVzcyBpcyBib29zdGVkIGJ5IHRoZSBub2lzZSBmYWN0b3IKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsX3Byb2dyZXNzID0gTWF0aC5taW4oMSwgZWFzZWRQcm9ncmVzcyArIG5vaXNlX2ZhY3RvciAqICgxIC0gZWFzZWRQcm9ncmVzcykpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBkYXRhQVtpXSArIChkYXRhQltpXSAtIGRhdGFBW2ldKSAqIGZpbmFsX3Byb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGRhdGFBW2kgKyAxXSArIChkYXRhQltpICsgMV0gLSBkYXRhQVtpICsgMV0pICogZmluYWxfcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gZGF0YUFbaSArIDJdICsgKGRhdGFCW2kgKyAyXSAtIGRhdGFBW2kgKyAyXSkgKiBmaW5hbF9wcm9ncmVzczsKCiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcpOyAKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiKTsgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAvLyBGSVgKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiUmFuZG9tIFdhbGsgTm9pc2UgRmxvb3IiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgovLyAtLS0gQU5JTUFUSU9OIDk2OiAzRCBTcGhlcmljYWwgQ29vcmRpbmF0ZSBVbndyYXAgLS0tCkFOSU1BVElPTl9MT0dJQ1s5MV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEzMCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBjb25zdCBSRU5ERVJfU1RFUCA9IDI7IC8vIFBpeGVsIHN0ZXBwaW5nIGZvciBzcGVlZAoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gRklYCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAvLyBGSVgKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwogICAgICAgIGNvbnN0IG1pZFggPSBXSURUSCAvIDIsIG1pZFkgPSBIRUlHSFQgLyAyOwogICAgICAgIGNvbnN0IE1BWF9SID0gTWF0aC5taW4obWlkWCwgbWlkWSk7CgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IFJFTkRFUl9TVEVQKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gUkVOREVSX1NURVApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSBtaWRYLCBkeSA9IHkgLSBtaWRZOwogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUGhhc2UgMTogV3JhcCBJbWFnZSBBIG9udG8gc3BoZXJlCiAgICAgICAgICAgICAgICBjb25zdCB0aGV0YSA9IE1hdGguYXRhbjIoZHksIGR4KTsKICAgICAgICAgICAgICAgIGNvbnN0IHBoaSA9IChkaXN0IC8gTUFYX1IpICogTWF0aC5QSSAvIDI7IC8vIFJhZGlhbCBkaXN0YW5jZSBtYXBwZWQgdG8gcG9sYXIgYW5nbGUgMCB0byA5MCBkZWdyZWVzCgogICAgICAgICAgICAgICAgLy8gU2FtcGxlIGNvb3JkaW5hdGVzIG9uIHRoZSAqdW53cmFwcGVkKiBJbWFnZSBBCiAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVYQSA9IE1hdGgucm91bmQoV0lEVEggKiAodGhldGEgLyAoMiAqIE1hdGguUEkpICsgMC41KSk7CiAgICAgICAgICAgICAgICBjb25zdCBzYW1wbGVZQSA9IE1hdGgucm91bmQoSEVJR0hUICogKHBoaSAvIChNYXRoLlBJIC8gMikpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3JBID0gZ2V0UGl4ZWxDb2xvcihkYXRhQSwgc2FtcGxlWEEsIHNhbXBsZVlBKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gRmluYWwgYmxlbmQKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBjb2xvckEuciArIChkYXRhQltpXSAtIGNvbG9yQS5yKSAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBnID0gY29sb3JBLmcgKyAoZGF0YUJbaSArIDFdIC0gY29sb3JBLmcpICogZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBjb2xvckEuYiArIChkYXRhQltpICsgMl0gLSBjb2xvckEuYikgKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBBcHBseSB0byBibG9jawogICAgICAgICAgICAgICAgZm9yKGxldCBkeT0wOyBkeTxSRU5ERVJfU1RFUDsgZHkrKykgewogICAgICAgICAgICAgICAgICAgIGZvcihsZXQgZHg9MDsgZHg8UkVOREVSX1NURVA7IGR4KyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbEkgPSAoKHkgKyBkeSkgKiBXSURUSCArICh4ICsgZHgpKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNlbGxJIDwgb3V0cHV0RGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2NlbGxJXSA9IE1hdGgucm91bmQocik7IG91dHB1dERhdGFbY2VsbEkgKyAxXSA9IE1hdGgucm91bmQoZyk7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbY2VsbEkgKyAyXSA9IE1hdGgucm91bmQoYik7IG91dHB1dERhdGFbY2VsbEkgKyAzXSA9IDI1NTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IC8vIEZJWAoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKysgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIGVsc2UgdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpOwogICAgfQogICAgcmV0dXJuIHsgdGl0bGU6ICJTcGhlcmljYWwgQ29vcmRpbmF0ZSBVbndyYXAiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgovLyAtLS0gQU5JTUFUSU9OIDk3OiBNYXJrb3YgQ2hhaW4gQ29sb3IgU2hpZnQgKEJsb2NrLWJhc2VkKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzgyXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMjAwLCBjdXJyZW50RnJhbWU6IDAsIGNvbG9yTWFwOiBbXSB9OwogICAgY29uc3QgQkxPQ0tfU0laRSA9IDE1OwogICAgbGV0IE5VTV9CTE9DS1M7CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICBOVU1fQkxPQ0tTID0gTWF0aC5jZWlsKFdJRFRIIC8gQkxPQ0tfU0laRSkgKiBNYXRoLmNlaWwoSEVJR0hUIC8gQkxPQ0tfU0laRSk7CiAgICAgICAgdW5pcXVlU3RhdGUuY29sb3JNYXAgPSBbXTsKCiAgICAgICAgLy8gUHJlLWNhbGN1bGF0ZSBzdGFydGluZyBjb2xvcnMgKFN0YXRlIDEpCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBOVU1fQkxPQ0tTOyBpKyspIHsKICAgICAgICAgICAgIC8vIFNhbXBsZSB0aGUgY2VudGVyIG9mIHRoZSBibG9jayBmb3IgY29sb3IgQQogICAgICAgICAgICAgY29uc3QgeCA9IChpICUgTWF0aC5jZWlsKFdJRFRIIC8gQkxPQ0tfU0laRSkpICogQkxPQ0tfU0laRSArIEJMT0NLX1NJWkUgLyAyOwogICAgICAgICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoaSAvIE1hdGguY2VpbChXSURUSCAvIEJMT0NLX1NJWkUpKSAqIEJMT0NLX1NJWkUgKyBCTE9DS19TSVpFIC8gMjsKICAgICAgICAgICAgIGNvbnN0IGNvbG9yID0gZ2V0UGl4ZWxDb2xvcihkYXRhQSwgeCwgeSk7CiAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jb2xvck1hcC5wdXNoKHsKICAgICAgICAgICAgICAgICByOiBjb2xvci5yLCBnOiBjb2xvci5nLCBiOiBjb2xvci5iLCAKICAgICAgICAgICAgICAgICBzdGF0ZTogMCwgLy8gMCA9IEEsIDEgPSBCCiAgICAgICAgICAgICAgICAgaW5kZXg6IGksCiAgICAgICAgICAgICAgICAgZGVsYXk6IHdpZWxzaWVkZXIoKSAqIDUwIC8vIFN0YWdnZXJlZCBzdGFydAogICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFNpbXBsZSBNYXJrb3YgVHJhbnNpdGlvbiBNYXRyaXggKEEtPkIsIEItPkIsIEItPkEgKHJhcmUpKQogICAgZnVuY3Rpb24gdHJhbnNpdGlvbihzdGF0ZSkgewogICAgICAgIGlmIChzdGF0ZSA9PT0gMCkgcmV0dXJuIHdpZWxzaWVkZXIoKSA8IDAuMDUgPyAxIDogMDsgLy8gTG93IHByb2JhYmlsaXR5IEEgdG8gQgogICAgICAgIGlmIChzdGF0ZSA9PT0gMSkgcmV0dXJuIHdpZWxzaWVkZXIoKSA8IDAuMDA1ID8gMCA6IDE7IC8vIFZlcnkgbG93IHByb2JhYmlsaXR5IEIgYmFjayB0byBBCiAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwoKICAgICAgICB1bmlxdWVTdGF0ZS5jb2xvck1hcC5mb3JFYWNoKGJsb2NrID0+IHsKICAgICAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA+IGJsb2NrLmRlbGF5KSB7CiAgICAgICAgICAgICAgICAgYmxvY2suc3RhdGUgPSB0cmFuc2l0aW9uKGJsb2NrLnN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRHJhdyBibG9jawogICAgICAgICAgICBjb25zdCBibG9ja1ggPSAoYmxvY2suaW5kZXggJSBNYXRoLmNlaWwoV0lEVEggLyBCTE9DS19TSVpFKSkgKiBCTE9DS19TSVpFOwogICAgICAgICAgICBjb25zdCBibG9ja1kgPSBNYXRoLmZsb29yKGJsb2NrLmluZGV4IC8gTWF0aC5jZWlsKFdJRFRIIC8gQkxPQ0tfU0laRSkpICogQkxPQ0tfU0laRTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCB0YXJnZXRDb2xvcjsKICAgICAgICAgICAgaWYgKGJsb2NrLnN0YXRlID09PSAxKSB7CiAgICAgICAgICAgICAgICAvLyBVc2UgY29sb3IgZnJvbSBJbWFnZSBCIGF0IHRoZSBibG9jaydzIGNlbnRlcgogICAgICAgICAgICAgICAgY29uc3QgaSA9IChNYXRoLnJvdW5kKGJsb2NrWSArIEJMT0NLX1NJWkUvMikgKiBXSURUSCArIE1hdGgucm91bmQoYmxvY2tYICsgQkxPQ0tfU0laRS8yKSkgKiA0OwogICAgICAgICAgICAgICAgdGFyZ2V0Q29sb3IgPSB7IHI6IGRhdGFCW2ldLCBnOiBkYXRhQltpKzFdLCBiOiBkYXRhQltpKzJdIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0YXJnZXRDb2xvciA9IHsgcjogYmxvY2suciwgZzogYmxvY2suZywgYjogYmxvY2suYiB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigke3RhcmdldENvbG9yLnJ9LCAke3RhcmdldENvbG9yLmd9LCAke3RhcmdldENvbG9yLmJ9KWA7CiAgICAgICAgICAgIGN0eC5maWxsUmVjdChibG9ja1gsIGJsb2NrWSwgQkxPQ0tfU0laRSwgQkxPQ0tfU0laRSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIk1hcmtvdiBDaGFpbiBDb2xvciBTaGlmdCIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCi8vIC0tLSBBTklNQVRJT04gOTg6IFdhdmVsZXQgRGVjb21wb3NpdGlvbiBSaXBwbGUgLS0tCkFOSU1BVElPTl9MT0dJQ1s3Nl0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEyMCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBjb25zdCBNQVhfV0FWRUxFVF9TVFJFTkdUSCA9IDEwOyAKCiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWFydGljKHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gRklYCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAvLyBGSVgKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwogICAgICAgIGNvbnN0IG1pZFggPSBXSURUSCAvIDIsIG1pZFkgPSBIRUlHSFQgLyAyOwoKICAgICAgICBjb25zdCB3YXZlbGV0U3RyZW5ndGggPSBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpICogTUFYX1dBVkVMRVRfU1RSRU5HVEg7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBkeCA9IHggLSBtaWRYLCBkeSA9IHkgLSBtaWRZOwogICAgICAgICAgICAgICAgY29uc3QgZGlzdCA9IE1hdGguc3FydChkeCpkeCArIGR5KmR5KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2ltdWxhdGUgd2F2ZWxldCB0cmFuc2Zvcm1hdGlvbiAoaGlnaCBmcmVxdWVuY3kgZGV0YWlsIGV4dHJhY3Rpb24pCiAgICAgICAgICAgICAgICAvLyBEZXRhaWwgaXMgYmFzZWQgb24gc2luZSB3YXZlcyByaXBwbGluZyBvdXR3YXJkcywgbW9kdWxhdGVkIGJ5IGltYWdlIEEgbHVtaW5hbmNlCiAgICAgICAgICAgICAgICBjb25zdCBsdW1BID0gKGRhdGFBW2ldICsgZGF0YUFbaSsxXSArIGRhdGFBW2krMl0pIC8gMzsKICAgICAgICAgICAgICAgIGNvbnN0IHBoYXNlID0gZGlzdCAqIDAuMSAtIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAqIDAuMTsKICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbF9yaXBwbGUgPSBNYXRoLnNpbihwaGFzZSkgKiAobHVtQSAvIDI1NSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNhbXBsZSBwb3NpdGlvbiAoc2xpZ2h0IG9mZnNldCBiYXNlZCBvbiB0aGUgZGV0YWlsIHJpcHBsZSkKICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVggPSB4ICsgZGV0YWlsX3JpcHBsZSAqIHdhdmVsZXRTdHJlbmd0aDsKICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVkgPSB5ICsgZGV0YWlsX3JpcHBsZSAqIHdhdmVsZXRTdHJlbmd0aDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgY29sb3JBID0gZ2V0UGl4ZWxDb2xvcihkYXRhQSwgc2FtcGxlWCwgc2FtcGxlWSk7CgogICAgICAgICAgICAgICAgLy8gQmxlbmQ6IEIgaXMgdGhlIGJhc2UsIEEgaXMgdGhlIGRpc3RvcnRlZCBvdmVybGF5CiAgICAgICAgICAgICAgICBjb25zdCByID0gY29sb3JBLnIgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICsgZGF0YUJbaV0gKiBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGNvbG9yQS5nICogKDEgLSBlYXNlZFByb2dyZXNzKSArIGRhdGFCW2kgKyAxXSAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gY29sb3JBLmIgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpICsgZGF0YUJbaSArIDJdICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcpOyAKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiKTsgb3V0cHV0RGF0YVtpICsgM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAvLyBGSVgKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiV2F2ZWxldCBEZWNvbXBvc2l0aW9uIFJpcHBsZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgovLyAtLS0gQU5JTUFUSU9OIDEwMDogUG9pbmNhcsOpIFNlY3Rpb24gV2FycCAtLS0KQU5JTUFUSU9OX0xPR0lDWzcxXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTIwLCBjdXJyZW50RnJhbWU6IDAgfTsKICAgIGNvbnN0IE1BWF9TSEVBUiA9IDMwOwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IE1hdGguc2luKHByb2dyZXNzICogTWF0aC5QSSk7IC8vIFBlYWtzIGF0IDUwJQoKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAvLyBGSVgKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IC8vIEZJWAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgbWlkWSA9IEhFSUdIVCAvIDI7CgogICAgICAgIGNvbnN0IGN1cnJlbnRTaGVhciA9IGVhc2VkUHJvZ3Jlc3MgKiBNQVhfU0hFQVI7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBQb2luY2Fyw6kgU2VjdGlvbjogU2hlYXIgaXMgcmVsYXRlZCB0byB5LXBvc2l0aW9uIGFuZCBjdXJyZW50IHRpbWUgKHQpCiAgICAgICAgICAgICAgICBjb25zdCBzaGVhckZhY3RvciA9IE1hdGguc2luKHkgLyA1MCArIHByb2dyZXNzICogTWF0aC5QSSAqIDIpICogY3VycmVudFNoZWFyOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2FtcGxlIGltYWdlIEEgYXQgdGhlIHNoZWFyZWQgbG9jYXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IHNhbXBsZVhBID0gTWF0aC5yb3VuZCh4ICsgc2hlYXJGYWN0b3IpOwogICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlWUEgPSB5OyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmxlbmQ6IFRoZSBhbW91bnQgb2Ygc2hlYXIgZGljdGF0ZXMgdGhlIGJsZW5kIHJhdGlvCiAgICAgICAgICAgICAgICBjb25zdCBibGVuZFJhdGlvID0gTWF0aC5taW4oMSwgTWF0aC5hYnMoc2hlYXJGYWN0b3IpIC8gTUFYX1NIRUFSKSAqIGVhc2VkUHJvZ3Jlc3M7CgogICAgICAgICAgICAgICAgY29uc3QgY29sb3JBID0gZ2V0UGl4ZWxDb2xvcihkYXRhQSwgc2FtcGxlWEEsIHNhbXBsZVlBKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgciA9IGNvbG9yQS5yICogKDEgLSBibGVuZFJhdGlvKSArIGRhdGFCW2ldICogYmxlbmRSYXRpbzsKICAgICAgICAgICAgICAgIGNvbnN0IGcgPSBjb2xvckEuZyAqICgxIC0gYmxlbmRSYXRpbykgKyBkYXRhQltpICsgMV0gKiBibGVuZFJhdGlvOwogICAgICAgICAgICAgICAgY29uc3QgYiA9IGNvbG9yQS5iICogKDEgLSBibGVuZFJhdGlvKSArIGRhdGFCW2kgKyAyXSAqIGJsZW5kUmF0aW87CgogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQocik7IG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnKTsgCiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYik7IG91dHB1dERhdGFbaSArIDNdID0gMjU1OwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsgLy8gRklYCgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlBvaW5jYXLDqSBTZWN0aW9uIFdhcnAiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgovLyAtLS0gQU5JTUFUSU9OIDEwMTogVGVzc2VyYWN0IFJvdGF0aW9uICg0RCB0byAyRCkgLS0tCkFOSU1BVElPTl9MT0dJQ1s5NF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDE4MCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBjb25zdCBNQVhfUk9UID0gTWF0aC5QSSAqIDI7CiAgICBjb25zdCBSRU5ERVJfU1RFUCA9IDU7CgogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgfQoKICAgIGZ1bmN0aW9uIHByb2plY3RUZXNzZXJhY3QoeCwgeSwgeiwgdywgcm90QW5nbGUsIHByb2dyZXNzKSB7CiAgICAgICAgLy8gU2ltcGxpZmllZCA0RCByb3RhdGlvbiAoWFogYW5kIFlXIHBsYW5lcykgYW5kIHBlcnNwZWN0aXZlCiAgICAgICAgY29uc3Qgcm90WCA9IHJvdEFuZ2xlICogcHJvZ3Jlc3M7CiAgICAgICAgY29uc3Qgcm90WSA9IHJvdEFuZ2xlICogKDEgLSBwcm9ncmVzcyk7CgogICAgICAgIC8vIDEuIFJvdGF0ZSBYWgogICAgICAgIGxldCBuZXdYID0geCAqIE1hdGguY29zKHJvdFgpICsgeiAqIE1hdGguc2luKHJvdFgpOwogICAgICAgIGxldCBuZXdaID0geiAqIE1hdGguY29zKHJvdFgpIC0geCAqIE1hdGguc2luKHJvdFgpOwogICAgICAgIAogICAgICAgIC8vIDIuIFJvdGF0ZSBZVwogICAgICAgIGxldCBuZXdZID0geSAqIE1hdGguY29zKHJvdFkpICsgdyAqIE1hdGguc2luKHJvdFkpOwogICAgICAgIGxldCBuZXdXID0gdyAqIE1hdGguY29zKHJvdFkpIC0geSAqIE1hdGguc2luKHJvdFkpOwoKICAgICAgICAvLyAzLiAzRCBQZXJzcGVjdGl2ZSAodXNpbmcgWiBhbmQgVykKICAgICAgICBjb25zdCBwZXJzcGVjdGl2ZSA9IDIwMCAvICgyMDAgKyBuZXdaICsgbmV3VyAqIDAuNSk7IAogICAgICAgIAogICAgICAgIHJldHVybiB7IAogICAgICAgICAgICB4OiBuZXdYICogcGVyc3BlY3RpdmUgKyBXSURUSCAvIDIsIAogICAgICAgICAgICB5OiBuZXdZICogcGVyc3BlY3RpdmUgKyBIRUlHSFQgLyAyCiAgICAgICAgfTsKICAgIH0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgIGNvbnN0IGRhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CgogICAgICAgIGNvbnN0IHJvdEFuZ2xlID0gTUFYX1JPVDsgCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gUkVOREVSX1NURVApIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBSRU5ERVJfU1RFUCkgewogICAgICAgICAgICAgICAgY29uc3QgbnggPSAoeCAtIFdJRFRIIC8gMik7CiAgICAgICAgICAgICAgICBjb25zdCBueSA9ICh5IC0gSEVJR0hUIC8gMik7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFogYW5kIFcgYXJlIGJhc2VkIG9uIHRoZSBibGVuZCByYXRpbwogICAgICAgICAgICAgICAgY29uc3Qgel9jb29yZCA9IDUwICogKDEgLSBlYXNlZFByb2dyZXNzKTsgCiAgICAgICAgICAgICAgICBjb25zdCB3X2Nvb3JkID0gLTUwICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwcm9qZWN0VGVzc2VyYWN0KG54LCBueSwgel9jb29yZCwgd19jb29yZCwgcm90QW5nbGUsIHByb2dyZXNzKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2UgPSAoel9jb29yZCA+IHdfY29vcmQpID8gZGF0YUEgOiBkYXRhQjsgLy8gQXJiaXRyYXJ5IGNob2ljZSBiYXNlZCBvbiBaL1cKCiAgICAgICAgICAgICAgICBpZiAocHJvamVjdGVkLnggPj0gMCAmJiBwcm9qZWN0ZWQueCA8IFdJRFRIICYmIHByb2plY3RlZC55ID49IDAgJiYgcHJvamVjdGVkLnkgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gaW1hZ2UuZGF0YVtpXSwgZyA9IGltYWdlLmRhdGFbaSArIDFdLCBiID0gaW1hZ2UuZGF0YVtpICsgMl07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2IoJHtyfSwgJHtnfSwgJHtifSlgOwogICAgICAgICAgICAgICAgICAgIGN0eC5maWxsUmVjdChwcm9qZWN0ZWQueCwgcHJvamVjdGVkLnksIFJFTkRFUl9TVEVQLCBSRU5ERVJfU1RFUCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlRlc3NlcmFjdCBSb3RhdGlvbiAoNEQpIiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwoKLy8gLS0tIEFOSU1BVElPTiAxMDI6IFJlYWN0aW9uLURpZmZ1c2lvbiBQYXR0ZXJuIChTaW11bGF0ZWQpIC0tLQpBTklNQVRJT05fTE9HSUNbOTVdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAyNTAsIGN1cnJlbnRGcmFtZTogMCwgZ3JpZDogW10gfTsKICAgIGNvbnN0IEJMT0NLX1NJWkUgPSA0OwogICAgbGV0IE5VTV9DT0xTLCBOVU1fUk9XUzsKICAgIAogICAgLy8gRklYRUQ6IFNlcGFyYXRlIGNvbnN0YW50IGRlY2xhcmF0aW9ucwogICAgY29uc3QgRkVFRCA9IDAuMDU1OwogICAgY29uc3QgS0lMTCA9IDAuMDYyOwogICAgLy8gRiBhbmQgSyBmb3Igc3RhYmxlIFR1cmluZyBwYXR0ZXJuCiAgICBjb25zdCBEQSA9IDEuMDsKICAgIGNvbnN0IERCID0gMC41OwogICAgLy8gRGlmZnVzaW9uIHJhdGVzCgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIE5VTV9DT0xTID0gTWF0aC5mbG9vcihXSURUSCAvIEJMT0NLX1NJWkUpOwogICAgICAgIE5VTV9ST1dTID0gTWF0aC5mbG9vcihIRUlHSFQgLyBCTE9DS19TSVpFKTsKICAgICAgICB1bmlxdWVTdGF0ZS5ncmlkID0gW107CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBOVU1fUk9XUzsgcisrKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmdyaWRbcl0gPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBOVU1fQ09MUzsgYysrKSB7CiAgICAgICAgICAgICAgICAvLyBJbml0aWFsaXplIEEgKEFjdGl2YXRvcikgPSAxLCBCIChJbmhpYml0b3IpID0gMAogICAgICAgICAgICAgICAgbGV0IGJfaW5pdCA9IDA7CiAgICAgICAgICAgICAgICAvLyBBZGQgYSBzbWFsbCBzZWVkIG9mIEIgKGluaGliaXRvcikKICAgICAgICAgICAgICAgIGlmIChyID4gTlVNX1JPV1MgLyAyIC0gNSAmJiByIDwgTlVNX1JPV1MgLyAyICsgNSAmJiBjID4gTlVNX0NPTFMgLyAyIC0gNSAmJiBjIDwgTlVNX0NPTFMgLyAyICsgNSkgewogICAgICAgICAgICAgICAgICAgIGJfaW5pdCA9IDE7IAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuZ3JpZFtyXVtjXSA9IHsgQTogMS4wLCBCOiBiX2luaXQsIGRBOiAwLCBkQjogMCB9OyAKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgZnVuY3Rpb24gbGFwbGFjZShyLCBjLCBwcm9wKSB7CiAgICAgICAgbGV0IHN1bSA9IDA7CiAgICAgICAgZm9yIChsZXQgZHIgPSAtMTsgZHIgPD0gMTsgZHIrKykgewogICAgICAgICAgICBmb3IgKGxldCBkYyA9IC0xOyBkYyA8PSAxOyBkYysrKSB7CiAgICAgICAgICAgICAgICAvLyBGSVhFRDogU2VwYXJhdGUgY29uc3RhbnQgZGVjbGFyYXRpb25zCiAgICAgICAgICAgICAgICBjb25zdCBuciA9IHIgKyBkcjsKICAgICAgICAgICAgICAgIGNvbnN0IG5jID0gYyArIGRjOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobnIgPj0gMCAmJiBuciA8IE5VTV9ST1dTICYmIG5jID49IDAgJiYgbmMgPCBOVU1fQ09MUykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHdlaWdodCA9IChkciA9PT0gMCAmJiBkYyA9PT0gMCkgPyAtMSA6IDAuMjsgLy8gMC4yLCAwLjA1LCAwLjIgZm9yIGZ1bGwgOS1wb2ludCBzdGVuY2lsCiAgICAgICAgICAgICAgICAgICAgc3VtICs9IHVuaXF1ZVN0YXRlLmdyaWRbbnJdW25jXVtwcm9wXSAqIHdlaWdodDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gc3VtOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwogICAgICAgIAogICAgICAgIC8vIDEuIENhbGN1bGF0ZSBEZWx0YXMgKFBlcmZvcm1hbmNlIGludGVuc2l2ZTogc2ltcGxpZmllZCBtb2RlbCkKICAgICAgICBjb25zdCBuZXh0R3JpZCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodW5pcXVlU3RhdGUuZ3JpZCkpOwogICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgTlVNX1JPV1M7IHIrKykgewogICAgICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IE5VTV9DT0xTOyBjKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB1bmlxdWVTdGF0ZS5ncmlkW3JdW2NdOwogICAgICAgICAgICAgICAgY29uc3QgTGEgPSBsYXBsYWNlKHIsIGMsICdBJyk7CiAgICAgICAgICAgICAgICBjb25zdCBMYiA9IGxhcGxhY2UociwgYywgJ0InKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gR3JheS1TY290dCBFcXVhdGlvbnMgKHNpbXBsaWZpZWQgdGltZSBzdGVwKQogICAgICAgICAgICAgICAgY29uc3QgcmVhY3Rpb24gPSBjZWxsLkEgKiBjZWxsLkIgKiBjZWxsLkI7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG5leHRHcmlkW3JdW2NdLkEgPSBjZWxsLkEgKyAoREEgKiBMYSAtIHJlYWN0aW9uICsgRkVFRCAqICgxIC0gY2VsbC5BKSk7CiAgICAgICAgICAgICAgICBuZXh0R3JpZFtyXVtjXS5CID0gY2VsbC5CICsgKERCICogTGIgKyByZWFjdGlvbiAtIChLSUxMICsgRkVFRCkgKiBjZWxsLkIpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDbGFtcCB2YWx1ZXMKICAgICAgICAgICAgICAgIG5leHRHcmlkW3JdW2NdLkEgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBuZXh0R3JpZFtyXVtjXS5BKSk7CiAgICAgICAgICAgICAgICBuZXh0R3JpZFtyXVtjXS5CID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgbmV4dEdyaWRbcl1bY10uQikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHVuaXF1ZVN0YXRlLmdyaWQgPSBuZXh0R3JpZDsKCiAgICAgICAgLy8gMi4gRHJhdwogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBOVU1fUk9XUzsgcisrKSB7CiAgICAgICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgTlVNX0NPTFM7IGMrKykgewogICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IHVuaXF1ZVN0YXRlLmdyaWRbcl1bY107CiAgICAgICAgICAgICAgICBjb25zdCB4ID0gYyAqIEJMT0NLX1NJWkU7CiAgICAgICAgICAgICAgICBjb25zdCB5ID0gciAqIEJMT0NLX1NJWkU7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBCbGVuZCBjb2xvciBBIGFuZCBCIGJhc2VkIG9uIHRoZSBjZWxsJ3MgQi1jb25jZW50cmF0aW9uCiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUIgPSBjZWxsLkI7IAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUaGlzIHNlY3Rpb24gd2FzIGZpeGVkIGluIHRoZSBwcmV2aW91cyB0dXJuCiAgICAgICAgICAgICAgICBjb25zdCByQiA9IGRhdGFCW2ldOwogICAgICAgICAgICAgICAgY29uc3QgZ0IgPSBkYXRhQltpICsgMV07CiAgICAgICAgICAgICAgICBjb25zdCBiQiA9IGRhdGFCW2kgKyAyXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgcmUgPSBjZWxsLkEgKiAoMjU1ICogKDEgLSBhbHBoYUIpKSArIHJCICogYWxwaGFCOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGNlbGwuQSAqICgyNTUgKiAoMSAtIGFscGhhQikpICsgZ0IgKiBhbHBoYUI7CiAgICAgICAgICAgICAgICBjb25zdCBiID0gY2VsbC5BICogKDI1NSAqICgxIC0gYWxwaGFCKSkgKyBiQiAqIGFscGhhQjsKCiAgICAgICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYigke01hdGgucm91bmQocmUpfSwgJHtNYXRoLnJvdW5kKGcpfSwgJHtNYXRoLnJvdW5kKGIpfSlgOwogICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KHgsIHksIEJMT0NLX1NJWkUsIEJMT0NLX1NJWkUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKysgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIGVsc2UgdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpOwogICAgfQogICAgcmV0dXJuIHsgdGl0bGU6ICJSZWFjdGlvbi1EaWZmdXNpb24gUGF0dGVybiIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCi8vIC0tLSBBTklNQVRJT04gMTAzOiBEeW5hbWljIFRlc3NlbGxhdGlvbiBTaGF0dGVyIC0tLQpBTklNQVRJT05fTE9HSUNbOTJdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMjAsIGN1cnJlbnRGcmFtZTogMCwgY2VsbHM6IFtdIH07CiAgICBjb25zdCBOVU1fQ0VMTFMgPSA1MDsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgdW5pcXVlU3RhdGUuY2VsbHMgPSBbXTsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5VTV9DRUxMUzsgaSsrKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmNlbGxzLnB1c2goewogICAgICAgICAgICAgICAgeDogV0lEVEggKiB3aWVsc2llZGVyKCksIHk6IEhFSUdIVCAqIHdpZWxzaWVkZXIoKSwKICAgICAgICAgICAgICAgIHZ4OiAod2llbHNpZWRlcigpICogMiAtIDEpICogMiwgdnk6ICh3aWVsc2llZGVyKCkgKiAyIC0gMSkgKiAyLAogICAgICAgICAgICAgICAgY29sb3I6IFt3aWVsc2llZGVyKCkgKiAyNTUsIHdpZWxzaWVkZXIoKSAqIDI1NSwgd2llbHNpZWRlcigpICogMjU1XSwKICAgICAgICAgICAgICAgIGRlbGF5OiB3aWVsc2llZGVyKCkgKiAzMAogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9CgoKCgoKCgoKCgoKCgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWFydGljKHByb2dyZXNzKTsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgV0lEVEgsIEhFSUdIVCk7IC8vIERyYXcgQiBhcyBiYXNlCgogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICAKICAgICAgICAvLyAxLiBEcmF3IEltYWdlIEEgKFNoYXR0ZXJlZCBDZWxscykKICAgICAgICB1bmlxdWVTdGF0ZS5jZWxscy5mb3JFYWNoKChjZWxsLCBjZWxsSW5kZXgpID0+IHsKICAgICAgICAgICAgY29uc3QgdGltZSA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAtIGNlbGwuZGVsYXk7CiAgICAgICAgICAgIGlmICh0aW1lIDwgMCkgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgY2VsbFByb2dyZXNzID0gTWF0aC5taW4oMSwgdGltZSAvICh1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcyAtIDMwKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY2VsbFByb2dyZXNzIDwgMC41KSB7CiAgICAgICAgICAgICAgICAvLyBTaGF0dGVyIFBoYXNlIChBKTogTW92ZSBjZWxsIG91dHdhcmRzCiAgICAgICAgICAgICAgICBjZWxsLnggKz0gY2VsbC52eDsKICAgICAgICAgICAgICAgIGNlbGwueSArPSBjZWxsLnZ5OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gQ29sbGFwc2UgUGhhc2UgKEIpOiBJbnRlcnBvbGF0ZSB0byBmaW5hbCBCIHN0YXRlCiAgICAgICAgICAgICAgICBjb25zdCBjb2xsYXBzZUZhY3RvciA9IChjZWxsUHJvZ3Jlc3MgLSAwLjUpICogMjsKICAgICAgICAgICAgICAgIGNlbGwudnggKj0gMC45OyBjZWxsLnZ5ICo9IDAuOTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2ltdWxhdGVkIHJldHVybiB0byBjZW50ZXIgKGNvbGxhcHNlKQogICAgICAgICAgICAgICAgY2VsbC54ID0gY2VsbC54ICogKDEgLSBjb2xsYXBzZUZhY3RvcikgKyBXSURUSCAvIDIgKiBjb2xsYXBzZUZhY3RvcjsKICAgICAgICAgICAgICAgIGNlbGwueSA9IGNlbGwueSAqICgxIC0gY29sbGFwc2VGYWN0b3IpICsgSEVJR0hUIC8gMiAqIGNvbGxhcHNlRmFjdG9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBEcmF3IFZvcm9ub2ktbGlrZSByZWdpb24gZm9yIEltYWdlIEEKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBsZXQgYm91bmRhcnkgPSBbXTsgLy8gU2ltcGxpZmljYXRpb246IGp1c3QgZHJhdyBhIHNocmlua2luZyBzcXVhcmUKICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IDUwICogKDEgLSBlYXNlZFByb2dyZXNzKTsKICAgICAgICAgICAgY3R4LnJlY3QoY2VsbC54IC0gc2l6ZS8yLCBjZWxsLnkgLSBzaXplLzIsIHNpemUsIHNpemUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2FtcGxlIGNvbG9yIGZyb20gQSAob3IgdXNlIGF2ZXJhZ2UgYmxvY2sgY29sb3IpCiAgICAgICAgICAgIGNvbnN0IGkgPSAoTWF0aC5yb3VuZChjZWxsLnkpICogV0lEVEggKyBNYXRoLnJvdW5kKGNlbGwueCkpICogNDsKICAgICAgICAgICAgY29uc3QgciA9IGRhdGFBW2ldLCBnID0gZGF0YUFbaSArIDFdLCBiID0gZGF0YUFbaSArIDJdOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2JhKCR7cn0sICR7Z30sICR7Yn0sICR7MSAtIGVhc2VkUHJvZ3Jlc3N9KWA7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIkR5bmFtaWMgVGVzc2VsbGF0aW9uIFNoYXR0ZXIiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgoKCgoKCgoKCgoKCkFOSU1BVElPTl9MT0dJQ1s5NF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEwMCwgY3VycmVudEZyYW1lOiAwLCB0cmFjZU1hcDogW10gfTsKICAgIAogICAgLy8gU2ltcGVsZSBsaW5lYWlyZSBpbnRlcnBvbGF0aWUKICAgIGZ1bmN0aW9uIGxlcnAoYSwgYiwgdCkgewogICAgICAgIHJldHVybiBhICsgKGIgLSBhKSAqIHQ7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICAvLyBHZWJydWlrIGRlIGVhc2luZyBmdW5jdGllIHZvb3IgZWVuIHZsb2VpZW5kZXJlIGFuaW1hdGllCiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAKICAgICAgICAKICAgICAgICAvLyBBYW5nZW5vbWVuOiBnZXRQaXhlbERhdGEgcmV0b3VybmVlcnQgZWVuIEltYWdlRGF0YSBvYmplY3QKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7IC8vIFBpeGVsZGF0YSB2YW4gRm90byAxCiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOyAgIC8vIFBpeGVsZGF0YSB2YW4gRm90byAyCiAgICAgICAgCiAgICAgICAgLy8gLS0tIFRyYW5zZm9ybWF0aWUgTG9naWNhIC0tLQoKICAgICAgICAvLyAxLiBTY2hhYWwgKFZlcmdyb3RpbmcvVmVya2xlaW5pbmcpCiAgICAgICAgLy8gU2NoYWFsIHZhbiBGb3RvIDE6IHZhbiAxLjAgbmFhciAwLjAgKGtyaW1wdCkKICAgICAgICBjb25zdCBzY2FsZUEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICAvLyBTY2hhYWwgdmFuIEZvdG8gMjogdmFuIDAuMCBuYWFyIDEuMCAoZ3JvZWl0KQogICAgICAgIGNvbnN0IHNjYWxlQiA9IGVhc2VkUHJvZ3Jlc3M7CgogICAgICAgIC8vIDIuIFNjaGVlZnRyZWtraW5nIChTa2V3L1NoZWFyKQogICAgICAgIC8vIE1heCBTY2hlZWZ0cmVrIEZhY3RvciAoYmlqdi4gMC41IHZvb3IgZWVuIHN0ZXJrZSBzY2hlZWZ0cmVra2luZykKICAgICAgICBjb25zdCBtYXhTa2V3ID0gMC41OwogICAgICAgIC8vIFNjaGVlZnRyZWsgRmFjdG9yIHZvb3IgRm90byAxOiB2YW4gMC4wIG5hYXIgbWF4U2tldwogICAgICAgIGNvbnN0IHNrZXdGYWN0b3JBID0gbWF4U2tldyAqIGVhc2VkUHJvZ3Jlc3M7IAogICAgICAgIC8vIFNjaGVlZnRyZWsgRmFjdG9yIHZvb3IgRm90byAyOiB2YW4gbWF4U2tldyBuYWFyIDAuMAogICAgICAgIGNvbnN0IHNrZXdGYWN0b3JCID0gbWF4U2tldyAqICgxIC0gZWFzZWRQcm9ncmVzcyk7CgogICAgICAgIGNvbnN0IGNlbnRlclggPSBXSURUSCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IEhFSUdIVCAvIDI7CgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLS0tIEJlcmVrZW5pbmcgdm9vciBGb3RvIDEgKEtyaW1wZW4gZW4gU2tldykgLS0tCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFudGktdHJhbnNmb3JtYXRpZSAodmFuIGRvZWwgbmFhciBicm9uIGNvw7ZyZGluYXRlbikKICAgICAgICAgICAgICAgIC8vIDEuIERlc2NhbGUgKEludmVyc2UgdmFuIHNjYWxlQSkKICAgICAgICAgICAgICAgIGNvbnN0IGRlc2NhbGVkWF9BID0gKHggLSBjZW50ZXJYKSAvIHNjYWxlQTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlc2NhbGVkWV9BID0gKHkgLSBjZW50ZXJZKSAvIHNjYWxlQTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMi4gRGVza2V3IChJbnZlcnNlIHZhbiBza2V3KQogICAgICAgICAgICAgICAgLy8gU2hlYXIgWDogeCcgPSB4ICsgc2tld0ZhY3RvciAqIHkKICAgICAgICAgICAgICAgIC8vIEludmVyc2UgU2hlYXIgWDogeCA9IHgnIC0gc2tld0ZhY3RvciAqIHknCiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0EgPSBNYXRoLnJvdW5kKGRlc2NhbGVkWF9BIC0gc2tld0ZhY3RvckEgKiBkZXNjYWxlZFlfQSArIGNlbnRlclgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9BID0gTWF0aC5yb3VuZChkZXNjYWxlZFlfQSArIGNlbnRlclkpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAtLS0gQmVyZWtlbmluZyB2b29yIEZvdG8gMiAoR3JvZWllbiBlbiBTa2V3KSAtLS0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gMS4gRGVzY2FsZSAoSW52ZXJzZSB2YW4gc2NhbGVCKQogICAgICAgICAgICAgICAgY29uc3QgZGVzY2FsZWRYX0IgPSAoeCAtIGNlbnRlclgpIC8gc2NhbGVCOwogICAgICAgICAgICAgICAgY29uc3QgZGVzY2FsZWRZX0IgPSAoeSAtIGNlbnRlclkpIC8gc2NhbGVCOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAyLiBEZXNrZXcgKEludmVyc2UgdmFuIHNrZXcpCiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0IgPSBNYXRoLnJvdW5kKGRlc2NhbGVkWF9CIC0gc2tld0ZhY3RvckIgKiBkZXNjYWxlZFlfQiArIGNlbnRlclgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9CID0gTWF0aC5yb3VuZChkZXNjYWxlZFlfQiArIGNlbnRlclkpOwoKICAgICAgICAgICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBhID0gMDsKCiAgICAgICAgICAgICAgICAvLyBIYWFsIHBpeGVscyBvcCBlbiBjb21iaW5lZXIgKEFscGhhIEJsZW5kaW5nIG9wIGJhc2lzIHZhbiBwcm9ncmVzcykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQWxsZWVuIHBpeGVscyB1aXQgRm90byBBIG9waGFsZW4gYWxzIGRlIHNjaGFhbCA+IDAgaXMKICAgICAgICAgICAgICAgIGlmIChzY2FsZUEgPiAwLjAxICYmIHNyY1hfQSA+PSAwICYmIHNyY1hfQSA8IFdJRFRIICYmIHNyY1lfQSA+PSAwICYmIHNyY1lfQSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlBID0gKHNyY1lfQSAqIFdJRFRIICsgc3JjWF9BKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxwaGFBID0gMSAtIGVhc2VkUHJvZ3Jlc3M7IC8vIFRyYW5zcGFyYW50aWUgZmFjdG9yCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgciArPSBkYXRhQVtpQV0gKiBhbHBoYUE7CiAgICAgICAgICAgICAgICAgICAgZyArPSBkYXRhQVtpQSArIDFdICogYWxwaGFBOwogICAgICAgICAgICAgICAgICAgIGIgKz0gZGF0YUFbaUEgKyAyXSAqIGFscGhhQTsKICAgICAgICAgICAgICAgICAgICBhICs9IGRhdGFBW2lBICsgM10gKiBhbHBoYUEgLyAyNTU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gQWxsZWVuIHBpeGVscyB1aXQgRm90byBCIG9waGFsZW4gYWxzIGRlIHNjaGFhbCA+IDAgaXMKICAgICAgICAgICAgICAgIGlmIChzY2FsZUIgPiAwLjAxICYmIHNyY1hfQiA+PSAwICYmIHNyY1hfQiA8IFdJRFRIICYmIHNyY1lfQiA+PSAwICYmIHNyY1lfQiA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlCID0gKHNyY1lfQiAqIFdJRFRIICsgc3JjWF9CKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxwaGFCID0gZWFzZWRQcm9ncmVzczsgLy8gVHJhbnNwYXJhbnRpZSBmYWN0b3IKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByICs9IGRhdGFCW2lCXSAqIGFscGhhQjsKICAgICAgICAgICAgICAgICAgICBnICs9IGRhdGFCW2lCICsgMV0gKiBhbHBoYUI7CiAgICAgICAgICAgICAgICAgICAgYiArPSBkYXRhQltpQiArIDJdICogYWxwaGFCOwogICAgICAgICAgICAgICAgICAgIGEgKz0gZGF0YUJbaUIgKyAzXSAqIGFscGhhQiAvIDI1NTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBTY2hyaWpmIGRlIGdlY29tYmluZWVyZGUgcGl4ZWxkYXRhIHdlZwogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQocik7CiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyk7CiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYik7CiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAzXSA9IE1hdGgubWluKDI1NSwgTWF0aC5yb3VuZChhICogMjU1KSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgICAgCiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAvLyBQbGFhdHMgZGUgYmV3ZXJrdGUgZGF0YSBvcCBoZXQgY2FudmFzCgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBEZSB0aXRlbCB2YW4gZGUgYW5pbWF0aWUKICAgIHJldHVybiB7IHRpdGxlOiAiU2NoYWFsICYgSG9yaXpvbnRhbGUgU2NoZWVmdHJla2tpbmciLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCkFOSU1BVElPTl9MT0dJQ1s5M10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDE1MCwgY3VycmVudEZyYW1lOiAwLCB0cmFjZU1hcDogW10gfTsKICAgIGNvbnN0IFBIQVNFMV9FTkRfRlJBTUUgPSA3NTsgLy8gNTAlIHZhbiBkZSBhbmltYXRpZQogICAgCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICB9CgogICAgLy8gRnVuY3RpZSBvbSBSR0Igb20gdGUgemV0dGVuIG5hYXIgSFNMIChub2RpZyB2b29yIGRlIEtsZXVydmVyc2NodWl2aW5nKQogICAgZnVuY3Rpb24gcmdiVG9Ic2wociwgZywgYikgewogICAgICAgIC8vIFtJbXBsZW1lbnRhdGllIHZhbiBzdGFuZGFhcmQgcmdiVG9Ic2xdIC4uLgogICAgICAgIC8vIFZvb3IgYmVrbm9wdGhlaWQgd2VnZ2VsYXRlbiwgbWFhciBub2RpZyB2b29yIEtsZXVydmVyc2NodWl2aW5nIChIdWUgU2hpZnQpLgogICAgICAgIC8vIEFhbmdlbm9tZW4gZGF0IGRlemUgZnVuY3RpZSBiZXN0YWF0IGVuIFtoLCBzLCBsXSByZXRvdXJuZWVydAogICAgICAgIHJldHVybiBbMCwgMCwgMF07IAogICAgfQogICAgCiAgICAvLyBGdW5jdGllIG9tIEhTTCBvbSB0ZSB6ZXR0ZW4gbmFhciBSR0IKICAgIGZ1bmN0aW9uIGhzbFRvUmdiKGgsIHMsIGwpIHsKICAgICAgICAvLyBbSW1wbGVtZW50YXRpZSB2YW4gc3RhbmRhYXJkIGhzbFRvUmdiXSAuLi4KICAgICAgICAvLyBWb29yIGJla25vcHRoZWlkIHdlZ2dlbGF0ZW4sIG1hYXIgbm9kaWcgdm9vciBLbGV1cnZlcnNjaHVpdmluZyAoSHVlIFNoaWZ0KS4KICAgICAgICByZXR1cm4gWzAsIDAsIDBdOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAKICAgICAgICAKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7IAogICAgICAgIGNvbnN0IGRhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSkuZGF0YTsgICAKICAgICAgICAKICAgICAgICBjb25zdCBjZW50ZXJYID0gV0lEVEggLyAyOwogICAgICAgIGNvbnN0IGNlbnRlclkgPSBIRUlHSFQgLyAyOwogICAgICAgIAogICAgICAgIC8vIEJyZWVrIGRlIGFuaW1hdGllIG9wIGluIHR3ZWUgZmFzZW4KICAgICAgICBjb25zdCBwaGFzZTFQcm9ncmVzcyA9IE1hdGgubWluKDEsIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIFBIQVNFMV9FTkRfRlJBTUUpOyAvLyBWYW4gMCB0b3QgMSBpbiBmYXNlIDEKICAgICAgICBjb25zdCBwaGFzZTJQcm9ncmVzcyA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLSBQSEFTRTFfRU5EX0ZSQU1FKSAvICh1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcyAtIFBIQVNFMV9FTkRfRlJBTUUpKSk7IC8vIFZhbiAwIHRvdCAxIGluIGZhc2UgMgogICAgICAgIAogICAgICAgIC8vIEdlYnJ1aWsgZWVuIHdpbGxla2V1cmlnZSwgaGVyaGFhbGJhcmUgemFhZHdhYXJkZSAoc2VlZCkgb20gZGUgImNoYW9zIiB0ZSBiZXBhbGVuCiAgICAgICAgY29uc3Qgc2VlZCA9IDEuNjE4OyAKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsZXQgciA9IDAsIGcgPSAwLCBiID0gMCwgYSA9IDA7CgogICAgICAgICAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8PSBQSEFTRTFfRU5EX0ZSQU1FKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gLS0tIEZBU0UgMTogUGl4ZWwgQ2hhb3MgJiBEZXNpbnRlZ3JhdGllIChGb3RvIEEgLT4gUnVpcykgLS0tCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU2NoZWVmdHJla2tpbmcgKG5pZXQtbGluZWFpcik6IFZlcnNjaHVpdmluZyBhZmhhbmtlbGlqayB2YW4gZGUgc2luIHZhbiBkZSBjb8O2cmRpbmFhdC4KICAgICAgICAgICAgICAgICAgICAvLyBEaXQgY3Jlw6tlcnQgZWVuIGdvbHZlbmQsIG5pZXQtaW50dcOvdGllZiBwYXRyb29uLgogICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoYW9zRmFjdG9yID0gNTAgKiBNYXRoLnNpbih4IC8gMzAgKyB5IC8gNTAgKyBzZWVkKTsKICAgICAgICAgICAgICAgICAgICBjb25zdCBzcmNYID0gTWF0aC5yb3VuZCh4ICsgY2hhb3NGYWN0b3IgKiBwaGFzZTFQcm9ncmVzcyk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3JjWSA9IE1hdGgucm91bmQoeSArIGNoYW9zRmFjdG9yICogcGhhc2UxUHJvZ3Jlc3MgKiAwLjUpOyAvLyBNaW5kZXIgaW1wYWN0IG9wIFkKCiAgICAgICAgICAgICAgICAgICAgLy8gMi4gQWxwaGEvS2xldXI6IFZlcnZvcm1pbmcgdmFuIGRlIGtsZXVyIGVuIEFscGhhCiAgICAgICAgICAgICAgICAgICAgY29uc3QgaUEgPSAoKHkgKiBXSURUSCArIHgpICogNCk7IC8vIEJhc2lzIGNvw7ZyZGluYWF0ICh2b29yIGtsZXVyKQoKICAgICAgICAgICAgICAgICAgICBpZiAoc3JjWCA+PSAwICYmIHNyY1ggPCBXSURUSCAmJiBzcmNZID49IDAgJiYgc3JjWSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpU3JjID0gKHNyY1kgKiBXSURUSCArIHNyY1gpICogNDsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBpeGVsIHZhbiBGb3RvIEEKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJBID0gZGF0YUFbaVNyY10sIGdBID0gZGF0YUFbaVNyYyArIDFdLCBiQSA9IGRhdGFBW2lTcmMgKyAyXTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFBID0gZGF0YUFbaVNyYyArIDNdIC8gMjU1OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmFkaWFsZSBIdWUgU2hpZnQgKEtsZXVydmVyYW5kZXJpbmcpOiBLbGV1ciByb3RlZXJ0IGFmaGFua2VsaWprIHZhbiBkZSBhZnN0YW5kIHRvdCBoZXQgbWlkZGVuCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoKHggLSBjZW50ZXJYKSAqKiAyICsgKHkgLSBjZW50ZXJZKSAqKiAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaHVlU2hpZnQgPSAoZGlzdCAvIChXSURUSCAvIDIpICogMTgwICogcGhhc2UxUHJvZ3Jlc3MpOyAvLyBWZXJzY2h1aXZpbmcgdG90IDE4MCBncmFkZW4KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICoqKiBIU0wgY29udmVyc2llIHpvdSBoaWVyIG1vZXRlbiBwbGFhdHN2aW5kZW4gb20ga2xldXIgdGUgdmVyYW5kZXJlbiAqKioKICAgICAgICAgICAgICAgICAgICAgICAgLy8gW3JBLCBnQSwgYkFdID0gaHNsVG9SZ2IoaCArIGh1ZVNoaWZ0LCBzLCBsKTsgCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBBbHBoYSBkYWFsdAogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QWxwaGEgPSBhQSAqICgxIC0gcGhhc2UxUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgciA9IHJBICogY3VycmVudEFscGhhOwogICAgICAgICAgICAgICAgICAgICAgICBnID0gZ0EgKiBjdXJyZW50QWxwaGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBiQSAqIGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIC0tLSBGQVNFIDI6IFJhZGlhbGUgQ29udmVyZ2VudGllIChSdWlzIC0+IEZvdG8gQikgLS0tCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gMS4gU2NoYWFsL1NrZXcgKFJhZGlhbGUgQ29udmVyZ2VudGllKTogUGl4ZWxzIGJld2VnZW4gbmFhciBodW4gZG9lbGNvw7ZyZGluYWF0LgogICAgICAgICAgICAgICAgICAgIC8vIFByb2dyZXNzaWUgdmFuIGRlICJydWlzIiAoZWVuIHB1bnQgaW4gaGV0IGNlbnRydW0pIG5hYXIgZGUgdm9sbGVkaWdlIGFmYmVlbGRpbmcuCiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVGYWN0b3IgPSBwaGFzZTJQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBPbWdla2VlcmRlIHRyYW5zZm9ybWF0aWUgdmFuIHNjaGFhbDoKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXNjYWxlZFggPSAoeCAtIGNlbnRlclgpIC8gc2NhbGVGYWN0b3I7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVzY2FsZWRZID0gKHkgLSBjZW50ZXJZKSAvIHNjYWxlRmFjdG9yOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY1hfQiA9IE1hdGgucm91bmQoZGVzY2FsZWRYICsgY2VudGVyWCk7CiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9CID0gTWF0aC5yb3VuZChkZXNjYWxlZFkgKyBjZW50ZXJZKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAyLiBBbHBoYS9LbGV1cjogQWxwaGEgc3Rpamd0IG5hYXIgMS4wOyBSYWRpYWxlIEh1ZSBTaGlmdCB2ZXJkd2lqbnQuCiAgICAgICAgICAgICAgICAgICAgaWYgKHNyY1hfQiA+PSAwICYmIHNyY1hfQiA8IFdJRFRIICYmIHNyY1lfQiA+PSAwICYmIHNyY1lfQiA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpQiA9IChzcmNZX0IgKiBXSURUSCArIHNyY1hfQikgKiA0OwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJCID0gZGF0YUJbaUJdLCBnQiA9IGRhdGFCW2lCICsgMV0sIGJCID0gZGF0YUJbaUIgKyAyXTsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFCID0gZGF0YUJbaUIgKyAzXSAvIDI1NTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJhZGlhbGUgSHVlIFNoaWZ0IG9tZ2VrZWVyZDogdmVyZHdpam50CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoKHggLSBjZW50ZXJYKSAqKiAyICsgKHkgLSBjZW50ZXJZKSAqKiAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaHVlU2hpZnQgPSAoZGlzdCAvIChXSURUSCAvIDIpICogMTgwICogKDEgLSBwaGFzZTJQcm9ncmVzcykpOyAKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICoqKiBIU0wgY29udmVyc2llIHpvdSBoaWVyIG1vZXRlbiBwbGFhdHN2aW5kZW4gb20ga2xldXIgdGUgdmVyYW5kZXJlbiAqKioKICAgICAgICAgICAgICAgICAgICAgICAgLy8gW3JCLCBnQiwgYkJdID0gaHNsVG9SZ2IoaCArIGh1ZVNoaWZ0LCBzLCBsKTsgCgogICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QWxwaGEgPSBhQiAqIHBoYXNlMlByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgciA9IHJCICogY3VycmVudEFscGhhOwogICAgICAgICAgICAgICAgICAgICAgICBnID0gZ0IgKiBjdXJyZW50QWxwaGE7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgPSBiQiAqIGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICAgICAgYSA9IGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNjaHJpamYgZGUgZ2Vjb21iaW5lZXJkZSBwaXhlbGRhdGEgd2VnCiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnKTsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiKTsKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDNdID0gTWF0aC5taW4oMjU1LCBNYXRoLnJvdW5kKGEgKiAyNTUpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAgICAKICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvLyBEZSB0aXRlbCB2YW4gZGUgYW5pbWF0aWUKICAgIHJldHVybiB7IHRpdGxlOiAiRnJhY3RhbGUgQ2hhb3MgJiBDaHJvbWF0aWMgV2FycCAoMiBGYXNlbikiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7Ly8gLS0tIEFOSU1BVElPTiAxMDQ6IEdyYXZpdGF0aW9uYWwgTGVucyBEaXN0b3J0aW9uIC0tLQpBTklNQVRJT05fTE9HSUNbODddID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMjAsIGN1cnJlbnRGcmFtZTogMCB9OwogICAgY29uc3QgTUFYX1NUUkVOR1RIID0gMC41OyAvLyBNYXggZGlzdG9ydGlvbiBmYWN0b3IKCiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB9CgogICAgLy8gU2ltcGxpZmllZCBMZW5zIEVxdWF0aW9uOiBNYXAgb2JzZXJ2ZWQgcG9pbnQgKHgsIHkpIHRvIHNvdXJjZSBwb2ludCAoYmV0YV94LCBiZXRhX3kpCiAgICBmdW5jdGlvbiBsZW5zTWFwKHgsIHksIHN0cmVuZ3RoKSB7CiAgICAgICAgY29uc3QgbWlkWCA9IFdJRFRIIC8gMiwgbWlkWSA9IEhFSUdIVCAvIDI7CiAgICAgICAgY29uc3QgZHggPSB4IC0gbWlkWCwgZHkgPSB5IC0gbWlkWTsKICAgICAgICBjb25zdCBkaXN0U3EgPSBkeCpkeCArIGR5KmR5OwogICAgICAgIAogICAgICAgIGNvbnN0IGFscGhhID0gc3RyZW5ndGggLyBkaXN0U3E7IC8vIERlZmxlY3Rpb24gYW5nbGUgKHByb3BvcnRpb25hbCB0byAxL3IpCiAgICAgICAgCiAgICAgICAgY29uc3QgYmV0YVggPSB4IC0gZHggKiBhbHBoYTsKICAgICAgICBjb25zdCBiZXRhWSA9IHkgLSBkeSAqIGFscGhhOwogICAgICAgIHJldHVybiB7IHg6IGJldGFYLCB5OiBiZXRhWSB9OwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gTWF0aC5zaW4ocHJvZ3Jlc3MgKiBNYXRoLlBJKTsgLy8gUGVhayBkaXN0b3J0aW9uIGF0IDUwJQoKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAvLyBGSVgKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IC8vIEZJWAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7CgogICAgICAgIGNvbnN0IHN0cmVuZ3RoID0gZWFzZWRQcm9ncmVzcyAqIE1BWF9TVFJFTkdUSCAqIFdJRFRIICogMTAwOyAvLyBTY2FsaW5nIGZvciB2aXN1YWxpemF0aW9uCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2UgPSBsZW5zTWFwKHgsIHksIHN0cmVuZ3RoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gU2FtcGxlIGltYWdlIEEgYXQgdGhlIG1hcHBlZCBzb3VyY2UgbG9jYXRpb24KICAgICAgICAgICAgICAgIGNvbnN0IGNvbG9yQSA9IGdldFBpeGVsQ29sb3IoZGF0YUEsIHNvdXJjZS54LCBzb3VyY2UueSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJsZW5kOiBIaWdoIGRpc3RvcnRpb24gPSBtb3JlIGJsZW5kaW5nIHRvIEIKICAgICAgICAgICAgICAgIGNvbnN0IGJsZW5kUmF0aW8gPSBlYXNlZFByb2dyZXNzOwoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBjb2xvckEuciAqICgxIC0gYmxlbmRSYXRpbykgKyBkYXRhQltpXSAqIGJsZW5kUmF0aW87CiAgICAgICAgICAgICAgICBjb25zdCBnID0gY29sb3JBLmcgKiAoMSAtIGJsZW5kUmF0aW8pICsgZGF0YUJbaSArIDFdICogYmxlbmRSYXRpbzsKICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBjb2xvckEuYiAqICgxIC0gYmxlbmRSYXRpbykgKyBkYXRhQltpICsgMl0gKiBibGVuZFJhdGlvOwoKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIpOyBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyk7IAogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIpOyBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IC8vIEZJWAoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKysgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIGVsc2UgdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpOwogICAgfQogICAgcmV0dXJuIHsgdGl0bGU6ICJHcmF2aXRhdGlvbmFsIExlbnMgRGlzdG9ydGlvbiIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKLy8gLS0tIEFOSU1BVElPTiAxMDY6IENoYW90aWMgQmlmdXJjYXRpb24gU3BsaXQgLS0tCkFOSU1BVElPTl9MT0dJQ1s4M10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEyMCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBjb25zdCBSX01JTiA9IDIuOSwgUl9NQVggPSA0LjA7IC8vIEJpZnVyY2F0aW9uIHBhcmFtZXRlciByYW5nZQoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KCiAgICAvLyBMb2dpc3RpYyBNYXAgKENoYW90aWMgU3lzdGVtKQogICAgZnVuY3Rpb24gbG9naXN0aWNNYXAoeCwgcikgewogICAgICAgIHJldHVybiByICogeCAqICgxIC0geCk7CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBNYXRoLnNpbihwcm9ncmVzcyAqIE1hdGguUEkpOyAvLyBQZWFrcyBhdCA1MCUKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gRklYCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAvLyBGSVgKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwoKICAgICAgICAvLyBCaWZ1cmNhdGlvbiBwYXJhbWV0ZXIgcjogTW92ZXMgdGhyb3VnaCBwZXJpb2RpYywgY2hhb3RpYywgYW5kIGJhY2sgdG8gZml4ZWQgcG9pbnRzCiAgICAgICAgY29uc3Qgcl92YWx1ZSA9IFJfTUlOICsgKFJfTUFYIC0gUl9NSU4pICogZWFzZWRQcm9ncmVzczsgCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBJbml0aWFsIGNvbmRpdGlvbiB4MCBiYXNlZCBvbiBwaXhlbCBwb3NpdGlvbgogICAgICAgICAgICAgICAgY29uc3QgeDAgPSAoeCAvIFdJRFRIKSAqIDAuNSArIDAuMjsgCiAgICAgICAgICAgICAgICBsZXQgeF9uID0geDA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEl0ZXJhdGUgbWFwIDEwIHRpbWVzIHRvIHNldHRsZQogICAgICAgICAgICAgICAgZm9yKGxldCBpdGVyPTA7IGl0ZXI8MTA7IGl0ZXIrKykgeF9uID0gbG9naXN0aWNNYXAoeF9uLCByX3ZhbHVlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTWFwIHRoZSBmaW5hbCBjaGFvdGljIHN0YXRlICh4X24pIHRvIGEgdmVydGljYWwgZGlzdG9ydGlvbgogICAgICAgICAgICAgICAgY29uc3QgZGlzdG9ydGlvblkgPSAoeF9uIC0gMC41KSAqIEhFSUdIVCAqIDAuMTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNhbXBsZSBpbWFnZSBBIHdpdGggZGlzdG9ydGlvbgogICAgICAgICAgICAgICAgY29uc3Qgc2FtcGxlWUEgPSB5ICsgZGlzdG9ydGlvblk7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvckEgPSBnZXRQaXhlbENvbG9yKGRhdGFBLCB4LCBzYW1wbGVZQSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJsZW5kOiBDaGFvcyBmYWN0b3IgKHIgPiAzLjUpIGRldGVybWluZXMgdHJhbnNpdGlvbgogICAgICAgICAgICAgICAgY29uc3QgY2hhb3NfZmFjdG9yID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgcl92YWx1ZSAtIDMuNSkgLyAwLjUpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBjb2xvckEuciAqICgxIC0gY2hhb3NfZmFjdG9yKSArIGRhdGFCW2ldICogY2hhb3NfZmFjdG9yOwogICAgICAgICAgICAgICAgY29uc3QgZyA9IGNvbG9yQS5nICogKDEgLSBjaGFvc19mYWN0b3IpICsgZGF0YUJbaSArIDFdICogY2hhb3NfZmFjdG9yOwogICAgICAgICAgICAgICAgY29uc3QgYiA9IGNvbG9yQS5iICogKDEgLSBjaGFvc19mYWN0b3IpICsgZGF0YUJbaSArIDJdICogY2hhb3NfZmFjdG9yOwoKICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIpOyBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyk7IAogICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIpOyBvdXRwdXREYXRhW2kgKyAzXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IC8vIEZJWAoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKysgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIGVsc2UgdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpOwogICAgfQogICAgcmV0dXJuIHsgdGl0bGU6ICJDaGFvdGljIEJpZnVyY2F0aW9uIFNwbGl0IiwgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSB9Owp9KSgpOwovLyAtLS0gQU5JTUFUSU9OIDEwODogU3BlY3RyYWwgQ2x1c3RlcmluZyBXaXBlIC0tLQpBTklNQVRJT05fTE9HSUNbNzddID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMjAsIGN1cnJlbnRGcmFtZTogMCwgY2x1c3Rlck1hcDogW10gfTsKICAgIGNvbnN0IE5VTV9DTFVTVEVSUyA9IDg7CiAgICBjb25zdCBSRU5ERVJfU1RFUCA9IDU7CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIHVuaXF1ZVN0YXRlLmNsdXN0ZXJNYXAgPSBbXTsKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgCiAgICAgICAgLy8gU2ltcGxpZmllZCBjbHVzdGVyaW5nOiBhc3NpZ24gcGl4ZWxzIHRvIGEgY2x1c3RlciBiYXNlZCBvbiBpbml0aWFsIGx1bWluYW5jZQogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5ICs9IFJFTkRFUl9TVEVQKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHggKz0gUkVOREVSX1NURVApIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoKHkgKyBSRU5ERVJfU1RFUC8yKSAqIFdJRFRIICsgKHggKyBSRU5ERVJfU1RFUC8yKSkgKiA0OwogICAgICAgICAgICAgICAgY29uc3QgbHVtID0gKGRhdGFBW2ldICsgZGF0YUFbaSsxXSArIGRhdGFBW2krMl0pIC8gMzsKICAgICAgICAgICAgICAgIGNvbnN0IGNsdXN0ZXIgPSBNYXRoLmZsb29yKGx1bSAvIDI1NiAqIE5VTV9DTFVTVEVSUyk7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5jbHVzdGVyTWFwLnB1c2goY2x1c3Rlcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWFydGljKHByb2dyZXNzKTsKCiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgLy8gRklYCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAvLyBGSVgKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOwogICAgICAgIGxldCBibG9ja0luZGV4ID0gMDsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGNsdXN0ZXJzIGhhdmUgdHJhbnNpdGlvbmVkCiAgICAgICAgY29uc3QgY2x1c3RlcnNUb1RyYW5zaXRpb24gPSBNYXRoLmZsb29yKGVhc2VkUHJvZ3Jlc3MgKiBOVU1fQ0xVU1RFUlMpOyAKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkgKz0gUkVOREVSX1NURVApIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCArPSBSRU5ERVJfU1RFUCkgewogICAgICAgICAgICAgICAgY29uc3QgY2x1c3RlciA9IHVuaXF1ZVN0YXRlLmNsdXN0ZXJNYXBbYmxvY2tJbmRleCsrXTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IGZpbmFsX3Byb2dyZXNzID0gKGNsdXN0ZXIgPCBjbHVzdGVyc1RvVHJhbnNpdGlvbikgPyAxIDogMDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIChsZXQgZHkgPSAwOyBkeSA8IFJFTkRFUl9TVEVQOyBkeSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgZHggPSAwOyBkeCA8IFJFTkRFUl9TVEVQOyBkeCsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoKHkgKyBkeSkgKiBXSURUSCArICh4ICsgZHgpKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZihpIDwgb3V0cHV0RGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBkYXRhQVtpXSArIChkYXRhQltpXSAtIGRhdGFBW2ldKSAqIGZpbmFsX3Byb2dyZXNzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZyA9IGRhdGFBW2kgKyAxXSArIChkYXRhQltpICsgMV0gLSBkYXRhQVtpICsgMV0pICogZmluYWxfcHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiID0gZGF0YUFbaSArIDJdICsgKGRhdGFCW2kgKyAyXSAtIGRhdGFBW2kgKyAyXSkgKiBmaW5hbF9wcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQocik7IG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnKTsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYik7IG91dHB1dERhdGFbaSArIDNdID0gMjU1OwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsgLy8gRklYCgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlNwZWN0cmFsIENsdXN0ZXJpbmcgV2lwZSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpBTklNQVRJT05fTE9HSUNbMTAxXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTAwLCBjdXJyZW50RnJhbWU6IDAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgCiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOyAKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7ICAgCgogICAgICAgIC8vIFNjaGFhbCBBOiB2YW4gMS4wIG5hYXIgMC4wIChJbXBsb3NpZSkKICAgICAgICBjb25zdCBzY2FsZUEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICAvLyBTY2hhYWwgQjogdmFuIDAuMCBuYWFyIDEuMCAoRXhwbG9zaWUpCiAgICAgICAgY29uc3Qgc2NhbGVCID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAKICAgICAgICBjb25zdCBhbHBoYUEgPSBzY2FsZUE7IC8vIEFscGhhIHZvbGd0IHNjaGFhbAogICAgICAgIGNvbnN0IGFscGhhQiA9IHNjYWxlQjsKCiAgICAgICAgY29uc3QgY2VudGVyWCA9IFdJRFRIIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gSEVJR0hUIC8gMjsKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBJbnZlcnNlIHNjaGFsaW5nCiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0EgPSBNYXRoLnJvdW5kKCgoeCAtIGNlbnRlclgpIC8gc2NhbGVBKSArIGNlbnRlclgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9BID0gTWF0aC5yb3VuZCgoKHkgLSBjZW50ZXJZKSAvIHNjYWxlQSkgKyBjZW50ZXJZKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgc3JjWF9CID0gTWF0aC5yb3VuZCgoKHggLSBjZW50ZXJYKSAvIHNjYWxlQikgKyBjZW50ZXJYKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY1lfQiA9IE1hdGgucm91bmQoKCh5IC0gY2VudGVyWSkgLyBzY2FsZUIpICsgY2VudGVyWSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBhID0gMDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLi4uIChQaXhlbCBvcGhhbGVuIGVuIEJsZW5kZW4gbG9naWNhIC0gYW5hbG9vZyBhYW4gIzk4KSAuLi4KICAgICAgICAgICAgICAgIGlmIChzY2FsZUEgPiAwLjAxICYmIHNyY1hfQSA+PSAwICYmIHNyY1hfQSA8IFdJRFRIICYmIHNyY1lfQSA+PSAwICYmIHNyY1lfQSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlBID0gKHNyY1lfQSAqIFdJRFRIICsgc3JjWF9BKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgciArPSBkYXRhQVtpQV0gKiBhbHBoYUE7IGcgKz0gZGF0YUFbaUErMV0gKiBhbHBoYUE7IGIgKz0gZGF0YUFbaUErMl0gKiBhbHBoYUE7IGEgKz0gKGRhdGFBW2lBKzNdLzI1NSkgKiBhbHBoYUE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoc2NhbGVCID4gMC4wMSAmJiBzcmNYX0IgPj0gMCAmJiBzcmNYX0IgPCBXSURUSCAmJiBzcmNZX0IgPj0gMCAmJiBzcmNZX0IgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpQiA9IChzcmNZX0IgKiBXSURUSCArIHNyY1hfQikgKiA0OwogICAgICAgICAgICAgICAgICAgIHIgKz0gZGF0YUJbaUJdICogYWxwaGFCOyBnICs9IGRhdGFCW2lCKzFdICogYWxwaGFCOyBiICs9IGRhdGFCW2lCKzJdICogYWxwaGFCOyBhICs9IChkYXRhQltpQiszXS8yNTUpICogYWxwaGFCOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQWxwaGEgPSBNYXRoLm1pbigxLCBhKTsKICAgICAgICAgICAgICAgIGlmIChmaW5hbEFscGhhID4gMCkgewogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgM10gPSBNYXRoLnJvdW5kKGZpbmFsQWxwaGEgKiAyNTUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsgb3V0cHV0RGF0YVtpXSA9IDA7IG91dHB1dERhdGFbaSArIDFdID0gMDsgb3V0cHV0RGF0YVtpICsgMl0gPSAwOyBvdXRwdXREYXRhW2kgKyAzXSA9IDA7IH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlNjaGFhbCAmIFRyYW5zcGFyYW50aWUgKEltcGxvc2llL0V4cGxvc2llKSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKQU5JTUFUSU9OX0xPR0lDWzEwMF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEwMCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsgCiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOyAgIAoKICAgICAgICAvLyBTaW11bGVlciAzRC1yb3RhdGllIG1ldCBTa2V3IGZhY3RvciAoZ3Jvb3RzdGUgdmVydm9ybWluZyBpbiBoZXQgbWlkZGVuKQogICAgICAgIGNvbnN0IG1heFNrZXcgPSAwLjU7IAogICAgICAgIGNvbnN0IG1heFJvdGF0aW9uID0gTWF0aC5QSTsgLy8gSGFsdmUgZHJhYWkKICAgICAgICAKICAgICAgICBjb25zdCBza2V3QSA9IG1heFNrZXcgKiBNYXRoLnNpbihNYXRoLlBJICogZWFzZWRQcm9ncmVzcyk7IC8vIEdhYXQgdmFuIDAgbmFhciBtYXggZW4gdGVydWcgbmFhciAwCiAgICAgICAgY29uc3Qgcm90QSA9IG1heFJvdGF0aW9uICogZWFzZWRQcm9ncmVzczsKICAgICAgICAKICAgICAgICBjb25zdCBza2V3QiA9IG1heFNrZXcgKiBNYXRoLnNpbihNYXRoLlBJICogZWFzZWRQcm9ncmVzcyk7IC8vIFplbGZkZSBza2V3CiAgICAgICAgY29uc3Qgcm90QiA9IG1heFJvdGF0aW9uICogKDEgLSBlYXNlZFByb2dyZXNzKTsgLy8gVGVnZW5nZXN0ZWxkZSByb3RhdGllCgogICAgICAgIGNvbnN0IGNlbnRlclggPSBXSURUSCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IEhFSUdIVCAvIDI7CgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUm90YXRpZS0gZW4gU2tldyBtYXRyaWNlcyBjb21iaW5lcmVuLi4uIChIaWVyIHZlcmVlbnZvdWRpZ2QgdG90IGVlbiBTa2V3LVJvdGF0ZSB0cmFuc2Zvcm1hdGllKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBkeF9BID0geCAtIGNlbnRlclg7CiAgICAgICAgICAgICAgICBjb25zdCBkeV9BID0geSAtIGNlbnRlclk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEludmVyc2UgU2tldyAoWS1Ta2V3LCBhZmhhbmtlbGlqayB2YW4gWCkKICAgICAgICAgICAgICAgIGNvbnN0IHByZVJvdFlfQSA9IGR5X0E7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVSb3RYX0EgPSBkeF9BIC0gKHNrZXdBICogcHJlUm90WV9BKTsKCiAgICAgICAgICAgICAgICAvLyBJbnZlcnNlIFJvdGF0aWUKICAgICAgICAgICAgICAgIGNvbnN0IGNvc0EgPSBNYXRoLmNvcygtcm90QSk7IC8vIEludmVyc2Ugcm90YXRpZQogICAgICAgICAgICAgICAgY29uc3Qgc2luQSA9IE1hdGguc2luKC1yb3RBKTsgCiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0EgPSBNYXRoLnJvdW5kKHByZVJvdFhfQSAqIGNvc0EgLSBwcmVSb3RZX0EgKiBzaW5BICsgY2VudGVyWCk7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNZX0EgPSBNYXRoLnJvdW5kKHByZVJvdFhfQSAqIHNpbkEgKyBwcmVSb3RZX0EgKiBjb3NBICsgY2VudGVyWSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIC4uLiAoQW5hbG9nZSBiZXJla2VuaW5nIHZvb3IgRm90byBCOiBzcmNYX0IgZW4gc3JjWV9CKSAuLi4KICAgICAgICAgICAgICAgIGNvbnN0IGR4X0IgPSB4IC0gY2VudGVyWDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5X0IgPSB5IC0gY2VudGVyWTsKICAgICAgICAgICAgICAgIGNvbnN0IHByZVJvdFlfQiA9IGR5X0I7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVSb3RYX0IgPSBkeF9CIC0gKHNrZXdCICogcHJlUm90WV9CKTsKICAgICAgICAgICAgICAgIGNvbnN0IGNvc0IgPSBNYXRoLmNvcygtcm90Qik7IAogICAgICAgICAgICAgICAgY29uc3Qgc2luQiA9IE1hdGguc2luKC1yb3RCKTsgCiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0IgPSBNYXRoLnJvdW5kKHByZVJvdFhfQiAqIGNvc0IgLSBwcmVSb3RZX0IgKiBzaW5CICsgY2VudGVyWCk7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNZX0IgPSBNYXRoLnJvdW5kKHByZVJvdFhfQiAqIHNpbkIgKyBwcmVSb3RZX0IgKiBjb3NCICsgY2VudGVyWSk7CgoKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhQSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgYWxwaGFCID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBhID0gMDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLi4uIChQaXhlbCBvcGhhbGVuIGVuIEJsZW5kZW4gbG9naWNhIC0gYW5hbG9vZyBhYW4gIzk4KSAuLi4KICAgICAgICAgICAgICAgIGlmIChhbHBoYUEgPiAwLjAxICYmIHNyY1hfQSA+PSAwICYmIHNyY1hfQSA8IFdJRFRIICYmIHNyY1lfQSA+PSAwICYmIHNyY1lfQSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlBID0gKHNyY1lfQSAqIFdJRFRIICsgc3JjWF9BKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgciArPSBkYXRhQVtpQV0gKiBhbHBoYUE7IGcgKz0gZGF0YUFbaUErMV0gKiBhbHBoYUE7IGIgKz0gZGF0YUFbaUErMl0gKiBhbHBoYUE7IGEgKz0gKGRhdGFBW2lBKzNdLzI1NSkgKiBhbHBoYUE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYWxwaGFCID4gMC4wMSAmJiBzcmNYX0IgPj0gMCAmJiBzcmNYX0IgPCBXSURUSCAmJiBzcmNZX0IgPj0gMCAmJiBzcmNZX0IgPCBIRUlHSFQpIHsKICAgICAgICAgICAgICAgICAgICBjb25zdCBpQiA9IChzcmNZX0IgKiBXSURUSCArIHNyY1hfQikgKiA0OwogICAgICAgICAgICAgICAgICAgIHIgKz0gZGF0YUJbaUJdICogYWxwaGFCOyBnICs9IGRhdGFCW2lCKzFdICogYWxwaGFCOyBiICs9IGRhdGFCW2lCKzJdICogYWxwaGFCOyBhICs9IChkYXRhQltpQiszXS8yNTUpICogYWxwaGFCOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQWxwaGEgPSBNYXRoLm1pbigxLCBhKTsKICAgICAgICAgICAgICAgIGlmIChmaW5hbEFscGhhID4gMCkgewogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgM10gPSBNYXRoLnJvdW5kKGZpbmFsQWxwaGEgKiAyNTUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsgb3V0cHV0RGF0YVtpXSA9IDA7IG91dHB1dERhdGFbaSArIDFdID0gMDsgb3V0cHV0RGF0YVtpICsgMl0gPSAwOyBvdXRwdXREYXRhW2kgKyAzXSA9IDA7IH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlNjaGVlZnRyZWtraW5nICYgUm90YXRpZSAoUHNldWRvIDNEKSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKCgoKCgoKCkFOSU1BVElPTl9MT0dJQ1s5OV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDgwLCBjdXJyZW50RnJhbWU6IDAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgCiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOyAKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7ICAgCgogICAgICAgIC8vIEhvcml6b250YWxlIFNjaGFhbCAodmFuIDEgbmFhciAwKQogICAgICAgIGNvbnN0IHNjYWxlWF9BID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgY29uc3Qgc2NhbGVYX0IgPSBlYXNlZFByb2dyZXNzOwoKICAgICAgICAvLyBWZXJ0aWNhbGUgU2NoZWVmdHJla2tpbmcgKFktU2tldywgYWZoYW5rZWxpamsgdmFuIFgpCiAgICAgICAgY29uc3QgbWF4U2tldyA9IDAuNDsKICAgICAgICBjb25zdCBza2V3WV9BID0gbWF4U2tldyAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgY29uc3Qgc2tld1lfQiA9IG1heFNrZXcgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpOwoKICAgICAgICBjb25zdCBjZW50ZXJYID0gV0lEVEggLyAyOwogICAgICAgIGNvbnN0IGNlbnRlclkgPSBIRUlHSFQgLyAyOwoKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEludmVyc2UgSG9yaXpvbnRhbGUgU2NoYWFsCiAgICAgICAgICAgICAgICBjb25zdCBwcmVTa2V3WF9BID0gKCh4IC0gY2VudGVyWCkgLyBzY2FsZVhfQSkgKyBjZW50ZXJYOwogICAgICAgICAgICAgICAgY29uc3QgcHJlU2tld1lfQSA9IHk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEludmVyc2UgWS1Ta2V3CiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0EgPSBNYXRoLnJvdW5kKHByZVNrZXdYX0EpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9BID0gTWF0aC5yb3VuZChwcmVTa2V3WV9BIC0gKHNrZXdZX0EgKiAocHJlU2tld1hfQSAtIGNlbnRlclgpKSk7IC8vIEFmaGFua2VsaWprIHZhbiBYLWFmc3RhbmQKCiAgICAgICAgICAgICAgICAvLyAuLi4gKEFuYWxvZ2UgYmVyZWtlbmluZyB2b29yIEZvdG8gQjogc3JjWF9CIGVuIHNyY1lfQikgLi4uCiAgICAgICAgICAgICAgICBjb25zdCBwcmVTa2V3WF9CID0gKCh4IC0gY2VudGVyWCkgLyBzY2FsZVhfQikgKyBjZW50ZXJYOwogICAgICAgICAgICAgICAgY29uc3QgcHJlU2tld1lfQiA9IHk7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0IgPSBNYXRoLnJvdW5kKHByZVNrZXdYX0IpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9CID0gTWF0aC5yb3VuZChwcmVTa2V3WV9CIC0gKHNrZXdZX0IgKiAocHJlU2tld1hfQiAtIGNlbnRlclgpKSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhQSA9IDEgLSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3QgYWxwaGFCID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBhID0gMDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gLi4uIChQaXhlbCBvcGhhbGVuIGVuIEJsZW5kZW4gbG9naWNhIC0gYW5hbG9vZyBhYW4gIzk4KSAuLi4KICAgICAgICAgICAgICAgIGlmIChzY2FsZVhfQSA+IDAuMDEgJiYgc3JjWF9BID49IDAgJiYgc3JjWF9BIDwgV0lEVEggJiYgc3JjWV9BID49IDAgJiYgc3JjWV9BIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaUEgPSAoc3JjWV9BICogV0lEVEggKyBzcmNYX0EpICogNDsKICAgICAgICAgICAgICAgICAgICByICs9IGRhdGFBW2lBXSAqIGFscGhhQTsgZyArPSBkYXRhQVtpQSsxXSAqIGFscGhhQTsgYiArPSBkYXRhQVtpQSsyXSAqIGFscGhhQTsgYSArPSAoZGF0YUFbaUErM10vMjU1KSAqIGFscGhhQTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzY2FsZVhfQiA+IDAuMDEgJiYgc3JjWF9CID49IDAgJiYgc3JjWF9CIDwgV0lEVEggJiYgc3JjWV9CID49IDAgJiYgc3JjWV9CIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaUIgPSAoc3JjWV9CICogV0lEVEggKyBzcmNYX0IpICogNDsKICAgICAgICAgICAgICAgICAgICByICs9IGRhdGFCW2lCXSAqIGFscGhhQjsgZyArPSBkYXRhQltpQisxXSAqIGFscGhhQjsgYiArPSBkYXRhQltpQisyXSAqIGFscGhhQjsgYSArPSAoZGF0YUJbaUIrM10vMjU1KSAqIGFscGhhQjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCBmaW5hbEFscGhhID0gTWF0aC5taW4oMSwgYSk7CiAgICAgICAgICAgICAgICBpZiAoZmluYWxBbHBoYSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyIC8gZmluYWxBbHBoYSk7IG91dHB1dERhdGFbaSArIDFdID0gTWF0aC5yb3VuZChnIC8gZmluYWxBbHBoYSk7IG91dHB1dERhdGFbaSArIDJdID0gTWF0aC5yb3VuZChiIC8gZmluYWxBbHBoYSk7IG91dHB1dERhdGFbaSArIDNdID0gTWF0aC5yb3VuZChmaW5hbEFscGhhICogMjU1KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7IG91dHB1dERhdGFbaV0gPSAwOyBvdXRwdXREYXRhW2kgKyAxXSA9IDA7IG91dHB1dERhdGFbaSArIDJdID0gMDsgb3V0cHV0RGF0YVtpICsgM10gPSAwOyB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3R4LnB1dEltYWdlRGF0YShvdXRwdXRJbWFnZURhdGEsIDAsIDApOyAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKysgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIGVsc2UgdHJhbnNpdGlvbkVuZChuZXh0SW1hZ2UpOwogICAgfQogICAgcmV0dXJuIHsgdGl0bGU6ICJTY2hhYWwgJiBTY2hlZWZ0cmVra2luZyAoSG9yaXpvbnRhbGUgQ29tcHJlc3NpZSkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgoKCgoKCgoKCgpBTklNQVRJT05fTE9HSUNbOThdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMDAsIGN1cnJlbnRGcmFtZTogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7IAogICAgICAgIGNvbnN0IGRhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSkuZGF0YTsgICAKCiAgICAgICAgLy8gQWxwaGEgZ29sZiBtaWRkZW4gdmFuIGhldCBzY2hlcm0KICAgICAgICBjb25zdCBjZW50ZXJBbHBoYSA9IE1hdGguc2luKE1hdGguUEkgKiBlYXNlZFByb2dyZXNzKTsgLy8gQWxwaGEgaXMgMS4wIGluIGhldCBtaWRkZW4gdmFuIGRlIHRyYW5zaXRpZQogICAgICAgIAogICAgICAgIC8vIFNjaGVlZnRyZWtraW5nIGZhY3RvciAoU2tldyBZIGFmaGFua2VsaWprIHZhbiBYKQogICAgICAgIGNvbnN0IG1heFNrZXcgPSAwLjU7CiAgICAgICAgY29uc3Qgc2tld1lfRmFjdG9yID0gbWF4U2tldyAqIGNlbnRlckFscGhhOyAvLyBNYXhpbWFsZSBza2V3IGluIGhldCBtaWRkZW4gdmFuIGRlIHRyYW5zaXRpZQoKICAgICAgICBjb25zdCBjZW50ZXJYID0gV0lEVEggLyAyOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKCiAgICAgICAgICAgICAgICAvLyBEZSBhbHBoYS90cmFuc3BhcmFudGllIGlzIGhpZXIgY29tcGxleGVyOiBoZXQgaXMgZWVuICd3YWFpZXInIHZhbiAxLXByb2dyZXNzIHRvdCBwcm9ncmVzcwogICAgICAgICAgICAgICAgY29uc3QgYWxwaGFXZWlnaHQgPSAxIC0gTWF0aC5hYnMoZWFzZWRQcm9ncmVzcyAtIDAuNSkgKiAyOyAvLyBXb3JkdCAxLjAgaW4gaGV0IG1pZGRlbiwgMC4wIGFhbiBkZSByYW5kZW4KCiAgICAgICAgICAgICAgICAvLyBTY2hlZWZ0cmVra2luZwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWCA9IHg7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNZID0gTWF0aC5yb3VuZCh5IC0gKHNrZXdZX0ZhY3RvciAqICh4IC0gY2VudGVyWCkpKTsgLy8gWS1Ta2V3CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxldCByID0gMCwgZyA9IDAsIGIgPSAwLCBhID0gMDsKCiAgICAgICAgICAgICAgICBpZiAoc3JjWCA+PSAwICYmIHNyY1ggPCBXSURUSCAmJiBzcmNZID49IDAgJiYgc3JjWSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlTcmMgPSAoc3JjWSAqIFdJRFRIICsgc3JjWCkgKiA0OwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIENyb3NzZmFkZTogRm90byBBIGVuIEZvdG8gQiB6aWpuIGJlaWRlIHppY2h0YmFhcgogICAgICAgICAgICAgICAgICAgIGxldCByQSA9IGRhdGFBW2lTcmNdLCBnQSA9IGRhdGFBW2lTcmMgKyAxXSwgYkEgPSBkYXRhQVtpU3JjICsgMl07CiAgICAgICAgICAgICAgICAgICAgbGV0IHJCID0gZGF0YUJbaVNyY10sIGdCID0gZGF0YUJbaVNyYyArIDFdLCBiQiA9IGRhdGFCW2lTcmMgKyAyXTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyBTdGVya2UgYWxwaGEgZmFkZSBpbiBkZSBza2V3IHpvbmUKICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QWxwaGEgPSBhbHBoYVdlaWdodDsgCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQmxlbmRpbmcKICAgICAgICAgICAgICAgICAgICByID0gckEgKiAoMSAtIGN1cnJlbnRBbHBoYSkgKyByQiAqIGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICBnID0gZ0EgKiAoMSAtIGN1cnJlbnRBbHBoYSkgKyBnQiAqIGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICBiID0gYkEgKiAoMSAtIGN1cnJlbnRBbHBoYSkgKyBiQiAqIGN1cnJlbnRBbHBoYTsKICAgICAgICAgICAgICAgICAgICBhID0gMS4wOyAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gTWF0aC5yb3VuZChyKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcpOyBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYik7IG91dHB1dERhdGFbaSArIDNdID0gTWF0aC5yb3VuZChhICogMjU1KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIlRyYW5zcGFyYW50aWUgJiBTY2hlZWZ0cmVra2luZyAoQWxwaGEgR29sZikiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgoKCgoKCgpBTklNQVRJT05fTE9HSUNbOTddID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMjAsIGN1cnJlbnRGcmFtZTogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCBwcm9ncmVzcyA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkUHJvZ3Jlc3MgPSBlYXNlSW5PdXRRdWludChwcm9ncmVzcyk7CiAgICAgICAgY29uc3Qgb3V0cHV0SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShXSURUSCwgSEVJR0hUKTsgCiAgICAgICAgY29uc3Qgb3V0cHV0RGF0YSA9IG91dHB1dEltYWdlRGF0YS5kYXRhOyAKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7IAogICAgICAgIGNvbnN0IGRhdGFCID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSkuZGF0YTsgICAKCiAgICAgICAgY29uc3QgbWF4Um90YXRpb24gPSBNYXRoLlBJICogNDsgLy8gVHdlZSB2b2xsZWRpZ2Ugcm90YXRpZXMKICAgICAgICBjb25zdCByb3QgPSBtYXhSb3RhdGlvbiAqIGVhc2VkUHJvZ3Jlc3M7CgogICAgICAgIC8vIE1heGltYWxlIGtsZXVydmVyc2NodWl2aW5nICgzNjAgZ3JhZGVuKQogICAgICAgIGNvbnN0IG1heEh1ZVNoaWZ0ID0gMzYwOyAKICAgICAgICBjb25zdCBodWVTaGlmdCA9IG1heEh1ZVNoaWZ0ICogZWFzZWRQcm9ncmVzczsgCgogICAgICAgIGNvbnN0IGNlbnRlclggPSBXSURUSCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IEhFSUdIVCAvIDI7CgogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBXSURUSDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpID0gKHkgKiBXSURUSCArIHgpICogNDsKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0geCAtIGNlbnRlclg7CiAgICAgICAgICAgICAgICBjb25zdCBkeSA9IHkgLSBjZW50ZXJZOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSb3RhdGllCiAgICAgICAgICAgICAgICBjb25zdCBjb3NSb3QgPSBNYXRoLmNvcygtcm90KTsKICAgICAgICAgICAgICAgIGNvbnN0IHNpblJvdCA9IE1hdGguc2luKC1yb3QpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWCA9IE1hdGgucm91bmQoY2VudGVyWCArIChkeCAqIGNvc1JvdCAtIGR5ICogc2luUm90KSk7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNZID0gTWF0aC5yb3VuZChjZW50ZXJZICsgKGR4ICogc2luUm90ICsgZHkgKiBjb3NSb3QpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbGV0IHIgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAwOwoKICAgICAgICAgICAgICAgIGlmIChzcmNYID49IDAgJiYgc3JjWCA8IFdJRFRIICYmIHNyY1kgPj0gMCAmJiBzcmNZIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaVNyYyA9IChzcmNZICogV0lEVEggKyBzcmNYKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWxwaGEgQmxlbmRpbmcKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUEgPSAxIC0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUIgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGxldCByQSA9IGRhdGFBW2lTcmNdLCBnQSA9IGRhdGFBW2lTcmMgKyAxXSwgYkEgPSBkYXRhQVtpU3JjICsgMl07CiAgICAgICAgICAgICAgICAgICAgbGV0IHJCID0gZGF0YUJbaVNyY10sIGdCID0gZGF0YUJbaVNyYyArIDFdLCBiQiA9IGRhdGFCW2lTcmMgKyAyXTsKCiAgICAgICAgICAgICAgICAgICAgLy8gS2xldXJ2ZXJzY2h1aXZpbmcgb3AgRm90byBBIHRpamRlbnMgcm90YXRpZQogICAgICAgICAgICAgICAgICAgIC8vIC4uLiAoUkdCIG5hYXIgSFNMLCBIdWUgYWFucGFzc2VuLCBIU0wgbmFhciBSR0IgY29udmVyc2llIGxvZ2ljYSBoaWVyKSAuLi4KICAgICAgICAgICAgICAgICAgICAvLyBWb29yYmVlbGQ6IFtyQSwgZ0EsIGJBXSA9IEFwcGx5SHVlU2hpZnQoW3JBLCBnQSwgYkFdLCBodWVTaGlmdCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgciA9IHJBICogYWxwaGFBICsgckIgKiBhbHBoYUI7CiAgICAgICAgICAgICAgICAgICAgZyA9IGdBICogYWxwaGFBICsgZ0IgKiBhbHBoYUI7CiAgICAgICAgICAgICAgICAgICAgYiA9IGJBICogYWxwaGFBICsgYkIgKiBhbHBoYUI7CiAgICAgICAgICAgICAgICAgICAgYSA9IChkYXRhQVtpU3JjKzNdLzI1NSkgKiBhbHBoYUEgKyAoZGF0YUJbaVNyYyszXS8yNTUpICogYWxwaGFCOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQWxwaGEgPSBNYXRoLm1pbigxLCBhKTsKICAgICAgICAgICAgICAgIGlmIChmaW5hbEFscGhhID4gMCkgewogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbaV0gPSBNYXRoLnJvdW5kKHIgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgMV0gPSBNYXRoLnJvdW5kKGcgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgMl0gPSBNYXRoLnJvdW5kKGIgLyBmaW5hbEFscGhhKTsgb3V0cHV0RGF0YVtpICsgM10gPSBNYXRoLnJvdW5kKGZpbmFsQWxwaGEgKiAyNTUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsgb3V0cHV0RGF0YVtpXSA9IDA7IG91dHB1dERhdGFbaSArIDFdID0gMDsgb3V0cHV0RGF0YVtpICsgMl0gPSAwOyBvdXRwdXREYXRhW2kgKyAzXSA9IDA7IH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG91dHB1dEltYWdlRGF0YSwgMCwgMCk7IAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKyA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgZWxzZSB0cmFuc2l0aW9uRW5kKG5leHRJbWFnZSk7CiAgICB9CiAgICByZXR1cm4geyB0aXRsZTogIktsZXVydmVyYW5kZXJpbmcgJiBSb3RhdGllIChIdWUtV2FycCkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgoKCgoKCgoKCkFOSU1BVElPTl9MT0dJQ1s5Nl0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEwMCwgY3VycmVudEZyYW1lOiAwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dFF1aW50KHByb2dyZXNzKTsKICAgICAgICBjb25zdCBvdXRwdXRJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKFdJRFRILCBIRUlHSFQpOyAKICAgICAgICBjb25zdCBvdXRwdXREYXRhID0gb3V0cHV0SW1hZ2VEYXRhLmRhdGE7IAogICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsgCiAgICAgICAgY29uc3QgZGF0YUIgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKS5kYXRhOyAgIAoKICAgICAgICAvLyBTY2hhYWw6IEEgem9vbXQgdWl0ICgxLjAgLT4gMC4xKSwgQiB6b29tdCBpbiAoMC4xIC0+IDEuMCkKICAgICAgICBjb25zdCBtaW5TY2FsZSA9IDAuMTsKICAgICAgICBjb25zdCBzY2FsZUEgPSBsZXJwKDEuMCwgbWluU2NhbGUsIGVhc2VkUHJvZ3Jlc3MpOwogICAgICAgIGNvbnN0IHNjYWxlQiA9IGxlcnAobWluU2NhbGUsIDEuMCwgZWFzZWRQcm9ncmVzcyk7CiAgICAgICAgCiAgICAgICAgLy8gUm90YXRpZQogICAgICAgIGNvbnN0IG1heFJvdGF0aW9uID0gTWF0aC5QSTsgLy8gMTgwIGdyYWRlbgogICAgICAgIGNvbnN0IHJvdEEgPSBtYXhSb3RhdGlvbiAqIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgY29uc3Qgcm90QiA9IG1heFJvdGF0aW9uICogKDEgLSBlYXNlZFByb2dyZXNzKTsKCiAgICAgICAgY29uc3QgY2VudGVyWCA9IFdJRFRIIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gSEVJR0hUIC8gMjsKCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBIRUlHSFQ7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IFdJRFRIOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGkgPSAoeSAqIFdJRFRIICsgeCkgKiA0OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBSb3RhdGllIGVuIFNjaGFhbCAob21nZWtlZXJkKQogICAgICAgICAgICAgICAgY29uc3QgZHggPSB4IC0gY2VudGVyWDsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIGNlbnRlclk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEE6IEludmVyc2Ugc2NoYWFsIC0+IEludmVyc2Ugcm90YXRpZQogICAgICAgICAgICAgICAgY29uc3QgZGVzY2FsZWRYX0EgPSBkeCAvIHNjYWxlQTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlc2NhbGVkWV9BID0gZHkgLyBzY2FsZUE7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNYX0EgPSBNYXRoLnJvdW5kKGNlbnRlclggKyAoZGVzY2FsZWRYX0EgKiBNYXRoLmNvcygtcm90QSkgLSBkZXNjYWxlZFlfQSAqIE1hdGguc2luKC1yb3RBKSkpOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWV9BID0gTWF0aC5yb3VuZChjZW50ZXJZICsgKGRlc2NhbGVkWF9BICogTWF0aC5zaW4oLXJvdEEpICsgZGVzY2FsZWRZX0EgKiBNYXRoLmNvcygtcm90QSkpKTsKCiAgICAgICAgICAgICAgICAvLyBCOiBJbnZlcnNlIHNjaGFhbCAtPiBJbnZlcnNlIHJvdGF0aWUKICAgICAgICAgICAgICAgIGNvbnN0IGRlc2NhbGVkWF9CID0gZHggLyBzY2FsZUI7CiAgICAgICAgICAgICAgICBjb25zdCBkZXNjYWxlZFlfQiA9IGR5IC8gc2NhbGVCOwogICAgICAgICAgICAgICAgY29uc3Qgc3JjWF9CID0gTWF0aC5yb3VuZChjZW50ZXJYICsgKGRlc2NhbGVkWF9CICogTWF0aC5jb3Mocm90QikgLSBkZXNjYWxlZFlfQiAqIE1hdGguc2luKHJvdEIpKSk7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNZX0IgPSBNYXRoLnJvdW5kKGNlbnRlclkgKyAoZGVzY2FsZWRYX0IgKiBNYXRoLnNpbihyb3RCKSArIGRlc2NhbGVkWV9CICogTWF0aC5jb3Mocm90QikpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYWxwaGFBID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUIgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgbGV0IHIgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAuLi4gKFBpeGVsIG9waGFsZW4gZW4gQmxlbmRlbiBsb2dpY2EgLSBhbmFsb29nIGFhbiAjOTgpIC4uLgogICAgICAgICAgICAgICAgaWYgKHNjYWxlQSA+IDAuMDEgJiYgc3JjWF9BID49IDAgJiYgc3JjWF9BIDwgV0lEVEggJiYgc3JjWV9BID49IDAgJiYgc3JjWV9BIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaUEgPSAoc3JjWV9BICogV0lEVEggKyBzcmNYX0EpICogNDsKICAgICAgICAgICAgICAgICAgICByICs9IGRhdGFBW2lBXSAqIGFscGhhQTsgZyArPSBkYXRhQVtpQSsxXSAqIGFscGhhQTsgYiArPSBkYXRhQVtpQSsyXSAqIGFscGhhQTsgYSArPSAoZGF0YUFbaUErM10vMjU1KSAqIGFscGhhQTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzY2FsZUIgPiAwLjAxICYmIHNyY1hfQiA+PSAwICYmIHNyY1hfQiA8IFdJRFRIICYmIHNyY1lfQiA+PSAwICYmIHNyY1lfQiA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlCID0gKHNyY1lfQiAqIFdJRFRIICsgc3JjWF9CKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgciArPSBkYXRhQltpQl0gKiBhbHBoYUI7IGcgKz0gZGF0YUJbaUIrMV0gKiBhbHBoYUI7IGIgKz0gZGF0YUJbaUIrMl0gKiBhbHBoYUI7IGEgKz0gKGRhdGFCW2lCKzNdLzI1NSkgKiBhbHBoYUI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgZmluYWxBbHBoYSA9IE1hdGgubWluKDEsIGEpOwogICAgICAgICAgICAgICAgaWYgKGZpbmFsQWxwaGEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQociAvIGZpbmFsQWxwaGEpOyBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyAvIGZpbmFsQWxwaGEpOyBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYiAvIGZpbmFsQWxwaGEpOyBvdXRwdXREYXRhW2kgKyAzXSA9IE1hdGgucm91bmQoZmluYWxBbHBoYSAqIDI1NSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgeyBvdXRwdXREYXRhW2ldID0gMDsgb3V0cHV0RGF0YVtpICsgMV0gPSAwOyBvdXRwdXREYXRhW2kgKyAyXSA9IDA7IG91dHB1dERhdGFbaSArIDNdID0gMDsgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiU2NoYWFsICYgUm90YXRpZSAoWm9vbS1EcmFhaSkiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgoKCgoKQU5JTUFUSU9OX0xPR0lDWzk1XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogNDAwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsIAogICAgICAgIHBhbGV0dGVBOiBbXSwgICAgICAgIC8vIDExIEtsZXVyZW4gUGFsZXQgQQogICAgICAgIHBhbGV0dGVCOiBbXSwgICAgICAgIC8vIDExIEtsZXVyZW4gUGFsZXQgQgogICAgICAgIGF2Z0NvbG9yQTogWzAsIDAsIDBdLCAvLyBHZW1pZGRlbGRlIGtsZXVyIEEKICAgICAgICBhdmdDb2xvckI6IFswLCAwLCAwXSwgLy8gR2VtaWRkZWxkZSBrbGV1ciBCCiAgICAgICAgcGl4ZWxNYXA6IG51bGwgICAgICAgLy8gQ2FjaGUgdm9vciBkZSBnZXBhbGV0dGlzZWVyZGUgZW4gZ2VtYXB0ZSBwaXhlbHMgdmFuIEEKICAgIH07CiAgICBjb25zdCBOVU1fQ09MT1JTID0gMTE7CiAgICBjb25zdCBIQUxGX1dBWV9GUkFNRSA9IDIwMDsgCiAgICAKICAgIC8vIC0tLSBGVU5DVElFUzogUGxhYXRzIGhvdWRlcnMgdm9vciBkZSBjb21wbGV4ZSBzdGFwcGVuIC0tLQoKCgovKioKICogQmVyZWtlbnQgZGUgZ2VtaWRkZWxkZSBrbGV1ciB2YW4gYWxsZSBwaXhlbHMgaW4gZGUgYWZiZWVsZGluZy4KICogQHBhcmFtIHtJbWFnZURhdGF9IGltYWdlRGF0YSBIZXQgQ2FudmFzIEltYWdlRGF0YSBvYmplY3QuCiAqIEByZXR1cm5zIHtudW1iZXJbXX0gW1IsIEcsIEJdIGFycmF5IHZhbiBkZSBnZW1pZGRlbGRlIGtsZXVyLgogKi8KZnVuY3Rpb24gY2FsY3VsYXRlQXZlcmFnZUNvbG9yKGltYWdlRGF0YSkgewogICAgY29uc3QgZGF0YSA9IGltYWdlRGF0YS5kYXRhOwogICAgbGV0IHJTdW0gPSAwLCBnU3VtID0gMCwgYlN1bSA9IDA7CiAgICBsZXQgcGl4ZWxDb3VudCA9IDA7CgogICAgLy8gTG9vcCBvdmVyIGRlIHBpeGVsZGF0YSAoUiwgRywgQiwgQSkKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgIHJTdW0gKz0gZGF0YVtpXTsKICAgICAgICBnU3VtICs9IGRhdGFbaSArIDFdOwogICAgICAgIGJTdW0gKz0gZGF0YVtpICsgMl07CiAgICAgICAgcGl4ZWxDb3VudCsrOwogICAgfQoKICAgIGlmIChwaXhlbENvdW50ID09PSAwKSB7CiAgICAgICAgcmV0dXJuIFswLCAwLCAwXTsKICAgIH0KCiAgICAvLyBCZXJla2VuIGhldCBnZW1pZGRlbGRlIGVuIHJvbmQgYWYKICAgIGNvbnN0IHJBdmcgPSBNYXRoLnJvdW5kKHJTdW0gLyBwaXhlbENvdW50KTsKICAgIGNvbnN0IGdBdmcgPSBNYXRoLnJvdW5kKGdTdW0gLyBwaXhlbENvdW50KTsKICAgIGNvbnN0IGJBdmcgPSBNYXRoLnJvdW5kKGJTdW0gLyBwaXhlbENvdW50KTsKCiAgICByZXR1cm4gW3JBdmcsIGdBdmcsIGJBdmddOwp9CgoKLyoqCiAqIFZpbmR0IGRlIGRpY2h0c3RiaWp6aWpuZGUga2xldXIgaW4gZWVuIHBhbGV0IG1ldCBiZWh1bHAgdmFuIEV1Y2xpZGlzY2hlIGFmc3RhbmQuCiAqIEBwYXJhbSB7bnVtYmVyW119IHJnYkNvbG9yIFtSLCBHLCBCXSB2YW4gZGUga2xldXIgZGllIGdlbWFwdCBtb2V0IHdvcmRlbi4KICogQHBhcmFtIHtudW1iZXJbXVtdfSBwYWxldHRlIEFycmF5IHZhbiBbUiwgRywgQl0ga2xldXJlbiBpbiBoZXQgcGFsZXQuCiAqIEByZXR1cm5zIHtudW1iZXJbXX0gRGUgW1IsIEcsIEJdIGFycmF5IHZhbiBkZSBkaWNodHN0YmlqemlqbmRlIGtsZXVyLgogKi8KZnVuY3Rpb24gZmluZE5lYXJlc3RDb2xvcihyZ2JDb2xvciwgcGFsZXR0ZSkgewogICAgaWYgKHBhbGV0dGUubGVuZ3RoID09PSAwKSByZXR1cm4gWzAsIDAsIDBdOwoKICAgIGxldCBtaW5EaXN0YW5jZVNxID0gSW5maW5pdHk7CiAgICBsZXQgbmVhcmVzdENvbG9yID0gcGFsZXR0ZVswXTsKCiAgICBjb25zdCByMSA9IHJnYkNvbG9yWzBdLCBnMSA9IHJnYkNvbG9yWzFdLCBiMSA9IHJnYkNvbG9yWzJdOwoKICAgIGZvciAoY29uc3QgY29sb3Igb2YgcGFsZXR0ZSkgewogICAgICAgIGNvbnN0IHIyID0gY29sb3JbMF0sIGcyID0gY29sb3JbMV0sIGIyID0gY29sb3JbMl07CgogICAgICAgIC8vIEJlcmVrZW4gaGV0IGt3YWRyYWF0IHZhbiBkZSBFdWNsaWRpc2NoZSBhZnN0YW5kOiAocjEtcjIpXjIgKyAoZzEtZzIpXjIgKyAoYjEtYjIpXjIKICAgICAgICAvLyBXZSBnZWJydWlrZW4gaGV0IGt3YWRyYWF0IG9tIGRlIGR1cmUgTWF0aC5zcXJ0KCkgdGUgdmVybWlqZGVuCiAgICAgICAgY29uc3QgZGlzdGFuY2VTcSA9IChyMSAtIHIyKSAqKiAyICsgKGcxIC0gZzIpICoqIDIgKyAoYjEgLSBiMikgKiogMjsKCiAgICAgICAgaWYgKGRpc3RhbmNlU3EgPCBtaW5EaXN0YW5jZVNxKSB7CiAgICAgICAgICAgIG1pbkRpc3RhbmNlU3EgPSBkaXN0YW5jZVNxOwogICAgICAgICAgICBuZWFyZXN0Q29sb3IgPSBjb2xvcjsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIG5lYXJlc3RDb2xvcjsKfQoKCi8qKgogKiBHZW5lcmVlcnQgZWVuIHBhbGV0IHZhbiBkb21pbmFudGUga2xldXJlbiBtZXQgYmVodWxwIHZhbiBlZW4gdmVyZWVudm91ZGlnZGUga3dhbnRpc2F0aWUuCiAqIERpdCBpcyBlZW4gdmVyZWVudm91ZGlnaW5nIHZhbiBnZWF2YW5jZWVyZGUgYWxnb3JpdG1lcyAoSy1NZWFucy9PY3RyZWUpLgogKiBAcGFyYW0ge0ltYWdlRGF0YX0gaW1hZ2VEYXRhIEhldCBDYW52YXMgSW1hZ2VEYXRhIG9iamVjdC4KICogQHBhcmFtIHtudW1iZXJ9IG51bUNvbG9ycyBIZXQgZ2V3ZW5zdGUgYWFudGFsIGtsZXVyZW4gKGJpanYuIDExKS4KICogQHJldHVybnMge251bWJlcltdW119IEVlbiBhcnJheSB2YW4gW1IsIEcsIEJdIGtsZXVyZW4gZGllIGhldCBwYWxldCB2b3JtZW4uCiAqLwpmdW5jdGlvbiBnZXRQYWxldHRlKGltYWdlRGF0YSwgbnVtQ29sb3JzKSB7CiAgICBjb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7CiAgICBjb25zdCBjb2xvckZyZXF1ZW5jeSA9IG5ldyBNYXAoKTsKICAgIGNvbnN0IHN0ZXAgPSAzMjsgLy8gVmVyZGVlbCAyNTYga2xldXJ3YWFyZGVuIGluIDggc3RhcHBlbiAoMjU2LzMyKQoKICAgIC8vIDEuIFZlcnphbWVsIGRlIGZyZXF1ZW50aWUgdmFuIGdla3dhbnRpc2VlcmRlIGtsZXVyZW4gKCdidWNrZXRzJykKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgIC8vIFF1YW50aXNlZXIgZWxrZSBjb21wb25lbnQgbmFhciBkZSBkaWNodHN0YmlqemlqbmRlICdidWNrZXQnICh2ZWVsdm91ZGVuIHZhbiAzMikKICAgICAgICBjb25zdCBxciA9IE1hdGguZmxvb3IoZGF0YVtpXSAvIHN0ZXApICogc3RlcDsKICAgICAgICBjb25zdCBxZyA9IE1hdGguZmxvb3IoZGF0YVtpICsgMV0gLyBzdGVwKSAqIHN0ZXA7CiAgICAgICAgY29uc3QgcWIgPSBNYXRoLmZsb29yKGRhdGFbaSArIDJdIC8gc3RlcCkgKiBzdGVwOwogICAgICAgIAogICAgICAgIC8vIERlIGdla3dhbnRpc2VlcmRlIGtsZXVyIChzdHJpbmctc2xldXRlbCkKICAgICAgICBjb25zdCBrZXkgPSBgJHtxcn0sJHtxZ30sJHtxYn1gOwogICAgICAgIAogICAgICAgIC8vIFRlbCBkZSBmcmVxdWVudGllCiAgICAgICAgY29sb3JGcmVxdWVuY3kuc2V0KGtleSwgKGNvbG9yRnJlcXVlbmN5LmdldChrZXkpIHx8IDApICsgMSk7CiAgICB9CgogICAgLy8gMi4gU29ydGVlciBkZSAnYnVja2V0cycgb3AgZnJlcXVlbnRpZQogICAgY29uc3Qgc29ydGVkRnJlcXVlbmNpZXMgPSBBcnJheS5mcm9tKGNvbG9yRnJlcXVlbmN5LmVudHJpZXMoKSkKICAgICAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pOyAvLyBTb3J0ZWVyIGFmbG9wZW5kIG9wIGZyZXF1ZW50aWUKCiAgICAvLyAzLiBTZWxlY3RlZXIgZGUgdG9waG9ldmVlbGhlaWQgZW4gY29udmVydGVlciBkZSBzbGV1dGVsIHRlcnVnIG5hYXIgZWVuIGtsZXVyYXJyYXkKICAgIGNvbnN0IHBhbGV0dGUgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5taW4obnVtQ29sb3JzLCBzb3J0ZWRGcmVxdWVuY2llcy5sZW5ndGgpOyBpKyspIHsKICAgICAgICBjb25zdCBrZXkgPSBzb3J0ZWRGcmVxdWVuY2llc1tpXVswXTsKICAgICAgICBjb25zdCBjb2xvciA9IGtleS5zcGxpdCgnLCcpLm1hcChOdW1iZXIpOyAvLyBbcXIsIHFnLCBxYl0KICAgICAgICAKICAgICAgICAvLyBHZWJydWlrIGhldCBtaWRkZW4gdmFuIGRlICdidWNrZXQnIHZvb3IgZWVuIGJldGVyZSBrbGV1cnJlcHJlc2VudGF0aWUKICAgICAgICBwYWxldHRlLnB1c2goW2NvbG9yWzBdICsgc3RlcCAvIDIsIGNvbG9yWzFdICsgc3RlcCAvIDIsIGNvbG9yWzJdICsgc3RlcCAvIDJdLm1hcChNYXRoLnJvdW5kKSk7CiAgICB9CiAgICAKICAgIC8vIFpvcmcgZXJ2b29yIGRhdCBlciBhbHRpamQgbnVtQ29sb3JzIHdvcmRlbiBnZXJldG91cm5lZXJkICh2dWwgYWFuIG1ldCBkZSB0b3BrbGV1ciBpbmRpZW4gbm9kaWcpCiAgICB3aGlsZSAocGFsZXR0ZS5sZW5ndGggPCBudW1Db2xvcnMpIHsKICAgICAgICBpZiAocGFsZXR0ZS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHBhbGV0dGUucHVzaChbLi4ucGFsZXR0ZVswXV0pOyAvLyBLb3BpZWVyIGRlIGRvbWluYW50ZSBrbGV1cgogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBhbGV0dGUucHVzaChbMCwgMCwgMF0pOyAvLyBWdWwgYWFuIG1ldCB6d2FydCBhbHMgZGUgYWZiZWVsZGluZyBsZWVnIGlzCiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBwYWxldHRlOwp9CiAgICAKICAgIC8vIExpbmVhaXJlIGludGVycG9sYXRpZQogICAgZnVuY3Rpb24gbGVycChhLCBiLCB0KSB7CiAgICAgICAgcmV0dXJuIGEgKyAoYiAtIGEpICogdDsKICAgIH0KICAgIAogICAgLy8gLS0tIElOSVRJw4tMRSBBTkFMWVNFIC0tLQoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICAKICAgICAgICAvLyBBYW5uYW1lOiBpbWFnZURhdGFBX2Z1bGwgZW4gaW1hZ2VEYXRhQl9mdWxsIHppam4gQ2FudmFzSW1hZ2VEYXRhIG9iamVjdGVuCiAgICAgICAgY29uc3QgaW1hZ2VEYXRhQV9mdWxsID0gY3R4LmdldEltYWdlRGF0YSgwLDAsV0lEVEgsSEVJR0hUKTsKICAgICAgICBjb25zdCBpbWFnZURhdGFCX2Z1bGwgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCxXSURUSCxIRUlHSFQpOyAKICAgICAgICBjb25zdCBkYXRhQSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpLmRhdGE7CgogICAgICAgIC8vIDEuIEtsZXVyYW5hbHlzZQogICAgICAgIHVuaXF1ZVN0YXRlLnBhbGV0dGVBID0gZ2V0UGFsZXR0ZShpbWFnZURhdGFBX2Z1bGwsIE5VTV9DT0xPUlMpOwogICAgICAgIHVuaXF1ZVN0YXRlLnBhbGV0dGVCID0gZ2V0UGFsZXR0ZShpbWFnZURhdGFCX2Z1bGwsIE5VTV9DT0xPUlMpOwogICAgICAgIHVuaXF1ZVN0YXRlLmF2Z0NvbG9yQSA9IGNhbGN1bGF0ZUF2ZXJhZ2VDb2xvcihpbWFnZURhdGFBX2Z1bGwpOwogICAgICAgIHVuaXF1ZVN0YXRlLmF2Z0NvbG9yQiA9IGNhbGN1bGF0ZUF2ZXJhZ2VDb2xvcihpbWFnZURhdGFCX2Z1bGwpOwoKICAgICAgICAvLyAyLiBJbml0aWFsaXNlZXIgZGUgUGl4ZWwgTWFwIChEZSBicm9uIHZhbiBhbGxlIGJld2VnaW5nKQogICAgICAgIC8vIERlemUgc3RydWN0dXVyIG1vZXQgdm9vciBlbGtlIHBpeGVsIGluIGhldCBiZWVsZCBiZXBhbGVuOgogICAgICAgIC8vIHsgeCwgeSwgciwgZywgYiwgYSwgbWFwcGVkQ29sb3JWZWN0b3IgfQogICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVsTWFwID0gbmV3IEFycmF5KFdJRFRIICogSEVJR0hUKTsKICAgICAgICAKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICBjb25zdCByID0gZGF0YUFbaV0sIGcgPSBkYXRhQVtpICsgMV0sIGIgPSBkYXRhQVtpICsgMl0sIGEgPSBkYXRhQVtpICsgM107CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFZpbmQgZGUgMTEta2xldXJlbiBwYWxldGtsZXVyIHZvb3IgZGV6ZSBwaXhlbAogICAgICAgICAgICAgICAgY29uc3QgbWFwcGVkQ29sb3IgPSBmaW5kTmVhcmVzdENvbG9yKFtyLCBnLCBiXSwgdW5pcXVlU3RhdGUucGFsZXR0ZUEpOwoKICAgICAgICAgICAgICAgIC8vIFJHQiAtPiBWZWN0b3IgbWFwcGluZzogW1I9Rm9yY2VYLCBHPUZvcmNlWSwgQj1WZWxvY2l0eS9NYXhTaGlmdF0KICAgICAgICAgICAgICAgIC8vIE5vcm1hbGlzZWVyIGRlIGtsZXVyY29tcG9uZW50ZW4gKDAtMjU1KSBuYWFyIGVlbiBicnVpa2JhcmUgdmVjdG9yZ3Jvb3R0ZQogICAgICAgICAgICAgICAgY29uc3QgbWF4U2hpZnQgPSBNYXRoLm1heChXSURUSCwgSEVJR0hUKTsgLy8gTWF4aW1hbGUgdmVyc2NodWl2aW5nID0gZ3Jvb3RzdGUgZGltZW5zaWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgZm9yY2VYID0gKG1hcHBlZENvbG9yWzBdIC8gMjU1LjApICogbWF4U2hpZnQ7IC8vIE1heCBYIHNoaWZ0CiAgICAgICAgICAgICAgICBjb25zdCBmb3JjZVkgPSAobWFwcGVkQ29sb3JbMV0gLyAyNTUuMCkgKiBtYXhTaGlmdDsgLy8gTWF4IFkgc2hpZnQKICAgICAgICAgICAgICAgIGNvbnN0IHZlbG9jaXR5ID0gKG1hcHBlZENvbG9yWzJdIC8gMjU1LjApOyAvLyBCZXBhYWx0IGRlIHRvdGFsZSBhZmdlbGVnZGUgYWZzdGFuZAoKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpeGVsTWFwW3kgKiBXSURUSCArIHhdID0gewogICAgICAgICAgICAgICAgICAgIHNyY1g6IHgsIAogICAgICAgICAgICAgICAgICAgIHNyY1k6IHksIAogICAgICAgICAgICAgICAgICAgIGNvbG9yOiBbciwgZywgYiwgYV0sCiAgICAgICAgICAgICAgICAgICAgLy8gRGUgdmVjdG9yIGJlcGFhbHQgaG9lIHZlciBlbiBpbiB3ZWxrZSByaWNodGluZyBkZSBwaXhlbCBiZXdlZWd0CiAgICAgICAgICAgICAgICAgICAgdmVjdG9yWDogZm9yY2VYICogdmVsb2NpdHksCiAgICAgICAgICAgICAgICAgICAgdmVjdG9yWTogZm9yY2VZICogdmVsb2NpdHkKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gLS0tIEFOSU1BVElFIExPR0lDQSAtLS0KCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgCiAgICAgICAgCiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwoKICAgICAgICAvLyBCZXBhYWwgZGUgYWNodGVyZ3JvbmRrbGV1ciAoR2VtaWRkZWxkZSBrbGV1ciBBIGluIGZhc2UgMSwgR2VtaWRkZWxkZSBrbGV1ciBCIGluIGZhc2UgMikKICAgICAgICBjb25zdCBiZ0NvbG9yID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgSEFMRl9XQVlfRlJBTUUgPyB1bmlxdWVTdGF0ZS5hdmdDb2xvckEgOiB1bmlxdWVTdGF0ZS5hdmdDb2xvckI7CiAgICAgICAgCiAgICAgICAgLy8gVnVsIGRlIG91dHB1dCBtZXQgZGUgZ2VtaWRkZWxkZSBhY2h0ZXJncm9uZGtsZXVyCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBXSURUSCAqIEhFSUdIVCAqIDQ7IGkgKz0gNCkgewogICAgICAgICAgICBvdXRwdXREYXRhW2ldID0gYmdDb2xvclswXTsKICAgICAgICAgICAgb3V0cHV0RGF0YVtpICsgMV0gPSBiZ0NvbG9yWzFdOwogICAgICAgICAgICBvdXRwdXREYXRhW2kgKyAyXSA9IGJnQ29sb3JbMl07CiAgICAgICAgICAgIG91dHB1dERhdGFbaSArIDNdID0gMjU1OwogICAgICAgIH0KCiAgICAgICAgLy8gLS0tIEZBU0UgMTogREVTSU5URUdSQVRJRSAoMCB0b3QgNTApIC0tLQogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCBIQUxGX1dBWV9GUkFNRSkgewogICAgICAgICAgICBjb25zdCBwaGFzZVByb2dyZXNzID0gZWFzZWRQcm9ncmVzcyAqIDI7IC8vIExvb3B0IHZhbiAwIHRvdCAxCiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSkuZGF0YTsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBMb29wIG92ZXIgZGUgcGl4ZWwgTWFwIChnZWJhc2VlcmQgb3AgQWZiZWVsZGluZyBBKQogICAgICAgICAgICBmb3IgKGxldCBpZHggPSAwOyBpZHggPCB1bmlxdWVTdGF0ZS5waXhlbE1hcC5sZW5ndGg7IGlkeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwaXhlbCA9IHVuaXF1ZVN0YXRlLnBpeGVsTWFwW2lkeF07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJlcmVrZW4gZGUgaHVpZGlnZSB2ZXJzY2h1aXZpbmcKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTaGlmdFggPSBwaXhlbC52ZWN0b3JYICogcGhhc2VQcm9ncmVzczsKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTaGlmdFkgPSBwaXhlbC52ZWN0b3JZICogcGhhc2VQcm9ncmVzczsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmVwYWFsIGRlIG5pZXV3ZSBwb3NpdGllCiAgICAgICAgICAgICAgICBjb25zdCBkZXN0WCA9IE1hdGgucm91bmQocGl4ZWwuc3JjWCArIGN1cnJlbnRTaGlmdFgpOwogICAgICAgICAgICAgICAgY29uc3QgZGVzdFkgPSBNYXRoLnJvdW5kKHBpeGVsLnNyY1kgKyBjdXJyZW50U2hpZnRZKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGVrZW4gZGUgcGl4ZWwgb3AgZGUgbmlldXdlIHBvc2l0aWUKICAgICAgICAgICAgICAgIGlmIChkZXN0WCA+PSAwICYmIGRlc3RYIDwgV0lEVEggJiYgZGVzdFkgPj0gMCAmJiBkZXN0WSA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dElkeCA9IChkZXN0WSAqIFdJRFRIICsgZGVzdFgpICogNDsKICAgICAgICAgICAgICAgICAgICAvLyBHZWJydWlrIGRlIG9yaWdpbmVsZSBrbGV1ciB2YW4gZGUgYnJvbnBpeGVsCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtvdXRwdXRJZHhdICAgICA9IHBpeGVsLmNvbG9yWzBdOwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbb3V0cHV0SWR4ICsgMV0gPSBwaXhlbC5jb2xvclsxXTsKICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW291dHB1dElkeCArIDJdID0gcGl4ZWwuY29sb3JbMl07CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgLy8gQWxwaGEtZmFkZSBpcyBvcHRpb25lZWwsIG1hYXIgd2UgbGF0ZW4gZGUgYWxwaGEgaG9vZwogICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbb3V0cHV0SWR4ICsgM10gPSBwaXhlbC5jb2xvclszXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gCiAgICAgICAgLy8gLS0tIEZBU0UgMjogUkVDT05TVFJVQ1RJRSAoNTAgdG90IDEwMCkgLS0tCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHBoYXNlUHJvZ3Jlc3MgPSAoZWFzZWRQcm9ncmVzcyAtIDAuNSkgKiAyOyAvLyBMb29wdCB2YW4gMCB0b3QgMQogICAgICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGUgb21nZWtlZXJkZSBiZXdlZ2luZyB2ZXJlaXN0IGRhdCB3ZSBkZSBwaXhlbHMgdmFuIEFmYmVlbGRpbmcgQiBiaW5uZW56dWlnZW4uCiAgICAgICAgICAgIC8vIEhpZXJ2b29yIG1vZXRlbiB3ZSBlZW4gUGl4ZWwgTWFwIHZvb3IgQiBtYWtlbiAob2YgZGUgQi1kYXRhIGluIHJlYWwtdGltZSB2ZXJ3ZXJrZW4pLgogICAgICAgICAgICAvLyBMYXRlbiB3ZSBkZSBCLWRhdGEgaW4gcmVhbC10aW1lIHZlcndlcmtlbiwgZ2ViYXNlZXJkIG9wIGRlIEEtbWFwcGluZy4KICAgICAgICAgICAgCiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgSEVJR0hUOyB5KyspIHsKICAgICAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IHNyY0lkeCA9IHkgKiBXSURUSCArIHg7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaSA9IHNyY0lkeCAqIDQ7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IGRhdGFCW2ldLCBnID0gZGF0YUJbaSArIDFdLCBiID0gZGF0YUJbaSArIDJdLCBhID0gZGF0YUJbaSArIDNdOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDEuIFZpbmQgZGUgcGFsZXRrbGV1ciBlbiBkZSBiaWpiZWhvcmVuZGUgdmVjdG9yIHZvb3IgQWZiZWVsZGluZyBCCiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWFwcGVkQ29sb3IgPSBmaW5kTmVhcmVzdENvbG9yKFtyLCBnLCBiXSwgdW5pcXVlU3RhdGUucGFsZXR0ZUIpOwoKICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhTaGlmdCA9IE1hdGgubWF4KFdJRFRILCBIRUlHSFQpOyAKICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JjZVggPSAobWFwcGVkQ29sb3JbMF0gLyAyNTUuMCkgKiBtYXhTaGlmdDsgCiAgICAgICAgICAgICAgICAgICAgY29uc3QgZm9yY2VZID0gKG1hcHBlZENvbG9yWzFdIC8gMjU1LjApICogbWF4U2hpZnQ7IAogICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlbG9jaXR5ID0gKG1hcHBlZENvbG9yWzJdIC8gMjU1LjApOyAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZWN0b3JYID0gZm9yY2VYICogdmVsb2NpdHk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVjdG9yWSA9IGZvcmNlWSAqIHZlbG9jaXR5OwoKICAgICAgICAgICAgICAgICAgICAvLyAyLiBEZSBwaXhlbHMgdmFuIEIgbW9ldGVuIHZhbiBkZSBidWl0ZW5rYW50IG5hYXIgZGUgc3RhcnRwb3NpdGllICh4LCB5KSBiZXdlZ2VuLgogICAgICAgICAgICAgICAgICAgIC8vIERlIHZlcnNjaHVpdmluZyBuZWVtdCBhZiB2YW4gMS4wIG5hYXIgMC4wCiAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFNoaWZ0WCA9IHZlY3RvclggKiAoMSAtIHBoYXNlUHJvZ3Jlc3MpOwogICAgICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTaGlmdFkgPSB2ZWN0b3JZICogKDEgLSBwaGFzZVByb2dyZXNzKTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAvLyAzLiBEZSBzdGFydHBvc2l0aWUgbGlndCBidWl0ZW4gYmVlbGQsIHdlIGJld2VnZW4gbmFhciBkZSBkb2VscG9zaXRpZSAoeCwgeSkKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydFhfb3V0ID0geCArIHZlY3Rvclg7IC8vIEJlcGFhbGRlIHN0YXJ0cHVudCBidWl0ZW4gYmVlbGQKICAgICAgICAgICAgICAgICAgICBjb25zdCBzdGFydFlfb3V0ID0geSArIHZlY3Rvclk7IAoKICAgICAgICAgICAgICAgICAgICAvLyBOaWV1d2UgcG9zaXRpZTogYmV3ZWVnIHZhbiBzdGFydFhfb3V0IG5hYXIgWCAoZG9lbCkKICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXN0WCA9IE1hdGgucm91bmQobGVycChzdGFydFhfb3V0LCB4LCBwaGFzZVByb2dyZXNzKSk7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVzdFkgPSBNYXRoLnJvdW5kKGxlcnAoc3RhcnRZX291dCwgeSwgcGhhc2VQcm9ncmVzcykpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC8vIDQuIFRla2VuIGRlIHBpeGVsIG9wIGRlIG5pZXV3ZSBwb3NpdGllCiAgICAgICAgICAgICAgICAgICAgaWYgKGRlc3RYID49IDAgJiYgZGVzdFggPCBXSURUSCAmJiBkZXN0WSA+PSAwICYmIGRlc3RZIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG91dHB1dElkeCA9IChkZXN0WSAqIFdJRFRIICsgZGVzdFgpICogNDsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtvdXRwdXRJZHhdICAgICA9IHI7CiAgICAgICAgICAgICAgICAgICAgICAgIG91dHB1dERhdGFbb3V0cHV0SWR4ICsgMV0gPSBnOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXREYXRhW291dHB1dElkeCArIDJdID0gYjsKICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtvdXRwdXRJZHggKyAzXSA9IGE7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICAgIAogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiB7IHRpdGxlOiAiUkdCLVZlY3RvciBQaXhlbCBEaXNwZXJzaWUiLCBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlIH07Cn0pKCk7CgoKCgpBTklNQVRJT05fTE9HSUNbMTAzXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTAwLCBjdXJyZW50RnJhbWU6IDAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFByb2dyZXNzID0gZWFzZUluT3V0UXVpbnQocHJvZ3Jlc3MpOwogICAgICAgIGNvbnN0IG91dHB1dEltYWdlRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEoV0lEVEgsIEhFSUdIVCk7IAogICAgICAgIGNvbnN0IG91dHB1dERhdGEgPSBvdXRwdXRJbWFnZURhdGEuZGF0YTsgCiAgICAgICAgY29uc3QgZGF0YUEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKS5kYXRhOyAKICAgICAgICBjb25zdCBkYXRhQiA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpLmRhdGE7ICAgCgogICAgICAgIC8vIEhvcml6b250YWxlIFRyYW5zbGF0aWUKICAgICAgICBjb25zdCBtYXhTaGlmdCA9IFdJRFRIOwogICAgICAgIGNvbnN0IHNoaWZ0WF9BID0gbWF4U2hpZnQgKiBlYXNlZFByb2dyZXNzOwogICAgICAgIGNvbnN0IHNoaWZ0WF9CID0gbWF4U2hpZnQgKiAoMSAtIGVhc2VkUHJvZ3Jlc3MpOwoKICAgICAgICAvLyBWZXJ0aWNhbGUgU2NoZWVmdHJla2tpbmcgKFNrZXcgWSkKICAgICAgICBjb25zdCBtYXhTa2V3ID0gMC41OwogICAgICAgIC8vIFNrZXcgaXMgbWF4aW1hYWwgaW4gaGV0IG1pZGRlbiAoc2ltdWxlZXJ0IGRlIHppamthbnQgdmFuIGRlIGthYXJ0KQogICAgICAgIGNvbnN0IHNrZXdGYWN0b3IgPSBtYXhTa2V3ICogTWF0aC5zaW4oTWF0aC5QSSAqIGVhc2VkUHJvZ3Jlc3MpOyAKCiAgICAgICAgY29uc3QgY2VudGVyWCA9IFdJRFRIIC8gMjsKICAgICAgICAKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IEhFSUdIVDsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgV0lEVEg7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgaSA9ICh5ICogV0lEVEggKyB4KSAqIDQ7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEludmVyc2UgVHJhbnNsYXRpZQogICAgICAgICAgICAgICAgY29uc3QgcHJlU2tld1hfQSA9IHggLSBzaGlmdFhfQTsKICAgICAgICAgICAgICAgIGNvbnN0IHByZVNrZXdYX0IgPSB4IC0gc2hpZnRYX0I7CgogICAgICAgICAgICAgICAgLy8gSW52ZXJzZSBZLVNrZXcgKFNrZXcgeSA9IHNrZXdGYWN0b3IgKiB4KQogICAgICAgICAgICAgICAgY29uc3Qgc3JjWF9BID0gTWF0aC5yb3VuZChwcmVTa2V3WF9BKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNyY1lfQSA9IE1hdGgucm91bmQoeSAtIChza2V3RmFjdG9yICogKHByZVNrZXdYX0EgLSBjZW50ZXJYKSkpOwoKICAgICAgICAgICAgICAgIGNvbnN0IHNyY1hfQiA9IE1hdGgucm91bmQocHJlU2tld1hfQik7CiAgICAgICAgICAgICAgICBjb25zdCBzcmNZX0IgPSBNYXRoLnJvdW5kKHkgLSAoc2tld0ZhY3RvciAqIChwcmVTa2V3WF9CIC0gY2VudGVyWCkpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYWxwaGFBID0gMSAtIGVhc2VkUHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYUIgPSBlYXNlZFByb2dyZXNzOwogICAgICAgICAgICAgICAgbGV0IHIgPSAwLCBnID0gMCwgYiA9IDAsIGEgPSAwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyAuLi4gKFBpeGVsIG9waGFsZW4gZW4gQmxlbmRlbiBsb2dpY2EgLSBhbmFsb29nIGFhbiAjOTgpIC4uLgogICAgICAgICAgICAgICAgaWYgKGFscGhhQSA+IDAuMDEgJiYgc3JjWF9BID49IDAgJiYgc3JjWF9BIDwgV0lEVEggJiYgc3JjWV9BID49IDAgJiYgc3JjWV9BIDwgSEVJR0hUKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaUEgPSAoc3JjWV9BICogV0lEVEggKyBzcmNYX0EpICogNDsKICAgICAgICAgICAgICAgICAgICByICs9IGRhdGFBW2lBXSAqIGFscGhhQTsgZyArPSBkYXRhQVtpQSsxXSAqIGFscGhhQTsgYiArPSBkYXRhQVtpQSsyXSAqIGFscGhhQTsgYSArPSAoZGF0YUFbaUErM10vMjU1KSAqIGFscGhhQTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhbHBoYUIgPiAwLjAxICYmIHNyY1hfQiA+PSAwICYmIHNyY1hfQiA8IFdJRFRIICYmIHNyY1lfQiA+PSAwICYmIHNyY1lfQiA8IEhFSUdIVCkgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGlCID0gKHNyY1lfQiAqIFdJRFRIICsgc3JjWF9CKSAqIDQ7CiAgICAgICAgICAgICAgICAgICAgciArPSBkYXRhQltpQl0gKiBhbHBoYUI7IGcgKz0gZGF0YUJbaUIrMV0gKiBhbHBoYUI7IGIgKz0gZGF0YUJbaUIrMl0gKiBhbHBoYUI7IGEgKz0gKGRhdGFCW2lCKzNdLzI1NSkgKiBhbHBoYUI7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY29uc3QgZmluYWxBbHBoYSA9IE1hdGgubWluKDEsIGEpOwogICAgICAgICAgICAgICAgaWYgKGZpbmFsQWxwaGEgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0RGF0YVtpXSA9IE1hdGgucm91bmQociAvIGZpbmFsQWxwaGEpOyBvdXRwdXREYXRhW2kgKyAxXSA9IE1hdGgucm91bmQoZyAvIGZpbmFsQWxwaGEpOyBvdXRwdXREYXRhW2kgKyAyXSA9IE1hdGgucm91bmQoYiAvIGZpbmFsQWxwaGEpOyBvdXRwdXREYXRhW2kgKyAzXSA9IE1hdGgucm91bmQoZmluYWxBbHBoYSAqIDI1NSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgeyBvdXRwdXREYXRhW2ldID0gMDsgb3V0cHV0RGF0YVtpICsgMV0gPSAwOyBvdXRwdXREYXRhW2kgKyAyXSA9IDA7IG91dHB1dERhdGFbaSArIDNdID0gMDsgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGN0eC5wdXRJbWFnZURhdGEob3V0cHV0SW1hZ2VEYXRhLCAwLCAwKTsgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICBlbHNlIHRyYW5zaXRpb25FbmQobmV4dEltYWdlKTsKICAgIH0KICAgIHJldHVybiB7IHRpdGxlOiAiVHJhbnNsYXRpZSAmIFNjaGVlZnRyZWtraW5nIChLYWFydCBGbGlwKSIsIGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUgfTsKfSkoKTsKCgoKCgoKCgoKCgoKCgoKCgoKICAgIC8vIC0tLSBJbml0aWFsIFNldHVwIGFuZCBTdGFydCAtLS0KICAgIG9ubG9hZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhbmltYXRpb25DYW52YXMnKTsKICAgICAgICBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgICAgLy8gRW5zdXJlIHRoZSBnbG9iYWwgQU5JTUFUSU9OX0lOREVYIGlzIGEgdmFsaWQgc3RhcnRpbmcgaW5kZXgKICAgICAgICBpZiAoQU5JTUFUSU9OX0xPR0lDW0FOSU1BVElPTl9JTkRFWCAlIFRPVEFMX0FOSU1BVElPTlNdKSB7CiAgICAgICAgICAgLy8gUmVxdWVzdCB0aGUgZmlyc3QgdHdvIGltYWdlcyAoQSBhbmQgQikgdG8gc3RhcnQgdGhlIGxvb3AKICAgICAgICAgICByZXF1ZXN0UmFuZG9tKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgLy8gRmFsbGJhY2sgdG8gdGhlIGZpcnN0IGRlZmluZWQgYW5pbWF0aW9uIGlmIHRoZSBjaG9zZW4gc3RhcnQgaW5kZXggaXMgZW1wdHkKICAgICAgICAgICBBTklNQVRJT05fSU5ERVggPSAwOwogICAgICAgICAgIHJlcXVlc3RSYW5kb20oMCk7CiAgICAgICAgfQogICAgfTsKCgovKgoKLy8gLS0tIENPTU1PTiBVVElMSVRZIEZVTkNUSU9OUyAoUkVRVUlSRUQgRk9SIEFMTCBBTklNQVRJT05TKSAtLS0KCi8vIExpbmVhciBJbnRlcnBvbGF0aW9uCmNvbnN0IGxlcnAgPSAoYSwgYiwgdCkgPT4gYSArIChiIC0gYSkgKiB0OwoKLy8gUXVpbnRpYyBFYXNlIEluL091dCAoU3RhbmRhcmQgRWFzaW5nIEZ1bmN0aW9uKQpjb25zdCBlYXNlSW5PdXRRdWludCA9IHQgPT4gdCA8IDAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQ7CiovCi8vIEhlbHBlciB0byBkcmF3IHRoZSBpbWFnZSB0byBjb3ZlciB0aGUgY2FudmFzIChhZGFwdGVkIGZyb20gMDJfMzY0OS5odG1sKQovLyBUaGlzIGZ1bmN0aW9uIGNhbGN1bGF0ZXMgdGhlIGNvcnJlY3Qgc2NhbGUgYW5kIHBvc2l0aW9uIHRvIGVuc3VyZSB0aGUgaW1hZ2UgY292ZXJzIHRoZSBjYW52YXMgd2l0aG91dCBzdHJldGNoaW5nLgpmdW5jdGlvbiBkcmF3Q292ZXJJbWFnZShpbWcsIGN0eCwgY2FudmFzLCBhbHBoYSA9IDEpIHsKICAgIGlmICghaW1nKSByZXR1cm4geyB4OiAwLCB5OiAwLCB3OiAwLCBoOiAwIH07CiAgICBjb25zdCBjYW52YXNXaWR0aCA9IGNhbnZhcy53aWR0aDsKICAgIGNvbnN0IGNhbnZhc0hlaWdodCA9IGNhbnZhcy5oZWlnaHQ7CiAgICBjb25zdCBpbWdSYXRpbyA9IGltZy53aWR0aCAvIGltZy5oZWlnaHQ7CiAgICBjb25zdCBjYW52YXNSYXRpbyA9IGNhbnZhc1dpZHRoIC8gY2FudmFzSGVpZ2h0OwogICAgbGV0IGR4LCBkeSwgZHcsIGRoOwoKICAgIGlmIChpbWdSYXRpbyA+IGNhbnZhc1JhdGlvKSB7IC8vIEltYWdlIGlzIHdpZGVyIHRoYW4gY2FudmFzCiAgICAgICAgZGggPSBjYW52YXNIZWlnaHQ7CiAgICAgICAgZHcgPSBjYW52YXNIZWlnaHQgKiBpbWdSYXRpbzsKICAgICAgICBkeCA9IChjYW52YXNXaWR0aCAtIGR3KSAvIDI7CiAgICAgICAgZHkgPSAwOwogICAgfSBlbHNlIHsgLy8gSW1hZ2UgaXMgdGFsbGVyIG9yIHNhbWUgcmF0aW8KICAgICAgICBkdyA9IGNhbnZhc1dpZHRoOwogICAgICAgIGRoID0gY2FudmFzV2lkdGggLyBpbWdSYXRpbzsKICAgICAgICBkeCA9IDA7CiAgICAgICAgZHkgPSAoY2FudmFzSGVpZ2h0IC0gZGgpIC8gMjsKICAgIH0KCiAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTsKICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBpbWcud2lkdGgsIGltZy5oZWlnaHQsIGR4LCBkeSwgZHcsIGRoKTsKICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7IC8vIFJlc2V0IGFscGhhCiAgICByZXR1cm4geyB4OiBkeCwgeTogZHksIHc6IGR3LCBoOiBkaCB9Owp9CgovLyBQbGFjZWhvbGRlciBmb3IgcGl4ZWwgZGF0YSBmdW5jdGlvbnMgKGFzc3VtZWQgZ2xvYmFsbHkgZGVmaW5lZCBpbiB5b3VyIG9yaWdpbmFsIHNldHVwKQovLyBmdW5jdGlvbiBnZXRQaXhlbERhdGEoaW1nKSB7IC8qIC4uLiBpbXBsZW1lbnRhdGlvbiB0byBnZXQgSW1hZ2VEYXRhIC4uLiAqLyB9Ci8vIGZ1bmN0aW9uIHB1dEltYWdlRGF0YShpbWFnZURhdGEpIHsgLyogLi4uIGltcGxlbWVudGF0aW9uIHRvIHB1dCBJbWFnZURhdGEgLi4uICovIH0KCi8vIC0tLSBBTklNQVRJT04gTE9HSUMgU1RBUlRJTkcgRlJPTSBJTkRFWCAxMDIgLS0tCgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRVhUUkFDVEVEIEZST00gMDJfMzY0OS5odG1sICg3IEFuaW1hdGlvbnM6IDEwMi0xMDgpCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKLy8gLS0tIDEuIFZlcnRpY2FsIFdpcGUgU2xpZGUgKEluZGV4IDEwMikgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMDIwXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwLCBudW1TbGljZXM6IDIwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGltZ1Byb3BzMSA9IGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDApOyAvLyBHZXQgcHJvcGVydGllcwogICAgICAgIAogICAgICAgIGNvbnN0IHNsaWRlQW1vdW50ID0gZWFzZWRUICogaW1nUHJvcHMxLnc7CiAgICAgICAgY29uc3Qgc2xpY2VIZWlnaHQgPSBpbWdQcm9wczEuaCAvIHVuaXF1ZVN0YXRlLm51bVNsaWNlczsKCiAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7IC8vIERyYXcgSW1hZ2UgMiBmaXJzdAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVuaXF1ZVN0YXRlLm51bVNsaWNlczsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHlQb3MgPSBpbWdQcm9wczEueSArIGkgKiBzbGljZUhlaWdodDsKICAgICAgICAgICAgY29uc3QgY3VycmVudFNsaWRlID0gaSAlIDIgPT09IDAgPyBzbGlkZUFtb3VudCA6IC1zbGlkZUFtb3VudDsKCiAgICAgICAgICAgIGlmIChjdXJyZW50SW1hZ2UpIHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHgucmVjdChpbWdQcm9wczEueCwgeVBvcywgaW1nUHJvcHMxLncsIHNsaWNlSGVpZ2h0KTsKICAgICAgICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN1cnJlbnRTbGlkZSwgMCk7IC8vIEFwcGx5IHNsaWRlCiAgICAgICAgICAgICAgICBkcmF3Q292ZXJJbWFnZShjdXJyZW50SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vIC0tLSAyLiBQaXhlbGF0aW9uL0Jsb2NrLWJhc2VkIChJbmRleCAxMDMpIC0tLQpBTklNQVRJT05fTE9HSUNbMTAzXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwLCBwaXhlbFNpemVTdGFydDogMSwgcGl4ZWxTaXplRW5kOiA1MCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICAKICAgICAgICBjb25zdCBwaXhlbFMgPSBNYXRoLnJvdW5kKGxlcnAodW5pcXVlU3RhdGUucGl4ZWxTaXplU3RhcnQsIHVuaXF1ZVN0YXRlLnBpeGVsU2l6ZUVuZCwgZWFzZWRUIDwgMC41ID8gZWFzZWRUICogMiA6ICgxIC0gZWFzZWRUKSAqIDIpKTsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CgogICAgICAgIGlmIChwaXhlbFMgPD0gMSkgeyAKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UoZWFzZWRUIDwgMC41ID8gY3VycmVudEltYWdlIDogbmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlOyAKICAgICAgICAgICAgY29uc3QgdGVtcENhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICB0ZW1wQ2FudmFzLndpZHRoID0gY2FudmFzLndpZHRoIC8gcGl4ZWxTOwogICAgICAgICAgICB0ZW1wQ2FudmFzLmhlaWdodCA9IGNhbnZhcy5oZWlnaHQgLyBwaXhlbFM7CiAgICAgICAgICAgIGNvbnN0IHRlbXBDdHggPSB0ZW1wQ2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgIHRlbXBDdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7IAoKICAgICAgICAgICAgaWYgKHQgPD0gMC41KSB7CiAgICAgICAgICAgICAgICB0ZW1wQ3R4Lmdsb2JhbEFscGhhID0gbGVycCgxLCAwLCBlYXNlZFQgKiAyKTsKICAgICAgICAgICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgdGVtcEN0eCwgdGVtcENhbnZhcywgMSk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKHRlbXBDYW52YXMsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQgPj0gMC41KSB7CiAgICAgICAgICAgICAgICB0ZW1wQ3R4Lmdsb2JhbEFscGhhID0gbGVycCgwLCAxLCAoZWFzZWRUIC0gMC41KSAqIDIpOwogICAgICAgICAgICAgICAgdGVtcEN0eC5jbGVhclJlY3QoMCwgMCwgdGVtcENhbnZhcy53aWR0aCwgdGVtcENhbnZhcy5oZWlnaHQpOwogICAgICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCB0ZW1wQ3R4LCB0ZW1wQ2FudmFzLCAxKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGVtcENhbnZhcywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDQuIFJhZGlhbCBXYXJwIC8gWm9vbSAoSW5kZXggMTA1KSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEwNV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgIAogICAgICAgIGlmICh0IDw9IDAuNSkgewogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGVhc2VkVCAqIDI7CiAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gbGVycCgxLCAwLjEsIHByb2dyZXNzKTsKICAgICAgICAgICAgY29uc3QgYWxwaGEgPSBsZXJwKDEsIDAsIHByb2dyZXNzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgICAgIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpOwogICAgICAgICAgICBjdHgucm90YXRlKHByb2dyZXNzICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoLWNhbnZhc1cgLyAyLCAtY2FudmFzSCAvIDIpOwogICAgICAgICAgICBkcmF3Q292ZXJJbWFnZShjdXJyZW50SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGlmICh0ID49IDAuNSkgewogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IChlYXNlZFQgLSAwLjUpICogMjsKICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBsZXJwKDAuMSwgMSwgcHJvZ3Jlc3MpOwogICAgICAgICAgICBjb25zdCBhbHBoYSA9IGxlcnAoMCwgMSwgcHJvZ3Jlc3MpOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoY2FudmFzVyAvIDIsIGNhbnZhc0ggLyAyKTsKICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlLCBzY2FsZSk7CiAgICAgICAgICAgIGN0eC5yb3RhdGUoKDEgLSBwcm9ncmVzcykgKiAtTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoLWNhbnZhc1cgLyAyLCAtY2FudmFzSCAvIDIpOwogICAgICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgovLyAtLS0gNS4gS2FsZWlkb3Njb3BlLWxpa2UgWm9vbSAoSW5kZXggMTA2KSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEwNl0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCwgbWF4U2NhbGU6IDIuMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgIAogICAgICAgIC8vIEltYWdlIDE6IFpvb20gaW4gYW5kIGZhZGUgb3V0CiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBzY2FsZTEgPSBsZXJwKDEsIHVuaXF1ZVN0YXRlLm1heFNjYWxlLCBlYXNlZFQpOwogICAgICAgIGNvbnN0IGFscGhhMSA9IGxlcnAoMSwgMCwgZWFzZWRUKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTE7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjYW52YXNXIC8gMiwgY2FudmFzSCAvIDIpOwogICAgICAgIGN0eC5zY2FsZShzY2FsZTEsIHNjYWxlMSk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSgtY2FudmFzVyAvIDIsIC1jYW52YXNIIC8gMik7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gSW1hZ2UgMjogWm9vbSBvdXQgYW5kIGZhZGUgaW4KICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IHNjYWxlMiA9IGxlcnAodW5pcXVlU3RhdGUubWF4U2NhbGUsIDEsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGEyID0gbGVycCgwLCAxLCBlYXNlZFQpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgY3R4LnNjYWxlKHNjYWxlMiwgc2NhbGUyKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1jYW52YXNXIC8gMiwgLWNhbnZhc0ggLyAyKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAvLyBPdmVybGF5IHJhZGlhbCBtYXNrIGZvciB0dW5uZWwgZWZmZWN0CiAgICAgICAgaWYgKHQgPiAwLjQgJiYgdCA8IDAuNikgewogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjb25zdCByYWRpdXMgPSBsZXJwKDAsIE1hdGgubWF4KGNhbnZhc1csIGNhbnZhc0gpICogMC43LCBNYXRoLnNpbihlYXNlZFQgKiBNYXRoLlBJKSk7CiAgICAgICAgICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMiwgMCwgY2FudmFzVyAvIDIsIGNhbnZhc0ggLyAyLCByYWRpdXMpOwogICAgICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMCwgYHJnYmEoMCwgMCwgMCwgJHsxIC0gTWF0aC5hYnModCAtIDAuNSkgKiAyfSlgKTsKICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsICdyZ2JhKDAsIDAsIDAsIDApJyk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgovLyAtLS0gNi4gVGlsZSBTY3JhbWJsZSAoSW5kZXggMTA3KSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEwN10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCwgdGlsZXM6IFtdLCBudW1YOiAxMCwgbnVtWTogOCwgaW5pdGlhbGl6ZWQ6IGZhbHNlIH07CiAgICAKICAgIGZ1bmN0aW9uIGluaXRpYWxpemVUaWxlcyhjYW52YXMpIHsKICAgICAgICB1bmlxdWVTdGF0ZS50aWxlcyA9IFtdOwogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CiAgICAgICAgY29uc3QgcGllY2VXID0gY2FudmFzVyAvIHVuaXF1ZVN0YXRlLm51bVg7CiAgICAgICAgY29uc3QgcGllY2VIID0gY2FudmFzSCAvIHVuaXF1ZVN0YXRlLm51bVk7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB1bmlxdWVTdGF0ZS5udW1ZOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB1bmlxdWVTdGF0ZS5udW1YOyB4KyspIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzLnB1c2goewogICAgICAgICAgICAgICAgICAgIHg6IHggKiBwaWVjZVcsIHk6IHkgKiBwaWVjZUgsIHc6IHBpZWNlVywgaDogcGllY2VILAogICAgICAgICAgICAgICAgICAgIHJhbmRvbU9mZnNldFg6IE1hdGgucmFuZG9tKCksIHJhbmRvbU9mZnNldFk6IE1hdGgucmFuZG9tKCksCiAgICAgICAgICAgICAgICAgICAgcmFuZG9tU3BpbjogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICBpbml0aWFsaXplVGlsZXMoY2FudmFzLCBjdXJyZW50SW1hZ2UpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICghdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQpIHsgaW5pdCgpOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgY29uc3Qgc2NhdHRlclN0cmVuZ3RoID0gbGVycCgwLCBNYXRoLm1pbihjYW52YXNXLCBjYW52YXNIKSAqIDAuNSwgTWF0aC5zaW4oZWFzZWRUICogTWF0aC5QSSkpOwogICAgICAgIGNvbnN0IHJvdGF0aW9uQW5nbGUgPSBsZXJwKDAsIE1hdGguUEkgKiA0LCBlYXNlZFQpOwoKICAgICAgICB1bmlxdWVTdGF0ZS50aWxlcy5mb3JFYWNoKHRpbGUgPT4gewogICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVYID0gKHRpbGUucmFuZG9tT2Zmc2V0WCAtIDAuNSkgKiBzY2F0dGVyU3RyZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZVkgPSAodGlsZS5yYW5kb21PZmZzZXRZIC0gMC41KSAqIHNjYXR0ZXJTdHJlbmd0aDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IE1hdGguc2luKGVhc2VkVCAqIE1hdGguUEkpOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh0aWxlLnggKyB0aWxlLncgLyAyLCB0aWxlLnkgKyB0aWxlLmggLyAyKTsKICAgICAgICAgICAgY3R4LnJvdGF0ZSh0aWxlLnJhbmRvbVNwaW4gKiByb3RhdGlvbkFuZ2xlKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh0cmFuc2xhdGVYLCB0cmFuc2xhdGVZKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0IDwgMC41KSB7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgdGlsZS54LCB0aWxlLnksIHRpbGUudywgdGlsZS5oLCAtdGlsZS53IC8gMiwgLXRpbGUuaCAvIDIsIHRpbGUudywgdGlsZS5oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodCA+PSAwLjUpIHsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCB0aWxlLngsIHRpbGUueSwgdGlsZS53LCB0aWxlLmgsIC10aWxlLncgLyAyLCAtdGlsZS5oIC8gMiwgdGlsZS53LCB0aWxlLmgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0pOwogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDcuIFJHQiBTcGxpdC9KaXR0ZXIgKEluZGV4IDEwOCkgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMDhdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAKICAgICAgICBjb25zdCBtYXhPZmZzZXQgPSAyMDsgCiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gbGVycCgwLCBtYXhPZmZzZXQsIE1hdGguc2luKGVhc2VkVCAqIE1hdGguUEkpKTsKICAgICAgICBjb25zdCBhbHBoYVNwbGl0ID0gbGVycCgxLCAwLCBlYXNlZFQgKiAyKTsKICAgICAgICBjb25zdCBhbHBoYU1lcmdlID0gbGVycCgwLCAxLCAoZWFzZWRUIC0gMC41KSAqIDIpOwoKICAgICAgICAvLyBEcmF3IEltYWdlIDIgZmlyc3QgYXMgYmFja2dyb3VuZCwgZmFkaW5nIGluCiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGFNZXJnZTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICAKICAgICAgICAvLyBEcmF3IEltYWdlIDEgd2l0aCBSR0Igc3BsaXQgZWZmZWN0IChmYWRpbmcgb3V0KQogICAgICAgIGlmICh0IDwgMC41KSB7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhU3BsaXQ7CgogICAgICAgICAgICAvLyBSLCBHLCBCIGNoYW5uZWxzIHdpdGggb2Zmc2V0cyBhbmQgbGlnaHRlciBjb21wb3NpdGUKICAgICAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdsaWdodGVyJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlZCBjaGFubmVsIChvZmZzZXQpCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5maWx0ZXIgPSAnaHVlLXJvdGF0ZSgwZGVnKSBzYXR1cmF0ZSgxKSc7IAogICAgICAgICAgICBjdHgudHJhbnNsYXRlKG9mZnNldCwgMCk7CiAgICAgICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAgICAgLy8gR3JlZW4gY2hhbm5lbCAoY2VudGVyKQogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguZmlsdGVyID0gJ2h1ZS1yb3RhdGUoMTIwZGVnKSBzYXR1cmF0ZSgxKSc7CiAgICAgICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAgICAgLy8gQmx1ZSBjaGFubmVsICgtb2Zmc2V0KQogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguZmlsdGVyID0gJ2h1ZS1yb3RhdGUoMjQwZGVnKSBzYXR1cmF0ZSgxKSc7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoLW9mZnNldCwgMCk7CiAgICAgICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3Zlcic7IC8vIFJlc2V0IGJsZW5kIG1vZGUKICAgICAgICB9CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVYVFJBQ1RFRCBGUk9NIDAyXzM5MjAuaHRtbCAoMSBBbmltYXRpb246IDEwOSkKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0gOC4gTW9ycGhpbmcgU3Bpbi9TaGVhciAoSW5kZXggMTA5KSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEwOV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgIAogICAgICAgIC8vIEltYWdlIDE6IEZhZGVzIG91dCwgcm90YXRlcywgc2hlYXJzCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCByb3QxID0gbGVycCgwLCBNYXRoLlBJIC8gMiwgZWFzZWRUKTsKICAgICAgICBjb25zdCBzaGVhclgxID0gbGVycCgwLCAwLjUsIGVhc2VkVCk7CiAgICAgICAgY29uc3Qgc2NhbGUxID0gbGVycCgxLCAwLjgsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGExID0gbGVycCgxLCAwLCBlYXNlZFQpOwoKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTE7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjYW52YXNXIC8gMiwgY2FudmFzSCAvIDIpOwogICAgICAgIGN0eC5yb3RhdGUocm90MSk7CiAgICAgICAgY3R4LnRyYW5zZm9ybSgxLCAwLCBzaGVhclgxLCAxLCAwLCAwKTsgCiAgICAgICAgY3R4LnNjYWxlKHNjYWxlMSwgc2NhbGUxKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1jYW52YXNXIC8gMiwgLWNhbnZhc0ggLyAyKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShjdXJyZW50SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAvLyBJbWFnZSAyOiBGYWRlcyBpbiwgdW4tc2hlYXJzLCB1bi1yb3RhdGVzCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCByb3QyID0gbGVycCgtTWF0aC5QSSAvIDIsIDAsIGVhc2VkVCk7CiAgICAgICAgY29uc3Qgc2hlYXJYMiA9IGxlcnAoLTAuNSwgMCwgZWFzZWRUKTsKICAgICAgICBjb25zdCBzY2FsZTIgPSBsZXJwKDAuOCwgMSwgZWFzZWRUKTsKICAgICAgICBjb25zdCBhbHBoYTIgPSBsZXJwKDAsIDEsIGVhc2VkVCk7CgogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgY3R4LnJvdGF0ZShyb3QyKTsKICAgICAgICBjdHgudHJhbnNmb3JtKDEsIDAsIHNoZWFyWDIsIDEsIDAsIDApOwogICAgICAgIGN0eC5zY2FsZShzY2FsZTIsIHNjYWxlMik7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSgtY2FudmFzVyAvIDIsIC1jYW52YXNIIC8gMik7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRVhUUkFDVEVEIEZST00gMDJfNTM2My5odG1sICgxIEFuaW1hdGlvbjogMTEwKQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIC0tLSA5LiBDb21iaW5lZCBEeW5hbWljIFRyYW5zZm9ybWF0aW9uIChJbmRleCAxMTApIC0tLQpBTklNQVRJT05fTE9HSUNbMTEwXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwLCAKICAgICAgICB4VHJhbnM6IDAsIHlUcmFuczogMCwgcm90YXRpb246IDAsIHNjYWxlOiAwLCBzaGVhcjogMAogICAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICAvLyBSZS1jYWxjdWxhdGUgcmFuZG9tIHBhcmFtZXRlcnMgb24gaW5pdAogICAgICAgIHVuaXF1ZVN0YXRlLnhUcmFucyA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDQwMDsgCiAgICAgICAgdW5pcXVlU3RhdGUueVRyYW5zID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMzAwOwogICAgICAgIHVuaXF1ZVN0YXRlLnJvdGF0aW9uID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTWF0aC5QSTsKICAgICAgICB1bmlxdWVTdGF0ZS5zY2FsZSA9IDEgKyBNYXRoLnJhbmRvbSgpICogMC41OwogICAgICAgIHVuaXF1ZVN0YXRlLnNoZWFyID0gKE1hdGgucmFuZG9tKCkgLSAwLjUpICogMC41OwogICAgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKCiAgICAgICAgLy8gLS0tIEltYWdlIDE6IERpc3BlcnNlIGFuZCBUcmFuc2Zvcm0gKEZhZGUgT3V0KSAtLS0KICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IHByb2dyZXNzMSA9IGVhc2VkVDsKICAgICAgICBjb25zdCBhbHBoYTEgPSBsZXJwKDEsIDAsIHByb2dyZXNzMSk7CiAgICAgICAgCiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGExOwogICAgICAgIAogICAgICAgIGNvbnN0IGN1cnJlbnRYVHJhbnMgPSB1bmlxdWVTdGF0ZS54VHJhbnMgKiBwcm9ncmVzczE7CiAgICAgICAgY29uc3QgY3VycmVudFlUcmFucyA9IHVuaXF1ZVN0YXRlLnlUcmFucyAqIHByb2dyZXNzMTsKICAgICAgICBjb25zdCBjdXJyZW50U2NhbGUxID0gbGVycCgxLCAxIC8gdW5pcXVlU3RhdGUuc2NhbGUsIHByb2dyZXNzMSk7CiAgICAgICAgY29uc3QgY3VycmVudFJvdGF0aW9uMSA9IHVuaXF1ZVN0YXRlLnJvdGF0aW9uICogcHJvZ3Jlc3MxOwogICAgICAgIAogICAgICAgIGN0eC50cmFuc2xhdGUoY2FudmFzVyAvIDIgKyBjdXJyZW50WFRyYW5zLCBjYW52YXNIIC8gMiArIGN1cnJlbnRZVHJhbnMpOwogICAgICAgIGN0eC5yb3RhdGUoY3VycmVudFJvdGF0aW9uMSk7CiAgICAgICAgY3R4LnNjYWxlKGN1cnJlbnRTY2FsZTEsIGN1cnJlbnRTY2FsZTEpOwogICAgICAgIGN0eC50cmFuc2xhdGUoLWNhbnZhc1cgLyAyLCAtY2FudmFzSCAvIDIpOwogICAgICAgIAogICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIC8vIC0tLSBJbWFnZSAyOiBDb2FsZXNjZSBhbmQgVHJhbnNmb3JtIChGYWRlIEluKSAtLS0KICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IHByb2dyZXNzMiA9IDEgLSBlYXNlZFQ7CiAgICAgICAgY29uc3QgYWxwaGEyID0gbGVycCgwLCAxLCBlYXNlZFQpOwogICAgICAgIAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKCiAgICAgICAgY29uc3QgY3VycmVudFhUcmFuczIgPSB1bmlxdWVTdGF0ZS54VHJhbnMgKiBwcm9ncmVzczI7CiAgICAgICAgY29uc3QgY3VycmVudFlUcmFuczIgPSB1bmlxdWVTdGF0ZS55VHJhbnMgKiBwcm9ncmVzczI7CiAgICAgICAgY29uc3QgY3VycmVudFNjYWxlMiA9IGxlcnAodW5pcXVlU3RhdGUuc2NhbGUsIDEsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgY3VycmVudFJvdGF0aW9uMiA9IHVuaXF1ZVN0YXRlLnJvdGF0aW9uICogcHJvZ3Jlc3MyOwogICAgICAgIAogICAgICAgIGN0eC50cmFuc2xhdGUoY2FudmFzVyAvIDIgLSBjdXJyZW50WFRyYW5zMiwgY2FudmFzSCAvIDIgLSBjdXJyZW50WVRyYW5zMik7CiAgICAgICAgY3R4LnJvdGF0ZSgtY3VycmVudFJvdGF0aW9uMik7CiAgICAgICAgY3R4LnNjYWxlKGN1cnJlbnRTY2FsZTIsIGN1cnJlbnRTY2FsZTIpOwogICAgICAgIGN0eC50cmFuc2xhdGUoLWNhbnZhc1cgLyAyLCAtY2FudmFzSCAvIDIpOwogICAgICAgIAogICAgICAgIGRyYXdDb3ZlckltYWdlKG5leHRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVYVFJBQ1RFRCBGUk9NIDAyXzYxMjIuaHRtbCAoMSBBbmltYXRpb246IDExMSkKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0gMTAuIEZyYWdtZW50ZWQgTW9ycGggKEluZGV4IDExMSkgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMTFdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAsIGZyYWdtZW50czogW10sIG51bVg6IDE1LCBudW1ZOiAxMCwgaW5pdGlhbGl6ZWQ6IGZhbHNlIH07CiAgICAKICAgIGZ1bmN0aW9uIGluaXRpYWxpemVGcmFnbWVudHMoY2FudmFzKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuZnJhZ21lbnRzID0gW107CiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKICAgICAgICBjb25zdCBmcmFnVyA9IGNhbnZhc1cgLyB1bmlxdWVTdGF0ZS5udW1YOwogICAgICAgIGNvbnN0IGZyYWdIID0gY2FudmFzSCAvIHVuaXF1ZVN0YXRlLm51bVk7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB1bmlxdWVTdGF0ZS5udW1ZOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB1bmlxdWVTdGF0ZS5udW1YOyB4KyspIHsKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmZyYWdtZW50cy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB4OiB4ICogZnJhZ1csIHk6IHkgKiBmcmFnSCwgdzogZnJhZ1csIGg6IGZyYWdILAogICAgICAgICAgICAgICAgICAgIGZpbmFsWDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogNTAwLAogICAgICAgICAgICAgICAgICAgIGZpbmFsWTogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogNTAwLAogICAgICAgICAgICAgICAgICAgIGZpbmFsUm90OiAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBNYXRoLlBJICogMiwKICAgICAgICAgICAgICAgICAgICBpbml0aWFsRGVsYXk6IE1hdGgucmFuZG9tKCkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHVuaXF1ZVN0YXRlLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0KCkgeyAKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgaW5pdGlhbGl6ZUZyYWdtZW50cyhjYW52YXMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICghdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQpIHsgaW5pdCgpOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CgogICAgICAgIHVuaXF1ZVN0YXRlLmZyYWdtZW50cy5mb3JFYWNoKGZyYWcgPT4gewogICAgICAgICAgICBjb25zdCBkZWxheVQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCAoZWFzZWRUIC0gZnJhZy5pbml0aWFsRGVsYXkgKiAwLjMpICogMS41KSk7CiAgICAgICAgICAgIGNvbnN0IGludkRlbGF5VCA9IDEgLSBkZWxheVQ7CgogICAgICAgICAgICAvLyAtLS0gRHJhdyBJbWFnZSAxIChTY2F0dGVyaW5nKSAtLS0KICAgICAgICAgICAgaWYgKGRlbGF5VCA8IDEpIHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhID0gaW52RGVsYXlUOwogICAgICAgICAgICAgICAgY29uc3Qgcm90ID0gZnJhZy5maW5hbFJvdCAqIGludkRlbGF5VDsKICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gbGVycCgxLCAwLjUsIGludkRlbGF5VCk7CiAgICAgICAgICAgICAgICBjb25zdCBjeCA9IGZyYWcueCArIGZyYWcudyAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IGZyYWcueSArIGZyYWcuaCAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVYID0gZnJhZy5maW5hbFggKiBkZWxheVQ7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVZID0gZnJhZy5maW5hbFkgKiBkZWxheVQ7CgogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN4ICsgdHJhbnNsYXRlWCwgY3kgKyB0cmFuc2xhdGVZKTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocm90KTsKICAgICAgICAgICAgICAgIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgZnJhZy54LCBmcmFnLnksIGZyYWcudywgZnJhZy5oLCAtZnJhZy53IC8gMiwgLWZyYWcuaCAvIDIsIGZyYWcudywgZnJhZy5oKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gLS0tIERyYXcgSW1hZ2UgMiAoQ29hbGVzY2luZykgLS0tCiAgICAgICAgICAgIGlmIChkZWxheVQgPiAwKSB7CiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwoKICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhID0gZGVsYXlUOwogICAgICAgICAgICAgICAgY29uc3Qgcm90ID0gZnJhZy5maW5hbFJvdCAqIGRlbGF5VDsKICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlID0gbGVycCgwLjUsIDEsIGRlbGF5VCk7CiAgICAgICAgICAgICAgICBjb25zdCBjeCA9IGZyYWcueCArIGZyYWcudyAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBjeSA9IGZyYWcueSArIGZyYWcuaCAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVYID0gZnJhZy5maW5hbFggKiAoMSAtIGRlbGF5VCk7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVZID0gZnJhZy5maW5hbFkgKiAoMSAtIGRlbGF5VCk7CgogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN4IC0gdHJhbnNsYXRlWCwgY3kgLSB0cmFuc2xhdGVZKTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUoLXJvdCk7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIGZyYWcueCwgZnJhZy55LCBmcmFnLncsIGZyYWcuaCwgLWZyYWcudyAvIDIsIC1mcmFnLmggLyAyLCBmcmFnLncsIGZyYWcuaCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVYVFJBQ1RFRCBGUk9NIDAyXzYyNzIuaHRtbCAoMTMgQW5pbWF0aW9uczogMTEyLTEyNCkKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0gMTEuIERpc3NvbHZlICYgRGlzdG9ydCAoSW5kZXggMTEyKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzExMl0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgIAogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY29uc3Qgcm90MSA9IGxlcnAoMCwgTWF0aC5QSSAvIDQsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGExID0gbGVycCgxLCAwLCBlYXNlZFQpOwogICAgICAgIAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMTsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgY3R4LnJvdGF0ZShyb3QxKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1jYW52YXNXIC8gMiwgLWNhbnZhc0ggLyAyKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShjdXJyZW50SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IHJvdDIgPSBsZXJwKC1NYXRoLlBJIC8gNCwgMCwgZWFzZWRUKTsKICAgICAgICBjb25zdCBhbHBoYTIgPSBsZXJwKDAsIDEsIGVhc2VkVCk7CgogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgY3R4LnJvdGF0ZShyb3QyKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1jYW52YXNXIC8gMiwgLWNhbnZhc0ggLyAyKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKLy8gLS0tIDEzLiBTbGljZSAmIFNrZXcgKEluZGV4IDExNCkgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMTRdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAsIG51bVNsaWNlczogMTAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKICAgICAgICBjb25zdCBzbGljZUhlaWdodCA9IGNhbnZhc0ggLyB1bmlxdWVTdGF0ZS5udW1TbGljZXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1TbGljZXM7IGkrKykgewogICAgICAgICAgICBjb25zdCB5ID0gaSAqIHNsaWNlSGVpZ2h0OwogICAgICAgICAgICBjb25zdCBza2V3RmFjdG9yID0gbGVycCgwLCAwLjUsIE1hdGguc2luKGVhc2VkVCAqIE1hdGguUEkpKTsKICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlWCA9IGxlcnAoMCwgY2FudmFzVyAvIDIsIGVhc2VkVCk7CiAgICAgICAgICAgIGNvbnN0IG9mZnNldERpciA9IGkgJSAyID09PSAwID8gMSA6IC0xOwoKICAgICAgICAgICAgaWYgKHQgPCAwLjUpIHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBsZXJwKDEsIDAsIGVhc2VkVCAqIDIpOwogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LnJlY3QoMCwgeSwgY2FudmFzVywgc2xpY2VIZWlnaHQpOwogICAgICAgICAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUob2Zmc2V0RGlyICogdHJhbnNsYXRlWCwgMCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNmb3JtKDEsIDAsIHNrZXdGYWN0b3IsIDEsIDAsIDApOwogICAgICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodCA+PSAwLjUpIHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBsZXJwKDAsIDEsIChlYXNlZFQgLSAwLjUpICogMik7CiAgICAgICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgICAgICBjdHgucmVjdCgwLCB5LCBjYW52YXNXLCBzbGljZUhlaWdodCk7CiAgICAgICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgtb2Zmc2V0RGlyICogKGNhbnZhc1cgLyAyIC0gdHJhbnNsYXRlWCksIDApOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zZm9ybSgxLCAwLCAtc2tld0ZhY3RvciwgMSwgMCwgMCk7CiAgICAgICAgICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgovLyAtLS0gMTQuIFNoYXJkIEV4cGxvZGUgKEluZGV4IDExNSkgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMTVdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAsIHNoYXJkczogW10sIG51bVg6IDEwLCBudW1ZOiA4LCBpbml0aWFsaXplZDogZmFsc2UgfTsKICAgIAogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVNoYXJkcyhjYW52YXMpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5zaGFyZHMgPSBbXTsKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwogICAgICAgIGNvbnN0IHNoYXJkVyA9IGNhbnZhc1cgLyB1bmlxdWVTdGF0ZS5udW1YOwogICAgICAgIGNvbnN0IHNoYXJkSCA9IGNhbnZhc0ggLyB1bmlxdWVTdGF0ZS5udW1ZOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdW5pcXVlU3RhdGUubnVtWTsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdW5pcXVlU3RhdGUubnVtWDsgeCsrKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5zaGFyZHMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgeDogeCAqIHNoYXJkVywgeTogeSAqIHNoYXJkSCwgdzogc2hhcmRXLCBoOiBzaGFyZEgsCiAgICAgICAgICAgICAgICAgICAgY3g6IHggKiBzaGFyZFcgKyBzaGFyZFcgLyAyLCBjeTogeSAqIHNoYXJkSCArIHNoYXJkSCAvIDIsCiAgICAgICAgICAgICAgICAgICAgZGlyWDogKHggLSB1bmlxdWVTdGF0ZS5udW1YIC8gMiksCiAgICAgICAgICAgICAgICAgICAgZGlyWTogKHkgLSB1bmlxdWVTdGF0ZS5udW1ZIC8gMiksCiAgICAgICAgICAgICAgICAgICAgcmFuZFJvdDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTWF0aC5QSQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICBpbml0aWFsaXplU2hhcmRzKGNhbnZhcyk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgaWYgKCF1bmlxdWVTdGF0ZS5pbml0aWFsaXplZCkgeyBpbml0KCk7IH0KICAgICAgICAKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAKICAgICAgICBjb25zdCBtYXhTY2F0dGVyID0gTWF0aC5tYXgoY2FudmFzVywgY2FudmFzSCkgKiAwLjQ7CiAgICAgICAgY29uc3Qgc2NhdHRlciA9IGxlcnAoMCwgbWF4U2NhdHRlciwgTWF0aC5zaW4oZWFzZWRUICogTWF0aC5QSSkpOwoKICAgICAgICB1bmlxdWVTdGF0ZS5zaGFyZHMuZm9yRWFjaChzaGFyZCA9PiB7CiAgICAgICAgICAgIGlmICh0IDwgMC41KSB7CiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY29uc3QgYWxwaGEgPSBsZXJwKDEsIDAsIGVhc2VkVCAqIDIpOwogICAgICAgICAgICAgICAgY29uc3Qgcm90ID0gbGVycCgwLCBzaGFyZC5yYW5kUm90LCBlYXNlZFQgKiAyKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZVggPSBzaGFyZC5kaXJYICogc2NhdHRlcjsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZVkgPSBzaGFyZC5kaXJZICogc2NhdHRlcjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHNoYXJkLmN4ICsgdHJhbnNsYXRlWCwgc2hhcmQuY3kgKyB0cmFuc2xhdGVZKTsKICAgICAgICAgICAgICAgIGN0eC5yb3RhdGUocm90KTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCBzaGFyZC54LCBzaGFyZC55LCBzaGFyZC53LCBzaGFyZC5oLCAtc2hhcmQudyAvIDIsIC1zaGFyZC5oIC8gMiwgc2hhcmQudywgc2hhcmQuaCk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAodCA+PSAwLjUpIHsKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9ncmVzczIgPSAoZWFzZWRUIC0gMC41KSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9IGxlcnAoMCwgMSwgcHJvZ3Jlc3MyKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJvdCA9IGxlcnAoLXNoYXJkLnJhbmRSb3QsIDAsIHByb2dyZXNzMik7CiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVYID0gc2hhcmQuZGlyWCAqIChtYXhTY2F0dGVyICogKDEgLSBwcm9ncmVzczIpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZVkgPSBzaGFyZC5kaXJZICogKG1heFNjYXR0ZXIgKiAoMSAtIHByb2dyZXNzMikpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoc2hhcmQuY3ggLSB0cmFuc2xhdGVYLCBzaGFyZC5jeSAtIHRyYW5zbGF0ZVkpOwogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3QpOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIHNoYXJkLngsIHNoYXJkLnksIHNoYXJkLncsIHNoYXJkLmgsIC1zaGFyZC53IC8gMiwgLXNoYXJkLmggLyAyLCBzaGFyZC53LCBzaGFyZC5oKTsKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vIC0tLSAxNS4gQ3ViZSBGbGlwIChJbmRleCAxMTYpIC0tLQpBTklNQVRJT05fTE9HSUNbMTE2XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwLCBjdWJlczogW10sIG51bVg6IDgsIG51bVk6IDYsIGluaXRpYWxpemVkOiBmYWxzZSB9OwogICAgCiAgICBmdW5jdGlvbiBpbml0aWFsaXplQ3ViZXMoY2FudmFzKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3ViZXMgPSBbXTsKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwogICAgICAgIGNvbnN0IGN1YmVXID0gY2FudmFzVyAvIHVuaXF1ZVN0YXRlLm51bVg7CiAgICAgICAgY29uc3QgY3ViZUggPSBjYW52YXNIIC8gdW5pcXVlU3RhdGUubnVtWTsKICAgICAgICAKICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHVuaXF1ZVN0YXRlLm51bVk7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHVuaXF1ZVN0YXRlLm51bVg7IHgrKykgewogICAgICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3ViZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgeDogeCAqIGN1YmVXLCB5OiB5ICogY3ViZUgsIHc6IGN1YmVXLCBoOiBjdWJlSCwKICAgICAgICAgICAgICAgICAgICBjeDogeCAqIGN1YmVXICsgY3ViZVcgLyAyLCBjeTogeSAqIGN1YmVIICsgY3ViZUggLyAyCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB1bmlxdWVTdGF0ZS5pbml0aWFsaXplZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdCgpIHsgCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIGluaXRpYWxpemVDdWJlcyhjYW52YXMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICghdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQpIHsgaW5pdCgpOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgdW5pcXVlU3RhdGUuY3ViZXMuZm9yRWFjaChjdWJlID0+IHsKICAgICAgICAgICAgY29uc3Qgcm90YXRpb25ZID0gKDEgLSBlYXNlZFQpICogTWF0aC5QSTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEltYWdlIDEgZmFjZSAoMCB0byBQSS8yLCBmYWRlcyBvdXQpCiAgICAgICAgICAgIGlmIChyb3RhdGlvblkgPiBNYXRoLlBJIC8gMikgewogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJvdFByb2dyZXNzID0gKHJvdGF0aW9uWSAtIE1hdGguUEkgLyAyKSAvIChNYXRoLlBJIC8gMik7CiAgICAgICAgICAgICAgICBjb25zdCBzY2FsZVggPSBNYXRoLmNvcyhyb3RhdGlvblkpOwogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gcm90UHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN1YmUuY3gsIGN1YmUuY3kpOwogICAgICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlWCwgMSk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgY3ViZS54LCBjdWJlLnksIGN1YmUudywgY3ViZS5oLCAtY3ViZS53IC8gMiwgLWN1YmUuaCAvIDIsIGN1YmUudywgY3ViZS5oKTsKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEltYWdlIDIgZmFjZSAoUEkvMiB0byAwLCBmYWRlcyBpbikKICAgICAgICAgICAgaWYgKHJvdGF0aW9uWSA8PSBNYXRoLlBJIC8gMikgewogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJvdFByb2dyZXNzID0gcm90YXRpb25ZIC8gKE1hdGguUEkgLyAyKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlWCA9IE1hdGguY29zKHJvdGF0aW9uWSk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gcm90UHJvZ3Jlc3M7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN1YmUuY3gsIGN1YmUuY3kpOwogICAgICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlWCwgMSk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgY3ViZS54LCBjdWJlLnksIGN1YmUudywgY3ViZS5oLCAtY3ViZS53IC8gMiwgLWN1YmUuaCAvIDIsIGN1YmUudywgY3ViZS5oKTsKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyAtLS0gMTkuIEhvcml6b250YWwgU2NhbmxpbmUgUmV2ZWFsIChJbmRleCAxMjApIC0tLQpBTklNQVRJT05fTE9HSUNbMTIwXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwLCBudW1MaW5lczogNTAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKICAgICAgICBjb25zdCBsaW5lSGVpZ2h0ID0gY2FudmFzSCAvIHVuaXF1ZVN0YXRlLm51bUxpbmVzOwoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgIAogICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVuaXF1ZVN0YXRlLm51bUxpbmVzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgeVN0YXJ0ID0gaSAqIGxpbmVIZWlnaHQ7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlciA9IHlTdGFydCArIGxpbmVIZWlnaHQgLyAyOwogICAgICAgICAgICBjb25zdCByZXZlYWxIZWlnaHQgPSBsZXJwKDAsIGxpbmVIZWlnaHQgKiAyLCBlYXNlZFQpOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LnJlY3QoMCwgY2VudGVyIC0gcmV2ZWFsSGVpZ2h0IC8gMiwgY2FudmFzVywgcmV2ZWFsSGVpZ2h0KTsKICAgICAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDIwLiBEaXN0b3J0ZWQgVHVubmVsIChJbmRleCAxMjEpIC0tLQpBTklNQVRJT05fTE9HSUNbMTIxXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBzY2FsZTEgPSBsZXJwKDEsIDAuMSwgZWFzZWRUKTsKICAgICAgICBjb25zdCBhbHBoYTEgPSBsZXJwKDEsIDAsIGVhc2VkVCk7CiAgICAgICAgY29uc3Qgd2F2ZU9mZnNldCA9IE1hdGguc2luKGVhc2VkVCAqIE1hdGguUEkgKiA4KSAqIDUwICogKDEgLSBlYXNlZFQpOwoKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTE7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjYW52YXNXIC8gMiArIHdhdmVPZmZzZXQsIGNhbnZhc0ggLyAyKTsKICAgICAgICBjdHguc2NhbGUoc2NhbGUxLCBzY2FsZTEpOwogICAgICAgIGN0eC5yb3RhdGUoZWFzZWRUICogTWF0aC5QSSk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSgtY2FudmFzVyAvIDIsIC1jYW52YXNIIC8gMik7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBzY2FsZTIgPSBsZXJwKDAuMSwgMSwgZWFzZWRUKTsKICAgICAgICBjb25zdCBhbHBoYTIgPSBsZXJwKDAsIDEsIGVhc2VkVCk7CgogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyIC0gd2F2ZU9mZnNldCwgY2FudmFzSCAvIDIpOwogICAgICAgIGN0eC5zY2FsZShzY2FsZTIsIHNjYWxlMik7CiAgICAgICAgY3R4LnJvdGF0ZSgoMSAtIGVhc2VkVCkgKiAtTWF0aC5QSSk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSgtY2FudmFzVyAvIDIsIC1jYW52YXNIIC8gMik7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vIC0tLSAyMS4gQ2hyb21hdGljIEFiZXJyYXRpb24gJiBCbHVyIChJbmRleCAxMjIpIC0tLQpBTklNQVRJT05fTE9HSUNbMTIyXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBhbHBoYTEgPSBsZXJwKDEsIDAsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWJlcnJhdGlvbk9mZnNldDEgPSBsZXJwKDE1LCAwLCBlYXNlZFQpOwogICAgICAgIGNvbnN0IGJsdXJBbW91bnQxID0gbGVycCg1LCAwLCBlYXNlZFQpOwoKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTE7CiAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7Ymx1ckFtb3VudDF9cHgpYDsKICAgICAgICAKICAgICAgICBjdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2xpZ2h0ZXInOwogICAgICAgIAogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShhYmVycmF0aW9uT2Zmc2V0MSwgMCk7CiAgICAgICAgY3R4LmZpbHRlciA9IGBodWUtcm90YXRlKDBkZWcpIGJyaWdodG5lc3MoMS41KWA7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1hYmVycmF0aW9uT2Zmc2V0MSwgMCk7CiAgICAgICAgY3R4LmZpbHRlciA9IGBodWUtcm90YXRlKDI0MGRlZykgYnJpZ2h0bmVzcygxLjUpYDsKICAgICAgICBkcmF3Q292ZXJJbWFnZShjdXJyZW50SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGxlcnAoMCwgMSwgZWFzZWRUKTsKICAgICAgICBjdHguZmlsdGVyID0gJ25vbmUnOwogICAgICAgIGRyYXdDb3ZlckltYWdlKG5leHRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDIyLiBab29tIEZhZGUgQ2VudGVyIChJbmRleCAxMjMpIC0tLQpBTklNQVRJT05fTE9HSUNbMTIzXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBzY2FsZTEgPSBsZXJwKDEsIDAuNSwgZWFzZWRUKTsKICAgICAgICBjb25zdCBhbHBoYTEgPSBsZXJwKDEsIDAsIGVhc2VkVCk7CiAgICAgICAgCiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGExOwogICAgICAgIGN0eC50cmFuc2xhdGUoY2FudmFzVyAvIDIsIGNhbnZhc0ggLyAyKTsKICAgICAgICBjdHguc2NhbGUoc2NhbGUxLCBzY2FsZTEpOwogICAgICAgIGN0eC50cmFuc2xhdGUoLWNhbnZhc1cgLyAyLCAtY2FudmFzSCAvIDIpOwogICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY29uc3Qgc2NhbGUyID0gbGVycCgwLjUsIDEsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGEyID0gbGVycCgwLCAxLCBlYXNlZFQpOwogICAgICAgIAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgY3R4LnNjYWxlKHNjYWxlMiwgc2NhbGUyKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1jYW52YXNXIC8gMiwgLWNhbnZhc0ggLyAyKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwovLyAtLS0gMjQuIFNpbXBsZSBIb3Jpem9udGFsIFJldmVhbCAoSW5kZXggMTI1KSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEyNV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgY29uc3QgcmV2ZWFsV2lkdGggPSBsZXJwKDAsIGNhbnZhc1csIGVhc2VkVCk7IAogICAgICAgIAogICAgICAgIGRyYXdDb3ZlckltYWdlKG5leHRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwoKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjdHgucmVjdChyZXZlYWxXaWR0aCwgMCwgY2FudmFzVyAtIHJldmVhbFdpZHRoLCBjYW52YXNIKTsKICAgICAgICBjdHguY2xpcCgpOwogICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KLy8gRVhUUkFDVEVEIEZST00gMDJfNjg1NC5odG1sICgxIEFuaW1hdGlvbjogMTI2KQovLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0KCi8vIC0tLSAyNS4gQ29tcGxleCBUaWxlZCBEaXNwZXJzYWwgKEluZGV4IDEyNikgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMjZdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAsIHRpbGVzOiBbXSwgbnVtWDogMTIsIG51bVk6IDgsIGluaXRpYWxpemVkOiBmYWxzZSB9OwogICAgCiAgICBmdW5jdGlvbiBpbml0aWFsaXplVGlsZXMoY2FudmFzKSB7CiAgICAgICAgdW5pcXVlU3RhdGUudGlsZXMgPSBbXTsKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwogICAgICAgIGNvbnN0IHRpbGVXID0gY2FudmFzVyAvIHVuaXF1ZVN0YXRlLm51bVg7CiAgICAgICAgY29uc3QgdGlsZUggPSBjYW52YXNIIC8gdW5pcXVlU3RhdGUubnVtWTsKICAgICAgICBjb25zdCBlZmZlY3RUeXBlcyA9IFsnc2NhbGVfcm90YXRlJywgJ2FscGhhX3NoZWFyX3RyYW5zbGF0ZSddOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdW5pcXVlU3RhdGUubnVtWTsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdW5pcXVlU3RhdGUubnVtWDsgeCsrKSB7CiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS50aWxlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB4OiB4ICogdGlsZVcsIHk6IHkgKiB0aWxlSCwgdzogdGlsZVcsIGg6IHRpbGVILAogICAgICAgICAgICAgICAgICAgIGVmZmVjdFR5cGVPdXQ6IGVmZmVjdFR5cGVzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIpXSwKICAgICAgICAgICAgICAgICAgICByYW5kb21Sb3Q6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIE1hdGguUEksCiAgICAgICAgICAgICAgICAgICAgcmFuZG9tU2hlYXI6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNSwKICAgICAgICAgICAgICAgICAgICByYW5kb21UcmFuc1g6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGNhbnZhc1cgKiAwLjUsCiAgICAgICAgICAgICAgICAgICAgcmFuZG9tVHJhbnNZOiAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBjYW52YXNIICogMC41CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB1bmlxdWVTdGF0ZS5pbml0aWFsaXplZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdCgpIHsgCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIGluaXRpYWxpemVUaWxlcyhjYW52YXMpOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICghdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQpIHsgaW5pdCgpOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CgogICAgICAgIHVuaXF1ZVN0YXRlLnRpbGVzLmZvckVhY2godGlsZSA9PiB7CiAgICAgICAgICAgIGNvbnN0IHRpbGVQcm9ncmVzcyA9IE1hdGguc2luKCgxIC0gZWFzZWRUKSAqIE1hdGguUEkpOwoKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh0aWxlLnggKyB0aWxlLncgLyAyLCB0aWxlLnkgKyB0aWxlLmggLyAyKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICh0aWxlLmVmZmVjdFR5cGVPdXQgPT09ICdzY2FsZV9yb3RhdGUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCByb3RhdGlvbiA9IHRpbGUucmFuZG9tUm90ICogdGlsZVByb2dyZXNzOwogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSBsZXJwKDEsIDAsIHRpbGVQcm9ncmVzcyk7IAogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShyb3RhdGlvbik7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0aWxlLmVmZmVjdFR5cGVPdXQgPT09ICdhbHBoYV9zaGVhcl90cmFuc2xhdGUnKSB7CiAgICAgICAgICAgICAgICBjb25zdCBzaGVhclggPSB0aWxlLnJhbmRvbVNoZWFyICogdGlsZVByb2dyZXNzOyAKICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZVggPSB0aWxlLnJhbmRvbVRyYW5zWCAqIHRpbGVQcm9ncmVzczsgCiAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVZID0gdGlsZS5yYW5kb21UcmFuc1kgKiB0aWxlUHJvZ3Jlc3M7IAogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh0cmFuc2xhdGVYLCB0cmFuc2xhdGVZKTsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2Zvcm0oMSwgMCwgc2hlYXJYLCAxLCAwLCAwKTsgCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGxlcnAoMSwgMCwgdGlsZVByb2dyZXNzKTsgCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCB0aWxlLngsIHRpbGUueSwgdGlsZS53LCB0aWxlLmgsIC10aWxlLncgLyAyLCAtdGlsZS5oIC8gMiwgdGlsZS53LCB0aWxlLmgpOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVYVFJBQ1RFRCBGUk9NIDAyXzczODAuaHRtbCAoNSBQaXhlbCBBbmltYXRpb25zOiAxMjctMTMxKQovLyBSRVFVSVJFUyBHTE9CQUwgRlVOQ1RJT05TOiBnZXRQaXhlbERhdGEoaW1nKSBhbmQgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyAtLS0gMjcuIFdhdmUgU3dpcmwgKEluZGV4IDEyOCkgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMjhdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAsIHNyY0RhdGE6IG51bGwsIGRlc3REYXRhOiBudWxsIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyAKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgaWYgKHR5cGVvZiBnZXRQaXhlbERhdGEgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuc3JjRGF0YSA9IGdldFBpeGVsRGF0YShjdXJyZW50SW1hZ2UpOwogICAgICAgICAgICB1bmlxdWVTdGF0ZS5kZXN0RGF0YSA9IGdldFBpeGVsRGF0YShuZXh0SW1hZ2UpOwogICAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgICBjb25zdCB7IHNyY0RhdGEsIGRlc3REYXRhIH0gPSB1bmlxdWVTdGF0ZTsKICAgICAgICAKICAgICAgICBpZiAoIXNyY0RhdGEgfHwgIWRlc3REYXRhIHx8IHR5cGVvZiBjdHgucHV0SW1hZ2VEYXRhICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBzcmNEYXRhLndpZHRoLCBoZWlnaHQgPSBzcmNEYXRhLmhlaWdodDsKICAgICAgICAgICAgY29uc3QgbmV3SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY29uc3QgZGF0YUxlbmd0aCA9IHNyY0RhdGEuZGF0YS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlclN3aXJsID0gTWF0aC5QSSAqIDQgKiBlYXNlZFQ7CiAgICAgICAgICAgIGNvbnN0IHJhZGl1c0ZhY3RvciA9IDAuMDE7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFMZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgY29uc3QgeCA9IChpIC8gNCkgJSB3aWR0aDsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKChpIC8gNCkgLyB3aWR0aCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGR4ID0geCAtIHdpZHRoIC8gMjsKICAgICAgICAgICAgICAgIGNvbnN0IGR5ID0geSAtIGhlaWdodCAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBNYXRoLmF0YW4yKGR5LCBkeCkgKyBjZW50ZXJTd2lybCAqICgxIC0gZGlzdCAqIHJhZGl1c0ZhY3Rvcik7CgogICAgICAgICAgICAgICAgY29uc3QgZGlzcGxhY2VkWCA9IE1hdGgucm91bmQod2lkdGggLyAyICsgZGlzdCAqIE1hdGguY29zKGFuZ2xlKSk7CiAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGFjZWRZID0gTWF0aC5yb3VuZChoZWlnaHQgLyAyICsgZGlzdCAqIE1hdGguc2luKGFuZ2xlKSk7CgogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlWCA9IE1hdGgubWF4KDAsIE1hdGgubWluKHdpZHRoIC0gMSwgZGlzcGxhY2VkWCkpOwogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlWSA9IE1hdGgubWF4KDAsIE1hdGgubWluKGhlaWdodCAtIDEsIGRpc3BsYWNlZFkpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUkgPSAoc291cmNlWSAqIHdpZHRoICsgc291cmNlWCkgKiA0OwoKICAgICAgICAgICAgICAgIGNvbnN0IGJsZW5kRmFjdG9yID0gZWFzZWRUOyAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaV0gPSBNYXRoLnJvdW5kKHNyY0RhdGEuZGF0YVtzb3VyY2VJXSAqICgxIC0gYmxlbmRGYWN0b3IpICsgZGVzdERhdGEuZGF0YVtpXSAqIGJsZW5kRmFjdG9yKTsgCiAgICAgICAgICAgICAgICBuZXdJbWFnZURhdGEuZGF0YVtpKzFdID0gTWF0aC5yb3VuZChzcmNEYXRhLmRhdGFbc291cmNlSSsxXSAqICgxIC0gYmxlbmRGYWN0b3IpICsgZGVzdERhdGEuZGF0YVtpKzFdICogYmxlbmRGYWN0b3IpOyAKICAgICAgICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2krMl0gPSBNYXRoLnJvdW5kKHNyY0RhdGEuZGF0YVtzb3VyY2VJKzJdICogKDEgLSBibGVuZEZhY3RvcikgKyBkZXN0RGF0YS5kYXRhW2krMl0gKiBibGVuZEZhY3Rvcik7IAogICAgICAgICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSszXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG5ld0ltYWdlRGF0YSwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDI4LiBFeHBhbmRpbmcgQ2lyY2xlIFJldmVhbCAoSW5kZXggMTI5KSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEyOV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCwgc3JjRGF0YTogbnVsbCwgZGVzdERhdGE6IG51bGwgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICBpZiAodHlwZW9mIGdldFBpeGVsRGF0YSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5zcmNEYXRhID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmRlc3REYXRhID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgIGNvbnN0IHsgc3JjRGF0YSwgZGVzdERhdGEgfSA9IHVuaXF1ZVN0YXRlOwoKICAgICAgICBpZiAoIXNyY0RhdGEgfHwgIWRlc3REYXRhIHx8IHR5cGVvZiBjdHgucHV0SW1hZ2VEYXRhICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBzcmNEYXRhLndpZHRoLCBoZWlnaHQgPSBzcmNEYXRhLmhlaWdodDsKICAgICAgICAgICAgY29uc3QgbmV3SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY29uc3QgZGF0YUxlbmd0aCA9IHNyY0RhdGEuZGF0YS5sZW5ndGg7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlclkgPSBoZWlnaHQgLyAyOwogICAgICAgICAgICBjb25zdCBtYXhSYWRpdXMgPSBNYXRoLnNxcnQoY2VudGVyWCAqIGNlbnRlclggKyBjZW50ZXJZICogY2VudGVyWSk7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFMZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgY29uc3QgeCA9IChpIC8gNCkgJSB3aWR0aDsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKChpIC8gNCkgLyB3aWR0aCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLnNxcnQoTWF0aC5wb3coeCAtIGNlbnRlclgsIDIpICsgTWF0aC5wb3coeSAtIGNlbnRlclksIDIpKTsKICAgICAgICAgICAgICAgIGNvbnN0IHBpeGVsUHJvZ3Jlc3MgPSBkaXN0IC8gbWF4UmFkaXVzOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBibGVuZCA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIChlYXNlZFQgLSBwaXhlbFByb2dyZXNzKSAqIDUpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaV0gPSBNYXRoLnJvdW5kKHNyY0RhdGEuZGF0YVtpXSAqICgxIC0gYmxlbmQpICsgZGVzdERhdGEuZGF0YVtpXSAqIGJsZW5kKTsgCiAgICAgICAgICAgICAgICBuZXdJbWFnZURhdGEuZGF0YVtpKzFdID0gTWF0aC5yb3VuZChzcmNEYXRhLmRhdGFbaSsxXSAqICgxIC0gYmxlbmQpICsgZGVzdERhdGEuZGF0YVtpKzFdICogYmxlbmQpOyAKICAgICAgICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2krMl0gPSBNYXRoLnJvdW5kKHNyY0RhdGEuZGF0YVtpKzJdICogKDEgLSBibGVuZCkgKyBkZXN0RGF0YS5kYXRhW2krMl0gKiBibGVuZCk7IAogICAgICAgICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSszXSA9IDI1NTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKG5ld0ltYWdlRGF0YSwgMCwgMCk7CiAgICAgICAgfQoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDI5LiBXaXBlIGZyb20gRWRnZSAoSW5kZXggMTMwKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEzMF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCwgc3JjRGF0YTogbnVsbCwgZGVzdERhdGE6IG51bGwgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICBpZiAodHlwZW9mIGdldFBpeGVsRGF0YSA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5zcmNEYXRhID0gZ2V0UGl4ZWxEYXRhKGN1cnJlbnRJbWFnZSk7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmRlc3REYXRhID0gZ2V0UGl4ZWxEYXRhKG5leHRJbWFnZSk7CiAgICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgIGNvbnN0IHsgc3JjRGF0YSwgZGVzdERhdGEgfSA9IHVuaXF1ZVN0YXRlOwoKICAgICAgICBpZiAoIXNyY0RhdGEgfHwgIWRlc3REYXRhIHx8IHR5cGVvZiBjdHgucHV0SW1hZ2VEYXRhICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3Qgd2lkdGggPSBzcmNEYXRhLndpZHRoLCBoZWlnaHQgPSBzcmNEYXRhLmhlaWdodDsKICAgICAgICAgICAgY29uc3QgbmV3SW1hZ2VEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY29uc3QgZGF0YUxlbmd0aCA9IHNyY0RhdGEuZGF0YS5sZW5ndGg7CiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFMZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgY29uc3QgeSA9IE1hdGguZmxvb3IoKGkgLyA0KSAvIHdpZHRoKTsKICAgICAgICAgICAgICAgIGNvbnN0IHJldmVhbEZhY3RvciA9IHkgLyBoZWlnaHQ7IAogICAgICAgICAgICAgICAgY29uc3QgYmxlbmQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCAoZWFzZWRUIC0gcmV2ZWFsRmFjdG9yKSAqIDUpKTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2ldID0gTWF0aC5yb3VuZChzcmNEYXRhLmRhdGFbaV0gKiAoMSAtIGJsZW5kKSArIGRlc3REYXRhLmRhdGFbaV0gKiBibGVuZCk7IAogICAgICAgICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSsxXSA9IE1hdGgucm91bmQoc3JjRGF0YS5kYXRhW2krMV0gKiAoMSAtIGJsZW5kKSArIGRlc3REYXRhLmRhdGFbaSsxXSAqIGJsZW5kKTsgCiAgICAgICAgICAgICAgICBuZXdJbWFnZURhdGEuZGF0YVtpKzJdID0gTWF0aC5yb3VuZChzcmNEYXRhLmRhdGFbaSsyXSAqICgxIC0gYmxlbmQpICsgZGVzdERhdGEuZGF0YVtpKzJdICogYmxlbmQpOyAKICAgICAgICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2krM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShuZXdJbWFnZURhdGEsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vIC0tLSAzMC4gUGl4ZWwgRGlzcGxhY2VtZW50IChJbmRleCAxMzEpIC0tLQpBTklNQVRJT05fTE9HSUNbMTMxXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwLCBzcmNEYXRhOiBudWxsLCBkZXN0RGF0YTogbnVsbCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOwogICAgICAgIGlmICh0eXBlb2YgZ2V0UGl4ZWxEYXRhID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnNyY0RhdGEgPSBnZXRQaXhlbERhdGEoY3VycmVudEltYWdlKTsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuZGVzdERhdGEgPSBnZXRQaXhlbERhdGEobmV4dEltYWdlKTsKICAgICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAgY29uc3QgeyBzcmNEYXRhLCBkZXN0RGF0YSB9ID0gdW5pcXVlU3RhdGU7CgogICAgICAgIGlmICghc3JjRGF0YSB8fCAhZGVzdERhdGEgfHwgdHlwZW9mIGN0eC5wdXRJbWFnZURhdGEgIT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgICAgICBkcmF3Q292ZXJJbWFnZShjdXJyZW50SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRUOwogICAgICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zdCB3aWR0aCA9IHNyY0RhdGEud2lkdGgsIGhlaWdodCA9IHNyY0RhdGEuaGVpZ2h0OwogICAgICAgICAgICBjb25zdCBuZXdJbWFnZURhdGEgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBjb25zdCBkYXRhTGVuZ3RoID0gc3JjRGF0YS5kYXRhLmxlbmd0aDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGRpc3BsYWNlbWVudEZhY3RvciA9IGxlcnAoMCwgNTAsIE1hdGguc2luKGVhc2VkVCAqIE1hdGguUEkpKTsKICAgICAgICAgICAgY29uc3Qgd2F2ZUZyZXF1ZW5jeSA9IDAuMDU7CgogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFMZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgY29uc3QgeCA9IChpIC8gNCkgJSB3aWR0aDsKICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBNYXRoLmZsb29yKChpIC8gNCkgLyB3aWR0aCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFggPSBNYXRoLnNpbih5ICogd2F2ZUZyZXF1ZW5jeSArIGVhc2VkVCAqIE1hdGguUEkgKiAyKSAqIGRpc3BsYWNlbWVudEZhY3RvcjsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLmNvcyh4ICogd2F2ZUZyZXF1ZW5jeSArIGVhc2VkVCAqIE1hdGguUEkgKiAyKSAqIGRpc3BsYWNlbWVudEZhY3RvcjsKCiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VYID0gTWF0aC5tYXgoMCwgTWF0aC5taW4od2lkdGggLSAxLCBNYXRoLnJvdW5kKHggLSBvZmZzZXRYKSkpOwogICAgICAgICAgICAgICAgY29uc3Qgc291cmNlWSA9IE1hdGgubWF4KDAsIE1hdGgubWluKGhlaWdodCAtIDEsIE1hdGgucm91bmQoeSAtIG9mZnNldFkpKSk7CiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VJID0gKHNvdXJjZVkgKiB3aWR0aCArIHNvdXJjZVgpICogNDsKCiAgICAgICAgICAgICAgICBjb25zdCBibGVuZEZhY3RvciA9IGVhc2VkVDsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2ldID0gTWF0aC5yb3VuZChzcmNEYXRhLmRhdGFbc291cmNlSV0gKiAoMSAtIGJsZW5kRmFjdG9yKSArIGRlc3REYXRhLmRhdGFbaV0gKiBibGVuZEZhY3Rvcik7IAogICAgICAgICAgICAgICAgbmV3SW1hZ2VEYXRhLmRhdGFbaSsxXSA9IE1hdGgucm91bmQoc3JjRGF0YS5kYXRhW3NvdXJjZUkrMV0gKiAoMSAtIGJsZW5kRmFjdG9yKSArIGRlc3REYXRhLmRhdGFbaSsxXSAqIGJsZW5kRmFjdG9yKTsgCiAgICAgICAgICAgICAgICBuZXdJbWFnZURhdGEuZGF0YVtpKzJdID0gTWF0aC5yb3VuZChzcmNEYXRhLmRhdGFbc291cmNlSSsyXSAqICgxIC0gYmxlbmRGYWN0b3IpICsgZGVzdERhdGEuZGF0YVtpKzJdICogYmxlbmRGYWN0b3IpOyAKICAgICAgICAgICAgICAgIG5ld0ltYWdlRGF0YS5kYXRhW2krM10gPSAyNTU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShuZXdJbWFnZURhdGEsIDAsIDApOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYikgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYisrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQovLyBFWFRSQUNURUQgRlJPTSAwMl84MDg4Lmh0bWwgKDQgQW5pbWF0aW9uczogMTMyLTEzNSkKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0gMzEuIERpc3NvbHZlIFNwaW4gKEluZGV4IDEzMikgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMzJdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsgfQogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCiAgICAgICAgY29uc3QgY2FudmFzVyA9IFdJRFRIOyBjb25zdCAgY2FudmFzSCA9IEhFSUdIVDsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IHJvdDEgPSBsZXJwKDAsIE1hdGguUEkgLyA0LCBlYXNlZFQpOwogICAgICAgIGNvbnN0IGFscGhhMSA9IGxlcnAoMSwgMCwgZWFzZWRUKTsKICAgICAgICAKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTE7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjYW52YXNXIC8gMiwgY2FudmFzSCAvIDIpOwogICAgICAgIGN0eC5yb3RhdGUocm90MSk7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSgtY2FudmFzVyAvIDIsIC1jYW52YXNIIC8gMik7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UoY3VycmVudEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCByb3QyID0gbGVycCgtTWF0aC5QSSAvIDQsIDAsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGEyID0gbGVycCgwLCAxLCBlYXNlZFQpOwoKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTI7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjYW52YXNXIC8gMiwgY2FudmFzSCAvIDIpOwogICAgICAgIGN0eC5yb3RhdGUocm90Mik7CiAgICAgICAgY3R4LnRyYW5zbGF0ZSgtY2FudmFzVyAvIDIsIC1jYW52YXNIIC8gMik7CiAgICAgICAgZHJhd0NvdmVySW1hZ2UobmV4dEltYWdlLCBjdHgsIGNhbnZhcywgMSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vIC0tLSAzMi4gWm9vbSBGb2N1cyAoSW5kZXggMTMzKSAtLS0KQU5JTUFUSU9OX0xPR0lDWzEzM10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXNiYjogMTIwLCBjdXJyZW50RnJhbWViYjogMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPSAwOyB9CiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmI7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhc1csIGNhbnZhc0gpOwogICAgICAgIAogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY29uc3Qgc2NhbGUxID0gbGVycCgxLCAxLjUsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYmx1cjEgPSBsZXJwKDAsIDUsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGExID0gbGVycCgxLCAwLCBlYXNlZFQpOwogICAgICAgIAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMTsKICAgICAgICBjdHguZmlsdGVyID0gYGJsdXIoJHtibHVyMX1weClgOwogICAgICAgIGN0eC50cmFuc2xhdGUoY2FudmFzVyAvIDIsIGNhbnZhc0ggLyAyKTsKICAgICAgICBjdHguc2NhbGUoc2NhbGUxLCBzY2FsZTEpOwogICAgICAgIGN0eC50cmFuc2xhdGUoLWNhbnZhc1cgLyAyLCAtY2FudmFzSCAvIDIpOwogICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY29uc3Qgc2NhbGUyID0gbGVycCgxLjUsIDEsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYmx1cjIgPSBsZXJwKDUsIDAsIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGEyID0gbGVycCgwLCAxLCBlYXNlZFQpOwoKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTI7CiAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7Ymx1cjJ9cHgpYDsKICAgICAgICBjdHgudHJhbnNsYXRlKGNhbnZhc1cgLyAyLCBjYW52YXNIIC8gMik7CiAgICAgICAgY3R4LnNjYWxlKHNjYWxlMiwgc2NhbGUyKTsKICAgICAgICBjdHgudHJhbnNsYXRlKC1jYW52YXNXIC8gMiwgLWNhbnZhc0ggLyAyKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tIDMzLiBTa2V3IFNsaWRlIChJbmRleCAxMzQpIC0tLQpBTklNQVRJT05fTE9HSUNbMTM0XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lc2JiOiAxMjAsIGN1cnJlbnRGcmFtZWJiOiAwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7IH0KICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgIAogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBXSURUSDsgY29uc3QgIGNhbnZhc0ggPSBIRUlHSFQ7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBza2V3MSA9IGxlcnAoMCwgMC41LCBlYXNlZFQpOwogICAgICAgIGNvbnN0IHNsaWRlWDEgPSBsZXJwKDAsIGNhbnZhc1csIGVhc2VkVCk7CiAgICAgICAgY29uc3QgYWxwaGExID0gbGVycCgxLCAwLCBlYXNlZFQpOwogICAgICAgIAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMTsKICAgICAgICBjdHgudHJhbnNsYXRlKHNsaWRlWDEsIDApOwogICAgICAgIGN0eC50cmFuc2Zvcm0oMSwgMCwgc2tldzEsIDEsIDAsIDApOwogICAgICAgIGRyYXdDb3ZlckltYWdlKGN1cnJlbnRJbWFnZSwgY3R4LCBjYW52YXMsIDEpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY29uc3Qgc2tldzIgPSBsZXJwKDAuNSwgMCwgZWFzZWRUKTsKICAgICAgICBjb25zdCBzbGlkZVgyID0gbGVycCgtY2FudmFzVywgMCwgZWFzZWRUKTsKICAgICAgICBjb25zdCBhbHBoYTIgPSBsZXJwKDAsIDEsIGVhc2VkVCk7CgogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhMjsKICAgICAgICBjdHgudHJhbnNsYXRlKHNsaWRlWDIsIDApOwogICAgICAgIGN0eC50cmFuc2Zvcm0oMSwgMCwgLXNrZXcyLCAxLCAwLCAwKTsKICAgICAgICBkcmF3Q292ZXJJbWFnZShuZXh0SW1hZ2UsIGN0eCwgY2FudmFzLCAxKTsKICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCi8vIEVYVFJBQ1RFRCBGUk9NIDAyXzkxNDguaHRtbCAoMSBBbmltYXRpb246IDEzNikKLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tCgovLyAtLS0gMzUuIFBpZWNlLXdpc2UgQ2hhb3MgKEluZGV4IDEzNikgLS0tCkFOSU1BVElPTl9MT0dJQ1sxMzVdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzYmI6IDEyMCwgY3VycmVudEZyYW1lYmI6IDAsIHBpZWNlczogW10sIG51bVg6IDEwLCBudW1ZOiA4LCBpbml0aWFsaXplZDogZmFsc2UgfTsKICAgIAogICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVBpZWNlcyhjYW52YXMpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5waWVjZXMgPSBbXTsKICAgICAgICBjb25zdCBjYW52YXNXID0gV0lEVEg7IGNvbnN0ICBjYW52YXNIID0gSEVJR0hUOwogICAgICAgIGNvbnN0IHBpZWNlVyA9IGNhbnZhc1cgLyB1bmlxdWVTdGF0ZS5udW1YOwogICAgICAgIGNvbnN0IHBpZWNlSCA9IGNhbnZhc0ggLyB1bmlxdWVTdGF0ZS5udW1ZOwogICAgICAgIGNvbnN0IHR5cGVzID0gWydzbGlkZScsICdzY2FsZScsICdyb3RhdGUnLCAnc2tldyddOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdW5pcXVlU3RhdGUubnVtWTsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdW5pcXVlU3RhdGUubnVtWDsgeCsrKSB7CiAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gdHlwZXNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogdHlwZXMubGVuZ3RoKV07CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVuaXF1ZVN0YXRlLnBpZWNlcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICB4OiB4ICogcGllY2VXLCB5OiB5ICogcGllY2VILCB3OiBwaWVjZVcsIGg6IHBpZWNlSCwKICAgICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlLAogICAgICAgICAgICAgICAgICAgIHJvdDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTWF0aC5QSSwKICAgICAgICAgICAgICAgICAgICBzY2FsZTogMC41ICsgTWF0aC5yYW5kb20oKSAqIDAuNSwKICAgICAgICAgICAgICAgICAgICB0cmFuc1g6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIGNhbnZhc1cgKiAwLjgsCiAgICAgICAgICAgICAgICAgICAgdHJhbnNZOiAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiBjYW52YXNIICogMC44LAogICAgICAgICAgICAgICAgICAgIHNrZXc6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDAuNQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgfQoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiID0gMDsKICAgICAgICBpbml0aWFsaXplUGllY2VzKGNhbnZhcyk7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgaWYgKCF1bmlxdWVTdGF0ZS5pbml0aWFsaXplZCkgeyBpbml0KCk7IH0KICAgICAgICAKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOwogICAgICAgCgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAKICAgICAgICB1bmlxdWVTdGF0ZS5waWVjZXMuZm9yRWFjaChwaWVjZSA9PiB7CiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUocGllY2UueCArIHBpZWNlLncgLyAyLCBwaWVjZS55ICsgcGllY2UuaCAvIDIpOwoKICAgICAgICAgICAgbGV0IGFscGhhID0gMTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSBJbWFnZSAxIChmYWRpbmcgb3V0KSAtLS0KICAgICAgICAgICAgaWYgKHQgPCAwLjUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gZWFzZWRUICogMjsKICAgICAgICAgICAgICAgIGFscGhhID0gbGVycCgxLCAwLCBwcm9ncmVzcyk7CgogICAgICAgICAgICAgICAgaWYgKHBpZWNlLnR5cGUgPT09ICdzbGlkZScpIHsgY3R4LnRyYW5zbGF0ZShwaWVjZS50cmFuc1ggKiBwcm9ncmVzcywgcGllY2UudHJhbnNZICogcHJvZ3Jlc3MpOyB9IAogICAgICAgICAgICAgICAgZWxzZSBpZiAocGllY2UudHlwZSA9PT0gJ3NjYWxlJykgeyBjdHguc2NhbGUobGVycCgxLCAwLjEsIHByb2dyZXNzKSwgbGVycCgxLCAwLjEsIHByb2dyZXNzKSk7IH0gCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwaWVjZS50eXBlID09PSAncm90YXRlJykgeyBjdHgucm90YXRlKHBpZWNlLnJvdCAqIHByb2dyZXNzKTsgfSAKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnR5cGUgPT09ICdza2V3JykgeyBjdHgudHJhbnNmb3JtKDEsIDAsIHBpZWNlLnNrZXcgKiBwcm9ncmVzcywgMSwgMCwgMCk7IH0KCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCBwaWVjZS54LCBwaWVjZS55LCBwaWVjZS53LCBwaWVjZS5oLCAtcGllY2UudyAvIDIsIC1waWVjZS5oIC8gMiwgcGllY2UudywgcGllY2UuaCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIC0tLSBJbWFnZSAyIChmYWRpbmcgaW4pIC0tLQogICAgICAgICAgICBpZiAodCA+PSAwLjUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gKGVhc2VkVCAtIDAuNSkgKiAyOwogICAgICAgICAgICAgICAgYWxwaGEgPSBsZXJwKDAsIDEsIHByb2dyZXNzKTsKCiAgICAgICAgICAgICAgICBpZiAocGllY2UudHlwZSA9PT0gJ3NsaWRlJykgeyBjdHgudHJhbnNsYXRlKHBpZWNlLnRyYW5zWCAqICgxIC0gcHJvZ3Jlc3MpLCBwaWVjZS50cmFuc1kgKiAoMSAtIHByb2dyZXNzKSk7IH0gCiAgICAgICAgICAgICAgICBlbHNlIGlmIChwaWVjZS50eXBlID09PSAnc2NhbGUnKSB7IGN0eC5zY2FsZShsZXJwKDAuMSwgMSwgcHJvZ3Jlc3MpLCBsZXJwKDAuMSwgMSwgcHJvZ3Jlc3MpKTsgfSAKICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBpZWNlLnR5cGUgPT09ICdyb3RhdGUnKSB7IGN0eC5yb3RhdGUocGllY2Uucm90ICogKDEgLSBwcm9ncmVzcykpOyB9IAogICAgICAgICAgICAgICAgZWxzZSBpZiAocGllY2UudHlwZSA9PT0gJ3NrZXcnKSB7IGN0eC50cmFuc2Zvcm0oMSwgMCwgcGllY2Uuc2tldyAqICgxIC0gcHJvZ3Jlc3MpLCAxLCAwLCAwKTsgfQoKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIHBpZWNlLngsIHBpZWNlLnksIHBpZWNlLncsIHBpZWNlLmgsIC1waWVjZS53IC8gMiwgLXBpZWNlLmggLyAyLCBwaWVjZS53LCBwaWVjZS5oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9KTsKICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lc2JiKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewkKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgoKCgoKCgoKCgoKCgoKCgovLyBGdW5jdGllIHZvb3IgdmxvZWllbmRlIG92ZXJnYW5nZW4gKEN1YmljIEVhc2UgSW4vT3V0KQpjb25zdCBlYXNlSW5PdXRDdWJpYyA9ICh0KSA9PiB0IDwgMC41ID8gNCAqIHQgKiB0ICogdCA6ICh0IC0gMSkgKiAoMiAqIHQgLSAyKSAqICgyICogdCAtIDIpICsgMTsKLy8gQkVMQU5HUklKSzogQWxsZSBBTklNQVRJT05fTE9HSUMgZnVuY3RpZXMgaGllcm9uZGVyIGdhYW4gZXJ2YW4gdWl0IGRhdAovLyAnY2FudmFzJywgJ2N0eCcsICdjdXJyZW50SW1hZ2UnLCAnbmV4dEltYWdlJywgZW4gJ3N0YXJ0TmV4dFRyYW5zaXRpb24nCi8vIGdsb2JhYWwgYmVzY2hpa2JhYXIgemlqbi4KCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDEzNy4gUXVhbnR1bSBTcGxpdC1TY3JlZW4gKERlIFF1YW50dW0gS2Fuc2VuKSAtIEdFQ09SUklHRUVSRAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMTM3XSA9IChmdW5jdGlvbigpIHsKICAgIGxldCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICB0b3RhbEZyYW1lczogOTAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICBzbGljZXM6IDYwLCAKICAgIH07CgogICAgY29uc3QgZ2V0UHJvYmFiaWxpdHkgPSAodCkgPT4gdCA8IDAuNSA/IDQgKiB0ICogdCAqIHQgOiAodCAtIDEpICogKDIgKiB0IC0gMikgKiAoMiAqIHQgLSAyKSArIDE7CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3Qgc2xpY2VXaWR0aCA9IHdpZHRoIC8gdW5pcXVlU3RhdGUuc2xpY2VzOwogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgcHJvYmFiaWxpdHlGYWN0b3IgPSBnZXRQcm9iYWJpbGl0eShwcm9ncmVzcyk7IAoKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5zbGljZXM7IGkrKykgewogICAgICAgICAgICBjb25zdCB4ID0gaSAqIHNsaWNlV2lkdGg7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBpbWFnZVRvRHJhdyA9IChNYXRoLnJhbmRvbSgpIDwgcHJvYmFiaWxpdHlGYWN0b3IpID8gbmV4dEltYWdlIDogY3VycmVudEltYWdlOwoKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgIGltYWdlVG9EcmF3LCAKICAgICAgICAgICAgICAgIHgsIDAsIHNsaWNlV2lkdGgsIGhlaWdodCwgCiAgICAgICAgICAgICAgICB4LCAwLCBzbGljZVdpZHRoLCBoZWlnaHQKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7IAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIAogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTM4LiBUaGUgR2xpdGNoIFdlYXZlIChIZXQgR2xpdGNoIFdlZWZzZWwpIC0gR0VDT1JSSUdFRVJECi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1sxMzhdID0gKGZ1bmN0aW9uKCkgewogICAgbGV0IHVuaXF1ZVN0YXRlID0gewogICAgICAgIHRvdGFsRnJhbWVzOiA2MCwKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGhyZWFkczogODAsIAogICAgICAgIG1heE9mZnNldDogNTAsIAogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICB9CgogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCB0aHJlYWRIZWlnaHQgPSBoZWlnaHQgLyB1bmlxdWVTdGF0ZS50aHJlYWRzOwogICAgICAgIGNvbnN0IHByb2dyZXNzID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRQcm9ncmVzcyA9IGVhc2VJbk91dEN1YmljKHByb2dyZXNzKTsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pcXVlU3RhdGUudGhyZWFkczsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHkgPSBpICogdGhyZWFkSGVpZ2h0OwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZGlyZWN0aW9uID0gKGkgJSAyID09PSAwKSA/IDEgOiAtMTsKICAgICAgICAgICAgY29uc3Qgb2Zmc2V0ID0gZGlyZWN0aW9uICogdW5pcXVlU3RhdGUubWF4T2Zmc2V0ICogZWFzZWRQcm9ncmVzczsKCiAgICAgICAgICAgIC8vIERlZWwgMTogR2xpdGNoIChUZWtlbnQgZGUgb3VkZSBzY8OobmUgbWV0IHZlcnNjaHVpdmluZykKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSwgCiAgICAgICAgICAgICAgICAwLCB5LCB3aWR0aCwgdGhyZWFkSGVpZ2h0LCAKICAgICAgICAgICAgICAgIG9mZnNldCwgeSwgd2lkdGgsIHRocmVhZEhlaWdodAogICAgICAgICAgICApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGVlbCAyOiBXZWF2ZSAoVGVrZW50IGRlIG5pZXV3ZSBzY8OobmUgb3ZlciBkZSB2ZXJzY2hvdmVuIHJ1aW10ZSkKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRQcm9ncmVzczsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgIG5leHRJbWFnZSwgCiAgICAgICAgICAgICAgICAwLCB5LCB3aWR0aCwgdGhyZWFkSGVpZ2h0LCAKICAgICAgICAgICAgICAgIDAsIHksIHdpZHRoLCB0aHJlYWRIZWlnaHQKICAgICAgICAgICAgKTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMTsgCiAgICAgICAgfQogICAgICAgIAogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOyAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDEzOS4gVGhlIFZveGVsIE1lbHQgKERlIFZveGVsIFNtZWx0aW5nKSAtIEdFQ09SUklHRUVSRAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMTM5XSA9IChmdW5jdGlvbigpIHsKICAgIGxldCB1bmlxdWVTdGF0ZSA9IHsKICAgICAgICB0b3RhbEZyYW1lczogMTIwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdm94ZWxTaXplOiAxMCwgCiAgICAgICAgdm94ZWxzOiBbXSwKICAgIH07CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIHVuaXF1ZVN0YXRlLnZveGVscyA9IFtdOwogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgCiAgICAgICAgY29uc3QgcGhhc2UxX3Byb2dyZXNzID0gTWF0aC5taW4oMSwgcHJvZ3Jlc3MgKiAyKTsKICAgICAgICBjb25zdCBwaGFzZTJfcHJvZ3Jlc3MgPSBNYXRoLm1heCgwLCAocHJvZ3Jlc3MgLSAwLjUpICogMik7IAogICAgICAgIAogICAgICAgIC8vIEZBU0UgMTogVm94ZWwgTWVsdAogICAgICAgIGlmIChwcm9ncmVzcyA8PSAwLjUpIHsKICAgICAgICAgICAgY29uc3QgY3VycmVudE1lbHRIZWlnaHQgPSBoZWlnaHQgKiBlYXNlSW5RdWFkKHBoYXNlMV9wcm9ncmVzcyk7IAogICAgICAgICAgICBjb25zdCByZW1haW5pbmdIZWlnaHQgPSBoZWlnaHQgLSBjdXJyZW50TWVsdEhlaWdodDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICBjdXJyZW50SW1hZ2UsIAogICAgICAgICAgICAgICAgMCwgMCwgd2lkdGgsIHJlbWFpbmluZ0hlaWdodCwgCiAgICAgICAgICAgICAgICAwLCAwLCB3aWR0aCwgcmVtYWluaW5nSGVpZ2h0CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZBU0UgMjogVm94ZWwgR3JvdwogICAgICAgIGlmIChwcm9ncmVzcyA+PSAwLjUpIHsKICAgICAgICAgICAgY29uc3QgcmV2ZWFsSGVpZ2h0ID0gaGVpZ2h0ICogZWFzZU91dFF1YWQocGhhc2UyX3Byb2dyZXNzKTsKICAgICAgICAgICAgY29uc3QgZGVzdGluYXRpb25ZID0gaGVpZ2h0IC0gcmV2ZWFsSGVpZ2h0OwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSgKICAgICAgICAgICAgICAgIG5leHRJbWFnZSwgCiAgICAgICAgICAgICAgICAwLCBkZXN0aW5hdGlvblksIHdpZHRoLCByZXZlYWxIZWlnaHQsIAogICAgICAgICAgICAgICAgMCwgZGVzdGluYXRpb25ZLCB3aWR0aCwgcmV2ZWFsSGVpZ2h0CiAgICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOyAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE0MC4gV2F2ZSBSZXZlYWwgLSBHRUNPUlJJR0VFUkQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzE0MF0gPSAoZnVuY3Rpb24oKSB7CiAgICBsZXQgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxMjAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwgCiAgICAgICAgbnVtU3RyaXBzOiA1MCwKICAgIH07CiAgICAKICAgIGNvbnN0IGxlcnAgPSAoYSwgYiwgdCkgPT4gYSArIChiIC0gYSkgKiB0OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gY2FudmFzLndpZHRoOyAKICAgICAgICBjb25zdCBjYW52YXNIID0gY2FudmFzLmhlaWdodDsKICAgICAgICBjb25zdCBzdHJpcFdpZHRoID0gY2FudmFzVyAvIHVuaXF1ZVN0YXRlLm51bVN0cmlwczsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAKICAgICAgICBjb25zdCBhbXBsaXR1ZGUgPSAzMCAqIE1hdGguc2luKGVhc2VkVCAqIE1hdGguUEkpOwogICAgICAgIGNvbnN0IHdhdmVTcGVlZCA9IHQgKiAyICogTWF0aC5QSTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1TdHJpcHM7IGkrKykgewogICAgICAgICAgICBjb25zdCB4ID0gaSAqIHN0cmlwV2lkdGg7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gYW1wbGl0dWRlICogTWF0aC5zaW4oaSAqIDAuNSArIHdhdmVTcGVlZCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBJbWFnZSAxIChmYWRpbmcgb3V0KQogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KHgsIDAsIHN0cmlwV2lkdGgsIGNhbnZhc0gpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBsZXJwKDEsIDAsIGVhc2VkVCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgZHkgKiAoMSAtIGVhc2VkVCkpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7IAogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gSW1hZ2UgMiAoZmFkaW5nIGluKQogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KHgsIDAsIHN0cmlwV2lkdGgsIGNhbnZhc0gpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBsZXJwKDAsIDEsIGVhc2VkVCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgZHkgKiBlYXNlZFQpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7IAogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgY2FudmFzVywgY2FudmFzSCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNDEuIFdhdmUgU3RyaXAgU2xpZGUgLSBHRUNPUlJJR0VFUkQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzE0MV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXNiYjogOTAsIAogICAgICAgIGN1cnJlbnRGcmFtZWJiOiAwLCAKICAgICAgICBudW1TdHJpcHM6IDQwLCAKICAgICAgICBtYXhPZmZzZXQ6IDE1MCwgCiAgICAgICAgaW5pdGlhbGl6ZWQ6IGZhbHNlIAogICAgfTsKICAgIAogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA9IDA7CiAgICAgICAgdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQgPSB0cnVlOwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGlmICghdW5pcXVlU3RhdGUuaW5pdGlhbGl6ZWQpIHsgaW5pdCgpOyB9CiAgICAgICAgCiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZWJiIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXNiYjsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsKICAgICAgICAKICAgICAgICBjb25zdCBjYW52YXNXID0gY2FudmFzLndpZHRoOyAKICAgICAgICBjb25zdCBjYW52YXNIID0gY2FudmFzLmhlaWdodDsKICAgICAgICBjb25zdCBzdHJpcFdpZHRoID0gY2FudmFzVyAvIHVuaXF1ZVN0YXRlLm51bVN0cmlwczsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXNXLCBjYW52YXNIKTsKICAgICAgICAKICAgICAgICBjb25zdCB3YXZlRnJlcXVlbmN5ID0gMC4wNTsgCiAgICAgICAgY29uc3QgYW1wbGl0dWRlID0gMzA7IAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVuaXF1ZVN0YXRlLm51bVN0cmlwczsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSBpICogc3RyaXBXaWR0aDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IHdhdmVPZmZzZXQgPSBhbXBsaXR1ZGUgKiBNYXRoLnNpbihpICogd2F2ZUZyZXF1ZW5jeSArIGVhc2VkVCAqIE1hdGguUEkgKiAyKTsKCiAgICAgICAgICAgIC8vIEltYWdlIDEgKGN1cnJlbnRJbWFnZSAtIHNjaHVpZnQgdWl0KQogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KHgsIDAsIHN0cmlwV2lkdGgsIGNhbnZhc0gpOwogICAgICAgICAgICBjdHguY2xpcCgpOwoKICAgICAgICAgICAgY29uc3QgdHJhbnNsYXRlWCA9IGxlcnAoMCwgLXVuaXF1ZVN0YXRlLm1heE9mZnNldCwgZWFzZWRUKTsgCiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUodHJhbnNsYXRlWCwgd2F2ZU9mZnNldCAqICgxIC0gZWFzZWRUKSk7IAoKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gbGVycCgxLCAwLCBlYXNlZFQpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgeCwgMCwgc3RyaXBXaWR0aCwgY2FudmFzSCwgeCwgMCwgc3RyaXBXaWR0aCwgY2FudmFzSCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEltYWdlIDIgKG5leHRJbWFnZSAtIHNjaHVpZnQgaW4pCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LnJlY3QoeCwgMCwgc3RyaXBXaWR0aCwgY2FudmFzSCk7CiAgICAgICAgICAgIGN0eC5jbGlwKCk7CgogICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVYSW4gPSBsZXJwKHVuaXF1ZVN0YXRlLm1heE9mZnNldCwgMCwgZWFzZWRUKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSh0cmFuc2xhdGVYSW4sIHdhdmVPZmZzZXQgKiBlYXNlZFQpOyAKCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGxlcnAoMCwgMSwgZWFzZWRUKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIHgsIDAsIHN0cmlwV2lkdGgsIGNhbnZhc0gsIHgsIDAsIHN0cmlwV2lkdGgsIGNhbnZhc0gpOyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWViYiA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzYmIpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lYmIrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOyAKICAgICAgICB9IGVsc2UgewkKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNDIuIFJhZGlhbCBXaXBlIChDaXJrZWwgb250aHVsbGluZykKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzE0Ml0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDkwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIAogICAgICAgIC8vIERlIG1heGltYWxlIHN0cmFhbCBpcyBkZSBhZnN0YW5kIHZhbiBoZXQgbWlkZGVuIHRvdCBkZSB2ZXJzdCB2ZXJ3aWpkZXJkZSBob2VrCiAgICAgICAgY29uc3QgbWF4UmFkaXVzID0gTWF0aC5zcXJ0KHdpZHRoICogd2lkdGggKyBoZWlnaHQgKiBoZWlnaHQpIC8gMjsKICAgICAgICBjb25zdCBjdXJyZW50UmFkaXVzID0gbWF4UmFkaXVzICogZWFzZWRUOwogICAgICAgIAogICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7CgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgIC8vIFRla2VuIGRlIG91ZGUgYWZiZWVsZGluZyB2b2xsZWRpZyAoYWxzIGFjaHRlcmdyb25kKQogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsgCgogICAgICAgIC8vIE51IGRlIG5pZXV3ZSBhZmJlZWxkaW5nIGNsaXBwZW4gaW4gZWVuIGdyb2VpZW5kZSBjaXJrZWwKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIAogICAgICAgIC8vIENyZcOrZXIgZGUgY2lya2VsIGNsaXAKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4LmFyYyhjZW50ZXJYLCBjZW50ZXJZLCBjdXJyZW50UmFkaXVzLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICAKICAgICAgICAvLyBUZWtlbiBkZSBuaWV1d2UgYWZiZWVsZGluZyAod29yZHQgYWxsZWVuIGdldG9vbmQgYmlubmVuIGRlIGNsaXApCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOyAKCiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gWm9yZyBlcnZvb3IgZGF0IGRlIG5pZXV3ZSBhZmJlZWxkaW5nIHZvbGxlZGlnIHdvcmR0IGdldG9vbmQKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTQzLiBDaGVja2VyYm9hcmQgRGlzc29sdmUgKFNjaGFha2JvcmQgT3Bsb3NzaW5nKQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbNV0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDEwMCwgCiAgICAgICAgY3VycmVudEZyYW1lOiAwLAogICAgICAgIG51bVg6IDEyLCAvLyAxMiBibG9ramVzIGhvcml6b250YWFsCiAgICAgICAgbnVtWTogMTAsIC8vIDEwIGJsb2tqZXMgdmVydGljYWFsCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIAogICAgICAgIGNvbnN0IHBpZWNlVyA9IHdpZHRoIC8gdW5pcXVlU3RhdGUubnVtWDsKICAgICAgICBjb25zdCBwaWVjZUggPSBoZWlnaHQgLyB1bmlxdWVTdGF0ZS5udW1ZOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB1bmlxdWVTdGF0ZS5udW1ZOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB1bmlxdWVTdGF0ZS5udW1YOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHggKiBwaWVjZVc7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFkgPSB5ICogcGllY2VIOwogICAgICAgICAgICAgICAgY29uc3QgaXNPZGQgPSAoeCArIHkpICUgMiAhPT0gMDsgLy8gQ2hlY2sgdm9vciBzY2hhYWtib3JkcGF0cm9vbgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBCZXBhYWwgZGUgcHJvZ3Jlc3Mgb3AgYmFzaXMgdmFuIGhldCBwYXRyb29uOiBvbmV2ZW4gY2VsbGVuIGluIGZhc2UgMSwgZXZlbiBpbiBmYXNlIDIKICAgICAgICAgICAgICAgIGxldCBjZWxsVDsKICAgICAgICAgICAgICAgIGlmIChpc09kZCkgewogICAgICAgICAgICAgICAgICAgIC8vIE9uZXZlbiBjZWxsZW4gbG9zc2VuIG9wIGluIGRlIGVlcnN0ZSBoZWxmdAogICAgICAgICAgICAgICAgICAgIGNlbGxUID0gTWF0aC5taW4oMSwgZWFzZWRUICogMik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEV2ZW4gY2VsbGVuIGxvc3NlbiBvcCBpbiBkZSB0d2VlZGUgaGVsZnQKICAgICAgICAgICAgICAgICAgICBjZWxsVCA9IE1hdGgubWF4KDAsIChlYXNlZFQgLSAwLjUpICogMik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNjaGFhbCB2b29yIGRlIG5pZXV3ZSAoaW5rb21lbmRlKSBjZWwKICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlTmV3ID0gY2VsbFQ7CiAgICAgICAgICAgICAgICAvLyBTY2hhYWwgdm9vciBkZSBvdWRlICh1aXRnYWFuZGUpIGNlbAogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGVPbGQgPSAxIC0gY2VsbFQ7CgogICAgICAgICAgICAgICAgLy8gLS0tIDEuIFRla2VuIGRlIG91ZGUgYWZiZWVsZGluZyAoa3JpbXB0KSAtLS0KICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHN0YXJ0WCArIHBpZWNlVyAvIDIsIHN0YXJ0WSArIHBpZWNlSCAvIDIpOwogICAgICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlT2xkLCBzY2FsZU9sZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICAgICAgY3VycmVudEltYWdlLCAKICAgICAgICAgICAgICAgICAgICBzdGFydFgsIHN0YXJ0WSwgcGllY2VXLCBwaWVjZUgsIC8vIEJyb246IGhldCBzdHVrIHVpdCBkZSBvdWRlIGFmYmVlbGRpbmcKICAgICAgICAgICAgICAgICAgICAtcGllY2VXIC8gMiwgLXBpZWNlSCAvIDIsIHBpZWNlVywgcGllY2VIIC8vIEJlc3RlbW1pbmc6IGdlY2VudHJlZXJkCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgICAgICAgICAvLyAtLS0gMi4gVGVrZW4gZGUgbmlldXdlIGFmYmVlbGRpbmcgKGdyb2VpdCkgLS0tCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShzdGFydFggKyBwaWVjZVcgLyAyLCBzdGFydFkgKyBwaWVjZUggLyAyKTsKICAgICAgICAgICAgICAgIGN0eC5zY2FsZShzY2FsZU5ldywgc2NhbGVOZXcpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSwgCiAgICAgICAgICAgICAgICAgICAgc3RhcnRYLCBzdGFydFksIHBpZWNlVywgcGllY2VILCAvLyBCcm9uOiBoZXQgc3R1ayB1aXQgZGUgbmlldXdlIGFmYmVlbGRpbmcKICAgICAgICAgICAgICAgICAgICAtcGllY2VXIC8gMiwgLXBpZWNlSCAvIDIsIHBpZWNlVywgcGllY2VIIC8vIEJlc3RlbW1pbmc6IGdlY2VudHJlZXJkCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTQ0LiAzRCBGb2xkLU91dCAoM0QgVWl0a2xhcCkKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzRdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxMjAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICBudW1TdHJpcHM6IDE1LCAvLyBBYW50YWwgaG9yaXpvbnRhbGUgc3Ryb2tlbgogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dEN1YmljKHQpOyAKICAgICAgICAKICAgICAgICBjb25zdCBzdHJpcEggPSBoZWlnaHQgLyB1bmlxdWVTdGF0ZS5udW1TdHJpcHM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIAogICAgICAgIC8vIFRla2VuIGRlIG5pZXV3ZSBhZmJlZWxkaW5nIGFscyB2b2xsZWRpZ2UgYWNodGVyZ3JvbmQKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgIC8vIERlIG91ZGUgYWZiZWVsZGluZyB3b3JkdCB3ZWdnZW1vZmZlbGQgZG9vciBzdHJva2VuCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1TdHJpcHM7IGkrKykgewogICAgICAgICAgICBjb25zdCB5ID0gaSAqIHN0cmlwSDsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LnJlY3QoMCwgeSwgd2lkdGgsIHN0cmlwSCk7CiAgICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSb3RlZXIgcm9uZCBkZSBib3ZlbmthbnQgKHZvb3IgZXZlbiBzdHJva2VuKSBvZiBvbmRlcmthbnQgKHZvb3Igb25ldmVuIHN0cm9rZW4pCiAgICAgICAgICAgIGNvbnN0IGlzVG9wRm9sZCA9IGkgJSAyID09PSAwOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQmVwYWFsIGRlIHJvdGF0aWU6IHZhbiAwIG5hYXIgOTAgZ3JhZGVuICgxLjU3IHJhZCkKICAgICAgICAgICAgY29uc3Qgcm90YXRpb24gPSAoaXNUb3BGb2xkID8gMSA6IC0xKSAqIChlYXNlZFQgKiBNYXRoLlBJIC8gMik7CgogICAgICAgICAgICAvLyBUcmFuc2Zvcm1hdGllCiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUod2lkdGggLyAyLCBpc1RvcEZvbGQgPyB5IDogeSArIHN0cmlwSCk7CiAgICAgICAgICAgIGN0eC5yb3RhdGUocm90YXRpb24pOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKC13aWR0aCAvIDIsIGlzVG9wRm9sZCA/IC15IDogLSh5ICsgc3RyaXBIKSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUZWtlbiBkZSBvdWRlIGFmYmVlbGRpbmcgaW4gZGUgY2xpcAogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNDUuIFBpeGVsIFN3YXJtIChQaXhlbCBad2VybSkKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzNdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxODAsIC8vIExhbmdlcmUgZHV1ciB2b29yIGhldCB6d2VybS1lZmZlY3QKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgcGllY2VzOiBbXSwgCiAgICAgICAgbnVtWDogMjUsIAogICAgICAgIG51bVk6IDIwLAogICAgICAgIGluaXRpYWxpemVkOiBmYWxzZQogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0aWFsaXplUGllY2VzKCkgewogICAgICAgIHVuaXF1ZVN0YXRlLnBpZWNlcyA9IFtdOwogICAgICAgIGNvbnN0IGNhbnZhc1cgPSBjYW52YXMud2lkdGg7IAogICAgICAgIGNvbnN0IGNhbnZhc0ggPSBjYW52YXMuaGVpZ2h0OwogICAgICAgIGNvbnN0IHBpZWNlVyA9IGNhbnZhc1cgLyB1bmlxdWVTdGF0ZS5udW1YOwogICAgICAgIGNvbnN0IHBpZWNlSCA9IGNhbnZhc0ggLyB1bmlxdWVTdGF0ZS5udW1ZOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdW5pcXVlU3RhdGUubnVtWTsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdW5pcXVlU3RhdGUubnVtWDsgeCsrKSB7CiAgICAgICAgICAgICAgICAvLyBQb3NpdGllIGVuIGFmbWV0aW5nZW4gdmFuIGhldCBzdHVrCiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFggPSB4ICogcGllY2VXOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0geSAqIHBpZWNlSDsKCiAgICAgICAgICAgICAgICB1bmlxdWVTdGF0ZS5waWVjZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgeDogc3RhcnRYLCB5OiBzdGFydFksIHc6IHBpZWNlVywgaDogcGllY2VILAogICAgICAgICAgICAgICAgICAgIC8vIFdpbGxla2V1cmlnZSBzbmVsaGVkZW4vcmljaHRpbmdlbiB2b29yIHp3ZXJtCiAgICAgICAgICAgICAgICAgICAgdmVsWDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogODAwLAogICAgICAgICAgICAgICAgICAgIHZlbFk6IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDgwMCwKICAgICAgICAgICAgICAgICAgICByb3RTcGVlZDogKE1hdGgucmFuZG9tKCkgLSAwLjUpICogTWF0aC5QSSAqIDQsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB1bmlxdWVTdGF0ZS5pbml0aWFsaXplZCA9IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIGluaXRpYWxpemVQaWVjZXMoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBpZiAoIXVuaXF1ZVN0YXRlLmluaXRpYWxpemVkKSB7IGluaXQoKTsgfQoKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgZHQgPSAxIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7IC8vIFRpamRzaW50ZXJ2YWwgcGVyIGZyYW1lCgogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgdW5pcXVlU3RhdGUucGllY2VzLmZvckVhY2gocGllY2UgPT4gewogICAgICAgICAgICBjb25zdCBjZW50ZXJYID0gcGllY2UueCArIHBpZWNlLncgLyAyOwogICAgICAgICAgICBjb25zdCBjZW50ZXJZID0gcGllY2UueSArIHBpZWNlLmggLyAyOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gLS0tIE91ZGUgYWZiZWVsZGluZyAoendlcm10IHVpdCkgLS0tCiAgICAgICAgICAgIGlmICh0IDwgMC41KSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IGVhc2VkVCAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9IDEgLSBwcm9ncmVzczsgLy8gRmFkZSBvdXQKCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShjZW50ZXJYLCBjZW50ZXJZKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmV3ZWdpbmcKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVYID0gcGllY2UudmVsWCAqIHByb2dyZXNzICogZHQgKiA4MDsKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVZID0gcGllY2UudmVsWSAqIHByb2dyZXNzICogZHQgKiA4MDsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUobW92ZVgsIG1vdmVZKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUm90YXRpZQogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwaWVjZS5yb3RTcGVlZCAqIHByb2dyZXNzKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRJbWFnZSwgCiAgICAgICAgICAgICAgICAgICAgcGllY2UueCwgcGllY2UueSwgcGllY2UudywgcGllY2UuaCwgCiAgICAgICAgICAgICAgICAgICAgLXBpZWNlLncgLyAyLCAtcGllY2UuaCAvIDIsIHBpZWNlLncsIHBpZWNlLmgKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyAtLS0gTmlldXdlIGFmYmVlbGRpbmcgKHp3ZXJtdCBpbikgLS0tCiAgICAgICAgICAgIGlmICh0ID49IDAuNSkgewogICAgICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSAoZWFzZWRUIC0gMC41KSAqIDI7CiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYSA9IHByb2dyZXNzOyAvLyBGYWRlIGluCgogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoY2VudGVyWCwgY2VudGVyWSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEJld2VnaW5nIChvbWdla2VlcmQsIGtvbXQgdGVydWcgdmFuIGRlIHp3ZXJtcG9zaXRpZSkKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVYID0gcGllY2UudmVsWCAqICgxIC0gcHJvZ3Jlc3MpICogZHQgKiA4MDsKICAgICAgICAgICAgICAgIGNvbnN0IG1vdmVZID0gcGllY2UudmVsWSAqICgxIC0gcHJvZ3Jlc3MpICogZHQgKiA4MDsKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUobW92ZVgsIG1vdmVZKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gUm90YXRpZSAob21nZWtlZXJkKQogICAgICAgICAgICAgICAgY3R4LnJvdGF0ZShwaWVjZS5yb3RTcGVlZCAqICgxIC0gcHJvZ3Jlc3MpKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgIG5leHRJbWFnZSwgCiAgICAgICAgICAgICAgICAgICAgcGllY2UueCwgcGllY2UueSwgcGllY2UudywgcGllY2UuaCwgCiAgICAgICAgICAgICAgICAgICAgLXBpZWNlLncgLyAyLCAtcGllY2UuaCAvIDIsIHBpZWNlLncsIHBpZWNlLmgKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE0Ni4gVmVuZXRpYW4gQmxpbmRzIChKYWxvZXppZcOrbikKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzJdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiA3MCwgCiAgICAgICAgY3VycmVudEZyYW1lOiAwLAogICAgICAgIG51bUJsaW5kczogMjAsIC8vIEFhbnRhbCB2ZXJ0aWNhbGUgc3Ryb2tlbgogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dEN1YmljKHQpOyAKICAgICAgICAKICAgICAgICBjb25zdCBibGluZFcgPSB3aWR0aCAvIHVuaXF1ZVN0YXRlLm51bUJsaW5kczsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pcXVlU3RhdGUubnVtQmxpbmRzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgeCA9IGkgKiBibGluZFc7CiAgICAgICAgICAgIGNvbnN0IGNlbnRlclggPSB4ICsgYmxpbmRXIC8gMjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERlIHNjaGFhbCBnYWF0IHZhbiAxLjAgKHZvbCkgbmFhciAwLjAgKGdlc3BpZWdlbGQpIGVuIHRlcnVnIG5hYXIgMS4wCiAgICAgICAgICAgIC8vIEJpaiAwLjUgaXMgZGUgc3Ryb29rIG9uemljaHRiYWFyICgwIGJyZWVkdGUpCiAgICAgICAgICAgIGNvbnN0IHNjYWxlWCA9IE1hdGguYWJzKDEgLSAyICogZWFzZWRUKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERlIGFmYmVlbGRpbmcgZGllIG9wIGRhdCBtb21lbnQgemljaHRiYWFyIG1vZXQgemlqbgogICAgICAgICAgICBjb25zdCBpbWFnZVRvRHJhdyA9IGVhc2VkVCA8IDAuNSA/IGN1cnJlbnRJbWFnZSA6IG5leHRJbWFnZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBWZXJ0YWFsIG5hYXIgaGV0IG1pZGRlbiB2YW4gZGUgYmxpbmQgb20gZGUgc2NoYWFsIHRvZSB0ZSBwYXNzZW4KICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShjZW50ZXJYLCAwKTsKICAgICAgICAgICAgY3R4LnNjYWxlKHNjYWxlWCwgMSk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoLWNlbnRlclgsIDApOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGVrZW4gZGUgc3Ryb29rIHZhbiBkZSBhZmJlZWxkaW5nCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoCiAgICAgICAgICAgICAgICBpbWFnZVRvRHJhdywKICAgICAgICAgICAgICAgIHgsIDAsIGJsaW5kVywgaGVpZ2h0LCAvLyBCcm9uCiAgICAgICAgICAgICAgICB4LCAwLCBibGluZFcsIGhlaWdodCAgLy8gQmVzdGVtbWluZwogICAgICAgICAgICApOwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyBHZWRlZWxkZSBEYXRhIGVuIEh1bHBmdW5jdGllcwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLy8gTGlqc3QgdmFuICJXZWxrb20gV2VyZWxkIiBpbiAxNSB2ZXJzY2hpbGxlbmRlIHRhbGVuCmNvbnN0IFdFTENPTUVfTUVTU0FHRVMgPSBbCgpdOwoKCgovKioKICogVGVrZW50IGRlICJXZWxrb20gV2VyZWxkIiBib29kc2NoYXAgbWV0IGdlYW5pbWVlcmRlIHRyYW5zcGFyYW50aWUgZW4gc2NoYWFsLgogKiBAcGFyYW0ge251bWJlcn0gdCBEZSBnZcOrYXN0ZSBwcm9ncmVzcyB2YW4gZGUgYW5pbWF0aWUgKDAgdG90IDEpLgogKiBAcGFyYW0ge3N0cmluZ30gdGV4dCBIZXQgdGUgdGVrZW5lbiBiZXJpY2h0LgogKi8KZnVuY3Rpb24gZHJhd1NwaXJpdHVhbFRleHQodCwgdGV4dCkgewogICAgaWYgKCFjdHggfHwgIWNhbnZhcykgcmV0dXJuOwogICAgCiAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgIGNvbnN0IGFscGhhID0gTWF0aC5zaW4odCAqIE1hdGguUEkpOyAvLyBHYWF0IHZhbiAwIC0+IDEgLT4gMAogICAgY29uc3Qgc2NhbGUgPSAxICsgTWF0aC5zaW4odCAqIE1hdGguUEkpICogMC41OyAvLyBHYWF0IHZhbiAxIC0+IDEuNSAtPiAxIChTdWJ0aWVsIHB1bHNlcmVuZCkKICAgIAogICAgY3R4LnNhdmUoKTsKICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgCiAgICBjdHguZm9udCA9IGAkezQwICogc2NhbGV9cHggJ0ludGVyJywgc2Fucy1zZXJpZmA7CiAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7CiAgICAKICAgIC8vIEdyYWRpZW50IHZvb3IgZWVuICdnb2RkZWxpamsnIGxpY2h0ZWZmZWN0CiAgICBjb25zdCBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCBoZWlnaHQgLyAyIC0gNTAsIHdpZHRoLCBoZWlnaHQgLyAyICsgNTApOwogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIGByZ2JhKDI1NSwgMjU1LCAyNTUsICR7YWxwaGEgKiAwLjV9KWApOwogICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuNSwgYHJnYmEoMjU1LCAyNTUsIDI1NSwgJHthbHBoYX0pYCk7CiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSwgYHJnYmEoMjU1LCAyNTUsIDI1NSwgJHthbHBoYSAqIDAuNX0pYCk7CiAgICAKICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgIGN0eC5zaGFkb3dDb2xvciA9IGByZ2JhKDE4MCwgMjU1LCAyNTUsICR7YWxwaGF9KWA7CiAgICBjdHguc2hhZG93Qmx1ciA9IDIwICogYWxwaGE7CiAgICAKICAgIC8vIFRla2VuIGRlIHRla3N0IGluIGhldCBtaWRkZW4KICAgIGN0eC5maWxsVGV4dCh0ZXh0LCB3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogICAgCiAgICBjdHgucmVzdG9yZSgpOwp9CgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNDguIFRoZSBTZWVkIG9mIExpZ2h0IChMaWNodHphYWQpCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1s1XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogMTAwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiIAogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSAiICI7ICAgLy9XRUxDT01FX01FU1NBR0VTW3JhbmRvbUluZGV4XS50ZXh0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAvLyAxLiBPdWRlIGFmYmVlbGRpbmc6IEZhZGUgb3V0IGVuIGtyaW1wCiAgICAgICAgY29uc3Qgc2NhbGVPbGQgPSBsZXJwKDEsIDAsIGVhc2VkVCk7CiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgIGN0eC50cmFuc2xhdGUoY2VudGVyWCwgY2VudGVyWSk7CiAgICAgICAgY3R4LnNjYWxlKHNjYWxlT2xkLCBzY2FsZU9sZCk7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIC1jZW50ZXJYLCAtY2VudGVyWSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gMi4gTmlldXdlIGFmYmVlbGRpbmc6IEdyb2VpIHZhbnVpdCBlZW4gcHVudCAoTGljaHR6YWFkKQogICAgICAgIC8vIEdlYnJ1aWsgZGUgRmlib25hY2NpIHJlZWtzIG9tIGRlIG9udGh1bGxpbmcgZWVuIG9yZ2FuaXNjaC9mcmFjdGFsIGdldm9lbCB0ZSBnZXZlbgogICAgICAgIGNvbnN0IG1heERpbSA9IE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGNvbnN0IHJhZGl1cyA9IG1heERpbSAqIGVhc2VkVDsgCiAgICAgICAgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgLy8gR2VicnVpayBlZW4gd2lsbGVrZXVyaWdlIHN0YXJ0IGhvZWsgb20gZGUgc3BpcmFhbCB0ZSB2YXJpw6tyZW4KICAgICAgICBsZXQgYW5nbGUgPSAwOyAKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMwMDsgaSsrKSB7CiAgICAgICAgICAgIC8vIEdvdWRlbiBob2VrIChvbmdldmVlciAxMzcuNSBncmFkZW4pCiAgICAgICAgICAgIGFuZ2xlICs9IDIuMzk5OTY7IAogICAgICAgICAgICBjb25zdCBkaXN0ID0gKGkgLyAzMDApICogcmFkaXVzOwogICAgICAgICAgICBjb25zdCB4ID0gY2VudGVyWCArIE1hdGguY29zKGFuZ2xlKSAqIGRpc3Q7CiAgICAgICAgICAgIGNvbnN0IHkgPSBjZW50ZXJZICsgTWF0aC5zaW4oYW5nbGUpICogZGlzdDsKICAgICAgICAgICAgaWYgKGkgPT09IDApIHsgY3R4Lm1vdmVUbyh4LCB5KTsgfSBlbHNlIHsgY3R4LmxpbmVUbyh4LCB5KTsgfQogICAgICAgIH0KICAgICAgICBjdHguY2xpcCgpOyAvLyBDbGlwIGdlYmllZCBpcyBkZSBnZXNwaXJhbGlzZWVyZGUgdm9ybSAodm9vciBlZW4gb3JnYW5pc2NoIGVmZmVjdCkKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gMy4gVGVrc3QKICAgICAgICBkcmF3U3Bpcml0dWFsVGV4dCh0LCB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSk7CiAgICAgICAgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTQ5LiBBdXJhIFNoaWZ0IChBdXJhIFZlcnNjaHVpdmluZykKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzRdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxMjAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwgCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiIAogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSAiICI7ICAgLy9XRUxDT01FX01FU1NBR0VTW3JhbmRvbUluZGV4XS50ZXh0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBGQVNFIDE6IE91ZGUgQWZiZWVsZGluZyAoRGVzYXR1cmF0aWUgZW4gRXhwYW5zaWUpCiAgICAgICAgaWYgKHQgPCAwLjUpIHsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSBlYXNlZFQgKiAyOwogICAgICAgICAgICBjb25zdCBibHVyID0gbGVycCgwLCAzMCwgcHJvZ3Jlc3MpOyAvLyBXYXppZ2UgJ0F1cmEnCiAgICAgICAgICAgIGNvbnN0IGFscGhhID0gbGVycCgxLCAwLjIsIHByb2dyZXNzKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRla2VuIGRlIG91ZGUgYWZiZWVsZGluZyBtZXQgd2F6aWdoZWlkIGVuIGxhZ2UgYWxmYQogICAgICAgICAgICBjdHguZmlsdGVyID0gYGdyYXlzY2FsZSgke3Byb2dyZXNzfSkgYmx1cigke2JsdXJ9cHgpYDsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY3R4LmZpbHRlciA9ICdub25lJzsgLy8gUmVzZXQgdm9vciBkZSB2b2xnZW5kZSBmYXNlCiAgICAgICAgfQoKICAgICAgICAvLyBGQVNFIDI6IE5pZXV3ZSBBZmJlZWxkaW5nIChJbndhYXJ0c2UgRm9jdXMpCiAgICAgICAgaWYgKHQgPj0gMC41KSB7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gKGVhc2VkVCAtIDAuNSkgKiAyOwogICAgICAgICAgICBjb25zdCBzY2FsZSA9IGxlcnAoMC41LCAxLCBwcm9ncmVzcyk7IC8vIEtvbXQgdmFuIGVlbiBpbmdlem9vbWRlL2dlZm9jdXN0ZSBzdGFhdAogICAgICAgICAgICBjb25zdCBhbHBoYSA9IGxlcnAoMCwgMSwgcHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUod2lkdGgvMiwgaGVpZ2h0LzIpOwogICAgICAgICAgICBjdHguc2NhbGUoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIC13aWR0aC8yLCAtaGVpZ2h0LzIsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAvLyBab3JnIGVydm9vciBkYXQgZGUgb3VkZSBhZmJlZWxkaW5nIHZvbGxlZGlnIGdldGVrZW5kIGlzIGluIGZhc2UgMQogICAgICAgICAgICAgaWYgKHQgPCAwLjUpIHsKICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOwogICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gMy4gVGVrc3QKICAgICAgICBkcmF3U3Bpcml0dWFsVGV4dCh0LCB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE1MC4gVGhlIEdvbGRlbiBSYXRpbyBVbmZvbGQgKEd1bGRlbiBTbmVkZSBPbnRodWxsaW5nKQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbM10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDEwMCwgCiAgICAgICAgY3VycmVudEZyYW1lOiAwLAogICAgICAgIHRleHRNZXNzYWdlOiAiIiwKICAgICAgICBzdGFydEFuZ2xlOiAwCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIFdFTENPTUVfTUVTU0FHRVMubGVuZ3RoKTsKICAgICAgICB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSA9ICIgIjsgICAvL1dFTENPTUVfTUVTU0FHRVNbcmFuZG9tSW5kZXhdLnRleHQ7CiAgICAgICAgdW5pcXVlU3RhdGUuc3RhcnRBbmdsZSA9IE1hdGgucmFuZG9tKCkgKiAyICogTWF0aC5QSTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IG1heERpbSA9IE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gMS4gT3VkZSBhZmJlZWxkaW5nIGFscyBhY2h0ZXJncm9uZAogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gMi4gTmlldXdlIGFmYmVlbGRpbmcgZ2VjbGlwcGVkIGRvb3IgZGUgR3VsZGVuIFNwaXJhYWwgKEZpYm9uYWNjaSkKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIAogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICBjb25zdCBudW1UdXJucyA9IDUgKiBlYXNlZFQ7IC8vIEFhbnRhbCBkcmFhaWluZ2VuIGluIGRlIHNwaXJhYWwKICAgICAgICAKICAgICAgICAvLyBHdWxkZW4gcmF0aW8gKFBoaSkgPSAxLjYxODAzMzk4ODcuLi4KICAgICAgICBjb25zdCBwaGkgPSAxLjYxODAzMzk4ODc7IAogICAgICAgIGNvbnN0IGIgPSAwLjUgKiBwaGkgLyAoMiAqIE1hdGguUEkpOyAvLyBTcGlyYWFsIGNvbnN0YW50ZQogICAgICAgIAogICAgICAgIC8vIE1hYWsgZGUgc3BpcmFhbCBncm90ZXIgbWV0IGRlIHRpamQKICAgICAgICBmb3IgKGxldCB0aGV0YSA9IHVuaXF1ZVN0YXRlLnN0YXJ0QW5nbGU7IHRoZXRhIDwgdW5pcXVlU3RhdGUuc3RhcnRBbmdsZSArIG51bVR1cm5zICogMiAqIE1hdGguUEk7IHRoZXRhICs9IDAuMSkgewogICAgICAgICAgICBjb25zdCByID0gbWF4RGltICogTWF0aC5wb3cocGhpLCB0aGV0YSAvICgyICogTWF0aC5QSSkpOyAvLyBFeHBvbmVudGnDq2xlIGdyb2VpCiAgICAgICAgICAgIGNvbnN0IHggPSBjZW50ZXJYICsgciAqIE1hdGguY29zKHRoZXRhKTsKICAgICAgICAgICAgY29uc3QgeSA9IGNlbnRlclkgKyByICogTWF0aC5zaW4odGhldGEpOwogICAgICAgICAgICBpZiAodGhldGEgPT09IHVuaXF1ZVN0YXRlLnN0YXJ0QW5nbGUpIHsKICAgICAgICAgICAgICAgIGN0eC5tb3ZlVG8oeCwgeSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjdHgubGluZVRvKHgsIHkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIE1hYWsgZGUgc3BpcmFhbCBjb21wbGVldCBkb29yIHRlcnVnIHRlIGNsaXBwZW4gbmFhciBkZSByYW5kZW4KICAgICAgICBjdHgubGluZVRvKHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5saW5lVG8oMCwgaGVpZ2h0KTsKICAgICAgICBjdHgubGluZVRvKDAsIDApOwogICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOyAKICAgICAgICAKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAvLyAzLiBUZWtzdAogICAgICAgIGRyYXdTcGlyaXR1YWxUZXh0KHQsIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTUxLiBVbml2ZXJzYWwgTWVkaXRhdGlvbiAoVW5pdmVyc2VsZSBNZWRpdGF0aWUpCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1syXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogMTUwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiLAogICAgICAgIG5vaXNlTWFwOiBudWxsCiAgICB9OwoKICAgIC8vIEVlbiBlZW52b3VkaWdlIHJ1aXMgZ2VuZXJhdG9yIG9tIGVlbiAnc3RhdGlzY2hlJyBtZWRpdGF0aWUgdGUgc2ltdWxlcmVuCiAgICBmdW5jdGlvbiBnZXROb2lzZSh4LCB5KSB7CiAgICAgICAgcmV0dXJuIE1hdGguc2luKHggKiAwLjEgKyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgKiAwLjA1KSAqIE1hdGguY29zKHkgKiAwLjEgKyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgKiAwLjA1KTsKICAgIH0KCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSAiICI7ICAgLy9XRUxDT01FX01FU1NBR0VTW3JhbmRvbUluZGV4XS50ZXh0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAvLyBGQVNFIDE6IE91ZGUgYWZiZWVsZGluZyAoRGlzc29sdmUgdmlhIHJ1aXMpCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAvLyBBbHBoYSB6YWt0IHZhbiAxIG5hYXIgMAogICAgICAgIGNvbnN0IG9sZEFscGhhID0gbGVycCgxLCAwLCB0KTsgCiAgICAgICAgCiAgICAgICAgLy8gQ3Jlw6tlciBlZW4gbWFza2VyZWZmZWN0IG9wIGJhc2lzIHZhbiBydWlzCiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCArPSA1KSB7CiAgICAgICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5ICs9IDUpIHsKICAgICAgICAgICAgICAgIGNvbnN0IG5vaXNlVmFsID0gZ2V0Tm9pc2UoeCwgeSk7CiAgICAgICAgICAgICAgICAvLyBIb2UgZGljaHRlciBiaWogMC41IGRlIHJ1aXMgaXMsIGhvZSBzbmVsbGVyIGhldCBzdHVrIHZlcmR3aWpudAogICAgICAgICAgICAgICAgY29uc3QgdGhyZXNob2xkID0gbGVycCgwLjUsIDAuMiwgdCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIChNYXRoLmFicyhub2lzZVZhbCkgPiB0aHJlc2hvbGQpIHsKICAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gb2xkQWxwaGEgKiAwLjU7IC8vIFN1YnRpZWxlIHZlcnZhZ2luZwogICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgeCwgeSwgNSwgNSwgeCwgeSwgNSwgNSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gRkFTRSAyOiBOaWV1d2UgYWZiZWVsZGluZyAoS3Jpc3RhbGxpc2F0aWUgZW4gQWRlbWhhbGluZykKICAgICAgICAvLyBTY2hhYWwgcHVsc2VyZW5kOiAwLjkgLT4gMS4xIC0+IDEuMAogICAgICAgIGNvbnN0IHNjYWxlID0gbGVycCgwLjksIDEuMSwgTWF0aC5zaW4odCAqIE1hdGguUEkpKTsKICAgICAgICAKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICBjdHgudHJhbnNsYXRlKGNlbnRlclgsIGNlbnRlclkpOwogICAgICAgIGN0eC5zY2FsZShzY2FsZSwgc2NhbGUpOwogICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAtY2VudGVyWCwgLWNlbnRlclksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIC8vIDMuIFRla3N0CiAgICAgICAgZHJhd1NwaXJpdHVhbFRleHQodCwgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNTIuIFNhY3JlZCBHZW9tZXRyeSBSZXZlYWwgKEJsb2VtIGRlcyBMZXZlbnMpCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1sxXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogMTIwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiLAogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSAiICI7ICAgLy9XRUxDT01FX01FU1NBR0VTW3JhbmRvbUluZGV4XS50ZXh0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gQmFzaXMgc3RyYWFsIHZhbiBkZSBjaXJrZWxzIChncm9laXQgdG90IGJ1aXRlbiBoZXQgc2NoZXJtKQogICAgICAgIGNvbnN0IHJhZGl1cyA9IE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpIC8gMyAqIGVhc2VkVDsKICAgICAgICAKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAKICAgICAgICAvLyBGbG93ZXIgb2YgTGlmZS1wYXRyb29uOiBCZWdpbiBtZXQgZGUgY2VudHJhbGUgY2lya2VsCiAgICAgICAgY3R4LmFyYyhjZW50ZXJYLCBjZW50ZXJZLCByYWRpdXMsIDAsIDIgKiBNYXRoLlBJKTsKCiAgICAgICAgLy8gVm9lZyA2IG9tcmluZ2VuZGUgY2lya2VscyB0b2UgZGllIGVsa2FhciBvdmVybGFwcGVuCiAgICAgICAgY29uc3QgaGV4UG9pbnRzID0gW107CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBpICogTWF0aC5QSSAvIDM7CiAgICAgICAgICAgIGNvbnN0IHggPSBjZW50ZXJYICsgcmFkaXVzICogTWF0aC5jb3MoYW5nbGUpOwogICAgICAgICAgICBjb25zdCB5ID0gY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5hcmMoeCwgeSwgcmFkaXVzLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgICAgIGhleFBvaW50cy5wdXNoKHsgeCwgeSB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gT3B0aW9uZWVsOiBEZXJkZSBsYWFnIGNpcmtlbHMgb3AgZGUgc25panB1bnRlbgogICAgICAgIGlmIChlYXNlZFQgPiAwLjUpIHsKICAgICAgICAgICAgY29uc3QgcmFkaXVzMiA9IHJhZGl1cyAvIDEuNTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlMSA9IGkgKiBNYXRoLlBJIC8gMzsKICAgICAgICAgICAgICAgIGNvbnN0IGFuZ2xlMiA9IChpICsgMSkgKiBNYXRoLlBJIC8gMzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgeDEgPSBjZW50ZXJYICsgcmFkaXVzICogTWF0aC5jb3MoYW5nbGUxKTsKICAgICAgICAgICAgICAgIGNvbnN0IHkxID0gY2VudGVyWSArIHJhZGl1cyAqIE1hdGguc2luKGFuZ2xlMSk7CiAgICAgICAgICAgICAgICBjb25zdCB4MiA9IGNlbnRlclggKyByYWRpdXMgKiBNYXRoLmNvcyhhbmdsZTIpOwogICAgICAgICAgICAgICAgY29uc3QgeTIgPSBjZW50ZXJZICsgcmFkaXVzICogTWF0aC5zaW4oYW5nbGUyKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTWlkZGVuIHR1c3NlbiB0d2VlIHB1bnRlbiBvbSBkZSBkZXJkZSBsYWFnIHRlIGNyZcOrcmVuCiAgICAgICAgICAgICAgICBjb25zdCBtaWRYID0gKHgxICsgeDIpIC8gMjsKICAgICAgICAgICAgICAgIGNvbnN0IG1pZFkgPSAoeTEgKyB5MikgLyAyOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBFeHRyYSBjaXJrZWwgaW4gaGV0IG1pZGRlbiB2YW4gZGUgJ3BldGFscycKICAgICAgICAgICAgICAgIGN0eC5hcmMobWlkWCwgbWlkWSwgcmFkaXVzMiwgMCwgMiAqIE1hdGguUEkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGN0eC5jbGlwKCk7IC8vIENsaXAgZGUgbmlldXdlIGFmYmVlbGRpbmcgaW4gZGl0IHBhdHJvb24KICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7IAogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIC8vIDMuIFRla3N0CiAgICAgICAgZHJhd1NwaXJpdHVhbFRleHQodCwgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNTMuIFRoZSBJbmZpbml0ZSBQbGFuZSAoSGV0IE9uZWluZGlnZSBWbGFrKQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDkwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiLAogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSAiICI7ICAgLy9XRUxDT01FX01FU1NBR0VTW3JhbmRvbUluZGV4XS50ZXh0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBPdWRlIEFmYmVlbGRpbmc6IEthbnRlbHQgZW4ga3JpbXB0IGluIGRlIHZlcnRlICh2ZXJkd2lqbnQgaW4gaGV0ICdPbmVpbmRpZ2UgVmxhaycpCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBzaGVhclggPSBsZXJwKDAsIDAuNSwgZWFzZWRUKTsgCiAgICAgICAgY29uc3Qgc2NhbGVZID0gbGVycCgxLCAwLjEsIGVhc2VkVCk7IAogICAgICAgIGNvbnN0IHRyYW5zbGF0ZVkgPSBsZXJwKDAsIGhlaWdodCAqIDAuNSwgZWFzZWRUKTsKCiAgICAgICAgLy8gU3RhcHNnZXdpanplIHRyYW5zZm9ybWF0aWUgb20gcGVyc3BlY3RpZWYgdGUgc2ltdWxlcmVuCiAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogICAgICAgIGN0eC50cmFuc2Zvcm0oMSwgMCwgc2hlYXJYLCBzY2FsZVksIDAsIHRyYW5zbGF0ZVkpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIC13aWR0aCAvIDIsIC1oZWlnaHQgLyAyLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHgucmVzdG9yZSgpOwoKICAgICAgICAvLyBOaWV1d2UgQWZiZWVsZGluZzogS2FudGVsdCBlbiBncm9laXQgdWl0IGRlIHZlcnRlCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjb25zdCBzaGVhclhOZXcgPSBsZXJwKC0wLjUsIDAsIGVhc2VkVCk7IAogICAgICAgIGNvbnN0IHNjYWxlWU5ldyA9IGxlcnAoMC4xLCAxLCBlYXNlZFQpOwogICAgICAgIGNvbnN0IHRyYW5zbGF0ZVlOZXcgPSBsZXJwKGhlaWdodCAqIDAuNSwgMCwgZWFzZWRUKTsKCiAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogICAgICAgIGN0eC50cmFuc2Zvcm0oMSwgMCwgc2hlYXJYTmV3LCBzY2FsZVlOZXcsIDAsIHRyYW5zbGF0ZVlOZXcpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgLXdpZHRoIC8gMiwgLWhlaWdodCAvIDIsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgLy8gMy4gVGVrc3QKICAgICAgICBkcmF3U3Bpcml0dWFsVGV4dCh0LCB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE1NC4gVmlicmF0aW9uYWwgRWNobyAoVmlicmF0aWUgRWNobykKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzYwXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogODAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICB0ZXh0TWVzc2FnZTogIiIsCiAgICAgICAgbnVtU3RyaXBzOiA0MCwKICAgIH07CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogV0VMQ09NRV9NRVNTQUdFUy5sZW5ndGgpOwogICAgICAgIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlID0gIiAiOyAgIC8vV0VMQ09NRV9NRVNTQUdFU1tyYW5kb21JbmRleF0udGV4dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IHN0cmlwSCA9IGhlaWdodCAvIHVuaXF1ZVN0YXRlLm51bVN0cmlwczsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAvLyBEZSBuaWV1d2UgYWZiZWVsZGluZyBpcyBkZSBiYXNpcwogICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBEZSAnc2Nob2snIGFtcGxpdHVkZSBpcyBtYXhpbWFhbCBpbiBoZXQgbWlkZGVuICh0PTAuNSkKICAgICAgICBjb25zdCBhbXBsaXR1ZGUgPSA1MCAqIE1hdGguc2luKHQgKiBNYXRoLlBJKTsgCiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1TdHJpcHM7IGkrKykgewogICAgICAgICAgICBjb25zdCB5ID0gaSAqIHN0cmlwSDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZhcmlhYmVsZSBzY2hva2Zhc2UsIGhvZ2VyL2xhZ2VyIG9wIGJhc2lzIHZhbiBkZSBpbmRleCBlbiB0aWpkCiAgICAgICAgICAgIGNvbnN0IHdhdmUgPSBNYXRoLnNpbihpICogMC4zICsgdCAqIE1hdGguUEkgKiA4KTsgCiAgICAgICAgICAgIGNvbnN0IGRpc3BsYWNlbWVudCA9IGFtcGxpdHVkZSAqIHdhdmU7CgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KDAsIHksIHdpZHRoLCBzdHJpcEgpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmVydGFhbCBvbSBkZSBvdWRlIGFmYmVlbGRpbmcgdGUgJ3NjaHVkZGVuJwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKGRpc3BsYWNlbWVudCwgMCk7IAogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGUgb3VkZSBhZmJlZWxkaW5nIHZlcnZhYWd0IHRlcndpamwgaGlqIHRyaWx0CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIDMuIFRla3N0CiAgICAgICAgZHJhd1NwaXJpdHVhbFRleHQodCwgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNTUuIEVtZXJnZW5jZSBmcm9tIFZvaWQgKE9wa29tc3QgdWl0IGRlIExlZWd0ZSkKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzEzNl0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDE0MCwgCiAgICAgICAgY3VycmVudEZyYW1lOiAwLAogICAgICAgIHRleHRNZXNzYWdlOiAiIiwKICAgIH07CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogV0VMQ09NRV9NRVNTQUdFUy5sZW5ndGgpOwogICAgICAgIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlID0gIiAiOyAgIC8vV0VMQ09NRV9NRVNTQUdFU1tyYW5kb21JbmRleF0udGV4dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgIC8vIEZBU0UgMSAodD0wIHRvdCAwLjUpOiBPdWRlIGFmYmVlbGRpbmcgZ2FhdCBuYWFyIFp3YXJ0LVdpdCBlbiB2ZXJ2YWFndAogICAgICAgIGlmICh0IDwgMC41KSB7CiAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gZWFzZWRUICogMjsKICAgICAgICAgICAgY29uc3Qgc2F0dXJhdGlvbiA9IGxlcnAoMSwgMCwgcHJvZ3Jlc3MpOyAvLyBTYXR1cmF0aWUgdmFuIDEwMCUgbmFhciAwJQogICAgICAgICAgICBjb25zdCBibHVyID0gbGVycCgwLCA1LCBwcm9ncmVzcyk7IAogICAgICAgICAgICBjb25zdCBhbHBoYSA9IGxlcnAoMSwgMCwgcHJvZ3Jlc3MpOwoKICAgICAgICAgICAgY3R4LmZpbHRlciA9IGBncmF5c2NhbGUoJHsxMDAgLSBzYXR1cmF0aW9uICogMTAwfSUpIGJsdXIoJHtibHVyfXB4KWA7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5maWx0ZXIgPSAnbm9uZSc7CiAgICAgICAgfQoKICAgICAgICAvLyBGQVNFIDIgKHQ9MC41IHRvdCAxLjApOiBOaWV1d2UgYWZiZWVsZGluZyB2ZXJzY2hpam50IHVpdCBad2FydC1XaXQKICAgICAgICBpZiAodCA+PSAwLjUpIHsKICAgICAgICAgICAgY29uc3QgcHJvZ3Jlc3MgPSAoZWFzZWRUIC0gMC41KSAqIDI7CiAgICAgICAgICAgIGNvbnN0IHNhdHVyYXRpb24gPSBsZXJwKDAsIDEsIHByb2dyZXNzKTsgLy8gU2F0dXJhdGllIHZhbiAwJSBuYWFyIDEwMCUKICAgICAgICAgICAgY29uc3QgYWxwaGEgPSBsZXJwKDAsIDEsIHByb2dyZXNzKTsKCiAgICAgICAgICAgIGN0eC5maWx0ZXIgPSBgZ3JheXNjYWxlKCR7MTAwIC0gc2F0dXJhdGlvbiAqIDEwMH0lKWA7CiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5maWx0ZXIgPSAnbm9uZSc7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIDMuIFRla3N0IChkZSB0ZWtzdCBpcyBoZXQgaGVsZGVyc3QgaW4gZGUgbGVlZ3RlL3R1c3NlbmZhc2UpCiAgICAgICAgZHJhd1NwaXJpdHVhbFRleHQodCwgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNTYuIENyeXN0YWwgTGF0dGljZSAoS3Jpc3RhbHJvb3N0ZXIpCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1sxMjddID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxMjAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICB0ZXh0TWVzc2FnZTogIiIsCiAgICAgICAgbnVtWDogMTUsCiAgICAgICAgbnVtWTogMTUKICAgIH07CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogV0VMQ09NRV9NRVNTQUdFUy5sZW5ndGgpOwogICAgICAgIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlID0gIiAiOyAgIC8vV0VMQ09NRV9NRVNTQUdFU1tyYW5kb21JbmRleF0udGV4dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIAogICAgICAgIGNvbnN0IHBpZWNlVyA9IHdpZHRoIC8gdW5pcXVlU3RhdGUubnVtWDsKICAgICAgICBjb25zdCBwaWVjZUggPSBoZWlnaHQgLyB1bmlxdWVTdGF0ZS5udW1ZOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB1bmlxdWVTdGF0ZS5udW1ZOyB5KyspIHsKICAgICAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB1bmlxdWVTdGF0ZS5udW1YOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHggKiBwaWVjZVc7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFkgPSB5ICogcGllY2VIOwogICAgICAgICAgICAgICAgY29uc3QgY2VudGVyWCA9IHN0YXJ0WCArIHBpZWNlVyAvIDI7CiAgICAgICAgICAgICAgICBjb25zdCBjZW50ZXJZID0gc3RhcnRZICsgcGllY2VIIC8gMjsKCiAgICAgICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShjZW50ZXJYLCBjZW50ZXJZKTsKCiAgICAgICAgICAgICAgICAvLyBSb3RhdGllIHZhbiAwIHRvdCAxODAgZ3JhZGVuIChQSSByYWRpYWxlbikKICAgICAgICAgICAgICAgIGNvbnN0IHJvdGF0aW9uID0gZWFzZWRUICogTWF0aC5QSTsgCiAgICAgICAgICAgICAgICBjdHgucm90YXRlKHJvdGF0aW9uKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmlqIDkwIGdyYWRlbiAodD0wLjUpIGlzIGRlIHNjaGFhbCBYIDAKICAgICAgICAgICAgICAgIGNvbnN0IHNjYWxlWCA9IE1hdGguYWJzKDEgLSAyICogdCk7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoc2NhbGVYLCAxKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmVwYWFsIHdlbGtlIGFmYmVlbGRpbmcgdGUgdGVrZW5lbiAodm9vciA5MCBncmFkZW4vdD0wLjUgc3dpdGNoKQogICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VUb0RyYXcgPSB0IDwgMC41ID8gY3VycmVudEltYWdlIDogbmV4dEltYWdlOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKAogICAgICAgICAgICAgICAgICAgIGltYWdlVG9EcmF3LCAKICAgICAgICAgICAgICAgICAgICBzdGFydFgsIHN0YXJ0WSwgcGllY2VXLCBwaWVjZUgsIC8vIEJyb24KICAgICAgICAgICAgICAgICAgICAtcGllY2VXIC8gMiwgLXBpZWNlSCAvIDIsIHBpZWNlVywgcGllY2VIIC8vIEJlc3RlbW1pbmcgKGdlY2VudHJlZXJkKQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAzLiBUZWtzdAogICAgICAgIGRyYXdTcGlyaXR1YWxUZXh0KHQsIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTU3LiBUaGUgRmxvdyBTdGF0ZSAoSHlkcm9keW5hbWlzY2hlIE9wbG9zc2luZykKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzEyNF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDExMCwgCiAgICAgICAgY3VycmVudEZyYW1lOiAwLAogICAgICAgIHRleHRNZXNzYWdlOiAiIiwKICAgICAgICBudW1TdHJpcHM6IDgwLCAvLyBGaWpubWF6aWcgZWZmZWN0CiAgICAgICAgbWF4RGlzcGxhY2VtZW50OiAxMDAsCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIFdFTENPTUVfTUVTU0FHRVMubGVuZ3RoKTsKICAgICAgICB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSA9ICIgIjsgICAvL1dFTENPTUVfTUVTU0FHRVNbcmFuZG9tSW5kZXhdLnRleHQ7CiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCBzdHJpcFcgPSB3aWR0aCAvIHVuaXF1ZVN0YXRlLm51bVN0cmlwczsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pcXVlU3RhdGUubnVtU3RyaXBzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgeCA9IGkgKiBzdHJpcFc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBHb2xmLSBlbiBydWlzZWZmZWN0IHZvb3IgZGUgeS12ZXJwbGFhdHNpbmcKICAgICAgICAgICAgY29uc3Qgd2F2ZSA9IE1hdGguc2luKGkgKiAwLjEgKyB0ICogTWF0aC5QSSAqIDQpOwogICAgICAgICAgICBjb25zdCBkaXNwbGFjZW1lbnQgPSB1bmlxdWVTdGF0ZS5tYXhEaXNwbGFjZW1lbnQgKiB3YXZlICogTWF0aC5zaW4odCAqIE1hdGguUEkpOyAvLyBNYXhpbWFhbCBvcCB0PTAuNQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT3VkZSBBZmJlZWxkaW5nIChzY2h1aWZ0IHVpdCBtZXQgZ29sdmVuKQogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KHgsIDAsIHN0cmlwVywgaGVpZ2h0KTsKICAgICAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZSgwLCBkaXNwbGFjZW1lbnQgKiAoMSAtIGVhc2VkVCkpOyAKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gTmlldXdlIEFmYmVlbGRpbmcgKHNjaHVpZnQgaW4gbWV0IGdvbHZlbikKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHgucmVjdCh4LCAwLCBzdHJpcFcsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgZGlzcGxhY2VtZW50ICogZWFzZWRUKTsgCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyAzLiBUZWtzdAogICAgICAgIGRyYXdTcGlyaXR1YWxUZXh0KHQsIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTU4LiBUaGUgVW5mb2xkaW5nIE1hbmRhbGEgKERlIE9udHZvdXdlbmRlIE1hbmRhbGEpCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1sxMTldID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxMjAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICB0ZXh0TWVzc2FnZTogIiIsCiAgICAgICAgbnVtUGV0YWxzOiAxMiwKICAgIH07CgogICAgZnVuY3Rpb24gaW5pdCgpIHsKICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOwogICAgICAgIGNvbnN0IHJhbmRvbUluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogV0VMQ09NRV9NRVNTQUdFUy5sZW5ndGgpOwogICAgICAgIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlID0gIiAiOyAgIC8vV0VMQ09NRV9NRVNTQUdFU1tyYW5kb21JbmRleF0udGV4dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7CiAgICAgICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgod2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gRGUgbmlldXdlIGFmYmVlbGRpbmcgaXMgemljaHRiYWFyIGluIGhldCBtaWRkZW4gKGluIGRlIGtlcm4pCiAgICAgICAgY29uc3QgY29yZVJhZGl1cyA9IG1heERpbSAqIGVhc2VkVDsgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgY3R4LmFyYyhjZW50ZXJYLCBjZW50ZXJZLCBjb3JlUmFkaXVzICogMC4xLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gT3VkZSBBZmJlZWxkaW5nOiBWZXJkZWVsZCBpbiAnQmxvZW1ibGFkZW4nIGRpZSBuYWFyIGJ1aXRlbiBzY2h1aXZlbgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pcXVlU3RhdGUubnVtUGV0YWxzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgYW5nbGUgPSBpICogMiAqIE1hdGguUEkgLyB1bmlxdWVTdGF0ZS5udW1QZXRhbHM7CiAgICAgICAgICAgIGNvbnN0IG5leHRBbmdsZSA9IChpICsgMSkgKiAyICogTWF0aC5QSSAvIHVuaXF1ZVN0YXRlLm51bVBldGFsczsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZlcnBsYWF0c2luZyBpcyBtYXhpbWFhbCBvcCB0PTAuNSAobWlkZGVuIHZhbiBkZSB0cmFuc2l0aWUpCiAgICAgICAgICAgIGNvbnN0IGRpc3BsYWNlbWVudCA9IG1heERpbSAqIDAuNSAqIE1hdGguc2luKHQgKiBNYXRoLlBJKTsKCiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbyhjZW50ZXJYLCBjZW50ZXJZKTsKICAgICAgICAgICAgY3R4LmFyYyhjZW50ZXJYLCBjZW50ZXJZLCBtYXhEaW0sIGFuZ2xlLCBuZXh0QW5nbGUpOwogICAgICAgICAgICBjdHguY2xvc2VQYXRoKCk7CiAgICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTY2h1aWYgZWxrIGJsb2VtYmxhZCB3ZWcgdmFuIGhldCBjZW50cnVtCiAgICAgICAgICAgIGNvbnN0IGR4ID0gTWF0aC5jb3MoYW5nbGUgKyBNYXRoLlBJIC8gdW5pcXVlU3RhdGUubnVtUGV0YWxzKSAqIGRpc3BsYWNlbWVudDsKICAgICAgICAgICAgY29uc3QgZHkgPSBNYXRoLnNpbihhbmdsZSArIE1hdGguUEkgLyB1bmlxdWVTdGF0ZS5udW1QZXRhbHMpICogZGlzcGxhY2VtZW50OwogICAgICAgICAgICAKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShkeCwgZHkpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyAzLiBUZWtzdAogICAgICAgIGRyYXdTcGlyaXR1YWxUZXh0KHQsIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTU5LiBDaGFrcmEgRmFkZSAoQ2hha3JhIFZlcnZhYWd0KQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMTE4XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogMTQwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiLAogICAgICAgIG51bUNoYWtyYXM6IDcsCiAgICB9OwogICAgLy8gQ2hha3JhIGtsZXVyZW4gdmFuIGJlbmVkZW4gbmFhciBib3ZlbjogUm9vZCwgT3JhbmplLCBHZWVsLCBHcm9lbiwgQmxhdXcsIEluZGlnbywgVmlvbGV0CiAgICBjb25zdCBjaGFrcmFDb2xvcnMgPSBbIiNGRjAwMDAiLCAiI0ZGOEMwMCIsICIjRkZGRjAwIiwgIiMwMEZGMDAiLCAiIzAwMDBGRiIsICIjNEIwMDgyIiwgIiNFRTgyRUUiXTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSIgIjsgLy8gV0VMQ09NRV9NRVNTQUdFU1tyYW5kb21JbmRleF0udGV4dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IHN0cmlwSCA9IGhlaWdodCAvIHVuaXF1ZVN0YXRlLm51bUNoYWtyYXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gVGVrZW4gZGUgbmlldXdlIGFmYmVlbGRpbmcgYWxzIGJhc2lzCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVuaXF1ZVN0YXRlLm51bUNoYWtyYXM7IGkrKykgewogICAgICAgICAgICBjb25zdCB5ID0gaSAqIHN0cmlwSDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIERlIGFscGhhIHZhbiBkZSBPdWRlIEFmYmVlbGRpbmcgaXMgYWZoYW5rZWxpamsgdmFuIGRlIHBvc2l0aWUuCiAgICAgICAgICAgIC8vIERlIHRyYW5zaXRpZSAib3BlbnQiIHZhbiBiZW5lZGVuIG5hYXIgYm92ZW4sIGluIGxpam4gbWV0IGRlIGNoYWtyYSdzLgogICAgICAgICAgICBjb25zdCBhbHBoYVByb2dyZXNzID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgKGVhc2VkVCAqIDEuNSkgLSAoaSAvIHVuaXF1ZVN0YXRlLm51bUNoYWtyYXMpKSk7CiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRBbHBoYSA9IDEgLSBhbHBoYVByb2dyZXNzOwoKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHgucmVjdCgwLCB5LCB3aWR0aCwgc3RyaXBIKTsKICAgICAgICAgICAgY3R4LmNsaXAoKTsKCiAgICAgICAgICAgIC8vIFZvZWcgZWVuIHN1YnRpZWxlIGtsZXVybGFhZyB0b2UgZGllIHZlcmR3aWpudAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBjdXJyZW50QWxwaGEgKiAwLjU7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBjaGFrcmFDb2xvcnNbdW5pcXVlU3RhdGUubnVtQ2hha3JhcyAtIDEgLSBpXTsgLy8gS2xldXJlbiB2YW4gYm92ZW4gbmFhciBiZW5lZGVuCiAgICAgICAgICAgIGN0eC5maWxsUmVjdCgwLCB5LCB3aWR0aCwgc3RyaXBIKTsKCiAgICAgICAgICAgIC8vIFRla2VuIGRlIG91ZGUgYWZiZWVsZGluZyBpbiBkZSBjbGlwCiAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGN1cnJlbnRBbHBoYTsgCiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIDMuIFRla3N0CiAgICAgICAgZHJhd1NwaXJpdHVhbFRleHQodCwgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTYwLiBUaGUgT2JzZXJ2ZXIgRWZmZWN0IChEZSBXYWFybmVtZXIpCi8vIEdlb3B0aW1hbGlzZWVyZDogR3JpZCBzaXplIHZlcmhvb2dkIHZhbiA1IG5hYXIgMTAgZW4gdG90YWxGcmFtZXMgdmVybGFhZ2QKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzExN10gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDkwLCAvLyBWZXJsYWFnZCB2YW4gMTUwIG5hYXIgOTAgKDEuNSBzZWNvbmRlKQogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICB0ZXh0TWVzc2FnZTogIiIsCiAgICAgICAgZ3JpZFN0ZXA6IDEwIC8vIFZFUkhPT0dEIHZhbiA1IG5hYXIgMTA6IDR4IG1pbmRlciBkcmF3IGNhbGxzCiAgICB9OwogICAgCiAgICAvLyBGdW5jdGllIG9tIGRlIHRla3N0L2Vtb2ppJ3MgdGUgdGVrZW5lbiAoYWFubmFtZSBkYXQgZGV6ZSBlbGRlcnMgaXMgZ2VkZWZpbmllZXJkKQogICAgLy8gRGV6ZSBmdW5jdGllIG1vZXQgbm9nIGRlIGp1aXN0ZSBkYXRhIHVpdCBkZSBIRUFMSU5HX01FU1NBR0VTIGFycmF5IGhhbGVuLCAKICAgIC8vIGFhbmdlemllbiBkZSBvcmlnaW5lbGUgY29kZSBXRUxDT01FX01FU1NBR0VTIGdlYnJ1aWt0ZSAod2F0IGZvdXQgd2FzIHZvb3IgZGV6ZSBjb250ZXh0KS4KICAgIGZ1bmN0aW9uIGRyYXdIZWFsaW5nVGV4dCh0LCBtZXNzYWdlKSB7CiAgICAgICAgaWYgKCFjdHggfHwgIWNhbnZhcykgcmV0dXJuOwogICAgICAgIAogICAgICAgIC8vIFNpbXBlbGUgdGVrc3R3ZWVyZ2F2ZSB2b29yIGRlIGRlbW8KICAgICAgICBjb25zdCBhbHBoYSA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBhbHBoYTsKICAgICAgICBjdHgudGV4dEFsaWduID0gJ2NlbnRlcic7CiAgICAgICAgY3R4LmZvbnQgPSBgMzBweCAnSW50ZXInLCBzYW5zLXNlcmlmYDsKICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoMjU1LCAyNTUsIDI1NSwgJHthbHBoYX0pYDsKICAgICAgICBjdHguZmlsbFRleHQobWVzc2FnZSwgY2FudmFzLndpZHRoIC8gMiwgY2FudmFzLmhlaWdodCAvIDIpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICB9CgogICAgLy8gVm9vcmJlZWxkIGRhdGEgb20gdGUgZ2VicnVpa2VuLCBhYW5nZXppZW4gV0VMQ09NRV9NRVNTQUdFUyBuaWV0IGlzIGdlZGVmaW5pZWVyZAogICAgY29uc3QgRkFMTEJBQ0tfTUVTU0FHRSA9ICJGb2N1cyBlbiBJbnRyb3NwZWN0aWUiOwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICAvLyBHZWJydWlrIGVlbiBlZW52b3VkaWdlIGZhbGxiYWNrIG9mIGVlbiBwbGFjZWhvbGRlciBvbSBkZSBpbml0IHRlIGxhdGVuIHdlcmtlbgogICAgICAgIHVuaXF1ZVN0YXRlLnRleHRNZXNzYWdlID0gRkFMTEJBQ0tfTUVTU0FHRTsgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICAvLyBIYXJkY29kZWQgcG9zaXRpZSB2b29yIGhldCAiV2Fhcm5lbWVyIiBlZmZlY3QgKG9uZ2V2ZWVyIDIvMyB2YW4gZGUgYnJlZWR0ZSwgMS8zIHZhbiBkZSBob29ndGUpCiAgICAgICAgY29uc3Qgb2JzZXJ2ZXJYID0gTWF0aC5mbG9vcih3aWR0aCAvIDEuNSk7CiAgICAgICAgY29uc3Qgb2JzZXJ2ZXJZID0gTWF0aC5mbG9vcihoZWlnaHQgLyAyLjUpOwogICAgICAgIGNvbnN0IG1heERpc3QgPSBNYXRoLm1heCh3aWR0aCwgaGVpZ2h0KSAvIDI7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCArPSB1bmlxdWVTdGF0ZS5ncmlkU3RlcCkgewogICAgICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSArPSB1bmlxdWVTdGF0ZS5ncmlkU3RlcCkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBBZnN0YW5kIHZhbiBkZSB3YWFybmVtZXIgdG90IGRpdCBwdW50CiAgICAgICAgICAgICAgICBjb25zdCBkaXN0ID0gTWF0aC5zcXJ0KE1hdGgucG93KHggLSBvYnNlcnZlclgsIDIpICsgTWF0aC5wb3coeSAtIG9ic2VydmVyWSwgMikpOwogICAgICAgICAgICAgICAgLy8gR2Vub3JtYWxpc2VlcmRlIGFmc3RhbmQgKDAgPSBiaWogd2Fhcm5lbWVyLCAxID0gdmVyIHdlZykKICAgICAgICAgICAgICAgIGNvbnN0IGRpc3ROb3JtID0gTWF0aC5taW4oMSwgZGlzdCAvIG1heERpc3QpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBIb2UgZGljaHRlciBiaWogZGUgd2Fhcm5lbWVyLCBob2UgbWVlciAiZ2V0cmFuc2l0b25lZXJkIgogICAgICAgICAgICAgICAgY29uc3QgbG9jYWxUID0gZWFzZWRUICsgKGRpc3ROb3JtICogKDEgLSBlYXNlZFQpICogMC41KTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIEFscGhhIHZhbiBkZSBPdWRlIEFmYmVlbGRpbmcgKHZlcmR3aWpudCBzbmVsbGVyIGJpaiBkZSB3YWFybmVtZXIpCiAgICAgICAgICAgICAgICBjb25zdCBhbHBoYU9sZCA9IGxlcnAoMSwgMCwgbG9jYWxUKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3Qgc3RlcCA9IHVuaXF1ZVN0YXRlLmdyaWRTdGVwOwoKICAgICAgICAgICAgICAgIC8vIFRla2VuIGRlIE91ZGUgQWZiZWVsZGluZwogICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhT2xkOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIHgsIHksIHN0ZXAsIHN0ZXAsIHgsIHksIHN0ZXAsIHN0ZXApOwogICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gVGVrZW4gZGUgTmlldXdlIEFmYmVlbGRpbmcKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gYWxwaGFPbGQ7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgeCwgeSwgc3RlcCwgc3RlcCwgeCwgeSwgc3RlcCwgc3RlcCk7CiAgICAgICAgICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFRla3N0IChnZWJydWlrdCBkZSBkcmF3SGVhbGluZ1RleHQgem9hbHMgZ2VzdWdnZXJlZXJkKQogICAgICAgIGRyYXdIZWFsaW5nVGV4dCh0LCB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTYxLiBBc2NlbnNpb24gUGF0aCAoQXNjZW5zaWUgUGFkKQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMTEzXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyAKICAgICAgICB0b3RhbEZyYW1lczogMTAwLCAKICAgICAgICBjdXJyZW50RnJhbWU6IDAsCiAgICAgICAgdGV4dE1lc3NhZ2U6ICIiLAogICAgICAgIG51bUJhbmRzOiA2MAogICAgfTsKCiAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7CiAgICAgICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBXRUxDT01FX01FU1NBR0VTLmxlbmd0aCk7CiAgICAgICAgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UgPSAiICI7IC8vV0VMQ09NRV9NRVNTQUdFU1tyYW5kb21JbmRleF0udGV4dDsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IGJhbmRXID0gd2lkdGggLyB1bmlxdWVTdGF0ZS5udW1CYW5kczsKICAgICAgICBjb25zdCBtYXhTaGlmdCA9IGhlaWdodDsgLy8gU2hpZnQgdmFuIGVlbiB2b2xsZWRpZ2UgaG9vZ3RlCiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1CYW5kczsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHggPSBpICogYmFuZFc7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEZSB2ZXJzY2h1aXZpbmcgaXMgdmVydGljYWFsIGVuIHZhcmllZXJ0IHBlciBiYW5kIChlZW4gaGVsaXgtcGFkKQogICAgICAgICAgICBjb25zdCBzcGlyYWxTaGlmdCA9IE1hdGguc2luKGkgKiAwLjQgKyB0ICogTWF0aC5QSSAqIDQpICogMjA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBWZXJ0aWNhbGUgdmVyc2NodWl2aW5nOiB2YW4gMCBuYWFyIC1tYXhTaGlmdCAob21ob29nKQogICAgICAgICAgICBjb25zdCBzaGlmdFkgPSBsZXJwKDAsIC1tYXhTaGlmdCwgZWFzZWRUKSArIHNwaXJhbFNoaWZ0OwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gT3VkZSBBZmJlZWxkaW5nOiBTY2h1aWZ0IHVpdCBlbiB2ZXJ2YWFndAogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KHgsIDAsIGJhbmRXLCBoZWlnaHQpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKDAsIHNoaWZ0WSAqICgxIC0gZWFzZWRUKSk7IAogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBOaWV1d2UgQWZiZWVsZGluZzogU2NodWlmdCBpbiB2YW4gb25kZXJhZiBlbiB2ZXJzY2hpam50CiAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LnJlY3QoeCwgMCwgYmFuZFcsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgc2hpZnRZICogZWFzZWRUICsgbWF4U2hpZnQgKiAoMSAtIGVhc2VkVCkpOyAKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRUOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIDMuIFRla3N0CiAgICAgICAgZHJhd1NwaXJpdHVhbFRleHQodCwgdW5pcXVlU3RhdGUudGV4dE1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNjIuIENvc21pYyBCcmVhdGggKEtvc21pc2NoZSBBZGVtKQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgCiAgICAgICAgdG90YWxGcmFtZXM6IDE2MCwgLy8gTGFuZ2UgYWRlbWhhbGluZwogICAgICAgIGN1cnJlbnRGcmFtZTogMCwKICAgICAgICB0ZXh0TWVzc2FnZTogIiIsCiAgICB9OwoKICAgIGZ1bmN0aW9uIGluaXQoKSB7CiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsKICAgICAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIFdFTENPTUVfTUVTU0FHRVMubGVuZ3RoKTsKICAgICAgICB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSA9IiAiOyAvLyBXRUxDT01FX01FU1NBR0VTW3JhbmRvbUluZGV4XS50ZXh0OwogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAvLyBEZSBhZGVtaGFsaW5nc3NjaGFhbCAoZ2FhdCB2YW4gMSBuYWFyIDEuMSBlbiB0ZXJ1ZyBuYWFyIDEpCiAgICAgICAgY29uc3QgYnJlYXRoU2NhbGUgPSAxICsgMC4xICogTWF0aC5zaW4odCAqIE1hdGguUEkpOyAKICAgICAgICAKICAgICAgICAvLyAtLS0gT3VkZSBBZmJlZWxkaW5nOiBab29tIHVpdCBlbiB2ZXJ2YWFnIC0tLQogICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICBjdHgudHJhbnNsYXRlKGNlbnRlclgsIGNlbnRlclkpOwogICAgICAgIGN0eC5zY2FsZShicmVhdGhTY2FsZSwgYnJlYXRoU2NhbGUpOwogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAtY2VudGVyWCwgLWNlbnRlclksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIC8vIC0tLSBOaWV1d2UgQWZiZWVsZGluZzogWm9vbSBpbiBlbiB2ZXJzY2hpam4gbWV0IHJhZGlhbGUgZ2xvZWQgLS0tCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjZW50ZXJYLCBjZW50ZXJZKTsKICAgICAgICBjdHguc2NhbGUoYnJlYXRoU2NhbGUsIGJyZWF0aFNjYWxlKTsKICAgICAgICAKICAgICAgICAvLyBSYWRpYWxlIEdsb2VkOiBUZWtlbiBlZW4gbGljaHRlIGdsb2VkIGFjaHRlciBkZSBuaWV1d2UgYWZiZWVsZGluZwogICAgICAgIGlmIChlYXNlZFQgPiAwLjEpIHsKICAgICAgICAgICAgY29uc3QgZ2xvd1JhZGl1cyA9IE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpICogZWFzZWRUICogMC44OwogICAgICAgICAgICBjb25zdCBncmFkaWVudCA9IGN0eC5jcmVhdGVSYWRpYWxHcmFkaWVudCgwLCAwLCAwLCAwLCAwLCBnbG93UmFkaXVzKTsKICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAsIGByZ2JhKDI1NSwgMjU1LCAyNTUsICR7ZWFzZWRUICogMC41fSlgKTsKICAgICAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDEsIGByZ2JhKDI1NSwgMjU1LCAyNTUsIDApYCk7CiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHguYXJjKDAsIDAsIGdsb3dSYWRpdXMsIDAsIDIgKiBNYXRoLlBJKTsKICAgICAgICAgICAgY3R4LmZpbGwoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIC1jZW50ZXJYLCAtY2VudGVyWSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKCiAgICAgICAgLy8gMy4gVGVrc3QKICAgICAgICBkcmF3U3Bpcml0dWFsVGV4dCh0LCB1bmlxdWVTdGF0ZS50ZXh0TWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCgoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEdlZGVlbGRlIERhdGEgZW4gSHVscGZ1bmN0aWVzCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgovLyBHZWNvbWJpbmVlcmRlIGRhdGEgdWl0IGRlICdzcGlyaXR1ZWVsX3dlZXJfaGVyc3RlbC5tZCcgdGFiZWwKY29uc3QgSEVBTElOR19NRVNTQUdFUyA9IFsgCgl7IHRleHQ6ICIgICAgICAgIiwgZW1vamlzOiAiICAiIH0sIAoJeyB0ZXh0OiAiICAgICAgICIsIGVtb2ppczogIiAgIiB9LCAKCXsgdGV4dDogIiAgICAgICAiLCBlbW9qaXM6ICIgICIgfSwgCgl7IHRleHQ6ICIgICAgICAgIiwgZW1vamlzOiAiICAiIH0sIAoJeyB0ZXh0OiAiICAgICAgICIsIGVtb2ppczogIiAgIiB9LCAKCXsgdGV4dDogIiAgICAgICAiLCBlbW9qaXM6ICIgICIgfSwgCgl7IHRleHQ6ICIgICAgICAgIiwgZW1vamlzOiAiICAiIH0sIAoJeyB0ZXh0OiAiICAgICAgICIsIGVtb2ppczogIiAgIiB9LCAKCXsgdGV4dDogIiAgICAgICAiLCBlbW9qaXM6ICIgICIgfSwgCgl7IHRleHQ6ICIgICAgICAgIiwgZW1vamlzOiAiICAiIH0sIAoJeyB0ZXh0OiAiICAgICAgICIsIGVtb2ppczogIiAgIiB9LCAKCXsgdGV4dDogIiAgICAgICAiLCBlbW9qaXM6ICIgICIgfSwgCgl7IHRleHQ6ICIgICAgICAgIiwgZW1vamlzOiAiICAiIH0sIAoJeyB0ZXh0OiAiICAgICAgICIsIGVtb2ppczogIiAgIiB9LCAJCgl7IHRleHQ6ICIgICAgICAgIiwgZW1vamlzOiAiICAiIH0KICAgCl07CgoKCi8qKgogKiBUZWtlbnQgZGUgZ2Vjb21iaW5lZXJkZSBib29kc2NoYXAgKFRla3N0ICsgRW1vamkncykgbWV0IGVlbiBwdWxzZXJlbmQsIGhlbGVuZCBlZmZlY3QuCiAqIEBwYXJhbSB7bnVtYmVyfSB0IERlIGdlw6thc3RlIHByb2dyZXNzIHZhbiBkZSBhbmltYXRpZSAoMCB0b3QgMSkuCiAqIEBwYXJhbSB7b2JqZWN0fSBtZXNzYWdlIEhldCBvYmplY3QgbWV0ICd0ZXh0JyBlbiAnZW1vamlzJy4KICovCmZ1bmN0aW9uIGRyYXdIZWFsaW5nVGV4dCh0LCBtZXNzYWdlKSB7CiAgICBpZiAoIWN0eCB8fCAhY2FudmFzKSByZXR1cm47CiAgICAKICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7CiAgICBjb25zdCBhbHBoYSA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgLy8gR2FhdCB2YW4gMCAtPiAxIC0+IDAKICAgIAogICAgY3R4LnNhdmUoKTsKICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgCiAgICAvLyAtLS0gRW1vamkncyAoR2V6b25kIFZlcnN0YW5kKSAtLS0KICAgIGNvbnN0IGVtb2ppU2NhbGUgPSAxLjUgKyAwLjUgKiBNYXRoLnNpbihlYXNlZFQgKiBNYXRoLlBJKTsgCiAgICBjdHguZm9udCA9IGAkezYwICogZW1vamlTY2FsZX1weCBzYW5zLXNlcmlmYDsKICAgIGN0eC50ZXh0QmFzZWxpbmUgPSAnYm90dG9tJzsKICAgIGN0eC5maWxsVGV4dChtZXNzYWdlLmVtb2ppcywgd2lkdGggLyAyLCBoZWlnaHQgLyAyIC0gMjApOwogICAgCiAgICAvLyAtLS0gVGVrc3QgKFNwaXJpdHVlZWwgV2VlcikgLS0tCiAgICBjdHguZm9udCA9IGAzMHB4ICdJbnRlcicsIHNhbnMtc2VyaWZgOwogICAgY3R4LnRleHRCYXNlbGluZSA9ICd0b3AnOwogICAgCiAgICBjb25zdCBncmFkaWVudCA9IGN0eC5jcmVhdGVMaW5lYXJHcmFkaWVudCgwLCAwLCB3aWR0aCwgMCk7CiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMCwgYHJnYmEoMTgwLCAyNTUsIDIwMCwgJHthbHBoYSAqIDAuMn0pYCk7CiAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCBgcmdiYSgxODAsIDI1NSwgMjAwLCAke2FscGhhfSlgKTsKICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgxLCBgcmdiYSgxODAsIDI1NSwgMjAwLCAke2FscGhhICogMC4yfSlgKTsKICAgIAogICAgY3R4LmZpbGxTdHlsZSA9IGdyYWRpZW50OwogICAgY3R4LnNoYWRvd0NvbG9yID0gYHJnYmEoMTAwLCAyNTUsIDEwMCwgJHthbHBoYSAqIDAuOH0pYDsKICAgIGN0eC5zaGFkb3dCbHVyID0gMTUgKiBhbHBoYTsKICAgIAogICAgY3R4LmZpbGxUZXh0KG1lc3NhZ2UudGV4dCwgd2lkdGggLyAyLCBoZWlnaHQgLyAyICsgMzApOwogICAgCiAgICBjdHgucmVzdG9yZSgpOwp9CgovLyBGdW5jdGllIG9tIHdpbGxla2V1cmlnIGVlbiBib29kc2NoYXAgdGUgc2VsZWN0ZXJlbgpmdW5jdGlvbiBnZXRSYW5kb21NZXNzYWdlKCkgewogICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBIRUFMSU5HX01FU1NBR0VTLmxlbmd0aCk7CiAgICByZXR1cm4gSEVBTElOR19NRVNTQUdFU1tyYW5kb21JbmRleF07Cn0KCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE2My4gVGVsb21lcmUgRnVzaW9uIChDZWx2ZXJuaWV1d2luZykKLy8gRWZmZWN0OiBSYWRpYWxlIGxpam5lbiB0cmVra2VuIHNhbWVuIGVuIGZ1c2lvbmVyZW4KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzEwMl0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDEwMCwgY3VycmVudEZyYW1lOiAwLCBtZXNzYWdlOiBudWxsLCBudW1MaW5lczogNjAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IHVuaXF1ZVN0YXRlLm1lc3NhZ2UgPSBnZXRSYW5kb21NZXNzYWdlKCk7IH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7CiAgICAgICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgod2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1MaW5lczsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFuZ2xlID0gaSAqIDIgKiBNYXRoLlBJIC8gdW5pcXVlU3RhdGUubnVtTGluZXM7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBCZWdpbiB2YW4gZGUgbGlqbiAocmFuZCkKICAgICAgICAgICAgY29uc3Qgc3RhcnRYID0gY2VudGVyWCArIE1hdGguY29zKGFuZ2xlKSAqIG1heERpbTsKICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0gY2VudGVyWSArIE1hdGguc2luKGFuZ2xlKSAqIG1heERpbTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEVpbmRwdW50ICh3YWFybWVlIGRlIGxpam4gc2FtZW50cmVrdCkKICAgICAgICAgICAgY29uc3QgZW5kWCA9IGxlcnAoc3RhcnRYLCBjZW50ZXJYLCBlYXNlZFQpOwogICAgICAgICAgICBjb25zdCBlbmRZID0gbGVycChzdGFydFksIGNlbnRlclksIGVhc2VkVCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEZSBvdWRlIGFmYmVlbGRpbmcgd29yZHQgZ2V0ZWtlbmQgaW4gZGUgc2FtZW50cmVra2VuZGUgbGlqbgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5tb3ZlVG8oY2VudGVyWCwgY2VudGVyWSk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oZW5kWCwgZW5kWSk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oY2VudGVyWCArIE1hdGguY29zKGFuZ2xlICsgMC4wNSkgKiBtYXhEaW0sIGNlbnRlclkgKyBNYXRoLnNpbihhbmdsZSArIDAuMDUpICogbWF4RGltKTsgLy8gSWV0cyBicmVkZXJlIGxpam4KICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEZSBuaWV1d2UgYWZiZWVsZGluZyB2ZXJzY2hpam50IGluIGRlIGtlcm4gem9kcmEgZGUgbGlqbmVuIHNhbWVudHJla2tlbgogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5hcmMoY2VudGVyWCwgY2VudGVyWSwgbWF4RGltICogZWFzZWRUICogMC4xLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gWm9yZyBlcnZvb3IgZGF0IGRlIG5pZXV3ZSBhZmJlZWxkaW5nIGRlIG92ZXJoYW5kIG5lZW10IGFhbiBoZXQgZWluZGUKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICBkcmF3SGVhbGluZ1RleHQodCwgdW5pcXVlU3RhdGUubWVzc2FnZSk7CiAgICAgICAgCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTY0LiBOZXVyYWwgTmV0IFJld2lyaW5nIChOZXVyb3BsYXN0aWNpdGVpdCkKLy8gRWZmZWN0OiBGcmFnbWVudGVuIHZlcnNjaHVpdmVuIGVuIG1ha2VuIG5pZXV3ZSB2ZXJiaW5kaW5nZW4KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzkwXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTIwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwsIGdyaWRTaXplOiAxMCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgdW5pcXVlU3RhdGUubWVzc2FnZSA9IGdldFJhbmRvbU1lc3NhZ2UoKTsgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgcGllY2VXID0gd2lkdGggLyB1bmlxdWVTdGF0ZS5ncmlkU2l6ZTsKICAgICAgICBjb25zdCBwaWVjZUggPSBoZWlnaHQgLyB1bmlxdWVTdGF0ZS5ncmlkU2l6ZTsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdW5pcXVlU3RhdGUuZ3JpZFNpemU7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHVuaXF1ZVN0YXRlLmdyaWRTaXplOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WCA9IHggKiBwaWVjZVc7CiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFkgPSB5ICogcGllY2VIOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBDaGFvcyAodD0wLjUpOiBNYXhpbWFhbCB2ZXJzY2h1aXZpbmcuIE9yZGUgKHQ9MCBlbiB0PTEpOiBHZWVuIHZlcnNjaHVpdmluZy4KICAgICAgICAgICAgICAgIGNvbnN0IHNoaWZ0RmFjdG9yID0gMSAtIE1hdGguYWJzKDEgLSAyICogZWFzZWRUKTsgCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFVuaWVrZSAnbmV1cmFsZScgdmVyc2NodWl2aW5nIHBlciBzdHVramUgKGdlYnJ1aWsgcmFuZG9tIG9mZnNldCBvbSBjaGFvcyB0ZSBzaW11bGVyZW4pCiAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXRYID0gTWF0aC5zaW4oeCAqIDAuNSArIHQgKiA0KSAqIHBpZWNlVyAqIHNoaWZ0RmFjdG9yICogMjsKICAgICAgICAgICAgICAgIGNvbnN0IG9mZnNldFkgPSBNYXRoLmNvcyh5ICogMC41ICsgdCAqIDQpICogcGllY2VIICogc2hpZnRGYWN0b3IgKiAyOwoKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gc2hpZnRGYWN0b3I7IC8vIFppY2h0YmFhcmhlaWQgaXMgbWF4aW1hYWwgYWxzIGRlIHZlcnNjaHVpdmluZyAwIGlzCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC50cmFuc2xhdGUoc3RhcnRYICsgb2Zmc2V0WCwgc3RhcnRZICsgb2Zmc2V0WSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRla2VuIGJlaWRlIGFmYmVlbGRpbmdlbiAoT3VkIHZlcnZhYWd0LCBOaWV1dyB2ZXJzY2hpam50KQogICAgICAgICAgICAgICAgLy8gT3VkZSBhZmJlZWxkaW5nICh2ZXJkd2lqbnQgaW4gY2hhb3MpCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBsZXJwKDEsIDAsIGVhc2VkVCk7IAogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIHN0YXJ0WCwgc3RhcnRZLCBwaWVjZVcsIHBpZWNlSCwgMCwgMCwgcGllY2VXLCBwaWVjZUgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBOaWV1d2UgYWZiZWVsZGluZyAodmVyc2NoaWpudCB1aXQgY2hhb3MpCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBsZXJwKDAsIDEsIGVhc2VkVCk7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgc3RhcnRYLCBzdGFydFksIHBpZWNlVywgcGllY2VILCAwLCAwLCBwaWVjZVcsIHBpZWNlSCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNjUuIEhvbWVvc3RhdGljIFJlYm91bmQgKEhvbWVvc3Rhc2UpCi8vIEVmZmVjdDogR2V3ZWxkZGFkaWdlIHZlcnN0b3JpbmcgZW4gcGVyZmVjdGUgdGVydWdrZWVyIG5hYXIgZGUgbmlldXdlIHN0YWF0Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1s4NF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDkwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwsIG1heFdhcnA6IDAuMSB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgdW5pcXVlU3RhdGUubWVzc2FnZSA9IGdldFJhbmRvbU1lc3NhZ2UoKTsgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gRGUgdmVyc3RvcmluZyBpcyBtYXhpbWFhbCBvcCB0PTAuNSAoU3RyZXNzLXBpZWspCiAgICAgICAgY29uc3Qgd2FycEZhY3RvciA9IDEgLSBNYXRoLmFicygxIC0gMiAqIGVhc2VkVCk7IAogICAgICAgIGNvbnN0IHdhcnBYID0gTWF0aC5zaW4odCAqIE1hdGguUEkgKiAxMCkgKiB1bmlxdWVTdGF0ZS5tYXhXYXJwICogd2lkdGggKiB3YXJwRmFjdG9yOwogICAgICAgIGNvbnN0IHdhcnBZID0gTWF0aC5jb3ModCAqIE1hdGguUEkgKiAxMCkgKiB1bmlxdWVTdGF0ZS5tYXhXYXJwICogaGVpZ2h0ICogd2FycEZhY3RvcjsKCiAgICAgICAgLy8gT3VkZSBhZmJlZWxkaW5nOiBWZXJ2b3JtdCBlbiBrcmltcHQKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgCiAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogICAgICAgIGN0eC5zY2FsZSgxIC0gd2FycEZhY3RvciAqIDAuMSwgMSAtIHdhcnBGYWN0b3IgKiAwLjEpOyAvLyBTdWJ0aWVsZSBrcmltcAogICAgICAgIAogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAtd2lkdGggLyAyICsgd2FycFgsIC1oZWlnaHQgLyAyICsgd2FycFksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIC8vIE5pZXV3ZSBhZmJlZWxkaW5nOiBHcm9laXQgZW4gaGVyc3RlbHQgKHJlYm91bmQpCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgCiAgICAgICAgY3R4LnRyYW5zbGF0ZSh3aWR0aCAvIDIsIGhlaWdodCAvIDIpOwogICAgICAgIGN0eC5zY2FsZSgxICsgd2FycEZhY3RvciAqIDAuMSwgMSArIHdhcnBGYWN0b3IgKiAwLjEpOyAvLyBTdWJ0aWVsZSBncm9laSAodGVnZW5vdmVyZ2VzdGVsZGUgdmFuIG91ZCkKICAgICAgICAKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgLXdpZHRoIC8gMiAtIHdhcnBYLCAtaGVpZ2h0IC8gMiAtIHdhcnBZLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHgucmVzdG9yZSgpOwogICAgICAgIAogICAgICAgIGRyYXdIZWFsaW5nVGV4dCh0LCB1bmlxdWVTdGF0ZS5tZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKQU5JTUFUSU9OX0xPR0lDWzc4XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTUwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwsIG51bUNlbGxzOiAzMDAgfTsKICAgIAogICAgZnVuY3Rpb24gaW5pdCgpIHsgCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgCiAgICAgICAgLy8gQXNzdW1lIGdldFJhbmRvbU1lc3NhZ2UoKSBpcyBkZWZpbmVkIGVsc2V3aGVyZQogICAgICAgIHVuaXF1ZVN0YXRlLm1lc3NhZ2UgPSBnZXRSYW5kb21NZXNzYWdlKCk7IAogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIC8vIEFzc3VtZSBjYW52YXMsIGN0eCwgbGVycCwgZWFzZUluT3V0UXVpbnQsIGN1cnJlbnRJbWFnZSwgCiAgICAgICAgLy8gbmV4dEltYWdlLCBkcmF3SGVhbGluZ1RleHQsIGFuZCBzdGFydE5leHRUcmFuc2l0aW9uIGFyZSBkZWZpbmVkIGdsb2JhbGx5LgogICAgICAgIAogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgbnVtQ2VsbHMgPSB1bmlxdWVTdGF0ZS5udW1DZWxsczsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gMS4gT2xkIGltYWdlIChGYWRlIE91dCkKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxOyAvLyBSZXNldCBhbHBoYQoKICAgICAgICAvLyAyLiBOZXcgaW1hZ2UgKENsaXBwaW5nL01hc2tpbmcgRWZmZWN0KQogICAgICAgIGN0eC5zYXZlKCk7CgogICAgICAgIC8vIC0tLSBTdGVwIEE6IERyYXcgdGhlIG1hc2sgKGFsbCBjaXJjbGVzKSAtLS0KICAgICAgICAvLyBUaGlzIGlzIG11Y2ggZmFzdGVyIGFzIGl0IGF2b2lkcyByZXBlYXRlZCBjb21wb3NpdGluZyBjaGFuZ2VzIGluIHRoZSBsb29wLgogICAgICAgIGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLW92ZXInOyAKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1DZWxsczsgaSsrKSB7CiAgICAgICAgICAgIC8vIFVuaXF1ZSBwb3NpdGlvbiBiYXNlZCBvbiBpbmRleCBhbmQgdGltZQogICAgICAgICAgICBjb25zdCByYW5kWCA9IChNYXRoLnNpbihpICogMTAgKyB0ICogNSkgKiAwLjUgKyAwLjUpOwogICAgICAgICAgICBjb25zdCByYW5kWSA9IChNYXRoLmNvcyhpICogMTAgKyB0ICogNSkgKiAwLjUgKyAwLjUpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gWC9ZIHBvc2l0aW9uIChtaWdyYXRpbmcgYWxvbmcgYW4gYXhpcykKICAgICAgICAgICAgY29uc3QgY2VsbFggPSBsZXJwKHdpZHRoICogcmFuZFgsIHdpZHRoICogcmFuZFggKyB3aWR0aCAqIDEuNSwgZWFzZWRUKSAlICh3aWR0aCAqIDEuNSk7CiAgICAgICAgICAgIGNvbnN0IGNlbGxZID0gbGVycChoZWlnaHQgKiByYW5kWSwgaGVpZ2h0ICogcmFuZFkgKyBoZWlnaHQgKiAxLjUsIGVhc2VkVCkgJSAoaGVpZ2h0ICogMS41KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENlbGwgcmFkaXVzIChncm93cyBzbGlnaHRseSkKICAgICAgICAgICAgY29uc3QgcmFkaXVzID0gMTAgKyBNYXRoLnNpbih0ICogTWF0aC5QSSkgKiA1OyAKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAgICAgY3R4LmFyYyhjZWxsWCwgY2VsbFksIHJhZGl1cywgMCwgMiAqIE1hdGguUEkpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGhlIGNvbG9yIG9mIHRoZSBjZWxscyBpcyBhIGhlYWxpbmcgZ3JlZW4gdGludCwgZmFkaW5nIGluCiAgICAgICAgICAgIC8vIEFscGhhIGhlcmUgY29udHJvbHMgdGhlIHZpc2liaWxpdHkvc3RyZW5ndGggb2YgdGhlIG1hc2sgcGl4ZWxzCiAgICAgICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiYSgxMDAsIDI1NSwgMTAwLCAke2Vhc2VkVCAqIDAuNzV9KWA7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIC0tLSBTdGVwIEI6IFVzZSB0aGUgbWFzayB0byBjbGlwIHRoZSBORVcgaW1hZ2UgLS0tCiAgICAgICAgLy8gJ3NvdXJjZS1hdG9wJyBkcmF3cyB0aGUgbmV3IGltYWdlIG9ubHkgb3ZlciB0aGUgYXJlYSBjb3ZlcmVkIGJ5IHRoZSBjaXJjbGVzICh0aGUgbWFzaykuCiAgICAgICAgLy8gVGhpcyBhY2hpZXZlcyB0aGUgZGVzaXJlZCBjbGlwcGluZy9yZXZlYWwgZWZmZWN0IGluIG9uZSBjYWxsLgogICAgICAgIGN0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnc291cmNlLWF0b3AnOyAKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgY3R4LnJlc3RvcmUoKTsgLy8gUmVzdG9yZSBnbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gdG8gZGVmYXVsdCAoJ3NvdXJjZS1vdmVyJykKCiAgICAgICAgLy8gMy4gU2ltcGxpZmllZCBibGVuZDogRHJhdyB0aGUgbmV3IGltYWdlIG92ZXIgZXZlcnl0aGluZyBmb3IgYSBmaW5hbCBmYWRlLWluCiAgICAgICAgLy8gVGhpcyBlbnN1cmVzIGEgc21vb3RoIGZ1bGwgdHJhbnNpdGlvbiBpZiB0aGUgbWFza2luZyBpc24ndCBjb21wbGV0ZS4KICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7IC8vIFJlc2V0IGFscGhhCiAgICAgICAgCiAgICAgICAgLy8gQXNzdW1lIGRyYXdIZWFsaW5nVGV4dCgpIGlzIGRlZmluZWQgZWxzZXdoZXJlCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBFbmQgc3RhdGU6IEVuc3VyZSBuZXh0SW1hZ2UgaXMgZnVsbHkgZHJhd24KICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAvLyBBc3N1bWUgc3RhcnROZXh0VHJhbnNpdGlvbigpIGlzIGRlZmluZWQgZWxzZXdoZXJlCiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE2Ny4gT3h5dG9jaW4gV2F2ZSAoSGVjaHRpbmcgZW4gU29jaWFsZSBJbW11bml0ZWl0KQovLyBFZmZlY3Q6IFphY2h0ZSwgYnJlZGUgZ29sZiB2YW4ga2xldXIgZW4gYmx1ciB2YW51aXQgaGV0IGNlbnRydW0KLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzc3XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTEwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IHVuaXF1ZVN0YXRlLm1lc3NhZ2UgPSBnZXRSYW5kb21NZXNzYWdlKCk7IH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7CiAgICAgICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgod2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gMS4gT3VkZSBhZmJlZWxkaW5nICh2ZXJ2YWFndCBtZXQgZWVuIGJsdXIpCiAgICAgICAgY29uc3QgYmx1ciA9IGxlcnAoMCwgMjAsIE1hdGguc2luKHQgKiBNYXRoLlBJKSk7CiAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7Ymx1cn1weClgOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5maWx0ZXIgPSAnbm9uZSc7CgogICAgICAgIC8vIDIuIE5pZXV3ZSBhZmJlZWxkaW5nCiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gZWFzZWRUOwogICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyAzLiBEZSBPeHl0b2NpbmUgR29sZiAoZWVuIHphY2h0ZSwgcHVsc2VyZW5kZSBrbGV1cikKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IHdhdmVSYWRpdXMgPSBtYXhEaW0gKiBlYXNlZFQgKiAxLjU7IAogICAgICAgIGNvbnN0IHdhdmVBbHBoYSA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgCgogICAgICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGNlbnRlclgsIGNlbnRlclksIDAsIGNlbnRlclgsIGNlbnRlclksIHdhdmVSYWRpdXMpOwogICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCBgcmdiYSgyNTUsIDE5MiwgMjAzLCAke3dhdmVBbHBoYSAqIDAuOH0pYCk7IC8vIFJvemUgKExpZWZkZS9PeHl0b2NpbmUpCiAgICAgICAgZ3JhZGllbnQuYWRkQ29sb3JTdG9wKDAuNSwgYHJnYmEoMjU1LCAxOTIsIDIwMywgJHt3YXZlQWxwaGEgKiAwLjN9KWApOwogICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgxLCBgcmdiYSgyNTUsIDE5MiwgMjAzLCAwKWApOwogICAgICAgIAogICAgICAgIGN0eC5maWxsU3R5bGUgPSBncmFkaWVudDsKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAKICAgICAgICBkcmF3SGVhbGluZ1RleHQodCwgdW5pcXVlU3RhdGUubWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE2OC4gRW5kb3JwaGluIENhc2NhZGUgKEVuZG9nZW5lIEZhcm1hY29sb2dpZSkKLy8gRWZmZWN0OiBIZWxkZXJlLCBrbGVpbmUgZW5lcmdpZXBhcnRpa2VscyBleHBsb2RlcmVuIHZhbnVpdCBoZXQgY2VudHJ1bQovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbNzVdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiA4MCwgY3VycmVudEZyYW1lOiAwLCBtZXNzYWdlOiBudWxsLCBwYXJ0aWNsZXM6IFtdIH07CiAgICAKICAgIGZ1bmN0aW9uIGluaXQoKSB7IAogICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IAogICAgICAgIHVuaXF1ZVN0YXRlLm1lc3NhZ2UgPSBnZXRSYW5kb21NZXNzYWdlKCk7IAogICAgICAgIHVuaXF1ZVN0YXRlLnBhcnRpY2xlcyA9IFtdOwogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IGNlbnRlclggPSB3aWR0aCAvIDI7CiAgICAgICAgY29uc3QgY2VudGVyWSA9IGhlaWdodCAvIDI7CiAgICAgICAgCiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUucGFydGljbGVzLnB1c2goewogICAgICAgICAgICAgICAgeDogY2VudGVyWCwKICAgICAgICAgICAgICAgIHk6IGNlbnRlclksCiAgICAgICAgICAgICAgICBhbmdsZTogTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyLAogICAgICAgICAgICAgICAgc3BlZWQ6IE1hdGgucmFuZG9tKCkgKiA1ICsgMiwKICAgICAgICAgICAgICAgIGNvbG9yOiBgaHNsKCR7TWF0aC5yYW5kb20oKSAqIDYwICsgMzB9LCAxMDAlLCA3MCUpYCAvLyBHb3VkL09yYW5qZSB0aW50ZW4KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgLy8gT3VkZSBhZmJlZWxkaW5nIHZlcnZhYWd0CiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgLy8gTmlldXdlIGFmYmVlbGRpbmcgdmVyc2NoaWpudAogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgLy8gRGUgRW5kb3JmaW5lIENhc2NhZGUKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIHVuaXF1ZVN0YXRlLnBhcnRpY2xlcy5mb3JFYWNoKHAgPT4gewogICAgICAgICAgICAvLyBVcGRhdGUgcG9zaXRpZQogICAgICAgICAgICBjb25zdCBkaXN0YW5jZSA9IHAuc3BlZWQgKiB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgKiAyOwogICAgICAgICAgICBwLnggPSB3aWR0aCAvIDIgKyBNYXRoLmNvcyhwLmFuZ2xlKSAqIGRpc3RhbmNlOwogICAgICAgICAgICBwLnkgPSBoZWlnaHQgLyAyICsgTWF0aC5zaW4ocC5hbmdsZSkgKiBkaXN0YW5jZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRla2VuIGRlIGRlZWx0amVzIChtYXhpbWFhbCB6aWNodGJhYXIgaW4gaGV0IG1pZGRlbikKICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gTWF0aC5tYXgoMCwgMSAtIGRpc3RhbmNlIC8gTWF0aC5tYXgod2lkdGgsIGhlaWdodCkgKiAwLjUpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gcC5jb2xvcjsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHguYXJjKHAueCwgcC55LCAzLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfSk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAKICAgICAgICBkcmF3SGVhbGluZ1RleHQodCwgdW5pcXVlU3RhdGUubWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE2OS4gTWl0b2Nob25kcmlhbCBQb3dlci1VcCAoRW5lcmdpZWJlaG91ZCkKLy8gRWZmZWN0OiBQdWxzZXJlbmRlIGdsb2VkIGRpZSBlbmVyZ2llb3ZlcmRyYWNodCB2ZXJzbmVsdAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbNzNdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMDAsIGN1cnJlbnRGcmFtZTogMCwgbWVzc2FnZTogbnVsbCB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgdW5pcXVlU3RhdGUubWVzc2FnZSA9IGdldFJhbmRvbU1lc3NhZ2UoKTsgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjsKICAgICAgICBjb25zdCBtYXhEaW0gPSBNYXRoLm1heCh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIC8vIERlIHB1bHNlcmVuZGUgZmFjdG9yIChzbmVsIGtuaXBwZXJlbmQsIG1heCBhbXBsaXR1ZGUgb3AgdD0wLjUpCiAgICAgICAgY29uc3QgcHVsc2UgPSAwLjUgKyAwLjUgKiBNYXRoLnNpbih0ICogTWF0aC5QSSAqIDE1KTsgCiAgICAgICAgY29uc3QgYmx1ckFtb3VudCA9IDEwICogcHVsc2UgKiBNYXRoLnNpbih0ICogTWF0aC5QSSk7IC8vIEJsdXIgaXMgbWF4aW1hYWwgaW4gaGV0IG1pZGRlbgoKICAgICAgICAvLyAxLiBPdWRlIGFmYmVlbGRpbmcgKHZlcnZhYWd0IG1ldCBwdWxzZXJlbmRlIGJsdXIpCiAgICAgICAgY3R4LmZpbHRlciA9IGBibHVyKCR7Ymx1ckFtb3VudH1weClgOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5maWx0ZXIgPSAnbm9uZSc7CgogICAgICAgIC8vIDIuIE5pZXV3ZSBhZmJlZWxkaW5nICh2ZXJzY2hpam50IG1ldCBwdWxzZXJlbmRlIGhlbGRlcmhlaWQpCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAvLyBTdXBlci1zYXR1cmF0aWUgZWZmZWN0IGluIGhldCBtaWRkZW4KICAgICAgICBjdHguZmlsdGVyID0gYHNhdHVyYXRlKCR7MSArIDIgKiBwdWxzZSAqIE1hdGguc2luKHQgKiBNYXRoLlBJKX0pYDsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgLy8gMy4gRGUgQVRQLUdsb2VkIChSYWRpYWxlIGdyb2VuZSBnbG9lZCkKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGNvbnN0IGdsb3dSYWRpdXMgPSBtYXhEaW0gKiBlYXNlZFQ7IAogICAgICAgIGNvbnN0IGdyYWRpZW50ID0gY3R4LmNyZWF0ZVJhZGlhbEdyYWRpZW50KGNlbnRlclgsIGNlbnRlclksIDAsIGNlbnRlclgsIGNlbnRlclksIGdsb3dSYWRpdXMpOwogICAgICAgIGdyYWRpZW50LmFkZENvbG9yU3RvcCgwLCBgcmdiYSgxNTAsIDI1NSwgMTUwLCAke2Vhc2VkVCAqIDAuNSAqIHB1bHNlfSlgKTsKICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMC41LCBgcmdiYSgxNTAsIDI1NSwgMTUwLCAke2Vhc2VkVCAqIDAuMiAqIHB1bHNlfSlgKTsKICAgICAgICBncmFkaWVudC5hZGRDb2xvclN0b3AoMSwgJ3JnYmEoMTUwLCAyNTUsIDE1MCwgMCknKTsKICAgICAgICAKICAgICAgICBjdHguZmlsbFN0eWxlID0gZ3JhZGllbnQ7CiAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNzAuIEVwaWdlbmV0aWMgU2hpZnQgKEFkYXB0aWV2ZSBSZXNwb25zZSBTeXN0ZWVtKQovLyBFZmZlY3Q6IEhvcml6b250YWxlIEROQS1hY2h0aWdlIHN0cmlwcyBvbnRodWxsZW4gZGUgbmlldXdlIGFmYmVlbGRpbmcKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzc0XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTMwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwsIG51bVN0cmlwczogMzAgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IHVuaXF1ZVN0YXRlLm1lc3NhZ2UgPSBnZXRSYW5kb21NZXNzYWdlKCk7IH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIGNvbnN0IHN0cmlwSCA9IGhlaWdodCAvIHVuaXF1ZVN0YXRlLm51bVN0cmlwczsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdW5pcXVlU3RhdGUubnVtU3RyaXBzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgeSA9IGkgKiBzdHJpcEg7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVbmlla2UgdmVydHJhZ2luZyBwZXIgc3RyaXAgdm9vciBoZXQgJ29ud2luZGVuJyBlZmZlY3QKICAgICAgICAgICAgY29uc3QgZGVsYXkgPSBpIC8gdW5pcXVlU3RhdGUubnVtU3RyaXBzOwogICAgICAgICAgICBjb25zdCBzdHJpcFQgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCAoZWFzZWRUIC0gZGVsYXkgKiAwLjIpICogMS41KSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBEZSB2ZXJzY2h1aXZpbmcgdmFuIGRlIG91ZGUgYWZiZWVsZGluZyAoZ2FhdCBuYWFyIGxpbmtzKQogICAgICAgICAgICBjb25zdCBvbGRTaGlmdFggPSBsZXJwKDAsIC13aWR0aCwgc3RyaXBUKTsgCiAgICAgICAgICAgIC8vIERlIHZlcnNjaHVpdmluZyB2YW4gZGUgbmlldXdlIGFmYmVlbGRpbmcgKGtvbXQgdmFuIHJlY2h0cykKICAgICAgICAgICAgY29uc3QgbmV3U2hpZnRYID0gbGVycCh3aWR0aCwgMCwgc3RyaXBUKTsgCiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBUZWtlbiBkZSBzdHJpcCB2b29yIGRlIE91ZGUgQWZiZWVsZGluZwogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KDAsIHksIHdpZHRoLCBzdHJpcEgpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICBjdHgudHJhbnNsYXRlKG9sZFNoaWZ0WCwgMCk7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFRla2VuIGRlIHN0cmlwIHZvb3IgZGUgTmlldXdlIEFmYmVlbGRpbmcKICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjdHgucmVjdCgwLCB5LCB3aWR0aCwgc3RyaXBIKTsKICAgICAgICAgICAgY3R4LmNsaXAoKTsKICAgICAgICAgICAgY3R4LnRyYW5zbGF0ZShuZXdTaGlmdFgsIDApOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGRyYXdIZWFsaW5nVGV4dCh0LCB1bmlxdWVTdGF0ZS5tZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTcxLiBGcm9udGFsIExvYmUgQ29oZXNpb24gKEludGVncml0ZWl0IHZhbiBoZXQgWmVsZnN5c3RlZW0pCi8vIEVmZmVjdDogR2VvbWV0cmlzY2hlIHN0dWtrZW4ga29tZW4gc2FtZW4gaW4gZWVuIGNvbnNpc3RlbnRlIGdyaWQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzcyXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTEwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwsIGdyaWRTaXplOiA4IH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB1bmlxdWVTdGF0ZS5tZXNzYWdlID0gZ2V0UmFuZG9tTWVzc2FnZSgpOyB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCBwaWVjZVcgPSB3aWR0aCAvIHVuaXF1ZVN0YXRlLmdyaWRTaXplOwogICAgICAgIGNvbnN0IHBpZWNlSCA9IGhlaWdodCAvIHVuaXF1ZVN0YXRlLmdyaWRTaXplOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCB1bmlxdWVTdGF0ZS5ncmlkU2l6ZTsgeSsrKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgdW5pcXVlU3RhdGUuZ3JpZFNpemU7IHgrKykgewogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0WCA9IHggKiBwaWVjZVc7CiAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRZID0geSAqIHBpZWNlSDsKICAgICAgICAgICAgICAgIGNvbnN0IGNlbnRlclggPSB0YXJnZXRYICsgcGllY2VXIC8gMjsKICAgICAgICAgICAgICAgIGNvbnN0IGNlbnRlclkgPSB0YXJnZXRZICsgcGllY2VIIC8gMjsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQmVnaW5wb3NpdGllIGlzIHdpbGxla2V1cmlnIHZhbiBkZSByYW5kCiAgICAgICAgICAgICAgICBjb25zdCBzdGFydFggPSBjZW50ZXJYICsgKHggJSAyID09PSAwID8gLXdpZHRoIDogd2lkdGgpOwogICAgICAgICAgICAgICAgY29uc3Qgc3RhcnRZID0gY2VudGVyWSArICh5ICUgMiA9PT0gMCA/IC1oZWlnaHQgOiBoZWlnaHQpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBIdWlkaWdlIHBvc2l0aWUKICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRYID0gbGVycChzdGFydFgsIGNlbnRlclgsIGVhc2VkVCk7CiAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50WSA9IGxlcnAoc3RhcnRZLCBjZW50ZXJZLCBlYXNlZFQpOwoKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKGN1cnJlbnRYLCBjdXJyZW50WSk7CgogICAgICAgICAgICAgICAgLy8gVGVrZW4gZGUgbmlldXdlIGFmYmVlbGRpbmcgKGtvbXQgc2FtZW4pCiAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgdGFyZ2V0WCwgdGFyZ2V0WSwgcGllY2VXLCBwaWVjZUgsIC1waWVjZVcgLyAyLCAtcGllY2VIIC8gMiwgcGllY2VXLCBwaWVjZUgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBUZWtlbiBkZSBvdWRlIGFmYmVlbGRpbmcgKGdhYXQgdWl0IGVsa2FhcikKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgdGFyZ2V0WCwgdGFyZ2V0WSwgcGllY2VXLCBwaWVjZUgsIC1waWVjZVcgLyAyLCAtcGllY2VIIC8gMiwgcGllY2VXLCBwaWVjZUgpOwoKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNzIuIERlZXAgU2xlZXAgVGhldGEgUmh5dGhtIChTbGFhcGN5Y2x1cyBPcHRpbWFsaXNhdGllKQovLyBFZmZlY3Q6IExhbmd6YW1lLCB1aXRnZXN0cmVrdGUsIGRvbmtlcmUgZ29sdmVuIHdpc3NlbiBoZXQgYmVlbGQKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzY3XSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogMTYwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwgfTsKICAgIGZ1bmN0aW9uIGluaXQoKSB7IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA9IDA7IHVuaXF1ZVN0YXRlLm1lc3NhZ2UgPSBnZXRSYW5kb21NZXNzYWdlKCk7IH0KICAgIAogICAgZnVuY3Rpb24gYW5pbWF0ZSgpIHsKICAgICAgICBjb25zdCB0ID0gdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIC8gdW5pcXVlU3RhdGUudG90YWxGcmFtZXM7CiAgICAgICAgY29uc3QgZWFzZWRUID0gZWFzZUluT3V0UXVpbnQodCk7IAogICAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gY2FudmFzOwogICAgICAgIAogICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CgogICAgICAgIC8vIERlIGdvbGZiZXdlZ2luZyAobGFuZ3phYW0gZW4gZGllcCkKICAgICAgICBjb25zdCB3YXZlID0gTWF0aC5zaW4odCAqIE1hdGguUEkgKiAyKTsgLy8gMiB2b2xsZWRpZ2UgY3ljbGkKICAgICAgICBjb25zdCBkaXNwbGFjZW1lbnQgPSB3aWR0aCAqIDAuMSAqIHdhdmUgKiAoMSAtIGVhc2VkVCk7IC8vIFdvcmR0IHZsYWsgYWFuIGhldCBlaW5kZQogICAgICAgIAogICAgICAgIC8vIDEuIE91ZGUgYWZiZWVsZGluZyAodmVydmFhZ3QgZW4gd29yZHQgZG9ua2VyZGVyKQogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDEgLSBlYXNlZFQ7CiAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIC8vIDIuIE5pZXV3ZSBhZmJlZWxkaW5nIChrb210IHZhbiBkb25rZXIgZW4gd29yZHQgaGVsZGVyKQogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGVhc2VkVDsKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgCiAgICAgICAgLy8gMy4gRGUgVGhldGEgR29sZiAoZG9ua2VyZSwgdmxvZWllbmRlIG92ZXJsYXkpCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoMCwgMCwgNTAsICR7TWF0aC5zaW4odCAqIE1hdGguUEkpICogMC43fSlgOyAvLyBEaWVwYmxhdXdlL3BhYXJzZSBrbGV1cgogICAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBWb2VnIGRlIGdvbHZlbmRlIHZlcnN0b3JpbmcgdG9lCiAgICAgICAgZm9yIChsZXQgeSA9IDA7IHkgPCBoZWlnaHQ7IHkgKz0gMTApIHsKICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBkaXNwbGFjZW1lbnQgKyBNYXRoLnNpbih5ICogMC4wNSkgKiA1MCAqIE1hdGguc2luKHQgKiBNYXRoLlBJKTsKICAgICAgICAgICAgY3R4Lm1vdmVUbygwLCB5KTsKICAgICAgICAgICAgY3R4LmxpbmVUbyh3aWR0aCwgeSArIG9mZnNldCk7CiAgICAgICAgICAgIGN0eC5saW5lVG8od2lkdGgsIHkgKyAxMCArIG9mZnNldCk7CiAgICAgICAgICAgIGN0eC5saW5lVG8oMCwgeSArIDEwKTsKICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gYHJnYmEoMCwgMCwgMCwgJHtNYXRoLnNpbih0ICogTWF0aC5QSSkgKiAwLjJ9KWA7CiAgICAgICAgICAgIGN0eC5maWxsKCk7CiAgICAgICAgfQogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNzMuIEFsbG9zdGF0aWMgUmVsaWVmIERpc3NvbHZlIChTdHJlc3MtQWRhcHRhdGllKQovLyBFZmZlY3Q6IFJ1aXMtZ2ViYXNlZXJkZSB2ZXJkd2lqbmluZyB3YWFyIHJ1aXMgd29yZHQgZ2VyZWR1Y2VlcmQgdG90IG51bAovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTczLiBUaGUgU3RyZXNzIERpc3NpcGF0aW9uIEVmZmVjdCAoR2VyYWFzKQovLyBHZW9wdGltYWxpc2VlcmQ6IFN0ZXAgc2l6ZSB2ZXJob29nZCB2YW4gMiBuYWFyIDQuIE9uZ2VicnVpa3RlIGdldEltYWdlRGF0YSB2ZXJ3aWpkZXJkLgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbNjNdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IAogICAgICAgIHRvdGFsRnJhbWVzOiAxMDAsIAogICAgICAgIGN1cnJlbnRGcmFtZTogMCwgCiAgICAgICAgbWVzc2FnZTogbnVsbCwgCiAgICAgICAgbm9pc2VEYXRhOiBudWxsLAogICAgICAgIGdyaWRTdGVwOiA0IC8vIFZFUkhPT0dEIHZhbiAyIG5hYXIgNCBvbSBkcmF3IGNhbGxzIHRlIHZlcm1pbmRlcmVuCiAgICB9OwogICAgCiAgICAvLyBEZSAncHNldWRvLXJ1aXMnIGZ1bmN0aWUgaXMgZWZmaWNpw6tudCBnZW5vZWcsIG1hYXIgZGUgZnJlcXVlbnRpZSB2YW4gYWFucm9lcGVuIHdhcyB0ZSBob29nLgogICAgZnVuY3Rpb24gZ2V0Tm9pc2VWYWx1ZSh4LCB5LCBmcmFtZSkgewogICAgICAgIC8vIFBzZXVkby1ydWlzIG9wIGJhc2lzIHZhbiBjb8O2cmRpbmF0ZW4gZW4gZnJhbWUKICAgICAgICByZXR1cm4gTWF0aC5zaW4oeCAqIDAuMSkgKiBNYXRoLmNvcyh5ICogMC4xKSArIE1hdGguc2luKGZyYW1lICogMC4wNSk7CiAgICB9CiAgICAKICAgIC8vIEZ1bmN0aWUgb20gd2lsbGVrZXVyaWcgYmVyaWNodCBvcCB0ZSBoYWxlbiAoYWFubmFtZSBkYXQgZGV6ZSBlbGRlcnMgaXMgZ2VkZWZpbmllZXJkKQogICAgZnVuY3Rpb24gZ2V0UmFuZG9tTWVzc2FnZSgpIHsKICAgICAgICAvLyBQbGFjZWhvbGRlci9GYWxsYmFjawogICAgICAgIHJldHVybiAiICAgIjsKICAgIH0KCiAgICAvLyBGdW5jdGllIG9tIGRlIHRla3N0L2Vtb2ppJ3MgdGUgdGVrZW5lbiAoYWFubmFtZSBkYXQgZGV6ZSBlbGRlcnMgaXMgZ2VkZWZpbmllZXJkKQogICAgZnVuY3Rpb24gZHJhd0hlYWxpbmdUZXh0KHQsIG1lc3NhZ2UpIHsKICAgICAgICBpZiAoIWN0eCB8fCAhY2FudmFzKSByZXR1cm47CiAgICAgICAgCiAgICAgICAgLy8gU2ltcGVsZSB0ZWtzdHdlZXJnYXZlIHZvb3IgZGUgZGVtbwogICAgICAgIGNvbnN0IGFscGhhID0gTWF0aC5zaW4odCAqIE1hdGguUEkpOyAKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhOwogICAgICAgIGN0eC50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgICAgICBjdHguZm9udCA9IGAzMHB4ICdJbnRlcicsIHNhbnMtc2VyaWZgOwogICAgICAgIGN0eC5maWxsU3R5bGUgPSBgcmdiYSgyNTUsIDI1NSwgMjU1LCAke2FscGhhfSlgOwogICAgICAgIGN0eC5maWxsVGV4dChtZXNzYWdlLCBjYW52YXMud2lkdGggLyAyLCBjYW52YXMuaGVpZ2h0IC8gMik7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgIH0KICAgIAogICAgZnVuY3Rpb24gaW5pdCgpIHsgCiAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgCiAgICAgICAgdW5pcXVlU3RhdGUubWVzc2FnZSA9IGdldFJhbmRvbU1lc3NhZ2UoKTsgCiAgICB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCBzdGVwID0gdW5pcXVlU3RhdGUuZ3JpZFN0ZXA7CiAgICAgICAgCiAgICAgICAgLy8gMS4gVGVrZW4gZGUgbmlldXdlIGFmYmVlbGRpbmcgYWxzIGJhc2lzCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7IAogICAgICAgIAogICAgICAgIC8vICoqT1BSVUlNSU5HOiBjdHguZ2V0SW1hZ2VEYXRhIGlzIHZlcndpamRlcmQgb21kYXQgZGUgZGF0YSBuaWV0IHdlcmQgZ2VicnVpa3QuKioKICAgICAgICAKICAgICAgICAvLyBSdWlzaW50ZW5zaXRlaXQgKFN0cmVzcykgZGFhbHQgdmFuIDEgbmFhciAwCiAgICAgICAgY29uc3Qgbm9pc2VJbnRlbnNpdHkgPSAxIC0gZWFzZWRUOwogICAgICAgIAogICAgICAgIC8vIFRla2VuIGRlIE91ZGUgQWZiZWVsZGluZyBtZXQgcnVpcyAobGFnZXJlIGl0ZXJhdGllID0gc25lbGxlcikKICAgICAgICAvLyBXZSBnZWJydWlrZW4gZGUgc3RhcGdyb290dGUgKHN0ZXApIG9tIGRlIGRyYXcgY2FsbHMgdGUgdmVybWluZGVyZW4KICAgICAgICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSArPSBzdGVwKSB7CiAgICAgICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHggKz0gc3RlcCkgewogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBOb2lzZSB0aHJlc2hvbGQgKGJlcGFhbHQgb2YgaGV0IHN0dWtqZSB2YW4gZGUgb3VkZSBhZmJlZWxkaW5nIG5vZyB6aWNodGJhYXIgaXMpCiAgICAgICAgICAgICAgICBjb25zdCBub2lzZVZhbCA9IGdldE5vaXNlVmFsdWUoeCwgeSwgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKSAqIG5vaXNlSW50ZW5zaXR5ICogMC41ICsgMC41OwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAobm9pc2VWYWwgPiAwLjUgJiYgbm9pc2VJbnRlbnNpdHkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBub2lzZUludGVuc2l0eSAqIDAuODsKICAgICAgICAgICAgICAgICAgICAvLyBUZWtlbiBlZW4ga2xlaW4gc3R1a2plIHZhbiBkZSBvdWRlIGFmYmVlbGRpbmcgKGdlYnJ1aWt0IGRlIG5pZXV3ZSBzdGFwZ3Jvb3R0ZSkKICAgICAgICAgICAgICAgICAgICBjdHguZHJhd0ltYWdlKGN1cnJlbnRJbWFnZSwgeCwgeSwgc3RlcCwgc3RlcCwgeCwgeSwgc3RlcCwgc3RlcCk7CiAgICAgICAgICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAKICAgICAgICBkcmF3SGVhbGluZ1RleHQodCwgdW5pcXVlU3RhdGUubWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIDE3NC4gUHJvcHJpb2NlcHRpb24gR3JpZCBMb2NrIChQb3N0dXJhbGUgU3RhYmlsaXNhdGllKQovLyBFZmZlY3Q6IEVlbiByYXN0ZXIgdmFuIHB1bnRlbiBzbmFwdCBpbiBwb3NpdGllCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1s0MF0gPSAoZnVuY3Rpb24oKSB7CiAgICBjb25zdCB1bmlxdWVTdGF0ZSA9IHsgdG90YWxGcmFtZXM6IDgwLCBjdXJyZW50RnJhbWU6IDAsIG1lc3NhZ2U6IG51bGwsIGdyaWRTaXplOiAxNSB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgdW5pcXVlU3RhdGUubWVzc2FnZSA9IGdldFJhbmRvbU1lc3NhZ2UoKTsgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgcGllY2VXID0gd2lkdGggLyB1bmlxdWVTdGF0ZS5ncmlkU2l6ZTsKICAgICAgICBjb25zdCBwaWVjZUggPSBoZWlnaHQgLyB1bmlxdWVTdGF0ZS5ncmlkU2l6ZTsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIAogICAgICAgIGZvciAobGV0IHkgPSAwOyB5IDwgdW5pcXVlU3RhdGUuZ3JpZFNpemU7IHkrKykgewogICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8IHVuaXF1ZVN0YXRlLmdyaWRTaXplOyB4KyspIHsKICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldFggPSB4ICogcGllY2VXOwogICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0WSA9IHkgKiBwaWVjZUg7CgogICAgICAgICAgICAgICAgLy8gRGUgT3VkZSBhZmJlZWxkaW5nIGlzIHppY2h0YmFhciBhbHMgZGUgdHJhbnNpdGllIG5pZXQgJ3Zhc3RrbGlrdCcKICAgICAgICAgICAgICAgIGNvbnN0IG9sZEFscGhhID0gMSAtIGVhc2VkVDsKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IG9sZEFscGhhOwogICAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIHRhcmdldFgsIHRhcmdldFksIHBpZWNlVywgcGllY2VILCB0YXJnZXRYLCB0YXJnZXRZLCBwaWVjZVcsIHBpZWNlSCk7CgogICAgICAgICAgICAgICAgLy8gRGUgTmlldXdlIGFmYmVlbGRpbmcgdmVyc2NoaWpudCBpbiBoZXQgbWlkZGVuIHZhbiBoZXQgJ2tsaWtrZW4nCiAgICAgICAgICAgICAgICBjb25zdCBuZXdBbHBoYSA9IGVhc2VkVDsKICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IG5ld0FscGhhOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAvLyBTbmFwcGluZyBlZmZlY3Q6IHNjaGFhbCB6YWt0IHNuZWwgbmFhciAwIGVuIGtvbXQgdGVydWcgKGFscyBlZW4gdmVlcikKICAgICAgICAgICAgICAgIGNvbnN0IHNuYXBQcm9ncmVzcyA9IDEgLSBNYXRoLmFicygxIC0gMiAqIHQpOwogICAgICAgICAgICAgICAgY29uc3Qgc2NhbGUgPSAxIC0gc25hcFByb2dyZXNzICogMC4yICogKDEgLSBlYXNlZFQpOyAvLyBMaWNodGUgdmVlciBhYW4gaGV0IGJlZ2luCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGN0eC5zYXZlKCk7CiAgICAgICAgICAgICAgICBjdHgudHJhbnNsYXRlKHRhcmdldFggKyBwaWVjZVcgLyAyLCB0YXJnZXRZICsgcGllY2VIIC8gMik7CiAgICAgICAgICAgICAgICBjdHguc2NhbGUoc2NhbGUsIHNjYWxlKTsKICAgICAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCB0YXJnZXRYLCB0YXJnZXRZLCBwaWVjZVcsIHBpZWNlSCwgLXBpZWNlVyAvIDIsIC1waWVjZUggLyAyLCBwaWVjZVcsIHBpZWNlSCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFRla2VuIGhldCAiYW5rZXJwdW50IiAocHJvcHJpb2NlcHRpZSBwdW50KQogICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2JhKDEwMCwgMTUwLCAyNTUsICR7c25hcFByb2dyZXNzICogMC44fSlgOwogICAgICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpOwogICAgICAgICAgICAgICAgY3R4LmFyYygwLCAwLCAzLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgICAgICAgICBjdHguZmlsbCgpOwoKICAgICAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNzUuIE1ldGFjb2duaXRpdmUgRm9jdXMgQXBlcnR1cmUgKEZlZWRiYWNrIExvb3BzKQovLyBFZmZlY3Q6IEVlbiBzY2hlcnAsIGluc3RlbGJhYXIgZGlhZnJhZ21hIG9udGh1bHQgZGUgaGVsZGVyZSBuaWV1d2UgYWZiZWVsZGluZwovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQpBTklNQVRJT05fTE9HSUNbMzRdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxMjAsIGN1cnJlbnRGcmFtZTogMCwgbWVzc2FnZTogbnVsbCwgbnVtQmxhZGVzOiA2IH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB1bmlxdWVTdGF0ZS5tZXNzYWdlID0gZ2V0UmFuZG9tTWVzc2FnZSgpOyB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCBjZW50ZXJYID0gd2lkdGggLyAyOwogICAgICAgIGNvbnN0IGNlbnRlclkgPSBoZWlnaHQgLyAyOwogICAgICAgIGNvbnN0IG1heERpbSA9IE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAvLyAxLiBPdWRlIGFmYmVlbGRpbmcgKGJsdXIgZW4gZGVzYXR1cmF0aWUgYWxzICdydWlzJykKICAgICAgICBjb25zdCBibHVyID0gbGVycCgyMCwgMCwgZWFzZWRUKTsKICAgICAgICBjb25zdCBzYXQgPSBsZXJwKDAuNSwgMS4wLCBlYXNlZFQpOwogICAgICAgIGN0eC5maWx0ZXIgPSBgYmx1cigke2JsdXJ9cHgpIHNhdHVyYXRlKCR7c2F0fSlgOwogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICBjdHguZmlsdGVyID0gJ25vbmUnOwogICAgICAgIAogICAgICAgIC8vIDIuIE5pZXV3ZSBhZmJlZWxkaW5nIChnZWNsaXB0IGRvb3IgaGV0IGRpYWZyYWdtYSkKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5iZWdpblBhdGgoKTsKICAgICAgICAKICAgICAgICBjb25zdCByYWRpdXMgPSBtYXhEaW0gKiAoMSAtIGVhc2VkVCk7IC8vIEhldCBkaWFmcmFnbWEgc2x1aXQKICAgICAgICAKICAgICAgICAvLyBDcmXDq2VyIGhldCBkaWFmcmFnbWEgKGVlbiB2ZWVsaG9layBkaWUgc2x1aXQpCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1bmlxdWVTdGF0ZS5udW1CbGFkZXM7IGkrKykgewogICAgICAgICAgICBjb25zdCBhbmdsZSA9IGkgKiAyICogTWF0aC5QSSAvIHVuaXF1ZVN0YXRlLm51bUJsYWRlczsKICAgICAgICAgICAgY29uc3QgeCA9IGNlbnRlclggKyBNYXRoLmNvcyhhbmdsZSkgKiByYWRpdXM7CiAgICAgICAgICAgIGNvbnN0IHkgPSBjZW50ZXJZICsgTWF0aC5zaW4oYW5nbGUpICogcmFkaXVzOwogICAgICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgICAgICAgY3R4Lm1vdmVUbyh4LCB5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGN0eC5saW5lVG8oeCwgeSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3R4LmNsb3NlUGF0aCgpOwogICAgICAgIGN0eC5jbGlwKCk7CiAgICAgICAgCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgCiAgICAgICAgZHJhd0hlYWxpbmdUZXh0KHQsIHVuaXF1ZVN0YXRlLm1lc3NhZ2UpOwoKICAgICAgICBpZiAodW5pcXVlU3RhdGUuY3VycmVudEZyYW1lIDwgdW5pcXVlU3RhdGUudG90YWxGcmFtZXMpIHsKICAgICAgICAgICAgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lKys7CiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdHguZHJhd0ltYWdlKG5leHRJbWFnZSwgMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgICAgIHN0YXJ0TmV4dFRyYW5zaXRpb24oKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4geyBpbml0OiBpbml0LCBhbmltYXRlOiBhbmltYXRlLCB1bmlxdWVTdGF0ZTogdW5pcXVlU3RhdGUgfTsKfSkoKTsKCgovLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQovLyAxNzYuIFN5bmFwdGljIFBydW5pbmcgV2lwZSAoTmV1cm9wbGFzdGljaXRlaXQpCi8vIEVmZmVjdDogV2lsbGVrZXVyaWdlIHN0cmlwcyB3b3JkZW4gc25lbCAnd2VnZ2V2ZWVnZCcKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KQU5JTUFUSU9OX0xPR0lDWzIzXSA9IChmdW5jdGlvbigpIHsKICAgIGNvbnN0IHVuaXF1ZVN0YXRlID0geyB0b3RhbEZyYW1lczogOTAsIGN1cnJlbnRGcmFtZTogMCwgbWVzc2FnZTogbnVsbCwgbnVtV2lwZXM6IDMwIH07CiAgICBmdW5jdGlvbiBpbml0KCkgeyB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPSAwOyB1bmlxdWVTdGF0ZS5tZXNzYWdlID0gZ2V0UmFuZG9tTWVzc2FnZSgpOyB9CiAgICAKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgICAgY29uc3QgdCA9IHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSAvIHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzOwogICAgICAgIGNvbnN0IGVhc2VkVCA9IGVhc2VJbk91dFF1aW50KHQpOyAKICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IGNhbnZhczsKICAgICAgICBjb25zdCB3aXBlVyA9IHdpZHRoIC8gdW5pcXVlU3RhdGUubnVtV2lwZXM7CiAgICAgICAgCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAKICAgICAgICAvLyBOaWV1d2UgYWZiZWVsZGluZyBhbHMgYmFzaXMgKGRlIHNjaG9uZSBsZWkpCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVuaXF1ZVN0YXRlLm51bVdpcGVzOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgeCA9IGkgKiB3aXBlVzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFVuaWVrZSB2ZXJ0cmFnaW5nIHBlciBzdHJpcAogICAgICAgICAgICBjb25zdCBkZWxheSA9IChpICUgNSkgLyA1OwogICAgICAgICAgICBjb25zdCB3aXBlVCA9IE1hdGgubWluKDEsIE1hdGgubWF4KDAsIChlYXNlZFQgLSBkZWxheSAqIDAuMSkgKiAxLjUpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZlcnRpY2FsZSB2ZXJzY2h1aXZpbmcgdmFuIGRlIHdpcGUgKHNuZWxsZSBzY2hvbmUgYmV3ZWdpbmcpCiAgICAgICAgICAgIGNvbnN0IHdpcGVZID0gbGVycCgwLCBoZWlnaHQsIHdpcGVUKTsgCiAgICAgICAgICAgIAogICAgICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgICAgICBjdHguYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGN0eC5yZWN0KHgsIDAsIHdpcGVXLCBoZWlnaHQpOwogICAgICAgICAgICBjdHguY2xpcCgpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVGVrZW4gZGUgT3VkZSBBZmJlZWxkaW5nIChnZWRlZWx0ZWxpamsgYmVkZWt0IGRvb3IgZGUgd2lwZSkKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShjdXJyZW50SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gRGUgd2lwZSAoZWVuIHp3YXJ0ZSByZWNodGhvZWsgZGllIHZhbiBib3ZlbiBuYWFyIGJlbmVkZW4gYmV3ZWVndCkKICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGByZ2JhKDAsIDAsIDAsIDEgLSB3aXBlVClgOyAvLyBWZXJ2YWFndCBkZSB3aXBlIHplbGYgb3AgaGV0IGVpbmRlCiAgICAgICAgICAgIGN0eC5maWxsUmVjdCh4LCB3aXBlWSwgd2lwZVcsIGhlaWdodCAtIHdpcGVZKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGRyYXdIZWFsaW5nVGV4dCh0LCB1bmlxdWVTdGF0ZS5tZXNzYWdlKTsKCiAgICAgICAgaWYgKHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSA8IHVuaXF1ZVN0YXRlLnRvdGFsRnJhbWVzKSB7CiAgICAgICAgICAgIHVuaXF1ZVN0YXRlLmN1cnJlbnRGcmFtZSsrOwogICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICBzdGFydE5leHRUcmFuc2l0aW9uKCk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIHsgaW5pdDogaW5pdCwgYW5pbWF0ZTogYW5pbWF0ZSwgdW5pcXVlU3RhdGU6IHVuaXF1ZVN0YXRlIH07Cn0pKCk7CgoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KLy8gMTc3LiBWYWdhbCBUb25lIEhhcm1vbmljIChIb21lb3N0YXNlL1dpbmRzdGlsdGUpCi8vIEVmZmVjdDogRWVuIHphY2h0ZSwgbGFnZS1mcmVxdWVudGllIGdvbGYgYnJlaWR0IHppY2ggdWl0Ci8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CkFOSU1BVElPTl9MT0dJQ1sxMDRdID0gKGZ1bmN0aW9uKCkgewogICAgY29uc3QgdW5pcXVlU3RhdGUgPSB7IHRvdGFsRnJhbWVzOiAxNDAsIGN1cnJlbnRGcmFtZTogMCwgbWVzc2FnZTogbnVsbCwgbWF4V2FycDogMC4wNSB9OwogICAgZnVuY3Rpb24gaW5pdCgpIHsgdW5pcXVlU3RhdGUuY3VycmVudEZyYW1lID0gMDsgdW5pcXVlU3RhdGUubWVzc2FnZSA9IGdldFJhbmRvbU1lc3NhZ2UoKTsgfQogICAgCiAgICBmdW5jdGlvbiBhbmltYXRlKCkgewogICAgICAgIGNvbnN0IHQgPSB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgLyB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lczsKICAgICAgICBjb25zdCBlYXNlZFQgPSBlYXNlSW5PdXRRdWludCh0KTsgCiAgICAgICAgY29uc3QgeyB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXM7CiAgICAgICAgY29uc3QgY2VudGVyWCA9IHdpZHRoIC8gMjsKICAgICAgICBjb25zdCBjZW50ZXJZID0gaGVpZ2h0IC8gMjsKICAgICAgICAKICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAvLyBEZSBoYXJtb25pc2NoZSBnb2xmIChsYW5nemFhbSBwdWxzZXJlbmQpCiAgICAgICAgY29uc3Qgd2F2ZSA9IE1hdGguc2luKHQgKiBNYXRoLlBJKTsgLy8gTWF4IGFtcGxpdHVkZSBvcCB0PTAuNQogICAgICAgIGNvbnN0IHdhcnBBbW91bnQgPSB1bmlxdWVTdGF0ZS5tYXhXYXJwICogd2F2ZTsgCgogICAgICAgIC8vIDEuIE91ZGUgYWZiZWVsZGluZyAodmVydmFhZ3QgZW4gdmVydm9ybXQgemFjaHRqZXMpCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxIC0gZWFzZWRUOwogICAgICAgIGN0eC50cmFuc2xhdGUoY2VudGVyWCwgY2VudGVyWSk7CiAgICAgICAgY3R4LnNjYWxlKDEgKyB3YXJwQW1vdW50LCAxICsgd2FycEFtb3VudCk7IAogICAgICAgIGN0eC5kcmF3SW1hZ2UoY3VycmVudEltYWdlLCAtY2VudGVyWCwgLWNlbnRlclksIHdpZHRoLCBoZWlnaHQpOwogICAgICAgIGN0eC5yZXN0b3JlKCk7CgogICAgICAgIC8vIDIuIE5pZXV3ZSBhZmJlZWxkaW5nICh2ZXJzY2hpam50IGVuIHdvcmR0IGdsYWRnZXN0cmVrZW4pCiAgICAgICAgY3R4LnNhdmUoKTsKICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBlYXNlZFQ7CiAgICAgICAgY3R4LnRyYW5zbGF0ZShjZW50ZXJYLCBjZW50ZXJZKTsKICAgICAgICBjdHguc2NhbGUoMSAtIHdhcnBBbW91bnQsIDEgLSB3YXJwQW1vdW50KTsgLy8gVGVnZW5vdmVyZ2VzdGVsZGUgZ29sZiAoaGFybW9uaWUpCiAgICAgICAgY3R4LmRyYXdJbWFnZShuZXh0SW1hZ2UsIC1jZW50ZXJYLCAtY2VudGVyWSwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAKICAgICAgICAvLyAzLiBEZSBWYWdhbCBUb25lIEdsb2VkICh6ZWVyIHphY2h0ZSwga2FsbWVyZW5kZSBjeWFhbiBnbG9lZCkKICAgICAgICBjdHguc2F2ZSgpOwogICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHdhdmUgKiAwLjM7CiAgICAgICAgY3R4LmZpbGxTdHlsZSA9ICdyZ2JhKDE1MCwgMjAwLCAyNTUsIDAuNSknOyAvLyBLYWxtZXJlbmQgYmxhdXcKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgd2lkdGgsIGhlaWdodCk7CiAgICAgICAgY3R4LnJlc3RvcmUoKTsKICAgICAgICAKICAgICAgICBkcmF3SGVhbGluZ1RleHQodCwgdW5pcXVlU3RhdGUubWVzc2FnZSk7CgogICAgICAgIGlmICh1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUgPCB1bmlxdWVTdGF0ZS50b3RhbEZyYW1lcykgewogICAgICAgICAgICB1bmlxdWVTdGF0ZS5jdXJyZW50RnJhbWUrKzsKICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UobmV4dEltYWdlLCAwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgc3RhcnROZXh0VHJhbnNpdGlvbigpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiB7IGluaXQ6IGluaXQsIGFuaW1hdGU6IGFuaW1hdGUsIHVuaXF1ZVN0YXRlOiB1bmlxdWVTdGF0ZSB9Owp9KSgpOwoKCgogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lmcmFtZS1jb250YWluZXInKTsKICAgIAogICAgLy8gRGVmaW5lIHRoZSB0d28gZXh0cmVtZSBzdGF0ZXMgZm9yIHRoZSBhbmltYXRpb24KICAgIGNvbnN0IFNUQVRFX0EgPSAnc2NhbGUoMS4xKSB0cmFuc2xhdGUoMCUsIDAlKSc7IC8vIFpvb20gMTAlLCBzbGlnaHQgcGFuIGZyb20gdG9wLWxlZnQKICAgIGNvbnN0IFNUQVRFX0IgPSAnc2NhbGUoMS4xKSB0cmFuc2xhdGUoLTYlLCAtNiUpJzsgLy8gWm9vbSAxMCUsIHNsaWdodCBwYW4gdG8gYm90dG9tLXJpZ2h0CiAgICAKICAgIGxldCBjdXJyZW50U3RhdGUgPSAnQSc7CgogICAgLyoqCiAgICAgKiBUb2dnbGVzIHRoZSB0cmFuc2Zvcm0gc3RhdGUgb2YgdGhlIGNvbnRhaW5lci4KICAgICAqLwogICAgZnVuY3Rpb24gYW5pbWF0ZVpvb21BbmRQYW4oKSB7CiAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gJ0EnKSB7CiAgICAgICAgICAgIC8vIE1vdmUgdG8gU1RBVEVfQgogICAgICAgICAgICBjb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gU1RBVEVfQjsKICAgICAgICAgICAgY3VycmVudFN0YXRlID0gJ0InOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIE1vdmUgdG8gU1RBVEVfQQogICAgICAgICAgICBjb250YWluZXIuc3R5bGUudHJhbnNmb3JtID0gU1RBVEVfQTsKICAgICAgICAgICAgY3VycmVudFN0YXRlID0gJ0EnOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBUaGUgbW92ZW1lbnQgd2lsbCBhdXRvbWF0aWNhbGx5IGhhcHBlbiBzbW9vdGhseSBvdmVyIHRoZSAyMHMgZGVmaW5lZCBpbiB0aGUgQ1NTIHRyYW5zaXRpb24uCiAgICB9CgogICAgLy8gUnVuIHRoZSBhbmltYXRpb24gZnVuY3Rpb24gb25jZSBpbml0aWFsbHkKICAgIC8vYW5pbWF0ZVpvb21BbmRQYW4oKTsgCgogIC8vc2V0SW50ZXJ2YWwoYW5pbWF0ZVpvb21BbmRQYW4sIDIwMDAwKTsgCjwvc2NyaXB0PgoKCgo8L2Rpdj48L2Rpdj48L2JvZHk+PC9odG1sPg=="];



function vakmap(){
document.getElementById('bgiframes').src=constrest[Math.floor(Math.random()*constrest.length)];
setTimeout("vakmap()", 180000);
}
vakmap();

</script>


	<table style='border:0;left:0;width:100%;background-color:#444'><tr><td style='text-align:center;vertical-align:center;display: flex; justify-content: center; align-items: center'>

<div id="weerre" style="overflow:hidden;position:relative;background-color:rgba(30,30,30,.44);z-index:1;opacity:.0.88">
    <canvas id="eld" style='display:none'></canvas>

	
	<table style='width:100%'><tr><td style='width:95%;text-align: left; vertical-align: top;' >
	
    <div  style="overflow:hidden;">

      <div style='font-size:333%;color:transparent'>Ora Znffbhq Evqbhna</div>
      <div  style='font-size:300%'> <h2 style="font-size: 2rem; color: #fff; margin: 0;">Ai: God, God's Frei - I TakTak Twe</h2><br>&nbsp;  عبد السلام 
 &nbsp;<br> &nbsp; <span style='font-size:35%'>ⴰⴱⴷⵍⵙⴰⵍⴰⵎ</span>

 ♪  </div>
	 

    </div>
	</td>
	<td style='width:5%;text-align:right;vertical-align:top'>
	




	<div class="containerg" id="containerg">
        <div style='width:100%;text-align:right'><h3>Target Institution & Worker(s)</h3></div>

        <div class="controlsg">
        <input type="text" id="workerName" placeholder="Enter Worker Name/ID..."    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--border); background: rgba(0,0,0,0.5); color: white;">
            <button class="icon-btn" id="selectAllBtn" title="Selecteer Alles">✓</button>
            <button class="icon-btn" id="deselectAllBtn" title="Deselecteer Alles">✗</button>
            <button class="icon-btn reset" id="resetBtn" onclick="preview()" title="Reset naar Origineel">↺</button>
        </div>

        <div class="select-wrapper" id="selectWrapper">
            <button class="dropdown-toggle" id="dropdownToggle" aria-expanded="false" >
                <span class="toggle-text" id="toggleText">-- Select  Institution  Category.. --</span>
                <span class="arrow">▼</span>
            </button>
            
            <div class="genre-options" id="genreOptions">


            <label class="genre-option-item"><input type="checkbox" value="Mental Health"> Mental Health Instructions</label>
            <label class="genre-option-item"><input type="checkbox" value="Legal Court"> Legal / Court Administration</label>
            <label class="genre-option-item"><input type="checkbox" value="Financial"> Financial/Trust Management</label>
            <label class="genre-option-item"><input type="checkbox" value="Housing"> Housing Exploitation (No Roof)</label>
                </div>
        </div>

        <div class="counter"  id="exploitationCounter" style='background-color:transparent;color:white'>Active Signals: 
		
             <span id="selectedCount">0</span> Variaties Van  Alle <span id="totalCount">0</span> Genres
        </div>
		
		
    </div>
	

































</td>
</tr>
</table>
      <fieldset data-affect="love" style="background-color:transparent;border:none;z-index:88888888">
        <legend id='enil' style='text-align:center'><a id="aa" style='color:white'><span style='color:white;font-size:50%' id='enil2'> </span></a></legend>
 <br>
		<textarea id='log' style='color:white;width:66%;height:60px;background-color:transparent;border:none;'></textarea>
      </fieldset>




<div style="text-align:right;width:100%">
    <fieldset data-affect="energy" style="text-align:right;border:none;background-color:transparent;width:100%;">
<legend style="text-align:right; width:100%;"> <span style="font-size:90%; margin-right:10px; display:inline-block;">String - Systemic Accountability & Exploitation Signal </span> </legend>

        <div class="control-row" style="text-align:right;border:none;background-color:transparent;">
          <button id="initAudioBtn" style="display:none">Start / Resume Audio Engine</button>
          <span id="audioState" class="status-bar" style="font-size: 250%; border: medium; background-color: transparent; color: rgb(255, 255, 255);"> </span>
        </div>
      </fieldset>
</div>



      <fieldset data-affect="flow" style='border:none;width:98%;left:0vw;background-color:transparent;position: relative;'>
        <legend></legend>
     <div style='text-align:center'>
          <button id="playBtn"  style='background-color:transparent;border:none;'>▷</button>
          <button id="stopBtn"  style='background-color:transparent;border:none;' class="stop">▷</button>
          <button id="pauseBtn"  style='background-color:transparent;border:none;'>II</button>
          <div id="playbackStats" class="status-bar" style='display:none'>Waiting...</div>
          <div id="tempoDisplay" class="tempo-display" style='display:none'>Tempo: -- BPM</div>
   
		
        <div class="progress-container">
          <div id="progressBar" class="progress-bar"></div>
        </div>
		  	</div>
		
	
      </fieldset>
    </div>
	</td>
	</tr>
  </table>


<canvas id="bgCanvas" style="display: none;"></canvas>


<script>







const logElement = document.getElementById('log');
const workerInput = document.getElementById('workerName');




// Wait for DOM to be ready
document.addEventListener('DOMContentLoaded', function() {
  const weerreDiv = document.getElementById('weerre');
  const bgCanvas = document.getElementById('bgCanvas');
  const ctx = bgCanvas.getContext('2d');
  
  // Function to create the circle gradient background
  function createBackground() {
    // Get the dimensions of the #weerre div
    const width = weerreDiv.clientWidth;
    const height = weerreDiv.clientHeight;
    
    // Set canvas dimensions to match the div
    bgCanvas.width = width;
    bgCanvas.height = height;
    
    // Clear canvas
    ctx.clearRect(0, 0, width, height);
    
    // Fill with semi-transparent black background
    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
    ctx.fillRect(0, 0, width, height);
    
    // Calculate the maximum circle that fits
    const centerX = width / 2;
    const centerY = height / 2;
    const radius = Math.min(width, height) / 3;
    
    // Create a clipping path for the transparent circle
    ctx.save();
    
    // Create circle path
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
    
    // Use destination-out to make the circle transparent
    ctx.globalCompositeOperation = 'destination-out';
    ctx.fill();
    
    // Restore normal composite operation
    ctx.restore();

    // Convert canvas to data URL and set as background
	
	/*
	im=new Image();
	im.src='image/png;base64,';
	ctx.globalAlpha = 0.25
	ctx.drawImage(im, height/2,height/4,height/2, height/2);
	*/
	/*
	ctx.globalAlpha = 1;
	   ctx.font="40px sans-serif";ctx.fillStyle="rgba(250,250,250,.02)";ctx.textAlign="center";ctx.textBaseline="middle";ctx.fillText("ⵎⴰⴳⴰ ⵏⵉⵙⵏⵉⵏ ⵏⵙⴸⵉⴾ ", width/2, ((height/2)-100 +25));
	   
	   ctx.fillText(" ⵢⵉⵏ ⵓⵣⴰⵎⴰⴸⵉⵏ ⵜⴰⵎⵓⵓⵜⵂ ", width/2, ((height/2)-50+25) );
	 ctx.fillText("  ⵙⵒⵉⵜⴰ ⵏ ⵉⵔⴼⴰⵏ ", width/2, ((height/2)+25));
	 ctx.fillText(" ⵔⵉⴳⵔⴰ ⵡⴰⴳⴾⵉⵔ", width/2, ((height/2)+50+25));
    const dataURL = bgCanvas.toDataURL('image/png');
    weerreDiv.style.backgroundImage = `url(${dataURL})`;
    weerreDiv.style.backgroundSize = 'cover';
    weerreDiv.style.backgroundPosition = 'center';
    weerreDiv.style.backgroundRepeat = 'no-repeat';
	*/
	
  }
  
  // Create initial background
  createBackground();
  
  // Debounce function to prevent too many resize events
  let resizeTimeout;
  function debounceResize() {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(createBackground, 250);
  }
  
  // Add resize listener
  window.addEventListener('resize', debounceResize);
  
  // Also trigger when the div becomes visible if you toggle display
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'style') {
        const display = window.getComputedStyle(weerreDiv).display;
        if (display !== 'none') {
          // Give a small delay to ensure dimensions are calculated
          setTimeout(createBackground, 100);
        }
      }
    });
  });
  
  // Observe the #weerre div for style changes
  observer.observe(weerreDiv, { attributes: true });
});

var ifraMe7='';
var ifraMe='';
document.getElementById('xyz').src=ifraMe;
document.getElementById('xyz7').src=ifraMe7;
function formatTime(totalSeconds) {
  const minutes = Math.floor(totalSeconds / 60);
  const seconds = totalSeconds % 60;
  return `${minutes}:${seconds.toString().padStart(2, '0')}`;
}
/* ==========================================================================
   UTILITIES
   ========================================================================== */
const logEl = document.getElementById('log');
function log(msg) {
  logEl.value = logEl.value+`[${new Date().toLocaleTimeString()}] ${msg}\n` + logEl.textContent;
}

// Robust Base64 encoder for Worklet code
function toBase64(str) {
  const bytes = new TextEncoder().encode(str);
  let binary = '';
  for(let i=0; i<bytes.length; i++) binary += String.fromCharCode(bytes[i]);
  return btoa(binary);
}

/* ==========================================================================
   SF2 PARSER
   ========================================================================== */
class SF2Parser {
  constructor(buffer) {
    this.view = new DataView(buffer);
    this.pos = 0;
  }

  readStr(len) {
    let s = '';
    for(let i=0; i<len; i++) {
      const c = this.view.getUint8(this.pos + i);
      if(c !== 0) s += String.fromCharCode(c);
    }
    return s;
  }

  parse() {
    // Basic RIFF check
    if (this.readStr(4) !== 'RIFF') throw new Error("Not a RIFF file");
    this.pos += 4; // size
    this.pos += 4; // skip
    if (this.readStr(4) !== 'sfbk') throw new Error("Not a SoundFont file");
    this.pos += 4;

    // Find chunks
    let pdtaInfo = null, sdtaInfo = null;
    let p = 12;
    while(p < this.view.byteLength - 8) {
      const id = String.fromCharCode(
        this.view.getUint8(p), this.view.getUint8(p+1),
        this.view.getUint8(p+2), this.view.getUint8(p+3)
      );
      const size = this.view.getUint32(p+4, true);

      if(id === 'LIST') {
        const type = String.fromCharCode(
          this.view.getUint8(p+8), this.view.getUint8(p+9),
          this.view.getUint8(p+10), this.view.getUint8(p+11)
        );
        if(type === 'pdta') pdtaInfo = { offset: p+12, size: size-4 };
        if(type === 'sdta') sdtaInfo = { offset: p+12, size: size-4 };
      }
      p += 8 + size + (size % 2);
    }

    if(!pdtaInfo || !sdtaInfo) throw new Error("Corrupt SF2: missing pdta/sdta");

    // Load Samples (SDTA)
    const pcm = new Int16Array(this.view.buffer, sdtaInfo.offset + 8, (sdtaInfo.size-8)/2);

    // Load Headers (PDTA)
    const pdta = this.parsePdta(pdtaInfo.offset, pdtaInfo.size);

    return { pcm, pdta };
  }

  parsePdta(offset, size) {
    let p = offset, end = offset + size;
    const data = { phdr:[], pbag:[], pgen:[], inst:[], ibag:[], igen:[], shdr:[] };

    while(p < end) {
      const id = String.fromCharCode(
        this.view.getUint8(p), this.view.getUint8(p+1),
        this.view.getUint8(p+2), this.view.getUint8(p+3)
      );
      const chSize = this.view.getUint32(p+4, true);
      const base = p + 8;

      if(id === 'phdr') {
        for(let i=0; i<chSize; i+=38) {
          data.phdr.push({
            preset: this.view.getUint16(base+i+20, true),
            bank: this.view.getUint16(base+i+22, true),
            pbagIdx: this.view.getUint16(base+i+24, true)
          });
        }
      } else if(id === 'pbag') {
        for(let i=0; i<chSize; i+=4) data.pbag.push({ genIdx: this.view.getUint16(base+i, true) });
      } else if(id === 'pgen') {
        for(let i=0; i<chSize; i+=4) data.pgen.push({ op: this.view.getUint16(base+i, true), val: this.view.getInt16(base+i+2, true) });
      } else if(id === 'inst') {
        for(let i=0; i<chSize; i+=22) data.inst.push({ ibagIdx: this.view.getUint16(base+i+20, true) });
      } else if(id === 'ibag') {
        for(let i=0; i<chSize; i+=4) data.ibag.push({ genIdx: this.view.getUint16(base+i, true) });
      } else if(id === 'igen') {
        for(let i=0; i<chSize; i+=4) data.igen.push({ op: this.view.getUint16(base+i, true), val: this.view.getInt16(base+i+2, true) });
      } else if(id === 'shdr') {
        for(let i=0; i<chSize; i+=46) {
          data.shdr.push({
            start: this.view.getUint32(base+i+20, true),
            end: this.view.getUint32(base+i+24, true),
            startLoop: this.view.getUint32(base+i+28, true),
            endLoop: this.view.getUint32(base+i+32, true),
            rate: this.view.getUint32(base+i+36, true),
            pitch: this.view.getUint8(base+i+40),
            corr: this.view.getInt8(base+i+41),
            type: this.view.getUint16(base+i+44, true)
          });
        }
      }
      p += 8 + chSize + (chSize%2);
    }
    return data;
  }
}

function buildRegions(sf2) {
  const regions = [];
  const d = sf2.pdta;

  // Generators
  const G = { keyRange:43, velRange:44, inst:41, sample:53, root:58, coarse:51, fine:52, mode:54, att:34, dec:36, sus:37, rel:38 };
  const def = { att:-12000, dec:-12000, sus:0, rel:-12000 };

  // Helper to get gens from bag
  const getGens = (bag, genList, idx, nextIdx) => {
    const res = {};
    const start = bag[idx].genIdx;
    const end = (nextIdx !== undefined) ? bag[nextIdx].genIdx : genList.length;
    for(let i=start; i<end; i++) res[genList[i].op] = genList[i].val;
    return res;
  }

  // Iterate Presets
  for(let i=0; i<d.phdr.length-1; i++) { // Last is EOP
    const p = d.phdr[i];
    const pbagEnd = d.phdr[i+1].pbagIdx;

    // Global Preset Zone?
    let pGlobal = {};
    let pbIdx = p.pbagIdx;

    if(pbIdx < pbagEnd) {
      const g = getGens(d.pbag, d.pgen, pbIdx, pbIdx+1);
      if(g[G.inst] === undefined) { pGlobal = g; pbIdx++; }
    }

    for(; pbIdx < pbagEnd; pbIdx++) {
      const pLoc = getGens(d.pbag, d.pgen, pbIdx, pbIdx+1);
      const pComb = { ...pGlobal, ...pLoc };

      if(pComb[G.inst] === undefined) continue;
      const instIdx = pComb[G.inst];
      const inst = d.inst[instIdx];
      const ibagEnd = (d.inst[instIdx+1]) ? d.inst[instIdx+1].ibagIdx : d.ibag.length;

      // Global Inst Zone?
      let iGlobal = {};
      let ibIdx = inst.ibagIdx;
      if(ibIdx < ibagEnd) {
        const g = getGens(d.ibag, d.igen, ibIdx, ibIdx+1);
        if(g[G.sample] === undefined) { iGlobal = g; ibIdx++; }
      }

      for(; ibIdx < ibagEnd; ibIdx++) {
        const iLoc = getGens(d.ibag, d.igen, ibIdx, ibIdx+1);
        const all = { ...iGlobal, ...iLoc };

        if(all[G.sample] === undefined) continue;
        const sh = d.shdr[all[G.sample]];

        // Merge logic
        const getV = (k, df) => (all[k] !== undefined ? all[k] : (pComb[k] !== undefined ? pComb[k] : df));
        const range = (v) => v===undefined ? [0,127] : [v&0xFF, (v>>8)&0xFF];

        const pk = range(pComb[G.keyRange]), ik = range(all[G.keyRange]);
        const kMin = Math.max(pk[0], ik[0]), kMax = Math.min(pk[1], ik[1]);
        if(kMin > kMax) continue;

        const pv = range(pComb[G.velRange]), iv = range(all[G.velRange]);
        const vMin = Math.max(pv[0], iv[0]), vMax = Math.min(pv[1], iv[1]);
        if(vMin > vMax) continue;

        // Tune
        const root = (all[G.root] !== undefined) ? all[G.root] : sh.pitch;
        const tune = (all[G.coarse]||0) + (pComb[G.coarse]||0) + (all[G.fine]||0)/100 + (pComb[G.fine]||0)/100 + sh.corr/100;

        // Env
        const time = (c) => Math.pow(2, c/1200);
        const att = time(getV(G.att, def.att));
        const dec = time(getV(G.dec, def.dec));
        const rel = time(getV(G.rel, def.rel));
        const sus = Math.pow(10, -getV(G.sus, def.sus)/200);

        const loop = (getV(G.mode, sh.type&1) & 1) !== 0;

        regions.push({
          bank: p.bank, preset: p.preset,
          kMin, kMax, vMin, vMax,
          start: sh.start, end: sh.end,
          loopStart: sh.startLoop, loopEnd: sh.endLoop,
          loop, rate: sh.rate, root, tune,
          env: { a: att, d: dec, s: sus, r: rel }
        });
      }
    }
  }
  return regions;
}

/* ==========================================================================
   MIDI PARSER WITH CORRECT TIMING
   ========================================================================== */
class MidiParser {
  constructor(buffer) { 
    this.view = new DataView(buffer); 
    this.pos = 0; 
  }
  
  readInt(n) { 
    let x=0; 
    for(let i=0; i<n; i++) x=(x<<8)|this.view.getUint8(this.pos++); 
    return x; 
  }
  
  readVar() { 
    let x=0; 
    while(true) { 
      const b=this.view.getUint8(this.pos++); 
      x=(x<<7)|(b&0x7F); 
      if(!(b&0x80)) return x; 
    } 
  }

  parse() {
    if(this.readInt(4) !== 0x4D546864) throw new Error("Not MIDI");
    this.readInt(4); // len
    const fmt = this.readInt(2);
    const nTrk = this.readInt(2);
    const div = this.readInt(2);

    let allEvents = [];
    let tempo = 500000; // Default tempo (120 BPM)

    for(let i=0; i<nTrk; i++) {
      if(this.readInt(4) !== 0x4D54726B) continue; // Skip non-track
      const len = this.readInt(4);
      const end = this.pos + len;
      let ticks = 0;
      let status = 0;

      while(this.pos < end) {
        const delta = this.readVar();
        ticks += delta;
        let b = this.view.getUint8(this.pos);
        if(b & 0x80) { status = b; this.pos++; }

        const type = status >> 4;
        const ch = status & 0x0F;

        if(status === 0xFF) { // Meta
          const mType = this.view.getUint8(this.pos++);
          const mLen = this.readVar();
          if(mType === 0x51 && mLen === 3) {
            tempo = (this.view.getUint8(this.pos)<<16) | (this.view.getUint8(this.pos+1)<<8) | this.view.getUint8(this.pos+2);
            allEvents.push({ ticks, type:'tempo', val: tempo });
          }
          this.pos += mLen;
        } else if (status === 0xF0 || status === 0xF7) {
          const l = this.readVar(); this.pos += l;
        } else {
          const d1 = this.view.getUint8(this.pos++);
          if(type === 0x9 && d1 > 0) { // Note On
             const d2 = this.view.getUint8(this.pos++);
             if(d2 > 0) allEvents.push({ ticks, type:'on', ch, n:d1, v:d2 });
             else allEvents.push({ ticks, type:'off', ch, n:d1 });
          } else if(type === 0x8) { // Note Off
             const d2 = this.view.getUint8(this.pos++);
             allEvents.push({ ticks, type:'off', ch, n:d1 });
          } else if(type === 0xB) { // CC
             const d2 = this.view.getUint8(this.pos++);
             allEvents.push({ ticks, type:'cc', ch, cc:d1, val:d2 });
          } else if(type === 0xC) { // Prog
             allEvents.push({ ticks, type:'prg', ch, p:d1 });
          } else if(type === 0xE || type === 0xA || type === 0xD) {
             this.view.getUint8(this.pos++); // Skip d2
          }
        }
      }
    }

    // Sort events by tick
    allEvents.sort((a,b) => a.ticks - b.ticks);
    
    // Convert ticks to seconds with proper timing
    const finalEvents = [];
    let currentTempo = 500000; // Default tempo
    let currentTime = 0;
    let lastTick = 0;
    
    for(const event of allEvents) {
      // Calculate time for this event
      const deltaTicks = event.ticks - lastTick;
      
      // Convert ticks to seconds based on current tempo and division
      const secondsPerTick = currentTempo / (1000000.0 * div);
      const deltaTime = deltaTicks * secondsPerTick;
      
      currentTime += deltaTime;
      lastTick = event.ticks;
      
      // Update tempo if this is a tempo event
      if(event.type === 'tempo') {
        currentTempo = event.val;
      } else {
        finalEvents.push({
          ...event,
          time: currentTime
        });
      }
    }
    
    return {
      events: finalEvents,
      duration: currentTime,
      division: div,
      initialTempo: 500000
    };
  }
}



var entryo="Violation Entry ID-99";

/* ==========================================================================
   AUDIO WORKLET WITH CORRECT TIMING
   ========================================================================== */
const workletCode = `
class MidiWorklet extends AudioWorkletProcessor {
  constructor() {
    super();
    this.pcm = null;
    this.regions = [];
    this.presetMap = new Map();
    this.firstPresetKey = null;

    this.voices = [];
    this.channels = new Array(16).fill(0).map(() => ({ bank:0, prog:0 }));

    this.events = [];
    this.evtIdx = 0;
    this.currentTime = 0;
    this.playing = false;
    this.startTime = 0;
    this.pausedTime = 0;
    this.isPaused = false;
    this.progressFrameCount = 0;
    this.updateIntervalFrames = 128 * 15; 
    this.port.onmessage = (e) => {
      const d = e.data;
      if(d.type === 'SF2') {
        this.pcm = d.pcm;
        this.regions = d.regions;
        this.presetMap.clear();
        d.regions.forEach((r, i) => {
          const k = (r.bank<<7) | r.preset;
          if(!this.presetMap.has(k)) this.presetMap.set(k, []);
          this.presetMap.get(k).push(i);
          if(this.firstPresetKey === null) this.firstPresetKey = k;
        });
        this.port.postMessage({t:'log', msg:'Worklet: SF2 Loaded. Regions: ' + d.regions.length});
      }
      else if(d.type === 'MIDI') {
        this.events = d.events;
        this.evtIdx = 0;
        this.currentTime = 0;
        this.startTime = currentTime;
        this.pausedTime = 0;
        this.playing = true;
        this.isPaused = false;
        this.voices = [];
        this.port.postMessage({t:'log', msg:'Worklet: MIDI Playing...'});
        this.port.postMessage({t:'duration', duration: d.duration});
      }
      else if(d.type === 'STOP') {
        this.playing = false;
        this.isPaused = false;
        this.voices = [];
        this.port.postMessage({t:'progress', progress: 0});
      }
      else if(d.type === 'PAUSE') {
        this.isPaused = true;
        this.pausedTime = this.currentTime;
      }
      else if(d.type === 'RESUME') {
        this.isPaused = false;
        this.startTime = currentTime - this.pausedTime;
      }
    };
  }

  getRegions(ch, bank, prog) {
    // For percussion channel (9), use bank 128
    if(ch === 9) {
      // Try exact match first
      let key = (128 << 7) | prog;
      if(this.presetMap.has(key)) return this.presetMap.get(key);
      
      // Fallback to any percussion preset
      for(let [k, v] of this.presetMap) {
        if((k >> 7) === 128) return v;
      }
    } else {
      // 1. Exact Match
      let key = (bank << 7) | prog;
      if(this.presetMap.has(key)) return this.presetMap.get(key);

      // 2. Ignore Bank
      key = prog; // implied bank 0
      if(this.presetMap.has(key)) return this.presetMap.get(key);
    }

    // 3. Fallback to anything
    if(this.firstPresetKey !== null) return this.presetMap.get(this.firstPresetKey);

    return null;
  }

  process(inputs, outputs) {
    if(!this.pcm || !this.playing || this.isPaused) return true;
    
    const outL = outputs[0][0];
    const outR = outputs[0][1];
    const dt = 128 / sampleRate;

    // Update current time based on audio clock for accurate timing
    this.currentTime = currentTime - this.startTime;

    // --- Event Sequencing ---
    while(this.evtIdx < this.events.length) {
      const e = this.events[this.evtIdx];
      if(e.time > this.currentTime + dt) break;

      if(e.type === 'on') {
        const st = this.channels[e.ch];
        const bank = (e.ch === 9) ? 128 : st.bank;
        const indices = this.getRegions(e.ch, bank, st.prog);

        if(indices) {
          for(let i=0; i<indices.length; i++) {
            const r = this.regions[indices[i]];
            if(e.n >= r.kMin && e.n <= r.kMax && e.v >= r.vMin && e.v <= r.vMax) {
              // Pitch logic
              const fRatio = Math.pow(2, (e.n - r.root + r.tune)/12);
              const rate = fRatio * (r.rate / sampleRate);

              this.voices.push({
                idx: indices[i],
                pos: 0, rate: rate,
                ch: e.ch, note: e.n,
                vel: e.v/127,
                state: 0, // 0:Att, 1:Dec, 2:Sus, 3:Rel, 4:Done
                envT: 0, envV: 0, relVol: 0,
                // cache
                start: r.start, end: r.end,
                loop: r.loop, lStart: r.loopStart, lEnd: r.loopEnd,
                env: r.env
              });
            }
          }
        }
      }
      else if(e.type === 'off') {
        for(const v of this.voices) {
          if(v.ch === e.ch && v.note === e.n && v.state < 3) {
            v.state = 3; // Release
            v.relVol = v.envV;
            v.envT = 0;
          }
        }
      }
      else if(e.type === 'prg') { 
        this.channels[e.ch].prog = e.p; 
      }
      else if(e.type === 'cc' && e.cc === 0) { 
        this.channels[e.ch].bank = e.val; 
      }
      else if(e.type === 'tempo') {
        this.port.postMessage({t:'tempo', bpm: Math.round(60000000 / e.val)});
      }

      this.evtIdx++;
    }


this.progressFrameCount += 128; 

if (this.progressFrameCount >= this.updateIntervalFrames) {
    this.progressFrameCount = 0;
    
    if(this.events.length > 0) {
        const progress = this.currentTime / this.events[this.events.length-1].time;
        if (progress < 1) { 
            this.port.postMessage({t:'progress', progress: Math.min(1, progress)});
        }
    }
}

    // Stop when done
    if(this.evtIdx >= this.events.length && this.voices.length === 0) {
      this.playing = false;
      this.port.postMessage({t:'done'});
      this.port.postMessage({t:'progress', progress: 1});
    }

    // --- Audio Rendering ---
    for(let i=0; i<128; i++) {
      let L = 0;

      for(let vIdx=0; vIdx < this.voices.length; vIdx++) {
        const v = this.voices[vIdx];
        if(v.state === 4) continue;

        // Envelope
        v.envT += (1/sampleRate);
        const e = v.env;
        let amp = 0;

        if(v.state === 0) { // Attack
          amp = Math.min(1.0, v.envT / Math.max(0.001, e.a));
          if(amp >= 1) { amp=1; v.state=1; v.envT=0; }
        } else if(v.state === 1) { // Decay
          amp = 1.0 - (1.0 - e.s) * Math.min(1.0, v.envT / Math.max(0.001, e.d));
          if(v.envT >= e.d) { amp=e.s; v.state=2; }
        } else if(v.state === 2) { // Sustain
          amp = e.s;
        } else if(v.state === 3) { // Release
          amp = v.relVol * Math.max(0, 1.0 - v.envT / Math.max(0.001, e.r));
          if(v.envT >= e.r) { amp=0; v.state=4; }
        }
        v.envV = amp;

        // Sample
        const pInt = Math.floor(v.pos);
        let idx = v.start + pInt;

        if(v.loop) {
          if(idx >= v.lEnd) {
            v.pos = v.pos - (v.lEnd - v.lStart);
            idx = v.start + Math.floor(v.pos);
          }
        } else {
          if(idx >= v.end) { v.state=4; continue; }
        }

        if(idx < this.pcm.length) {
          const s = this.pcm[idx] / 32768;
          L += s * amp * v.vel;
        }

        v.pos += v.rate;
      }

      outL[i] = L * 0.25; // Master gain
      if(outR) outR[i] = L * 0.25;
    }

    // Cleanup
    for(let i=this.voices.length-1; i>=0; i--) {
      if(this.voices[i].state === 4) this.voices.splice(i, 1);
    }

    return true;
  }
}
registerProcessor('midi-proc', MidiWorklet);
`;

/* ==========================================================================
   APP CONTROLLER
   ========================================================================== */
    
var CURRENT_MIDI_FILE ="";
var MIDIF="";
let ctx = null;
let node = null;
let sf2Ready = false;
let midiData = null;
let isPlaying = false;
let isPaused = false;
var gewees=true;

// 1. Audio Init
document.getElementById('initAudioBtn').addEventListener('click', async () => {
  if(!ctx) ctx = new (window.AudioContext || window.webkitAudioContext)();

  if(ctx.state === 'suspended') await ctx.resume();

  // Load Worklet
  if(!node) {
    try {
      const url = `data:text/javascript;base64,${toBase64(workletCode)}`;
      await ctx.audioWorklet.addModule(url);
      node = new AudioWorkletNode(ctx, 'midi-proc');
      node.connect(ctx.destination);

      node.port.onmessage = (e) => {
        if(e.data.t === 'log') log(e.data.msg);
        if(e.data.t === 'done') {
          document.getElementById('playbackStats').textContent = "Finished";
          isPlaying = false;
          isPaused = false;
          document.getElementById('playBtn').disabled = false;
          document.getElementById('pauseBtn').disabled = true;
          document.getElementById('playBtn').textContent = "Play MIDI";
        }
        if(e.data.t === 'progress') {
		
		if(e.data.progress>.9995 && gewees==true){
		gewees=false;
		maakbase64midrandom();
		
		
		setTimeout(function(){loadInlineBase64Midi();
setTimeout(function(){		
		document.getElementById('playBtn').click();
		}, 200);
		gewees=true;

		
		}, 1000);
		
		}
          document.getElementById('progressBar').style.width = `${e.data.progress * 100}%`;
		  const otimel=Math.floor(currentCount*(1-e.data.progress));
		  document.getElementById('playBtn').textContent=formatTime(otimel);
		  document.getElementById('playBtn').style.fontStyle = "italic";
		  
        }
        if(e.data.t === 'tempo') {
          document.getElementById('tempoDisplay').textContent = `Tempo: ${e.data.bpm} BPM`;
        }
        if(e.data.t === 'duration') {
          log(`MIDI Duration: ${e.data.duration.toFixed(2)} seconds`);
		      log('Genre now: '+document.getElementById('enil2').innerHTML+ ' playing... ' );
        }
      };

      //document.getElementById('audioState').textContent = "Status: Running";
      document.getElementById('audioState').style.color = "rgba(255, 255, 255)"; 
      log("Audio Engine Started.");
      checkReady();
	  
	  await loadEmbeddedSF2();
    } catch(err) {
      log("Error loading Worklet: " + err);
    }
  }
  
  
  loadInlineBase64Midi();
  
});


document.getElementById('stopBtn').addEventListener('click', () => {
document.getElementById('audioState').innerText = "System Standing By...";
    document.getElementById('audioState').style.color = "white";
    logElement.value = `[SYSTEM] Record Archived for Legal Review.\n` + logElement.value;




  if(isPlaying && !isPaused) {
    node.port.postMessage({ type: 'PAUSE' });
	    node.port.postMessage({ type: 'STOP' });
				isPlaying=false;
		isPaused=true;
	}
  

		maakbase64midrandom();
		
		
		
		setTimeout(function(){loadInlineBase64Midi();
setTimeout(function(){		
		//
		
		document.getElementById('fl').click();
		}, 200);


		
		}, 1000);
  
/*
  if(node) node.port.postMessage({ type: 'STOP' });
  document.getElementById('playbackStats').textContent = "Stopped";
  document.getElementById('playBtn').textContent = "Play MIDI";
  document.getElementById('pauseBtn').disabled = true;
  document.getElementById('progressBar').style.width = "0%";
  document.getElementById('tempoDisplay').textContent = "Tempo: -- BPM";
  isPlaying = false;
  isPaused = false;
});
*/
});

function base64ToUint8Array(base64) {
  const binary_string = window.atob(base64);
  const len = binary_string.length;
  const bytes = new Uint8Array(len);
  for (let i = 0; i < len; i++) {
    bytes[i] = binary_string.charCodeAt(i);
  }
  return bytes.buffer;
}

async function loadEmbeddedSF2() {
  if(!node) {
    log("Please Start Audio Engine first!");
    return;
  }
  if(!SF2_BASE64_DATA || SF2_BASE64_DATA.length < 50) { // Check for placeholder data
    log("Error: SF2_BASE64_DATA is missing or invalid. Did you replace the placeholder?");
    return;
  }
  
  log("Decoding and Parsing Embedded SF2...");
  try {
    const buf = base64ToUint8Array(SF2_BASE64_DATA);
    const parser = new SF2Parser(buf);
    const data = parser.parse();
    const regions = buildRegions(data);

    // Transfer to Worklet
    node.port.postMessage({ type: 'SF2', pcm: data.pcm, regions });
    sf2Ready = true;
    log(`SF2 Loaded: ${regions.length} zones.`);
    checkReady();
  } catch(err) { 
    log("Embedded SF2 Error: " + err.message); 
  }
}

var currentCount=0;
async function loadInlineBase64Midi() {
  if(!CURRENT_MIDI_FILE || CURRENT_MIDI_FILE.length < 50) { // Check for placeholder data
    log("Error: CURRENT_MIDI_FILE is missing or invalid. Did you replace the placeholder?");
    return;
  }
  
  log("Decoding and Parsing Embedded MIDI...");
  try {
    const buf = base64ToUint8Array(CURRENT_MIDI_FILE);
    const parser = new MidiParser(buf);
    midiData = parser.parse();
    log(`MIDI Loaded: ${midiData.events.length} events. Duration: ${midiData.duration.toFixed(2)}s`);
	currentCount=parseInt(""+midiData.duration.toFixed(0));
    log(`MIDI Division: ${midiData.division} ticks per quarter note`);
    checkReady();
  } catch(err) { 
    log("Embedded MIDI Error: " + err.message); 
  }
}

var countStarted=0;
// 4. Play/Pause/Stop
function checkReady() {
  const playBtn = document.getElementById('playBtn');
  //playBtn.disabled = !(sf2Ready && midiData && node);
}
var optimizer;
document.getElementById('playBtn').addEventListener('click', () => {




  const worker = workerInput.value || "Unknown Worker";
    const selectedInst = Array.from(document.querySelectorAll('.genre-option-item input:checked'))
                              .map(cb => cb.value);
    
    if (selectedInst.length === 0) {
        alert("Please select at least one institution category to signal.");
        return;
    }

    // Trigger visual "Error" state from your CSS to signal pain/alert
 
    
    const timestamp = new Date().toLocaleTimeString();
     entryo = `[${timestamp}] SIGNAL: ${worker} exploited via ${selectedInst.join(', ')}. Outcome: Financial/Housing Deprivation detected.\n`;
    
    // Add to the log
    logElement.value = entryo + logElement.value;
    console.log(entryo + logElement.value);
    // Update visual metrics
    document.getElementById('audioState').innerText = "⚠️ EXPLOITATION DETECTED";
    document.getElementById('audioState').style.color = "#ff4b4b";




document.getElementById('enil2').style.display='';
countStarted++;
if(countStarted==1){
maakbase64midrandom();
setTimeout(function(){

// optimizer = new PerformanceOptimizer();
//optimizer.optimizeForPlayback();


//document.getElementById('initAudioBtn').click();

Init();


loadMidiUrl('data:audio/mid;base64,'+CURRENT_MIDI_FILE);
console.log('data:audio/mid;base64,'+CURRENT_MIDI_FILE);

setTimeout(function(){
//document.getElementById('playBtn').click();




}, 500);


}, 600);
}
else{
/*

  if(ctx.state === 'suspended' && false) ctx.resume();
  
  if(!isPlaying || isPaused) {
    // Start or resume playback
    node.port.postMessage({ 
      type: 'MIDI', 
      events: midiData.events,
      duration: midiData.duration
    });
    
    document.getElementById('playbackStats').textContent = "Playing...";
  
    document.getElementById('pauseBtn').disabled = false;
    isPlaying = true;
    isPaused = false;
    
    if(midiData.initialTempo) {
      const bpm = Math.round(60000000 / midiData.initialTempo);
      document.getElementById('tempoDisplay').textContent = `Tempo: ${bpm} BPM`;
    }
  }
  
  */
  }

});

document.getElementById('pauseBtn').addEventListener('click', () => {
  if(isPlaying && !isPaused) {
    node.port.postMessage({ type: 'PAUSE' });
    document.getElementById('playbackStats').textContent = "Paused";
    document.getElementById('playBtn').textContent = "Resume";
    isPaused = true;
  } else if(isPlaying && isPaused) {
    node.port.postMessage({ type: 'RESUME' });
    document.getElementById('playbackStats').textContent = "Playing...";
    document.getElementById('playBtn').textContent = "Playing";
    isPaused = false;
  }
});


//document.body.style.backgroundSize="100% 100%";
document.querySelectorAll("textarea").forEach(t => {
  const observer = new MutationObserver(() => {
    t.scrollTop = t.scrollHeight;
  });
  observer.observe(t, { childList: true, subtree: true });
});

function btse(){
document.getElementById("log").scrollTop = document.getElementById("log").scrollHeight 
setTimeout('btse()', 2500);

}





// Add cleanup function
function cleanupPlayer() {
  if (audioContext && audioContext.state !== 'closed') {
    audioContext.close();
  }
  if (analyser) {
    analyser.disconnect();
  }
  if (gainNode) {
    gainNode.disconnect();
  }
  // Clear all intervals/timeouts
  clearInterval(visualizationInterval);
  clearTimeout(playbackTimeout);
  // Remove event listeners
  window.removeEventListener('beforeunload', cleanupPlayer);
  window.removeEventListener('unload', cleanupPlayer);
}

// Initialize with cleanup
window.addEventListener('beforeunload', cleanupPlayer);
window.addEventListener('unload', cleanupPlayer);


btse();



</script>






<script>
var GENRESO=GENRES;
// ************************************************************************
        var genreslds = ""; 
        // ************************************************************************
        // Globale kopie van de originele GENRES array
        const originalGenres = JSON.parse(JSON.stringify(GENRES));
        // Houd de namen van de geselecteerde genres bij
        let selectedGenresg = new Set();

        // DOM elementen
        const selectWrapper = document.getElementById('selectWrapper');
        const dropdownToggle = document.getElementById('dropdownToggle');
        const toggleText = document.getElementById('toggleText');
        const genreOptionsContainer = document.getElementById('genreOptions');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const deselectAllBtn = document.getElementById('deselectAllBtn');
        const resetBtn = document.getElementById('resetBtn');

        // --- Core Logica ---

        /**
         * Genereert de HTML voor de genre-opties op basis van de GENRES array.
         */
        function renderGenreOptions() {
            genreOptionsContainer.innerHTML = originalGenres.map(genre => `
                <label class="genre-option-item">
                    <input type="checkbox" data-genre-name="${genre.name}" ${selectedGenresg.has(genre.name) ? 'checked' : ''}>
                    ${genre.name}
                </label>
            `).join('');

            // Voeg de event listener toe aan de container, niet aan elke checkbox
            genreOptionsContainer.addEventListener('change', handleCheckboxChange);
        }

        /**
         * Houdt de genreslds variabele up-to-date met een pipe-gescheiden string
         * van geselecteerde genre namen (zonder dubbele).
         */
		 
		 
		 

		 
        function updateGenreslds() {
            // De Set selectedGenresg bevat al unieke namen.
            // Array.from() maakt er een array van, en join('|') maakt de string.
            genreslds = Array.from(selectedGenresg).join('|');
            console.log('genreslds:', genreslds); // Voor debugging
			eeee=genreslds.split('|');
			bv=new Array();
			for(c=0;c<eeee.length;c++){
				ide=0;
				for(u=0;u<GENRESO.length;u++){
					if(GENRESO[u].name==eeee[c]){
					ide=u;
					}
				}			
			bv[c]=GENRESO[ide];
			}
			GENRES=bv;
        }

        /**
         * Update de weergave (tellingen, toggle-tekst) en de globale genre-variabelen.
         */
        function updateDisplay() {
            // Update de tellingen
            const selectedCount = selectedGenresg.size;
            document.getElementById('selectedCount').textContent = selectedCount;
            document.getElementById('totalCount').textContent = originalGenres.length;

            // Update de toggle tekst
            let text = '-- Selecteer genres --';
            if (selectedCount > 0) {
                const selectedArray = Array.from(selectedGenresg);
                const firstThree = selectedArray.slice(0, 3).join(', ');
                text = firstThree;
                if (selectedCount > 3) {
                    const remaining = selectedCount - 3;
                    text += ` en nog ${remaining} ${remaining === 1 ? 'andere' : 'andere'}`;
                }
            }
            toggleText.textContent = text;

            // ** GEWIJZIGD: Update de genreslds variabele **
            updateGenreslds(); 

            // Houd de globale array met geselecteerde objecten up-to-date
            updateCurrentGenresArray();
			
			
			
        }

        /**
         * Houdt de geselecteerde genres array up-to-date.
         */
        function updateCurrentGenresArray() {
            window.currentFilteredGenres = originalGenres.filter(genre => selectedGenresg.has(genre.name));
            console.log('Gefilterde genres:', window.currentFilteredGenres.length, 'items');
        }

        /**
         * Selecteert of deselecteert een genre.
         * @param {string} genreName
         * @param {boolean} shouldSelect
         */
        function toggleGenreSelection(genreName, shouldSelect) {
            const checkbox = genreOptionsContainer.querySelector(`input[data-genre-name="${genreName}"]`);
            if (checkbox) {
                checkbox.checked = shouldSelect;
            }
            if (shouldSelect) {
                selectedGenresg.add(genreName);
            } else {
                selectedGenresg.delete(genreName);
            }
        }

        // --- Event Handlers ---

        function handleCheckboxChange(event) {
            const checkbox = event.target;
            const genreName = checkbox.dataset.genreName;
            
            // selectedGenresg wordt al bijgewerkt in toggleGenreSelection, maar hier
            // kunnen we het direct doen en de UI-update afhandelen.
            if (checkbox.checked) {
                selectedGenresg.add(genreName);
            } else {
                selectedGenresg.delete(genreName);
            }

            // Aangeroepen na een verandering in de Set
            updateDisplay();
        }

        function toggleDropdown() {
            const isOpen = selectWrapper.classList.toggle('open');
			var isOpen_=1;
			if(isOpen){
			isOpen_=2;
			}
			document.getElementById('containerg').style.height=(isOpen_*100)+"%"
            dropdownToggle.setAttribute('aria-expanded', isOpen);
        }

        function selectAll() {
            // Update de Set direct
            originalGenres.forEach(genre => selectedGenresg.add(genre.name));

            // Vink alle checkboxes aan (nodig voor visuele feedback)
            genreOptionsContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;
            });

            updateDisplay();
        }

        function deselectAll() {
            // Maak de Set leeg
            selectedGenresg.clear();

            // Vink alle checkboxes uit
            genreOptionsContainer.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });

            updateDisplay();
        }

        function resetToOriginal() {
            // Eerst alles deselecteren (Set leegmaken en checkboxes uitvinken)
            deselectAll(); 
            // Hierna moet u logica toevoegen om uw 'originele' selectie te herstellen
            // Als de 'originele' toestand is dat alles geselecteerd is (zoals in uw initializer), dan:
            selectAll(); 
            
            // Als u een specifieke set wilt herstellen, moet die set hier opnieuw worden toegevoegd.
            // Voor nu houden we de huidige logica aan (die in de initializer alles selecteert).
            updateDisplay();
        }


        // --- Initialisatie & Event Listeners ---

        function initializer() {
            // Voeg alle genres initieel toe aan de Set (alles geselecteerd)
            originalGenres.forEach(genre => selectedGenresg.add(genre.name));
            
            // Maak de checkbox-opties
            renderGenreOptions();
            
            // Update de tellingen en de globale array (en nu ook genreslds)
            updateDisplay();

            // Event listeners voor icon knoppen
            selectAllBtn.addEventListener('click', selectAll);
            deselectAllBtn.addEventListener('click', deselectAll);
            resetBtn.addEventListener('click', resetToOriginal);
            
            // Event listener voor de toggle knop
            dropdownToggle.addEventListener('click', toggleDropdown);

            // Close dropdown when clicking outside
            document.addEventListener('click', (event) => {
                if (!selectWrapper.contains(event.target) && selectWrapper.classList.contains('open')) {
                    selectWrapper.classList.remove('open');
						document.getElementById('containerg').style.height=100+"%"
                    dropdownToggle.setAttribute('aria-expanded', false);
                }
            });
            
            // Hulp functies voor debugging
            window.getSelectedGenres = () => Array.from(selectedGenresg);

			document.getElementById('weerre').style.backgroundColor='rgb(22,27,32)';
				fixAchter("Chinese Traditional", document.getElementById('weerre'),500,500);
        }

var rrr=new Image();

rrr.src="data:image/jpeg;base64,";
        // Initialiseer bij het laden van de pagina
        document.addEventListener('DOMContentLoaded', initializer);



function updateLeakMetric() {

    // Simulate visual leak: Higher the bar, more resources the "Institution" is keeping
    let leakValue = Math.floor(Math.random() * 40) + 60; // Usually high exploitation
  
    
    const voiceConsole = document.getElementById('voice');
    voiceConsole.innerHTML = `
        <div class="line">Institutional Resource Retention: ${leakValue}%</div>
        <div class="metrics">STATUS: RESOURCE DEPRIVATION (No Roof Risk)</div>
    `;
}
		
		
</script>

<div onclick='flo()' id='fl' style='display:none'>
<script>
( function(window){
"use strict";

function WebAudioTinySynthCore(target) {
  Object.assign(target,{
    properties:{
      masterVol:  {type:Number, value:0.5, observer:"setMasterVol"},
      reverbLev:  {type:Number, value:0.3, observer:"setReverbLev"},
      quality:    {type:Number, value:1, observer:"setQuality"},
      debug:      {type:Number, value:0},
      src:        {type:String, value:null, observer:"loadMIDIfromSrc"},
      loop:       {type:Number, value:0},
      internalcontext: {type:Number, value:1},
      tsmode:     {type:Number, value:0},
      voices:     {type:Number, value:64},
      useReverb:  {type:Number, value:1},
      /*@@gui*/
      width:      {type:String, value:"300px", observer:"layout"},
      height:     {type:String, value:"32px", observer:"layout"},
      graph:      {type:Number, value:1},
      disabledrop:{type:Number, value:0},
      perfmon:    {type:Number, value:0},
      /*@@guiEND*/
    },
    /*@@gui*/
    layout:(()=>{
      this.canvas.style.width=this.width;
      this.canvas.style.height=this.height;
    }),
    /*@@guiEND*/
    program:[
// 1-8 : Piano
      {name:"Acoustic Grand Piano"},    {name:"Bright Acoustic Piano"},
      {name:"Electric Grand Piano"},    {name:"Honky-tonk Piano"},
      {name:"Electric Piano 1"},        {name:"Electric Piano 2"},
      {name:"Harpsichord"},             {name:"Clavi"},
/* 9-16 : Chromatic Perc*/
      {name:"Celesta"},                 {name:"Glockenspiel"},
      {name:"Music Box"},               {name:"Vibraphone"},
      {name:"Marimba"},                 {name:"Xylophone"},
      {name:"Tubular Bells"},           {name:"Dulcimer"},
/* 17-24 : Organ */
      {name:"Drawbar Organ"},           {name:"Percussive Organ"},
      {name:"Rock Organ"},              {name:"Church Organ"},
      {name:"Reed Organ"},              {name:"Accordion"},
      {name:"Harmonica"},               {name:"Tango Accordion"},
/* 25-32 : Guitar */
      {name:"Acoustic Guitar (nylon)"}, {name:"Acoustic Guitar (steel)"},
      {name:"Electric Guitar (jazz)"},  {name:"Electric Guitar (clean)"},
      {name:"Electric Guitar (muted)"}, {name:"Overdriven Guitar"},
      {name:"Distortion Guitar"},       {name:"Guitar harmonics"},
/* 33-40 : Bass */
      {name:"Acoustic Bass"},           {name:"Electric Bass (finger)"},
      {name:"Electric Bass (pick)"},    {name:"Fretless Bass"},
      {name:"Slap Bass 1"},             {name:"Slap Bass 2"},
      {name:"Synth Bass 1"},            {name:"Synth Bass 2"},
/* 41-48 : Strings */
      {name:"Violin"},                  {name:"Viola"},
      {name:"Cello"},                   {name:"Contrabass"},
      {name:"Tremolo Strings"},         {name:"Pizzicato Strings"},
      {name:"Orchestral Harp"},         {name:"Timpani"},
/* 49-56 : Ensamble */
      {name:"String Ensemble 1"},       {name:"String Ensemble 2"},
      {name:"SynthStrings 1"},          {name:"SynthStrings 2"},
      {name:"Choir Aahs"},              {name:"Voice Oohs"},
      {name:"Synth Voice"},             {name:"Orchestra Hit"},
/* 57-64 : Brass */
      {name:"Trumpet"},                 {name:"Trombone"},
      {name:"Tuba"},                    {name:"Muted Trumpet"},
      {name:"French Horn"},             {name:"Brass Section"},
      {name:"SynthBrass 1"},            {name:"SynthBrass 2"},
/* 65-72 : Reed */
      {name:"Soprano Sax"},             {name:"Alto Sax"},
      {name:"Tenor Sax"},               {name:"Baritone Sax"},
      {name:"Oboe"},                    {name:"English Horn"},
      {name:"Bassoon"},                 {name:"Clarinet"},
/* 73-80 : Pipe */
      {name:"Piccolo"},                 {name:"Flute"},
      {name:"Recorder"},                {name:"Pan Flute"},
      {name:"Blown Bottle"},            {name:"Shakuhachi"},
      {name:"Whistle"},                 {name:"Ocarina"},
/* 81-88 : SynthLead */
      {name:"Lead 1 (square)"},         {name:"Lead 2 (sawtooth)"},
      {name:"Lead 3 (calliope)"},       {name:"Lead 4 (chiff)"},
      {name:"Lead 5 (charang)"},        {name:"Lead 6 (voice)"},
      {name:"Lead 7 (fifths)"},         {name:"Lead 8 (bass + lead)"},
/* 89-96 : SynthPad */
      {name:"Pad 1 (new age)"},         {name:"Pad 2 (warm)"},
      {name:"Pad 3 (polysynth)"},       {name:"Pad 4 (choir)"},
      {name:"Pad 5 (bowed)"},           {name:"Pad 6 (metallic)"},
      {name:"Pad 7 (halo)"},            {name:"Pad 8 (sweep)"},
/* 97-104 : FX */
      {name:"FX 1 (rain)"},             {name:"FX 2 (soundtrack)"},
      {name:"FX 3 (crystal)"},          {name:"FX 4 (atmosphere)"},
      {name:"FX 5 (brightness)"},       {name:"FX 6 (goblins)"},
      {name:"FX 7 (echoes)"},           {name:"FX 8 (sci-fi)"},
/* 105-112 : Ethnic */
      {name:"Sitar"},                   {name:"Banjo"},
      {name:"Shamisen"},                {name:"Koto"},
      {name:"Kalimba"},                 {name:"Bag pipe"},
      {name:"Fiddle"},                  {name:"Shanai"},
/* 113-120 : Percussive */
      {name:"Tinkle Bell"},             {name:"Agogo"},
      {name:"Steel Drums"},             {name:"Woodblock"},
      {name:"Taiko Drum"},              {name:"Melodic Tom"},
      {name:"Synth Drum"},              {name:"Reverse Cymbal"},
/* 121-128 : SE */
      {name:"Guitar Fret Noise"},       {name:"Breath Noise"},
      {name:"Seashore"},                {name:"Bird Tweet"},
      {name:"Telephone Ring"},          {name:"Helicopter"},
      {name:"Applause"},                {name:"Gunshot"},
    ],
    drummap:[
// 35
      {name:"Acoustic Bass Drum"},  {name:"Bass Drum 1"},      {name:"Side Stick"},     {name:"Acoustic Snare"},
      {name:"Hand Clap"},           {name:"Electric Snare"},   {name:"Low Floor Tom"},  {name:"Closed Hi Hat"},
      {name:"High Floor Tom"},      {name:"Pedal Hi-Hat"},     {name:"Low Tom"},        {name:"Open Hi-Hat"},
      {name:"Low-Mid Tom"},         {name:"Hi-Mid Tom"},       {name:"Crash Cymbal 1"}, {name:"High Tom"},
      {name:"Ride Cymbal 1"},       {name:"Chinese Cymbal"},   {name:"Ride Bell"},      {name:"Tambourine"},
      {name:"Splash Cymbal"},       {name:"Cowbell"},          {name:"Crash Cymbal 2"}, {name:"Vibraslap"},
      {name:"Ride Cymbal 2"},       {name:"Hi Bongo"},         {name:"Low Bongo"},      {name:"Mute Hi Conga"},
      {name:"Open Hi Conga"},       {name:"Low Conga"},        {name:"High Timbale"},   {name:"Low Timbale"},
      {name:"High Agogo"},          {name:"Low Agogo"},        {name:"Cabasa"},         {name:"Maracas"},
      {name:"Short Whistle"},       {name:"Long Whistle"},     {name:"Short Guiro"},    {name:"Long Guiro"},
      {name:"Claves"},              {name:"Hi Wood Block"},    {name:"Low Wood Block"}, {name:"Mute Cuica"},
      {name:"Open Cuica"},          {name:"Mute Triangle"},    {name:"Open Triangle"},
    ],
    program1:[
      // 1-8 : Piano
      [{w:"sine",v:.4,d:0.7,r:0.1,},{w:"triangle",v:3,d:0.7,s:0.1,g:1,a:0.01,k:-1.2}],
      [{w:"triangle",v:0.4,d:0.7,r:0.1,},{w:"triangle",v:4,t:3,d:0.4,s:0.1,g:1,k:-1,a:0.01,}],
      [{w:"sine",d:0.7,r:0.1,},{w:"triangle",v:4,f:2,d:0.5,s:0.5,g:1,k:-1}],
      [{w:"sine",d:0.7,v:0.2,},{w:"triangle",v:4,t:3,f:2,d:0.3,g:1,k:-1,a:0.01,s:0.5,}],
      [{w:"sine",v:0.35,d:0.7,},{w:"sine",v:3,t:7,f:1,d:1,s:1,g:1,k:-.7}],
      [{w:"sine",v:0.35,d:0.7,},{w:"sine",v:8,t:7,f:1,d:0.5,s:1,g:1,k:-.7}],
      [{w:"sawtooth",v:0.34,d:2,},{w:"sine",v:8,f:0.1,d:2,s:1,r:2,g:1,}],
      [{w:"triangle",v:0.34,d:1.5,},{w:"square",v:6,f:0.1,d:1.5,s:0.5,r:2,g:1,}],
      /* 9-16 : Chromatic Perc*/
      [{w:"sine",d:0.3,r:0.3,},{w:"sine",v:7,t:11,d:0.03,g:1,}],
      [{w:"sine",d:0.3,r:0.3,},{w:"sine",v:11,t:6,d:0.2,s:0.4,g:1,}],
      [{w:"sine",v:0.2,d:0.3,r:0.3,},{w:"sine",v:11,t:5,d:0.1,s:0.4,g:1,}],
      [{w:"sine",v:0.2,d:0.6,r:0.6,},{w:"triangle",v:11,t:5,f:1,s:0.5,g:1,}],
      [{w:"sine",v:0.3,d:0.2,r:0.2,},{w:"sine",v:6,t:5,d:0.02,g:1,}],
      [{w:"sine",v:0.3,d:0.2,r:0.2,},{w:"sine",v:7,t:11,d:0.03,g:1,}],
      [{w:"sine",v:0.2,d:1,r:1,},{w:"sine",v:11,t:3.5,d:1,r:1,g:1,}],
      [{w:"triangle",v:0.2,d:0.5,r:0.2,},{w:"sine",v:6,t:2.5,d:0.2,s:0.1,r:0.2,g:1,}],
      /* 17-24 : Organ */
      [{w:"w9999",v:0.22,s:0.9,},{w:"w9999",v:0.22,t:2,f:2,s:0.9,}],
      [{w:"w9999",v:0.2,s:1,},{w:"sine",v:11,t:6,f:2,s:0.1,g:1,h:0.006,r:0.002,d:0.002,},{w:"w9999",v:0.2,t:2,f:1,h:0,s:1,}],
      [{w:"w9999",v:0.2,d:0.1,s:0.9,},{w:"w9999",v:0.25,t:4,f:2,s:0.5,}],
      [{w:"w9999",v:0.3,a:0.04,s:0.9,},{w:"w9999",v:0.2,t:8,f:2,a:0.04,s:0.9,}],
      [{w:"sine",v:0.2,a:0.02,d:0.05,s:1,},{w:"sine",v:6,t:3,f:1,a:0.02,d:0.05,s:1,g:1,}],
      [{w:"triangle",v:0.2,a:0.02,d:0.05,s:0.8,},{w:"square",v:7,t:3,f:1,d:0.05,s:1.5,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:0.2,s:0.5,},{w:"square",v:1,d:0.03,s:2,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:0.1,s:0.8,},{w:"square",v:1,a:0.3,d:0.1,s:2,g:1,}],
      /* 25-32 : Guitar */
      [{w:"sine",v:0.3,d:0.5,f:1,},{w:"triangle",v:5,t:3,f:-1,d:1,s:0.1,g:1,}],
      [{w:"sine",v:0.4,d:0.6,f:1,},{w:"triangle",v:12,t:3,d:0.6,s:0.1,g:1,f:-1,}],
      [{w:"triangle",v:0.3,d:1,f:1,},{w:"triangle",v:6,f:-1,d:0.4,s:0.5,g:1,t:3,}],
      [{w:"sine",v:0.3,d:1,f:-1,},{w:"triangle",v:11,f:1,d:0.4,s:0.5,g:1,t:3,}],
      [{w:"sine",v:0.4,d:0.1,r:0.01},{w:"sine",v:7,g:1,}],
      [{w:"triangle",v:0.4,d:1,f:1,},{w:"square",v:4,f:-1,d:1,s:0.7,g:1,}],//[{w:"triangle",v:0.35,d:1,f:1,},{w:"square",v:7,f:-1,d:0.3,s:0.5,g:1,}],
      [{w:"triangle",v:0.35,d:1,f:1,},{w:"square",v:7,f:-1,d:0.3,s:0.5,g:1,}],//[{w:"triangle",v:0.4,d:1,f:1,},{w:"square",v:4,f:-1,d:1,s:0.7,g:1,}],//[{w:"triangle",v:0.4,d:1,},{w:"square",v:4,f:2,d:1,s:0.7,g:1,}],
      [{w:"sine",v:0.2,t:1.5,a:0.005,h:0.2,d:0.6,},{w:"sine",v:11,t:5,f:2,d:1,s:0.5,g:1,}],
      /* 33-40 : Bass */
      [{w:"sine",d:0.3,},{w:"sine",v:4,t:3,d:1,s:1,g:1,}],
      [{w:"sine",d:0.3,},{w:"sine",v:4,t:3,d:1,s:1,g:1,}],
      [{w:"w9999",d:0.3,v:0.7,s:0.5,},{w:"sawtooth",v:1.2,d:0.02,s:0.5,g:1,h:0,r:0.02,}],
      [{w:"sine",d:0.3,},{w:"sine",v:4,t:3,d:1,s:1,g:1,}],
      [{w:"triangle",v:0.3,t:2,d:1,},{w:"triangle",v:15,t:2.5,d:0.04,s:0.1,g:1,}],
      [{w:"triangle",v:0.3,t:2,d:1,},{w:"triangle",v:15,t:2.5,d:0.04,s:0.1,g:1,}],
      [{w:"triangle",d:0.7,},{w:"square",v:0.4,t:0.5,f:1,d:0.2,s:10,g:1,}],
      [{w:"triangle",d:0.7,},{w:"square",v:0.4,t:0.5,f:1,d:0.2,s:10,g:1,}],
      /* 41-48 : Strings */
      [{w:"sawtooth",v:0.4,a:0.1,d:11,},{w:"sine",v:5,d:11,s:0.2,g:1,}],
      [{w:"sawtooth",v:0.4,a:0.1,d:11,},{w:"sine",v:5,d:11,s:0.2,g:1,}],
      [{w:"sawtooth",v:0.4,a:0.1,d:11,},{w:"sine",v:5,t:0.5,d:11,s:0.2,g:1,}],
      [{w:"sawtooth",v:0.4,a:0.1,d:11,},{w:"sine",v:5,t:0.5,d:11,s:0.2,g:1,}],
      [{w:"sine",v:0.4,a:0.1,d:11,},{w:"sine",v:6,f:2.5,d:0.05,s:1.1,g:1,}],
      [{w:"sine",v:0.3,d:0.1,r:0.1,},{w:"square",v:4,t:3,d:1,s:0.2,g:1,}],
      [{w:"sine",v:0.3,d:0.5,r:0.5,},{w:"sine",v:7,t:2,f:2,d:1,r:1,g:1,}],
      [{w:"triangle",v:0.6,h:0.03,d:0.3,r:0.3,t:0.5,},{w:"n0",v:8,t:1.5,d:0.08,r:0.08,g:1,}],
      /* 49-56 : Ensamble */
      [{w:"sawtooth",v:0.3,a:0.03,s:0.5,},{w:"sawtooth",v:0.2,t:2,f:2,d:1,s:2,}],
      [{w:"sawtooth",v:0.3,f:-2,a:0.03,s:0.5,},{w:"sawtooth",v:0.2,t:2,f:2,d:1,s:2,}],
      [{w:"sawtooth",v:0.2,a:0.02,s:1,},{w:"sawtooth",v:0.2,t:2,f:2,a:1,d:1,s:1,}],
      [{w:"sawtooth",v:0.2,a:0.02,s:1,},{w:"sawtooth",v:0.2,f:2,a:0.02,d:1,s:1,}],
      [{w:"triangle",v:0.3,a:0.03,s:1,},{w:"sine",v:3,t:5,f:1,d:1,s:1,g:1,}],
      [{w:"sine",v:0.4,a:0.03,s:0.9,},{w:"sine",v:1,t:2,f:3,d:0.03,s:0.2,g:1,}],
      [{w:"triangle",v:0.6,a:0.05,s:0.5,},{w:"sine",v:1,f:0.8,d:0.2,s:0.2,g:1,}],
      [{w:"square",v:0.15,a:0.01,d:0.2,r:0.2,t:0.5,h:0.03,},{w:"square",v:4,f:0.5,d:0.2,r:11,a:0.01,g:1,h:0.02,},{w:"square",v:0.15,t:4,f:1,a:0.02,d:0.15,r:0.15,h:0.03,},{g:3,w:"square",v:4,f:-0.5,a:0.01,h:0.02,d:0.15,r:11,}],
      /* 57-64 : Brass */
      [{w:"square",v:0.2,a:0.01,d:1,s:0.6,r:0.04,},{w:"sine",v:1,d:0.1,s:4,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:1,s:0.5,r:0.08,},{w:"sine",v:1,d:0.1,s:4,g:1,}],
      [{w:"square",v:0.2,a:0.04,d:1,s:0.4,r:0.08,},{w:"sine",v:1,d:0.1,s:4,g:1,}],
      [{w:"square",v:0.15,a:0.04,s:1,},{w:"sine",v:2,d:0.1,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:1,s:0.5,r:0.08,},{w:"sine",v:1,d:0.1,s:4,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:1,s:0.6,r:0.08,},{w:"sine",v:1,f:0.2,d:0.1,s:4,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:0.5,s:0.7,r:0.08,},{w:"sine",v:1,d:0.1,s:4,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:1,s:0.5,r:0.08,},{w:"sine",v:1,d:0.1,s:4,g:1,}],
      /* 65-72 : Reed */
      [{w:"square",v:0.2,a:0.02,d:2,s:0.6,},{w:"sine",v:2,d:1,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:2,s:0.6,},{w:"sine",v:2,d:1,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:1,s:0.6,},{w:"sine",v:2,d:1,g:1,}],
      [{w:"square",v:0.2,a:0.02,d:1,s:0.6,},{w:"sine",v:2,d:1,g:1,}],
      [{w:"sine",v:0.4,a:0.02,d:0.7,s:0.5,},{w:"square",v:5,t:2,d:0.2,s:0.5,g:1,}],
      [{w:"sine",v:0.3,a:0.05,d:0.2,s:0.8,},{w:"sawtooth",v:6,f:0.1,d:0.1,s:0.3,g:1,}],
      [{w:"sine",v:0.3,a:0.03,d:0.2,s:0.4,},{w:"square",v:7,f:0.2,d:1,s:0.1,g:1,}],
      [{w:"square",v:0.2,a:0.05,d:0.1,s:0.8,},{w:"square",v:4,d:0.1,s:1.1,g:1,}],
      /* 73-80 : Pipe */
      [{w:"sine",a:0.02,d:2,},{w:"sine",v:6,t:2,d:0.04,g:1,}],
      [{w:"sine",v:0.7,a:0.03,d:0.4,s:0.4,},{w:"sine",v:4,t:2,f:0.2,d:0.4,g:1,}],
      [{w:"sine",v:0.7,a:0.02,d:0.4,s:0.6,},{w:"sine",v:3,t:2,d:0,s:1,g:1,}],
      [{w:"sine",v:0.4,a:0.06,d:0.3,s:0.3,},{w:"sine",v:7,t:2,d:0.2,s:0.2,g:1,}],
      [{w:"sine",a:0.02,d:0.3,s:0.3,},{w:"sawtooth",v:3,t:2,d:0.3,g:1,}],
      [{w:"sine",v:0.4,a:0.02,d:2,s:0.1,},{w:"sawtooth",v:8,t:2,f:1,d:0.5,g:1,}],
      [{w:"sine",v:0.7,a:0.03,d:0.5,s:0.3,},{w:"sine",v:0.003,t:0,f:4,d:0.1,s:0.002,g:1,}],
      [{w:"sine",v:0.7,a:0.02,d:2,},{w:"sine",v:1,t:2,f:1,d:0.02,g:1,}],
      /* 81-88 : SynthLead */
      [{w:"square",v:0.3,d:1,s:0.5,},{w:"square",v:1,f:0.2,d:1,s:0.5,g:1,}],
      [{w:"sawtooth",v:0.3,d:2,s:0.5,},{w:"square",v:2,f:0.1,s:0.5,g:1,}],
      [{w:"triangle",v:0.5,a:0.05,d:2,s:0.6,},{w:"sine",v:4,t:2,g:1,}],
      [{w:"triangle",v:0.3,a:0.01,d:2,s:0.3,},{w:"sine",v:22,t:2,f:1,d:0.03,s:0.2,g:1,}],
      [{w:"sawtooth",v:0.3,d:1,s:0.5,},{w:"sine",v:11,t:11,a:0.2,d:0.05,s:0.3,g:1,}],
      [{w:"sine",v:0.3,a:0.06,d:1,s:0.5,},{w:"sine",v:7,f:1,d:1,s:0.2,g:1,}],
      [{w:"sawtooth",v:0.3,a:0.03,d:0.7,s:0.3,r:0.2,},{w:"sawtooth",v:0.3,t:0.75,d:0.7,a:0.1,s:0.3,r:0.2,}],
      [{w:"triangle",v:0.3,a:0.01,d:0.7,s:0.5,},{w:"square",v:5,t:0.5,d:0.7,s:0.5,g:1,}],
      /* 89-96 : SynthPad */
      [{w:"triangle",v:0.3,a:0.02,d:0.3,s:0.3,r:0.3,},{w:"square",v:3,t:4,f:1,a:0.02,d:0.1,s:1,g:1,},{w:"triangle",v:0.08,t:0.5,a:0.1,h:0,d:0.1,s:0.5,r:0.1,b:0,c:0,}],
      [{w:"sine",v:0.3,a:0.05,d:1,s:0.7,r:0.3,},{w:"sine",v:2,f:1,d:0.3,s:1,g:1,}],
      [{w:"square",v:0.3,a:0.03,d:0.5,s:0.3,r:0.1,},{w:"square",v:4,f:1,a:0.03,d:0.1,g:1,}],
      [{w:"triangle",v:0.3,a:0.08,d:1,s:0.3,r:0.1,},{w:"square",v:2,f:1,d:0.3,s:0.3,g:1,t:4,a:0.08,}],
      [{w:"sine",v:0.3,a:0.05,d:1,s:0.3,r:0.1,},{w:"sine",v:0.1,t:2.001,f:1,d:1,s:50,g:1,}],
      [{w:"triangle",v:0.3,a:0.03,d:0.7,s:0.3,r:0.2,},{w:"sine",v:12,t:7,f:1,d:0.5,s:1.7,g:1,}],
      [{w:"sine",v:0.3,a:0.05,d:1,s:0.3,r:0.1,},{w:"sawtooth",v:22,t:6,d:0.06,s:0.3,g:1,}],
      [{w:"triangle",v:0.3,a:0.05,d:11,r:0.3,},{w:"triangle",v:1,d:1,s:8,g:1,}],
      /* 97-104 : FX */
      [{w:"sawtooth",v:0.3,d:4,s:0.8,r:0.1,},{w:"square",v:1,t:2,f:8,a:1,d:1,s:1,r:0.1,g:1,}],
      [{w:"triangle",v:0.3,d:1,s:0.5,t:0.8,a:0.2,p:1.25,q:0.2,},{w:"sawtooth",v:0.2,a:0.2,d:0.3,s:1,t:1.2,p:1.25,q:0.2,}],
      [{w:"sine",v:0.3,d:1,s:0.3,},{w:"square",v:22,t:11,d:0.5,s:0.1,g:1,}],
      [{w:"sawtooth",v:0.3,a:0.04,d:1,s:0.8,r:0.1,},{w:"square",v:1,t:0.5,d:1,s:2,g:1,}],
      [{w:"triangle",v:0.3,d:1,s:0.3,},{w:"sine",v:22,t:6,d:0.6,s:0.05,g:1,}],
      [{w:"sine",v:0.6,a:0.1,d:0.05,s:0.4,},{w:"sine",v:5,t:5,f:1,d:0.05,s:0.3,g:1,}],
      [{w:"sine",a:0.1,d:0.05,s:0.4,v:0.8,},{w:"sine",v:5,t:5,f:1,d:0.05,s:0.3,g:1,}],
      [{w:"square",v:0.3,a:0.1,d:0.1,s:0.4,},{w:"square",v:1,f:1,d:0.3,s:0.1,g:1,}],
      /* 105-112 : Ethnic */
      [{w:"sawtooth",v:0.3,d:0.5,r:0.5,},{w:"sawtooth",v:11,t:5,d:0.05,g:1,}],
      [{w:"square",v:0.3,d:0.2,r:0.2,},{w:"square",v:7,t:3,d:0.05,g:1,}],
      [{w:"triangle",d:0.2,r:0.2,},{w:"square",v:9,t:3,d:0.1,r:0.1,g:1,}],
      [{w:"triangle",d:0.3,r:0.3,},{w:"square",v:6,t:3,d:1,r:1,g:1,}],
      [{w:"triangle",v:0.4,d:0.2,r:0.2,},{w:"square",v:22,t:12,d:0.1,r:0.1,g:1,}],
      [{w:"sine",v:0.25,a:0.02,d:0.05,s:0.8,},{w:"square",v:1,t:2,d:0.03,s:11,g:1,}],
      [{w:"sine",v:0.3,a:0.05,d:11,},{w:"square",v:7,t:3,f:1,s:0.7,g:1,}],
      [{w:"square",v:0.3,a:0.05,d:0.1,s:0.8,},{w:"square",v:4,d:0.1,s:1.1,g:1,}],
      /* 113-120 : Percussive */
      [{w:"sine",v:0.4,d:0.3,r:0.3,},{w:"sine",v:7,t:9,d:0.1,r:0.1,g:1,}],
      [{w:"sine",v:0.7,d:0.1,r:0.1,},{w:"sine",v:22,t:7,d:0.05,g:1,}],
      [{w:"sine",v:0.6,d:0.15,r:0.15,},{w:"square",v:11,t:3.2,d:0.1,r:0.1,g:1,}],
      [{w:"sine",v:0.8,d:0.07,r:0.07,},{w:"square",v:11,t:7,r:0.01,g:1,}],
      [{w:"triangle",v:0.7,t:0.5,d:0.2,r:0.2,p:0.95,},{w:"n0",v:9,g:1,d:0.2,r:0.2,}],
      [{w:"sine",v:0.7,d:0.1,r:0.1,p:0.9,},{w:"square",v:14,t:2,d:0.005,r:0.005,g:1,}],
      [{w:"square",d:0.15,r:0.15,p:0.5,},{w:"square",v:4,t:5,d:0.001,r:0.001,g:1,}],
      [{w:"n1",v:0.3,a:1,s:1,d:0.15,r:0,t:0.5,}],
      /* 121-128 : SE */
      [{w:"sine",t:12.5,d:0,r:0,p:0.5,v:0.3,h:0.2,q:0.5,},{g:1,w:"sine",v:1,t:2,d:0,r:0,s:1,},{g:1,w:"n0",v:0.2,t:2,a:0.6,h:0,d:0.1,r:0.1,b:0,c:0,}],
      [{w:"n0",v:0.2,a:0.05,h:0.02,d:0.02,r:0.02,}],
      [{w:"n0",v:0.4,a:1,d:1,t:0.25,}],
      [{w:"sine",v:0.3,a:0.1,d:1,s:0.5,},{w:"sine",v:4,t:0,f:1.5,d:1,s:1,r:0.1,g:1,},{g:1,w:"sine",v:4,t:0,f:2,a:0.6,h:0,d:0.1,s:1,r:0.1,b:0,c:0,}],
      [{w:"square",v:0.3,t:0.25,d:11,s:1,},{w:"square",v:12,t:0,f:8,d:1,s:1,r:11,g:1,}],
      [{w:"n0",v:0.4,t:0.5,a:1,d:11,s:1,r:0.5,},{w:"square",v:1,t:0,f:14,d:1,s:1,r:11,g:1,}],
      [{w:"sine",t:0,f:1221,a:0.2,d:1,r:0.25,s:1,},{g:1,w:"n0",v:3,t:0.5,d:1,s:1,r:1,}],
      [{w:"sine",d:0.4,r:0.4,p:0.1,t:2.5,v:1,},{w:"n0",v:12,t:2,d:1,r:1,g:1,}],
    ],
    program0:[
// 1-8 : Piano
      [{w:"triangle",v:.5,d:.7}],                   [{w:"triangle",v:.5,d:.7}],
      [{w:"triangle",v:.5,d:.7}],                   [{w:"triangle",v:.5,d:.7}],
      [{w:"triangle",v:.5,d:.7}],                   [{w:"triangle",v:.5,d:.7}],
      [{w:"sawtooth",v:.3,d:.7}],                   [{w:"sawtooth",v:.3,d:.7}],
/* 9-16 : Chromatic Perc*/
      [{w:"sine",v:.5,d:.3,r:.3}],                  [{w:"triangle",v:.5,d:.3,r:.3}],
      [{w:"square",v:.2,d:.3,r:.3}],                [{w:"square",v:.2,d:.3,r:.3}],
      [{w:"sine",v:.5,d:.1,r:.1}],                  [{w:"sine",v:.5,d:.1,r:.1}],
      [{w:"square",v:.2,d:1,r:1}],                  [{w:"sawtooth",v:.3,d:.7,r:.7}],
/* 17-24 : Organ */
      [{w:"sine",v:0.5,a:0.01,s:1}],                [{w:"sine",v:0.7,d:0.02,s:0.7}],
      [{w:"square",v:.2,s:1}],                      [{w:"triangle",v:.5,a:.01,s:1}],
      [{w:"square",v:.2,a:.02,s:1}],                [{w:"square",v:0.2,a:0.02,s:1}],
      [{w:"square",v:0.2,a:0.02,s:1}],              [{w:"square",v:.2,a:.05,s:1}],
/* 25-32 : Guitar */
      [{w:"triangle",v:.5,d:.5}],                   [{w:"square",v:.2,d:.6}],
      [{w:"square",v:.2,d:.6}],                     [{w:"triangle",v:.8,d:.6}],
      [{w:"triangle",v:.4,d:.05}],                  [{w:"square",v:.2,d:1}],
      [{w:"square",v:.2,d:1}],                      [{w:"sine",v:.4,d:.6}],
/* 33-40 : Bass */
      [{w:"triangle",v:.7,d:.4}],                   [{w:"triangle",v:.7,d:.7}],
      [{w:"triangle",v:.7,d:.7}],                   [{w:"triangle",v:.7,d:.7}],
      [{w:"square",v:.3,d:.2}],                     [{w:"square",v:.3,d:.2}],
      [{w:"square",v:.3,d:.1,s:.2}],                [{w:"sawtooth",v:.4,d:.1,s:.2}],
/* 41-48 : Strings */
      [{w:"sawtooth",v:.2,a:.02,s:1}],              [{w:"sawtooth",v:.2,a:.02,s:1}],
      [{w:"sawtooth",v:.2,a:.02,s:1}],              [{w:"sawtooth",v:.2,a:.02,s:1}],
      [{w:"sawtooth",v:.2,a:.02,s:1}],              [{w:"sawtooth",v:.3,d:.1}],
      [{w:"sawtooth",v:.3,d:.5,r:.5}],              [{w:"triangle",v:.6,d:.1,r:.1,h:0.03,p:0.8}],
/* 49-56 : Ensamble */
      [{w:"sawtooth",v:.2,a:.02,s:1}],              [{w:"sawtooth",v:.2,a:.02,s:1}],
      [{w:"sawtooth",v:.2,a:.02,s:1}],              [{w:"sawtooth",v:.2,a:.02,s:1}],
      [{w:"triangle",v:.3,a:.03,s:1}],              [{w:"sine",v:.3,a:.03,s:1}],
      [{w:"triangle",v:.3,a:.05,s:1}],              [{w:"sawtooth",v:.5,a:.01,d:.1}],
/* 57-64 : Brass */
      [{w:"square",v:.3,a:.05,d:.2,s:.6}],          [{w:"square",v:.3,a:.05,d:.2,s:.6}],
      [{w:"square",v:.3,a:.05,d:.2,s:.6}],          [{w:"square",v:0.2,a:.05,d:0.01,s:1}],
      [{w:"square",v:.3,a:.05,s:1}],                [{w:"square",v:.3,s:.7}],
      [{w:"square",v:.3,s:.7}],                     [{w:"square",v:.3,s:.7}],
/* 65-72 : Reed */
      [{w:"square",v:.3,a:.02,d:2}],                [{w:"square",v:.3,a:.02,d:2}],
      [{w:"square",v:.3,a:.03,d:2}],                [{w:"square",v:.3,a:.04,d:2}],
      [{w:"square",v:.3,a:.02,d:2}],                [{w:"square",v:.3,a:.05,d:2}],
      [{w:"square",v:.3,a:.03,d:2}],                [{w:"square",v:.3,a:.03,d:2}],
/* 73-80 : Pipe */
      [{w:"sine",v:.7,a:.02,d:2}],                  [{w:"sine",v:.7,a:.02,d:2}],
      [{w:"sine",v:.7,a:.02,d:2}],                  [{w:"sine",v:.7,a:.02,d:2}],
      [{w:"sine",v:.7,a:.02,d:2}],                  [{w:"sine",v:.7,a:.02,d:2}],
      [{w:"sine",v:.7,a:.02,d:2}],                  [{w:"sine",v:.7,a:.02,d:2}],
/* 81-88 : SynthLead */
      [{w:"square",v:.3,s:.7}],                     [{w:"sawtooth",v:.4,s:.7}],
      [{w:"triangle",v:.5,s:.7}],                   [{w:"sawtooth",v:.4,s:.7}],
      [{w:"sawtooth",v:.4,d:12}],                   [{w:"sine",v:.4,a:.06,d:12}],
      [{w:"sawtooth",v:.4,d:12}],                   [{w:"sawtooth",v:.4,d:12}],
/* 89-96 : SynthPad */
      [{w:"sawtooth",v:.3,d:12}],                   [{w:"triangle",v:.5,d:12}],
      [{w:"square",v:.3,d:12}],                     [{w:"triangle",v:.5,a:.08,d:11}],
      [{w:"sawtooth",v:.5,a:.05,d:11}],             [{w:"sawtooth",v:.5,d:11}],
      [{w:"triangle",v:.5,d:11}],                   [{w:"triangle",v:.5,d:11}],
/* 97-104 : FX */
      [{w:"triangle",v:.5,d:11}],                   [{w:"triangle",v:.5,d:11}],
      [{w:"square",v:.3,d:11}],                     [{w:"sawtooth",v:0.5,a:0.04,d:11}],
      [{w:"sawtooth",v:.5,d:11}],                   [{w:"triangle",v:.5,a:.8,d:11}],
      [{w:"triangle",v:.5,d:11}],                   [{w:"square",v:.3,d:11}],
/* 105-112 : Ethnic */
      [{w:"sawtooth",v:.3,d:1,r:1}],                [{w:"sawtooth",v:.5,d:.3}],
      [{w:"sawtooth",v:.5,d:.3,r:.3}],              [{w:"sawtooth",v:.5,d:.3,r:.3}],
      [{w:"square",v:.3,d:.2,r:.2}],                [{w:"square",v:.3,a:.02,d:2}],
      [{w:"sawtooth",v:.2,a:.02,d:.7}],             [{w:"triangle",v:.5,d:1}],
/* 113-120 : Percussive */
      [{w:"sawtooth",v:.3,d:.3,r:.3}],              [{w:"sine",v:.8,d:.1,r:.1}],
      [{w:"square",v:.2,d:.1,r:.1,p:1.05}],         [{w:"sine",v:.8,d:.05,r:.05}],
      [{w:"triangle",v:0.5,d:0.1,r:0.1,p:0.96}],    [{w:"triangle",v:0.5,d:0.1,r:0.1,p:0.97}],
      [{w:"square",v:.3,d:.1,r:.1,}],               [{w:"n1",v:0.3,a:1,s:1,d:0.15,r:0,t:0.5,}],
/* 121-128 : SE */
      [{w:"triangle",v:0.5,d:0.03,t:0,f:1332,r:0.001,p:1.1}],
      [{w:"n0",v:0.2,t:0.1,d:0.02,a:0.05,h:0.02,r:0.02}],
      [{w:"n0",v:0.4,a:1,d:1,t:0.25,}],
      [{w:"sine",v:0.3,a:0.8,d:1,t:0,f:1832}],
      [{w:"triangle",d:0.5,t:0,f:444,s:1,}],
      [{w:"n0",v:0.4,d:1,t:0,f:22,s:1,}],
      [{w:"n0",v:0.5,a:0.2,d:11,t:0,f:44}],
      [{w:"n0",v:0.5,t:0.25,d:0.4,r:0.4}],
    ],
    drummap1:[
/*35*/  [{w:"triangle",t:0,f:70,v:1,d:0.05,h:0.03,p:0.9,q:0.1,},{w:"n0",g:1,t:6,v:17,r:0.01,h:0,p:0,}],
        [{w:"triangle",t:0,f:88,v:1,d:0.05,h:0.03,p:0.5,q:0.1,},{w:"n0",g:1,t:5,v:42,r:0.01,h:0,p:0,}],
        [{w:"n0",f:222,p:0,t:0,r:0.01,h:0,}],
        [{w:"triangle",v:0.3,f:180,d:0.05,t:0,h:0.03,p:0.9,q:0.1,},{w:"n0",v:0.6,t:0,f:70,h:0.02,r:0.01,p:0,},{g:1,w:"square",v:2,t:0,f:360,r:0.01,b:0,c:0,}],
        [{w:"square",f:1150,v:0.34,t:0,r:0.03,h:0.025,d:0.03,},{g:1,w:"n0",t:0,f:13,h:0.025,d:0.1,s:1,r:0.1,v:1,}],
/*40*/  [{w:"triangle",f:200,v:1,d:0.06,t:0,r:0.06,},{w:"n0",g:1,t:0,f:400,v:12,r:0.02,d:0.02,}],
        [{w:"triangle",f:100,v:0.9,d:0.12,h:0.02,p:0.5,t:0,r:0.12,},{g:1,w:"n0",v:5,t:0.4,h:0.015,d:0.005,r:0.005,}],
        [{w:"n1",f:390,v:0.25,r:0.01,t:0,}],
        [{w:"triangle",f:120,v:0.9,d:0.12,h:0.02,p:0.5,t:0,r:0.12,},{g:1,w:"n0",v:5,t:0.5,h:0.015,d:0.005,r:0.005,}],
        [{w:"n1",v:0.25,f:390,r:0.03,t:0,h:0.005,d:0.03,}],
/*45*/  [{w:"triangle",f:140,v:0.9,d:0.12,h:0.02,p:0.5,t:0,r:0.12,},{g:1,w:"n0",v:5,t:0.3,h:0.015,d:0.005,r:0.005,}],
        [{w:"n1",v:0.25,f:390,t:0,d:0.2,r:0.2,},{w:"n0",v:0.3,t:0,c:0,f:440,h:0.005,d:0.05,}],
        [{w:"triangle",f:155,v:0.9,d:0.12,h:0.02,p:0.5,t:0,r:0.12,},{g:1,w:"n0",v:5,t:0.3,h:0.015,d:0.005,r:0.005,}],
        [{w:"triangle",f:180,v:0.9,d:0.12,h:0.02,p:0.5,t:0,r:0.12,},{g:1,w:"n0",v:5,t:0.3,h:0.015,d:0.005,r:0.005,}],
        [{w:"n1",v:0.3,f:1200,d:0.2,r:0.2,h:0.05,t:0,},{w:"n1",t:0,v:1,d:0.1,r:0.1,p:1.2,f:440,}],
/*50*/  [{w:"triangle",f:220,v:0.9,d:0.12,h:0.02,p:0.5,t:0,r:0.12,},{g:1,w:"n0",v:5,t:0.3,h:0.015,d:0.005,r:0.005,}],
        [{w:"n1",f:500,v:0.15,d:0.4,r:0.4,h:0,t:0,},{w:"n0",v:0.1,t:0,r:0.01,f:440,}],
        [{w:"n1",v:0.3,f:800,d:0.2,r:0.2,h:0.05,t:0,},{w:"square",t:0,v:1,d:0.1,r:0.1,p:0.1,f:220,g:1,}],
        [{w:"sine",f:1651,v:0.15,d:0.2,r:0.2,h:0,t:0,},{w:"sawtooth",g:1,t:1.21,v:7.2,d:0.1,r:11,h:1,},{g:1,w:"n0",v:3.1,t:0.152,d:0.002,r:0.002,}],
        null,
/*55*/  [{w:"n1",v:.3,f:1200,d:0.2,r:0.2,h:0.05,t:0,},{w:"n1",t:0,v:1,d:0.1,r:0.1,p:1.2,f:440,}],
        null,
        [{w:"n1",v:0.3,f:555,d:0.25,r:0.25,h:0.05,t:0,},{w:"n1",t:0,v:1,d:0.1,r:0.1,f:440,a:0.005,h:0.02,}],
        [{w:"sawtooth",f:776,v:0.2,d:0.3,t:0,r:0.3,},{g:1,w:"n0",v:2,t:0,f:776,a:0.005,h:0.02,d:0.1,s:1,r:0.1,c:0,},{g:11,w:"sine",v:0.1,t:0,f:22,d:0.3,r:0.3,b:0,c:0,}],
        [{w:"n1",f:440,v:0.15,d:0.4,r:0.4,h:0,t:0,},{w:"n0",v:0.4,t:0,r:0.01,f:440,}],
/*60*/  null,null,null,null,null,
/*65*/  null,null,null,null,null,
/*70*/  null,null,null,null,null,
/*75*/  null,null,null,null,null,
/*80*/  [{w:"sine",f:1720,v:0.3,d:0.02,t:0,r:0.02,},{w:"square",g:1,t:0,f:2876,v:6,d:0.2,s:1,r:0.2,}],
        [{w:"sine",f:1720,v:0.3,d:0.25,t:0,r:0.25,},{w:"square",g:1,t:0,f:2876,v:6,d:0.2,s:1,r:0.2,}],
    ],
    drummap0:[
/*35*/[{w:"triangle",t:0,f:110,v:1,d:0.05,h:0.02,p:0.1,}],
      [{w:"triangle",t:0,f:150,v:0.8,d:0.1,p:0.1,h:0.02,r:0.01,}],
      [{w:"n0",f:392,v:0.5,d:0.01,p:0,t:0,r:0.05}],
      [{w:"n0",f:33,d:0.05,t:0,}],
      [{w:"n0",f:100,v:0.7,d:0.03,t:0,r:0.03,h:0.02,}],
/*40*/[{w:"n0",f:44,v:0.7,d:0.02,p:0.1,t:0,h:0.02,}],
      [{w:"triangle",f:240,v:0.9,d:0.1,h:0.02,p:0.1,t:0,}],
      [{w:"n0",f:440,v:0.2,r:0.01,t:0,}],
      [{w:"triangle",f:270,v:0.9,d:0.1,h:0.02,p:0.1,t:0,}],
      [{w:"n0",f:440,v:0.2,d:0.04,r:0.04,t:0,}],
/*45*/[{w:"triangle",f:300,v:0.9,d:0.1,h:0.02,p:0.1,t:0,}],
      [{w:"n0",f:440,v:0.2,d:0.1,r:0.1,h:0.02,t:0,}],
      [{w:"triangle",f:320,v:0.9,d:0.1,h:0.02,p:0.1,t:0,}],
      [{w:"triangle",f:360,v:0.9,d:0.1,h:0.02,p:0.1,t:0,}],
      [{w:"n0",f:150,v:0.2,d:0.1,r:0.1,h:0.05,t:0,p:0.1,}],
/*50*/[{w:"triangle",f:400,v:0.9,d:0.1,h:0.02,p:0.1,t:0,}],
      [{w:"n0",f:150,v:0.2,d:0.1,r:0.01,h:0.05,t:0,p:0.1}],
      [{w:"n0",f:150,v:0.2,d:0.1,r:0.01,h:0.05,t:0,p:0.1}],
      [{w:"n0",f:440,v:0.3,d:0.1,p:0.9,t:0,r:0.1,}],
      [{w:"n0",f:200,v:0.2,d:0.05,p:0.9,t:0,}],
/*55*/[{w:"n0",f:440,v:0.3,d:0.12,p:0.9,t:0,}],
      [{w:"sine",f:800,v:0.4,d:0.06,t:0,}],
      [{w:"n0",f:150,v:0.2,d:0.1,r:0.01,h:0.05,t:0,p:0.1}],
      [{w:"n0",f:33,v:0.3,d:0.2,p:0.9,t:0,}],
      [{w:"n0",f:300,v:0.3,d:0.14,p:0.9,t:0,}],
/*60*/[{w:"sine",f:200,d:0.06,t:0,}],
      [{w:"sine",f:150,d:0.06,t:0,}],
      [{w:"sine",f:300,t:0,}],
      [{w:"sine",f:300,d:0.06,t:0,}],
      [{w:"sine",f:250,d:0.06,t:0,}],
/*65*/[{w:"square",f:300,v:.3,d:.06,p:.8,t:0,}],
      [{w:"square",f:260,v:.3,d:.06,p:.8,t:0,}],
      [{w:"sine",f:850,v:.5,d:.07,t:0,}],
      [{w:"sine",f:790,v:.5,d:.07,t:0,}],
      [{w:"n0",f:440,v:0.3,a:0.05,t:0,}],
/*70*/[{w:"n0",f:440,v:0.3,a:0.05,t:0,}],
      [{w:"triangle",f:1800,v:0.4,p:0.9,t:0,h:0.03,}],
      [{w:"triangle",f:1800,v:0.3,p:0.9,t:0,h:0.13,}],
      [{w:"n0",f:330,v:0.3,a:0.02,t:0,r:0.01,}],
      [{w:"n0",f:330,v:0.3,a:0.02,t:0,h:0.04,r:0.01,}],
/*75*/[{w:"n0",f:440,v:0.3,t:0,}],
      [{w:"sine",f:800,t:0,}],
      [{w:"sine",f:700,t:0,}],
      [{w:"n0",f:330,v:0.3,t:0,}],
      [{w:"n0",f:330,v:0.3,t:0,h:0.1,r:0.01,p:0.7,}],
/*80*/[{w:"sine",t:0,f:1200,v:0.3,r:0.01,}],
      [{w:"sine",t:0,f:1200,v:0.3,d:0.2,r:0.2,}],

    ],
    /*@@gui*/
    _guiInit:()=>{
      if(this.canvas){
        this.ctx=this.canvas.getContext("2d");
        this.ctx.fillStyle="#000";
        this.ctx.fillRect(0,0,300,32);
        this.canvas.addEventListener("dragover",this.dragOver.bind(this),false);
        this.canvas.addEventListener("dragleave",this.dragLeave.bind(this),false);
        this.canvas.addEventListener("drop",this.execDrop.bind(this),false);
        this.canvas.addEventListener("click",this.click.bind(this),false);
        this.canvas.addEventListener("mousedown",this.pointerdown.bind(this),false);
        this.canvas.addEventListener("mousemove",this.pointermove.bind(this),false);
        this.canvas.addEventListener("touchstart",this.pointerdown.bind(this),false);
        this.canvas.addEventListener("touchend",this.pointerup.bind(this),false);
        this.canvas.addEventListener("touchcancel",this.pointerup.bind(this),false);
        this.canvas.addEventListener("touchmove",this.pointermove.bind(this),false);
      }
    },
    _guiUpdate:()=>{
      if(this.canvas){
        this.ctx.fillStyle="#000";
        this.ctx.fillRect(0,0,300,32);
        var row1=8,row2=20;
        if(this.song)
          row1=4,row2=24;
        else {
          this.ctx.fillStyle="#fff";
          this.ctx.fillText("TinySynth",8,20);
        }
        if(this.graph){
          this.ctx.fillStyle="#800";
          this.ctx.fillRect(80,row1,132,4);
          this.ctx.fillRect(80,row2,132,4);
          this.ctx.fillStyle="#f00";
          for(let i=this.notetab.length-1;i>=0;--i){
            const nt=this.notetab[i];
            if(!nt.f || this.rhythm[nt.ch]){
              this.ctx.fillRect(80+nt.n,row1,4,4);
              this.ctx.fillRect(80+nt.ch*8,row2,6,4);
            }
          }
        }
        if(this.perfmon){
          this.ctx.fillStyle="#fff";
          this.ctx.fillRect(180,30,28,-12);
          this.ctx.fillStyle="#000";
          this.ctx.fillText(this.notetab.length,185,28);
        }
        this.ctx.fillStyle="#fff";
        this.ctx.fillRect(250,15,32,2);
        this.ctx.fillStyle="#fff";
        this.ctx.strokeStyle="#000";
        this.ctx.beginPath();
        this.ctx.arc(250+this.masterVol*32,16,6,0,6.28,0);
        this.ctx.moveTo(220,12); this.ctx.lineTo(224,12); this.ctx.lineTo(230,6);
        this.ctx.lineTo(230,26); this.ctx.lineTo(224,20); this.ctx.lineTo(220,20);
        this.ctx.fill();
        this.ctx.stroke();
        this.ctx.strokeStyle="#fff";
        this.ctx.lineWidth=2;
        this.ctx.beginPath();
        this.ctx.arc(230,16,4,-1,1,false);
        this.ctx.stroke();
        this.ctx.beginPath();
        this.ctx.arc(230,16,8,-1,1,false);
        this.ctx.stroke();
        if(this.masterVol==0){
          this.ctx.strokeStyle="#000";
          this.ctx.lineWidth=4;
          this.ctx.beginPath();
          this.ctx.moveTo(220,7);
          this.ctx.lineTo(238,25);
          this.ctx.stroke();
          this.ctx.strokeStyle="#fff";
          this.ctx.lineWidth=2;
          this.ctx.stroke();
        }
        if(this.song){
          this.ctx.fillStyle="#fff";
          this.ctx.fillRect(4,2,28,28);
          this.ctx.fillRect(80,15,128,2);
          this.ctx.fillStyle="#000";
          if(this.playing){
            this.ctx.fillRect(12,10,4,12);
            this.ctx.fillRect(22,10,4,12);
          }
          else{
            this.ctx.beginPath();
            this.ctx.moveTo(12,9);
            this.ctx.lineTo(25,16);
            this.ctx.lineTo(12,23);
            this.ctx.fill();
          }
          this.ctx.fillStyle="#fff"
          this.ctx.fillText(this.toTime(this.playTick),38,14);
          this.ctx.fillText(this.toTime(this.maxTick),38,28);
          this.ctx.strokeStyle="#000";
          this.ctx.beginPath();
          this.ctx.arc(80+this.playTick/this.maxTick*128,16,6,0,6.28,0);
          this.ctx.fill();
          this.ctx.stroke();
        }
        if(this.waitdrop){
          this.ctx.fillStyle="rgba(0,0,0,0.7)"
          this.ctx.fillRect(0,0,300,32);
          this.ctx.fillStyle="#fff";
          this.ctx.fillText("Drop MIDI File Here",100,20);
        }
      }
    },
    toTime:(ti)=>{
      ti=(ti*4*60/this.song.timebase/this.song.tempo)|0;
      const m=(ti/60)|0;
      const s=ti%60;
      return ("00"+m).substr(-2)+":"+("00"+s).substr(-2);
    },
    preventScroll:(e)=>{
      e.preventDefault();
    },
    pointerup:(ev)=>{
      document.body.removeEventListener('touchstart',this.preventScroll,false);
    },
    getPos:(e)=>{
      var p=e.target.getBoundingClientRect();
      if(p.right!=p.left)
        return {x:(e.clientX-p.left)*300/(p.right-p.left),y:e.clientY-p.top};
      return {x:0,y:0};
    },
    pointerdown:(ev)=>{
      let e=ev;
      if(ev.touches)
        e=ev.touches[0];
      this.downpos=this.getPos(e);
      if(ev.touches || (e.buttons&1)){
        if(this.song&&this.downpos.x>=80&&this.downpos.x<=208){
          const p=(this.downpos.x-80)/128*this.maxTick;
          this.locateMIDI(p);
          document.body.addEventListener('touchstart',this.preventScroll,false);
        }
        if(this.downpos.x>=250&&this.downpos.x<282){
          const p=(this.downpos.x-250)/32;
          this.setMasterVol(p);
          document.body.addEventListener('touchstart',this.preventScroll,false);
        }
      }
    },
    pointermove:(ev)=>{
      let e=ev;
      if(ev.touches)
        e=ev.touches[0];
      if(ev.touches || (e.buttons&1)){
        const pos=this.getPos(e);
        if(this.song&&pos.x>=70&&pos.x<=208){
          if(pos.x<80) pos.x=80;
          const p=(pos.x-80)/128*this.maxTick;
          this.locateMIDI(p);
        }
        if(pos.x>=250&&pos.x<282){
          const p=(pos.x-250)/32;
          this.setMasterVol(p);
        }
      }
    },
    click:(e)=>{
      const pos=this.getPos(e);
      if(pos.x<40 && this.song){
        if(this.playing)
          this.stopMIDI();
        else if(this.song)
          this.playMIDI();
      }
      if(pos.x>=215&&pos.x<243 && this.downpos.x>=215 && this.downpos.x<243){
        if(this.masterVol>0){
          this.lastMasterVol=this.masterVol;
          this.masterVol=0;
        }
        else
          this.masterVol=this.lastMasterVol;
      }
    },
    dragLeave:(e)=>{
      this.waitdrop=0;
    },
    dragOver:(e)=>{
      this.waitdrop=1;
      e.stopPropagation();
      e.preventDefault();
      e.dataTransfer.dropEffect = "copy";
    },
    execDrop:(e)=>{
      this.waitdrop=0;
      const f = e.dataTransfer.files;
      if(this.disabledrop==0){
        var reader = new FileReader();
        reader.onload=function(e){
          this.loadMIDI(reader.result);
        }.bind(this);
        reader.readAsArrayBuffer(f[0]);
      }
      e.stopPropagation();
      e.preventDefault();
    },
    /*@@guiEND*/
    ready:()=>{
      return new Promise((resolv)=>{
        const timerid=setInterval(()=>{
/*
          if(this.debug)
            console.log("Initialize checking.");
*/
          if(this.isReady){
            clearInterval(timerid);
            if(this.debug)
              console.log("Initialized.");
            resolv();
          }
        },100);
      });
    },
    init:()=>{
      this.pg=[]; this.vol=[]; this.ex=[]; this.bend=[]; this.rpnidx=[]; this.brange=[];
      this.sustain=[]; this.notetab=[]; this.rhythm=[];
      this.masterTuningC=0; this.masterTuningF=0; this.tuningC=[]; this.tuningF=[]; this.scaleTuning=[];
      this.maxTick=0, this.playTick=0, this.playing=0; this.releaseRatio=3.5;
      for(let i=0;i<16;++i){
        this.pg[i]=0; this.vol[i]=3*100*100/(127*127);
        this.bend[i]=0; this.brange[i]=0x100;
        this.tuningC[i]=0; this.tuningF[i]=0;
        this.scaleTuning[i]=[0,0,0,0,0,0,0,0,0,0,0,0];
        this.rhythm[i]=0;
      }
      this.rhythm[9]=1;
      this.preroll=0.2;
      this.relcnt=0;
      setInterval(
        function(){
          if(++this.relcnt>=3){
            this.relcnt=0;
            for(let i=this.notetab.length-1;i>=0;--i){
              var nt=this.notetab[i];
              if(this.actx.currentTime>nt.e){
                this._pruneNote(nt);
                this.notetab.splice(i,1);
              }
            }
            /*@@gui*/
            /*@@guiEND*/
          }
          if(this.playing && this.song.ev.length>0){
            let e=this.song.ev[this.playIndex];
            while(this.actx.currentTime+this.preroll>this.playTime){
              if(e.m[0]==0xff51){
                this.song.tempo=e.m[1];
                this.tick2Time=4*60/this.song.tempo/this.song.timebase;
              }
              else
                this.send(e.m,this.playTime);
              ++this.playIndex;
              if(this.playIndex>=this.song.ev.length){
                if(this.loop){
                  e=this.song.ev[this.playIndex=0];
                  this.playTick=e.t;
                }
                else{
                  this.playTick=this.maxTick;
                  this.playing=0;
                  break;
                }
              }
              else{
                e=this.song.ev[this.playIndex];
                this.playTime+=(e.t-this.playTick)*this.tick2Time;
                this.playTick=e.t;
              }
            }
          }
        }.bind(this),60
      );
      if(this.debug)
        console.log("internalcontext:"+this.internalcontext)
      if(this.internalcontext){
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        this.setAudioContext(new AudioContext());
      }
      this.isReady=1;
    },
    setMasterVol:(v)=>{
      if(v!=undefined)
        this.masterVol=v;
      if(this.out)
        this.out.gain.value=this.masterVol;
    },
    setReverbLev:(v)=>{
      if(v!=undefined)
        this.reverbLev=v;
      var r=parseFloat(this.reverbLev);
      if(this.rev&&!isNaN(r))
        this.rev.gain.value=r*8;
    },
    setLoop:(f)=>{
      this.loop=f;
    },
    setVoices:(v)=>{
      this.voices=v;
    },
    getPlayStatus:()=>{
      return {play:this.playing, maxTick:this.maxTick, curTick:this.playTick};
    },
    locateMIDI:(tick)=>{
      let i,p=this.playing;
      this.stopMIDI();
      for(i=0;i<this.song.ev.length && tick>this.song.ev[i].t;++i){
        var m=this.song.ev[i];
        var ch=m.m[0]&0xf;
        switch(m.m[0]&0xf0){
        case 0xb0:
          switch(m.m[1]){
          case 1:  this.setModulation(ch,m.m[2]); break;
          case 7:  this.setChVol(ch,m.m[2]); break;
          case 10: this.setPan(ch,m.m[2]); break;
          case 11: this.setExpression(ch,m.m[2]); break;
          case 64: this.setSustain(ch,m.m[2]); break;
          }
          break;
        case 0xc0: this.pg[m.m[0]&0x0f]=m.m[1]; break;
        }
        if(m.m[0]==0xff51)
          this.song.tempo=m.m[1];
      }
      if(!this.song.ev[i]){
        this.playIndex=0;
        this.playTick=this.maxTick;
      }
      else{
        this.playIndex=i;
        this.playTick=this.song.ev[i].t;
      }
      if(p)
        this.playMIDI();
    },
    getTimbreName:(m,n)=>{
      if(m==0)
        return this.program[n].name;
      else
        return this.drummap[n-35].name;
    },
    loadMIDIfromSrc:()=>{
      this.loadMIDIUrl(this.src);
    },
    loadMIDIUrl:(url)=>{
      if(!url)
        return;
      var xhr=new XMLHttpRequest();
      xhr.open("GET",url,true);
      xhr.responseType="arraybuffer";
      xhr.loadMIDI=this.loadMIDI.bind(this);
      xhr.onload=function(e){
        if(this.status==200){
          this.loadMIDI(this.response);
        }
      };
      xhr.send();
    },
    reset:()=>{
      for(let i=0;i<16;++i){
        this.setProgram(i,0);
        this.setBendRange(i,0x100);
        this.setModulation(i,0);
        this.setChVol(i,100);
        this.setPan(i,64);
        this.resetAllControllers(i);
        this.allSoundOff(i);
        this.rhythm[i]=0;
        this.tuningC[i]=0;
        this.tuningF[i]=0;
      }
      this.masterTuningC=0;
      this.masterTuningF=0;
      this.rhythm[9]=1;
    },
    stopMIDI:()=>{
      this.playing=0;
      for(var i=0;i<16;++i)
        this.allSoundOff(i);
    },
    playMIDI:()=>{
      if(!this.song)
        return;
      const dummy=this.actx.createOscillator();
      dummy.connect(this.actx.destination);
      dummy.frequency.value=0;
      dummy.start(0);
      dummy.stop(this.actx.currentTime+0.001);
      if(this.playTick>=this.maxTick)
        this.playTick=0,this.playIndex=0;
      this.playTime=this.actx.currentTime+.1;
      this.tick2Time=4*60/this.song.tempo/this.song.timebase;
      this.playing=1;
    },
    loadMIDI:(data)=>{
      function Get2(s, i) { return (s[i]<<8) + s[i+1]; }
      function Get3(s, i) { return (s[i]<<16) + (s[i+1]<<8) + s[i+2]; }
      function Get4(s, i) { return (s[i]<<24) + (s[i+1]<<16) + (s[i+2]<<8) + s[i+3]; }
      function GetStr(s, i, len) {
        return String.fromCharCode.apply(null,s.slice(i,i+len));
      }
      function Delta(s, i) {
        var v, d;
        v = 0;
        datalen = 1;
        while((d = s[i]) & 0x80) {
          v = (v<<7) + (d&0x7f);
          ++datalen;
          ++i;
        }
        return (v<<7)+d;
      }
      function Msg(song,tick,s,i){
        var v=s[i];
        datalen=1;
        if((v&0x80)==0)
          v=runst,datalen=0;
        runst=v;
        switch(v&0xf0){
        case 0xc0: case 0xd0:
          song.ev.push({t:tick,m:[v,s[i+datalen]]});
          datalen+=1;
          break;
        case 0xf0:
          switch(v) {
          case 0xf0:
          case 0xf7:
            var len=Delta(s,i+1);
            datastart=1+datalen;
            var exd=Array.from(s.slice(i+datastart,i+datastart+len));
            exd.unshift(0xf0);
            song.ev.push({t:tick,m:exd});
/*
            var sysex=[];
            for(var jj=0;jj<len;++jj)
              sysex.push(s[i+datastart+jj].toString(16));
            if(this.debug)
              console.log(sysex);
*/
            datalen+=len+1;
            break;
          case 0xff:
            var len = Delta(s, i + 2);
            datastart = 2+datalen;
            datalen = len+datalen+2;
            switch(s[i+1]) {
            case 0x02: song.copyright+=GetStr(s, i + datastart, datalen - 3); break;
            case 0x01: case 0x03: case 0x04: case 0x09:
              song.text=GetStr(s, i + datastart, datalen - datastart);
              break;
            case 0x2f:
              return 1;
            case 0x51:
              var val = Math.floor(60000000 / Get3(s, i + 3));
              song.ev.push({t:tick, m:[0xff51, val]});
              break;
            }
            break;
          }
          break;
        default:
          song.ev.push({t:tick,m:[v,s[i+datalen],s[i+datalen+1]]});
          datalen+=2;
        }
        return 0;
      }
      this.stopMIDI();
      var s=new Uint8Array(data);
      var datalen = 0, datastart = 0, runst = 0x90;
      var idx = 0;
      var hd = s.slice(0,  4);
      if(hd.toString()!="77,84,104,100")  //MThd
        return;
      var len = Get4(s, 4);
      var fmt = Get2(s, 8);
      var numtrk = Get2(s, 10);
      this.maxTick=0;
      var tb = Get2(s, 12)*4;
      idx = (len + 8);
      this.song={copyright:"",text:"",tempo:120,timebase:tb,ev:[]};
      for(let tr=0;tr<numtrk;++tr){
        hd=s.slice(idx, idx+4);
        len=Get4(s, idx+4);
        if(hd.toString()=="77,84,114,107") {//MTrk
          var tick = 0;
          var j = 0;
          this.notetab.length = 0;
          for(;;) {
            tick += Delta(s, idx + 8 + j);
            j += datalen;
            var e = Msg(this.song, tick, s, idx + 8 + j);
            j += datalen;
            if(e)
              break;
          }
          if(tick>this.maxTick)
            this.maxTick=tick;
        }
        idx += (len+8);
      }
      this.song.ev.sort(function(x,y){return x.t-y.t});
      this.reset();
      this.locateMIDI(0);
    },
    setQuality:(q)=>{
      if(q!=undefined)
        this.quality=q;
      for(let i=0;i<128;++i)
        this.setTimbre(0,i,this.program0[i]);
      for(let i=0;i<this.drummap0.length;++i)
        this.setTimbre(1,i+35,this.drummap0[i]);
      if(this.quality){
        for(let i=0;i<this.program1.length;++i)
          this.setTimbre(0,i,this.program1[i]);
        for(let i=0;i<this.drummap.length;++i){
          if(this.drummap1[i])
            this.setTimbre(1,i+35,this.drummap1[i]);
        }
      }
    },
    setTimbre:(m,n,p)=>{
      const defp={g:0,w:"sine",t:1,f:0,v:0.5,a:0,h:0.01,d:0.01,s:0,r:0.05,p:1,q:1,k:0};
      function filldef(p){
        for(n=0;n<p.length;++n){
          for(let k in defp){
            if(!p[n].hasOwnProperty(k) || typeof(p[n][k])=="undefined")
              p[n][k]=defp[k];
          }
        }
        return p;
      }
      if(m && n>=35 && n<=81)
        this.drummap[n-35].p=filldef(p);
      if(m==0 && n>=0 && n<=127)
        this.program[n].p=filldef(p);
    },
    _pruneNote:(nt)=>{
      for(let k=nt.o.length-1;k>=0;--k){
        if(nt.o[k].frequency){
          nt.o[k].frequency.cancelScheduledValues(0);
        }
        else{
          nt.o[k].playbackRate.cancelScheduledValues(0);
        }
        nt.g[k].gain.cancelScheduledValues(0);

        nt.o[k].stop();
        if(nt.o[k].detune) {
          try {
            this.chmod[nt.ch].disconnect(nt.o[k].detune);
          } catch (e) {}
        }
        nt.g[k].gain.value = 0;
      }
    },
    _limitVoices:(ch,n)=>{
      this.notetab.sort(function(n1,n2){
        if(n1.f!=n2.f) return n1.f-n2.f;
        if(n1.e!=n2.e) return n2.e-n1.e;
        return n2.t-n1.t;
      });
      for(let i=this.notetab.length-1;i>=0;--i){
        var nt=this.notetab[i];
        if(this.actx.currentTime>nt.e || i>=(this.voices-1)){
          this._pruneNote(nt);
          this.notetab.splice(i,1);
        }
      }
    },
    _note:(t,ch,n,v,p)=>{
      let out,sc,pn;
      const o=[],g=[],vp=[],fp=[],r=[];
      const f=440*Math.pow(2,(n-69 + this.masterTuningC + this.tuningC[ch] + (this.masterTuningF + this.tuningF[ch]/8192 + this.scaleTuning[ch][n%12]))/12);
      this._limitVoices(ch,n);
      for(let i=0;i<p.length;++i){
        pn=p[i];
        const dt=t+pn.a+pn.h;
        if(pn.g==0)
          out=this.chvol[ch], sc=v*v/16384, fp[i]=f*pn.t+pn.f;
        else if(pn.g>10)
          out=g[pn.g-11].gain, sc=1, fp[i]=fp[pn.g-11]*pn.t+pn.f;
        else if(o[pn.g-1].frequency)
          out=o[pn.g-1].frequency, sc=fp[pn.g-1], fp[i]=fp[pn.g-1]*pn.t+pn.f;
        else
          out=o[pn.g-1].playbackRate, sc=fp[pn.g-1]/440, fp[i]=fp[pn.g-1]*pn.t+pn.f;
        switch(pn.w[0]){
        case "n":
          o[i]=this.actx.createBufferSource();
          o[i].buffer=this.noiseBuf[pn.w];
          o[i].loop=true;
          o[i].playbackRate.value=fp[i]/440;
          if(pn.p!=1)
            this._setParamTarget(o[i].playbackRate,fp[i]/440*pn.p,t,pn.q);
          if (o[i].detune) {
            this.chmod[ch].connect(o[i].detune);
            o[i].detune.value=this.bend[ch];
          }
          break;
        default:
          o[i]=this.actx.createOscillator();
          o[i].frequency.value=fp[i];
          if(pn.p!=1)
            this._setParamTarget(o[i].frequency,fp[i]*pn.p,t,pn.q);
          if(pn.w[0]=="w")
            o[i].setPeriodicWave(this.wave[pn.w]);
          else
            o[i].type=pn.w;
          if (o[i].detune) {
            this.chmod[ch].connect(o[i].detune);
            o[i].detune.value=this.bend[ch];
          }
          break;
        }
        g[i]=this.actx.createGain();
        r[i]=pn.r;
        o[i].connect(g[i]); g[i].connect(out);
        vp[i]=sc*pn.v;
        if(pn.k)
          vp[i]*=Math.pow(2,(n-60)/12*pn.k);
        if(pn.a){
          g[i].gain.value=0;
          g[i].gain.setValueAtTime(0,t);
          g[i].gain.linearRampToValueAtTime(vp[i],t+pn.a);
        }
        else
          g[i].gain.setValueAtTime(vp[i],t);
        this._setParamTarget(g[i].gain,pn.s*vp[i],dt,pn.d);
        o[i].start(t);
        if(this.rhythm[ch]){

          o[i].onended = ()=>{
            try {
              if (o[i].detune) this.chmod[ch].disconnect(o[i].detune);
            }
            catch(e){}
          };
          o[i].stop(t+p[0].d*this.releaseRatio);
        }
      }
      if(!this.rhythm[ch])
        this.notetab.push({t:t,e:99999,ch:ch,n:n,o:o,g:g,t2:t+pn.a,v:vp,r:r,f:0});
    },
    _setParamTarget:(p,v,t,d)=>{
      if(d!=0)
        p.setTargetAtTime(v,t,d);
      else
        p.setValueAtTime(v,t);
    },
    _releaseNote:(nt,t)=>{
      if(nt.ch!=9){
        for(let k=nt.g.length-1;k>=0;--k){
          nt.g[k].gain.cancelScheduledValues(t);
          if(t==nt.t2)
            nt.g[k].gain.setValueAtTime(nt.v[k],t);
          else if(t<nt.t2)
            nt.g[k].gain.setValueAtTime(nt.v[k]*(t-nt.t)/(nt.t2-nt.t),t);
          this._setParamTarget(nt.g[k].gain,0,t,nt.r[k]);
        }
      }
      nt.e=t+nt.r[0]*this.releaseRatio;
      nt.f=1;
    },
    setModulation:(ch,v,t)=>{
      this.chmod[ch].gain.setValueAtTime(v*100/127,this._tsConv(t));
    },
    setChVol:(ch,v,t)=>{
      this.vol[ch]=3*v*v/(127*127);
      this.chvol[ch].gain.setValueAtTime(this.vol[ch]*this.ex[ch],this._tsConv(t));
    },
    setPan:(ch,v,t)=>{
      if(this.chpan[ch])
        this.chpan[ch].pan.setValueAtTime((v-64)/64,this._tsConv(t));
    },
    setExpression:(ch,v,t)=>{
      this.ex[ch]=v*v/(127*127);
      this.chvol[ch].gain.setValueAtTime(this.vol[ch]*this.ex[ch],this._tsConv(t));
    },
    setSustain:(ch,v,t)=>{
      this.sustain[ch]=v;
      t=this._tsConv(t);
      if(v<64){
        for(let i=this.notetab.length-1;i>=0;--i){
          const nt=this.notetab[i];
          if(t>=nt.t && nt.ch==ch && nt.f==1)
            this._releaseNote(nt,t);
        }
      }
    },
    allSoundOff:(ch)=>{
      for(let i=this.notetab.length-1;i>=0;--i){
        const nt=this.notetab[i];
        if(nt.ch==ch){
          this._pruneNote(nt);
          this.notetab.splice(i,1);
        }
      }
    },
    resetAllControllers:(ch)=>{
      this.bend[ch]=0; this.ex[ch]=1.0;
      this.rpnidx[ch]=0x3fff; this.sustain[ch]=0;
      if(this.chvol[ch]){
        this.chvol[ch].gain.value=this.vol[ch]*this.ex[ch];
        this.chmod[ch].gain.value=0;
      }
    },
    setBendRange:(ch,v)=>{
      this.brange[ch]=v;
    },
    setProgram:(ch,v)=>{
      if(this.debug)
        console.log("Pg("+ch+")="+v);
      this.pg[ch]=v;
    },
    _tsConv:(t)=>{
      if(t==undefined||t<=0){
        t=0;
        if(this.actx)
          t=this.actx.currentTime;
      }
      else{
        if(this.tsmode)
          t=t*.001-this.tsdiff;
      }
      return t;
    },
    setBend:(ch,v,t)=>{
      t=this._tsConv(t);
      const br=this.brange[ch]*100/127;
      this.bend[ch]=(v-8192)*br/8192;
      for(let i=this.notetab.length-1;i>=0;--i){
        const nt=this.notetab[i];
        if(nt.ch==ch){
          for(let k=nt.o.length-1;k>=0;--k){
            if(nt.o[k].frequency)
              if (nt.o[k].detune) nt.o[k].detune.setValueAtTime(this.bend[ch],t);
          }
        }
      }
    },
    noteOff:(ch,n,t)=>{
      if(this.rhythm[ch])
        return;
      t=this._tsConv(t);
      for(let i=this.notetab.length-1;i>=0;--i){
        const nt=this.notetab[i];
        if(t>=nt.t && nt.ch==ch && nt.n==n && nt.f==0){
          nt.f=1;
          if(this.sustain[ch]<64)
            this._releaseNote(nt,t);
        }
      }
    },
    noteOn:(ch,n,v,t)=>{
      if(v==0){
        this.noteOff(ch,n,t);
        return;
      }
      t=this._tsConv(t);
      if(this.rhythm[ch]){
        if(n>=35&&n<=81)
          this._note(t,ch,n,v,this.drummap[n-35].p);
        return;
      }
      this._note(t,ch,n,v,this.program[this.pg[ch]].p);
    },
    setTsMode:(tsmode)=>{
      this.tsmode=tsmode;
    },
    send:(msg,t)=>{    /* send midi message */
      const ch=msg[0]&0xf;
      const cmd=msg[0]&~0xf;
      if(cmd<0x80||cmd>=0x100)
        return;
      if(this.audioContext.state=="suspended"){
        this.audioContext.resume();
      }
      switch(cmd){
      case 0xb0:  /* ctl change */
        switch(msg[1]){
        case 1:  this.setModulation(ch,msg[2],t); break;
        case 7:  this.setChVol(ch,msg[2],t); break;
        case 10: this.setPan(ch,msg[2],t); break;
        case 11: this.setExpression(ch,msg[2],t); break;
        case 64: this.setSustain(ch,msg[2],t); break;
        case 98:  case 99: this.rpnidx[ch]=0x3fff; break; /* nrpn lsb/msb */
        case 100: this.rpnidx[ch]=(this.rpnidx[ch]&0x3f80)|msg[2]; break; /* rpn lsb */
        case 101: this.rpnidx[ch]=(this.rpnidx[ch]&0x7f)|(msg[2]<<7); break; /* rpn msb */
        case 6:  /* data entry msb */
          switch (this.rpnidx[ch]) {
            case 0:
              this.brange[ch]=(msg[2]<<7)+(this.brange[ch]&0x7f);
              break;
            case 1:
              this.tuningF[ch]=(msg[2]<<7)+((this.tuningF[ch]+0x2000)&0x7f)-0x2000;
              break;
            case 2:
              this.tuningC[ch]=msg[2]-0x40;
              break;
          }
          break;
        case 38:  /* data entry lsb */
          switch (this.rpnidx[ch]) {
            case 0:
              this.brange[ch]=(this.brange[ch]&0x3f80)|msg[2];
              break;
            case 1:
              this.tuningF[ch]=(((this.tuningF[ch]+0x2000)&0x3f80)|msg[2])-0x2000;
              break;
            case 2: break;
          }
          break;
        case 120:  /* all sound off */
        case 123:  /* all notes off */
        case 124: case 125: case 126: case 127: /* omni off/on mono/poly */
          this.allSoundOff(ch);
          break;
        case 121: this.resetAllControllers(ch); break;
        }
        break;
      case 0xc0: this.setProgram(ch,msg[1]); break;
      case 0xe0: this.setBend(ch,(msg[1]+(msg[2]<<7)),t); break;
      case 0x90: this.noteOn(ch,msg[1],msg[2],t); break;
      case 0x80: this.noteOff(ch,msg[1],t); break;
      case 0xf0:
        if (msg[0] == 0xff) {
          this.reset();
          break;
        }
        if(msg[0]!=254 && this.debug){
          var ds=[];
          for(let ii=0;ii<msg.length;++ii)
            ds.push(msg[ii].toString(16));
        }
        if (msg[0]==0xf0) {
          if (msg[1]==0x7f && msg[3]==4) {
            if (msg[4]==3 && msg.length >= 8) { // Master Fine Tuning
              this.masterTuningF = (msg[6]*0x80 + msg[5] - 8192) / 8192;
            }
            if (msg[4]==4 && msg.length >= 8) { // Master Coarse Tuning
              this.masterTuningC = msg[6]-0x40;
            }
          }
          if (msg[1]==0x41 && msg[3]==0x42 && msg[4]==0x12 &&msg[5]==0x40) { // GS
            if ((msg[6]&0xf0)==0x10 && msg.length==11) {
              const c=[9,0,1,2,3,4,5,6,7,8,10,11,12,13,14,15][msg[6]&0xf];
              if (msg[7]==0x15) {
                this.rhythm[c]=msg[8];
              }
              else if (msg[7] >= 0x40 && msg[7] <= 0x4b) { // Scale Tuning
                this.scaleTuning[c][msg[7]-0x40] = (msg[8]-0x40) / 100;
              }
            }
            else if (msg[6]==0) {
              if (msg[7]==0 && msg.length==14) { // Master Tuning
                this.masterTuningF = (msg[8]*0x1000 + msg[9]*0x100 + msg[10]*0x10 + msg[11] - 0x400) / 1000;
              }
              else if (msg[7]==5 && msg.length==11) { // Master Transpose
                this.masterTuningC = msg[8]-0x40;
              }
            }
          }
        }
        break;
      }
    },
    _createWave:(w)=>{
      const imag=new Float32Array(w.length);
      const real=new Float32Array(w.length);
      for(let i=1;i<w.length;++i)
        imag[i]=w[i];
      return this.actx.createPeriodicWave(real,imag);
    },
    getAudioContext:()=>{
      return this.actx;
    },
    setAudioContext:(actx,dest)=>{
      this.audioContext=this.actx=actx;
      this.dest=dest;
      if(!dest)
        this.dest=actx.destination;
      this.tsdiff=performance.now()*.001-this.actx.currentTime;
      if(this.debug)
        console.log("TSDiff:"+this.tsdiff);
      this.out=this.actx.createGain();
      this.comp=this.actx.createDynamicsCompressor();
      var blen=this.actx.sampleRate*.5|0;
      this.convBuf=this.actx.createBuffer(2,blen,this.actx.sampleRate);
      this.noiseBuf={};
      this.noiseBuf.n0=this.actx.createBuffer(1,blen,this.actx.sampleRate);
      this.noiseBuf.n1=this.actx.createBuffer(1,blen,this.actx.sampleRate);
      var d1=this.convBuf.getChannelData(0);
      var d2=this.convBuf.getChannelData(1);
      var dn=this.noiseBuf.n0.getChannelData(0);
      var dr=this.noiseBuf.n1.getChannelData(0);
      for(let i=0;i<blen;++i){
        if(i/blen<Math.random()){
          d1[i]=Math.exp(-3*i/blen)*(Math.random()-.5)*.5;
          d2[i]=Math.exp(-3*i/blen)*(Math.random()-.5)*.5;
        }
        dn[i]=Math.random()*2-1;
      }
      for(let jj=0;jj<64;++jj){
        const r1=Math.random()*10+1;
        const r2=Math.random()*10+1;
        for(let i=0;i<blen;++i){
          var dd=Math.sin((i/blen)*2*Math.PI*440*r1)*Math.sin((i/blen)*2*Math.PI*440*r2);
          dr[i]+=dd/8;
        }
      }
      if(this.useReverb){
        this.conv=this.actx.createConvolver();
        this.conv.buffer=this.convBuf;
        this.rev=this.actx.createGain();
        this.rev.gain.value=this.reverbLev;
        this.out.connect(this.conv);
        this.conv.connect(this.rev);
        this.rev.connect(this.comp);
      }
      this.setMasterVol();
      this.out.connect(this.comp);
      this.comp.connect(this.dest);
      this.chvol=[]; this.chmod=[]; this.chpan=[];
      this.wave={"w9999":this._createWave("w9999")};
      this.lfo=this.actx.createOscillator();
      this.lfo.frequency.value=5;
      this.lfo.start(0);
      for(let i=0;i<16;++i){
        this.chvol[i]=this.actx.createGain();
        if(this.actx.createStereoPanner){
          this.chpan[i]=this.actx.createStereoPanner();
          this.chvol[i].connect(this.chpan[i]);
          this.chpan[i].connect(this.out);
        }
        else{
          this.chpan[i]=null;
          this.chvol[i].connect(this.out);
        }
        this.chmod[i]=this.actx.createGain();
        this.lfo.connect(this.chmod[i]);
        this.pg[i]=0;
        this.resetAllControllers(i);
      }
      this.setReverbLev();
      this.reset();
      this.send([0x90,60,1]);
      this.send([0x90,60,0]);
    },
  });
}
if(window && window.customElements){
  class WebAudioTinySynthElement extends HTMLElement {
    constructor(){
      super();
    }
    connectedCallback(){
      const div = document.createElement("div");
      div.innerHTML=
  `<canvas
    id='wa-canvas' width='300' height='32'
    touch-action='none' tabindex='0'
    style='
      position:relative;
      margin:0;
      border:none;
      width:300px;
      height:32px;
    '
  ></canvas>
  <div id='wa-logo'
    style='
      display:none;
      position:absolute;
      top:5px;
      left:5px;
      color:#fff;
      font-size:8px;
      background:rgba(0,0,0,0.5);
    '
  >TinySynth</div>`;

      this.getAttr = (n,def)=>{
        let v=this.getAttribute(n);
        if(v==""||v==null) return def;
        switch(typeof(def)){
        case "number":
          if(v=="true") return 1;
          v=+v;
          if(isNaN(v)) return 0;
          return v;
        }
        return v;
      };

      this.canvas = div.children[0];
      this.appendChild(div);
      WebAudioTinySynthCore.bind(this)(this);
      const plist=this.properties;
      for(let k in plist){
        const v = plist[k];
        if(v.observer){
          this["_"+k] = v.value;
          Object.defineProperty(this, k, {
            get:()=>{return this["_"+k]},
            set:(val)=>{
              this["_"+k] = val;
              this[v.observer]();
            }
          });
        }
        else{
          this[k]=v;
        }
      }
      for(let k in plist){
        const v = plist[k];
        this[k] = this.getAttr(k,v.value);
      }
      this.setQuality(1);
      this.init();
      this._guiInit.bind(this)();
      setInterval(this._guiUpdate.bind(this),100);
    }
  }
  window.customElements.define('webaudio-tinysynth', WebAudioTinySynthElement);
}

class WebAudioTinySynth {
  constructor(opt){
    WebAudioTinySynthCore.bind(this)(this);
    for(let k in this.properties){
      this[k]=this.properties[k].value;
    }
    this.setQuality(1);
    if(opt){
      if(opt.useReverb!=undefined)
        this.useReverb=opt.useReverb;
      if(opt.quality!=undefined)
        this.setQuality(opt.quality);
      if(opt.voices!=undefined)
        this.setVoices(opt.voices);
    }
    this.init();
  }
}

if(typeof exports === 'object' && typeof module !== 'undefined'){
  module.exports = WebAudioTinySynth;
}
else if(typeof define === 'function' && define.amd){
    define(function(){
      return WebAudioTinySynth;
    });
}
else{
  window.WebAudioTinySynth = WebAudioTinySynth;
}

})(this);
</script>

<script>

function loadMidiUrl(){


  synth.loadMIDIUrl('data:audio/midi;base64,'+CURRENT_MIDI_FILE);
}
function loadMidi(files){
  var reader = new FileReader();
  reader.onload=(e)=>{
    synth.loadMIDI(reader.result);
  }
  reader.readAsArrayBuffer(files[0]);
}
function playMidi(){
  synth.playMIDI();
}
function stopMidi(){
  synth.stopMIDI();
}
function SetProgram(p){
  synth.send([0xc0,p]);
}

var mrixtijde=0;

function Init(){
  synth=new WebAudioTinySynth({voices:64});
  for(var i=0;i<128;++i){
    var o=document.createElement("option");
    o.innerHTML=synth.getTimbreName(0,i);
    document.getElementById("prog").appendChild(o);
  }
  setInterval(function(){
    var st=synth.getPlayStatus();
	
	
		if((st.curTick+mrixtijde)==st.maxTick){
		mrixtijde=100000000;
	maakbase64midrandom();
	setTimeout(function(){ mrixtijde=0; document.getElementById('fl').click(); }, 2000);
	}
	
	var docle=(st.curTick/st.maxTick);
	
	          document.getElementById('progressBar').style.width = `${docle * 100}%`;
		  const otimel=Math.floor(currentCount*(1-docle));
		  document.getElementById('playBtn').textContent=formatTime(otimel);
		  
    document.getElementById("status").innerHTML="Play:"+st.play+"  Pos:"+st.curTick+"/"+st.maxTick;
  },100);
}
function Test(){
  var o=synth.getAudioContext().createOscillator();
  o.connect(synth.getAudioContext().destination);
  o.start(0);
  o.stop(synth.getAudioContext().currentTime+1);
  console.log(synth)
}
window.onload=Init;

</script>
<div style='display:none'>

<h1>webaudio-tinysynth : js version test</h1>
This is a simple sample of webaudio-tinysynth (JavaScript library version) page.
<hr/>
<button onclick="Test()">Test audioContext</button>
<hr/>


Load Sample MIDI from URL : <button onclick="loadMidiUrl('data:audio/midi;base64,"+CURRENT_MIDI_FILE+"')">Load (ws.mid)</button><br/>
Load MIDI file from local : <input type="file" onchange="loadMidi(this.files)"/><br/>
<button onclick="playMidi()">Play</button>
<button onclick="stopMidi()">Stop</button>
<div id="status"></div>
<br/><br/>
Loop : <input type="checkbox" onchange="synth.setLoop(this.checked)"/><br/>
MasterVol<br/>
<input type="range" value="50" min="0" max="100" oninput="synth.setMasterVol(this.value/100)"/><br/>
ReverbLev<br/>
<input type="range" value="50" min="0" max="100" oninput="synth.setReverbLev(this.value/100)"/><br/>

<br/><br/>
Quality : <select onchange="synth.setQuality(this.selectedIndex)"><option>Quality=0</option><option selected>Quality=1</option></select>
<br/>
Timbre : <select id="prog" onchange="SetProgram(this.selectedIndex)"></select>
<br/>
<br/>
Play by keys :<br/>
  <button onmousedown="synth.send([0x90,60,100])" onmouseup="synth.send([0x80,60,0])">C</button>
  <button onmousedown="synth.send([0x90,62,100])" onmouseup="synth.send([0x80,62,0])">D</button>
  <button onmousedown="synth.send([0x90,64,100])" onmouseup="synth.send([0x80,64,0])">E</button>
  <button onmousedown="synth.send([0x90,65,100])" onmouseup="synth.send([0x80,65,0])">F</button>
  <button onmousedown="synth.send([0x90,67,100])" onmouseup="synth.send([0x80,67,0])">G</button>
  <button onmousedown="synth.send([0x90,69,100])" onmouseup="synth.send([0x80,69,0])">A</button>
  <button onmousedown="synth.send([0x90,71,100])" onmouseup="synth.send([0x80,71,0])">B</button>
  <button onmousedown="synth.send([0x90,72,100])" onmouseup="synth.send([0x80,72,0])">C</button>




  <script>

  // Replace the existing loadMidi function with this one:

let currentSynth = null;

function loadMidi(files) {
  if (!files || !files[0]) return;

  // Stop any currently playing synth
  if (currentSynth) {
    currentSynth.stopMIDI();
  }

  // Create a new synth instance
  currentSynth = new WebAudioTinySynth({
    voices: 64,
    useReverb: 1,
    quality: 1
  });

  var reader = new FileReader();
  reader.onload = (e) => {
    currentSynth.loadMIDI(reader.result);

    // Set up UI controls to use the new synth
    setupSynthControls(currentSynth);

    // Auto-play the loaded MIDI
    setTimeout(() => {
      currentSynth.playMIDI();
    }, 500);
  };
  reader.readAsArrayBuffer(files[0]);
}

function loadMidiUrl() {
  // Stop any currently playing synth
  if (currentSynth) {
    currentSynth.stopMIDI();
  }

  // Create a new synth instance
  currentSynth = new WebAudioTinySynth({
    voices: 64,
    useReverb: 1,
    quality: 1
  });


  currentSynth.loadMIDIUrl('data:audio/midi;base64,'+CURRENT_MIDI_FILE);

  // Set up UI controls to use the new synth
  setupSynthControls(currentSynth);

  // Auto-play after loading
  setTimeout(() => {
    currentSynth.playMIDI();
  }, 500);
}

// Helper function to update UI controls for a synth instance
function setupSynthControls(synth) {
  // Update the global synth reference for other functions
  window.synth = synth;

  // Update the status display
  const statusInterval = setInterval(function(){
    var st = synth.getPlayStatus();
    document.getElementById("status").innerHTML = "Play:" + st.play + "  Pos:" + st.curTick + "/" + st.maxTick;
  }, 100);

  // Store the interval ID so we can clear it later
  if (window.statusInterval) {
    clearInterval(window.statusInterval);
  }
  window.statusInterval = statusInterval;

  // Update the program select options
  const progSelect = document.getElementById("prog");
  progSelect.innerHTML = ''; // Clear existing options

  for(var i = 0; i < 128; ++i){
    var o = document.createElement("option");
    o.value = i;
    o.innerHTML = synth.getTimbreName(0, i);
    progSelect.appendChild(o);
  }

  // Update event handlers for the new synth
  progSelect.onchange = function() {
    synth.send([0xc0, parseInt(this.value)]);
  };
}

// Update the existing playMidi and stopMidi functions
function playMidi() {
  if (currentSynth) {
    currentSynth.playMIDI();
  }
}

function stopMidi() {
  if (currentSynth) {
    currentSynth.stopMIDI();
  }
}

// Update the Init function
function Init() {
  // Create initial synth instance
  currentSynth = new WebAudioTinySynth({voices: 64});
  setupSynthControls(currentSynth);
}

// Update the Test function to use current synth
function Test() {
  if (currentSynth) {
    var o = currentSynth.getAudioContext().createOscillator();
    o.connect(currentSynth.getAudioContext().destination);
    o.start(0);
    o.stop(currentSynth.getAudioContext().currentTime + 1);
    console.log(currentSynth);
  }
}

// Also update the event handlers in your HTML to use these functions:
// Replace the inline handlers with these function calls

// In your HTML body, update the controls:
/*
Loop: <input type="checkbox" id="loopCheckbox" onchange="toggleLoop(this.checked)"/><br/>
MasterVol<br/>
<input type="range" id="masterVolSlider" value="50" min="0" max="100" oninput="updateMasterVol(this.value)"/><br/>
ReverbLev<br/>
<input type="range" id="reverbSlider" value="50" min="0" max="100" oninput="updateReverb(this.value)"/><br/>
*/

// Add these helper functions:
function toggleLoop(checked) {
  if (currentSynth) {
    currentSynth.setLoop(checked ? 1 : 0);
  }
}

function updateMasterVol(value) {
  if (currentSynth) {
    currentSynth.setMasterVol(value / 100);
  }
}

function updateReverb(value) {
  if (currentSynth) {
    currentSynth.setReverbLev(value / 100);
  }
}

// And update the quality select:
function updateQuality() {
  const select = document.getElementById("qualitySelect");
  if (currentSynth) {
    currentSynth.setQuality(select.selectedIndex);
  }
}

function flo(){
loadMidiUrl('data:audio/midi;base64,'+CURRENT_MIDI_FILE);
}




</script>

<script>
    // Global variables
    let idleTimer;
    const idleWaitTime = 20000; // 20 seconds
    const elementId = 'weerre';

    function showElement() {
        const el = document.getElementById(elementId);
        if (el) {
            // Use empty string to restore default display from CSS
            el.style.display = '';
        }
    }

    function hideElement() {
        const el = document.getElementById(elementId);
        if (el) {
            el.style.display = 'none';
        }
    }

    function resetIdleTimer() {
        // Show element on any interaction
        showElement();

        // Clear previous timer
        clearTimeout(idleTimer);

        // Start new timer
        idleTimer = setTimeout(() => {
            hideElement();
        }, idleWaitTime);
    }

    // Set up event listeners for mouse and optionally keyboard
    window.addEventListener('mousemove', resetIdleTimer);
    window.addEventListener('mousedown', resetIdleTimer);
    window.addEventListener('keydown', resetIdleTimer);  // optional but often useful
    window.addEventListener('scroll', resetIdleTimer);   // optional

    // Initialize on page load
    resetIdleTimer();
</script>
</div>





</body>
</html>
