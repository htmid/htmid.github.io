<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI & Human Co-op: Non-Stop Algorithmic Music Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles from music-js.html */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .container {
            background: #1e1e1e;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 600px;
            transition: all 0.3s ease;
            text-align: center;
        }
        button {
            transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s;
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            border-radius: 0.5rem;
            cursor: pointer;
            text-transform: uppercase;
        }
        .start-button {
            background-color: #BB86FC; /* Primary Purple */
            color: #1e1e1e;
            box-shadow: 0 4px 15px rgba(187, 134, 252, 0.4);
            min-width: 200px;
        }
        .start-button:hover {
            background-color: #D3A7FC;
            transform: translateY(-1px);
        }
        .start-button:active {
            transform: translateY(1px);
        }
        .info-card {
            background-color: #2a2a2a;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid #BB86FC;
            text-align: left;
        }
        .patch-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: #BB86FC;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-center mb-6">AI Music Generator</h1>
        <p class="text-md mb-6 text-gray-400" id="status">
            Click the button to start non-stop, auto-generated genre music.
        </p>
        
        <div id="controls" class="flex justify-center space-x-4 mb-6">
            <button id="toggleButton" class="start-button">Start Auto Generate</button>
        </div>

        <div class="info-card">
            <div class="text-sm uppercase text-gray-400">Current Genre/Patch</div>
            <div class="patch-name" id="currentPatchName">---</div>
            <div class="text-xs mt-2 text-gray-500" id="genreList"></div>
        </div>
    </div>

    <script>
        // --- Core Music Generation & Genre Logic (adapted from playing.html) ---
        
        // 26 Genres as defined in playing.html
        const GENRES_STRING = "experiment|asia|latin|synths|hiphop|drumbass|reggae|balkan|house|hardrock|rock|punk|cyber|piano|east|jazz|country|signal|tribal|orchestral|ambient|guitar|keltic|brass|strings|orgel";
        const GENRES = GENRES_STRING.split('|').sort();
        
        let currentGenre = GENRES[0];
        let currentPatchIndex = 0;
        let genreChangeInterval = 12; // Change genre every X measures
        let measuresPlayed = 0;

        // Simple Patches/Timbres (simplified version of the 127-patch concept)
        // Each patch is a combination of oscillator type and filter/envelope settings
       const PATCHES = [
            // ----------------------------------------------------------------------
            // 001-008: PIANO
            // ----------------------------------------------------------------------
            { name: 'Acoustic Grand Piano (1)', wave: 'triangle', A: 0.005, D: 0.3, S: 0.0, R: 0.5, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Bright Acoustic Piano (2)', wave: 'sawtooth', A: 0.005, D: 0.25, S: 0.0, R: 0.4, filter: { type: 'lowpass', freq: 6000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Grand Piano (3)', wave: 'square', A: 0.01, D: 0.4, S: 0.1, R: 0.5, filter: { type: 'lowpass', freq: 3000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Honky-tonk Piano (4)', wave: 'sawtooth', A: 0.005, D: 0.2, S: 0.0, R: 0.3, filter: { type: 'lowpass', freq: 3500, Q: 2.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Piano 1 (5)', wave: 'sine', A: 0.01, D: 0.5, S: 0.5, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Piano 2 (6)', wave: 'triangle', A: 0.01, D: 0.6, S: 0.3, R: 0.7, filter: { type: 'lowpass', freq: 4000, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Harpsichord (7)', wave: 'square', A: 0.001, D: 0.2, S: 0.0, R: 0.3, filter: { type: 'highpass', freq: 2000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Clavinet (8)', wave: 'square', A: 0.005, D: 0.1, S: 0.8, R: 0.2, filter: { type: 'lowpass', freq: 5000, Q: 0.8 }, math: 'exponential', lfoRate: 5.0, modDepth: 0.01 },
            // ----------------------------------------------------------------------
            // 009-016: CHROMATIC PERCUSSION
            // ----------------------------------------------------------------------
            { name: '009: Celesta', wave: 'sine', A: 0.01, D: 0.3, S: 0.0, R: 0.8, filter: { type: 'lowpass', freq: 8000, Q: 0.1 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '010: Glockenspiel', wave: 'triangle', A: 0.001, D: 0.2, S: 0.0, R: 0.5, filter: { type: 'highpass', freq: 4000, Q: 0.1 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '011: Music Box', wave: 'sine', A: 0.01, D: 0.5, S: 0.0, R: 0.6, filter: { type: 'lowpass', freq: 5000, Q: 0.5 }, math: 'exponential', lfoRate: 5.0, modDepth: 0.1 },
            { name: '012: Vibraphone', wave: 'sine', A: 0.05, D: 0.5, S: 0.1, R: 0.5, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'exponential', lfoRate: 6.0, modDepth: 0.05 },
            { name: '013: Marimba', wave: 'sawtooth', A: 0.005, D: 0.2, S: 0.0, R: 0.4, filter: { type: 'lowpass', freq: 1500, Q: 1.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '014: Xylophone', wave: 'square', A: 0.001, D: 0.1, S: 0.0, R: 0.3, filter: { type: 'highpass', freq: 2500, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '015: Tubular Bells', wave: 'triangle', A: 0.05, D: 1.0, S: 0.0, R: 1.5, filter: { type: 'lowpass', freq: 6000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '016: Dulcimer', wave: 'sawtooth', A: 0.005, D: 0.3, S: 0.0, R: 0.5, filter: { type: 'lowpass', freq: 3000, Q: 1.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 017-024: ORGAN
            // ----------------------------------------------------------------------
       { name: 'Drawbar Organ (17)', wave: 'sawtooth', A: 0.01, D: 0.1, S: 0.8, R: 0.2, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'linear', lfoRate: 5.0, modDepth: 0.05 },
    { name: 'Percussive Organ (18)', wave: 'sawtooth', A: 0.01, D: 0.1, S: 0.7, R: 0.2, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Rock Organ (19)', wave: 'square', A: 0.01, D: 0.2, S: 0.9, R: 0.3, filter: { type: 'lowpass', freq: 3000, Q: 0.8 }, math: 'linear', lfoRate: 1.0, modDepth: 0.01 },
    { name: 'Church Organ (20)', wave: 'sine', A: 0.1, D: 0.5, S: 1.0, R: 0.5, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Reed Organ (21)', wave: 'sawtooth', A: 0.05, D: 0.5, S: 0.8, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Accordion (22)', wave: 'sawtooth', A: 0.05, D: 0.5, S: 0.8, R: 0.5, filter: { type: 'lowpass', freq: 3500, Q: 0.5 }, math: 'linear', lfoRate: 5.0, modDepth: 0.01 },
    { name: 'Harmonica (23)', wave: 'square', A: 0.05, D: 0.4, S: 0.7, R: 0.4, filter: { type: 'bandpass', freq: 1000, Q: 2.0 }, math: 'linear', lfoRate: 5.0, modDepth: 0.02 },
    { name: 'Tango Accordion (24)', wave: 'sawtooth', A: 0.05, D: 0.5, S: 0.8, R: 0.5, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            // ----------------------------------------------------------------------
            // 025-032: GUITAR
            // ----------------------------------------------------------------------
          { name: 'Acoustic Guitar (25)', wave: 'triangle', A: 0.005, D: 0.4, S: 0.0, R: 0.5, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Guitar Jazz (26)', wave: 'sine', A: 0.01, D: 0.5, S: 0.2, R: 0.6, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Guitar Clean (27)', wave: 'triangle', A: 0.01, D: 0.6, S: 0.4, R: 0.7, filter: { type: 'lowpass', freq: 3500, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Guitar Muted (28)', wave: 'square', A: 0.001, D: 0.05, S: 0.0, R: 0.1, filter: { type: 'lowpass', freq: 1000, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Overdriven Guitar (29)', wave: 'sawtooth', A: 0.05, D: 0.5, S: 0.5, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Distortion Guitar (30)', wave: 'square', A: 0.05, D: 0.6, S: 0.6, R: 0.6, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Guitar Harmonics (31)', wave: 'sine', A: 0.01, D: 0.8, S: 0.0, R: 1.0, filter: { type: 'highpass', freq: 5000, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Acoustic Bass (32)', wave: 'triangle', A: 0.01, D: 0.4, S: 0.3, R: 0.5, filter: { type: 'lowpass', freq: 300, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            // ----------------------------------------------------------------------
            // 033-040: BASS
            // ----------------------------------------------------------------------
  { name: 'Electric Bass (Finger) (33)', wave: 'sawtooth', A: 0.005, D: 0.3, S: 0.5, R: 0.4, filter: { type: 'lowpass', freq: 500, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
    { name: 'Electric Bass (Pick) (34)', wave: 'square', A: 0.001, D: 0.2, S: 0.6, R: 0.3, filter: { type: 'lowpass', freq: 700, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '035: Electric Bass (Pick)', wave: 'square', A: 0.005, D: 0.2, S: 0.5, R: 0.5, filter: { type: 'lowpass', freq: 1000, Q: 1.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '036: Fretless Bass', wave: 'sine', A: 0.1, D: 0.5, S: 0.3, R: 1.0, filter: { type: 'lowpass', freq: 600, Q: 0.8 }, math: 'linear', lfoRate: 0.5, modDepth: 5 }, // Glide for fretless
            { name: '037: Slap Bass 1', wave: 'sawtooth', A: 0.001, D: 0.05, S: 0.0, R: 0.2, filter: { type: 'highpass', freq: 200, Q: 1.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '038: Slap Bass 2', wave: 'square', A: 0.001, D: 0.1, S: 0.0, R: 0.3, filter: { type: 'lowpass', freq: 1000, Q: 2.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '039: Synth Bass 1 (Acid)', wave: 'sawtooth', A: 0.05, D: 0.2, S: 0.9, R: 0.4, filter: { type: 'lowpass', freq: 500, Q: 5.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '040: Synth Bass 2 (Sub)', wave: 'sine', A: 0.1, D: 0.3, S: 0.7, R: 0.5, filter: { type: 'lowpass', freq: 300, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 041-048: STRINGS
            // ----------------------------------------------------------------------
            { name: '041: Violin', wave: 'triangle', A: 0.1, D: 0.4, S: 0.6, R: 0.5, filter: { type: 'lowpass', freq: 3000, Q: 0.8 }, math: 'exponential', lfoRate: 5.0, modDepth: 0.05 },
            { name: '042: Viola', wave: 'sawtooth', A: 0.1, D: 0.3, S: 0.7, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 1.0 }, math: 'exponential', lfoRate: 4.5, modDepth: 0.03 },
            { name: '043: Cello', wave: 'sine', A: 0.15, D: 0.5, S: 0.8, R: 0.6, filter: { type: 'lowpass', freq: 1500, Q: 1.2 }, math: 'exponential', lfoRate: 4.0, modDepth: 0.02 },
            { name: '044: Contrabass', wave: 'square', A: 0.2, D: 0.6, S: 0.8, R: 0.7, filter: { type: 'lowpass', freq: 800, Q: 1.5 }, math: 'exponential', lfoRate: 3.0, modDepth: 0.01 },
            { name: '045: Tremolo Strings', wave: 'sawtooth', A: 0.05, D: 0.2, S: 0.7, R: 0.4, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'exponential', lfoRate: 12.0, modDepth: 0.1 },
            { name: '046: Pizzicato Strings', wave: 'triangle', A: 0.001, D: 0.1, S: 0.0, R: 0.3, filter: { type: 'lowpass', freq: 5000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '047: Orchestral Harp', wave: 'sine', A: 0.005, D: 0.5, S: 0.0, R: 1.0, filter: { type: 'bandpass', freq: 1500, Q: 8 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '048: Timpani', wave: 'square', A: 0.01, D: 0.3, S: 0.0, R: 0.5, filter: { type: 'lowpass', freq: 300, Q: 5.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 049-056: ENSEMBLE
            // ----------------------------------------------------------------------
            { name: '049: String Ensemble 1 (Fast)', wave: 'sawtooth', A: 0.2, D: 0.5, S: 0.9, R: 0.8, filter: { type: 'lowpass', freq: 3500, Q: 0.7 }, math: 'exponential', lfoRate: 0.5, modDepth: 0.05 },
            { name: '050: String Ensemble 2 (Slow)', wave: 'triangle', A: 0.5, D: 1.0, S: 0.8, R: 1.0, filter: { type: 'lowpass', freq: 3000, Q: 0.5 }, math: 'exponential', lfoRate: 0.2, modDepth: 0.08 },
            { name: '051: Synth Strings 1', wave: 'square', A: 0.1, D: 0.3, S: 0.7, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 2.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '052: Synth Strings 2', wave: 'sawtooth', A: 0.05, D: 0.4, S: 0.6, R: 0.6, filter: { type: 'highpass', freq: 1000, Q: 1.0 }, math: 'linear', lfoRate: 1.0, modDepth: 0.1 },
            { name: '053: Choir Aahs', wave: 'sine', A: 0.3, D: 0.5, S: 0.9, R: 1.0, filter: { type: 'lowpass', freq: 1500, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '054: Voice Oohs', wave: 'triangle', A: 0.4, D: 0.6, S: 0.8, R: 1.2, filter: { type: 'bandpass', freq: 800, Q: 2.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '055: Synth Voice', wave: 'square', A: 0.15, D: 0.4, S: 0.8, R: 0.7, filter: { type: 'lowpass', freq: 1000, Q: 3.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '056: Orchestra Hit', wave: 'sawtooth', A: 0.001, D: 0.5, S: 0.0, R: 0.5, filter: { type: 'bandpass', freq: 4000, Q: 10.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 057-064: BRASS
            // ----------------------------------------------------------------------
            { name: '057: Trumpet', wave: 'sawtooth', A: 0.05, D: 0.2, S: 0.7, R: 0.3, filter: { type: 'highpass', freq: 1500, Q: 0.5 }, math: 'exponential', lfoRate: 5.0, modDepth: 0.05 },
            { name: '058: Trombone', wave: 'square', A: 0.08, D: 0.3, S: 0.8, R: 0.4, filter: { type: 'lowpass', freq: 1000, Q: 1.0 }, math: 'exponential', lfoRate: 4.0, modDepth: 0.03 },
            { name: '059: Tuba', wave: 'triangle', A: 0.15, D: 0.5, S: 0.8, R: 0.6, filter: { type: 'lowpass', freq: 500, Q: 0.8 }, math: 'exponential', lfoRate: 3.0, modDepth: 0.02 },
            { name: '060: Muted Trumpet', wave: 'sine', A: 0.05, D: 0.2, S: 0.6, R: 0.3, filter: { type: 'lowpass', freq: 800, Q: 2.0 }, math: 'exponential', lfoRate: 5.0, modDepth: 0.05 },
            { name: '061: French Horn', wave: 'sawtooth', A: 0.3, D: 0.4, S: 0.8, R: 0.7, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '062: Brass Section', wave: 'square', A: 0.1, D: 0.3, S: 0.7, R: 0.5, filter: { type: 'lowpass', freq: 3000, Q: 0.7 }, math: 'exponential', lfoRate: 0.5, modDepth: 0.05 },
            { name: '063: Synth Brass 1', wave: 'sawtooth', A: 0.05, D: 0.2, S: 0.9, R: 0.4, filter: { type: 'lowpass', freq: 1500, Q: 3.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '064: Synth Brass 2', wave: 'square', A: 0.1, D: 0.3, S: 0.8, R: 0.5, filter: { type: 'lowpass', freq: 2000, Q: 2.5 }, math: 'exponential', lfoRate: 0.5, modDepth: 5.0 },

            // ----------------------------------------------------------------------
            // 065-072: REED
            // ----------------------------------------------------------------------
            { name: '065: Soprano Sax', wave: 'sine', A: 0.05, D: 0.2, S: 0.7, R: 0.3, filter: { type: 'lowpass', freq: 4000, Q: 1.5 }, math: 'exponential', lfoRate: 6.0, modDepth: 0.05 },
            { name: '066: Alto Sax', wave: 'triangle', A: 0.08, D: 0.3, S: 0.8, R: 0.4, filter: { type: 'lowpass', freq: 3000, Q: 2.0 }, math: 'exponential', lfoRate: 5.5, modDepth: 0.04 },
            { name: '067: Tenor Sax', wave: 'sawtooth', A: 0.1, D: 0.4, S: 0.8, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 2.5 }, math: 'exponential', lfoRate: 5.0, modDepth: 0.03 },
            { name: '068: Baritone Sax', wave: 'square', A: 0.15, D: 0.5, S: 0.7, R: 0.6, filter: { type: 'lowpass', freq: 1500, Q: 3.0 }, math: 'exponential', lfoRate: 4.0, modDepth: 0.02 },
            { name: '069: Oboe', wave: 'sine', A: 0.1, D: 0.3, S: 0.6, R: 0.4, filter: { type: 'bandpass', freq: 2000, Q: 4.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '070: English Horn', wave: 'triangle', A: 0.15, D: 0.4, S: 0.7, R: 0.5, filter: { type: 'bandpass', freq: 1500, Q: 3.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '071: Bassoon', wave: 'sawtooth', A: 0.2, D: 0.5, S: 0.7, R: 0.6, filter: { type: 'lowpass', freq: 800, Q: 1.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '072: Clarinet', wave: 'square', A: 0.05, D: 0.2, S: 0.8, R: 0.3, filter: { type: 'lowpass', freq: 3500, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 073-080: PIPE
            // ----------------------------------------------------------------------
            { name: '073: Piccolo', wave: 'triangle', A: 0.01, D: 0.2, S: 0.6, R: 0.3, filter: { type: 'highpass', freq: 6000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '074: Flute', wave: 'sine', A: 0.05, D: 0.3, S: 0.8, R: 0.4, filter: { type: 'lowpass', freq: 5000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '075: Recorder', wave: 'square', A: 0.08, D: 0.4, S: 0.7, R: 0.5, filter: { type: 'lowpass', freq: 4000, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '076: Pan Flute', wave: 'sawtooth', A: 0.05, D: 0.3, S: 0.7, R: 0.4, filter: { type: 'bandpass', freq: 3000, Q: 5.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '077: Blown Bottle', wave: 'sine', A: 0.1, D: 0.5, S: 0.0, R: 0.6, filter: { type: 'lowpass', freq: 2000, Q: 0.8 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '078: Shakuhachi', wave: 'triangle', A: 0.15, D: 0.6, S: 0.0, R: 0.7, filter: { type: 'lowpass', freq: 1500, Q: 1.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '079: Whistle', wave: 'sine', A: 0.01, D: 0.2, S: 0.9, R: 0.3, filter: { type: 'highpass', freq: 7000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '080: Ocarina', wave: 'square', A: 0.1, D: 0.4, S: 0.8, R: 0.5, filter: { type: 'lowpass', freq: 2500, Q: 1.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 081-088: SYNTH LEAD
            // ----------------------------------------------------------------------
            { name: '081: Lead 1 (Square)', wave: 'square', A: 0.01, D: 0.1, S: 0.9, R: 0.2, filter: { type: 'lowpass', freq: 5000, Q: 1.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '082: Lead 2 (Saw)', wave: 'sawtooth', A: 0.01, D: 0.15, S: 0.8, R: 0.3, filter: { type: 'lowpass', freq: 4000, Q: 2.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '083: Lead 3 (Calliope)', wave: 'triangle', A: 0.05, D: 0.2, S: 0.9, R: 0.4, filter: { type: 'lowpass', freq: 6000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '084: Lead 4 (Chiff)', wave: 'sine', A: 0.005, D: 0.3, S: 0.0, R: 0.5, filter: { type: 'bandpass', freq: 4000, Q: 5.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '085: Lead 5 (Charang)', wave: 'sawtooth', A: 0.01, D: 0.3, S: 0.5, R: 0.5, filter: { type: 'lowpass', freq: 3000, Q: 3.0 }, math: 'exponential', lfoRate: 8.0, modDepth: 0.2 },
            { name: '086: Lead 6 (Voice)', wave: 'square', A: 0.1, D: 0.2, S: 0.8, R: 0.3, filter: { type: 'lowpass', freq: 1500, Q: 4.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '087: Lead 7 (Fiff)', wave: 'triangle', A: 0.001, D: 0.05, S: 0.0, R: 0.2, filter: { type: 'highpass', freq: 4000, Q: 1.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '088: Lead 8 (Bass+Lead)', wave: 'sawtooth', A: 0.05, D: 0.2, S: 0.7, R: 0.4, filter: { type: 'lowpass', freq: 800, Q: 5.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 089-096: SYNTH PAD
            // ----------------------------------------------------------------------
            { name: '089: Pad 1 (New Age)', wave: 'sine', A: 0.5, D: 1.0, S: 0.7, R: 1.5, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'exponential', lfoRate: 0.5, modDepth: 0.02 },
            { name: '090: Pad 2 (Warm)', wave: 'triangle', A: 0.8, D: 1.5, S: 0.8, R: 2.0, filter: { type: 'lowpass', freq: 1500, Q: 1.0 }, math: 'exponential', lfoRate: 0.2, modDepth: 0.01 },
            { name: '091: Pad 3 (Polysynth)', wave: 'sawtooth', A: 0.2, D: 0.5, S: 0.9, R: 1.0, filter: { type: 'lowpass', freq: 3000, Q: 1.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '092: Pad 4 (Choir)', wave: 'square', A: 0.4, D: 0.8, S: 0.8, R: 1.2, filter: { type: 'lowpass', freq: 1000, Q: 2.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '093: Pad 5 (Bowed)', wave: 'triangle', A: 1.0, D: 1.0, S: 0.7, R: 2.0, filter: { type: 'lowpass', freq: 2500, Q: 0.7 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '094: Pad 6 (Metallic)', wave: 'sawtooth', A: 0.1, D: 0.5, S: 0.6, R: 1.0, filter: { type: 'bandpass', freq: 4000, Q: 5.0 }, math: 'linear', lfoRate: 1.0, modDepth: 0.1 },
            { name: '095: Pad 7 (Halo)', wave: 'sine', A: 0.8, D: 1.5, S: 0.9, R: 2.5, filter: { type: 'lowpass', freq: 4000, Q: 0.5 }, math: 'exponential', lfoRate: 0.1, modDepth: 0.05 },
            { name: '096: Pad 8 (Sweep)', wave: 'square', A: 0.5, D: 1.0, S: 0.5, R: 1.5, filter: { type: 'lowpass', freq: 500, Q: 3.0, freqSweep: true }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 }, // Special for sweep

            // ----------------------------------------------------------------------
            // 097-104: SYNTH FX
            // ----------------------------------------------------------------------
            { name: '097: FX 1 (Rain)', wave: 'square', A: 0.01, D: 0.1, S: 0.0, R: 0.2, filter: { type: 'lowpass', freq: 1000, Q: 5.0 }, math: 'linear', lfoRate: 20.0, modDepth: 10.0 },
            { name: '098: FX 2 (Soundtrack)', wave: 'sawtooth', A: 0.05, D: 0.8, S: 0.7, R: 1.0, filter: { type: 'lowpass', freq: 3000, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '099: FX 3 (Crystal)', wave: 'triangle', A: 0.005, D: 0.3, S: 0.1, R: 0.5, filter: { type: 'bandpass', freq: 6000, Q: 10.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '100: FX 4 (Atmosphere)', wave: 'sine', A: 1.0, D: 2.0, S: 0.8, R: 3.0, filter: { type: 'lowpass', freq: 1000, Q: 0.5 }, math: 'exponential', lfoRate: 0.1, modDepth: 0.01 },
            { name: '101: FX 5 (Brightness)', wave: 'sawtooth', A: 0.01, D: 0.1, S: 0.9, R: 0.2, filter: { type: 'highpass', freq: 5000, Q: 2.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '102: FX 6 (Goblins)', wave: 'square', A: 0.05, D: 0.4, S: 0.5, R: 0.6, filter: { type: 'lowpass', freq: 500, Q: 4.0 }, math: 'linear', lfoRate: 1.0, modDepth: 10.0 },
            { name: '103: FX 7 (Echoes)', wave: 'triangle', A: 0.01, D: 0.5, S: 0.0, R: 0.8, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '104: FX 8 (Sci-Fi)', wave: 'sawtooth', A: 0.05, D: 0.5, S: 0.6, R: 0.8, filter: { type: 'bandpass', freq: 1500, Q: 8.0 }, math: 'linear', lfoRate: 10.0, modDepth: 0.1 },

            // ----------------------------------------------------------------------
            // 105-112: ETHNIC
            // ----------------------------------------------------------------------
            { name: '105: Sitar', wave: 'triangle', A: 0.005, D: 0.4, S: 0.1, R: 0.5, filter: { type: 'bandpass', freq: 800, Q: 10.0 }, math: 'exponential', lfoRate: 8.0, modDepth: 0.05 },
            { name: '106: Banjo', wave: 'sawtooth', A: 0.001, D: 0.1, S: 0.0, R: 0.3, filter: { type: 'highpass', freq: 4000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '107: Shamisen', wave: 'square', A: 0.001, D: 0.2, S: 0.0, R: 0.4, filter: { type: 'lowpass', freq: 3000, Q: 1.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '108: Koto', wave: 'sine', A: 0.05, D: 0.5, S: 0.0, R: 0.7, filter: { type: 'lowpass', freq: 2000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '109: Kalimba', wave: 'triangle', A: 0.005, D: 0.2, S: 0.0, R: 0.4, filter: { type: 'bandpass', freq: 5000, Q: 5.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '110: Bagpipe', wave: 'sawtooth', A: 0.1, D: 0.5, S: 1.0, R: 0.2, filter: { type: 'lowpass', freq: 1000, Q: 2.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '111: Fiddle', wave: 'sine', A: 0.05, D: 0.3, S: 0.7, R: 0.4, filter: { type: 'lowpass', freq: 3500, Q: 1.0 }, math: 'exponential', lfoRate: 6.0, modDepth: 0.03 },
            { name: '112: Shanai', wave: 'square', A: 0.1, D: 0.4, S: 0.8, R: 0.5, filter: { type: 'bandpass', freq: 1500, Q: 3.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 113-120: PERCUSSIVE
            // ----------------------------------------------------------------------
            { name: '113: Tinkle Bell', wave: 'triangle', A: 0.001, D: 0.2, S: 0.0, R: 0.5, filter: { type: 'highpass', freq: 8000, Q: 0.5 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '114: AgogÃ´', wave: 'square', A: 0.001, D: 0.1, S: 0.0, R: 0.2, filter: { type: 'bandpass', freq: 2000, Q: 10.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '115: Steel Drums', wave: 'sine', A: 0.01, D: 0.3, S: 0.1, R: 0.4, filter: { type: 'lowpass', freq: 4000, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '116: Woodblock', wave: 'sawtooth', A: 0.001, D: 0.05, S: 0.0, R: 0.1, filter: { type: 'lowpass', freq: 1000, Q: 5.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '117: Taiko Drum', wave: 'square', A: 0.05, D: 0.5, S: 0.0, R: 0.8, filter: { type: 'lowpass', freq: 300, Q: 1.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '118: Melodic Tom', wave: 'triangle', A: 0.01, D: 0.2, S: 0.0, R: 0.3, filter: { type: 'lowpass', freq: 500, Q: 2.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '119: Synth Drum', wave: 'sawtooth', A: 0.01, D: 0.1, S: 0.5, R: 0.2, filter: { type: 'lowpass', freq: 2000, Q: 3.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '120: Reverse Cymbal', wave: 'sine', A: 0.5, D: 1.0, S: 0.0, R: 0.5, filter: { type: 'highpass', freq: 1000, Q: 0.1 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },

            // ----------------------------------------------------------------------
            // 121-127: SOUND EFFECTS
            // ----------------------------------------------------------------------
            { name: '121: Guitar Fret Noise', wave: 'sawtooth', A: 0.001, D: 0.05, S: 0.0, R: 0.1, filter: { type: 'highpass', freq: 6000, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '122: Breath Noise', wave: 'sine', A: 0.05, D: 0.3, S: 0.0, R: 0.5, filter: { type: 'bandpass', freq: 500, Q: 5.0 }, math: 'exponential', lfoRate: 0.0, modDepth: 0.0 },
            { name: '123: Seashore', wave: 'square', A: 0.1, D: 1.0, S: 0.0, R: 2.0, filter: { type: 'lowpass', freq: 200, Q: 0.5 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 },
            { name: '124: Bird Tweet', wave: 'triangle', A: 0.005, D: 0.1, S: 0.0, R: 0.2, filter: { type: 'highpass', freq: 8000, Q: 0.1 }, math: 'exponential', lfoRate: 20.0, modDepth: 5.0 },
            { name: '125: Telephone Ring', wave: 'square', A: 0.05, D: 0.2, S: 0.8, R: 0.3, filter: { type: 'bandpass', freq: 1000, Q: 10.0 }, math: 'linear', lfoRate: 10.0, modDepth: 5.0 },
            { name: '126: Helicopter', wave: 'sawtooth', A: 0.5, D: 1.0, S: 0.5, R: 1.0, filter: { type: 'lowpass', freq: 100, Q: 0.5 }, math: 'linear', lfoRate: 2.0, modDepth: 10.0 },
            { name: '127: Gunshot', wave: 'square', A: 0.001, D: 0.05, S: 0.0, R: 0.05, filter: { type: 'bandpass', freq: 4000, Q: 20.0 }, math: 'linear', lfoRate: 0.0, modDepth: 0.0 }, // TOTAL: 127 Patches (001-127)
        ];

        // --- Web Audio API Setup (from music-js.html) ---
        let audioContext = null;
        let isPlaying = false;
        let scheduler;
        let lookahead = 0.025; // 25ms
        let scheduleAheadTime = 0.1; // 100ms
        let nextNoteTime = 0.0;
        let tempo = 120.0; // BPM
        let activeOscillators = [];

        function initAudio() {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            // Start note time immediately
            nextNoteTime = audioContext.currentTime + 0.1;
        }

        function midiToFreq(midiNote) {
            return 440 * Math.pow(2, (midiNote - 69) / 12);
        }

        function playNote(frequency, volume, patch, startTime, duration) {
            // Create oscillator and gain nodes
            const osc = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();

            // Apply patch settings
            osc.type = patch.type;
            osc.frequency.setValueAtTime(frequency, startTime);
            filter.type = 'lowpass';
            filter.frequency.value = patch.filterFreq;
            filter.Q.value = patch.q;
            
            // Connect nodes
            osc.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // Envelope (ADSR - simplified)
            const attackTime = patch.attack;
            const releaseTime = patch.release;

            // Start volume at 0
            gainNode.gain.setValueAtTime(0, startTime);
            // Attack phase
            gainNode.gain.linearRampToValueAtTime(volume * 0.5, startTime + attackTime);
            // Release phase (for note off)
            gainNode.gain.linearRampToValueAtTime(0, startTime + attackTime + duration + releaseTime);
            
            osc.start(startTime);
            osc.stop(startTime + attackTime + duration + releaseTime);

            // Keep track of active oscillators to stop them
            activeOscillators.push({ osc: osc, stopTime: startTime + attackTime + duration + releaseTime });
        }

        // Algorithmic music generation based on current genre and patch
        let melodyIndex = 0;
        const scale = [0, 2, 4, 5, 7, 9, 11]; // Major scale
        let currentBaseNote = 60; // Middle C

        function generateNote(time) {
            // Remove finished oscillators
            activeOscillators = activeOscillators.filter(item => item.stopTime > audioContext.currentTime);

            const secondsPerBeat = 60.0 / tempo;
            const beatDuration = secondsPerBeat / 4; // 16th note

            // Determine note and duration based on a simple pattern for the current genre
            const genreNoteShift = GENRES.indexOf(currentGenre) % 7; // Shift note based on genre index
            const noteInterval = scale[(melodyIndex + genreNoteShift) % scale.length];
            const midiNote = currentBaseNote + noteInterval;
            const noteDuration = beatDuration * (Math.random() < 0.2 ? 2 : 1); // Mix of 16th and 8th notes

            const patch = PATCHES[currentPatchIndex % PATCHES.length];
            const volume = 0.5 + Math.random() * 0.5; // Random velocity

            playNote(midiToFreq(midiNote), volume, patch, time, noteDuration * 0.8);

            melodyIndex++;
            if (melodyIndex % 16 === 0) {
                // End of a measure (4 beats * 4 16th notes)
                measuresPlayed++;
                // Simple pattern shift
                currentBaseNote += Math.random() < 0.3 ? (Math.random() < 0.5 ? 12 : -12) : 0;
            }
            if (measuresPlayed >= genreChangeInterval) {
                // Change genre and patch
                currentPatchIndex = (currentPatchIndex + 1) % PATCHES.length;
                currentGenre = GENRES[Math.floor(Math.random() * GENRES.length)];
                measuresPlayed = 0;
                // Randomly adjust tempo for variety
                tempo = 90 + Math.floor(Math.random() * 60);
            }
            
            // Update UI 
            document.getElementById('currentPatchName').textContent = `${currentGenre.toUpperCase()} (${PATCHES[currentPatchIndex % PATCHES.length].name})`;
            document.getElementById('status').textContent = `Now playing at ${Math.round(tempo)} BPM.`;

            return beatDuration;
        }

        // --- Scheduling and Control Logic ---

        function scheduleMusic() {
            // Look ahead and schedule notes
            while (nextNoteTime < audioContext.currentTime + scheduleAheadTime) {
                const stepDuration = generateNote(nextNoteTime);
                nextNoteTime += stepDuration;
            }
            if (isPlaying) {
                scheduler = setTimeout(scheduleMusic, lookahead * 1000);
            }
        }

        function toggleAudio() {
            if (!audioContext) {
                initAudio();
            }

            if (isPlaying) {
                stopAudio();
                const button = document.getElementById('toggleButton');
                button.textContent = 'Start Auto Generate';
                button.classList.remove('stop-button');
                button.classList.add('start-button');
            } else {
                audioContext.resume().then(() => {
                    isPlaying = true;
                    // Reset
                    nextNoteTime = audioContext.currentTime;
                    measuresPlayed = 0;
                    currentPatchIndex = 0;
                    currentGenre = GENRES[Math.floor(Math.random() * GENRES.length)];
                    
                    scheduleMusic();
                    const button = document.getElementById('toggleButton');
                    button.textContent = 'Stop Generation';
                    button.classList.remove('start-button');
                    button.classList.add('stop-button');
                });
            }
        }

        function stopAudio() {
            isPlaying = false;
            clearTimeout(scheduler);
            // Stop all active oscillators
            activeOscillators.forEach(item => {
                try {
                    item.osc.stop();
                } catch (e) {
                    // Ignore errors if the node was already stopped
                }
            });
            activeOscillators = [];
            audioContext.suspend().then(() => {
                document.getElementById('status').textContent = 'Stopped.';
                document.getElementById('currentPatchName').textContent = '---';
            });
        }

        // --- Event Listeners and Initialization ---
        document.getElementById('toggleButton').addEventListener('click', toggleAudio);
        document.getElementById('genreList').textContent = `Available Genres: ${GENRES.join(', ')}`;
    </script>
</body>
</html>